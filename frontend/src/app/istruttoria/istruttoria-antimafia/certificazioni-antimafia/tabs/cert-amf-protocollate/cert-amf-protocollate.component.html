<div class="ui-grid-fixed boxgrey">
  <p-toast position="top-center" key="generic" [baseZIndex]="50000"></p-toast>
  <div class=" layout-actionmenu">
    <h3>{{ textTitle }}</h3>
    <div class="globalfilter">
      <i class="material-icons">search</i>
      <input type="text" pInputText size="50" placeholder="Ricerca..."
        (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:auto">
    </div>
    <app-a4g-paged-table #dt [columns]="cols" [value]="certificazioniProtocollateView" [totalRecords]="elementiTotali"
      [(selectedItems)]="certificazioneProtocollateSelezionate" [(isSelectedAll)]="isSelectedAll"
      (onLazyLoadPage)="loadData($event)" [lazy]="true" [sizeArray]="intestazioni.sizePerPagina">
      <!-- HEADER -->
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th style="width: 3em">
            <app-a4g-paged-table-checkbox></app-a4g-paged-table-checkbox>
          </th>
          <th *ngFor="let col of columns" [pSortableColumnWrapper]="col.field"
            [pSortableColumnDisabled]="col.field == null">
            {{ col.header }}
            <p-sortIcon-wrapper [field]="col.field">
            </p-sortIcon-wrapper>
          </th>
          <th style="width: 3em">
            {{this.intestazioni.collegate}}
          </th>
          <th style="width: 3em">
            {{this.intestazioni.azioni}}
          </th>
        </tr>
      </ng-template>
      <!-- BODY -->
      <ng-template pTemplate="body" let-cert let-i="rowIndex">
        <tr [pSelectableRowWrapper]="cert">
          <td>
            <p-tableCheckbox-wrapper [value]="cert"></p-tableCheckbox-wrapper>
          </td>
          <td>{{ cert.datiDichiarazione.dettaglioImpresa.codiceFiscale }}</td>
          <td>{{ cert.datiDichiarazione.dettaglioImpresa.denominazione }}</td>
          <td>{{ cert.dtProtocollazione | date: "dd/MM/yyyy" }}</td>
          <td>{{ cert.idProtocollo != null ? cert.idProtocollo : ("gestioneUtenze.IN_PROTOCOLLAZIONE" | translate) }}</td>
          <td>
            <div class="ui-g">
              <div class="pallinoVerde" *ngIf="cert.esito === 'OK'" [pTooltip]="buildDescrizioneTooltip(cert)">
              </div>
              <div class="pallinoRosso" *ngIf="cert.esito === 'KO'" [pTooltip]="buildDescrizioneTooltip(cert)">
              </div>
            </div>
          </td>
          <td style="width:200px;">
            <div class="ui-g icon-action">
              <div class="">
                <p-button [disabled]="cert.idsDomandaSuperficie.length > 0 ? false : true"
                  title="{{intestazioni.DOMANDE_SUPERFICIE_EU}}" icon="fa ui-icon-tab" iconPos="center"
                  (onClick)="visualizzaDettaglioDomanda(cert,0)"></p-button>
              </div>
              <div class="">
                <p-button [disabled]="cert.idsDomandaStrutturale.length > 0 ? false : true"
                  title="{{intestazioni.DOMANDE_STRUTTURALI_EU}}" icon="fa ui-icon-developer-board" iconPos="center"
                  (onClick)="visualizzaDettaglioDomanda(cert,1)"></p-button>
              </div>
              <div class="">
                <p-button [disabled]="cert.idsDomandaDu.length > 0 ? false : true"
                  title="{{intestazioni.DOMANDE_UNICHE}}" icon="fa ui-icon-description" iconPos="center"
                  (onClick)="visualizzaDettaglioDomanda(cert,2)">
                </p-button>
              </div>
            </div>
          </td>
          <td>
            <action-menu #actionMenu [item]="menuAction" (click)="onDropdownMenuOpen(actionMenu, cert, i)">
            </action-menu>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage" let-columns>
        <tr>
          <td [attr.colspan]="columns.length + 3">
            {{ intestazioni.noTableContent }}
          </td>
        </tr>
      </ng-template>
    </app-a4g-paged-table>
  </div>

  <div>
    <p-button appDebounceClick [disabled]="checkIfIsEmpty()" label="{{intestazioni.AVVIA_CONTROLLO}}"
      (debounceClick)="avviaControllo()"></p-button>
  </div>
</div>


<p-toast position="center" key="aggiorna-stato" (onClose)="onRejectAggiornaStato()" [modal]="true" [baseZIndex]="5000"
  sticky="true">
  <ng-template let-message pTemplate="message">
    <div style="text-align: center">
      <i class="pi pi-exclamation-triangle" style="font-size: 3em"></i>
      <h3>{{message.summary}}</h3>
      <p>{{message.detail}}</p>
    </div>
    <div class="ui-g ui-fluid">
      <div class="ui-g-6">
        <button type="button" pButton (click)="onConfirmAggiornaStato()" label="Si" class="ui-button-success"></button>
      </div>
      <div class="ui-g-6">
        <button type="button" pButton (click)="onRejectAggiornaStato()" label="No" class="ui-button-secondary"></button>
      </div>
    </div>
  </ng-template>
</p-toast>