<div class="card no-margin" *ngIf="this.idIstruttoria" class="ui-g-12 boxgrey" style="padding-top:50px;">
  <div class="ui-g-12">
    <div class="ui-grid-fixed">
      <p-toast key="tst" [style]="{marginTop: '70px'}"></p-toast>
      <div class="ui-g-3">
        <app-filtro-accoppiati [cuaaSuggestions]="suggestionsCUAA"
          [denominazioneSuggestions]="suggestionsDenominazione">
        </app-filtro-accoppiati>
      </div>
      <div class="ui-g-9">
        <div class="table-responsive" margin-top="30px">
          <p-table #table [columns]="cols" [value]="this.paginaDomande.risultati" [autoLayout]="true"
            [totalRecords]="this.paginaDomande.elementiTotali" [paginator]="true" (onLazyLoad)="loadData($event)"
            [rows]="elementiPerPagina" [lazy]="true" [(selection)]="domande">
            <ng-template pTemplate="header" class="header" let-columns>
              <tr>
                <th>
                  <p-checkbox #checkBox (click)="selezionaTutto(checkBox.checked, table)" [(ngModel)]="checked"
                    binary="true"></p-checkbox>
                </th>
                <th *ngFor="let col of columns" [pSortableColumn]="col.field"
                  [pSortableColumnDisabled]="col.field == null">
                  <strong>{{col.header}}</strong>
                  <p-sortIcon [field]="col.field"></p-sortIcon>
                </th>
                <th *ngIf="showColumnDI">
                  <strong>Identificativo Domanda Integrativa</strong>
                </th>
                <th *ngIf="showColumnDI">
                  <strong>Data Ultimo Aggiornamento Domanda Integrativa</strong>
                </th>
                <th> <strong>Selezionate: </strong> <span
                    class="colori-per-numeri">{{checkBox.checked ? this.paginaDomande?.elementiTotali : domande?.length}}</span>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-domanda let-i="rowIndex">
              <tr [pSelectableRow]="domanda">
                <td>
                  <p-tableCheckbox [value]="domanda"></p-tableCheckbox>
                </td>
                <td>{{domanda.infoGeneraliDomanda.cuaaIntestatario}}</td>
                <td>{{domanda.infoGeneraliDomanda.numeroDomanda}}</td>
                <td>{{domanda.infoGeneraliDomanda.ragioneSociale}}</td>
                <td *ngIf="showColumnDI" style="text-align:center">{{domanda.identificativoDI}}</td>
                <td *ngIf="showColumnDI" style="text-align:center">
                  {{domanda.identificativoDI ? (domanda.dataDI | date:'dd-MMM-yyyy') : null}}</td>
                <td *ngIf="showElencoLiquidazione" style="text-align:center">
                  <button type="button" class="btn btn-link"
                      (click)="downloadVerbaleLiquidazione(domanda)">{{domanda.codiceElenco ? domanda.codiceElenco : null}}</button>
                </td>
                <td>
                  <div class="searchbutton">
                    <button pButton type="button" class="btn btn-green"
                      (click)="dettagliClick(domanda)">DETTAGLI</button>
                  </div>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
              <tr>
                <td [attr.colspan]="10">
                  Nessuna domanda trovata
                </td>
              </tr>
            </ng-template>
          </p-table>
          <div class="searchbutton">
            <div *ngIf="this.showButtonVisualizzaDatiAggregati" class="ui-g-3">
              <button pButton type="button" class="ui-button-success" type="submit"
                (click)="openPopupDatiAggregati()">DATI AGGREGATI</button>
            </div>
            <div *ngIf="this.showButtonDownloadDatiCapiAgea" class="ui-g-3">
              <button pButton type="button" class="ui-button-success" type="submit"
                (click)="downloadDatiCapiAgea()">DATI CAPI AGEA</button>
            </div>
            <div *ngIf="this.showNonAmmissibile" class="ui-g-3">
              <button pButton type="button" class="ui-button-success" type="submit"
                (click)="setStatusNonAmmissibile()">NON AMMISSIBILE</button>
            </div>
            <div *ngIf="this.showButtonAvviaCalcolo" class="ui-g-3">
              <button pButton type="button" class="ui-button-success" type="submit"
                (click)="avviaCalcoloPremioAccoppiati()">AVVIA
                CALCOLO PREMIO</button>
            </div>
            <div *ngIf="this.showButtonCalcoloCapi" class="ui-g-3">
              <button pButton type="button" class="ui-button-success" type="submit" (click)="avviaCalcoloCapi()">AVVIA
                CALCOLO CAPI</button>
            </div>
            <div *ngIf="this.showButtonCalcoloCapiControllo" class="ui-g-3">
              <button pButton type="button" class="ui-button-success" type="submit"
                (click)="avviaCalcoloCapiConControllo()">AVVIA CALCOLO CAPI</button>
            </div>
            <div *ngIf="this.showButtonAvviaControlliLiquidazione" class="ui-g-4">
              <button pButton type="button" class="ui-button-success" type="submit"
                (click)="avviaControlliLiquidazione()">AVVIA CONTROLLI LIQUIDAZIONE</button>
            </div>
            <div *ngIf="this.showButtonCreaElencoLiquidazione" class="ui-g-4">
              <button pButton type="button" class="ui-button-success" type="submit"
                (click)="avviaControlloIntersostegnoACS()">CREA ELENCO LIQUIDAZIONE</button>
            </div>
          </div>
        </div>
        <div class="messaggiprocesso boxgrey_bottom">
          <h5>Processi di Controllo</h5>
          <div>
            {{processiInCorso}}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>