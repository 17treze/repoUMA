(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"0alx":function(i,e,t){"use strict";var o=t("VKeD");e.isIterable=function(i){return i&&"function"==typeof i[o.iterator]}},"2KeD":function(i,e,t){"use strict";var o=t("Q1FS"),a=t("zB/H"),n=t("zfKp");e.scheduleObservable=function(i,e){return new o.Observable((function(t){var o=new a.Subscription;return o.add(e.schedule((function(){var a=i[n.observable]();o.add(a.subscribe({next:function(i){o.add(e.schedule((function(){return t.next(i)})))},error:function(i){o.add(e.schedule((function(){return t.error(i)})))},complete:function(){o.add(e.schedule((function(){return t.complete()})))}}))}))),o}))}},"2Ocl":function(i,e,t){"use strict";t.r(e),t.d(e,"UmaModule",(function(){return zs}));var o=t("ofXK"),a=function(i){return i[i.MACCHINE=0]="MACCHINE",i[i.LAVORAZIONI=1]="LAVORAZIONI",i[i.FABBISOGNO=2]="FABBISOGNO",i[i.PROTOCOLLAZIONE=3]="PROTOCOLLAZIONE",i}({}),n=t("EY2u"),r=t("eIep"),s=t("JIr8"),c=t("Tn7N"),l=t("VpP9"),u=t("8X0W"),b=t("xiDf"),h=t("tk/3"),m=t("Pust"),p=t("fXoL");let d=(()=>{class i{constructor(i,e){this.http=i,this.httpClientCore=e,this.CTX_PATH="/richieste"}dichiaraMacchinariDomanda(i,e){return this.http.post(`${this.urlDomanda()}/${i}/macchine`,e)}validaRichiestaCarburante(i){const e=new h.f({"Content-Type":"application/json"});return this.http.post(`${this.urlDomanda()}/${i}/valida`,{headers:e})}getMacchineByIdDomanda(i){return this.http.get(`${this.urlDomanda()}/${i}/macchine`)}urlDomanda(){return this.httpClientCore.HOST+this.httpClientCore.BASE_PATH+this.httpClientCore.API_V1+this.CTX_PATH}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(h.b),p.Xb(m.a))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var g=t("s0xf");let f=(()=>{class i{constructor(){}get READONLY_MODE(){return this._READONLY_MODE}set READONLY_MODE(i){this._READONLY_MODE=i}get READONLY_MODE_DICHIARAZIONE(){return this._READONLY_MODE_DICHIARAZIONE}set READONLY_MODE_DICHIARAZIONE(i){this._READONLY_MODE_DICHIARAZIONE=i}get idFascicolo(){return this._idFascicolo}set idFascicolo(i){this._idFascicolo=i}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var v=t("2Vo4"),S=t("Caez"),C=t("qXBG");let O=(()=>{class i{constructor(i,e){this.indiceUmaService=i,this.authService=e,this._readonlyDomanda$=new v.a(!1),this._fabbisognoDichiarato$=new v.a(null)}updatedDomandaUmaStatus(i){this._readonlyDomanda$.next(i)}updateDichiarazioneFabbisogno(i){this._fabbisognoDichiarato$.next(i)}isInCompilazione(i,e){let t=!1,o=!1;return i.stato===S.a.IN_COMPILAZIONE&&this.authService.userSelectedRole!==C.a.roleIstruttoreUMA&&this.authService.userSelectedRole!==C.a.roleAppag&&this.authService.userSelectedRole!==C.a.roleViewerPAT&&this.authService.userSelectedRole!==C.a.roleAltroEnte?(this.indiceUmaService.READONLY_MODE=!1,t=!this.indiceUmaService.READONLY_MODE,o=!1,e&&e.length&&e.push({label:"Protocollazione"})):(this.indiceUmaService.READONLY_MODE=!0,t=!this.indiceUmaService.READONLY_MODE,o=i.stato!==S.a.IN_COMPILAZIONE),localStorage.setItem("UMA_RO",this.indiceUmaService.READONLY_MODE.toString()),{inCompilazione:t,mostraScarica:o}}getTipoCarburanteDichiarato(i){return{gasolio:i.haMacchineGasolio,benzina:i.haMacchineBenzina}}get readonlyDomanda$(){return this._readonlyDomanda$}get fabbisognoDichiarato$(){return this._fabbisognoDichiarato$}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(f),p.Xb(C.a))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var T=t("N00r"),I=t("JEAp"),z=t("tyNb"),A=t("RtSl"),E=t("arS9"),R=t("3u2U"),D=t("1v+U"),M=t("A1Yd"),N=t("NC7Y");let B=(()=>{class i{constructor(){}fabbisognoDichiaratoBuilder(i){const e=i.filter(i=>i.isUtilizzata);return{benzina:e.some(i=>i.alimentazione===N.a.BENZINA),gasolio:e.some(i=>i.alimentazione===N.a.GASOLIO)}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var y=t("LRne");class _{}var F=t("nqMk");let P=(()=>{class i{constructor(i,e,t){this.http=i,this.httpClientCore=e,this.httpHelperService=t,this.CTX_PATH="/richieste"}getLavorazioni(i,e){const t=null!=e?"?"+this.httpHelperService.buildQueryStringFromObject({ambito:e}):"";return this.http.get(`${this.urlRichiesta()}/${i}/lavorazioni`+t)}getDichiarazioni(i,e){const t=null!=e?"?"+this.httpHelperService.buildQueryStringFromObject({ambito:e}):"";return this.http.get(`${this.urlRichiesta()}/${i}/fabbisogni`+t)}getFabbisogniFabbricati(i,e){const t=null!=e?"?"+this.httpHelperService.buildQueryStringFromObject({ambito:e}):"";return this.http.get(`${this.urlRichiesta()}/${i}/fabbisogni-fabbricati`+t)}saveDomandaUma(i){return this.http.post(`${this.urlRichiesta()}/${i.id}`,i)}updateDomandaUma(i,e){return this.http.put(`${this.urlRichiesta()}/${i}`,e)}saveFabbisogni(i,e){return this.http.post(`${this.urlRichiesta()}/${i}/fabbisogni`,e)}saveFabbisogniFabbricati(i,e){return this.http.post(`${this.urlRichiesta()}/${i}/fabbisogni-fabbricati`,e)}deleteFabbisogniById(i,e){const t=null!=e?"?"+this.httpHelperService.buildQueryStringFromObject({tipiCarburante:e}):"";return this.http.delete(`${this.urlRichiesta()}/${i}/fabbisogni`+t)}getDomandaById(i){return this.http.get(`${this.urlRichiesta()}/${i}`)}urlRichiesta(){return this.httpClientCore.HOST+this.httpClientCore.BASE_PATH+this.httpClientCore.API_V1+this.CTX_PATH}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(h.b),p.Xb(m.a),p.Xb(F.a))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var w=t("yWug"),x=t("KwdP"),L=t("3Pt+");function G(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",4),p.Tb(1,"button",12),p.bc("click",(function(){return p.Ec(i),p.fc().saveMacchine()})),p.Sb(),p.Sb()}}function U(i,e){if(1&i&&p.Ob(0,"p-sortIcon",18),2&i){const i=p.fc().$implicit;p.mc("field",i.field)}}function k(i,e){if(1&i&&(p.Tb(0,"th",16),p.Oc(1),p.Mc(2,U,1,1,"p-sortIcon",17),p.Sb()),2&i){const i=e.$implicit;p.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field)("width",i.width),p.Bb(1),p.Qc(" ",i.header," "),p.Bb(1),p.mc("ngIf",null!=i.field)}}function V(i,e){if(1&i){const i=p.Ub();p.Tb(0,"tr"),p.Mc(1,k,3,5,"th",14),p.Tb(2,"th"),p.Tb(3,"p-inputSwitch",15),p.bc("onChange",(function(){return p.Ec(i),p.fc(2).onClickSelezionaTutto()}))("ngModelChange",(function(e){return p.Ec(i),p.fc(2).isSelectedAll=e})),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=p.fc(2);p.Bb(1),p.mc("ngForOf",i.cols),p.Bb(2),p.mc("disabled",!i.inCompilazione)("ngModel",i.isSelectedAll)}}function H(i,e){1&i&&p.Mc(0,V,4,3,"ng-template",13)}function Z(i,e){if(1&i){const i=p.Ub();p.Tb(0,"tr"),p.Tb(1,"td",19),p.Oc(2),p.Sb(),p.Tb(3,"td",19),p.Oc(4),p.Sb(),p.Tb(5,"td",19),p.Oc(6),p.Sb(),p.Tb(7,"td",19),p.Oc(8),p.Sb(),p.Tb(9,"td",19),p.Oc(10),p.Sb(),p.Tb(11,"td",19),p.Oc(12),p.Sb(),p.Tb(13,"td"),p.Tb(14,"p-inputSwitch",15),p.bc("onChange",(function(){return p.Ec(i),p.fc().setIsSelectedAll()}))("ngModelChange",(function(t){return p.Ec(i),e.$implicit.isUtilizzata=t})),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit,t=p.fc();p.Bb(2),p.Pc(i.descrizione),p.Bb(2),p.Pc(i.classe),p.Bb(2),p.Pc(i.marca),p.Bb(2),p.Pc(i.alimentazione),p.Bb(2),p.Pc(i.targa),p.Bb(2),p.Pc(i.possesso),p.Bb(2),p.mc("disabled",!t.inCompilazione)("ngModel",i.isUtilizzata)}}const j=function(){return{marginTop:"70px"}};let Y=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c){this.confirmationService=i,this.messageService=e,this.dateUtilService=t,this.httpClientMacchineUmaService=o,this.httpClientDomandaUmaService=a,this.httpClientLavorazioniUmaService=n,this.authService=r,this.modelBuilderService=s,this.errorService=c,this.nextStep=new p.n,this.updateRichiesta=new p.n,this.valoriOriginari=[],this.isSelectedAll=!1}ngOnInit(){this.controllaIstruttoreUMA(),this.cols=this.defineTableColumns(),this.macchine=[]}ngOnChanges(i){i&&i.richiestaCarburante&&i.richiestaCarburante.currentValue&&this.getMacchine()}goNextStep(){this.inCompilazione?this.richiestaCarburante.haMacchineBenzina||this.richiestaCarburante.haMacchineGasolio?this.macchine.filter(i=>i.isUtilizzata).length?this.isChangedInputSwitch()?this.confirmationService.confirm({message:g.a.macchineNonSalvate,accept:()=>{this.nextStep.emit(a.MACCHINE)},reject:()=>{},key:"macchine-dialog"}):this.nextStep.emit(a.MACCHINE):this.errorService.showErrorWithMessage(g.a.macchineNotSelezionate,"tst-macchine"):this.errorService.showErrorWithMessage(g.a.macchineNotPresenti,"tst-macchine"):this.nextStep.emit(a.MACCHINE)}ngOnDestroy(){this.macchineSubscription&&this.macchineSubscription.unsubscribe(),this.dichiarazioneMacchineSubscription&&this.dichiarazioneMacchineSubscription.unsubscribe()}saveMacchine(){if(!this.macchine.filter(i=>i.isUtilizzata).length)return void this.errorService.showErrorWithMessage(g.a.macchineNotSelezionate,"tst-macchine");const i=this.modelBuilderService.fabbisognoDichiaratoBuilder(this.macchine);!this.richiestaCarburante.haMacchineBenzina||i.benzina?!this.richiestaCarburante.haMacchineGasolio||i.gasolio?this.saveMacchineAndUpdateRichiesta(!1,!1):this.confirmationService.confirm({message:g.a.macchineGasolioRimosse,accept:()=>{this.saveMacchineAndUpdateRichiesta(!1,!0)},reject:()=>{this.getMacchine()},key:"macchine-dialog"}):this.confirmationService.confirm({message:g.a.macchineBenzinaRimosse,accept:()=>{this.saveMacchineAndUpdateRichiesta(!0,!1)},reject:()=>{this.getMacchine()},key:"macchine-dialog"})}onClickSelezionaTutto(){0==this.isSelectedAll&&this.macchine.forEach(i=>{i.isUtilizzata=!1}),1==this.isSelectedAll&&this.macchine.forEach(i=>{i.isUtilizzata=!0})}saveMacchineAndUpdateRichiesta(i,e){this.dichiarazioneMacchineSubscription=this.httpClientMacchineUmaService.dichiaraMacchinariDomanda(this.richiestaCarburante.id.toString(),this.macchine).pipe(Object(r.a)(t=>{let o;if(i||e){let e=i?[N.a.BENZINA]:[N.a.GASOLIO];o=this.httpClientLavorazioniUmaService.deleteFabbisogniById(this.richiestaCarburante.id.toString(),e)}else o=Object(y.a)({});return o}),Object(s.a)(i=>(this.errorService.showError(i,"tst-macchine"),n.a)),Object(r.a)(()=>this.httpClientDomandaUmaService.getDomandaById(this.richiestaCarburante.id.toString()))).subscribe(i=>{this.messageService.add(c.a.getToast("tst-macchine",c.b.success,g.a.salvataggioOK)),this.initValoriOriginari(),this.richiestaCarburante=i,this.updateRichiesta.emit(i)},i=>this.errorService.showError(i,"tst-macchine"))}getMacchine(){this.macchineSubscription=this.httpClientMacchineUmaService.getMacchineByIdDomanda(this.richiestaCarburante.id.toString()).subscribe(i=>{this.macchine=i,this.setIsSelectedAll(),this.initValoriOriginari()},i=>this.errorService.showError(i,"tst-macchine"))}setIsSelectedAll(){this.isSelectedAll=!(null==this.macchine||this.macchine.length<=0||!this.macchine.every(i=>1==i.isUtilizzata))}isChangedInputSwitch(){let i=0,e=!1;return this.macchine.forEach(t=>{this.valoriOriginari[i]!=t.isUtilizzata&&(e=!0),i+=1}),e}initValoriOriginari(){if(null==this.macchine||!this.macchine.length)return void(this.isSelectedAll=!1);let i=0;this.macchine.forEach(e=>{this.valoriOriginari[i]=e.isUtilizzata,i+=1})}defineTableColumns(){return[{field:null,header:"Macchina",width:"30%"},{field:"classe",header:"Classe",width:"10%"},{field:null,header:"Marca",width:"20%"},{field:"alimentazione",header:"Alimentazione",width:"15%"},{field:null,header:"Targa",width:"10%"},{field:null,header:"Possesso",width:"10%"}]}controllaIstruttoreUMA(){this.authService.userSelectedRole!=C.a.roleIstruttoreUMA&&this.authService.userSelectedRole!=C.a.roleAppag||(this.inCompilazione=!1)}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(A.a),p.Nb(A.d),p.Nb(u.a),p.Nb(d),p.Nb(b.a),p.Nb(P),p.Nb(C.a),p.Nb(B),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-macchine"]],inputs:{inCompilazione:"inCompilazione",richiestaCarburante:"richiestaCarburante",idFascicolo:"idFascicolo"},outputs:{nextStep:"nextStep",updateRichiesta:"updateRichiesta"},features:[p.zb],decls:15,vars:7,consts:[["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","macchine-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["key","tst-macchine"],[1,"p-grid"],[1,"p-grid","w-100"],[1,"p-col"],[1,"p-col-fixed","p-0"],[1,"p-grid","m-0"],["class","p-col",4,"ngIf"],["pButton","","type","button","icon","pi pi-chevron-circle-right","iconPos","right","label","PROCEDI",1,"w-10m",3,"click"],[3,"value","resizableColumns"],[4,"ngIf"],["pTemplate","body"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],["pTemplate","header"],["pResizableColumn","",3,"pSortableColumn","pSortableColumnDisabled","width",4,"ngFor","ngForOf"],[3,"disabled","ngModel","onChange","ngModelChange"],["pResizableColumn","",3,"pSortableColumn","pSortableColumnDisabled","width"],[3,"field",4,"ngIf"],[3,"field"],[1,"ui-resizable-column"]],template:function(i,e){1&i&&(p.Ob(0,"p-confirmDialog",0),p.Ob(1,"p-toast",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Ob(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Mc(7,G,2,0,"div",7),p.Tb(8,"div",4),p.Tb(9,"button",8),p.bc("click",(function(){return e.goNextStep()})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(10,"div",3),p.Tb(11,"div",4),p.Tb(12,"p-table",9),p.Mc(13,H,1,0,void 0,10),p.Mc(14,Z,15,8,"ng-template",11),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Bb(1),p.Kc(p.rc(6,j)),p.Bb(6),p.mc("ngIf",e.inCompilazione),p.Bb(5),p.mc("value",e.macchine)("resizableColumns",!0),p.Bb(1),p.mc("ngIf",null==e.cols?null:e.cols.length))},directives:[R.a,E.a,o.t,M.b,w.q,A.e,o.s,x.a,L.s,L.v,w.j,w.p,w.o],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),i})();var $=function(i){return i.COLTIVAZIONI_SOTTO_SERRA="COLTIVAZIONI_SOTTO_SERRA",i.TRASFORMAZIONE_PRODOTTI="TRASFROMAZIONE_PRODOTTI",i}({}),q=function(i){return i[i.SUPERFICI=0]="SUPERFICI",i[i.ALTRE=1]="ALTRE",i[i.SOTTO_SERRA=2]="SOTTO_SERRA",i[i.TRASFORMAZIONI_PRODOTTI=3]="TRASFORMAZIONI_PRODOTTI",i[i.ZOOTECNIA=4]="ZOOTECNIA",i}({}),Q=t("rgW5"),K=t("w95V"),W=t("LvDl"),J=function(i){return i.SUPERFICIE="SUPERFICIE",i.ZOOTECNIA="ZOOTECNIA",i.FABBRICATI="FABBRICATI",i.ALTRO="ALTRO",i.SERRE="SERRE",i}({}),X=function(i){return i.BASE="BASE",i.STRAORDINARIA="STRAORDINARIA",i.BOVINI_BUFALINI_LATTE_CARNE="BOVINI E BUFALINI DA LATTE/CARNE (OLTRE 6 MESI)",i.VITELLI="VITELLI (FINO A 6 MESI)",i.SUINI_DA_RIPRODUZIONE="SUINI DA RIPRODUZIONE",i.SUINI_DA_INGRASSO="SUINI DA INGRASSO",i.SUINI_A_CICLO_CHIUSO="SUINI A CICLO CHIUSO",i.OVINI_E_CAPRINI="OVINI E CAPRINI",i.AVICOLI_CUNICOLI_STRUZZI="AVICOLI, CUNICOLI E STRUZZI",i.EQUINI_E_UNGULATI="EQUINI E UNGULATI",i.PISCICOLTURA_INTENSIVA="PISCICOLTURA INTENSIVA",i.PISCICOLTURA_ESTENSIVA="PISCICOLTURA ESTENSIVA",i.APICOLTURA="APICOLTURA",i}({}),ii=t("cp0P");let ei=(()=>{class i{constructor(){}decodificaUnitaDiMisura(i){switch(i.toUpperCase()){case"ARNIE":return"Arnie";case"KM":return"Km";case"UBA":return"UBA";case"MC":return"Mc";case"T":return"T";case"CAPO":return"Capo";case"MQ":return"Mq";case"HA":return"Ha";case"CVH":return"CVh";case"QLI":return"Quintali";case"QLI_LATTE":return"Q.li Latte";case"QLI_OLIVE":return"Q.li Olive";case"QLI_ACQUA":return"Q.li Acqua";case"QLI_PRODOTTO":return"Q.li Prodotto";case"NUM":return"Num";case"HL_VINO":return"Hl Vino";case"HL_ACQUA":return"Hl Acqua";default:return i||"Quantita"}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),ti=(()=>{class i{constructor(i){this.converterUnitaDiMisuraService=i}raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(i,e){const t=[];return i&&i.length?(i.forEach(i=>{const o={};o.indice=i.indice,o.nome=i.nome,o.superficieMassima=i.superficieMassima,o.descrizioneCompleta=i.indice+" "+i.nome,o.lavorazioni=this.getLavorazioni(i,e),t.push(o)}),t):t}getLavorazioni(i,e){if(!i.lavorazioni||!i.lavorazioni.length)return[];const t=[];return i.lavorazioni.forEach(o=>{let a={};a.id=o.id,a.indice=o.indice,a.descrizioneCompleta=i.indice+"."+o.indice+" "+o.nome,a.unitaDiMisura=this.converterUnitaDiMisuraService.decodificaUnitaDiMisura(o.unitaDiMisura),a.tipo=o.tipologia,a.superficieMassima=i.superficieMassima,a=this.addFabbisogniToLavorazioni(e,o,a),t.push(a)}),t}addFabbisogniToLavorazioni(i,e,t){if(!i||!i.length)return t;const o=i.filter(i=>e.id==i.lavorazioneId);if(o&&o.length){const i=o[0].fabbisogni;i&&i.length&&i.forEach(i=>{const e=i.quantita.toString().replace(".",",");t[i.carburante]=e})}return t}lavorazioniViewModelToDichiarazioniDtoBuilder(i){const e=[];return i.filter(i=>null!=i[N.a.GASOLIO]||null!=i[N.a.BENZINA]).forEach(i=>{const t={fabbisogni:[]};t.lavorazioneId=i.id,null!=i[N.a.GASOLIO]&&t.fabbisogni.push(this.buildFabbisogno(i[N.a.GASOLIO],N.a.GASOLIO)),null!=i[N.a.BENZINA]&&t.fabbisogni.push(this.buildFabbisogno(i[N.a.BENZINA],N.a.BENZINA)),t.fabbisogni&&t.fabbisogni.length&&e.push(t)}),e}buildFabbisogno(i,e){return{quantita:i.toString().replace(",","."),carburante:e}}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(ei))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var oi=t("yhG/"),ai=t("V6/s"),ni=t("sYmb");const ri=["accordion"];function si(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",13),p.Tb(1,"button",14),p.bc("click",(function(){return p.Ec(i),p.fc().saveLavorazioni()})),p.Sb(),p.Sb()}}function ci(i,e){1&i&&p.Ob(0,"i",23)}function li(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-a4g-multi-table",24),p.bc("clickIcon",(function(e){return p.Ec(i),p.fc(3).onClickIcon(e)}))("changedValueForm",(function(e){return p.Ec(i),p.fc(3).onChangeForm(e)})),p.Sb()}if(2&i){const i=p.fc(3);p.mc("title",i.nomeRaggruppamento)("cols",i.colsBase)("values",i.datasourceBase)("readonly",!i.inCompilazione)}}function ui(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-a4g-multi-table",25),p.bc("clickIcon",(function(e){return p.Ec(i),p.fc(3).onClickIcon(e)}))("changedValueForm",(function(e){return p.Ec(i),p.fc(3).onChangeForm(e)})),p.Sb()}if(2&i){const i=p.fc(3);p.mc("cols",i.colsStraordinaria)("values",i.datasourceStraordinaria)("readonly",!i.inCompilazione)}}function bi(i,e){if(1&i&&(p.Rb(0),p.Tb(1,"p-accordionTab"),p.Tb(2,"p-header"),p.Oc(3),p.gc(4,"uppercase"),p.Mc(5,ci,1,0,"i",18),p.Sb(),p.Tb(6,"div",19),p.Mc(7,li,1,4,"app-a4g-multi-table",20),p.Ob(8,"div",21),p.Mc(9,ui,1,3,"app-a4g-multi-table",22),p.Sb(),p.Sb(),p.Qb()),2&i){const i=e.$implicit,t=e.index,o=p.fc(2);p.Bb(3),p.Rc(" ",i.indice," ",p.hc(4,5,i.nome)," "),p.Bb(2),p.mc("ngIf",o.quantitaLavorata[t]>0),p.Bb(2),p.mc("ngIf",null==o.datasourceBase?null:o.datasourceBase.length),p.Bb(2),p.mc("ngIf",null==o.datasourceStraordinaria?null:o.datasourceStraordinaria.length)}}function hi(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",3),p.Tb(1,"p-accordion",15,16),p.bc("onOpen",(function(e){return p.Ec(i),p.fc().onSelectAccordion(e)})),p.Mc(3,bi,10,7,"ng-container",17),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(3),p.mc("ngForOf",i.raggruppamenti)}}const mi=function(){return{marginTop:"70px"}};let pi=(()=>{class i{constructor(i,e,t,o,a,n,r,s){this.activeRoute=i,this.messageService=e,this.confirmationService=t,this.gestioneDomandaUmaService=o,this.httpClientLavorazioniUmaService=a,this.location=n,this.lavorazioniBuiderService=r,this.errorService=s,this.changeFabbisogno=new p.n,this.quantitaLavorata=[],this.ambitoLavorazioneEnum=J}ngOnInit(){this.raggruppamentoForm=new L.j({raggruppamento:new L.g}),this.initVariables(),this.loadRaggruppamenti()}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveFabbisognoSubscription&&this.saveFabbisognoSubscription.unsubscribe()}loadRaggruppamenti(){this.routerSubscription=this.activeRoute.params.pipe(Object(s.a)(this.errorService.handleError),Object(r.a)(i=>{this.idDomanda=i.idDomanda;const e=this.httpClientLavorazioniUmaService.getLavorazioni(this.idDomanda,this.ambitoLavorazioneEnum.SUPERFICIE),t=this.httpClientLavorazioniUmaService.getDichiarazioni(this.idDomanda,this.ambitoLavorazioneEnum.SUPERFICIE);return Object(ii.a)([e,t])})).subscribe(([i,e])=>{this.raggruppamenti=this.lavorazioniBuiderService.raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(i,e),this.raggruppamenti=W.orderBy(this.raggruppamenti,["indice"],["asc"]),this.calcolaQuantita()},i=>this.errorService.showError(i,"tst-lav-sup"))}calcolaQuantita(){this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((i,e)=>{this.quantitaLavorata[e]=0,i.lavorazioni.forEach(i=>{const t=isNaN(Number(i.BENZINA))?0:Number(i.BENZINA),o=isNaN(Number(i.GASOLIO))?0:Number(i.GASOLIO);this.quantitaLavorata[e]=this.quantitaLavorata[e]+t+o})})}initVariables(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.nomeRaggruppamento=null,this.isValidFormTable=!0,this.datasourceBase=[],this.datasourceStraordinaria=[],this.colsBase=this.defineColumnsByTitle("Lavorazioni Base"),this.colsStraordinaria=this.defineColumnsByTitle("Lavorazioni Straordinarie"),this.raggruppamentoForm.controls.raggruppamento.setValue(null)}goBack(){this.isChangedInputTable?this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.location.back()},reject:()=>{},key:"lavorazioni-dialog"}):this.location.back()}onSelectAccordion(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.onChangeRaggruppamento(i)))}openAccordionByIndex(i){this.accordion.tabs.forEach((e,t)=>{e.selected=t==i})}onChangeRaggruppamento(i){const e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable)}onChangeForm(i){this.isChangedInputTable=i.isChanged,this.changeFabbisogno.emit(this.isChangedInputTable),this.isValidFormTable=i.isValid}saveLavorazioni(){if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(g.a.raggruppamentiNotSelezionati,"tst-lav-sup"),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(g.a.datiNonValidi,"tst-lav-sup"),!1;const i=this.raggruppamentoForm.get("raggruppamento").value,e=this.lavorazioniBuiderService.lavorazioniViewModelToDichiarazioniDtoBuilder(i.lavorazioni);return console.log("Salvo dichiarazioni: ",e),this.saveFabbisognoSubscription=this.httpClientLavorazioniUmaService.saveFabbisogni(this.idDomanda,e).subscribe(()=>{this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable),this.messageService.add(c.a.getToast("tst-lav-sup",c.b.success,g.a.salvataggioOKLavorazioniSuperficie)),this.loadRaggruppamenti()},i=>this.errorService.showError(i,"tst-lav-sup")),!0}splitDatasources(i){const e=[],t=[];i.forEach(i=>{i.tipo===X.BASE?t.push(i):e.push(i)}),this.datasourceBase=W.sortBy(t,["indice"]),this.datasourceStraordinaria=W.sortBy(e,["indice"])}onClickIcon(i){i.col.field!==N.a.GASOLIO&&i.col.field!==N.a.BENZINA||this.updateTable(i.element,i.col)}updateTable(i,e){let t=this.datasourceBase.filter(e=>e.id===i.id)[0];null==t&&(t=this.datasourceStraordinaria.filter(e=>e.id===i.id)[0]);const o=e.field===N.a.GASOLIO?N.a.BENZINA:N.a.GASOLIO;t[e.field]=t[e.field]!=t.superficieMassima?i.superficieMassima:"",t[o]=""}showDialog(i){this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.openedAccordion=i.index,this.onChangeRaggruppamento(i),this.openAccordionByIndex(this.openedAccordion)},reject:()=>{this.openAccordionByIndex(this.openedAccordion)},key:"lavorazioni-dialog"})}defineColumnsByTitle(i){return[{field:"descrizioneCompleta",header:i,sortable:!1,font:K.e.BOLD,width:"46%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"superficieMassima",suffix:"unitaDiMisura",header:"Superficie massima",sortable:!1,width:"16%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:N.a.GASOLIO,suffix:"unitaDiMisura",header:"Sup. gasolio",sortable:!1,disabled:null!=this.fabbisognoDichiarato&&!this.fabbisognoDichiarato.gasolio,inputOpts:{pattern:"^([0-9])+$",maxLength:"7",upperLimitField:"superficieMassima"},icon:"pi pi-chevron-circle-right",width:"19%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER},{field:N.a.BENZINA,suffix:"unitaDiMisura",header:"Sup. benzina",sortable:!1,disabled:null!=this.fabbisognoDichiarato&&!this.fabbisognoDichiarato.benzina,inputOpts:{pattern:"^([0-9])+$",maxLength:"7",upperLimitField:"superficieMassima"},icon:"pi pi-chevron-circle-right",width:"19%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(z.a),p.Nb(A.d),p.Nb(A.a),p.Nb(O),p.Nb(P),p.Nb(o.n),p.Nb(ti),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-lavorazioni-superficie"]],viewQuery:function(i,e){var t;1&i&&p.Uc(ri,!0),2&i&&p.Ac(t=p.cc())&&(e.accordion=t.first)},inputs:{inCompilazione:"inCompilazione",richiestaCarburante:"richiestaCarburante"},outputs:{changeFabbisogno:"changeFabbisogno"},decls:16,vars:9,consts:[["key","tst-lav-sup"],[1,"p-grid","ui-fluid"],["novalidate","",1,"p-grid","m-0","w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid"],[1,"p-grid","p-align-center","py-4","w-100"],[1,"p-grid","m-0","p-align-center","color-primary"],["src","assets/img/icons/uma-icon/icon-superficie_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed",4,"ngIf"],[1,"p-grid","w-100"],["class","p-col",4,"ngIf"],[1,"p-col-fixed"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[1,"p-col-12","align-self-center","w-100"],[3,"title","cols","values","readonly","clickIcon","changedValueForm",4,"ngIf"],[1,"mb-1"],[3,"cols","values","readonly","clickIcon","changedValueForm",4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","values","readonly","clickIcon","changedValueForm"],[3,"cols","values","readonly","clickIcon","changedValueForm"]],template:function(i,e){1&i&&(p.Ob(0,"p-toast",0),p.Tb(1,"div",1),p.Tb(2,"form",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",3),p.Tb(7,"div",6),p.Ob(8,"img",7),p.Tb(9,"span",8),p.Tb(10,"strong",9),p.Oc(11),p.gc(12,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Mc(13,si,2,0,"div",10),p.Sb(),p.Tb(14,"div",11),p.Mc(15,hi,4,1,"div",12),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Kc(p.rc(8,mi)),p.Bb(2),p.mc("formGroup",e.raggruppamentoForm),p.Bb(9),p.Qc(" ",p.hc(12,6,"UMA.LAVORAZIONI_SUPERFICIE")," / Raggruppamenti"),p.Bb(2),p.mc("ngIf",e.inCompilazione),p.Bb(2),p.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[E.a,L.I,L.t,L.k,o.t,M.b,oi.a,o.s,oi.c,A.c,ai.a],pipes:[ni.d,o.G],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}"]}),i})();const di=["accordion"];function gi(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",13),p.Tb(1,"button",14),p.bc("click",(function(){return p.Ec(i),p.fc().saveLavorazioni()})),p.Sb(),p.Sb()}}function fi(i,e){1&i&&p.Ob(0,"i",19)}function vi(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div"),p.Tb(1,"app-a4g-multi-table",20),p.bc("changedValueForm",(function(e){return p.Ec(i),p.fc(3).onChangeForm(e)})),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit,t=e.index,o=p.fc(3);p.Bb(1),p.mc("title",i.title)("cols",o.colsArray[t])("values",i.datasource)("readonly",!o.inCompilazione)}}function Si(i,e){if(1&i&&(p.Rb(0),p.Tb(1,"p-accordionTab"),p.Tb(2,"p-header"),p.Oc(3),p.Mc(4,fi,1,0,"i",18),p.Sb(),p.Mc(5,vi,2,4,"div",17),p.Sb(),p.Qb()),2&i){const i=e.$implicit,t=e.index,o=p.fc(2);p.Bb(3),p.Rc(" ",i.indice," ",i.nome," "),p.Bb(1),p.mc("ngIf",o.quantitaLavorata[t]>0),p.Bb(1),p.mc("ngForOf",o.tables)}}function Ci(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",3),p.Tb(1,"p-accordion",15,16),p.bc("onOpen",(function(e){return p.Ec(i),p.fc().onSelectAccordion(e)})),p.Mc(3,Si,6,4,"ng-container",17),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(3),p.mc("ngForOf",i.raggruppamenti)}}const Oi=function(){return{marginTop:"70px"}};let Ti=(()=>{class i{constructor(i,e,t,o,a,n,r,s){this.activeRoute=i,this.gestioneDomandaUmaService=e,this.httpClientLavorazioniUmaService=t,this.confirmationService=o,this.messageService=a,this.location=n,this.lavorazioniBuiderService=r,this.errorService=s,this.changeFabbisogno=new p.n,this.ambitoLavorazioneEnum=J}ngOnInit(){this.raggruppamentoForm=new L.j({raggruppamento:new L.g}),this.initVariables(),this.loadRaggruppamenti()}calcolaQuantita(){this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((i,e)=>{this.quantitaLavorata[e]=0,i.lavorazioni.forEach(i=>{const t=isNaN(Number(i.BENZINA))?0:Number(i.BENZINA),o=isNaN(Number(i.GASOLIO))?0:Number(i.GASOLIO);this.quantitaLavorata[e]=this.quantitaLavorata[e]+t+o})})}loadRaggruppamenti(){this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>{this.idDomanda=i.idDomanda;const e=this.httpClientLavorazioniUmaService.getLavorazioni(this.idDomanda,this.ambitoLavorazioneEnum.ALTRO),t=this.httpClientLavorazioniUmaService.getDichiarazioni(this.idDomanda,this.ambitoLavorazioneEnum.ALTRO);return Object(ii.a)([e,t])}),Object(s.a)(i=>(this.errorService.showError(i,"tst-lav-altre"),n.a))).subscribe(([i,e])=>{this.raggruppamenti=this.lavorazioniBuiderService.raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(i,e),this.raggruppamenti=W.orderBy(this.raggruppamenti,["indice"],["asc"]),this.calcolaQuantita()},i=>this.errorService.showError(i,"tst-lav-altre"))}initVariables(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.nomeRaggruppamento=null,this.isValidFormTable=!0,this.colsArray=[],this.tables=[],this.datasources=[],this.quantitaLavorata=[],this.raggruppamentoForm.controls.raggruppamento.setValue(null)}onSelectAccordion(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.onChangeRaggruppamento(i)))}openAccordionByIndex(i){this.accordion.tabs.forEach((e,t)=>{e.selected=t==i})}onChangeRaggruppamento(i){const e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable)}onChangeForm(i){this.isChangedInputTable=i.isChanged,this.changeFabbisogno.emit(this.isChangedInputTable),this.isValidFormTable=i.isValid}goBack(){this.isChangedInputTable?this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.location.back()},reject:()=>{},key:"lavorazioni-dialog"}):this.location.back()}saveLavorazioni(){if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(g.a.raggruppamentiNotSelezionati,"tst-lav-altre"),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(g.a.datiNonValidi,"tst-lav-altre"),!1;const i=this.raggruppamentoForm.get("raggruppamento").value,e=this.lavorazioniBuiderService.lavorazioniViewModelToDichiarazioniDtoBuilder(i.lavorazioni);return this.saveFabbisogniSubscription=this.httpClientLavorazioniUmaService.saveFabbisogni(this.idDomanda,e).subscribe(()=>{this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable),this.messageService.add(c.a.getToast("tst-lav-altre",c.b.success,g.a.salvataggioOKLavorazioniSuperficie)),this.loadRaggruppamenti()},i=>this.errorService.showError(i,"tst-lav-altre")),!0}splitDatasources(i){const e=W.groupBy(i,"tipo");this.tables=[],this.colsArray=[],this.datasources=[],Object.keys(e).forEach(i=>{let t=new K.a;0==this.tables.length&&(t.title=this.nomeRaggruppamento);let o=this.defineColumnsByTitle(X[i]);this.colsArray.push(o),t.datasource=e[i],this.datasources.push(t.datasource),this.tables.push(t)})}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveFabbisogniSubscription&&this.saveFabbisogniSubscription.unsubscribe()}showDialog(i){this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.openedAccordion=i.index,this.onChangeRaggruppamento(i),this.openAccordionByIndex(this.openedAccordion)},reject:()=>{this.openAccordionByIndex(this.openedAccordion)},key:"lavorazioni-dialog"})}defineColumnsByTitle(i){return[{field:"descrizioneCompleta",header:"STRAORDINARIA"===i?"Lavorazioni Straordinarie":"Lavorazioni Base",sortable:!1,font:K.e.BOLD,width:"80%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:N.a.GASOLIO,suffix:"unitaDiMisura",header:"Gasolio",sortable:!1,disabled:null!=this.fabbisognoDichiarato&&!this.fabbisognoDichiarato.gasolio,inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},width:"20%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER},{field:N.a.BENZINA,suffix:"unitaDiMisura",header:"Benzina",sortable:!1,disabled:null!=this.fabbisognoDichiarato&&!this.fabbisognoDichiarato.benzina,inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},width:"20%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(z.a),p.Nb(O),p.Nb(P),p.Nb(A.a),p.Nb(A.d),p.Nb(o.n),p.Nb(ti),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-lavorazioni-altre"]],viewQuery:function(i,e){var t;1&i&&p.Uc(di,!0),2&i&&p.Ac(t=p.cc())&&(e.accordion=t.first)},inputs:{inCompilazione:"inCompilazione",richiestaCarburante:"richiestaCarburante"},outputs:{changeFabbisogno:"changeFabbisogno"},decls:16,vars:9,consts:[["key","tst-lav-altre"],[1,"p-grid","ui-fluid"],["novalidate","",1,"p-grid","m-0","w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid"],[1,"p-grid","p-align-center","py-4","w-100"],[1,"p-grid","m-0","p-align-center","color-primary"],["src","assets/img/icons/uma-icon/icon-altre_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed",4,"ngIf"],[1,"p-grid","w-100"],["class","p-col",4,"ngIf"],[1,"p-col-fixed"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","values","readonly","changedValueForm"]],template:function(i,e){1&i&&(p.Ob(0,"p-toast",0),p.Tb(1,"div",1),p.Tb(2,"form",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",3),p.Tb(7,"div",6),p.Ob(8,"img",7),p.Tb(9,"span",8),p.Tb(10,"strong",9),p.Oc(11),p.gc(12,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Mc(13,gi,2,0,"div",10),p.Sb(),p.Tb(14,"div",11),p.Mc(15,Ci,4,1,"div",12),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Kc(p.rc(8,Oi)),p.Bb(2),p.mc("formGroup",e.raggruppamentoForm),p.Bb(9),p.Qc("",p.hc(12,6,"UMA.LAVORAZIONI_ALTRE")," / Raggruppamenti"),p.Bb(2),p.mc("ngIf",e.inCompilazione),p.Bb(2),p.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[E.a,L.I,L.t,L.k,o.t,M.b,oi.a,o.s,oi.c,A.c,ai.a],pipes:[ni.d],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}"]}),i})();var Ii=t("Q1Ke");let zi=(()=>{class i{constructor(i,e){this.converterUnitaDiMisuraService=i,this.formatConverterService=e}fabbricatiDtoToRaggruppamentiLavorazioneViewModel(i,e){const t=[];return i&&i.length?(i.forEach(i=>{const o={};o.indice=i.indice,o.nome=i.nome,o.descrizioneCompleta=i.indice+" "+i.nome;const a=this.getLavorazioniFromFabbricati(i);o.lavorazioni=this.addFabbisogniToFabbricati(this.replicaLavorazioni(a,i.fabbricati),e),t.push(o)}),t):t}replicaLavorazioni(i,e){if(!e||!e.length)return i;const t=[];return i.forEach(i=>{e.forEach(e=>{const o=Object.assign({},i);o.comuneProvincia=e.comune+"("+e.siglaProvincia+")",o.idFabbricato=e.id,o.particella=e.particella,o.subalterno=e.subalterno,o.volume=e.volume.toString(),t.push(o)})}),t}getLavorazioniFromFabbricati(i){if(!i.lavorazioni||!i.lavorazioni.length)return[];const e=[];return i.lavorazioni.forEach(t=>{const o={};o.id=t.id,o.indice=t.indice,o.descrizioneCompleta=i.indice+"."+t.indice+" "+t.nome,o.unitaDiMisura=this.converterUnitaDiMisuraService.decodificaUnitaDiMisura(t.unitaDiMisura),o.tipo=t.tipologia,o.superficieMassima=i.superficieMassima,e.push(o)}),e}addFabbisogniToFabbricati(i,e){return e&&e.length?(e.forEach(e=>{e.dichiarazioni&&e.dichiarazioni.length&&i.forEach(i=>{e.idFabbricato==i.idFabbricato&&e.dichiarazioni.forEach(e=>{e.lavorazioneId==i.id&&e.fabbisogni.forEach(e=>{const t=e.quantita.toString().replace(".",",");i[e.carburante]=t;const o=this.formatConverterService.toNumber(t),a=this.formatConverterService.toNumber(i.volume);i.mesi=o>0&&a>0&&this.formatConverterService.isMultipleBy(o,a)?o/a:null})})})}),i):i}lavorazioniViewModelToDichiarazioniFabbricatoDtoBuilder(i){const e=[];return i.filter(i=>null!=i[N.a.GASOLIO]).forEach(i=>{let t,o;const a=e.filter(e=>e.idFabbricato==i.idFabbricato);a.length?t=a[0]:(t={},t.idFabbricato=i.idFabbricato,t.dichiarazioni=[]);const n=t.dichiarazioni.filter(e=>e.lavorazioneId==i.id);n.length?o=n[0]:(o={},o.lavorazioneId=i.id,o.fabbisogni=[]),o.fabbisogni.push(this.buildFabbisogno(i[N.a.GASOLIO],N.a.GASOLIO)),t.dichiarazioni.push(o),t.dichiarazioni&&t.dichiarazioni.length&&(a.length||e.push(t))}),e}buildFabbisogno(i,e){return{quantita:i.toString().replace(",","."),carburante:e}}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(ei),p.Xb(Ii.a))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Ai=["accordion"];function Ei(i,e){1&i&&p.Ob(0,"img",14)}function Ri(i,e){1&i&&p.Ob(0,"img",15)}function Di(i,e){1&i&&(p.Tb(0,"strong",16),p.Oc(1),p.gc(2,"translate"),p.Sb()),2&i&&(p.Bb(1),p.Qc("",p.hc(2,1,"UMA.LAVORAZIONI_COLTIVAZIONI_SOTTO_SERRA")," / Raggruppamenti"))}function Mi(i,e){1&i&&(p.Tb(0,"strong",16),p.Oc(1),p.gc(2,"translate"),p.Sb()),2&i&&(p.Bb(1),p.Qc("",p.hc(2,1,"UMA.LAVORAZIONI_TRASFORMAZIONI_PRODOTTI")," / Raggruppamenti"))}function Ni(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",17),p.Tb(1,"button",18),p.bc("click",(function(){return p.Ec(i),p.fc().saveLavorazioni()})),p.Sb(),p.Sb()}}function Bi(i,e){1&i&&p.Ob(0,"i",25)}function yi(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div"),p.Tb(1,"app-a4g-multi-table",26),p.bc("changedValueForm",(function(e){return p.Ec(i),p.fc(4).onChangeForm(e)})),p.Sb(),p.Ob(2,"div",27),p.Sb()}if(2&i){const i=e.$implicit,t=e.index,o=p.fc(4);p.Bb(1),p.mc("title",i.title)("cols",o.colsArray[t])("header",o.headersTable[t])("values",i.datasource)("readonly",!o.inCompilazione)}}function _i(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,yi,3,5,"div",21),p.Sb()),2&i){const i=p.fc(3);p.Bb(1),p.mc("ngForOf",i.tables)}}function Fi(i,e){if(1&i&&(p.Rb(0),p.Tb(1,"p-accordionTab"),p.Tb(2,"p-header"),p.Oc(3),p.gc(4,"uppercase"),p.Mc(5,Bi,1,0,"i",22),p.Sb(),p.Tb(6,"div",23),p.Mc(7,_i,2,1,"div",24),p.Sb(),p.Sb(),p.Qb()),2&i){const i=e.$implicit,t=e.index,o=p.fc(2);p.Bb(3),p.Rc(" ",i.indice," ",p.hc(4,4,i.nome)," "),p.Bb(2),p.mc("ngIf",o.quantitaLavorata[t]>0),p.Bb(2),p.mc("ngIf",null==o.tables?null:o.tables.length)}}function Pi(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",3),p.Tb(1,"p-accordion",19,20),p.bc("onOpen",(function(e){return p.Ec(i),p.fc().onSelectAccordion(e)})),p.Mc(3,Fi,8,6,"ng-container",21),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(3),p.mc("ngForOf",i.raggruppamenti)}}const wi=function(){return{marginTop:"70px"}};let xi=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c){this.activeRoute=i,this.gestioneDomandaUmaService=e,this.httpClientLavorazioniUmaService=t,this.confirmationService=o,this.messageService=a,this.location=n,this.lavorazioneFabbricatiBuiderService=r,this.errorService=s,this.formatConverterService=c,this.changeFabbisogno=new p.n,this.ambitoLavorazioneEnum=J,this.lavorazioniFabbricatiTipoEnum=$}ngOnInit(){this.raggruppamentoForm=new L.j({raggruppamento:new L.g}),this.initVariables(),this.loadRaggruppamenti()}initVariables(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.nomeRaggruppamento=null,this.isValidFormTable=!0,this.colsArray=[],this.tables=[],this.datasources=[],this.quantitaLavorata=[],this.headersTable=[],this.raggruppamentoForm.controls.raggruppamento.setValue(null)}onSelectAccordion(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.onChangeRaggruppamento(i)))}openAccordionByIndex(i){this.accordion.tabs.forEach((e,t)=>{e.selected=t==i})}onChangeForm(i){this.isChangedInputTable=i.isChanged,this.changeFabbisogno.emit(this.isChangedInputTable),this.isValidFormTable=i.isValid,i&&i.action&&i.action.type&&"MULTIPLY_BY"===i.action.type&&this.tables.forEach((e,t)=>{t===i.action.index&&e.datasource.forEach(i=>{i.GASOLIO=(this.formatConverterService.toNumber(i.volume)*this.formatConverterService.toNumber(i.mesi)).toString(),i.BENZINA=(this.formatConverterService.toNumber(i.volume)*this.formatConverterService.toNumber(i.mesi)).toString()})})}goBack(){this.isChangedInputTable?this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.location.back()},reject:()=>{},key:"lavorazioni-dialog"}):this.location.back()}saveLavorazioni(){if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(g.a.raggruppamentiNotSelezionati,"tst-lav-fab"),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(g.a.datiNonValidi,"tst-lav-fab"),!1;const i=this.raggruppamentoForm.get("raggruppamento").value,e=this.lavorazioneFabbricatiBuiderService.lavorazioniViewModelToDichiarazioniFabbricatoDtoBuilder(i.lavorazioni);return console.log("Salvo dichiarazioni: ",e),this.saveFabbisognoSubscription=this.httpClientLavorazioniUmaService.saveFabbisogniFabbricati(this.idDomanda,e).subscribe(()=>{this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable),this.messageService.add(c.a.getToast("tst-lav-fab",c.b.success,g.a.salvataggioOKLavorazioniSuperficie)),this.loadRaggruppamenti()},i=>this.errorService.showError(i,"tst-lav-fab")),!0}loadRaggruppamenti(){this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>{this.idDomanda=i.idDomanda;const e=this.ctx===$.COLTIVAZIONI_SOTTO_SERRA?this.ambitoLavorazioneEnum.SERRE:this.ambitoLavorazioneEnum.FABBRICATI,t=this.httpClientLavorazioniUmaService.getLavorazioni(this.idDomanda,e),o=this.httpClientLavorazioniUmaService.getFabbisogniFabbricati(this.idDomanda,e);return Object(ii.a)([t,o])})).subscribe(([i,e])=>{this.raggruppamenti=this.lavorazioneFabbricatiBuiderService.fabbricatiDtoToRaggruppamentiLavorazioneViewModel(i,e),this.raggruppamenti=W.orderBy(this.raggruppamenti,["indice"],["asc"]),this.calcolaQuantita()},i=>this.errorService.showError(i,"tst-lav-fab"))}showDialog(i){this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.openedAccordion=i.index,this.onChangeRaggruppamento(i),this.openAccordionByIndex(this.openedAccordion)},reject:()=>{this.openAccordionByIndex(this.openedAccordion)},key:"lavorazioni-dialog"})}onChangeRaggruppamento(i){const e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.tables=[],this.colsArray=[],this.datasources=[],this.headersTable=[],this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable)}calcolaQuantita(){this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((i,e)=>{this.quantitaLavorata[e]=0,i.lavorazioni.forEach(i=>{const t=this.formatConverterService.toNumber(i.BENZINA),o=this.formatConverterService.toNumber(i.GASOLIO);this.quantitaLavorata[e]=this.quantitaLavorata[e]+t+o})})}splitDatasources(i){if(!i||!i.length)return;const e=W.groupBy(i,"idFabbricato");Object.keys(e).forEach((i,t)=>{const o=e[i],a=new K.a;this.headersTable.push(this.defineHeader(o)),a.title=this.tables.length?"":this.nomeRaggruppamento;const n=this.ctx===$.COLTIVAZIONI_SOTTO_SERRA?this.defineColumnsSottoSerraByTitle(o[0].tipo,t,"Quantit\xe0"):this.defineColumnsFabbricatiByTitle(o[0].tipo);this.colsArray.push(n),a.datasource=o,this.datasources.push(...a.datasource),this.tables.push(a)})}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveFabbisognoSubscription&&this.saveFabbisognoSubscription.unsubscribe()}defineHeader(i){if(i&&i.length)return[{key:"Comune",value:i[0].comuneProvincia},{key:"Particella",value:this.buildParticella(i[0])},{key:"Volume mc",value:i[0].volume||""}]}buildParticella(i){let e;return this.formatConverterService.isEmptyString(i.subalterno)||(e="("+i.subalterno+")"),e?i.particella+e:i.particella}defineColumnsFabbricatiByTitle(i,e="Quantit\xe0"){return[{field:"descrizioneCompleta",header:i,sortable:!1,font:K.e.BOLD,width:"80%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:N.a.GASOLIO,suffix:"unitaDiMisura",header:e,sortable:!1,disabled:!1,inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},width:"20%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER}]}defineColumnsSottoSerraByTitle(i,e,t="Quantit\xe0"){return[{field:"descrizioneCompleta",header:i,sortable:!1,font:K.e.BOLD,width:"60%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"mesi",header:"Mesi",sortable:!1,disabled:!1,inputOpts:{pattern:"^([0-9])+$",maxLength:"1",max:6,action:{type:K.b.MULTIPLY_BY,byField:this.quantitaLavorata,index:e}},width:"20%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER_ACTION},{field:N.a.GASOLIO,suffix:"unitaDiMisura",header:t,sortable:!1,disabled:!0,inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},width:"20%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(z.a),p.Nb(O),p.Nb(P),p.Nb(A.a),p.Nb(A.d),p.Nb(o.n),p.Nb(zi),p.Nb(T.a),p.Nb(Ii.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-lavorazioni-fabbricati"]],viewQuery:function(i,e){var t;1&i&&p.Uc(Ai,!0),2&i&&p.Ac(t=p.cc())&&(e.accordion=t.first)},inputs:{inCompilazione:"inCompilazione",ctx:"ctx",richiestaCarburante:"richiestaCarburante"},outputs:{changeFabbisogno:"changeFabbisogno"},decls:16,vars:10,consts:[["key","tst-lav-fab"],[1,"p-grid","ui-fluid"],["novalidate","",1,"p-grid","m-0","w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid"],[1,"p-grid","p-align-center","py-4","w-100"],[1,"p-grid","m-0","p-align-center","color-primary"],["src","assets/img/icons/uma-icon/icon-fabbricati_black.svg",4,"ngIf"],["src","assets/img/icons/uma-icon/icon-farm_black.svg",4,"ngIf"],[1,"ml-2"],["class","fs-20",4,"ngIf"],["class","p-col-fixed",4,"ngIf"],[1,"p-grid","w-100"],["class","p-col",4,"ngIf"],["src","assets/img/icons/uma-icon/icon-fabbricati_black.svg"],["src","assets/img/icons/uma-icon/icon-farm_black.svg"],[1,"fs-20"],[1,"p-col-fixed"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[1,"p-col-12","align-self-center","w-100"],[4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","header","values","readonly","changedValueForm"],[1,"mb-1"]],template:function(i,e){1&i&&(p.Ob(0,"p-toast",0),p.Tb(1,"div",1),p.Tb(2,"form",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",3),p.Tb(7,"div",6),p.Mc(8,Ei,1,0,"img",7),p.Mc(9,Ri,1,0,"img",8),p.Tb(10,"span",9),p.Mc(11,Di,3,3,"strong",10),p.Mc(12,Mi,3,3,"strong",10),p.Sb(),p.Sb(),p.Sb(),p.Mc(13,Ni,2,0,"div",11),p.Sb(),p.Tb(14,"div",12),p.Mc(15,Pi,4,1,"div",13),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Kc(p.rc(9,wi)),p.Bb(2),p.mc("formGroup",e.raggruppamentoForm),p.Bb(6),p.mc("ngIf",e.ctx==e.lavorazioniFabbricatiTipoEnum.COLTIVAZIONI_SOTTO_SERRA),p.Bb(1),p.mc("ngIf",e.ctx==e.lavorazioniFabbricatiTipoEnum.TRASFORMAZIONE_PRODOTTI),p.Bb(2),p.mc("ngIf",e.ctx==e.lavorazioniFabbricatiTipoEnum.COLTIVAZIONI_SOTTO_SERRA),p.Bb(1),p.mc("ngIf",e.ctx==e.lavorazioniFabbricatiTipoEnum.TRASFORMAZIONE_PRODOTTI),p.Bb(1),p.mc("ngIf",e.inCompilazione),p.Bb(2),p.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[E.a,L.I,L.t,L.k,o.t,M.b,oi.a,o.s,oi.c,A.c,ai.a],pipes:[ni.d,o.G],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}"]}),i})();const Li=["accordion"];function Gi(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",13),p.Tb(1,"button",14),p.bc("click",(function(){return p.Ec(i),p.fc().saveLavorazioni()})),p.Sb(),p.Sb()}}function Ui(i,e){1&i&&p.Ob(0,"i",19)}function ki(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div"),p.Tb(1,"app-a4g-multi-table",20),p.bc("changedValueForm",(function(e){return p.Ec(i),p.fc(3).onChangeForm(e)})),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit,t=e.index,o=p.fc(3);p.Bb(1),p.mc("title",i.title)("cols",o.colsArray[t])("values",i.datasource)("readonly",!o.inCompilazione)}}function Vi(i,e){if(1&i&&(p.Rb(0),p.Tb(1,"p-accordionTab"),p.Tb(2,"p-header"),p.Oc(3),p.gc(4,"uppercase"),p.Mc(5,Ui,1,0,"i",18),p.Sb(),p.Mc(6,ki,2,4,"div",17),p.Sb(),p.Qb()),2&i){const i=e.$implicit,t=e.index,o=p.fc(2);p.Bb(3),p.Rc(" ",i.indice," ",p.hc(4,4,i.nome)," "),p.Bb(2),p.mc("ngIf",o.quantitaLavorata[t]>0),p.Bb(1),p.mc("ngForOf",o.tables)}}function Hi(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",3),p.Tb(1,"p-accordion",15,16),p.bc("onOpen",(function(e){return p.Ec(i),p.fc().onSelectAccordion(e)})),p.Mc(3,Vi,7,6,"ng-container",17),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(3),p.mc("ngForOf",i.raggruppamenti)}}const Zi=function(){return{marginTop:"70px"}};let ji=(()=>{class i{constructor(i,e,t,o,a,n,r,s){this.activeRoute=i,this.messageService=e,this.confirmationService=t,this.gestioneDomandaUmaService=o,this.httpClientLavorazioniUmaService=a,this.lavorazioniBuiderService=n,this.location=r,this.errorService=s,this.changeFabbisogno=new p.n,this.ambitoLavorazioneEnum=J}ngOnInit(){this.raggruppamentoForm=new L.j({raggruppamento:new L.g}),this.initVariables(),this.loadRaggruppamenti()}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveFabbisogniSubscription&&this.saveFabbisogniSubscription.unsubscribe()}loadRaggruppamenti(){this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>{this.idDomanda=i.idDomanda;const e=this.httpClientLavorazioniUmaService.getLavorazioni(this.idDomanda,this.ambitoLavorazioneEnum.ZOOTECNIA),t=this.httpClientLavorazioniUmaService.getDichiarazioni(this.idDomanda,this.ambitoLavorazioneEnum.ZOOTECNIA);return Object(ii.a)([e,t])})).subscribe(([i,e])=>{this.raggruppamenti=this.lavorazioniBuiderService.raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(i,e),this.raggruppamenti=W.orderBy(this.raggruppamenti,["indice"],["asc"]),this.calcolaQuantita()},i=>this.errorService.showError(i,"tst-lav-zoot"))}calcolaQuantita(){this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((i,e)=>{this.quantitaLavorata[e]=0,i.lavorazioni.forEach(i=>{const t=isNaN(Number(i.BENZINA))?0:Number(i.BENZINA),o=isNaN(Number(i.GASOLIO))?0:Number(i.GASOLIO);this.quantitaLavorata[e]=this.quantitaLavorata[e]+t+o})})}initVariables(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.nomeRaggruppamento=null,this.isValidFormTable=!0,this.tables=[],this.colsArray=[],this.datasources=[],this.quantitaLavorata=[],this.raggruppamentoForm.controls.raggruppamento.setValue(null)}goBack(){this.isChangedInputTable?this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.location.back()},reject:()=>{},key:"lavorazioni-dialog"}):this.location.back()}onSelectAccordion(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.onChangeRaggruppamento(i)))}openAccordionByIndex(i){this.accordion.tabs.forEach((e,t)=>{e.selected=t==i})}onChangeRaggruppamento(i){const e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable)}onChangeForm(i){this.isChangedInputTable=i.isChanged,this.changeFabbisogno.emit(this.isChangedInputTable),this.isValidFormTable=i.isValid}saveLavorazioni(){if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(g.a.raggruppamentiNotSelezionati,"tst-lav-zoot"),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(g.a.datiNonValidi,"tst-lav-zoot"),!1;const i=this.raggruppamentoForm.get("raggruppamento").value,e=this.lavorazioniBuiderService.lavorazioniViewModelToDichiarazioniDtoBuilder(i.lavorazioni);return console.log("Salvo dichiarazioni: ",e),this.saveFabbisogniSubscription=this.httpClientLavorazioniUmaService.saveFabbisogni(this.idDomanda,e).subscribe(()=>{this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable),this.messageService.add(c.a.getToast("tst-lav-zoot",c.b.success,g.a.salvataggioOKLavorazioniSuperficie)),this.loadRaggruppamenti()},i=>this.errorService.showError(i,"tst-lav-zoot")),!0}splitDatasources(i){const e=W.groupBy(i,"tipo");this.tables=[],this.colsArray=[],this.datasources=[],Object.keys(e).forEach(i=>{let t=new K.a,o=this.defineColumnsByTitle(X[i]);t.title=this.tables.length?"":this.nomeRaggruppamento,this.colsArray.push(o),t.datasource=e[i],this.datasources.push(...t.datasource),this.tables.push(t)})}showDialog(i){this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.openedAccordion=i.index,this.onChangeRaggruppamento(i),this.openAccordionByIndex(this.openedAccordion)},reject:()=>{this.openAccordionByIndex(this.openedAccordion)},key:"lavorazioni-dialog"})}defineColumnsByTitle(i){return[{field:"descrizioneCompleta",header:i,sortable:!1,font:K.e.BOLD,width:"78%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:N.a.GASOLIO,header:"Quantit\xe0",sortable:!1,disabled:!1,width:"22%",inputOpts:{pattern:"^(([0-9])([0-9]+)?([,][0-9]{1})?)?$",maxLength:"7"},suffix:"unitaDiMisura",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(z.a),p.Nb(A.d),p.Nb(A.a),p.Nb(O),p.Nb(P),p.Nb(ti),p.Nb(o.n),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-lavorazioni-zootecnia"]],viewQuery:function(i,e){var t;1&i&&p.Uc(Li,!0),2&i&&p.Ac(t=p.cc())&&(e.accordion=t.first)},inputs:{inCompilazione:"inCompilazione",richiestaCarburante:"richiestaCarburante"},outputs:{changeFabbisogno:"changeFabbisogno"},decls:16,vars:9,consts:[["key","tst-lav-zoot"],[1,"p-grid","ui-fluid"],["novalidate","",1,"p-grid","m-0","w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid"],[1,"p-grid","p-align-center","py-4","w-100"],[1,"p-grid","m-0","p-align-center","color-primary"],["src","assets/img/icons/uma-icon/icon-zootecnia_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed",4,"ngIf"],[1,"p-grid","w-100"],["class","p-col",4,"ngIf"],[1,"p-col-fixed"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","values","readonly","changedValueForm"]],template:function(i,e){1&i&&(p.Ob(0,"p-toast",0),p.Tb(1,"div",1),p.Tb(2,"form",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",3),p.Tb(7,"div",6),p.Ob(8,"img",7),p.Tb(9,"span",8),p.Tb(10,"strong",9),p.Oc(11),p.gc(12,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Mc(13,Gi,2,0,"div",10),p.Sb(),p.Tb(14,"div",11),p.Mc(15,Hi,4,1,"div",12),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Kc(p.rc(8,Zi)),p.Bb(2),p.mc("formGroup",e.raggruppamentoForm),p.Bb(9),p.Qc("",p.hc(12,6,"UMA.LAVORAZIONI_ZOOTECNIA")," / Raggruppamenti"),p.Bb(2),p.mc("ngIf",e.inCompilazione),p.Bb(2),p.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[E.a,L.I,L.t,L.k,o.t,M.b,oi.a,o.s,oi.c,A.c,ai.a],pipes:[ni.d,o.G],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}"]}),i})();const Yi=["tabView"];function $i(i,e){1&i&&(p.Tb(0,"div",13),p.Tb(1,"div",14),p.Ob(2,"img",15),p.Sb(),p.Tb(3,"div",3),p.Oc(4,"Lavorazioni a superficie"),p.Sb(),p.Sb())}function qi(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-lavorazioni-superficie",16),p.bc("changeFabbisogno",(function(e){return p.Ec(i),p.fc().changeFabbisogno(e)})),p.Sb()}if(2&i){const i=p.fc();p.mc("richiestaCarburante",i.richiestaCarburante)("inCompilazione",i.inCompilazione)}}function Qi(i,e){1&i&&(p.Tb(0,"div",17),p.Tb(1,"div",14),p.Ob(2,"img",18),p.Sb(),p.Tb(3,"div",3),p.Oc(4,"Altre lavorazioni"),p.Sb(),p.Sb())}function Ki(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-lavorazioni-altre",16),p.bc("changeFabbisogno",(function(e){return p.Ec(i),p.fc().changeFabbisogno(e)})),p.Sb()}if(2&i){const i=p.fc();p.mc("richiestaCarburante",i.richiestaCarburante)("inCompilazione",i.inCompilazione)}}function Wi(i,e){1&i&&(p.Tb(0,"div",17),p.Tb(1,"div",14),p.Ob(2,"img",19),p.Sb(),p.Tb(3,"div",3),p.Oc(4,"Lavorazioni coltivazioni sotto serra"),p.Sb(),p.Sb())}function Ji(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-lavorazioni-fabbricati",20),p.bc("changeFabbisogno",(function(e){return p.Ec(i),p.fc().changeFabbisogno(e)})),p.Sb()}if(2&i){const i=p.fc();p.mc("richiestaCarburante",i.richiestaCarburante)("inCompilazione",i.inCompilazione)("ctx",i.fabbricatoEnum.COLTIVAZIONI_SOTTO_SERRA)}}function Xi(i,e){1&i&&(p.Tb(0,"div",17),p.Tb(1,"div",14),p.Ob(2,"img",21),p.Sb(),p.Tb(3,"div",3),p.Oc(4,"Lavorazioni trasformazioni prodotti"),p.Sb(),p.Sb())}function ie(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-lavorazioni-fabbricati",20),p.bc("changeFabbisogno",(function(e){return p.Ec(i),p.fc().changeFabbisogno(e)})),p.Sb()}if(2&i){const i=p.fc();p.mc("richiestaCarburante",i.richiestaCarburante)("inCompilazione",i.inCompilazione)("ctx",i.fabbricatoEnum.TRASFORMAZIONE_PRODOTTI)}}function ee(i,e){1&i&&(p.Tb(0,"div",17),p.Tb(1,"div",14),p.Ob(2,"img",22),p.Sb(),p.Tb(3,"div",3),p.Oc(4,"Lavorazioni zootecnia"),p.Sb(),p.Sb())}function te(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-lavorazioni-zootecnia",16),p.bc("changeFabbisogno",(function(e){return p.Ec(i),p.fc().changeFabbisogno(e)})),p.Sb()}if(2&i){const i=p.fc();p.mc("richiestaCarburante",i.richiestaCarburante)("inCompilazione",i.inCompilazione)}}let oe=(()=>{class i{constructor(i,e,t){this.confirmationService=i,this.authService=e,this.messageService=t,this.nextStep=new p.n,this.prevStep=new p.n,this.fabbricatoEnum=$}ngOnInit(){this.controllaIstruttoreUMA(),this.prevActiveIndex=this.getDefaultActiveIndex()}changeFabbisogno(i){this.isChangedFabbisogno=i}onChangeTab(i){this.openTabByIndex(this.prevActiveIndex),this.isChangedFabbisogno?this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.openTabByIndex(i.index),this.activeIndex=i.index,this.prevActiveIndex=this.activeIndex,this.isChangedFabbisogno=!1},reject:()=>{},key:"lavorazioni-dialog"}):(this.openTabByIndex(i.index),this.activeIndex=i.index,this.prevActiveIndex=this.activeIndex)}goPrevStep(){this.inCompilazione&&this.isChangedFabbisogno?this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.prevStep.emit(a.LAVORAZIONI)},reject:()=>{},key:"lavorazioni-dialog"}):this.prevStep.emit(a.LAVORAZIONI)}goNextStep(){this.inCompilazione&&this.isChangedFabbisogno?this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.nextStep.emit(a.LAVORAZIONI)},reject:()=>{},key:"lavorazioni-dialog"}):this.nextStep.emit(a.LAVORAZIONI)}getDefaultActiveIndex(){return this.richiestaCarburante&&(this.richiestaCarburante.haMacchineBenzina||this.richiestaCarburante.haMacchineGasolio)?(this.activeIndex=this.richiestaCarburante.haSuperfici?q.SUPERFICI:q.ALTRE,this.activeIndex):(this.messageService.add(c.a.getToast("tst",c.b.error,g.a.macchineNotPresenti)),this.activeIndex=null,this.activeIndex)}openTabByIndex(i){this.tabView.tabs.forEach((e,t)=>{e.selected=t==i})}controllaIstruttoreUMA(){this.authService.userSelectedRole!=C.a.roleIstruttoreUMA&&this.authService.userSelectedRole!=C.a.roleAppag||(this.inCompilazione=!1)}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(A.a),p.Nb(C.a),p.Nb(A.d))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-lavorazioni-indice"]],viewQuery:function(i,e){var t;1&i&&p.Jc(Yi,!0),2&i&&p.Ac(t=p.cc())&&(e.tabView=t.first)},inputs:{richiestaCarburante:"richiestaCarburante",inCompilazione:"inCompilazione",idFascicolo:"idFascicolo"},outputs:{nextStep:"nextStep",prevStep:"prevStep"},decls:30,vars:11,consts:[["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","lavorazioni-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],[1,"p-grid"],[1,"p-grid","w-100"],[1,"p-col"],["pButton","","type","button","icon","pi pi-chevron-circle-left","iconPos","left","label","INDIETRO",1,"w-10m",3,"click"],[1,"p-col-fixed","p-0"],[1,"p-grid","m-0"],["pButton","","type","button","icon","pi pi-chevron-circle-right","iconPos","right","label","PROCEDI",1,"w-10m",3,"click"],["orientation","left",1,"p-col",3,"activeIndex","onChange"],["tabView",""],[3,"cache","disabled"],["pTemplate","header"],["pTemplate","content"],[1,"p-grid","p-align-center","menu-item"],[1,"p-col-fixed"],["src","assets/img/icons/uma-icon/icon-superficie.svg"],[3,"richiestaCarburante","inCompilazione","changeFabbisogno"],[1,"p-grid","p-align-center"],["src","assets/img/icons/uma-icon/icon-altre.svg"],["src","assets/img/icons/uma-icon/icon-fabbricati.svg"],[3,"richiestaCarburante","inCompilazione","ctx","changeFabbisogno"],["src","assets/img/icons/uma-icon/icon-farm.svg"],["src","assets/img/icons/uma-icon/icon-zootecnia.svg"]],template:function(i,e){1&i&&(p.Ob(0,"p-confirmDialog",0),p.Tb(1,"div",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"button",4),p.bc("click",(function(){return e.goPrevStep()})),p.Sb(),p.Sb(),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Ob(7,"div",3),p.Tb(8,"div",3),p.Tb(9,"button",7),p.bc("click",(function(){return e.goNextStep()})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(10,"div",2),p.Tb(11,"div",3),p.Tb(12,"div",6),p.Tb(13,"p-tabView",8,9),p.bc("onChange",(function(i){return e.onChangeTab(i)})),p.Tb(15,"p-tabPanel",10),p.Mc(16,$i,5,0,"ng-template",11),p.Mc(17,qi,1,2,"ng-template",12),p.Sb(),p.Tb(18,"p-tabPanel",10),p.Mc(19,Qi,5,0,"ng-template",11),p.Mc(20,Ki,1,2,"ng-template",12),p.Sb(),p.Tb(21,"p-tabPanel",10),p.Mc(22,Wi,5,0,"ng-template",11),p.Mc(23,Ji,1,3,"ng-template",12),p.Sb(),p.Tb(24,"p-tabPanel",10),p.Mc(25,Xi,5,0,"ng-template",11),p.Mc(26,ie,1,3,"ng-template",12),p.Sb(),p.Tb(27,"p-tabPanel",10),p.Mc(28,ee,5,0,"ng-template",11),p.Mc(29,te,1,2,"ng-template",12),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Bb(13),p.mc("activeIndex",e.activeIndex),p.Bb(2),p.mc("cache",!1)("disabled",!((null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)&&null!=e.richiestaCarburante&&e.richiestaCarburante.haSuperfici)),p.Bb(3),p.mc("cache",!1)("disabled",!(null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)),p.Bb(3),p.mc("cache",!1)("disabled",!((null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)&&null!=e.richiestaCarburante&&e.richiestaCarburante.haSerre)),p.Bb(3),p.mc("cache",!1)("disabled",!((null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)&&null!=e.richiestaCarburante&&e.richiestaCarburante.haFabbricati)),p.Bb(3),p.mc("cache",!1)("disabled",!(null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)))},directives:[R.a,M.b,Q.b,Q.a,A.e,pi,Ti,xi,ji],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]     p-accordiontab .pi{color:#fff}[_nghost-%COMP%]     .ui-tabview.ui-tabview-left{display:flex;flex-wrap:wrap;margin-right:-.5em;margin-left:-.5em;margin-top:-.5em}[_nghost-%COMP%]     .ui-tabview.ui-tabview-left>.ui-tabview-nav{display:flex;flex-wrap:wrap;align-items:center;min-height:22em}[_nghost-%COMP%]     .ui-tabview .ui-tabview-nav>li.ui-state-active{background-color:#f6f6f7}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),i})();var ae=t("R5Gv"),ne=t("Q01X"),re=t("sazn"),se=t("sFKl"),ce=t("RFNi"),le=t("ucsd"),ue=t("GLSp"),be=t("NYM0"),he=t("P028");function me(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",8),p.Tb(1,"button",39),p.bc("click",(function(){return p.Ec(i),p.fc().saveFabbisogno()})),p.Sb(),p.Sb()}}function pe(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",8),p.Tb(1,"button",40),p.bc("click",(function(){return p.Ec(i),p.fc().goNextStep()})),p.Sb(),p.Sb()}}function de(i,e){1&i&&(p.Tb(0,"div",18),p.Tb(1,"div",19),p.Oc(2," Quantitativo gi\xe0 prelevato (anno in corso) "),p.Sb(),p.Ob(3,"div",16),p.Tb(4,"div",8),p.Ob(5,"input",41),p.Sb(),p.Tb(6,"div",8),p.Ob(7,"input",42),p.Sb(),p.Tb(8,"div",8),p.Ob(9,"input",43),p.Sb(),p.Ob(10,"div",8),p.Sb())}function ge(i,e){1&i&&p.Ob(0,"p-message",46)}function fe(i,e){1&i&&p.Ob(0,"p-message",47)}function ve(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,ge,1,0,"p-message",44),p.Mc(2,fe,1,0,"p-message",45),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",i.fabbisogniForm.get("richiestoGasolio").errors.pattern),p.Bb(1),p.mc("ngIf",i.fabbisogniForm.get("richiestoGasolio").errors.max)}}function Se(i,e){1&i&&p.Ob(0,"p-message",46)}function Ce(i,e){1&i&&p.Ob(0,"p-message",47)}function Oe(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Se,1,0,"p-message",44),p.Mc(2,Ce,1,0,"p-message",45),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",i.fabbisogniForm.get("richiestoBenzina").errors.pattern),p.Bb(1),p.mc("ngIf",i.fabbisogniForm.get("richiestoBenzina").errors.max)}}function Te(i,e){1&i&&p.Ob(0,"p-message",46)}function Ie(i,e){1&i&&p.Ob(0,"p-message",47)}function ze(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Te,1,0,"p-message",44),p.Mc(2,Ie,1,0,"p-message",45),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",i.fabbisogniForm.get("richiestoGasolioSerre").errors.pattern),p.Bb(1),p.mc("ngIf",i.fabbisogniForm.get("richiestoGasolioSerre").errors.max)}}function Ae(i,e){1&i&&p.Ob(0,"p-message",46)}function Ee(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Ae,1,0,"p-message",44),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",i.fabbisogniForm.controls.richiestoGasolioTerzi.errors.pattern)}}function Re(i,e){if(1&i&&p.Ob(0,"p-message",49),2&i){const i=p.fc(2);p.nc("text",i.umaMessages.mandatory)}}function De(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Re,1,1,"p-message",48),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",i.fabbisogniForm.get("note").errors.required)}}const Me=function(){return{marginTop:"70px"}},Ne=function(){return{limit:"ammissibileGasolio"}},Be=function(){return{limit:"ammissibileBenzina"}},ye=function(){return{limit:"ammissibileGasolioSerre"}};let _e=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c,l,u,b,h,m,d){this.activeRoute=i,this.httpClientLavorazioniUmaService=e,this.httpClientDomandaUmaService=t,this.httpClientDichiarazioneConsumiUmaService=o,this.httpClientMacchineUmaService=a,this.confirmationService=n,this.gestioneDomandaUmaService=r,this.authService=s,this.messageService=c,this.errorService=l,this.formService=u,this.nullCheckService=b,this.dateUtilService=h,this.navigatorService=m,this.converterService=d,this.nextStep=new p.n,this.prevStep=new p.n,this.STATO_RICHIESTA_UMA=S.a,this.umaMessages=g.a}ngOnInit(){this.controllaIstruttoreUMA(),this.initVariables(),this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>this.httpClientLavorazioniUmaService.getDomandaById(i.idDomanda)),Object(s.a)(i=>(this.errorService.showError(i,"tst-fabbisogno"),n.a)),Object(r.a)(i=>{this.richiestaCarburante=i;const e=this.httpClientDomandaUmaService.getCarburanteAmmissibile(this.richiestaCarburante.id.toString()),t=this.httpClientDichiarazioneConsumiUmaService.getResiduoAnnoPrecedente(this.richiestaCarburante.cuaa,this.richiestaCarburante.campagna-1,[le.a.PROTOCOLLATA]),o=this.httpClientDomandaUmaService.getPrelieviByCuaaAndCampagna(this.richiestaCarburante.cuaa,this.richiestaCarburante.campagna.toString(),this.dateUtilService.toLocalDate(this.richiestaCarburante.dataPresentazione));return Object(ii.a)([e,t,o])})).subscribe(([i,e,t])=>{var o,a,n;if(this.isRettifica=null!=this.richiestaCarburante.idRettificata,null!=this.richiestaCarburante.idRettificata&&this.richiestaCarburante.stato===this.STATO_RICHIESTA_UMA.IN_COMPILAZIONE&&this.fabbisogniForm.get("note").setValidators(L.G.required),e&&e.length>0&&e[0]&&e[0].rimanenza){const i=e[0].rimanenza;this.fabbisogniForm.get("residuoGasolio").setValue(null==i.gasolio?0:i.gasolio),this.fabbisogniForm.get("residuoBenzina").setValue(null==i.benzina?0:i.benzina),this.fabbisogniForm.get("residuoGasolioSerre").setValue(null==i.gasolioSerre?0:i.gasolioSerre),this.fabbisogniForm.get("residuoGasolioTerzi").setValue(null==i.gasolioTerzi?0:i.gasolioTerzi)}i&&(this.fabbisogniForm.get("ammissibileGasolio").setValue(i.gasolio||"0"),this.fabbisogniForm.get("ammissibileBenzina").setValue(i.benzina||"0"),this.fabbisogniForm.get("ammissibileGasolioSerre").setValue(i.gasolioSerre||"0")),this.isRettifica&&(this.fabbisogniForm.get("prelevatoGasolio").setValue(null===(o=null==t?void 0:t.totale)||void 0===o?void 0:o.gasolio),this.fabbisogniForm.get("prelevatoBenzina").setValue(null===(a=null==t?void 0:t.totale)||void 0===a?void 0:a.benzina),this.fabbisogniForm.get("prelevatoGasolioSerre").setValue(null===(n=null==t?void 0:t.totale)||void 0===n?void 0:n.gasolioSerre)),this.fabbisogniForm.get("richiestoGasolio").setValue(null!=this.richiestaCarburante.carburanteRichiesto&&null!=this.richiestaCarburante.carburanteRichiesto.gasolio?this.richiestaCarburante.carburanteRichiesto.gasolio:null),this.fabbisogniForm.get("richiestoBenzina").setValue(null!=this.richiestaCarburante.carburanteRichiesto&&null!=this.richiestaCarburante.carburanteRichiesto.benzina?this.richiestaCarburante.carburanteRichiesto.benzina:null),this.fabbisogniForm.get("richiestoGasolioSerre").setValue(null!=this.richiestaCarburante.carburanteRichiesto&&null!=this.richiestaCarburante.carburanteRichiesto.gasolioSerre?this.richiestaCarburante.carburanteRichiesto.gasolioSerre:null),this.fabbisogniForm.get("richiestoGasolioTerzi").setValue(null!=this.richiestaCarburante.carburanteRichiesto&&null!=this.richiestaCarburante.carburanteRichiesto.gasolioTerzi?this.richiestaCarburante.carburanteRichiesto.gasolioTerzi:null),this.fabbisogniForm.get("note").setValue(this.richiestaCarburante.note||null)},i=>this.errorService.showError(i,"tst-fabbisogno"))}initVariables(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.initForm()}goPrevStep(){this.inCompilazione?this.confirmationService.confirm({message:g.a.datiFabbisognoEliminazioneAlert,accept:()=>{this.updateDichiarazioniSubscription=this.httpClientLavorazioniUmaService.updateDomandaUma(this.richiestaCarburante.id.toString(),this.toCarburanteRichiestoDtoWithNull()).subscribe(()=>{this.messageService.add(c.a.getToast("tst-fabbisogno",c.b.error,g.a.fabbisognoDatiEliminati)),this.prevStep.emit(a.FABBISOGNO)},i=>this.errorService.showError(i,"tst-fabbisogno"))},reject:()=>{},key:"fabbisogno-dialog"}):this.prevStep.emit(a.FABBISOGNO)}goNextStep(){this.isRichiestoAssegnatoInserito()?this.fabbisogniForm.pristine&&this.fabbisogniForm.untouched?this.isRichiestoAssegnatoEqualsZeroWithAmmissibile()||this.isAmmissibileEqualsZero()?this.showWarningDialog():this.validaRichiesta():this.errorService.showErrorWithMessage(g.a.fabbisognoDatiNonSalvati,"tst-fabbisogno"):this.errorService.showErrorWithMessage(g.a.richiestoAssegnatoObbligatorio,"tst-fabbisogno")}validaRichiesta(){this.validaSubscription=this.httpClientMacchineUmaService.validaRichiestaCarburante(this.richiestaCarburante.id.toString()).subscribe(i=>{this.nextStep.emit(a.FABBISOGNO)},i=>{this.confirmationService.confirm({message:c.a.fascicoloNonValido,accept:()=>{this.deleteSubscription=this.httpClientDomandaUmaService.deleteDomandaById(this.richiestaCarburante.id.toString()).subscribe(()=>this.messageService.add(c.a.getToast("tst-eliminazione",c.b.success,g.a.cancellazioneDomandaOK)),i=>this.errorService.showError(i,"tst-fabbisogno"))},reject:()=>{},key:"fabbisogno-dialog"})})}onCloseToastEliminazione(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo.toString())}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveDichiarazioniSubscription&&this.saveDichiarazioniSubscription.unsubscribe(),this.updateDichiarazioniSubscription&&this.updateDichiarazioniSubscription.unsubscribe(),this.validaSubscription&&this.validaSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe()}saveFabbisogno(){if(this.formService.validateFormByErrors(this.fabbisogniForm,["max","pattern","required"]),this.fabbisogniForm.get("note").hasError("required"))this.errorService.showErrorWithMessage(g.a.noteRettificaObbligatorio,"tst-fabbisogno");else if(this.fabbisogniForm.valid)if(this.fabbisogniForm.valid){if(this.isRichiestoAssegnatoInserito())return this.fillWithZeros(),this.saveDichiarazioniSubscription=this.httpClientLavorazioniUmaService.updateDomandaUma(this.richiestaCarburante.id.toString(),this.toCarburanteRichiestoDto()).subscribe(()=>{this.messageService.add(c.a.getToast("tst-fabbisogno",c.b.success,g.a.salvataggioOKFabbisogno)),this.fabbisogniForm.markAsPristine(),this.fabbisogniForm.markAsUntouched()},i=>this.errorService.showError(i,"tst-fabbisogno")),!0;this.errorService.showErrorWithMessage(g.a.richiestoAssegnatoObbligatorio,"tst-fabbisogno")}else this.errorService.showErrorWithMessage(g.a.datiNonValidi,"tst-fabbisogno");else this.errorService.showErrorWithMessage(g.a.datiNonValidi,"tst-fabbisogno")}initForm(){this.fabbisogniForm=new L.j({residuoGasolio:new L.g({value:"0",disabled:!0}),residuoBenzina:new L.g({value:"0",disabled:!0}),residuoGasolioSerre:new L.g({value:"0",disabled:!0}),residuoGasolioTerzi:new L.g({value:"0",disabled:!0}),ammissibileGasolio:new L.g({value:"0",disabled:!0}),ammissibileBenzina:new L.g({value:"0",disabled:!0}),ammissibileGasolioSerre:new L.g({value:"0",disabled:!0}),prelevatoGasolio:new L.g({value:"0",disabled:!0}),prelevatoBenzina:new L.g({value:"0",disabled:!0}),prelevatoGasolioSerre:new L.g({value:"0",disabled:!0}),richiestoGasolio:new L.g({value:null,disabled:!this.inCompilazione||!this.fabbisognoDichiarato||!this.fabbisognoDichiarato.gasolio}),richiestoBenzina:new L.g({value:null,disabled:!this.inCompilazione||!this.fabbisognoDichiarato||!this.fabbisognoDichiarato.benzina}),richiestoGasolioSerre:new L.g({value:null,disabled:!this.inCompilazione}),richiestoGasolioTerzi:new L.g({value:null,disabled:!this.inCompilazione}),note:new L.g({value:null,disabled:!this.inCompilazione})})}fillWithZeros(){this.nullCheckService.isEmpty(this.fabbisogniForm.get("richiestoGasolio").value)&&this.fabbisogniForm.get("richiestoGasolio").setValue("0"),this.nullCheckService.isEmpty(this.fabbisogniForm.get("richiestoBenzina").value)&&this.fabbisogniForm.get("richiestoBenzina").setValue("0"),this.nullCheckService.isEmpty(this.fabbisogniForm.get("richiestoGasolioSerre").value)&&this.fabbisogniForm.get("richiestoGasolioSerre").setValue("0"),this.nullCheckService.isEmpty(this.fabbisogniForm.get("richiestoGasolioTerzi").value)&&this.fabbisogniForm.get("richiestoGasolioTerzi").setValue("0")}showWarningDialog(){this.confirmationService.confirm({message:g.a.fabbisognoZero,accept:()=>{this.validaRichiesta()},reject:()=>{},key:"fabbisogno-dialog"})}isRichiestoAssegnatoInserito(){let i=!0;const e=this.fabbisogniForm.get("richiestoGasolio").value,t=this.fabbisogniForm.get("richiestoBenzina").value,o=this.fabbisogniForm.get("richiestoGasolioSerre").value,a=this.fabbisogniForm.get("richiestoGasolioTerzi").value;return null!=e&&!W.isEmpty(e.toString())||null!=t&&!W.isEmpty(t.toString())||null!=o&&!W.isEmpty(o.toString())||null!=a&&!W.isEmpty(a.toString())||(i=!1),i}isRichiestoAssegnatoEqualsZeroWithAmmissibile(){let i=!1;const e=this.fabbisogniForm.get("richiestoGasolio").value,t=this.fabbisogniForm.get("richiestoBenzina").value,o=this.fabbisogniForm.get("richiestoGasolioSerre").value,a=this.fabbisogniForm.get("ammissibileGasolio").value,n=this.fabbisogniForm.get("ammissibileBenzina").value,r=this.fabbisogniForm.get("ammissibileGasolioSerre").value;return("0"==e&&this.converterService.toNumber(a)>0||"0"==t&&this.converterService.toNumber(n)>0||"0"==o&&this.converterService.toNumber(r)>0)&&(i=!0),i}isAmmissibileEqualsZero(){let i=!1;const e=this.fabbisogniForm.get("richiestoGasolio").value,t=this.fabbisogniForm.get("richiestoBenzina").value,o=this.fabbisogniForm.get("richiestoGasolioSerre").value,a=this.fabbisogniForm.get("ammissibileGasolio").value,n=this.fabbisogniForm.get("ammissibileBenzina").value,r=this.fabbisogniForm.get("ammissibileGasolioSerre").value;return"0"==e&&0==this.converterService.toNumber(a)&&"0"==t&&0==this.converterService.toNumber(n)&&"0"==o&&0==this.converterService.toNumber(r)&&(i=!0),i}toCarburanteRichiestoDto(){const i=new _;return i.carburanteRichiesto=new ce.a,i.carburanteRichiesto.gasolio=+this.fabbisogniForm.get("richiestoGasolio").value,i.carburanteRichiesto.benzina=+this.fabbisogniForm.get("richiestoBenzina").value,i.carburanteRichiesto.gasolioSerre=+this.fabbisogniForm.get("richiestoGasolioSerre").value,i.carburanteRichiesto.gasolioTerzi=+this.fabbisogniForm.get("richiestoGasolioTerzi").value,i.note=this.fabbisogniForm.get("note").value,i}toCarburanteRichiestoDtoWithNull(){const i=new _;return i.carburanteRichiesto=new ce.a,i.carburanteRichiesto.gasolio=null,i.carburanteRichiesto.benzina=null,i.carburanteRichiesto.gasolioSerre=null,i.carburanteRichiesto.gasolioTerzi=null,i.note=null,i}controllaIstruttoreUMA(){this.authService.userSelectedRole!=C.a.roleIstruttoreUMA&&this.authService.userSelectedRole!=C.a.roleAppag||(this.inCompilazione=!1)}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(z.a),p.Nb(P),p.Nb(b.a),p.Nb(se.a),p.Nb(d),p.Nb(A.a),p.Nb(O),p.Nb(C.a),p.Nb(A.d),p.Nb(T.a),p.Nb(re.a),p.Nb(ne.a),p.Nb(u.a),p.Nb(ae.a),p.Nb(Ii.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-fabbisogno"]],inputs:{richiestaCarburante:"richiestaCarburante",idFascicolo:"idFascicolo",inCompilazione:"inCompilazione"},outputs:{nextStep:"nextStep",prevStep:"prevStep"},decls:78,vars:20,consts:[["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","fabbisogno-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["key","tst-fabbisogno"],["position","top-center","key","tst-eliminazione",3,"baseZIndex","onClose"],[1,"p-grid","ui-fluid"],[1,"p-col","p-0","w-100"],["novalidate","",1,"w-100",3,"formGroup"],[1,"p-col","p-0"],[1,"p-grid","w-100"],[1,"p-col"],["pButton","","type","button","icon","pi pi-chevron-circle-left","iconPos","left","label","INDIETRO",1,"w-10m",3,"click"],[1,"p-col-fixed","p-0"],[1,"p-grid","m-0"],["class","p-col",4,"ngIf"],[1,"p-col","mx-2","mt-2","ui-header"],[1,"p-grid","text-center"],[1,"p-col-2"],[1,"p-col-1"],[1,"p-col","p-col-align-center"],[1,"p-grid"],[1,"p-col-2","p-col-align-center"],["type","text","formControlName","residuoGasolio","pInputText","",1,"text-right"],["type","text","formControlName","residuoBenzina","pInputText","",1,"text-right"],["type","text","formControlName","residuoGasolioSerre","pInputText","",1,"text-right"],["type","text","formControlName","residuoGasolioTerzi","pInputText","",1,"text-right"],["type","text","formControlName","ammissibileGasolio","pInputText","",1,"text-right"],["type","text","formControlName","ammissibileBenzina","pInputText","",1,"text-right"],["type","text","formControlName","ammissibileGasolioSerre","pInputText","",1,"text-right"],["class","p-grid",4,"ngIf"],["type","text","pattern","^([0-9])+$","maxlength","7","formControlName","richiestoGasolio","pInputText","",1,"text-right",3,"a4gLimitSup"],["inputRefGasolio",""],[4,"ngIf"],["type","text","pattern","^([0-9])+$","maxlength","7","formControlName","richiestoBenzina","pInputText","",1,"text-right",3,"a4gLimitSup"],["inputRefBenzina",""],["type","text","pattern","^([0-9])+$","maxlength","7","formControlName","richiestoGasolioSerre","pInputText","",1,"text-right",3,"a4gLimitSup"],["inputRefSerre",""],["type","text","pattern","^([0-9])+$","maxlength","7","formControlName","richiestoGasolioTerzi","pInputText","",1,"text-right"],[1,"p-col-9"],["pInputTextarea","","maxlength","500","placeholder","Scrivi qui eventuali note aggiuntive...","formControlName","note",1,"w-100",3,"rows"],["txtAreaInpuRef",""],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],["pButton","","type","button","icon","pi pi-chevron-circle-right","iconPos","right","label","PROCEDI",1,"w-10m",3,"click"],["type","text","formControlName","prelevatoGasolio","pInputText","",1,"text-right"],["type","text","formControlName","prelevatoBenzina","pInputText","",1,"text-right"],["type","text","formControlName","prelevatoGasolioSerre","pInputText","",1,"text-right"],["severity","error","text","Formato non valido",4,"ngIf"],["severity","error","text","Il carburante richiesto non pu\xf2 superare il carburante ammesso",4,"ngIf"],["severity","error","text","Formato non valido"],["severity","error","text","Il carburante richiesto non pu\xf2 superare il carburante ammesso"],["severity","error",3,"text",4,"ngIf"],["severity","error",3,"text"]],template:function(i,e){1&i&&(p.Ob(0,"p-confirmDialog",0),p.Ob(1,"p-toast",1),p.Tb(2,"p-toast",2),p.bc("onClose",(function(){return e.onCloseToastEliminazione()})),p.Sb(),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"form",5),p.Tb(6,"div",6),p.Tb(7,"div",7),p.Tb(8,"div",8),p.Tb(9,"button",9),p.bc("click",(function(){return e.goPrevStep()})),p.Sb(),p.Sb(),p.Tb(10,"div",10),p.Tb(11,"div",11),p.Mc(12,me,2,0,"div",12),p.Mc(13,pe,2,0,"div",12),p.Sb(),p.Sb(),p.Sb(),p.Tb(14,"div",7),p.Tb(15,"div",13),p.Tb(16,"div",14),p.Ob(17,"div",15),p.Ob(18,"div",16),p.Tb(19,"div",17),p.Oc(20,"Gasolio"),p.Sb(),p.Tb(21,"div",17),p.Oc(22,"Benzina"),p.Sb(),p.Tb(23,"div",17),p.Oc(24,"Gasolio serre"),p.Sb(),p.Tb(25,"div",17),p.Oc(26,"Gasolio conto terzi e svincolate"),p.Sb(),p.Sb(),p.Tb(27,"div",18),p.Tb(28,"div",19),p.Oc(29,"Residuo a inizio anno (Lt.)"),p.Sb(),p.Ob(30,"div",16),p.Tb(31,"div",8),p.Ob(32,"input",20),p.Sb(),p.Tb(33,"div",8),p.Ob(34,"input",21),p.Sb(),p.Tb(35,"div",8),p.Ob(36,"input",22),p.Sb(),p.Tb(37,"div",8),p.Ob(38,"input",23),p.Sb(),p.Sb(),p.Tb(39,"div",18),p.Tb(40,"div",19),p.Oc(41,"Ammissibile (Lt.)"),p.Sb(),p.Ob(42,"div",16),p.Tb(43,"div",8),p.Ob(44,"input",24),p.Sb(),p.Tb(45,"div",8),p.Ob(46,"input",25),p.Sb(),p.Tb(47,"div",8),p.Ob(48,"input",26),p.Sb(),p.Ob(49,"div",8),p.Sb(),p.Mc(50,de,11,0,"div",27),p.Tb(51,"div",18),p.Tb(52,"div",19),p.Oc(53,"Richiesto/Assegnato (Lt.)"),p.Sb(),p.Ob(54,"div",16),p.Tb(55,"div",8),p.Ob(56,"input",28,29),p.Mc(58,ve,3,2,"div",30),p.Sb(),p.Tb(59,"div",8),p.Ob(60,"input",31,32),p.Mc(62,Oe,3,2,"div",30),p.Sb(),p.Tb(63,"div",8),p.Ob(64,"input",33,34),p.Mc(66,ze,3,2,"div",30),p.Sb(),p.Tb(67,"div",8),p.Ob(68,"input",35),p.Mc(69,Ee,2,1,"div",30),p.Sb(),p.Sb(),p.Tb(70,"div",18),p.Tb(71,"div",15),p.Oc(72,"Note"),p.Sb(),p.Ob(73,"div",16),p.Tb(74,"div",36),p.Ob(75,"textarea",37,38),p.Mc(77,De,2,1,"div",30),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Bb(1),p.Kc(p.rc(16,Me)),p.Bb(1),p.mc("baseZIndex",5e4),p.Bb(3),p.mc("formGroup",e.fabbisogniForm),p.Bb(7),p.mc("ngIf",e.inCompilazione),p.Bb(1),p.mc("ngIf",e.inCompilazione),p.Bb(37),p.mc("ngIf",e.isRettifica),p.Bb(6),p.mc("a4gLimitSup",p.rc(17,Ne)),p.Bb(2),p.mc("ngIf",e.fabbisogniForm.get("richiestoGasolio").invalid&&(e.fabbisogniForm.get("richiestoGasolio").dirty||e.fabbisogniForm.get("richiestoGasolio").touched)),p.Bb(2),p.mc("a4gLimitSup",p.rc(18,Be)),p.Bb(2),p.mc("ngIf",e.fabbisogniForm.get("richiestoBenzina").invalid&&(e.fabbisogniForm.get("richiestoBenzina").dirty||e.fabbisogniForm.get("richiestoBenzina").touched)),p.Bb(2),p.mc("a4gLimitSup",p.rc(19,ye)),p.Bb(2),p.mc("ngIf",e.fabbisogniForm.get("richiestoGasolioSerre").invalid&&(e.fabbisogniForm.get("richiestoGasolioSerre").dirty||e.fabbisogniForm.get("richiestoGasolioSerre").touched)),p.Bb(3),p.mc("ngIf",e.fabbisogniForm.controls.richiestoGasolioTerzi.invalid&&(e.fabbisogniForm.controls.richiestoGasolioTerzi.dirty||e.fabbisogniForm.controls.richiestoGasolioTerzi.touched)),p.Bb(6),p.mc("rows",5),p.Bb(2),p.mc("ngIf",e.fabbisogniForm.get("note").invalid&&(e.fabbisogniForm.get("note").dirty||e.fabbisogniForm.get("note").touched)))},directives:[R.a,E.a,L.I,L.t,L.k,M.b,o.t,L.c,L.s,L.i,ue.a,L.z,L.n,be.a,he.b],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-1m[_ngcontent-%COMP%]{width:1em}[_nghost-%COMP%]   .w-16em[_ngcontent-%COMP%]{width:16.3em}[_nghost-%COMP%]   .font-15[_ngcontent-%COMP%]{font-size:15px}[_nghost-%COMP%]   input.ui-inputtext[_ngcontent-%COMP%]:disabled{border-bottom:1px dotted;opacity:.9;background:#e8f5e9}[_nghost-%COMP%]   .ui-header[_ngcontent-%COMP%]{border-top:2px solid #0d5f3f}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),i})();var Fe=t("cS1N"),Pe=function(i){return i.download_richiesta="download_richiesta",i.carica_richiesta_firmata="carica_richiesta_firmata",i.protocolla_richiesta="protocolla_richiesta",i.elimina_allegato="elimina_allegato",i}({}),we=t("2yZY"),xe=function(i){return i.FIRMATARIO_TITOLARE_DIVERSI="FIRMATARIO_TITOLARE_DIVERSI",i.FILE_NON_FIRMATO="FILE_NON_FIRMATO",i.FIRMA_NON_VALIDA="FIRMA_NON_VALIDA",i.DATI_FIRMATARIO_MANCANTI="DATI_FIRMATARIO_MANCANTI",i.FIRMATARIO_NON_UNIVOCO="FIRMATARIO_NON_UNIVOCO",i}({}),Le=t("dkQB");let Ge=(()=>{class i{constructor(i,e){this.http=i,this.configuration=e}getTemplate(i="assets/templates/templateRichiestaCarburante.docx"){return this.http.get(this.configuration.getUrlTemplateStampa(i),{responseType:"blob"})}stampaFile(i,e){const t=new FormData;return t.append("file",i,i.name),t.append("dati",JSON.stringify(e)),t.append("formatoStampa","PDF"),this.http.post(this.configuration.UrlStampaPDF,t,{responseType:"blob"})}verificaFirmaSingola(i,e){const t=new FormData;return t.append("documentoFirmato",i),this.http.post(this.configuration.UrlVerificaFirmaSingola.replace("${codiceFiscaleTitolareRl}",e),t)}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(h.b),p.Xb(Le.a))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Ue=t("GtbX"),ke=t("/vOn"),Ve=t("spED"),He=function(i){return i.file="file",i.button="button",i}({}),Ze=t("jTGf");const je=["fileInput"],Ye=["filePrivacyInput"];let $e=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c){this.httpClientProxy=i,this.messageService=e,this.fileService=t,this.httpClientDomandaUmaService=o,this.errorService=a,this.anagraficaFascicoloService=n,this._configuration=r,this.utentiService=s,this.navigatorService=c,this.prevStep=new p.n,this.BUTTONS_ENUM=Pe,this.BUTTONS_TYPE_ENUM=He,this.FIRMA_CHECK_DISABLED=!0}goPrevStep(){this.prevStep.emit(a.PROTOCOLLAZIONE)}ngOnInit(){this.fileConfig=this.fileService.loadConfig(),this.initVariables()}ngOnDestroy(){this.stampaSubscription&&this.stampaSubscription.unsubscribe(),this.protocollaRichiestaSubscription&&this.protocollaRichiestaSubscription.unsubscribe(),this.firmaSingolaSubscription&&this.firmaSingolaSubscription.unsubscribe(),this.stampaPrivacySubscription&&this.stampaPrivacySubscription.unsubscribe()}initVariables(){this.enabledDownload={enableButton:!0,enableHeader:!1},this.enabledUpload={enableButton:!1,enableHeader:!1},this.enabledPrivacy={enableButton:!0,enableHeader:!1},this.enabledProtocolla={enableButton:!1,enableHeader:!1},this.fileRichiesta=new Ve.a,this.fileRichiesta.showDeleteButton=!0,this.resetRichiesta()}onClickBoxButton(i,e){switch(i.idButton){case Pe.download_richiesta:this.stampaRichiestaCarburantePDF();break;case Pe.carica_richiesta_firmata:this.caricaRichiesta(i,e);break;case Pe.protocolla_richiesta:this.protocollaRichiesta();break;case Pe.elimina_allegato:this.eliminaAllegato(i.componentName);break;default:console.log("Click non identificato")}}stampaRichiestaCarburantePDF(){this.stampaSubscription=this.httpClientDomandaUmaService.getRichiestaCarburanteFile(this.richiestaCarburante.id.toString()).subscribe(i=>{I.saveAs(new Blob([i],{type:"application/pdf"}),this.richiestaCarburante.id.toString()+this.getFileName()),this.enabledDownload.enableHeader=!0,this.enabledUpload.enableButton=!0},i=>{console.log("ERRORE: ",i),this.errorService.showErrorWithMessage(g.a.erroreStampaRichiesta,"tst-dlg")})}getFileName(){return null==this.richiestaCarburante.idRettificata?"_richiestacarburante.pdf":"_rettificacarburante.pdf"}caricaRichiesta(i,e){e||(e=document.getElementById("caricaFileInput")),i.typeButton===He.file&&e&&e.click()}protocollaRichiesta(){this.protocollaRichiestaSubscription=this.httpClientDomandaUmaService.protocollaDomanda(this.richiestaCarburante.id,this.fileRichiesta.file,this.haFirma).subscribe(i=>{this.messageService.add(c.a.getToast("tst-dlg-protocollazione",c.b.success,g.a.protocollaRichiestaOK))},i=>{console.log("ERRORE: ",i),this.errorService.showErrorWithMessage(i&&i.error&&i.error.message?i.error.message:g.a.erroreProtocollaRichiesta,"tst-dlg")})}onCloseToastProtocollazione(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo.toString())}onFileChange(i,e){if(i.target.files&&i.target.files.length){this.enabledProtocolla.enableHeader=!1;const t=i.target.files[0],o=new Fe.a(this.fileConfig.fileExt,this.fileConfig.maxSize);o.isValidFileExtension(t,g.a.FILE_ERRORS.EXT)&&o.isValidFileSize(t,g.a.FILE_ERRORS.SIZE)&&(this.firmaSingolaSubscription=this.httpClientProxy.verificaFirmaSingola(t,this.richiestaCarburante.cfRichiedente).subscribe(i=>{this.enableNextFields(e,t),this.haFirma=!0},i=>{this.haFirma=!0,console.log("ERRORE: ",i),this.FIRMA_CHECK_DISABLED?(this.enableNextFields(e,t),this.handleErrorFirma(i,!0)):(this.handleErrorFirma(i,!0),this.fileInput.nativeElement.value=null)})),this.showErrors(o.getErrors())}}onFileChangePrivacy(i,e){if(i.target.files&&i.target.files.length){this.enabledProtocolla.enableHeader=!1;const t=i.target.files[0],o=new Fe.a(this.fileConfig.fileExt,this.fileConfig.maxSize);o.isValidFileExtension(t,g.a.FILE_ERRORS.EXT)&&o.isValidFileSize(t,g.a.FILE_ERRORS.SIZE)&&(this.firmaSingolaSubscription=this.httpClientProxy.verificaFirmaSingola(t,this.richiestaCarburante.cfRichiedente).subscribe(i=>{this.enableNextFields(e,t)},i=>{console.log("ERRORE: ",i),this.handleErrorFirma(i,!1),this.fileInput.nativeElement.value=null})),this.showErrors(o.getErrors())}}enableNextFields(i,e){"richiesta"===i&&(this.fileRichiesta.nome=e.name,this.fileRichiesta.file=e,this.enabledUpload.enableHeader=!0),this.fileRichiesta.file&&(this.enabledProtocolla.enableButton=!0)}handleErrorFirma(i,e){if(i&&i.error&&i.error.message)switch(i.error.message){case xe.FIRMATARIO_TITOLARE_DIVERSI:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.CODICE_FISCALE_NO_MATCH,"tst-dlg");break;case xe.FILE_NON_FIRMATO:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.NO_FIRMA,"tst-dlg"),e&&(this.haFirma=!1);break;case xe.FIRMA_NON_VALIDA:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.NO_FIRMA_VALIDA,"tst-dlg");break;case xe.DATI_FIRMATARIO_MANCANTI:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.NO_DATI_FIRMATARIO,"tst-dlg");break;case xe.FIRMATARIO_NON_UNIVOCO:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.NO_SINGLE_FIRMATARIO,"tst-dlg");break;default:this.errorService.showError(i,"tst-dlg")}else this.errorService.showError(i,"tst-dlg")}getHeader(i,e,t){return{title:i,subtitle:e,icon:t}}getButtonModel(i,e,t,o){return{label:i,icon:e,id:t,type:o}}showErrors(i){i&&i.length&&i.forEach(i=>{this.messageService.add(c.a.getToast("tst-dlg",c.b.error,i))})}eliminaAllegato(i){"richiesta"===i&&(this.resetRichiesta(),this.enabledUpload.enableHeader=!1,this.enabledProtocolla.enableButton=!1)}resetRichiesta(){this.fileRichiesta.file=null,this.fileRichiesta.nome=null,this.fileInput.nativeElement.value=null}getDocumentazioneInformativaPrivacy(i,e,t,o){return JSON.stringify({mittente:{name:i,surname:e,nationalIdentificationNumber:t,description:o+" - "+t},oggetto:this._configuration.ProtocollaPrivacyOggetto+" - "+o+" - "+t,tipologiaDocumentoPrincipale:this._configuration.tipologiaDocumentoProtocolloPrivacy})}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(Ge),p.Nb(A.d),p.Nb(we.a),p.Nb(b.a),p.Nb(T.a),p.Nb(Ue.a),p.Nb(Le.a),p.Nb(ke.a),p.Nb(ae.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-protocollazione"]],viewQuery:function(i,e){var t;1&i&&(p.Jc(je,!0),p.Jc(Ye,!0)),2&i&&(p.Ac(t=p.cc())&&(e.fileInput=t.first),p.Ac(t=p.cc())&&(e.filePrivacyInput=t.first))},inputs:{richiestaCarburante:"richiestaCarburante",inCompilazione:"inCompilazione",idFascicolo:"idFascicolo"},outputs:{prevStep:"prevStep"},decls:22,vars:18,consts:[["position","top-center","key","tst-dlg",3,"baseZIndex"],["position","top-center","key","tst-dlg-protocollazione",3,"baseZIndex","onClose"],[1,"p-grid","ui-fluid"],[1,"p-grid","w-100"],[1,"p-col"],["pButton","","type","button","icon","pi pi-chevron-circle-left","iconPos","left","label","INDIETRO",1,"w-10m",3,"click"],[1,"popup-approvazione","popup--custom"],[1,"text-center"],[3,"innerHtml"],[1,"p-grid"],[1,"p-col-4"],[3,"header","button","enableBox","onClickButton"],[3,"name","header","button","enableBox","document","onClickButton"],["id","caricaFileInput","name","caricaFileInput","type","file",3,"hidden","accept","change"],["fileInput",""]],template:function(i,e){if(1&i){const i=p.Ub();p.Ob(0,"p-toast",0),p.Tb(1,"p-toast",1),p.bc("onClose",(function(){return e.onCloseToastProtocollazione()})),p.Sb(),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"button",5),p.bc("click",(function(){return e.goPrevStep()})),p.Sb(),p.Sb(),p.Sb(),p.Tb(6,"div",3),p.Tb(7,"div",4),p.Tb(8,"div",6),p.Tb(9,"div",7),p.Tb(10,"h6"),p.Ob(11,"p",8),p.gc(12,"translate"),p.Sb(),p.Sb(),p.Tb(13,"div",9),p.Tb(14,"div",10),p.Tb(15,"app-box",11),p.bc("onClickButton",(function(i){return e.onClickBoxButton(i)})),p.Sb(),p.Sb(),p.Tb(16,"div",10),p.Tb(17,"app-box",12),p.bc("onClickButton",(function(t){p.Ec(i);const o=p.Bc(19);return e.onClickBoxButton(t,o)})),p.Sb(),p.Tb(18,"input",13,14),p.bc("change",(function(i){return e.onFileChange(i,"richiesta")})),p.Sb(),p.Sb(),p.Tb(20,"div",10),p.Tb(21,"app-box",11),p.bc("onClickButton",(function(i){return e.onClickBoxButton(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()}2&i&&(p.mc("baseZIndex",5e4),p.Bb(1),p.mc("baseZIndex",5e4),p.Bb(10),p.mc("innerHtml",p.hc(12,16,"UMA.MESSAGGIO_DLG"),p.Fc),p.Bb(4),p.mc("header",e.getHeader("UMA.SCARICA_RICHIESTA","UMA.DESC_SCARICA_RICHIESTA","assets/img/icons/icon-download2.png"))("button",e.getButtonModel("UMA.SCARICA","pi pi-arrow-down",e.BUTTONS_ENUM.download_richiesta,e.BUTTONS_TYPE_ENUM.button))("enableBox",e.enabledDownload),p.Bb(2),p.mc("name","richiesta")("header",e.getHeader("UMA.FIRMA_RICHIESTA","UMA.DESC_FIRMA_RICHIESTA","assets/img/icons/icon-signature.svg"))("button",e.getButtonModel("UMA.CARICA","pi pi-arrow-up",e.BUTTONS_ENUM.carica_richiesta_firmata,e.BUTTONS_TYPE_ENUM.file))("enableBox",e.enabledUpload)("document",e.fileRichiesta),p.Bb(1),p.nc("accept",e.fileConfig.fileExt),p.mc("hidden",!0),p.Bb(3),p.mc("header",e.getHeader("UMA.PROTOCOLLA_RICHIESTA","UMA.DESC_PROTOCOLLA_RICHIESTA","assets/img/icons/icon-file-check.svg"))("button",e.getButtonModel("UMA.PROTOCOLLA","",e.BUTTONS_ENUM.protocolla_richiesta,e.BUTTONS_TYPE_ENUM.button))("enableBox",e.enabledProtocolla))},directives:[E.a,M.b,Ze.a],pipes:[ni.d],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .cell[_ngcontent-%COMP%]{border:1px solid #cacaca;cursor:pointer}[_nghost-%COMP%]   .cell.disabled[_ngcontent-%COMP%] > .cell-content[_ngcontent-%COMP%]{opacity:.5;cursor:auto}[_nghost-%COMP%]   div.ui-header-sezioni-uma[_ngcontent-%COMP%]{background-color:#fff;border-top:2px solid #4caf50;border-left:1px solid #cacaca;border-right:1px solid #cacaca;font-size:1em}[_nghost-%COMP%]   .block-100[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.ui-clickable.pi.pi-trash{color:#01985a;font-size:x-large}"]}),i})();function qe(i,e){1&i&&p.Pb(0)}function Qe(i,e){1&i&&(p.Tb(0,"h5",14),p.Tb(1,"strong"),p.Oc(2),p.gc(3,"uppercase"),p.gc(4,"translate"),p.Sb(),p.Sb()),2&i&&(p.Bb(2),p.Pc(p.hc(3,1,p.hc(4,3,"UMA.RICHIESTA_CARBURANTE"))))}function Ke(i,e){1&i&&(p.Tb(0,"h5",14),p.Tb(1,"strong"),p.Oc(2),p.gc(3,"uppercase"),p.gc(4,"translate"),p.Sb(),p.Sb()),2&i&&(p.Bb(2),p.Pc(p.hc(3,1,p.hc(4,3,"UMA.RETTIFICA_CARBURANTE"))))}function We(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",15),p.Tb(1,"div",5),p.Tb(2,"button",16),p.bc("click",(function(){return p.Ec(i),p.fc().stampaRichiestaCarburantePDF()})),p.Sb(),p.Sb(),p.Sb()}}function Je(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",15),p.Tb(1,"div",5),p.Tb(2,"button",17),p.bc("click",(function(){return p.Ec(i),p.fc().eliminaDomanda()})),p.Sb(),p.Sb(),p.Sb()}}function Xe(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div"),p.Tb(1,"app-macchine",18),p.bc("updateRichiesta",(function(e){return p.Ec(i),p.fc().updateRichiesta(e)}))("nextStep",(function(e){return p.Ec(i),p.fc().nextStep(e)})),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(1),p.mc("inCompilazione",i.inCompilazione)("idFascicolo",i.idFascicolo)("richiestaCarburante",i.richiestaCarburante)}}function it(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div"),p.Tb(1,"app-lavorazioni-indice",19),p.bc("nextStep",(function(e){return p.Ec(i),p.fc().nextStep(e)}))("prevStep",(function(e){return p.Ec(i),p.fc().prevStep(e)})),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(1),p.mc("inCompilazione",i.inCompilazione)("idFascicolo",i.idFascicolo)("richiestaCarburante",i.richiestaCarburante)}}function et(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div"),p.Tb(1,"app-fabbisogno",19),p.bc("nextStep",(function(e){return p.Ec(i),p.fc().nextStep(e)}))("prevStep",(function(e){return p.Ec(i),p.fc().prevStep(e)})),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(1),p.mc("inCompilazione",i.inCompilazione)("idFascicolo",i.idFascicolo)("richiestaCarburante",i.richiestaCarburante)}}function tt(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div"),p.Tb(1,"app-protocollazione",20),p.bc("prevStep",(function(e){return p.Ec(i),p.fc().prevStep(e)})),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(1),p.mc("inCompilazione",i.inCompilazione)("idFascicolo",i.idFascicolo)("richiestaCarburante",i.richiestaCarburante)}}const ot=function(){return{marginTop:"70px"}};let at=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c,l){this.dateUtilService=i,this.httpClientDomandaUma=e,this.activeRoute=t,this.router=o,this.httpClientMacchineUmaService=a,this.gestioneDomandaUmaService=n,this.messageService=r,this.confirmationService=s,this.breadCrumbService=c,this.errorService=l}ngOnInit(){this.items=[],this.macchine=[],this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>(this.idFascicolo=i.idFascicolo,this.httpClientDomandaUma.getDomandaById(i.idDomanda))),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>{this.richiestaCarburante=i,this.items=[{label:"Macchine"},{label:"Lavorazioni"},{label:"Fabbisogno"}];const e=this.gestioneDomandaUmaService.isInCompilazione(i,this.items);return this.inCompilazione=e.inCompilazione,this.mostraScarica=e.mostraScarica,this.loadLastStep(),this.httpClientMacchineUmaService.getMacchineByIdDomanda(this.richiestaCarburante.id.toString())})).subscribe(i=>{this.macchine=i},i=>this.errorService.showError(i))}ngOnDestroy(){this.stampaSubscription&&this.stampaSubscription.unsubscribe(),this.routerSubscription&&this.routerSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe()}updateRichiesta(i){this.richiestaCarburante=i}activeIndexChange(i){}nextStep(i){this.activeIndex=i>=a.MACCHINE&&i<=a.PROTOCOLLAZIONE?i+1:a.MACCHINE}prevStep(i){this.activeIndex=i>=a.LAVORAZIONI&&i<=a.PROTOCOLLAZIONE?i-1:a.MACCHINE}eliminaDomanda(){this.confirmationService.confirm({message:g.a.confermaCancellazioneDomanda,accept:()=>{this.confermaEliminaDomanda()},reject:()=>{},key:"cancellazione-domanda-dialog"})}loadLastStep(){this.activeIndex=this.inCompilazione?null==this.richiestaCarburante.carburanteRichiesto||null==this.richiestaCarburante.carburanteRichiesto.benzina&&null==this.richiestaCarburante.carburanteRichiesto.gasolio&&null==this.richiestaCarburante.carburanteRichiesto.gasolioSerre&&null==this.richiestaCarburante.carburanteRichiesto.gasolioTerzi?this.richiestaCarburante.haDichiarazioni?a.LAVORAZIONI:a.MACCHINE:a.FABBISOGNO:a.MACCHINE}confermaEliminaDomanda(){this.deleteSubscription=this.httpClientDomandaUma.deleteDomandaById(this.richiestaCarburante.id.toString()).subscribe(()=>{this.messageService.add(c.a.getToast("tst-cancellazione",c.b.success,g.a.cancellazioneDomandaOK))},i=>this.errorService.showError(i))}stampaRichiestaCarburantePDF(){this.stampaSubscription=this.httpClientDomandaUma.getRichiestaCarburanteFile(this.richiestaCarburante.id.toString()).subscribe(i=>{I.saveAs(new Blob([i],{type:"application/pdf"}),this.richiestaCarburante.id.toString()+this.getFileName())},i=>{console.log("ERRORE: ",i),this.errorService.showErrorWithMessage(g.a.erroreStampaRichiesta,"tst")})}getFileName(){return null==this.richiestaCarburante.idRettificata?"_richiestacarburante.pdf":"_rettificacarburante.pdf"}onCloseToastCancellazione(){let i;null==this.idFascicolo&&this.router.navigate(["/"]),"appag"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"amministratore"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"caa"==localStorage.getItem("selectedRole")&&(i="funzioniCaa/"),"azienda"==localStorage.getItem("selectedRole")&&(i="/"),"gestoreutenti"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"viewer_pat"==localStorage.getItem("selectedRole")&&(i="funzioniPatVisualizzatore/"),"istruttoreuma"==localStorage.getItem("selectedRole")&&(i="funzioniPatIstruttoreUMA/"),"operatore_distributore"==localStorage.getItem("selectedRole")&&(i="funzioniDistributore/"),"amministratore"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"istruttoreamf"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"istruttoredu"==localStorage.getItem("selectedRole")&&(i="funzioniPat/gestioneIstruttoria/"),"viewer_altro_ente"==localStorage.getItem("selectedRole")&&(i="funzioniOperatoreVisualizzatore/"),this.router.navigate([`${i}fascicolo/${this.idFascicolo.toString()}/presentazioneIstanze`])}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(u.a),p.Nb(b.a),p.Nb(z.a),p.Nb(z.e),p.Nb(d),p.Nb(O),p.Nb(A.d),p.Nb(A.a),p.Nb(l.a),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-indice-domanda-uma"]],decls:20,vars:17,consts:[["position","top-center","key","tst-cancellazione",3,"modal","baseZIndex","onClose"],["key","tst"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","cancellazione-domanda-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],[1,"ui-grid-fixed","position-unset","top-rettifica"],[1,"boxgrey"],[1,"p-col"],[1,"p-grid","py-2","p-align-center","p-justify-between"],[4,"ngIf","ngIfThen","ngIfElse"],["richiestaTpl",""],["rettificaTpl",""],["class","p-col-fixed",4,"ngIf"],[1,"p-grid"],[3,"model","readonly","activeIndex","activeIndexChange"],[4,"ngIf"],[1,"p-col","p-col-align-center"],[1,"p-col-fixed"],["pButton","","icon","pi pi-file-pdf","iconPos","right","type","button","label","SCARICA",1,"w-10m","ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],["pButton","","icon","pi pi-trash","iconPos","right","type","button","label","ELIMINA",1,"w-10m","ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],[3,"inCompilazione","idFascicolo","richiestaCarburante","updateRichiesta","nextStep"],[3,"inCompilazione","idFascicolo","richiestaCarburante","nextStep","prevStep"],[3,"inCompilazione","idFascicolo","richiestaCarburante","prevStep"]],template:function(i,e){if(1&i&&(p.Tb(0,"p-toast",0),p.bc("onClose",(function(){return e.onCloseToastCancellazione()})),p.Sb(),p.Ob(1,"p-toast",1),p.Ob(2,"p-confirmDialog",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Mc(7,qe,1,0,"ng-container",7),p.Mc(8,Qe,5,5,"ng-template",null,8,p.Nc),p.Mc(10,Ke,5,5,"ng-template",null,9,p.Nc),p.Mc(12,We,3,0,"div",10),p.Mc(13,Je,3,0,"div",10),p.Sb(),p.Tb(14,"div",11),p.Tb(15,"p-steps",12),p.bc("activeIndexChange",(function(i){return e.activeIndexChange(i)})),p.Sb(),p.Sb(),p.Mc(16,Xe,2,3,"div",13),p.Mc(17,it,2,3,"div",13),p.Mc(18,et,2,3,"div",13),p.Mc(19,tt,2,3,"div",13),p.Sb(),p.Sb(),p.Sb()),2&i){const i=p.Bc(9),t=p.Bc(11);p.mc("modal",!0)("baseZIndex",5e3),p.Bb(1),p.Kc(p.rc(16,ot)),p.Bb(6),p.mc("ngIf",null==(null==e.richiestaCarburante?null:e.richiestaCarburante.idRettificata))("ngIfThen",i)("ngIfElse",t),p.Bb(5),p.mc("ngIf",e.mostraScarica),p.Bb(1),p.mc("ngIf",e.inCompilazione),p.Bb(2),p.mc("model",e.items)("readonly",!1)("activeIndex",e.activeIndex),p.Bb(1),p.mc("ngIf",0==e.activeIndex),p.Bb(1),p.mc("ngIf",1==e.activeIndex),p.Bb(1),p.mc("ngIf",2==e.activeIndex),p.Bb(1),p.mc("ngIf",3==e.activeIndex)}},directives:[E.a,R.a,o.t,D.a,M.b,Y,oe,_e,$e],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .top-rettifica[_ngcontent-%COMP%]{position:relative;top:40px}[_nghost-%COMP%]   .block-100[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.ui-clickable.pi.pi-file-pdf, [_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.ui-clickable.pi.pi-trash{color:#01985a;font-size:x-large}[_nghost-%COMP%]     p-steps>.ui-steps>ul{display:flex;flex-wrap:wrap}[_nghost-%COMP%]     p-steps>.ui-steps>ul li.ui-steps-item{flex-grow:1;flex-basis:0;padding:.5em}[_nghost-%COMP%]   .position-unset[_ngcontent-%COMP%]{position:unset}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),i})(),nt=(()=>{class i{constructor(i){this.breadCrumbService=i}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(l.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-clienti-conto-terzi-container"]],decls:1,vars:0,template:function(i,e){1&i&&p.Ob(0,"router-outlet")},directives:[z.j],styles:[""]}),i})(),rt=(()=>{class i{constructor(){}ngOnInit(){}ngOnDestroy(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=p.Hb({type:i,selectors:[["app-home-uma"]],decls:1,vars:0,template:function(i,e){1&i&&p.Ob(0,"router-outlet")},directives:[z.j],styles:[""]}),i})();var st=t("OlUD"),ct=t("0Dnl"),lt=t("6aLS"),ut=t("zLRh"),bt=t("KkCm"),ht=t("D0mR");function mt(i,e){if(1&i&&(p.Tb(0,"option",13),p.Oc(1),p.Sb()),2&i){const i=e.$implicit;p.mc("ngValue",i),p.Bb(1),p.Rc(" ",null==i?null:i.denominazione," - ",null==i?null:i.carica," ")}}const pt=function(){return{marginTop:"70px"}};let dt=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c,l){this.dateUtilService=i,this.messageService=e,this.anagraficaFascicoloService=t,this.fascicoloCorrente=o,this.router=a,this.route=n,this.httpClientDomandaUmaService=r,this.httpClientDichiarazioneConsumiUmaService=s,this.fascicoloService=c,this.errorService=l}ngOnInit(){this.soggetti=[],this.initForm(),this.setSubscriptions()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.creaDichiarazioneSubscription&&this.creaDichiarazioneSubscription.unsubscribe(),this.creaRichiestaSubscription&&this.creaRichiestaSubscription.unsubscribe()}setSubscriptions(){this.subscription=this.route.params.pipe(Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(lt.switchMap)(i=>(this.TIPO_RICHIEDENTE=i.tipoRichiesta,Object(ii.a)([this.fascicoloService.getFascicolo(i.idFascicolo),this.fascicoloService.getLegacy(i.idFascicolo)]))),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(lt.switchMap)(([i,e])=>(this.cuaa=null,i&&i.cuaa&&(this.fascicoloCorrente.fascicolo=i,this.cuaa=this.fascicoloCorrente.fascicolo.cuaa),e&&e.cuaa&&(this.fascicoloCorrente.fascicoloLegacy=e),this.fascicoloCorrente.isPersonaFisica(this.cuaa)&&null!=this.fascicoloCorrente.fascicoloLegacy.dataMorteTitolare?this.fascicoloService.getEredi(this.cuaa):this.anagraficaFascicoloService.getTitolariRappresentantiLegali(this.cuaa)))).subscribe(i=>{this.soggetti=i.map(i=>{const e=i;return e.carica=e.carica.split("_").join(" "),e}),this.richiedenteForm.get("richiedente").setValue(this.soggetti[0])},i=>this.errorService.showError(i))}initForm(){this.richiedenteForm=new L.j({richiedente:new L.g(null)})}getLabel(){return this.TIPO_RICHIEDENTE===st.a.richiesta?"UMA.CREA_DOMANDA":"UMA.CREA_DICHIARAZIONE"}getTitle(){return this.TIPO_RICHIEDENTE===st.a.richiesta?"UMA.RICHIEDENTE_DOMANDA_SCELTA":"UMA.DICHIARAZIONE_CONSUMI.DICHIARAZIONE_CONSUMI"}onClick(){const i=this.richiedenteForm.get("richiedente").value;if(null!=i)return this.TIPO_RICHIEDENTE===st.a.richiesta?this.creaRichiestaUma(i):this.creaDichiarazioneUma(i);this.messageService.add(c.a.getToast("tst",c.b.warn,g.a.noRichiedenteUmaSelezionato))}creaRichiestaUma(i){this.creaRichiestaSubscription=this.httpClientDomandaUmaService.presentaDomanda(this.cuaa,i.codiceFiscale).subscribe(i=>{this.router.navigate(["./richiesta",i],{relativeTo:this.route.parent})},i=>this.errorService.showError(i))}creaDichiarazioneUma(i){this.creaDichiarazioneSubscription=this.httpClientDichiarazioneConsumiUmaService.presentaDichiarazioneConsumi(this.cuaa,i.codiceFiscale).subscribe(i=>{this.router.navigate(["./dichiarazione-consumi",i],{relativeTo:this.route.parent})},i=>this.errorService.showError(i))}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(u.a),p.Nb(A.d),p.Nb(Ue.a),p.Nb(ct.a),p.Nb(z.e),p.Nb(z.a),p.Nb(b.a),p.Nb(se.a),p.Nb(ut.a),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-richiedente-uma"]],decls:20,vars:14,consts:[["key","tst"],[1,"ui-grid-fixed","mt-4"],[1,"richiesta-title"],[1,"p-col","p-0"],[1,"boxgrey"],[3,"formGroup"],[1,"p-grid"],[1,"p-col-12","p-md-2","align-self-center"],["id","basic-addon1",1,"m-0"],[1,"p-col-12","p-md-8","align-self-center"],["formControlName","richiedente",1,"custom-select",2,"height","47px"],[3,"ngValue",4,"ngFor","ngForOf"],["appDebounceClick","","pButton","",1,"w-100",3,"label","debounceClick"],[3,"ngValue"]],template:function(i,e){1&i&&(p.Ob(0,"app-fascicolo-aperto"),p.Ob(1,"p-toast",0),p.Tb(2,"div",1),p.Tb(3,"h2",2),p.Oc(4),p.gc(5,"translate"),p.Sb(),p.Tb(6,"div",3),p.Tb(7,"div",4),p.Tb(8,"form",5),p.Tb(9,"div",6),p.Tb(10,"div",7),p.Tb(11,"label",8),p.Oc(12),p.gc(13,"translate"),p.Sb(),p.Sb(),p.Tb(14,"div",9),p.Tb(15,"select",10),p.Mc(16,mt,2,3,"option",11),p.Sb(),p.Sb(),p.Tb(17,"div",7),p.Tb(18,"button",12),p.bc("debounceClick",(function(){return e.onClick()})),p.gc(19,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Bb(1),p.Kc(p.rc(13,pt)),p.Bb(3),p.Pc(p.hc(5,7,e.getTitle())),p.Bb(4),p.mc("formGroup",e.richiedenteForm),p.Bb(4),p.Qc(" ",p.hc(13,9,"UMA.CF_RICHIEDENTE")," "),p.Bb(4),p.mc("ngForOf",e.soggetti),p.Bb(2),p.mc("label",p.hc(19,11,e.getLabel())))},directives:[bt.a,E.a,L.I,L.t,L.k,L.E,L.s,L.i,o.s,ht.a,M.b,L.x,L.H],pipes:[ni.d],styles:[""],encapsulation:2}),i})();var gt=t("lAEH");let ft=(()=>{class i{constructor(i,e){this.http=i,this.configuration=e}getFascicoloAgs(i){return this.http.get(`${this.urlGetFascicoloAgsFromAnagrafica()}/${i}`)}urlGetFascicoloAgsFromAnagrafica(){return this.configuration.anagrafica_server+"/fascicolo/legacy"}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(h.b),p.Xb(Le.a))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var vt=t("xm8s"),St=t("Pgx+");function Ct(i,e){1&i&&p.Pb(0)}function Ot(i,e){if(1&i&&(p.Tb(0,"div",20),p.Tb(1,"h6",7),p.Oc(2),p.gc(3,"translate"),p.Sb(),p.Tb(4,"span",8),p.Oc(5),p.gc(6,"date"),p.Sb(),p.Sb()),2&i){const i=p.fc(2);p.Bb(2),p.Pc(p.hc(3,2,"UMA.INTESTAZIONE.DATA_INSERIMENTO")),p.Bb(3),p.Pc(p.ic(6,4,null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.dataPresentazione,"dd/MM/yyyy"))}}function Tt(i,e){if(1&i&&(p.Tb(0,"div",20),p.Tb(1,"h6",7),p.Oc(2),p.gc(3,"translate"),p.Sb(),p.Tb(4,"span",8),p.Oc(5),p.gc(6,"date"),p.Sb(),p.Sb()),2&i){const i=p.fc(2);p.Bb(2),p.Pc(p.hc(3,2,"UMA.INTESTAZIONE.DATA_PROTOCOLLAZIONE")),p.Bb(3),p.Pc(p.ic(6,4,(null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.dataProtocollazione)||"01/01/2001","dd/MM/yyyy"))}}function It(i,e){if(1&i&&(p.Tb(0,"div",20),p.Tb(1,"h6",7),p.Oc(2),p.gc(3,"translate"),p.Sb(),p.Tb(4,"span",8),p.Oc(5),p.Sb(),p.Sb(),p.Mc(6,Ot,7,7,"div",21),p.Mc(7,Tt,7,7,"div",21),p.Tb(8,"div",20),p.Tb(9,"h6",7),p.Oc(10),p.gc(11,"translate"),p.Sb(),p.Tb(12,"span",8),p.Oc(13),p.Sb(),p.Sb()),2&i){const i=p.fc();p.Bb(2),p.Pc(p.hc(3,6,"UMA.INTESTAZIONE.ID_DICHIARAZIONE")),p.Bb(3),p.Pc(null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.id),p.Bb(1),p.mc("ngIf",null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.dataPresentazione),p.Bb(1),p.mc("ngIf",null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.dataProtocollazione),p.Bb(3),p.Pc(p.hc(11,8,"UMA.INTESTAZIONE.RIF_RICHIESTA")),p.Bb(3),p.Pc(null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.idRichiesta)}}function zt(i,e){if(1&i&&(p.Tb(0,"div",20),p.Tb(1,"h6",7),p.Oc(2),p.gc(3,"translate"),p.Sb(),p.Tb(4,"span",8),p.Oc(5),p.Sb(),p.Sb()),2&i){const i=p.fc(2);p.Bb(2),p.Pc(p.hc(3,2,"UMA.INTESTAZIONE.ID_RICHIESTA_RETTIFICATA")),p.Bb(3),p.Pc(null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.idRettificata)}}function At(i,e){if(1&i&&(p.Tb(0,"div",20),p.Tb(1,"h6",7),p.Oc(2),p.gc(3,"translate"),p.Sb(),p.Tb(4,"span",8),p.Oc(5),p.gc(6,"date"),p.Sb(),p.Sb()),2&i){const i=p.fc(2);p.Bb(2),p.Pc(p.hc(3,2,"UMA.INTESTAZIONE.DATA_PROTOCOLLAZIONE")),p.Bb(3),p.Pc(p.ic(6,4,null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.dataProtocollazione,"dd/MM/yyyy"))}}function Et(i,e){if(1&i&&(p.Tb(0,"div",20),p.Tb(1,"h6",7),p.Oc(2),p.gc(3,"translate"),p.Sb(),p.Tb(4,"span",8),p.Oc(5),p.Sb(),p.Sb(),p.Mc(6,zt,6,4,"div",21),p.Tb(7,"div",20),p.Tb(8,"h6",7),p.Oc(9),p.gc(10,"translate"),p.Sb(),p.Tb(11,"span",8),p.Oc(12),p.gc(13,"date"),p.Sb(),p.Sb(),p.Mc(14,At,7,7,"div",21)),2&i){const i=p.fc();p.Bb(2),p.Pc(p.hc(3,6,"UMA.INTESTAZIONE.ID_RICHIESTA")),p.Bb(3),p.Pc(null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.id),p.Bb(1),p.mc("ngIf",null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.idRettificata),p.Bb(3),p.Pc(p.hc(10,8,"UMA.INTESTAZIONE.DATA_INSERIMENTO")),p.Bb(3),p.Pc(p.ic(13,10,null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.dataPresentazione,"dd/MM/yyyy")),p.Bb(2),p.mc("ngIf",null==i.richiestaOrDichiarazione?null:i.richiestaOrDichiarazione.dataProtocollazione)}}const Rt=function(){return{marginTop:"70px"}};let Dt=(()=>{class i{constructor(i,e,t,o,a){this.httpClientDomandaUma=i,this.httpClientDichiarazioneConsumiUmaService=e,this.httpClientAnagraficaService=t,this.activeRoute=o,this.errorService=a}ngOnInit(){this.tipoIntestazioneEnum=gt.a,this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>{const e=i.idDomanda||i.id;let t=null;return null!=i.idDomanda?(this.isRichiestaOrRettifica=!0,t=this.httpClientDomandaUma.getDomandaById(e)):(this.isRichiestaOrRettifica=!1,t=this.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(e)),t}),Object(s.a)(i=>(this.errorService.showError(i,"tst-intestazione-uma"),n.a)),Object(r.a)(i=>(this.richiestaOrDichiarazione=i,this.httpClientAnagraficaService.getFascicoloAgs(this.richiestaOrDichiarazione.cuaa)))).subscribe(i=>{this.richiestaOrDichiarazione.denominazione=i.denominazione,this.setTemplateIntestazioneByType(this.ctx==gt.a.GESTIONE_CARBURANTE_IN_ESUBERO?gt.a.GESTIONE_CARBURANTE_IN_ESUBERO:this.isRichiestaOrRettifica?gt.a.RICHIESTA:gt.a.DICHIARAZIONE_CONSUMI)},i=>this.errorService.showError(i,"tst-intestazione-uma"))}ngOnChanges(i){i&&i.ctx&&i.ctx.currentValue&&this.setTemplateIntestazioneByType(i.ctx.currentValue)}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}setTemplateIntestazioneByType(i){this.title=i===gt.a.GESTIONE_CARBURANTE_IN_ESUBERO?vt.a.INTESTAZIONE.titleGestioneCarburanteInEsubero:i===gt.a.DICHIARAZIONE_CONSUMI?vt.a.INTESTAZIONE.titleDichiarazione:this.richiestaOrDichiarazione&&null!=this.richiestaOrDichiarazione.idRettificata?vt.a.INTESTAZIONE.titleRettifica:vt.a.INTESTAZIONE.titleRichiesta}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(b.a),p.Nb(se.a),p.Nb(ft),p.Nb(z.a),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-intestazione-uma"]],inputs:{ctx:"ctx"},features:[p.zb],decls:37,vars:24,consts:[["key","tst-intestazione-uma"],[1,"p-grid"],[1,"p-grid","no-gutters","tophome"],[1,"ui-grid-fixed"],[1,"d-flex","justify-content-between","align-items-center"],[1,"subhome"],[1,"p-col-3","border-r"],[1,"mb-0"],[1,"fw-700"],[1,"p-col-6","border-r","d-flex","flex-column"],[1,"fw-700","d-block"],[1,"p-col-3"],[1,"d-flex","align-items-center"],[1,"mb-0","mr-2"],[1,"d-flex","align-items-center",2,"padding","8px 0 0 0"],[1,"btn","btn-outline-light"],[4,"ngIf","ngIfThen","ngIfElse"],["dichiarazioneTpl",""],["richiestaTpl",""],[1,"p-grid","no-gutters","h-15m"],[1,"box-border-bottom"],["class","box-border-bottom",4,"ngIf"]],template:function(i,e){if(1&i&&(p.Ob(0,"p-toast",0),p.Tb(1,"div",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"h4"),p.Oc(6),p.Sb(),p.Sb(),p.Tb(7,"div",5),p.Tb(8,"div",1),p.Tb(9,"div",6),p.Tb(10,"h6",7),p.Oc(11),p.gc(12,"uppercase"),p.gc(13,"translate"),p.Sb(),p.Tb(14,"span",8),p.Oc(15),p.Sb(),p.Sb(),p.Tb(16,"div",9),p.Tb(17,"h6",7),p.Oc(18),p.gc(19,"translate"),p.Sb(),p.Tb(20,"span",10),p.Oc(21),p.Sb(),p.Sb(),p.Tb(22,"div",11),p.Tb(23,"div",12),p.Tb(24,"h6",13),p.Oc(25),p.gc(26,"translate"),p.Sb(),p.Sb(),p.Tb(27,"div",14),p.Tb(28,"span",15),p.Oc(29),p.gc(30,"replaceWithSpaceBy"),p.Sb(),p.Sb(),p.Mc(31,Ct,1,0,"ng-container",16),p.Mc(32,It,14,10,"ng-template",null,17,p.Nc),p.Mc(34,Et,15,13,"ng-template",null,18,p.Nc),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Ob(36,"div",19),p.Sb()),2&i){const i=p.Bc(33),t=p.Bc(35);p.Kc(p.rc(23,Rt)),p.Bb(6),p.Pc(e.title),p.Bb(5),p.Qc("",p.hc(12,12,p.hc(13,14,"UMA.INTESTAZIONE.CUAA")),":"),p.Bb(4),p.Qc(" ",null==e.richiestaOrDichiarazione?null:e.richiestaOrDichiarazione.cuaa," "),p.Bb(3),p.Qc("",p.hc(19,16,"UMA.INTESTAZIONE.DENOMINAZIONE"),":"),p.Bb(3),p.Qc(" ",null==e.richiestaOrDichiarazione?null:e.richiestaOrDichiarazione.denominazione," "),p.Bb(4),p.Qc("",p.hc(26,18,"UMA.INTESTAZIONE.STATO_DOMANDA"),":"),p.Bb(4),p.Qc(" ",p.ic(30,20,null==e.richiestaOrDichiarazione?null:e.richiestaOrDichiarazione.stato,"_")," "),p.Bb(2),p.mc("ngIf",e.ctx===e.tipoIntestazioneEnum.DICHIARAZIONE_CONSUMI)("ngIfThen",i)("ngIfElse",t)}},directives:[E.a,o.t],pipes:[o.G,ni.d,St.a,o.f],styles:['[_nghost-%COMP%]   .h-15m[_ngcontent-%COMP%]{height:15em}[_nghost-%COMP%]   .h-11m[_ngcontent-%COMP%]{height:11em}[_nghost-%COMP%]   .box-border-bottom[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:space-between}[_nghost-%COMP%]   .box-border-bottom[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;bottom:8px;width:100%;border-bottom:1px dashed #fff}[_nghost-%COMP%]   .box-border-bottom[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{position:relative;z-index:1;display:inline-block;padding:2px;background-color:#0d5f3f}[_nghost-%COMP%]   span.btn.btn-outline-light[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   span.btn.btn-outline-light[_ngcontent-%COMP%]:hover{border-color:hsla(0,0%,100%,.3);background-color:transparent;color:#f8f9fa}']}),i})(),Mt=(()=>{class i{constructor(){}ngOnInit(){this.tipoIntestazioneEnum=gt.a}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=p.Hb({type:i,selectors:[["app-gestione-domanda-uma"]],decls:2,vars:1,consts:[[3,"ctx"]],template:function(i,e){1&i&&(p.Ob(0,"app-intestazione-uma",0),p.Ob(1,"router-outlet")),2&i&&p.mc("ctx",null==e.tipoIntestazioneEnum?null:e.tipoIntestazioneEnum.RICHIESTA)},directives:[Dt,z.j],styles:[""]}),i})(),Nt=(()=>{class i{constructor(){}ngOnInit(){this.tipoIntestazioneEnum=gt.a}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=p.Hb({type:i,selectors:[["app-gestione-dichiarazione-consumi"]],decls:2,vars:1,consts:[[3,"ctx"]],template:function(i,e){1&i&&(p.Ob(0,"app-intestazione-uma",0),p.Ob(1,"router-outlet")),2&i&&p.mc("ctx",null==e.tipoIntestazioneEnum?null:e.tipoIntestazioneEnum.DICHIARAZIONE_CONSUMI)},directives:[Dt,z.j],styles:[""]}),i})();var Bt=function(i){return i.PRELIEVI="PRELIEVI",i.CLIENTI_CONTOTERZI="CLIENTI_CONTOTERZI",i.RICEVUTI="RICEVUTI",i.CONSUMI="CONSUMI",i.TRASFERIMENTI="TRASFERIMENTI",i}({});function yt(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",28),p.Tb(1,"button",29),p.bc("click",(function(){return p.Ec(i),p.fc().scaricaDichiarazioneConsumiFile()})),p.Sb(),p.Sb()}}function _t(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",28),p.Tb(1,"button",30),p.bc("click",(function(){return p.Ec(i),p.fc().eliminaDichiarazione()})),p.Sb(),p.Sb()}}function Ft(i,e){if(1&i&&(p.Tb(0,"div",31),p.Ob(1,"p-message",32),p.gc(2,"date"),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.pc("text","",i.umaMessages.prelieviOltreDataScadenza," ",p.ic(2,2,null==i.dichiarazioneConsumiDto?null:i.dichiarazioneConsumiDto.dataLimitePrelievi,"dd/MM/yyyy"),"")}}const Pt=function(){return{marginTop:"70px"}},wt=function(i,e){return{"p-col":i,"p-col-fixed":e}};let xt=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c,l){this.dateUtilService=i,this.httpClientDichiarazioneConsumiUmaService=e,this.activeRoute=t,this.indiceUmaService=o,this.router=a,this.messageService=n,this.confirmationService=r,this.errorService=s,this.authService=c,this.navigatorService=l,this.sezioni=Bt,this.umaMessages=g.a}ngOnInit(){this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>(this.idFascicolo=i.idFascicolo,this.indiceUmaService.idFascicolo=i.idFascicolo,this.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(i.id)))).subscribe(i=>{this.dichiarazioneConsumiDto=i,this.setPageStatus(i)},i=>this.errorService.showError(i))}setPageStatus(i){i.stato===le.a.IN_COMPILAZIONE&&this.authService.userSelectedRole!==C.a.roleIstruttoreUMA&&this.authService.userSelectedRole!==C.a.roleAppag&&this.authService.userSelectedRole!==C.a.roleViewerPAT&&this.authService.userSelectedRole!==C.a.roleAltroEnte?(this.indiceUmaService.READONLY_MODE_DICHIARAZIONE=!1,this.isInCompilazione=!0,this.mostraScarica=!1):(this.indiceUmaService.READONLY_MODE_DICHIARAZIONE=!0,this.isInCompilazione=!1,this.mostraScarica=i.stato!==le.a.IN_COMPILAZIONE),localStorage.setItem("UMA_RO_DICH",this.indiceUmaService.READONLY_MODE_DICHIARAZIONE.toString())}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe(),this.getDomandeSubscription&&this.getDomandeSubscription.unsubscribe(),this.getConsuntiviSubscription&&this.getConsuntiviSubscription.unsubscribe()}eliminaDichiarazione(){this.confirmationService.confirm({message:g.a.confermaCancellazioneDichiarazioneConsumi,accept:()=>{this.confermaEliminaDichiarazione()},reject:()=>{},key:"cancellazione-dichiarazione-dialog"})}isCaa(){return this.authService.userSelectedRole===C.a.roleCaa}confermaEliminaDichiarazione(){this.deleteSubscription=this.httpClientDichiarazioneConsumiUmaService.deleteDichiarazioneConsumi(this.dichiarazioneConsumiDto.id.toString()).subscribe(()=>{this.messageService.add(c.a.getToast("tst",c.b.success,g.a.cancellazioneDichiarazioneConsumiOK))},i=>this.errorService.showError(i))}onCloseToastCancellazione(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo)}onClickBox(i){switch(i){case Bt.PRELIEVI:this.router.navigate(["prelievi"],{relativeTo:this.activeRoute.parent});break;case Bt.CLIENTI_CONTOTERZI:this.router.navigate(["clienti-contoterzi"],{relativeTo:this.activeRoute.parent});break;case Bt.RICEVUTI:this.router.navigate(["ricevuti"],{relativeTo:this.activeRoute.parent});break;case Bt.CONSUMI:this.router.navigate(["consumi"],{relativeTo:this.activeRoute.parent});break;case Bt.TRASFERIMENTI:this.router.navigate(["trasferimenti"],{relativeTo:this.activeRoute.parent})}}scaricaDichiarazioneConsumiFile(){this.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiFile(this.dichiarazioneConsumiDto.id.toString()).subscribe(i=>{I.saveAs(new Blob([i],{type:"application/pdf"}),this.dichiarazioneConsumiDto.id.toString()+"_dichiarazioneconsumi.pdf")},i=>{console.log("ERRORE: ",i),this.messageService.add(c.a.getToast("tst-valida",c.b.error,"Errore imprevisto. Si prega di riprovare pi\xf9 tardi"))})}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(u.a),p.Nb(se.a),p.Nb(z.a),p.Nb(f),p.Nb(z.e),p.Nb(A.d),p.Nb(A.a),p.Nb(T.a),p.Nb(C.a),p.Nb(ae.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-sezioni-dichiarazione-consumi"]],decls:48,vars:33,consts:[["position","top-center","key","tst",3,"modal","baseZIndex","onClose"],["key","tst-valida"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","cancellazione-dichiarazione-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","rettifica-error-dialog","acceptLabel","OK","rejectLabel","Annulla","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible",3,"closable"],[1,"ui-grid-fixed","mt-5"],[1,"boxgrey"],[1,"p-col","block-100"],[1,"ui-header-sezioni-uma"],[1,"auto-cursor"],[1,"p-grid","p-justify-between","m-0"],[1,"p-grid","p-align-center","m-0","p-2"],[1,"p-col","p-col-align-center"],[1,"p-grid","m-0"],["class","p-col",4,"ngIf"],[1,"p-grid","cell","p-nogutter"],[1,"p-col-6","p-0","cell-content","border-bottom","border-right"],[1,"p-grid","p-align-center","m-0"],[1,"w-10m",3,"ngClass","click"],["src","assets/img/icons/uma-icon/icon-prelievi.svg",1,"d-inline-block","mr-3"],["class","p-col text-right",4,"ngIf"],[1,"p-col-6","p-0","cell-content","border-bottom"],[1,"p-col",3,"click"],["src","assets/img/icons/uma-icon/icon-contoterzi.svg",1,"d-inline-block","mr-3"],["src","assets/img/icons/uma-icon/icon-ricevuti.svg",1,"d-inline-block","mr-3"],["src","assets/img/icons/uma-icon/icon-consumi.svg",1,"d-inline-block","mr-3"],[1,"p-col-6","p-0","cell-content","border-right"],["src","assets/img/icons/uma-icon/icon-trasferimenti.svg",1,"d-inline-block","mr-3"],[1,"p-col-6","p-0","cursor-text"],[1,"p-col"],["pButton","","icon","pi pi-file-pdf","iconPos","right","type","button","label","SCARICA",1,"w-10m","ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],["pButton","","icon","pi pi-trash","iconPos","right","type","button","label","ELIMINA",1,"w-10m","ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],[1,"p-col","text-right"],["severity","warn",1,"light-message","cursor-text",3,"text"]],template:function(i,e){1&i&&(p.Tb(0,"p-toast",0),p.bc("onClose",(function(){return e.onCloseToastCancellazione()})),p.Sb(),p.Ob(1,"p-toast",1),p.Ob(2,"p-confirmDialog",2),p.Ob(3,"p-confirmDialog",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Tb(7,"div",7),p.Tb(8,"a",8),p.Tb(9,"div",9),p.Tb(10,"div",10),p.Tb(11,"div",11),p.Tb(12,"strong"),p.Oc(13),p.gc(14,"uppercase"),p.gc(15,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Tb(16,"div",12),p.Mc(17,yt,2,0,"div",13),p.Mc(18,_t,2,0,"div",13),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(19,"div",14),p.Tb(20,"div",15),p.Tb(21,"div",16),p.Tb(22,"div",17),p.bc("click",(function(){return e.onClickBox(e.sezioni.PRELIEVI)})),p.Ob(23,"img",18),p.Oc(24),p.gc(25,"translate"),p.Sb(),p.Mc(26,Ft,3,5,"div",19),p.Sb(),p.Sb(),p.Tb(27,"div",20),p.Tb(28,"div",21),p.bc("click",(function(){return e.onClickBox(e.sezioni.CLIENTI_CONTOTERZI)})),p.Ob(29,"img",22),p.Oc(30),p.gc(31,"translate"),p.Sb(),p.Sb(),p.Tb(32,"div",15),p.Tb(33,"div",21),p.bc("click",(function(){return e.onClickBox(e.sezioni.RICEVUTI)})),p.Ob(34,"img",23),p.Oc(35),p.gc(36,"translate"),p.Sb(),p.Sb(),p.Tb(37,"div",20),p.Tb(38,"div",21),p.bc("click",(function(){return e.onClickBox(e.sezioni.CONSUMI)})),p.Ob(39,"img",24),p.Oc(40),p.gc(41,"translate"),p.Sb(),p.Sb(),p.Tb(42,"div",25),p.Tb(43,"div",21),p.bc("click",(function(){return e.onClickBox(e.sezioni.TRASFERIMENTI)})),p.Ob(44,"img",26),p.Oc(45),p.gc(46,"translate"),p.Sb(),p.Sb(),p.Ob(47,"div",27),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.mc("modal",!0)("baseZIndex",5e4),p.Bb(1),p.Kc(p.rc(29,Pt)),p.Bb(2),p.mc("closable",!1),p.Bb(10),p.Pc(p.hc(14,15,p.hc(15,17,"UMA.DICHIARAZIONE_CONSUMI.DICHIARAZIONE_CONSUMI"))),p.Bb(4),p.mc("ngIf",e.mostraScarica),p.Bb(1),p.mc("ngIf",e.isInCompilazione),p.Bb(4),p.mc("ngClass",p.tc(30,wt,!(null!=e.dichiarazioneConsumiDto&&e.dichiarazioneConsumiDto.haPrelieviOltreLimite),null==e.dichiarazioneConsumiDto?null:e.dichiarazioneConsumiDto.haPrelieviOltreLimite)),p.Bb(2),p.Qc(" ",p.hc(25,19,"UMA.DICHIARAZIONE_CONSUMI.PRELIEVI")," "),p.Bb(2),p.mc("ngIf",(null==e.dichiarazioneConsumiDto?null:e.dichiarazioneConsumiDto.haPrelieviOltreLimite)&&e.isCaa()),p.Bb(4),p.Qc(" ",p.hc(31,21,"UMA.DICHIARAZIONE_CONSUMI.CLIENTI_CONTOTERZI")," "),p.Bb(5),p.Qc(" ",p.hc(36,23,"UMA.DICHIARAZIONE_CONSUMI.RICEVUTI")," "),p.Bb(5),p.Qc(" ",p.hc(41,25,"UMA.DICHIARAZIONE_CONSUMI.DICHIARAZIONE_CONSUMI")," "),p.Bb(5),p.Qc(" ",p.hc(46,27,"UMA.DICHIARAZIONE_CONSUMI.TRASFERIMENTI")," "))},directives:[E.a,R.a,o.t,o.q,M.b,he.b],pipes:[o.G,ni.d,o.f],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .cursor-text[_ngcontent-%COMP%]{cursor:text}[_nghost-%COMP%]     .light-message>div{border-radius:.75em;background-color:#fff;color:#a1887f;border:3px solid #ffba01}[_nghost-%COMP%]     .light-message>div>span.ui-message-icon{color:#ffba01}[_nghost-%COMP%]   .cell[_ngcontent-%COMP%]{border:1px solid #cacaca;cursor:pointer}[_nghost-%COMP%]   .cell.disabled[_ngcontent-%COMP%] > .cell-content[_ngcontent-%COMP%]{opacity:.5;cursor:auto}[_nghost-%COMP%]   .cell-content[_ngcontent-%COMP%]{color:#01985a}[_nghost-%COMP%]   .cell-content[_ngcontent-%COMP%]:hover{background-color:#e8f5e9}[_nghost-%COMP%]   div.ui-header-sezioni-uma[_ngcontent-%COMP%]{background-color:#fff;border-top:2px solid #4caf50;border-left:1px solid #cacaca;border-right:1px solid #cacaca;font-size:1em}[_nghost-%COMP%]   .block-100[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.pi{color:#01985a!important;font-size:x-large!important}[_nghost-%COMP%]     .ui-toast-message-custom{background-color:#fff;color:#4caf50}[_nghost-%COMP%]     .ui-toast-message-custom .ui-toast-close-icon{color:#4caf50}[_nghost-%COMP%]     .ui-dialog>.ui-dialog-content>.ui-confirmdialog-message{white-space:pre-line}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),i})();var Lt=t("0WKn");const Gt=function(){return{marginTop:"70px"}};let Ut=(()=>{class i{constructor(i,e,t,o,a,n,r){this.indiceUmaService=i,this.location=e,this.route=t,this.httpClientDichiarazioneConsumiUmaService=o,this.httpClientDomandaUmaService=a,this.prelieviBuilderService=n,this.errorService=r}ngOnInit(){this.initVariables(),this.routerSubscription=this.route.params.pipe(Object(r.a)(i=>(this.idDichiarazione=i.id,this.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(this.idDichiarazione))),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>this.httpClientDomandaUmaService.getPrelieviByCuaaAndCampagna(i.cuaa,i.campagnaRichiesta.toString()))).subscribe(i=>{this.datasource=this.prelieviBuilderService.prelieviDtoToPrelieviViewModelBuilder(i.dati)},i=>this.errorService.showError(i))}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}goBack(){this.location.back()}initVariables(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.titles=[{name:"Distributore",width:"62%",align:K.c.CENTER},{name:"Prelievo",width:"38%",align:K.c.CENTER}],this.cols=this.defineColumns()}defineColumns(){return[{field:"distributoreNome",header:"Distributore",sortable:!0,font:K.e.BOLD,width:"38%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"distributoreIndirizzo",header:"Indirizzo",sortable:!1,font:K.e.BOLD,width:"24%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"data",header:"Data prelievo",sortable:!0,width:"12%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:N.a.GASOLIO.toLocaleLowerCase(),header:"Gasolio",sortable:!1,width:"8%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:N.a.BENZINA.toLocaleLowerCase(),header:"Benzina",sortable:!1,width:"8%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"gasolioSerre",header:"Gasolio serre",sortable:!1,width:"10%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(f),p.Nb(o.n),p.Nb(z.a),p.Nb(se.a),p.Nb(b.a),p.Nb(Lt.a),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-prelievi"]],decls:19,vars:11,consts:[["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-prelievi_black.svg"],[1,"ml-2"],[1,"fs-20"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"titles","cols","values"]],template:function(i,e){1&i&&(p.Ob(0,"p-toast",0),p.Tb(1,"div",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Tb(7,"a",7),p.bc("click",(function(){return e.goBack()})),p.Ob(8,"i",8),p.Ob(9,"img",9),p.Tb(10,"span",10),p.Tb(11,"strong",11),p.Oc(12),p.gc(13,"uppercase"),p.gc(14,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(15,"div",12),p.Tb(16,"div",13),p.Tb(17,"div",14),p.Ob(18,"app-a4g-multi-table",15),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Kc(p.rc(10,Gt)),p.Bb(12),p.Pc(p.hc(13,6,p.hc(14,8,"UMA.DICHIARAZIONE_CONSUMI.PRELIEVI"))),p.Bb(6),p.mc("titles",e.titles)("cols",e.cols)("values",e.datasource))},directives:[E.a,z.h,ai.a],pipes:[o.G,ni.d],styles:[""]}),i})();var kt=t("mrSG"),Vt=function(i){return i.AMMISSIBILE_GASOLIO_TERZI="AMMISSIBILE_GASOLIO_TERZI",i.RECUPERO_GASOLIO_PROPRIO="RECUPERO_GASOLIO_PROPRIO",i.RECUPERO_GASOLIO_TERZI="RECUPERO_GASOLIO_TERZI",i.RECUPERO_BENZINA="RECUPERO_BENZINA",i.RECUPERO_GASOLIO_SERRE="RECUPERO_GASOLIO_SERRE",i}({}),Ht=function(i){return i.FURTO="FURTO",i.UTILIZZO_IMPROPRIO="UTILIZZO_IMPROPRIO",i.ASSEGNAZIONE_SVINCOLATA="ASSEGNAZIONE_SVINCOLATA",i.ALTRO="ALTRO",i}({}),Zt=t("6AgI"),jt=t("A+aF"),Yt=t("BGwN");const $t=["dialogRecupero"],qt=["fileCaricato"];function Qt(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",21),p.bc("click",(function(){return p.Ec(i),p.fc(2).caricaAllegato()})),p.Sb()}if(2&i){const i=p.fc(2);p.mc("disabled",(null==i.motivazioneConsuntiviDto||null==i.motivazioneConsuntiviDto.allegati?null:i.motivazioneConsuntiviDto.allegati.length)>4)}}function Kt(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",5),p.Tb(1,"div",6),p.Tb(2,"strong"),p.Oc(3,"Allega documentazione"),p.Sb(),p.Oc(4," (obbligatoria) "),p.Sb(),p.Tb(5,"div",17),p.Mc(6,Qt,1,1,"button",18),p.Tb(7,"input",19,20),p.bc("change",(function(e){return p.Ec(i),p.fc().onFileChange(e)})),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(6),p.mc("ngIf",!i.READONLY_MODE),p.Bb(1),p.nc("accept",i.fileConfig.fileExt)}}function Wt(i,e){1&i&&(p.Tb(0,"th",27),p.Ob(1,"strong"),p.Sb())}function Jt(i,e){if(1&i&&(p.Tb(0,"tr"),p.Mc(1,Wt,2,0,"th",25),p.Tb(2,"th",26),p.Tb(3,"strong"),p.Oc(4,"File"),p.Sb(),p.Sb(),p.Sb()),2&i){const i=p.fc(2);p.Bb(1),p.mc("ngIf",!i.READONLY_MODE)}}function Xt(i,e){if(1&i){const i=p.Ub();p.Tb(0,"td"),p.Tb(1,"img",30),p.bc("click",(function(){p.Ec(i);const e=p.fc(),t=e.rowIndex,o=e.$implicit;return p.fc(2).eliminaAllegato(t,o)})),p.Sb(),p.Sb()}}function io(i,e){if(1&i){const i=p.Ub();p.Tb(0,"tr"),p.Mc(1,Xt,2,0,"td",28),p.Tb(2,"td"),p.Tb(3,"span"),p.Tb(4,"a",29),p.bc("click",(function(){p.Ec(i);const t=e.rowIndex,o=e.$implicit;return p.fc(2).visualizzaAllegato(t,o)})),p.Oc(5),p.Sb(),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit,t=p.fc(2);p.Bb(1),p.mc("ngIf",!t.READONLY_MODE),p.Bb(4),p.Qc(" ",i.name," ")}}function eo(i,e){if(1&i&&(p.Tb(0,"div",6),p.Tb(1,"p-table",22),p.Mc(2,Jt,5,1,"ng-template",23),p.Mc(3,io,6,2,"ng-template",24),p.Sb(),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("value",i.motivazioneConsuntiviDto.allegati)}}const to=function(){return{"overflow-y":"auto","overflow-x":"hidden","max-height":"90%",height:"auto"}},oo=function(){return{marginTop:"70px"}};let ao=(()=>{class i{constructor(i,e,t,o){this.messageService=i,this.fileService=e,this.httpClientDichiarazioneConsumiUmaService=t,this.indiceUmaService=o,this.chiudiPopup=new p.n,this.motivazioneEnum=Ht}ngOnInit(){this.intestazionePopup="Motivo recupero",this.fileConfig=this.fileService.loadConfigPdf(),this.motivazioneForm=new L.j({tipo:new L.g(null)})}open(i,e){this.display=!0,this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.tipoMotivazione=i,null!=e&&null!=e.allegati&&e.allegati.length?(this.motivazioneConsuntiviDto=W.cloneDeep(e),this.motivazioneForm.get("tipo").setValue(e.motivazione)):this.initValue()}caricaAllegato(){document.getElementById("fileCaricato").click()}eliminaAllegato(i,e){this.motivazioneConsuntiviDto&&this.motivazioneConsuntiviDto.allegati&&1==this.motivazioneConsuntiviDto.allegati.length?this.messageService.add(c.a.getToast("tst-allegati",c.b.error,g.a.FILE_ERRORS.NO_ALLEGATI)):this.motivazioneConsuntiviDto&&this.motivazioneConsuntiviDto.allegati&&this.motivazioneConsuntiviDto.allegati.length>1&&this.motivazioneConsuntiviDto.allegati.splice(i,1)}salva(i){if(null==this.motivazioneForm.get("tipo").value)return void this.messageService.add(c.a.getToast("tst-allegati",c.b.error,g.a.motivazioneNotSeleziona));if(!this.motivazioneConsuntiviDto.allegati||this.motivazioneConsuntiviDto.allegati&&!this.motivazioneConsuntiviDto.allegati.length)return void this.messageService.add(c.a.getToast("tst-allegati",c.b.error,g.a.FILE_ERRORS.NO_ALLEGATI));this.motivazioneConsuntiviDto.motivazione=this.motivazioneForm.get("tipo").value;const e=W.cloneDeep(this.motivazioneConsuntiviDto);this.chiudiPopup.emit({tipo:this.tipoMotivazione,motivazioneConsuntivoDto:e}),this.display=!1}annulla(){this.motivazioneConsuntiviDto=null,this.display=!1}visualizzaAllegato(i,e){if(null!=e&&null==e.idAllegato){const i=URL.createObjectURL(e.file);I.saveAs(e.file,e.file.name),e.file.type===Zt.a.PDF&&window.open(i)}else null!=e.idAllegato?this.httpClientDichiarazioneConsumiUmaService.getAllegatoConsuntivo(e.idDichiarazione,e.idConsuntivo,e.idAllegato).subscribe(i=>{const e=URL.createObjectURL(i);window.open(e)}):console.log("Allegato non trovato!!!")}onFileChange(i){if(i.target.files&&i.target.files.length>0){const e=i.target.files[0],t=new Fe.a(this.fileConfig.fileExt,this.fileConfig.maxSize);if(e.name.indexOf("$$")>-1)return void this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.SPECIAL_CHAR));if(e.name.length>50)return void this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.FILENAME));if(!t.isValidFileExtension(e))return void this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.EXT_PDF));if(!t.isValidFileSize(e))return void this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.SIZE));this.motivazioneConsuntiviDto.allegati.push({file:e,name:e.name,idAllegato:null}),this.dialog.center()}}initValue(){this.motivazioneConsuntiviDto={},this.motivazioneConsuntiviDto.allegati=[],this.motivazioneForm.get("tipo").setValue(null)}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(A.d),p.Nb(we.a),p.Nb(se.a),p.Nb(f))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-popup-motivo-recupero"]],viewQuery:function(i,e){var t;1&i&&(p.Jc($t,!0),p.Uc(qt,!0)),2&i&&(p.Ac(t=p.cc())&&(e.dialog=t.first),p.Ac(t=p.cc())&&(e.file=t.first))},outputs:{chiudiPopup:"chiudiPopup"},decls:28,vars:21,consts:[["id","popup-motivo-recupero","showEffect","fade","styleClass","small-dialog",3,"visible","modal","closable","blockScroll","contentStyle","header","visibleChange"],["dialogRecupero",""],["key","tst-dialog"],["key","tst-allegati"],["novalidate","",3,"formGroup"],[1,"p-grid","p-align-center"],[1,"p-col"],[1,"p-grid","m-0","px-4"],["formControlName","tipo","label","Furto",3,"disabled","value"],["formControlName","tipo","label","Utilizzo improprio",3,"disabled","value"],[1,"p-grid"],["class","p-grid p-align-center",4,"ngIf"],["class","p-col",4,"ngIf"],[1,"p-grid","p-justify-end"],["pButton","","type","button","label","Annulla",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none","w-5m",3,"click"],[1,"pr-0_5m"],["pButton","","type","button","label","Salva",1,"ui-button-text-only","p-1","text-uppercase","font-weight-normal","shadow-none","w-5m",3,"disabled","click"],[1,"p-col-fixed","pr-0_5m"],["pButton","","type","button","class","w-10m","label","CARICA ALLEGATO",3,"disabled","click",4,"ngIf"],["type","file","id","fileCaricato","name","fileCaricato","onclick","this.value = null",1,"inputUploadFile",2,"display","none",3,"accept","change"],["fileCaricato",""],["pButton","","type","button","label","CARICA ALLEGATO",1,"w-10m",3,"disabled","click"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["width","5%",4,"ngIf"],["width","95%"],["width","5%"],[4,"ngIf"],["target","_blank",1,"cursor-pointer","p-col",3,"click"],["src","assets/img/ico-x.jpg",1,"cursor-pointer",3,"click"]],template:function(i,e){if(1&i&&(p.Tb(0,"p-dialog",0,1),p.bc("visibleChange",(function(i){return e.display=i})),p.Ob(2,"p-toast",2),p.Ob(3,"p-toast",3),p.Tb(4,"form",4),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Tb(7,"div",5),p.Tb(8,"div",6),p.Tb(9,"strong"),p.Oc(10,"Motivazione"),p.Sb(),p.Oc(11," (obbligatoria) "),p.Sb(),p.Tb(12,"div",7),p.Ob(13,"p-radioButton",8),p.Sb(),p.Tb(14,"div",7),p.Ob(15,"p-radioButton",9),p.Sb(),p.Sb(),p.Tb(16,"div",10),p.Tb(17,"div",6),p.Ob(18,"hr"),p.Sb(),p.Sb(),p.Mc(19,Kt,9,2,"div",11),p.Sb(),p.Sb(),p.Tb(20,"div",5),p.Mc(21,eo,4,1,"div",12),p.Sb(),p.Ob(22,"br"),p.Tb(23,"div",13),p.Tb(24,"div"),p.Tb(25,"button",14),p.bc("click",(function(){return e.annulla()})),p.Sb(),p.Sb(),p.Tb(26,"div",15),p.Tb(27,"button",16),p.bc("click",(function(i){return e.salva(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i){var t;const i=null!=(null==(t=e.motivazioneForm.get("tipo"))?null:t.value);p.nc("header",e.intestazionePopup),p.mc("visible",e.display)("modal",!0)("closable",!1)("blockScroll",!0)("contentStyle",p.rc(18,to)),p.Bb(2),p.Kc(p.rc(19,oo)),p.Bb(1),p.Kc(p.rc(20,oo)),p.Bb(1),p.mc("formGroup",e.motivazioneForm),p.Bb(9),p.nc("value",e.motivazioneEnum.FURTO),p.mc("disabled",e.READONLY_MODE),p.Bb(2),p.nc("value",e.motivazioneEnum.UTILIZZO_IMPROPRIO),p.mc("disabled",e.READONLY_MODE),p.Bb(4),p.mc("ngIf",i),p.Bb(2),p.mc("ngIf",null==e.motivazioneConsuntiviDto||null==e.motivazioneConsuntiviDto.allegati?null:e.motivazioneConsuntiviDto.allegati.length),p.Bb(6),p.mc("disabled",e.READONLY_MODE)}},directives:[jt.a,E.a,L.I,L.t,L.k,Yt.a,L.s,L.i,o.t,M.b,w.q,A.e],styles:["[_nghost-%COMP%]     label.ui-radiobutton-label{margin:0}[_nghost-%COMP%]   .pr-0_5m[_ngcontent-%COMP%]{padding-right:.5em}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]     .small-dialog{width:50vw}"]}),i})();var no=t("Juyb");class ro{}class so{}var co=t("7QKl"),lo=t("1SSY");const uo=["dialog"],bo=["fileCaricato"];function ho(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",22),p.bc("click",(function(){return p.Ec(i),p.fc(2).caricaAllegato()})),p.Sb()}if(2&i){const i=p.fc(2);p.mc("disabled",(null==i.motivoRecuperoAmmissibile||null==i.motivoRecuperoAmmissibile.allegati?null:i.motivoRecuperoAmmissibile.allegati.length)>4)}}function mo(i,e){if(1&i&&(p.Tb(0,"div",20),p.Tb(1,"div",5),p.Tb(2,"strong"),p.Oc(3,"Allega documentazione"),p.Sb(),p.Oc(4," (obbligatoria) "),p.Sb(),p.Mc(5,ho,1,1,"button",21),p.Sb()),2&i){const i=p.fc();p.Bb(5),p.mc("ngIf",!i.READONLY_MODE)}}function po(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",23),p.Tb(1,"div",6),p.Tb(2,"div",11),p.Tb(3,"div",20),p.Tb(4,"div"),p.Tb(5,"h6",24),p.Tb(6,"img",25),p.bc("click",(function(){return p.Ec(i),p.fc().eliminaAllegatoCaricato()})),p.Sb(),p.Tb(7,"span"),p.Tb(8,"a",26),p.bc("click",(function(){p.Ec(i);const e=p.fc();return e.visualizzaAllegatoCaricato(e.index)})),p.Oc(9),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(10,"div",27),p.Tb(11,"input",28),p.bc("ngModelChange",(function(e){return p.Ec(i),p.fc().fileAllegato.descrizione=e})),p.Sb(),p.Sb(),p.Tb(12,"div",27),p.Tb(13,"p-dropdown",29),p.bc("ngModelChange",(function(e){return p.Ec(i),p.fc().tipoDocumento=e})),p.Sb(),p.Sb(),p.Tb(14,"div",9),p.Tb(15,"button",30),p.bc("click",(function(){return p.Ec(i),p.fc().salvaAllegato()})),p.Sb(),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(9),p.Qc(" ",i.fileAllegato.name," "),p.Bb(2),p.mc("ngModel",i.fileAllegato.descrizione),p.Bb(2),p.mc("options",i.tipologicheService.tipiDocumento)("ngModel",i.tipoDocumento),p.Bb(2),p.mc("disabled",!i.validoSalvaAllegato())}}function go(i,e){1&i&&(p.Tb(0,"th",37),p.Ob(1,"strong"),p.Sb())}function fo(i,e){if(1&i&&(p.Tb(0,"tr"),p.Mc(1,go,2,0,"th",34),p.Tb(2,"th",35),p.Tb(3,"strong"),p.Oc(4,"File"),p.Sb(),p.Sb(),p.Tb(5,"th",35),p.Tb(6,"strong"),p.Oc(7,"Descrizione"),p.Sb(),p.Sb(),p.Tb(8,"th",36),p.Tb(9,"strong"),p.Oc(10,"Tipo documento"),p.Sb(),p.Sb(),p.Sb()),2&i){const i=p.fc(2);p.Bb(1),p.mc("ngIf",!i.READONLY_MODE)}}function vo(i,e){if(1&i){const i=p.Ub();p.Tb(0,"td"),p.Tb(1,"img",25),p.bc("click",(function(){p.Ec(i);const e=p.fc().rowIndex;return p.fc(2).eliminaAllegato(e)})),p.Sb(),p.Sb()}}function So(i,e){if(1&i){const i=p.Ub();p.Tb(0,"tr"),p.Mc(1,vo,2,0,"td",38),p.Tb(2,"td"),p.Tb(3,"span"),p.Tb(4,"a",26),p.bc("click",(function(){p.Ec(i);const t=e.$implicit;return p.fc(2).visualizzaAllegato(t)})),p.Oc(5),p.Sb(),p.Sb(),p.Sb(),p.Tb(6,"td"),p.Oc(7),p.Sb(),p.Tb(8,"td"),p.Oc(9),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit,t=p.fc(2);p.Bb(1),p.mc("ngIf",!t.READONLY_MODE),p.Bb(4),p.Qc(" ",i.name," "),p.Bb(2),p.Pc(i.descrizione),p.Bb(2),p.Qc(" ",t.descrizioneTipoDocumento(i.tipoDocumento)," ")}}function Co(i,e){if(1&i&&(p.Tb(0,"div",5),p.Tb(1,"p-table",31),p.Mc(2,fo,11,1,"ng-template",32),p.Mc(3,So,10,4,"ng-template",33),p.Sb(),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("value",i.motivoRecuperoAmmissibile.allegati)}}const Oo=function(){return{"overflow-y":"auto","overflow-x":"hidden","max-height":"90%",height:"auto"}},To=function(){return{marginTop:"70px"}};let Io=(()=>{class i{constructor(i,e,t,o,a,n){this.tipologicheService=i,this.messageService=e,this.httpClientDichiarazioneConsumiUmaService=t,this.fileService=o,this.indiceUmaService=a,this.formatConverte=n,this.chiudiPopup=new p.n,this.motivazioneEnum=Ht,this.SEPARATOR="$$"}ngOnInit(){this.intestazionePopup="Motivo ammesso",this.tipologicheService.setTipiDocumento(),this.fileConfig=this.fileService.loadConfigPdf()}open(i){this.display=!0,this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.tipoMotivazione=Vt.AMMISSIBILE_GASOLIO_TERZI,null!=i&&null!=i.allegati&&i.allegati.length?(this.motivoRecuperoAmmissibile=W.cloneDeep(i),this.motivazione=i.motivazione,this.setDescrizioneAndTipo()):this.initValue()}reset(){this.motivoRecuperoAmmissibile=new ro,this.motivoRecuperoAmmissibile.allegati=[],this.motivazione=null,this.tipoDocumento=null,this.initFile()}setDescrizioneAndTipo(){this.motivoRecuperoAmmissibile.allegati&&this.motivoRecuperoAmmissibile.allegati.length&&this.motivoRecuperoAmmissibile.allegati.forEach(i=>{const e=i.file&&i.file.name&&i.file.name.split(this.SEPARATOR);if(e&&e.length>1){const t=e[1],o=e[2],a=new File([i.file],e[0],{type:i.file.type});i.file=a,i.tipoDocumento=t,i.descrizione=o}})}salva(i){if(!this.motivoRecuperoAmmissibile.allegati||this.motivoRecuperoAmmissibile.allegati&&!this.motivoRecuperoAmmissibile.allegati.length)return void this.messageService.add(c.a.getToast("tst-allegati",c.b.error,g.a.FILE_ERRORS.NO_ALLEGATI));this.motivoRecuperoAmmissibile.motivazione=this.motivazione;const e=W.cloneDeep(this.motivoRecuperoAmmissibile);this.chiudiPopup.emit({idConsuntivo:this.motivoRecuperoAmmissibile.idConsuntivo,tipo:Vt.AMMISSIBILE_GASOLIO_TERZI,motivazioneConsuntivoDto:e}),this.display=!1}annulla(){this.motivoRecuperoAmmissibile=new ro,this.motivoRecuperoAmmissibile.allegati=[],this.motivazione=null,this.tipoDocumento=null,this.initFile(),this.display=!1}caricaAllegato(){document.getElementById("fileCaricato").click(),this.tipoDocumento=null}eliminaAllegato(i){this.motivoRecuperoAmmissibile&&this.motivoRecuperoAmmissibile.allegati&&1==this.motivoRecuperoAmmissibile.allegati.length?this.messageService.add(c.a.getToast("tst-allegati",c.b.error,"E\u2019 obbligatorio aver caricato almeno un allegato")):this.motivoRecuperoAmmissibile&&this.motivoRecuperoAmmissibile.allegati&&this.motivoRecuperoAmmissibile.allegati.length>1&&this.motivoRecuperoAmmissibile.allegati.splice(i,1)}visualizzaAllegato(i){if(null!=i&&null==i.idAllegato){const e=this.removeSeparators(i.file),t=URL.createObjectURL(e);I.saveAs(e,e.name),i.file.type===Zt.a.PDF&&window.open(t)}else null!=i.idAllegato?this.httpClientDichiarazioneConsumiUmaService.getAllegatoConsuntivo(i.idDichiarazione,i.idConsuntivo,i.idAllegato).subscribe(e=>{const t=new Fe.a(this.fileConfig.fileExt,this.fileConfig.maxSize).blobToFile(new Blob([e]),i.name);I.saveAs(t);const o=URL.createObjectURL(e);window.open(o)}):console.log("Allegato non trovato!!!")}removeSeparators(i){const e=i&&i.name.split(this.SEPARATOR);return e&&e.length>1&&e[0].indexOf(this.fileConfig.fileExt)?new File([i],e[0],{type:i.type}):new File([i],i.name,{type:i.type})}initValue(){this.motivoRecuperoAmmissibile||(this.motivoRecuperoAmmissibile=new ro),this.motivoRecuperoAmmissibile.allegati||(this.motivoRecuperoAmmissibile.allegati=[]),this.tipoDocumento=null,this.motivazione=null,this.initFile()}initFile(){this.fileAllegato=new so,this.fileAllegato.name="",this.fileAllegato.file=null,this.fileAllegato.descrizione="",this.fileAllegato.tipoDocumento=null}onFileChange(i){if(i.target.files&&i.target.files.length>0){const e=i.target.files[0],t=new Fe.a(this.fileConfig.fileExt,this.fileConfig.maxSize);if(e.name.indexOf(this.SEPARATOR)>-1)return void(e.name.split(this.SEPARATOR)[0].indexOf(this.fileConfig.fileExt)<0&&this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.SPECIAL_CHAR)));if(e.name.indexOf(this.SEPARATOR)>-1){if(e.name.split(this.SEPARATOR)[0].length>50)return void this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.FILENAME))}else if(e.name.length>50)return void this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.FILENAME));if(!t.isValidFileExtension(e))return void this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.EXT_PDF));if(!t.isValidFileSize(e))return void this.messageService.add(c.a.getToast("tst-dialog",c.b.error,g.a.FILE_ERRORS.SIZE));this.fileAllegato=new so,this.fileAllegato.file=e,this.fileAllegato.name=e.name,this.fileAllegato.descrizione="",this.fileAllegato.tipoDocumento=null,this.dialog.center()}}eliminaAllegatoCaricato(){this.initFile()}visualizzaAllegatoCaricato(i){if(null!=this.fileAllegato.file){const i=URL.createObjectURL(this.fileAllegato.file);I.saveAs(this.fileAllegato.file,this.fileAllegato.file.name),this.fileAllegato.file.type===Zt.a.PDF&&window.open(i)}}validoSalvaAllegato(){return!(this.formatConverte.isEmptyString(this.fileAllegato.descrizione)||!this.tipoDocumento)}salvaAllegato(){this.motivoRecuperoAmmissibile.motivazione=this.motivazione,this.fileAllegato.tipoDocumento=this.tipologicheService.tipiDocumento.find(i=>i===this.tipoDocumento).enum,this.motivoRecuperoAmmissibile.allegati.push(this.fileAllegato),this.initFile()}descrizioneTipoDocumento(i){return this.tipologicheService.tipiDocumento.find(e=>e.enum===i).label}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(co.a),p.Nb(A.d),p.Nb(se.a),p.Nb(we.a),p.Nb(f),p.Nb(Ii.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-popup-allegati-motivo-consumi"]],viewQuery:function(i,e){var t;1&i&&(p.Jc(uo,!0),p.Jc(bo,!0)),2&i&&(p.Ac(t=p.cc())&&(e.dialog=t.first),p.Ac(t=p.cc())&&(e.file=t.first))},outputs:{chiudiPopup:"chiudiPopup"},decls:31,vars:25,consts:[["id","popup-allegati-motivo","showEffect","fade","styleClass","small-dialog",3,"visible","modal","closable","blockScroll","contentStyle","header","dismissableMask","visibleChange"],["dialog",""],["key","tst-dialog"],["key","tst-allegati"],[1,"p-grid","p-align-center"],[1,"p-col"],[1,"p-grid"],[1,"p-col-4"],["name","motivazione","label","Assegnazione Svincolata","inputId","motivazione1",3,"disabled","value","ngModel","ngModelChange"],[1,"p-col-2"],["name","motivazione","label","Altro","inputId","motivazione2",3,"disabled","value","ngModel","ngModelChange"],[1,"p-col-12"],["class","ui-inputgroup",4,"ngIf"],["type","file","id","fileCaricato","name","fileCaricato","onclick","this.value = null",1,"inputUploadFile",2,"display","none",3,"accept","change"],["fileCaricato",""],["class","p-col boxgrey",4,"ngIf"],["class","p-col",4,"ngIf"],[1,"p-grid","p-justify-end"],["pButton","","type","button","label","Annulla",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none","w-5m",3,"click"],["pButton","","type","button","label","Salva",1,"ui-button-text-only","p-1","text-uppercase","font-weight-normal","shadow-none","w-5m",3,"disabled","click"],[1,"ui-inputgroup"],["pButton","","type","button","label","CARICA ALLEGATO",3,"disabled","click",4,"ngIf"],["pButton","","type","button","label","CARICA ALLEGATO",3,"disabled","click"],[1,"p-col","boxgrey"],[1,"text-confirm",2,"padding","0 !important"],["src","assets/img/ico-x.jpg",1,"cursor-pointer",3,"click"],["target","_blank",1,"cursor-pointer","p-col",3,"click"],[1,"p-col-5"],["type","text","pInputText","","placeholder","Aggiungi descrizione file","maxlength","100",1,"bg-white","d-block","w-100",2,"border","1px solid #323232","height","100%",3,"ngModel","ngModelChange"],["placeholder","Tipo documento","optionLabel","label",3,"options","ngModel","ngModelChange"],["pButton","","label","AGGIUNGI",3,"disabled","click"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["width","5%",4,"ngIf"],["width","35%"],["width","25%"],["width","5%"],[4,"ngIf"]],template:function(i,e){1&i&&(p.Tb(0,"p-dialog",0,1),p.bc("visibleChange",(function(i){return e.display=i})),p.Ob(2,"p-toast",2),p.Ob(3,"p-toast",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Tb(7,"div",7),p.Tb(8,"strong"),p.Oc(9,"Motivazione"),p.Sb(),p.Oc(10," (obbligatoria) "),p.Sb(),p.Tb(11,"div",7),p.Tb(12,"p-radioButton",8),p.bc("ngModelChange",(function(i){return e.motivazione=i})),p.Sb(),p.Sb(),p.Tb(13,"div",9),p.Tb(14,"p-radioButton",10),p.bc("ngModelChange",(function(i){return e.motivazione=i})),p.Sb(),p.Sb(),p.Tb(15,"div",11),p.Ob(16,"hr"),p.Sb(),p.Tb(17,"div",11),p.Mc(18,mo,6,1,"div",12),p.Sb(),p.Sb(),p.Tb(19,"input",13,14),p.bc("change",(function(i){return e.onFileChange(i)})),p.Sb(),p.Sb(),p.Sb(),p.Tb(21,"div",4),p.Mc(22,po,16,5,"div",15),p.Sb(),p.Tb(23,"div",4),p.Mc(24,Co,4,1,"div",16),p.Sb(),p.Ob(25,"br"),p.Tb(26,"div",17),p.Tb(27,"div"),p.Tb(28,"button",18),p.bc("click",(function(){return e.annulla()})),p.Sb(),p.Sb(),p.Tb(29,"div"),p.Tb(30,"button",19),p.bc("click",(function(i){return e.salva(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.nc("header",e.intestazionePopup),p.mc("visible",e.display)("modal",!0)("closable",!1)("blockScroll",!0)("contentStyle",p.rc(22,Oo))("dismissableMask",!0),p.Bb(2),p.Kc(p.rc(23,To)),p.Bb(1),p.Kc(p.rc(24,To)),p.Bb(9),p.nc("value",e.motivazioneEnum.ASSEGNAZIONE_SVINCOLATA),p.mc("disabled",e.READONLY_MODE)("ngModel",e.motivazione),p.Bb(2),p.nc("value",e.motivazioneEnum.ALTRO),p.mc("disabled",e.READONLY_MODE)("ngModel",e.motivazione),p.Bb(4),p.mc("ngIf",e.motivazione&&!(null!=e.fileAllegato&&e.fileAllegato.file)),p.Bb(1),p.nc("accept",e.fileConfig.fileExt),p.Bb(3),p.mc("ngIf",null==e.fileAllegato?null:e.fileAllegato.file),p.Bb(2),p.mc("ngIf",null==e.motivoRecuperoAmmissibile||null==e.motivoRecuperoAmmissibile.allegati?null:e.motivoRecuperoAmmissibile.allegati.length),p.Bb(6),p.mc("disabled",0==(null==e.motivoRecuperoAmmissibile||null==e.motivoRecuperoAmmissibile.allegati?null:e.motivoRecuperoAmmissibile.allegati.length)||e.READONLY_MODE))},directives:[jt.a,E.a,Yt.a,L.s,L.v,o.t,M.b,L.c,ue.a,L.n,lo.a,w.q,A.e],styles:["[_nghost-%COMP%]     label.ui-radiobutton-label{margin:0}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:450px;max-height:450px;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.pi{color:#01985a!important;font-size:x-large!important}[_nghost-%COMP%]   p-dropdown[_ngcontent-%COMP%] >   .ui-dropdown{height:100%}[_nghost-%COMP%]   p-dropdown[_ngcontent-%COMP%] >   .ui-dropdown label.ui-dropdown-label{height:100%;font-weight:400!important;padding-top:.3em}[_nghost-%COMP%]   p-dropdown[_ngcontent-%COMP%] >   .ui-dropdown div.ui-corner-right{top:.3em!important;margin:0!important}[_nghost-%COMP%]     .small-dialog{width:50vw}"]}),i})();var zo=function(i){return i.CONSUMATO="CONSUMATO",i.RIMANENZA="RIMANENZA",i.RECUPERO="RECUPERO",i.AMMISSIBILE="AMMISSIBILE",i}({}),Ao=function(i){return i.GASOLIO="GASOLIO",i.BENZINA="BENZINA",i.GASOLIO_SERRE="GASOLIO_SERRE",i.GASOLIO_TERZI="GASOLIO_TERZI",i}({});let Eo=(()=>{class i{constructor(i){this.formatSrv=i}toAllegatoMotivazione(i,e){if(!i||!i.infoAllegati||!i.infoAllegati.length)return null;const t=[];return i.infoAllegati.forEach(o=>{const a={};a.descrizione=o.descrizione||void 0,a.name=o.nome,a.idAllegato=o.id,a.idConsuntivo=i.id,a.idDichiarazione=e,a.tipoDocumento=o.tipoDocumento||void 0,t.push(a)}),t}toFile(i){const e=[];return i&&i.length?(i.forEach(i=>{i.file&&e.push(i.file)}),e):e}toFileWithMetaDati(i,e){const t=[];return i&&i.length?(i.forEach(i=>{if(i.file){const o=new File([i.file],i.file.name+e+i.tipoDocumento+e+i.descrizione,{type:i.file.type});i.file=o,t.push(i.file)}}),t):t}toInfoMetadatoConsuntivo(i){const e=[];return i&&i.length?(i.forEach(i=>{if(!i.file){const t={};t.id=i.idAllegato,e.push(t)}}),e):e}buildConsuntiviDto(i){const e=[],t=Object(kt.d)(i,["accisaMotivo"]);for(const o in t)"ammissibileGasolioContoTerzi"===o?e.push(this.buildConsuntivoDto(t[o],Ao.GASOLIO_TERZI,zo.AMMISSIBILE)):o.indexOf("consumato")>-1?e.push(this.setConsumato(o,t[o])):o.indexOf("rimanenza")>-1?e.push(this.setRimanenza(o,t[o])):o.indexOf("recupero")>-1&&e.push(this.setRecupero(o,t[o]));return e}buildConsuntivoDto(i,e,t,o){const a={};return a.quantita=this.formatSrv.toNumberOrNull(i),a.carburante=e,a.tipo=t,a.motivazione=o&&o.motivazione||void 0,a.infoAllegati=o&&o.allegati&&this.toInfoMetadatoConsuntivo(o.allegati)||void 0,a}buildAllegatiConsuntivoDto(i){let e=[];return e=i&&i.allegati&&this.toInfoMetadatoConsuntivo(i.allegati).map(i=>i.id),e}buildDichiarazioneConsumiPatch(i,e){const t={};return t.dataConduzione=e,t.motivazioneAccisa=i,t}setConsumato(i,e){switch(i){case"consumatoGasolioContoProprio":return this.buildConsuntivoDto(e,Ao.GASOLIO,zo.CONSUMATO);case"consumatoGasolioContoTerzi":return this.buildConsuntivoDto(e,Ao.GASOLIO_TERZI,zo.CONSUMATO);case"consumatoBenzina":return this.buildConsuntivoDto(e,Ao.BENZINA,zo.CONSUMATO);case"consumatoGasolioSerre":return this.buildConsuntivoDto(e,Ao.GASOLIO_SERRE,zo.CONSUMATO)}}setRimanenza(i,e){switch(i){case"rimanenzaDicembreGasolioContoProprio":return this.buildConsuntivoDto(e,Ao.GASOLIO,zo.RIMANENZA);case"rimanenzaDicembreGasolioContoTerzi":return this.buildConsuntivoDto(e,Ao.GASOLIO_TERZI,zo.RIMANENZA);case"rimanenzaDicembreBenzina":return this.buildConsuntivoDto(e,Ao.BENZINA,zo.RIMANENZA);case"rimanenzaDicembreGasolioSerre":return this.buildConsuntivoDto(e,Ao.GASOLIO_SERRE,zo.RIMANENZA)}}setRecupero(i,e){switch(i){case"recuperoGasolioContoProprio":return this.buildConsuntivoDto(e,Ao.GASOLIO,zo.RECUPERO);case"recuperoGasolioContoTerzi":return this.buildConsuntivoDto(e,Ao.GASOLIO_TERZI,zo.RECUPERO);case"recuperoBenzina":return this.buildConsuntivoDto(e,Ao.BENZINA,zo.RECUPERO);case"recuperoGasolioSerre":return this.buildConsuntivoDto(e,Ao.GASOLIO_SERRE,zo.RECUPERO)}}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(Ii.a))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Ro=t("WpDp"),Do=t("4jpa"),Mo=t("kPZZ"),No=t("FVER"),Bo=t("jkBy"),yo=t("a6xG"),_o=function(i){return i.download_dichiarazione="download_dichiarazione",i.carica_dichiarazione_firmata="carica_dichiarazione_firmata",i.protocolla_dichiarazione="protocolla_dichiarazione",i.elimina_allegato="elimina_allegato",i}({});const Fo=["fileInput"],Po=function(){return{overflow:"auto","max-height":"900px"}};let wo=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c){this.httpClientProxy=i,this.httpClientDichiarazioneConsumiUma=e,this.messageService=t,this.fileService=o,this.errorService=a,this.navigatorService=n,this.anagraficaFascicoloService=r,this._configuration=s,this.utentiService=c,this.chiudiPopup=new p.n,this.BUTTONS_ENUM=_o,this.BUTTONS_TYPE_ENUM=He,this.FIRMA_CHECK_DISABLED=!0}ngOnInit(){this.fileConfig=this.fileService.loadConfig(),this.initVariables()}ngOnDestroy(){this.firmaSingolaSubscription&&this.firmaSingolaSubscription.unsubscribe(),this.protocollaDichiarazioneSubscription&&this.protocollaDichiarazioneSubscription.unsubscribe(),this.stampaPrivacySubscription&&this.stampaPrivacySubscription.unsubscribe()}annulla(){this.popupVisibile=!1,this.chiudiPopup.emit()}onFileChange(i,e){if(i.target.files&&i.target.files.length){const t=i.target.files[0],o=new Fe.a(this.fileConfig.fileExt,this.fileConfig.maxSize);o.isValidFileExtension(t,g.a.FILE_ERRORS.EXT)&&o.isValidFileSize(t,g.a.FILE_ERRORS.SIZE)&&(this.firmaSingolaSubscription=this.httpClientProxy.verificaFirmaSingola(t,this.cfRichiedente).subscribe(i=>{this.enableNextFields(e,t),this.haFirma=!0},i=>{this.haFirma=!0,console.log("ERRORE: ",i),this.FIRMA_CHECK_DISABLED?(this.enableNextFields(e,t),this.handleErrorFirma(i,!0)):(this.handleErrorFirma(i,!0),this.fileInput.nativeElement.value=null)})),this.showErrors(o.getErrors())}}onFileChangePrivacy(i,e){if(i.target.files&&i.target.files.length){const t=i.target.files[0],o=new Fe.a(this.fileConfig.fileExt,this.fileConfig.maxSize);o.isValidFileExtension(t,g.a.FILE_ERRORS.EXT)&&o.isValidFileSize(t,g.a.FILE_ERRORS.SIZE)&&(this.firmaSingolaSubscription=this.httpClientProxy.verificaFirmaSingola(t,this.cfRichiedente).subscribe(i=>{this.enableNextFields(e,t)},i=>{console.log("ERRORE: ",i),this.handleErrorFirma(i,!1),this.fileInput.nativeElement.value=null})),this.showErrors(o.getErrors())}}showErrors(i){i&&i.length&&i.forEach(i=>{this.messageService.add(c.a.getToast("tst-dlg",c.b.error,i))})}enableNextFields(i,e){"dichiarazione"===i&&(this.fileDichiarazione.nome=e.name,this.fileDichiarazione.file=e,this.enabledUpload.enableHeader=!0),this.fileDichiarazione.file&&(this.enabledProtocolla.enableButton=!0)}handleErrorFirma(i,e){if(i&&i.error&&i.error.message)switch(i.error.message){case xe.FIRMATARIO_TITOLARE_DIVERSI:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.CODICE_FISCALE_NO_MATCH,"tst-dlg");break;case xe.FILE_NON_FIRMATO:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.NO_FIRMA,"tst-dlg"),e&&(this.haFirma=!1);break;case xe.FIRMA_NON_VALIDA:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.NO_FIRMA_VALIDA,"tst-dlg");break;case xe.DATI_FIRMATARIO_MANCANTI:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.NO_DATI_FIRMATARIO,"tst-dlg");break;case xe.FIRMATARIO_NON_UNIVOCO:this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.NO_SINGLE_FIRMATARIO,"tst-dlg");break;default:this.errorService.showError(i,"tst-dlg")}else this.errorService.showError(i,"tst-dlg")}getHeader(i,e,t){return{title:i,subtitle:e,icon:t}}getButtonModel(i,e,t,o){return{label:i,icon:e,id:t,type:o}}initVariables(){this.enabledDownload={enableButton:!0,enableHeader:!1},this.enabledUpload={enableButton:!1,enableHeader:!1},this.enabledProtocolla={enableButton:!1,enableHeader:!1},this.fileDichiarazione=new Ve.a,this.fileDichiarazione.showDeleteButton=!0,this.fileInput.nativeElement.value=null}onClickBoxButton(i,e){switch(i.idButton){case _o.download_dichiarazione:this.scaricaDichiarazioneConsumiFile();break;case _o.carica_dichiarazione_firmata:this.caricaDichiarazione(i,e);break;case _o.protocolla_dichiarazione:this.protocollaDichiarazione();break;case _o.elimina_allegato:this.eliminaAllegato(i.componentName);break;default:console.log("Click non identificato")}}protocollaDichiarazione(){this.protocollaDichiarazioneSubscription=this.httpClientDichiarazioneConsumiUma.protocollaDichiarazioneConsumi(Number(this.idDichiarazione),this.fileDichiarazione.file,this.haFirma).subscribe(i=>{this.messageService.add(c.a.getToast("tst-dlg-protocollazione",c.b.success,g.a.protocollaDichiarazioneOK))},i=>{console.log("ERRORE: ",i),this.errorService.showErrorWithMessage(i&&i.error&&i.error.message?i.error.message:g.a.erroreProtocollaRichiesta,"tst-dlg")})}scaricaDichiarazioneConsumiFile(){this.httpClientDichiarazioneConsumiUma.getDichiarazioneConsumiFile(this.idDichiarazione).subscribe(i=>{this.dichiarazioneConsumiFile=new Blob([i],{type:"application/pdf"}),I.saveAs(this.dichiarazioneConsumiFile,this.idDichiarazione+"_dichiarazioneconsumi.pdf"),this.enabledDownload={enableButton:!0,enableHeader:!0},this.enabledUpload={enableButton:!0,enableHeader:!1}},i=>{this.dichiarazioneConsumiFile=null,console.log("ERRORE: ",i),this.messageService.add(c.a.getToast("tst-dlg",c.b.error,"Errore imprevisto. Si prega di riprovare pi\xf9 tardi"))})}caricaDichiarazione(i,e){e||(e=document.getElementById("caricaFileInput")),i.typeButton===He.file&&e&&e.click()}eliminaAllegato(i){"dichiarazione"===i&&(this.resetDichiarazione(),this.enabledUpload.enableHeader=!1,this.enabledProtocolla.enableButton=!1)}resetDichiarazione(){this.fileDichiarazione.file=null,this.fileDichiarazione.nome=null,this.fileInput.nativeElement.value=null}onCloseToastProtocollazione(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo)}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(Ge),p.Nb(se.a),p.Nb(A.d),p.Nb(we.a),p.Nb(T.a),p.Nb(ae.a),p.Nb(Ue.a),p.Nb(Le.a),p.Nb(ke.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-popup-protocollazione-dichiarazione"]],viewQuery:function(i,e){var t;1&i&&p.Jc(Fo,!0),2&i&&p.Ac(t=p.cc())&&(e.fileInput=t.first)},inputs:{cfRichiedente:"cfRichiedente",cuaa:"cuaa",idDichiarazione:"idDichiarazione",idFascicolo:"idFascicolo",popupVisibile:"popupVisibile"},outputs:{chiudiPopup:"chiudiPopup"},decls:25,vars:29,consts:[["width","1100","showEffect","fade",3,"visible","modal","closable","contentStyle","visibleChange"],["key","tst-dlg",3,"baseZIndex"],["position","top-center","key","tst-dlg-protocollazione",3,"baseZIndex","onClose"],[1,"p-grid","w-100"],[1,"p-col"],[1,"popup-approvazione","popup--custom"],[3,"innerHtml"],[1,"p-grid"],[1,"p-col-4"],[3,"header","button","enableBox","onClickButton"],[3,"name","header","button","enableBox","document","onClickButton"],["id","caricaFileInput","name","caricaFileInput","type","file",3,"hidden","accept","change"],["fileInput",""],[1,"d-flex","align-items-center","justify-content-between"],["pButton","",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none",3,"click"]],template:function(i,e){if(1&i){const i=p.Ub();p.Tb(0,"p-dialog",0),p.bc("visibleChange",(function(i){return e.popupVisibile=i})),p.Ob(1,"p-toast",1),p.Tb(2,"p-toast",2),p.bc("onClose",(function(){return e.onCloseToastProtocollazione()})),p.Sb(),p.Tb(3,"p-header"),p.Oc(4),p.gc(5,"translate"),p.Sb(),p.Tb(6,"div",3),p.Tb(7,"div",4),p.Tb(8,"div",5),p.Tb(9,"h6"),p.Ob(10,"p",6),p.gc(11,"translate"),p.Sb(),p.Tb(12,"div",7),p.Tb(13,"div",8),p.Tb(14,"app-box",9),p.bc("onClickButton",(function(i){return e.onClickBoxButton(i)})),p.Sb(),p.Sb(),p.Tb(15,"div",8),p.Tb(16,"app-box",10),p.bc("onClickButton",(function(t){p.Ec(i);const o=p.Bc(18);return e.onClickBoxButton(t,o)})),p.Sb(),p.Tb(17,"input",11,12),p.bc("change",(function(i){return e.onFileChange(i,"dichiarazione")})),p.Sb(),p.Sb(),p.Tb(19,"div",8),p.Tb(20,"app-box",9),p.bc("onClickButton",(function(i){return e.onClickBoxButton(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(21,"div",13),p.Tb(22,"button",14),p.bc("click",(function(){return e.annulla()})),p.Oc(23),p.gc(24,"translate"),p.Sb(),p.Sb(),p.Sb()}2&i&&(p.mc("visible",e.popupVisibile)("modal",!0)("closable",!1)("contentStyle",p.rc(28,Po)),p.Bb(1),p.mc("baseZIndex",5e4),p.Bb(1),p.mc("baseZIndex",5e4),p.Bb(2),p.Qc(" ",p.hc(5,22,"UMA.PROTOCOLLAZIONE_DICHIARAZIONE")," "),p.Bb(6),p.mc("innerHtml",p.hc(11,24,"UMA.PROTOCOLLAZIONE_DICHIARAZIONE_MSG"),p.Fc),p.Bb(4),p.mc("header",e.getHeader("UMA.SCARICA_DICHIARAZIONE","UMA.DESC_SCARICA_DICHIARAZIONE","assets/img/icons/icon-download2.png"))("button",e.getButtonModel("UMA.SCARICA","pi pi-arrow-down",e.BUTTONS_ENUM.download_dichiarazione,e.BUTTONS_TYPE_ENUM.button))("enableBox",e.enabledDownload),p.Bb(2),p.mc("name","dichiarazione")("header",e.getHeader("UMA.FIRMA_DICHIARAZIONE","UMA.DESC_FIRMA_DICHIARAZIONE","assets/img/icons/icon-signature.svg"))("button",e.getButtonModel("UMA.CARICA","pi pi-arrow-up",e.BUTTONS_ENUM.carica_dichiarazione_firmata,e.BUTTONS_TYPE_ENUM.file))("enableBox",e.enabledUpload)("document",e.fileDichiarazione),p.Bb(1),p.nc("accept",e.fileConfig.fileExt),p.mc("hidden",!0),p.Bb(3),p.mc("header",e.getHeader("UMA.PROTOCOLLA_DICHIARAZIONE","UMA.DESC_PROTOCOLLA_DICHIARAZIONE","assets/img/icons/icon-file-check.svg"))("button",e.getButtonModel("UMA.PROTOCOLLA","",e.BUTTONS_ENUM.protocolla_dichiarazione,e.BUTTONS_TYPE_ENUM.button))("enableBox",e.enabledProtocolla),p.Bb(3),p.Qc(" ",p.hc(24,26,"chiudi")," "))},directives:[jt.a,E.a,A.c,Ze.a,M.b],pipes:[ni.d],styles:["[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}"]}),i})();var xo=t("1SOg"),Lo=t("DYOT");const Go=["popupAllegatiMotivoConsumi"],Uo=["popupAllegatiMotivoRecupero"],ko=["dataConduzioneRef"],Vo=["cd"];function Ho(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-popup-protocollazione-dichiarazione",104),p.bc("chiudiPopup",(function(){return p.Ec(i),p.fc().closeProtocollazioneDialog()})),p.Sb()}if(2&i){const i=p.fc();p.mc("cfRichiedente",i.dichiarazioneConsumiDto.cfRichiedente)("idFascicolo",i.idFascicolo)("idDichiarazione",i.dichiarazioneConsumiDto.id)("popupVisibile",i.popupProtocollaVisibile)("cuaa",i.dichiarazioneConsumiDto.cuaa)}}function Zo(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",105),p.Ob(1,"i",106),p.Tb(2,"h3"),p.Oc(3),p.Sb(),p.Tb(4,"p"),p.Oc(5),p.Sb(),p.Sb(),p.Tb(6,"div",107),p.Tb(7,"div",108),p.Tb(8,"button",109),p.bc("click",(function(){p.Ec(i);const e=p.fc(),t=p.Bc(18);return e.confermaCancellazioneConsuntivo(t)})),p.Sb(),p.Sb(),p.Tb(9,"div",108),p.Tb(10,"button",110),p.bc("click",(function(){p.Ec(i);const e=p.fc(),t=p.Bc(18);return e.rifiutaCancellazioneConsuntivo(t)})),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit;p.Bb(3),p.Pc(i.summary),p.Bb(2),p.Pc(i.detail)}}function jo(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",113),p.bc("click",(function(){p.Ec(i);const e=p.fc(2);return!e.loading&&e.validaDichiarazione()&&e.saveDichiarazione()})),p.Sb()}}function Yo(i,e){if(1&i&&(p.Tb(0,"div",111),p.Mc(1,jo,1,0,"button",112),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("loading",i.loading)}}function $o(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",116),p.bc("click",(function(){p.Ec(i);const e=p.fc(2);return!e.loading&&e.validaDichiarazioneDaProtocollare()&&e.saveAndProtocollaDichiarazione()})),p.Sb()}}function qo(i,e){if(1&i&&(p.Tb(0,"div",114),p.Mc(1,$o,1,0,"button",115),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("loading",i.loading)}}function Qo(i,e){if(1&i&&(p.Tb(0,"div",117),p.Tb(1,"div",33),p.Oc(2," Data di riferimento conduzione: "),p.Tb(3,"strong"),p.Oc(4),p.gc(5,"date"),p.Sb(),p.Sb(),p.Sb()),2&i){const i=p.fc();p.Bb(4),p.Pc(p.ic(5,1,null==i.dichiarazioneConsumiDto?null:i.dichiarazioneConsumiDto.dataConduzione,"dd MMMM yyyy"))}}function Ko(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",122),p.bc("click",(function(){return p.Ec(i),p.fc(2).ripristinaDataConduzione()})),p.Tb(1,"span",123),p.Tb(2,"u"),p.Oc(3),p.gc(4,"date"),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=p.fc(2);p.Bb(3),p.Qc(" ripristina data ",p.ic(4,1,i.dataConduzioneDefault,"dd/MM/yyyy")," ")}}function Wo(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",117),p.Tb(1,"div",118),p.Oc(2,"Data riferimento conduzione:"),p.Sb(),p.Tb(3,"div",118),p.Tb(4,"p-calendar",119,120),p.bc("onSelect",(function(e){return p.Ec(i),p.fc().salvaDataConduzione(e)})),p.Sb(),p.Sb(),p.Mc(6,Ko,5,4,"div",121),p.Ob(7,"div",14),p.Sb()}if(2&i){const i=p.fc();p.Bb(4),p.mc("locale",i.calendarService.localeITA)("showIcon",!0)("minDate",i.minDate)("maxDate",i.maxDate)("readonlyInput",!0),p.Bb(2),p.mc("ngIf",!i.isDataDefault())}}function Jo(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",124),p.bc("click",(function(){return p.Ec(i),p.fc().openDialogMotivazione("AMMISSIBILE_GASOLIO_TERZI")})),p.Sb()}}function Xo(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",125),p.bc("click",(function(){return p.Ec(i),p.fc().cancellaAllegati("AMMISSIBILE_GASOLIO_TERZI")})),p.Sb()}}function ia(i,e){1&i&&p.Ob(0,"p-message",126)}function ea(i,e){1&i&&p.Ob(0,"p-message",127)}function ta(i,e){1&i&&p.Ob(0,"p-message",128)}function oa(i,e){1&i&&p.Ob(0,"p-message",130)}function aa(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,oa,1,0,"p-message",129),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("accisaMotivo").errors?null:i.consumiForm.get("accisaMotivo").errors.required)}}function na(i,e){1&i&&(p.Tb(0,"p-footer"),p.Tb(1,"i"),p.Oc(2,"Nota: \xe8 obbligatorio inserire una motivazione per il campo Accisa"),p.Sb(),p.Sb())}function ra(i,e){1&i&&p.Ob(0,"p-message",126)}function sa(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioTotale").value)}}function ca(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,ra,1,0,"p-message",45),p.Mc(2,sa,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("consumatoGasolioContoProprio").errors?null:i.consumiForm.get("consumatoGasolioContoProprio").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("consumatoGasolioContoProprio").errors?null:i.consumiForm.get("consumatoGasolioContoProprio").errors.maxArray)}}function la(i,e){1&i&&p.Ob(0,"p-message",126)}function ua(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioTotale").value)}}function ba(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,la,1,0,"p-message",45),p.Mc(2,ua,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("consumatoGasolioContoTerzi").errors?null:i.consumiForm.get("consumatoGasolioContoTerzi").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("consumatoGasolioContoTerzi").errors?null:i.consumiForm.get("consumatoGasolioContoTerzi").errors.maxArray)}}function ha(i,e){1&i&&p.Ob(0,"p-message",126)}function ma(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileBenzina").value)}}function pa(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,ha,1,0,"p-message",45),p.Mc(2,ma,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("consumatoBenzina").errors?null:i.consumiForm.get("consumatoBenzina").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("consumatoBenzina").errors?null:i.consumiForm.get("consumatoBenzina").errors.maxArray)}}function da(i,e){1&i&&p.Ob(0,"p-message",126)}function ga(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioSerre").value)}}function fa(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,da,1,0,"p-message",45),p.Mc(2,ga,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("consumatoGasolioSerre").errors?null:i.consumiForm.get("consumatoGasolioSerre").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("consumatoGasolioSerre").errors?null:i.consumiForm.get("consumatoGasolioSerre").errors.maxArray)}}function va(i,e){1&i&&p.Ob(0,"p-message",126)}function Sa(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioTotale").value)}}function Ca(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,va,1,0,"p-message",45),p.Mc(2,Sa,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("rimanenzaDicembreGasolioContoProprio").errors?null:i.consumiForm.get("rimanenzaDicembreGasolioContoProprio").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("rimanenzaDicembreGasolioContoProprio").errors?null:i.consumiForm.get("rimanenzaDicembreGasolioContoProprio").errors.maxArray)}}function Oa(i,e){1&i&&p.Ob(0,"p-message",126)}function Ta(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioTotale").value)}}function Ia(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Oa,1,0,"p-message",45),p.Mc(2,Ta,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").errors?null:i.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").errors?null:i.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").errors.maxArray)}}function za(i,e){1&i&&p.Ob(0,"p-message",126)}function Aa(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileBenzina").value)}}function Ea(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,za,1,0,"p-message",45),p.Mc(2,Aa,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("rimanenzaDicembreBenzina").errors?null:i.consumiForm.get("rimanenzaDicembreBenzina").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("rimanenzaDicembreBenzina").errors?null:i.consumiForm.get("rimanenzaDicembreBenzina").errors.maxArray)}}function Ra(i,e){1&i&&p.Ob(0,"p-message",126)}function Da(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioSerre").value)}}function Ma(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Ra,1,0,"p-message",45),p.Mc(2,Da,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("rimanenzaDicembreGasolioSerre").errors?null:i.consumiForm.get("rimanenzaDicembreGasolioSerre").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("rimanenzaDicembreGasolioSerre").errors?null:i.consumiForm.get("rimanenzaDicembreGasolioSerre").errors.maxArray)}}function Na(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",124),p.bc("click",(function(){return p.Ec(i),p.fc().openDialogMotivazione("RECUPERO_GASOLIO_PROPRIO")})),p.Sb()}}function Ba(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",125),p.bc("click",(function(){return p.Ec(i),p.fc().cancellaAllegati("RECUPERO_GASOLIO_PROPRIO")})),p.Sb()}}function ya(i,e){1&i&&p.Ob(0,"p-message",126)}function _a(i,e){1&i&&p.Ob(0,"p-message",127)}function Fa(i,e){1&i&&p.Ob(0,"p-message",128)}function Pa(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioTotale").value)}}function wa(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,ya,1,0,"p-message",45),p.Mc(2,_a,1,0,"p-message",46),p.Mc(3,Fa,1,0,"p-message",47),p.Mc(4,Pa,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioContoProprio").errors?null:i.consumiForm.get("recuperoGasolioContoProprio").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioContoProprio").errors?null:i.consumiForm.get("recuperoGasolioContoProprio").errors.emptylist),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioContoProprio").errors?null:i.consumiForm.get("recuperoGasolioContoProprio").errors.notZero),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioContoProprio").errors?null:i.consumiForm.get("recuperoGasolioContoProprio").errors.maxArray)}}function xa(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",124),p.bc("click",(function(){return p.Ec(i),p.fc().openDialogMotivazione("RECUPERO_GASOLIO_TERZI")})),p.Sb()}}function La(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",125),p.bc("click",(function(){return p.Ec(i),p.fc().cancellaAllegati("RECUPERO_GASOLIO_TERZI")})),p.Sb()}}function Ga(i,e){1&i&&p.Ob(0,"p-message",126)}function Ua(i,e){1&i&&p.Ob(0,"p-message",127)}function ka(i,e){1&i&&p.Ob(0,"p-message",128)}function Va(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioTotale").value)}}function Ha(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Ga,1,0,"p-message",45),p.Mc(2,Ua,1,0,"p-message",46),p.Mc(3,ka,1,0,"p-message",47),p.Mc(4,Va,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioContoTerzi").errors?null:i.consumiForm.get("recuperoGasolioContoTerzi").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioContoTerzi").errors?null:i.consumiForm.get("recuperoGasolioContoTerzi").errors.emptylist),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioContoTerzi").errors?null:i.consumiForm.get("recuperoGasolioContoTerzi").errors.notZero),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioContoTerzi").errors?null:i.consumiForm.get("recuperoGasolioContoTerzi").errors.maxArray)}}function Za(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",124),p.bc("click",(function(){return p.Ec(i),p.fc().openDialogMotivazione("RECUPERO_BENZINA")})),p.Sb()}}function ja(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",125),p.bc("click",(function(){return p.Ec(i),p.fc().cancellaAllegati("RECUPERO_BENZINA")})),p.Sb()}}function Ya(i,e){1&i&&p.Ob(0,"p-message",126)}function $a(i,e){1&i&&p.Ob(0,"p-message",127)}function qa(i,e){1&i&&p.Ob(0,"p-message",128)}function Qa(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileBenzina").value)}}function Ka(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Ya,1,0,"p-message",45),p.Mc(2,$a,1,0,"p-message",46),p.Mc(3,qa,1,0,"p-message",47),p.Mc(4,Qa,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoBenzina").errors?null:i.consumiForm.get("recuperoBenzina").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoBenzina").errors?null:i.consumiForm.get("recuperoBenzina").errors.emptylist),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoBenzina").errors?null:i.consumiForm.get("recuperoBenzina").errors.notZero),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoBenzina").errors?null:i.consumiForm.get("recuperoBenzina").errors.maxArray)}}function Wa(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",124),p.bc("click",(function(){return p.Ec(i),p.fc().openDialogMotivazione("RECUPERO_GASOLIO_SERRE")})),p.Sb()}}function Ja(i,e){if(1&i){const i=p.Ub();p.Tb(0,"button",125),p.bc("click",(function(){return p.Ec(i),p.fc().cancellaAllegati("RECUPERO_GASOLIO_SERRE")})),p.Sb()}}function Xa(i,e){1&i&&p.Ob(0,"p-message",126)}function en(i,e){1&i&&p.Ob(0,"p-message",127)}function tn(i,e){1&i&&p.Ob(0,"p-message",128)}function on(i,e){if(1&i&&p.Ob(0,"p-message",132),2&i){const i=p.fc(2);p.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+i.consumiForm.get("disponibileGasolioSerre").value)}}function an(i,e){if(1&i&&(p.Tb(0,"div"),p.Mc(1,Xa,1,0,"p-message",45),p.Mc(2,en,1,0,"p-message",46),p.Mc(3,tn,1,0,"p-message",47),p.Mc(4,on,1,1,"p-message",131),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioSerre").errors?null:i.consumiForm.get("recuperoGasolioSerre").errors.pattern),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioSerre").errors?null:i.consumiForm.get("recuperoGasolioSerre").errors.emptylist),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioSerre").errors?null:i.consumiForm.get("recuperoGasolioSerre").errors.notZero),p.Bb(1),p.mc("ngIf",null==i.consumiForm.get("recuperoGasolioSerre").errors?null:i.consumiForm.get("recuperoGasolioSerre").errors.maxArray)}}const nn=function(){return{marginTop:"70px"}},rn=function(){return{on:!0,field:"richAssegnatoGasolioContoTerzi"}},sn=function(i,e){return{list:i,active:e}},cn=function(){return["consumatoGasolioContoTerzi","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreGasolioContoProprio","recuperoGasolioContoProprio","recuperoGasolioContoTerzi"]},ln=function(i){return{toSum:i,limit:"disponibileGasolioTotale"}},un=function(){return["consumatoGasolioContoProprio","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreGasolioContoProprio","recuperoGasolioContoProprio","recuperoGasolioContoTerzi"]},bn=function(){return["recuperoBenzina","rimanenzaDicembreBenzina"]},hn=function(i){return{toSum:i,limit:"disponibileBenzina"}},mn=function(){return["rimanenzaDicembreGasolioSerre","recuperoGasolioSerre"]},pn=function(i){return{toSum:i,limit:"disponibileGasolioSerre"}},dn=function(){return["consumatoGasolioContoTerzi","rimanenzaDicembreGasolioContoTerzi","consumatoGasolioContoProprio","recuperoGasolioContoProprio","recuperoGasolioContoTerzi"]},gn=function(){return["consumatoGasolioContoTerzi","consumatoGasolioContoProprio","rimanenzaDicembreGasolioContoProprio","recuperoGasolioContoProprio","recuperoGasolioContoTerzi"]},fn=function(){return["consumatoBenzina","recuperoBenzina"]},vn=function(){return["consumatoGasolioSerre","recuperoGasolioSerre"]},Sn=function(i){return{list:i}},Cn=function(){return["consumatoGasolioContoTerzi","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreGasolioContoProprio","consumatoGasolioContoProprio","recuperoGasolioContoTerzi"]},On=function(){return["consumatoGasolioContoTerzi","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreGasolioContoProprio","recuperoGasolioContoProprio","consumatoGasolioContoProprio"]},Tn=function(){return["consumatoBenzina","rimanenzaDicembreBenzina"]},In=function(){return["rimanenzaDicembreGasolioSerre","consumatoGasolioSerre"]};let zn=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c,l,u,b,h,m,p,d,g,f,v,S,C){this.tipologicheService=i,this.calendarService=e,this.indiceUmaService=t,this.activeRoute=o,this.httpClientDichiarazioneConsumiUmaService=a,this.httpClientTrasferimentiCarburanteService=n,this.httpClientMacchineUmaService=r,this.httpClientDomandaUmaService=s,this.modelBuilderService=c,this.authService=l,this.location=u,this.errorService=b,this.messageService=h,this.formService=m,this.confirmationService=p,this.consumiBuilderService=d,this.formatSrv=g,this.dateUtilService=f,this.router=v,this.httpClientDomandUmaService=S,this.navigatorService=C,this.SEPARATOR="$$",this.STATO_DICHIARAZIONE_CONSUMI=le.a}ngOnInit(){this.initRoles(),this.navigationEndSubscription=this.router.events.pipe(Object(r.a)(i=>i instanceof z.b&&i.url.indexOf("dichiarazione-consumi")>-1?Object(y.a)({trigger:"LOAD_DICHIARAZIONE"}):Object(y.a)({trigger:"NONE"}))).subscribe(i=>{i&&i.trigger&&"LOAD_DICHIARAZIONE"===i.trigger&&(this.initVariables(),this.initDichiarazione(),this.initOnChangeListeners())},i=>this.errorService.showError(i)),this.initVariables(),this.initDichiarazione(),this.initOnChangeListeners()}initOnChangeListeners(){this.consumatoGasolioContoProprioSub=this.consumiForm.get("consumatoGasolioContoProprio").valueChanges.subscribe(i=>{const e=this.formatSrv.toNumber(i)+this.formatSrv.toNumber(this.consumiForm.get("consumatoGasolioContoTerzi").value);this.consumiForm.get("consumatoGasolioTotale").setValue(e)}),this.consumatoGasolioContoTerziSub=this.consumiForm.get("consumatoGasolioContoTerzi").valueChanges.subscribe(i=>{const e=this.formatSrv.toNumber(i)+this.formatSrv.toNumber(this.consumiForm.get("consumatoGasolioContoProprio").value);this.consumiForm.get("consumatoGasolioTotale").setValue(e)}),this.rimanenzaGasolioContoProprioSub=this.consumiForm.get("rimanenzaDicembreGasolioContoProprio").valueChanges.subscribe(i=>{const e=this.formatSrv.toNumber(i)+this.formatSrv.toNumber(this.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").value);this.consumiForm.get("rimanenzaDicembreGasolioTotale").setValue(e)}),this.rimanenzaGasolioContoTerziSub=this.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").valueChanges.subscribe(i=>{const e=this.formatSrv.toNumber(i)+this.formatSrv.toNumber(this.consumiForm.get("rimanenzaDicembreGasolioContoProprio").value);this.consumiForm.get("rimanenzaDicembreGasolioTotale").setValue(e)}),this.recuperoGasolioContoProprioSub=this.consumiForm.get("recuperoGasolioContoProprio").valueChanges.subscribe(i=>{this.consumiForm.get("recuperoGasolioTotale").setValue(this.formatSrv.toNumber(i)+this.formatSrv.toNumber(this.consumiForm.get("recuperoGasolioContoTerzi").value))}),this.recuperoGasolioContoTerziSub=this.consumiForm.get("recuperoGasolioContoTerzi").valueChanges.subscribe(i=>{this.consumiForm.get("recuperoGasolioTotale").setValue(this.formatSrv.toNumber(i)+this.formatSrv.toNumber(this.consumiForm.get("recuperoGasolioContoProprio").value))}),this.ammissibileGasolioContoTerziSub=this.consumiForm.get("ammissibileGasolioContoTerzi").valueChanges.subscribe(i=>{this.consumiForm.get("ammissibileGasolioContoTerzi").valid&&(this.setAmmissibileGasolioTotale(),this.setAccisaByCarburante("GASOLIO",this.calcolaAccisaByCarburante("GASOLIO")))}),this.consumatoGasolioTotaleSub=this.consumiForm.get("consumatoGasolioTotale").valueChanges.subscribe(i=>{this.setAccisaByCarburante("GASOLIO",this.calcolaAccisaByCarburante("GASOLIO"))}),this.ammissibileGasolioTotaleSub=this.consumiForm.get("ammissibileGasolioTotale").valueChanges.subscribe(i=>{this.setAccisaByCarburante("GASOLIO",this.calcolaAccisaByCarburante("GASOLIO"))}),this.consumatoBenzinaSub=this.consumiForm.get("consumatoBenzina").valueChanges.subscribe(i=>{this.setAccisaByCarburante("BENZINA",this.calcolaAccisaByCarburante("BENZINA"))}),this.ammissibileBenzinaSub=this.consumiForm.get("ammissibileBenzina").valueChanges.subscribe(i=>{this.setAccisaByCarburante("BENZINA",this.calcolaAccisaByCarburante("BENZINA"))}),this.consumatoGasolioSerreSub=this.consumiForm.get("consumatoGasolioSerre").valueChanges.subscribe(i=>{this.setAccisaByCarburante("GASOLIO_SERRE",this.calcolaAccisaByCarburante("GASOLIO_SERRE"))}),this.ammissibileGasolioSerreSub=this.consumiForm.get("ammissibileGasolioSerre").valueChanges.subscribe(i=>{this.setAccisaByCarburante("GASOLIO_SERRE",this.calcolaAccisaByCarburante("GASOLIO_SERRE"))}),this.rimanenzaDicembreGasolioTotaleSub=this.consumiForm.get("rimanenzaDicembreGasolioTotale").valueChanges.subscribe(i=>{this.setAccisaByCarburante("GASOLIO",this.calcolaAccisaByCarburante("GASOLIO"))}),this.rimanenzaDicembreBenzinaSub=this.consumiForm.get("rimanenzaDicembreBenzina").valueChanges.subscribe(i=>{this.setAccisaByCarburante("BENZINA",this.calcolaAccisaByCarburante("BENZINA"))}),this.rimanenzaDicembreGasolioSerreSub=this.consumiForm.get("rimanenzaDicembreGasolioSerre").valueChanges.subscribe(i=>{this.setAccisaByCarburante("GASOLIO_SERRE",this.calcolaAccisaByCarburante("GASOLIO_SERRE"))}),this.recuperoGasolioTotSub=this.consumiForm.get("recuperoGasolioTotale").valueChanges.subscribe(i=>{this.setAccisaByCarburante("GASOLIO",this.calcolaAccisaByCarburante("GASOLIO"))}),this.recuperoBenzinaSub=this.consumiForm.get("recuperoBenzina").valueChanges.subscribe(i=>{this.setAccisaByCarburante("BENZINA",this.calcolaAccisaByCarburante("BENZINA"))}),this.recuperoGasolioSerreSub=this.consumiForm.get("recuperoGasolioSerre").valueChanges.subscribe(i=>{this.setAccisaByCarburante("GASOLIO_SERRE",this.calcolaAccisaByCarburante("GASOLIO_SERRE"))})}initDichiarazione(){this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>this.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(i.id)),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>{this.dichiarazioneConsumiDto=i,this.initDataConduzione();const e=this.httpClientMacchineUmaService.getMacchineByIdDomanda(i.idRichiesta.toString()),t=this.httpClientTrasferimentiCarburanteService.getCarburanteRicevuto(this.dichiarazioneConsumiDto.cuaa,this.dichiarazioneConsumiDto.campagnaRichiesta.toString()),o=this.httpClientTrasferimentiCarburanteService.getCarburanteTrasferito(this.dichiarazioneConsumiDto.cuaa,this.dichiarazioneConsumiDto.campagnaRichiesta.toString()),a=this.httpClientDomandaUmaService.getPrelieviByCuaaAndCampagna(i.cuaa,i.campagnaRichiesta.toString()),n=this.httpClientDichiarazioneConsumiUmaService.getResiduoAnnoPrecedente(this.dichiarazioneConsumiDto.cuaa,this.dichiarazioneConsumiDto.campagnaRichiesta-1,[le.a.PROTOCOLLATA]),r=this.httpClientDomandaUmaService.getDomandaById(this.dichiarazioneConsumiDto.idRichiesta.toString()),s=this.httpClientDichiarazioneConsumiUmaService.getConsuntivi(this.dichiarazioneConsumiDto.id.toString()),c=this.httpClientDichiarazioneConsumiUmaService.getAmmissibile(this.dichiarazioneConsumiDto.id.toString());return Object(ii.a)([e,t,o,a,n,r,s,c])}),Object(s.a)(i=>(this.errorService.showError(i),n.a))).subscribe(([i,e,t,o,a,n,r,s])=>{this.richiestaCarburanteDto=n,this.setFabbisognoDichiarato(i);const c=a&&a.length&&a[0].rimanenza?a[0].rimanenza:null;this.setResiduoCampagnaPrecedente(c),this.setRichiestoAssegnato(),this.setCarburanteRicevuto(e.totale),this.setCarburanteTrasferito(t.totale),this.setCarburantePrelevato(o.totale),this.setDisponibile(this.calcolaDisponibile(c,e.totale,o.totale,t.totale)),this.setConsuntivi(r),this.setAmmissibile(s),this.setAmmissibileGasolioTotale(),this.setAccisaByCarburante("GASOLIO",this.calcolaAccisaByCarburante("GASOLIO")),this.setAccisaByCarburante("BENZINA",this.calcolaAccisaByCarburante("BENZINA")),this.setAccisaByCarburante("GASOLIO_SERRE",this.calcolaAccisaByCarburante("GASOLIO_SERRE")),this.setMotivazioneAccisa(),this.loading=!1})}showAllegatiIconAmmissibile(i,e){return!!(!i.disabled&&this.formatSrv.toNumber(i.value)>0&&this.formatSrv.toNumber(i.value)!=this.formatSrv.toNumber(e.value)||((this.motivoRecuperoAmmissibile||{}).allegati||[]).length)}fillWithZero(){const i=this.consumiForm.value,e=Object(kt.d)(i,["accisaMotivo"]);for(const t in e){const i=this.formatSrv.toNumber(this.consumiForm.get(""+t).value);this.consumiForm.get(""+t).setValue(i)}}openPanelsByField(i){i.forEach(i=>{"ammissibileGasolioContoTerzi"===i.name&&(this.areCollapsed[0]=!i.control.invalid),"accisaMotivo"===i.name&&(this.areCollapsed[1]=!i.control.invalid)});const e=["consumatoGasolioContoProprio","consumatoGasolioContoTerzi","consumatoBenzina","consumatoGasolioSerre","consumatoGasolioSerre","rimanenzaDicembreGasolioContoProprio","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreBenzina","rimanenzaDicembreGasolioSerre","recuperoGasolioContoProprio","recuperoGasolioContoTerzi","recuperoBenzina","recuperoGasolioSerre"],t=i.filter(i=>e.indexOf(i.name)>-1);this.areCollapsed[2]=!t||!t.length}goBack(){this.location.back()}onChangeMotivoAccisa(i){this.confirmationService.confirm({message:g.a.accisaObbligatoria,accept:()=>{},key:"conferma-accisa-dialog"})}isAccisaObbligatoria(){return this.formatSrv.toNumber(this.consumiForm.get("accisaGasolioTotale").value)>0||this.formatSrv.toNumber(this.consumiForm.get("accisaBenzina").value)>0||this.formatSrv.toNumber(this.consumiForm.get("accisaGasolioSerre").value)>0}cancellaAllegati(i){this.messageService.add({key:"checkCancella",sticky:!0,severity:"warn",summary:"Cancella dati",detail:"Attenzione! Si desidera procedere con la cancellazione degli allegati inseriti e delle relative informazioni? Verr\xe0 ripristinata la situazione iniziale",data:i})}openDialogMotivazione(i){switch(i){case Vt.AMMISSIBILE_GASOLIO_TERZI:this.popupAllegatiMotivoConsumi.open(this.motivoRecuperoAmmissibile);break;case Vt.RECUPERO_GASOLIO_PROPRIO:this.popupAllegatiMotivoRecupero.open(i,this.motivoRecuperoGasolioContoProprio);break;case Vt.RECUPERO_GASOLIO_TERZI:this.popupAllegatiMotivoRecupero.open(i,this.motivoRecuperoGasolioContoTerzi);break;case Vt.RECUPERO_BENZINA:this.popupAllegatiMotivoRecupero.open(i,this.motivoRecuperoBenzina);break;case Vt.RECUPERO_GASOLIO_SERRE:this.popupAllegatiMotivoRecupero.open(i,this.motivoRecuperoGasolioSerre)}}closeDialogMotivazione(i){let e={motivazione:{}};switch(e.motivazione=i.motivazioneConsuntivoDto,e.tipo=i.tipo,i.tipo){case Vt.AMMISSIBILE_GASOLIO_TERZI:e.tipoConsuntivo=zo.AMMISSIBILE,e.value=this.consumiForm.get("ammissibileGasolioContoTerzi").value,e.tipoCarburante=Ao.GASOLIO_TERZI,this.motivoRecuperoAmmissibile=i.motivazioneConsuntivoDto;break;case Vt.RECUPERO_GASOLIO_PROPRIO:e.tipoConsuntivo=zo.RECUPERO,e.value=this.consumiForm.get("recuperoGasolioContoProprio").value,e.tipoCarburante=Ao.GASOLIO,this.motivoRecuperoGasolioContoProprio=e.motivazione;break;case Vt.RECUPERO_GASOLIO_TERZI:e.tipoConsuntivo=zo.RECUPERO,e.value=this.consumiForm.get("recuperoGasolioContoTerzi").value,e.tipoCarburante=Ao.GASOLIO_TERZI,this.motivoRecuperoGasolioContoTerzi=e.motivazione;break;case Vt.RECUPERO_BENZINA:e.tipoConsuntivo=zo.RECUPERO,e.value=this.consumiForm.get("recuperoBenzina").value,e.tipoCarburante=Ao.BENZINA,this.motivoRecuperoBenzina=e.motivazione;break;case Vt.RECUPERO_GASOLIO_SERRE:e.tipoConsuntivo=zo.RECUPERO,e.value=this.consumiForm.get("recuperoGasolioSerre").value,e.tipoCarburante=Ao.GASOLIO_SERRE,this.motivoRecuperoGasolioSerre=e.motivazione}this.saveConsuntivoWithAllegati(e)}validaDichiarazione(){console.log("Salvataggio dichiarazione consumi: ",this.consumiForm.value),this.formService.validateForm(this.consumiForm);const i=this.formService.getInvalids(this.consumiForm);if(!this.consumiForm.valid)return this.openPanelsByField(i),this.messageService.add(c.a.getToast("tst",c.b.error,g.a.datiNonValidi)),!1;if(this.formatSrv.isLessThanZero(this.consumiForm.get("consumatoGasolioContoProprio").value)&&this.formatSrv.isLessThanZero(this.consumiForm.get("consumatoGasolioContoTerzi").value)&&this.formatSrv.isLessThanZero(this.consumiForm.get("consumatoBenzina").value)&&this.formatSrv.isLessThanZero(this.consumiForm.get("consumatoGasolioSerre").value))return this.messageService.add(c.a.getToast("tst",c.b.error,g.a.consumatoObbligatorio)),!1;if(this.isAccisaObbligatoria()){if(this.isAccisaObbligatoria()&&this.formatSrv.isEmptyString(this.consumiForm.get("accisaMotivo").value))return this.messageService.add(c.a.getToast("tst",c.b.warn,g.a.accisaObbligatoria)),!1}else this.consumiForm.get("accisaMotivo").reset();return!0}validaDichiarazioneDaProtocollare(){return!(!this.validaDichiarazione()||(this.consumiForm.get("accisaGasolioTotale").value>0||this.consumiForm.get("accisaBenzina").value>0||this.consumiForm.get("accisaGasolioSerre").value>0)&&(this.confirmationService.confirm({message:g.a.accisaValorizzataWarn,accept:()=>{this.saveAndProtocollaDichiarazione()},key:"conferma-accisa-dialog"}),1))}saveDichiarazione(){this.dichiarazioneConsumiDto.motivazioneAccisa=this.consumiForm.get("accisaMotivo").value;const i=this.consumiBuilderService.buildConsuntiviDto(this.consumiForm.value).filter(i=>i.quantita>=0);this.saveDichiarazioneSubscription=this.httpClientDichiarazioneConsumiUmaService.saveConsuntivi(this.dichiarazioneConsumiDto.id.toString(),i).pipe(Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>{const e=new Date(this.consumiForm.get("dataConduzione").value),t=this.dateUtilService.toDateWithNoOffset(e).toISOString();return console.log("Update data: ",t),console.log("Update accisa: ",this.dichiarazioneConsumiDto.motivazioneAccisa),this.httpClientDichiarazioneConsumiUmaService.updateDichiarazioneConsumi(this.dichiarazioneConsumiDto.id.toString(),this.consumiBuilderService.buildDichiarazioneConsumiPatch(this.dichiarazioneConsumiDto.motivazioneAccisa,t))})).subscribe(i=>{this.messageService.add(c.a.getToast("tst",c.b.success,g.a.salvataggioConsuntiviOk))},i=>this.errorService.showError(i))}saveAndProtocollaDichiarazione(){this.dichiarazioneConsumiDto.motivazioneAccisa=this.consumiForm.get("accisaMotivo").value;const i=this.consumiBuilderService.buildConsuntiviDto(this.consumiForm.value).filter(i=>i.quantita>=0);this.protocollaSubscription=this.httpClientDichiarazioneConsumiUmaService.saveConsuntivi(this.dichiarazioneConsumiDto.id.toString(),i).pipe(Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>{const e=new Date(this.consumiForm.get("dataConduzione").value),t=this.dateUtilService.toDateWithNoOffset(e).toISOString();return console.log("Update data: ",t),console.log("Update accisa: ",this.dichiarazioneConsumiDto.motivazioneAccisa),this.httpClientDichiarazioneConsumiUmaService.updateDichiarazioneConsumi(this.dichiarazioneConsumiDto.id.toString(),this.consumiBuilderService.buildDichiarazioneConsumiPatch(this.dichiarazioneConsumiDto.motivazioneAccisa,t))}),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>this.httpClientDichiarazioneConsumiUmaService.valida(this.dichiarazioneConsumiDto.id.toString()))).subscribe(i=>{this.popupProtocollaVisibile=!0},i=>{console.log("ERROR: ",i),i&&i.error&&i.error.message&&i.error.message.includes("[ERR-1]")?this.erroreEliminazioneDichiarazioneORettifica(i):i&&i.error&&i.error.message&&i.error.message.includes("[ERR-2]")?this.errorRichiestaObsoleta(i):this.errorService.showError(i)})}saveConsuntivoWithAllegati(i){this.dichiarazioneConsumiDto.motivazioneAccisa=this.consumiForm.get("accisaMotivo").value;const e=this.consumiBuilderService.buildConsuntiviDto(this.consumiForm.value).filter(i=>i.quantita>=0);this.saveConsuntivoWithAllegatiSub=this.httpClientDichiarazioneConsumiUmaService.saveConsuntivi(this.dichiarazioneConsumiDto.id.toString(),e).pipe(Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(e=>this.saveConsuntivo(i.tipoConsuntivo,i.tipo,i.value,i.tipoCarburante,i.motivazione))).subscribe(e=>{this.updateAndValidateMotivo(i.tipo,e),i.tipo===Vt.AMMISSIBILE_GASOLIO_TERZI&&this.consumiForm.get("ammissibileGasolioContoTerzi").updateValueAndValidity(),this.messageService.add(c.a.getToast("tst",c.b.success,g.a.salvataggioAllegatiConsumiOk))},i=>{this.errorService.showError(i),this.location.back()})}closeDialogCambioData(i){}confermaCancellazioneConsuntivo(i){const e=this.recuperaIDConsuntivo(i.messages[0].data);null!=e?this.deleteConsuntivoSubscription=this.httpClientDichiarazioneConsumiUmaService.deleteConsuntivo(this.dichiarazioneConsumiDto.id.toString(),e).subscribe(()=>{this.svuotaAllegati(i.messages[0].data),i.messages[0].data===Vt.AMMISSIBILE_GASOLIO_TERZI&&this.setAmmissibileContoTerzi(),this.messageService.clear("checkCancella"),this.messageService.add(c.a.getToast("tst",c.b.success,g.a.deleteConsuntivoOk))},i=>this.errorService.showError(i)):this.messageService.add(c.a.getToast("tst",c.b.error,g.a.deleteConsuntivoKO))}rifiutaCancellazioneConsuntivo(i){this.messageService.clear("checkCancella")}isDataDefault(){if(!this.dichiarazioneConsumiDto||!this.dichiarazioneConsumiDto.dataConduzione)return!1;const i=new Date(this.dichiarazioneConsumiDto.dataConduzione),e=new Date(this.dataConduzioneDefault);return this.dateUtilService.isSameDates(i,e)}salvaDataConduzione(i){const e=this.dateUtilService.toDate(this.dataConduzioneRef.inputFieldValue);this.confirmationService.confirm({message:g.a.cambioDataConduzione,accept:()=>{this.confermaCambioData(i)},reject:()=>{this.consumiForm.get("dataConduzione").setValue(e)},key:"conferma-cambio-data"})}ripristinaDataConduzione(){this.confirmationService.confirm({message:g.a.cambioDataConduzione,accept:()=>{this.dichiarazioneConsumiDto.dataConduzione=this.dataConduzioneDefault,this.consumiForm.get("dataConduzione").setValue(this.dataConduzioneDefault),this.confermaCambioData(this.dataConduzioneDefault)},reject:()=>{},key:"conferma-cambio-data"})}onCloseToastCancellazione(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo)}closeProtocollazioneDialog(){this.popupProtocollaVisibile=!1}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.deleteConsuntivoSubscription&&this.deleteConsuntivoSubscription.unsubscribe(),this.consumatoGasolioContoProprioSub&&this.consumatoGasolioContoProprioSub.unsubscribe(),this.consumatoGasolioContoTerziSub&&this.consumatoGasolioContoTerziSub.unsubscribe(),this.rimanenzaGasolioContoProprioSub&&this.rimanenzaGasolioContoProprioSub.unsubscribe(),this.rimanenzaGasolioContoTerziSub&&this.rimanenzaGasolioContoTerziSub.unsubscribe(),this.recuperoGasolioContoProprioSub&&this.recuperoGasolioContoProprioSub.unsubscribe(),this.recuperoGasolioContoTerziSub&&this.recuperoGasolioContoTerziSub.unsubscribe(),this.ammissibileGasolioContoTerziSub&&this.ammissibileGasolioContoTerziSub.unsubscribe(),this.saveConsuntivoSubscription&&this.saveConsuntivoSubscription.unsubscribe(),this.saveDichiarazioneSubscription&&this.saveDichiarazioneSubscription.unsubscribe(),this.utenteSubscription&&this.utenteSubscription.unsubscribe(),this.navigationEndSubscription&&this.navigationEndSubscription.unsubscribe(),this.updateDataConduzioneSubscription&&this.updateDataConduzioneSubscription.unsubscribe(),this.consumatoGasolioTotaleSub&&this.consumatoGasolioTotaleSub.unsubscribe(),this.ammissibileGasolioTotaleSub&&this.ammissibileGasolioTotaleSub.unsubscribe(),this.consumatoGasolioSerreSub&&this.consumatoGasolioSerreSub.unsubscribe(),this.ammissibileBenzinaSub&&this.ammissibileBenzinaSub.unsubscribe(),this.ammissibileGasolioSerreSub&&this.ammissibileGasolioSerreSub.unsubscribe(),this.consumatoBenzinaSub&&this.consumatoBenzinaSub.unsubscribe(),this.rimanenzaDicembreGasolioTotaleSub&&this.rimanenzaDicembreGasolioTotaleSub.unsubscribe(),this.rimanenzaDicembreBenzinaSub&&this.rimanenzaDicembreBenzinaSub.unsubscribe(),this.rimanenzaDicembreGasolioSerreSub&&this.rimanenzaDicembreGasolioSerreSub.unsubscribe(),this.recuperoGasolioTotSub&&this.recuperoGasolioTotSub.unsubscribe(),this.recuperoBenzinaSub&&this.recuperoBenzinaSub.unsubscribe(),this.recuperoGasolioSerreSub&&this.recuperoGasolioSerreSub.unsubscribe(),this.protocollaSubscription&&this.protocollaSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe(),this.saveConsuntivoWithAllegatiSub&&this.saveConsuntivoWithAllegatiSub.unsubscribe(),this.getDomandeSubscription&&this.getDomandeSubscription.unsubscribe()}initRoles(){this.authService.userSelectedRole!=C.a.roleIstruttoreUMA&&this.authService.userSelectedRole!=C.a.roleAppag||(this.isUtenteIstruttoreUma=!0)}setMotivazioneAccisa(){this.dichiarazioneConsumiDto.motivazioneAccisa&&this.consumiForm.get("accisaMotivo").setValue(this.dichiarazioneConsumiDto.motivazioneAccisa)}setConsuntivi(i){i&&i.length&&i.forEach(i=>{switch(i.tipo){case zo.AMMISSIBILE:i.carburante==Ao.GASOLIO_TERZI&&(this.motivoRecuperoAmmissibile={idConsuntivo:i.id,allegati:this.consumiBuilderService.toAllegatoMotivazione(i,this.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione},this.consumiForm.get("ammissibileGasolioContoTerzi").setValue(i.quantita.toString()),setTimeout(()=>this.consumiForm.get("ammissibileGasolioContoTerzi").updateValueAndValidity()));break;case zo.CONSUMATO:if(i.carburante==Ao.GASOLIO){this.consumiForm.get("consumatoGasolioContoProprio").setValue(i.quantita.toString());break}if(i.carburante==Ao.GASOLIO_TERZI){this.consumiForm.get("consumatoGasolioContoTerzi").setValue(i.quantita.toString());break}if(i.carburante==Ao.BENZINA){this.consumiForm.get("consumatoBenzina").setValue(i.quantita.toString());break}if(i.carburante==Ao.GASOLIO_SERRE){this.consumiForm.get("consumatoGasolioSerre").setValue(i.quantita.toString());break}break;case zo.RIMANENZA:if(i.carburante==Ao.GASOLIO){this.consumiForm.get("rimanenzaDicembreGasolioContoProprio").setValue(i.quantita.toString());break}if(i.carburante==Ao.GASOLIO_TERZI){this.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").setValue(i.quantita.toString());break}if(i.carburante==Ao.BENZINA){this.consumiForm.get("rimanenzaDicembreBenzina").setValue(i.quantita.toString());break}if(i.carburante==Ao.GASOLIO_SERRE){this.consumiForm.get("rimanenzaDicembreGasolioSerre").setValue(i.quantita.toString());break}break;case zo.RECUPERO:if(i.carburante==Ao.GASOLIO){this.consumiForm.get("recuperoGasolioContoProprio").setValue(i.quantita.toString()),this.motivoRecuperoGasolioContoProprio={idConsuntivo:i.id,allegati:this.consumiBuilderService.toAllegatoMotivazione(i,this.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione};break}if(i.carburante==Ao.GASOLIO_TERZI){this.consumiForm.get("recuperoGasolioContoTerzi").setValue(i.quantita.toString()),this.motivoRecuperoGasolioContoTerzi={idConsuntivo:i.id,allegati:this.consumiBuilderService.toAllegatoMotivazione(i,this.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione};break}if(i.carburante==Ao.BENZINA){this.consumiForm.get("recuperoBenzina").setValue(i.quantita.toString()),this.motivoRecuperoBenzina={idConsuntivo:i.id,allegati:this.consumiBuilderService.toAllegatoMotivazione(i,this.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione};break}if(i.carburante==Ao.GASOLIO_SERRE){this.consumiForm.get("recuperoGasolioSerre").setValue(i.quantita.toString()),this.motivoRecuperoGasolioSerre={idConsuntivo:i.id,allegati:this.consumiBuilderService.toAllegatoMotivazione(i,this.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione};break}}})}setFabbisognoDichiarato(i){if(!i||!i.length)return;const e=this.modelBuilderService.fabbisognoDichiaratoBuilder(i);this.disableFieldsByCarburate(e)}setResiduoCampagnaPrecedente(i){i&&(this.consumiForm.get("residuoGasolioContoProprio").setValue(i.gasolio?i.gasolio:0),this.consumiForm.get("residuoGasolioContoTerzi").setValue(i.gasolioTerzi?i.gasolioTerzi:0),this.consumiForm.get("residuoGasolioTotale").setValue(i.gasolio+i.gasolioTerzi),this.consumiForm.get("residuoBenzina").setValue(i.benzina),this.consumiForm.get("residuoGasolioSerre").setValue(i.gasolioSerre))}setRichiestoAssegnato(){if(!this.richiestaCarburanteDto||!this.richiestaCarburanteDto.carburanteRichiesto)return;const i=this.richiestaCarburanteDto.carburanteRichiesto;this.consumiForm.get("richAssegnatoGasolioContoProprio").setValue(i.gasolio?i.gasolio:0),this.consumiForm.get("richAssegnatoGasolioContoTerzi").setValue(i.gasolioTerzi?i.gasolioTerzi:0),this.consumiForm.get("richAssegnatoGasolioTotale").setValue((i.gasolio?i.gasolio:0)+(i.gasolioTerzi?i.gasolioTerzi:0)),this.consumiForm.get("richAssegnatoBenzina").setValue(i.benzina?i.benzina:0),this.consumiForm.get("richAssegnatoGasolioSerre").setValue(i.gasolioSerre?i.gasolioSerre:0)}setAmmissibile(i){this.setAmmissibileContoTerzi(),i&&(this.consumiForm.get("ammissibileGasolioContoProprio").setValue(i.gasolio.toString()),this.consumiForm.get("ammissibileBenzina").setValue(i.benzina),this.consumiForm.get("ammissibileGasolioSerre").setValue(i.gasolioSerre))}setAmmissibileContoTerzi(){if(null==this.consumiForm.get("ammissibileGasolioContoTerzi").value){const i=this.richiestaCarburanteDto&&this.richiestaCarburanteDto.carburanteRichiesto&&this.richiestaCarburanteDto.carburanteRichiesto.gasolioTerzi;this.consumiForm.get("ammissibileGasolioContoTerzi").setValue(i)}}setAmmissibileGasolioTotale(){const i=this.formatSrv.toNumber(this.consumiForm.get("ammissibileGasolioContoProprio").value),e=this.formatSrv.toNumber(this.consumiForm.get("ammissibileGasolioContoTerzi").value);this.consumiForm.get("ammissibileGasolioTotale").setValue(i+e)}setDisponibile(i){i&&(this.consumiForm.get("disponibileGasolioTotale").setValue(i.gasolio),this.consumiForm.get("disponibileBenzina").setValue(i.benzina),this.consumiForm.get("disponibileGasolioSerre").setValue(i.gasolioSerre),this.consumiForm.get("consumatoGasolioContoProprio").updateValueAndValidity())}calcolaDisponibile(i,e,t,o){if(!(i||e||t||o))return;const a=new ce.a;return a.gasolio=(i?i.gasolio:0)+(i?i.gasolioTerzi:0)+(e?e.gasolio:0)+(t?t.gasolio:0)-(o?o.gasolio:0),a.benzina=(i?i.benzina:0)+(e?e.benzina:0)+(t?t.benzina:0)-(o?o.benzina:0),a.gasolioSerre=(i?i.gasolioSerre:0)+(e?e.gasolioSerre:0)+(t?t.gasolioSerre:0)-(o?o.gasolioSerre:0),a}calcolaAccisaByCarburante(i){const e=new ce.a;if("GASOLIO"===i){const i=this.formatSrv.toNumber(this.consumiForm.get("disponibileGasolioTotale").value),t=this.formatSrv.toNumber(this.consumiForm.get("ammissibileGasolioTotale").value),o=this.formatSrv.toNumber(this.consumiForm.get("rimanenzaDicembreGasolioTotale").value),a=this.formatSrv.toNumber(this.consumiForm.get("recuperoGasolioTotale").value),n=this.formatSrv.toNumber(this.consumiForm.get("consumatoGasolioTotale").value);return e.gasolio=n>t?i-t-o-a:i-n-o-a,e.gasolio}if("BENZINA"===i){const i=this.formatSrv.toNumber(this.consumiForm.get("disponibileBenzina").value),t=this.formatSrv.toNumber(this.consumiForm.get("rimanenzaDicembreBenzina").value),o=this.formatSrv.toNumber(this.consumiForm.get("recuperoBenzina").value),a=this.formatSrv.toNumber(this.consumiForm.get("ammissibileBenzina").value),n=this.formatSrv.toNumber(this.consumiForm.get("consumatoBenzina").value);return e.benzina=n>a?i-a-t-o:i-n-t-o,e.benzina}if("GASOLIO_SERRE"===i){const i=this.formatSrv.toNumber(this.consumiForm.get("disponibileGasolioSerre").value),t=this.formatSrv.toNumber(this.consumiForm.get("rimanenzaDicembreGasolioSerre").value),o=this.formatSrv.toNumber(this.consumiForm.get("recuperoGasolioSerre").value),a=this.formatSrv.toNumber(this.consumiForm.get("ammissibileGasolioSerre").value),n=this.formatSrv.toNumber(this.consumiForm.get("consumatoGasolioSerre").value);return e.gasolioSerre=n>a?i-a-t-o:i-n-t-o,e.gasolioSerre}return 0}setAccisaByCarburante(i,e){null!=e&&setTimeout(()=>{"GASOLIO"===i?this.consumiForm.get("accisaGasolioTotale").setValue(e):"BENZINA"===i?this.consumiForm.get("accisaBenzina").setValue(e):this.consumiForm.get("accisaGasolioSerre").setValue(e),!this.isAccisaObbligatoria()||this.READONLY_MODE?this.consumiForm.get("accisaMotivo").disable():(this.consumiForm.get("accisaMotivo").enable(),this.consumiForm.get("accisaMotivo").setValidators([L.G.required]))},0)}setCarburanteRicevuto(i){i&&(this.consumiForm.get("ricevutoGasolioTotale").setValue(i.gasolio),this.consumiForm.get("ricevutoBenzina").setValue(i.benzina),this.consumiForm.get("ricevutoGasolioSerre").setValue(i.gasolioSerre))}setCarburanteTrasferito(i){i&&(this.consumiForm.get("trasferitoGasolioTotale").setValue(i.gasolio),this.consumiForm.get("trasferitoBenzina").setValue(i.benzina),this.consumiForm.get("trasferitoGasolioSerre").setValue(i.gasolioSerre))}setCarburantePrelevato(i){i&&(this.consumiForm.get("prelevatoGasolioTotale").setValue(i.gasolio),this.consumiForm.get("prelevatoBenzina").setValue(i.benzina),this.consumiForm.get("prelevatoGasolioSerre").setValue(i.gasolioSerre))}sommaCarburante(i){const e={};return e.benzina=i.reduce((i,e)=>i+e.benzina,0),e.gasolio=i.reduce((i,e)=>i+e.gasolio,0),e.gasolioSerre=i.reduce((i,e)=>i+e.gasolioSerre,0),e}initVariables(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.calendarService.configITA(),this.tipologicheService.setMotiviAccisa(),this.idFascicolo=this.indiceUmaService.idFascicolo||null,this.areCollapsed=[!0,!0,!0],this.loading=!0,this.maxLengthInput=7,this.motivoRecuperoAmmissibile={},this.motivoRecuperoGasolioContoProprio={},this.motivoRecuperoGasolioContoTerzi={},this.motivoRecuperoBenzina={},this.motivoRecuperoGasolioSerre={},this.motivoRecuperoAmmissibile.allegati=[],this.motivoRecuperoGasolioContoProprio.allegati=[],this.motivoRecuperoGasolioContoTerzi.allegati=[],this.motivoRecuperoBenzina.allegati=[],this.motivoRecuperoGasolioSerre.allegati=[],this.initForm()}initForm(){this.consumiForm=new L.j({dataConduzione:new L.g({value:null,disabled:!1}),residuoGasolioContoProprio:new L.g({value:"0",disabled:!0}),residuoGasolioContoTerzi:new L.g({value:"0",disabled:!0}),residuoGasolioTotale:new L.g({value:"0",disabled:!0}),residuoBenzina:new L.g({value:"0",disabled:!0}),residuoGasolioSerre:new L.g({value:"0",disabled:!0}),ammissibileGasolioContoProprio:new L.g({value:"0",disabled:!0}),ammissibileGasolioContoTerzi:new L.g({value:null,disabled:this.READONLY_MODE}),ammissibileGasolioTotale:new L.g({value:"0",disabled:!0}),ammissibileBenzina:new L.g({value:"0",disabled:!0}),ammissibileGasolioSerre:new L.g({value:"0",disabled:!0}),richAssegnatoGasolioContoProprio:new L.g({value:"0",disabled:!0}),richAssegnatoGasolioContoTerzi:new L.g({value:"0",disabled:!0}),richAssegnatoGasolioTotale:new L.g({value:"0",disabled:!0}),richAssegnatoBenzina:new L.g({value:"0",disabled:!0}),richAssegnatoGasolioSerre:new L.g({value:"0",disabled:!0}),ricevutoGasolioTotale:new L.g({value:"0",disabled:!0}),ricevutoBenzina:new L.g({value:"0",disabled:!0}),ricevutoGasolioSerre:new L.g({value:"0",disabled:!0}),trasferitoGasolioTotale:new L.g({value:"0",disabled:!0}),trasferitoBenzina:new L.g({value:"0",disabled:!0}),trasferitoGasolioSerre:new L.g({value:"0",disabled:!0}),prelevatoGasolioTotale:new L.g({value:"0",disabled:!0}),prelevatoBenzina:new L.g({value:"0",disabled:!0}),prelevatoGasolioSerre:new L.g({value:"0",disabled:!0}),disponibileGasolioTotale:new L.g({value:"0",disabled:!0}),disponibileBenzina:new L.g({value:"0",disabled:!0}),disponibileGasolioSerre:new L.g({value:"0",disabled:!0}),accisaGasolioTotale:new L.g({value:"0",disabled:!0}),accisaBenzina:new L.g({value:"0",disabled:!0}),accisaGasolioSerre:new L.g({value:"0",disabled:!0}),accisaMotivo:new L.g({value:null,disabled:this.READONLY_MODE}),consumatoGasolioContoProprio:new L.g({value:null,disabled:this.READONLY_MODE}),consumatoGasolioContoTerzi:new L.g({value:null,disabled:this.READONLY_MODE}),consumatoGasolioTotale:new L.g({value:"0",disabled:!0}),consumatoBenzina:new L.g({value:null,disabled:this.READONLY_MODE}),consumatoGasolioSerre:new L.g({value:null,disabled:this.READONLY_MODE}),rimanenzaDicembreGasolioContoProprio:new L.g({value:null,disabled:this.READONLY_MODE}),rimanenzaDicembreGasolioContoTerzi:new L.g({value:null,disabled:this.READONLY_MODE}),rimanenzaDicembreGasolioTotale:new L.g({value:"0",disabled:!0}),rimanenzaDicembreBenzina:new L.g({value:null,disabled:this.READONLY_MODE}),rimanenzaDicembreGasolioSerre:new L.g({value:null,disabled:this.READONLY_MODE}),recuperoGasolioContoProprio:new L.g({value:null,disabled:this.READONLY_MODE}),recuperoGasolioContoTerzi:new L.g({value:null,disabled:this.READONLY_MODE}),recuperoGasolioTotale:new L.g({value:"0",disabled:!0}),recuperoBenzina:new L.g({value:null,disabled:this.READONLY_MODE}),recuperoGasolioSerre:new L.g({value:null,disabled:this.READONLY_MODE})})}disableFieldsByCarburate(i){i&&(i.benzina||(this.consumiForm.get("consumatoBenzina").disable(),this.consumiForm.get("rimanenzaDicembreBenzina").disable(),this.consumiForm.get("recuperoBenzina").disable()),i.gasolio||(this.consumiForm.get("consumatoGasolioContoProprio").disable(),this.consumiForm.get("rimanenzaDicembreGasolioContoProprio").disable(),this.consumiForm.get("recuperoGasolioContoProprio").disable()))}saveConsuntivo(i,e,t,o,a){return this.httpClientDichiarazioneConsumiUmaService.saveAllegatiConsuntivo(this.dichiarazioneConsumiDto.id.toString(),this.consumiBuilderService.buildConsuntivoDto(t,o,i,a),this.toFileByTipo(a.allegati,e))}updateAndValidateMotivo(i,e){switch(i){case Vt.AMMISSIBILE_GASOLIO_TERZI:this.motivoRecuperoAmmissibile.idConsuntivo=e,this.consumiForm.get("ammissibileGasolioTotale").updateValueAndValidity();break;case Vt.RECUPERO_GASOLIO_PROPRIO:this.motivoRecuperoGasolioContoProprio.idConsuntivo=e,this.consumiForm.get("recuperoGasolioContoProprio").updateValueAndValidity();break;case Vt.RECUPERO_GASOLIO_TERZI:this.motivoRecuperoGasolioContoTerzi.idConsuntivo=e,this.consumiForm.get("recuperoGasolioContoTerzi").updateValueAndValidity();break;case Vt.RECUPERO_BENZINA:this.motivoRecuperoBenzina.idConsuntivo=e,this.consumiForm.get("recuperoBenzina").updateValueAndValidity();break;case Vt.RECUPERO_GASOLIO_SERRE:this.motivoRecuperoGasolioSerre.idConsuntivo=e,this.consumiForm.get("recuperoGasolioSerre").updateValueAndValidity()}}toFileByTipo(i,e){return e===Vt.AMMISSIBILE_GASOLIO_TERZI?this.consumiBuilderService.toFileWithMetaDati(i,this.SEPARATOR):this.consumiBuilderService.toFile(i)}recuperaIDConsuntivo(i){switch(i){case Vt.AMMISSIBILE_GASOLIO_TERZI:return this.motivoRecuperoAmmissibile.idConsuntivo;case Vt.RECUPERO_GASOLIO_PROPRIO:return this.motivoRecuperoGasolioContoProprio.idConsuntivo;case Vt.RECUPERO_GASOLIO_TERZI:return this.motivoRecuperoGasolioContoTerzi.idConsuntivo;case Vt.RECUPERO_BENZINA:return this.motivoRecuperoBenzina.idConsuntivo;case Vt.RECUPERO_GASOLIO_SERRE:return this.motivoRecuperoGasolioSerre.idConsuntivo;default:return null}}svuotaAllegati(i){switch(i){case Vt.AMMISSIBILE_GASOLIO_TERZI:this.motivoRecuperoAmmissibile=null,this.popupAllegatiMotivoConsumi.reset(),this.consumiForm.get("ammissibileGasolioContoTerzi").setValue(null),this.consumiForm.get("ammissibileGasolioContoTerzi").updateValueAndValidity();break;case Vt.RECUPERO_GASOLIO_PROPRIO:this.motivoRecuperoGasolioContoProprio=null,this.consumiForm.get("recuperoGasolioContoProprio").setValue(null),this.consumiForm.get("recuperoGasolioContoProprio").updateValueAndValidity();break;case Vt.RECUPERO_GASOLIO_TERZI:this.motivoRecuperoGasolioContoTerzi=null,this.consumiForm.get("recuperoGasolioContoTerzi").setValue(null),this.consumiForm.get("recuperoGasolioContoTerzi").updateValueAndValidity();break;case Vt.RECUPERO_BENZINA:this.motivoRecuperoBenzina=null,this.consumiForm.get("recuperoBenzina").setValue(null),this.consumiForm.get("recuperoBenzina").updateValueAndValidity();break;case Vt.RECUPERO_GASOLIO_SERRE:this.motivoRecuperoGasolioSerre=null,this.consumiForm.get("recuperoGasolioSerre").setValue(null),this.consumiForm.get("recuperoGasolioSerre").updateValueAndValidity()}}initDataConduzione(){this.dichiarazioneConsumiDto.dataConduzione?(this.dataConduzioneDefault=this.dataConduzioneDefault?this.dataConduzioneDefault:new Date(this.dichiarazioneConsumiDto.dataConduzione),this.minDate=this.setMinDate(),this.maxDate=this.setMaxDate(),this.consumiForm.get("dataConduzione").setValue(new Date(this.dichiarazioneConsumiDto.dataConduzione))):console.error("NON \xe8 stato possibile ricavare dal servizio backend la data di conduzione!")}setMinDate(){return this.dichiarazioneConsumiDto&&new Date(this.dichiarazioneConsumiDto.dataConduzione).getFullYear()==this.dateUtilService.getCurrentYear()?this.dateUtilService.toDateFrom(1,1,new Date(this.dichiarazioneConsumiDto.dataConduzione).getFullYear()):this.dateUtilService.toDateFrom(1,1,this.dateUtilService.getCurrentYear())}setMaxDate(){return this.dichiarazioneConsumiDto&&new Date(this.dichiarazioneConsumiDto.dataConduzione).getFullYear()==this.dateUtilService.getCurrentYear()?this.dateUtilService.getToday():this.dateUtilService.toDateFrom(31,12,new Date(this.dichiarazioneConsumiDto.dataConduzione).getFullYear())}confermaCambioData(i){const e=new Date(this.consumiForm.get("dataConduzione").value),t=this.dateUtilService.toDateWithNoOffset(e).toISOString();this.updateDataConduzioneSubscription=this.httpClientDichiarazioneConsumiUmaService.updateDichiarazioneConsumi(this.dichiarazioneConsumiDto.id.toString(),this.consumiBuilderService.buildDichiarazioneConsumiPatch(null,t)).subscribe(i=>{this.dichiarazioneConsumiDto.dataConduzione=this.dateUtilService.toDateWithNoOffset(e),this.messageService.add(c.a.getToast("tst",c.b.success,g.a.salvataggioConsuntiviOk)),this.router.navigate([this.router.url])},i=>{this.errorService.showError(i),this.consumiForm.get("dataConduzione").setValue(this.dataConduzioneDefault)})}erroreEliminazioneDichiarazioneORettifica(i){this.confirmationService.confirm({message:g.a.rettificaIncompilazione,accept:()=>{const i=new Do.a;i.cuaa=this.dichiarazioneConsumiDto.cuaa,i.campagna=[this.dichiarazioneConsumiDto.campagnaRichiesta.toString()],i.stati=[S.a.IN_COMPILAZIONE],i.numeroElementiPagina=1,this.getDomandeSubscription=this.httpClientDomandUmaService.getDomande(i).pipe(Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>(console.log("richieste:",i),this.httpClientDomandUmaService.deleteDomandaById(i[0].id.toString())))).subscribe(i=>{this.popupProtocollaVisibile=!0},i=>this.errorService.showError(i))},reject:()=>{this.confermaEliminaDichiarazione()},key:"rettifica-error-dialog"})}errorRichiestaObsoleta(i){this.confirmationService.confirm({message:g.a.richiestaObsoleta,accept:()=>{this.confermaEliminaDichiarazione()},reject:()=>{},key:"rettifica-error-dialog"})}confermaEliminaDichiarazione(){this.deleteSubscription=this.httpClientDichiarazioneConsumiUmaService.deleteDichiarazioneConsumi(this.dichiarazioneConsumiDto.id.toString()).subscribe(()=>{this.messageService.add(c.a.getToast("tst-delete",c.b.success,g.a.cancellazioneDichiarazioneConsumiOK))},i=>this.errorService.showError(i))}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(co.a),p.Nb(Ro.a),p.Nb(f),p.Nb(z.a),p.Nb(se.a),p.Nb(no.a),p.Nb(d),p.Nb(b.a),p.Nb(B),p.Nb(C.a),p.Nb(o.n),p.Nb(T.a),p.Nb(A.d),p.Nb(re.a),p.Nb(A.a),p.Nb(Eo),p.Nb(Ii.a),p.Nb(u.a),p.Nb(z.e),p.Nb(b.a),p.Nb(ae.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-consumi"]],viewQuery:function(i,e){var t;1&i&&(p.Jc(Go,!0),p.Jc(Uo,!0),p.Uc(ko,!0),p.Uc(Vo,!0)),2&i&&(p.Ac(t=p.cc())&&(e.popupAllegatiMotivoConsumi=t.first),p.Ac(t=p.cc())&&(e.popupAllegatiMotivoRecupero=t.first),p.Ac(t=p.cc())&&(e.dataConduzioneRef=t.first),p.Ac(t=p.cc())&&(e.dialog=t.first))},decls:279,vars:150,consts:[[3,"chiudiPopup"],["popupAllegatiMotivoConsumi",""],["popupAllegatiMotivoRecupero",""],[3,"cfRichiedente","idFascicolo","idDichiarazione","popupVisibile","cuaa","chiudiPopup",4,"ngIf"],["header","Attenzione","icon","pi pi-exclamation-triangle","key","conferma-accisa-dialog",1,"ui-dialog-visible"],["cd",""],["type","button","pButton","","label","OK",1,"w-10m",3,"click"],["header","Attenzione","icon","pi pi-exclamation-triangle","key","conferma-cambio-data","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["cambioData",""],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","rettifica-error-dialog","acceptLabel","OK","rejectLabel","Annulla","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible",3,"closable"],["key","tst"],["position","top-center","key","tst-delete",3,"modal","baseZIndex","onClose"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"p-col"],["position","center","key","checkCancella",3,"modal","baseZIndex"],["deleteToast",""],["pTemplate","message"],["novalidate","",1,"p-grid","p-align-center",3,"formGroup"],[1,"p-col-3","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-altre_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed w-10m px-1 py-1",4,"ngIf"],["class","p-col-fixed w-13m px-1 py-1",4,"ngIf"],[1,"boxgrey"],["class","p-grid p-align-center",4,"ngIf"],[1,"p-grid"],[3,"toggleable","collapsed","collapsedChange"],[1,"p-grid","text-center"],[1,"p-col","p-col-align-center","font-15"],[1,"p-col","p-col-align-center"],["type","text","pInputText","","formControlName","residuoGasolioContoProprio",1,"text-right"],["type","text","pInputText","","formControlName","residuoGasolioContoTerzi",1,"text-right"],["type","text","pInputText","","formControlName","residuoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","residuoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","residuoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","ammissibileGasolioContoProprio",1,"text-right"],[1,"ui-inputgroup"],["pButton","","type","button","class","icon-button-square","title","Allega un documento","icon","pi pi-attachment",3,"click",4,"ngIf"],["pButton","","type","button","class","icon-button-square border-left-0","title","Elimina allegati","icon","pi pi-times",3,"click",4,"ngIf"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","ammissibileGasolioContoTerzi",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","maxlength","blur"],["inputAmmissibileGasolioContoTerzi",""],["class","font-12","severity","error","text","Formato non valido",4,"ngIf"],["class","font-12","severity","error","text","Per procedere \xe8 necessario aggiungere gli allegati",4,"ngIf"],["class","font-12","severity","error","text","Per procedere \xe8 necessario eliminare gli allegati",4,"ngIf"],["type","text","pInputText","","formControlName","ammissibileGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","ammissibileBenzina",1,"text-right"],["type","text","pInputText","","formControlName","ammissibileGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","richAssegnatoGasolioContoProprio",1,"text-right"],["type","text","pInputText","","formControlName","richAssegnatoGasolioContoTerzi",1,"text-right"],["inputRichiestoAssegnatoGasolioTerzi",""],["type","text","pInputText","","formControlName","richAssegnatoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","richAssegnatoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","richAssegnatoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","ricevutoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","ricevutoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","ricevutoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","trasferitoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","trasferitoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","trasferitoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","prelevatoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","prelevatoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","prelevatoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","disponibileGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","disponibileBenzina",1,"text-right"],["type","text","pInputText","","formControlName","disponibileGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","accisaGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","accisaBenzina",1,"text-right"],["type","text","pInputText","","formControlName","accisaGasolioSerre",1,"text-right"],[1,"p-col-2","p-col-align-center"],[1,"p-col-4"],[1,"p-col-6"],["formControlName","accisaMotivo",3,"options","onChange"],[4,"ngIf"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","consumatoGasolioContoProprio",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputConsumatoGasolioContoProprio",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","consumatoGasolioContoTerzi",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputConsumatoGasolioContoTerzi",""],["type","text","pInputText","","formControlName","consumatoGasolioTotale",1,"text-right",3,"maxlength"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","consumatoBenzina",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputConsumatoBenzina",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","consumatoGasolioSerre",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputConsumatoGasolioSerre",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","rimanenzaDicembreGasolioContoProprio",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputRimanenzaDicembreGasolioContoProprio",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","rimanenzaDicembreGasolioContoTerzi",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputRimanenzaDicembreGasolioContoTerzi",""],["type","text","pInputText","","formControlName","rimanenzaDicembreGasolioTotale",1,"text-right",3,"maxlength"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","rimanenzaDicembreBenzina",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputRimanenzaDicembreBenzina",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","rimanenzaDicembreGasolioSerre",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputRimanenzaDicembreGasolioSerre",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","recuperoGasolioContoProprio",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","a4gLimitSumArray","maxlength","blur"],["inputRecuperoGasolioContoProprio",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","recuperoGasolioContoTerzi",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","a4gLimitSumArray","maxlength","blur"],["inputRecuperoGasolioContoTerzi",""],["type","text","pInputText","","formControlName","recuperoGasolioTotale",1,"text-right"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","recuperoBenzina",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","a4gLimitSumArray","maxlength","blur"],["inputRecuperoBenzina",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","recuperoGasolioSerre",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","a4gLimitSumArray","maxlength","blur"],["inputRecuperoGasolioSerre",""],[3,"cfRichiedente","idFascicolo","idDichiarazione","popupVisibile","cuaa","chiudiPopup"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"],[1,"p-col-fixed","w-10m","px-1","py-1"],["pButton","","class","ui-button-secondary ui-button-text button-accent-alt","type","submit","label","SALVA","icon","pi pi-save","iconPos","right",3,"click",4,"loading"],["pButton","","type","submit","label","SALVA","icon","pi pi-save","iconPos","right",1,"ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],[1,"p-col-fixed","w-13m","px-1","py-1"],["pButton","","type","button","label","SALVA E PROTOCOLLA...",3,"click",4,"loading"],["pButton","","type","button","label","SALVA E PROTOCOLLA...",3,"click"],[1,"p-grid","p-align-center"],[1,"p-col-2"],["formControlName","dataConduzione","dateFormat","dd MM yy",3,"locale","showIcon","minDate","maxDate","readonlyInput","onSelect"],["dataConduzioneRef",""],["class","p-col-2",3,"click",4,"ngIf"],[1,"p-col-2",3,"click"],[1,"text-primary","cursor-pointer"],["pButton","","type","button","title","Allega un documento","icon","pi pi-attachment",1,"icon-button-square",3,"click"],["pButton","","type","button","title","Elimina allegati","icon","pi pi-times",1,"icon-button-square","border-left-0",3,"click"],["severity","error","text","Formato non valido",1,"font-12"],["severity","error","text","Per procedere \xe8 necessario aggiungere gli allegati",1,"font-12"],["severity","error","text","Per procedere \xe8 necessario eliminare gli allegati",1,"font-12"],["class","font-12","severity","error","text","E' obbligatorio inserire una motivazione",4,"ngIf"],["severity","error","text","E' obbligatorio inserire una motivazione",1,"font-12"],["class","font-12","severity","error",3,"text",4,"ngIf"],["severity","error",1,"font-12",3,"text"]],template:function(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-popup-allegati-motivo-consumi",0,1),p.bc("chiudiPopup",(function(i){return e.closeDialogMotivazione(i)})),p.Sb(),p.Tb(2,"app-popup-motivo-recupero",0,2),p.bc("chiudiPopup",(function(i){return e.closeDialogMotivazione(i)})),p.Sb(),p.Mc(4,Ho,1,5,"app-popup-protocollazione-dichiarazione",3),p.Tb(5,"p-confirmDialog",4,5),p.Tb(7,"p-footer"),p.Tb(8,"button",6),p.bc("click",(function(){return p.Ec(i),p.Bc(6).accept()})),p.Sb(),p.Sb(),p.Sb(),p.Ob(9,"p-confirmDialog",7,8),p.Ob(11,"p-confirmDialog",9),p.Ob(12,"p-toast",10),p.Tb(13,"p-toast",11),p.bc("onClose",(function(){return e.onCloseToastCancellazione()})),p.Sb(),p.Tb(14,"div",12),p.Tb(15,"div",13),p.Tb(16,"div",14),p.Tb(17,"p-toast",15,16),p.Mc(19,Zo,11,2,"ng-template",17),p.Sb(),p.Tb(20,"form",18),p.Tb(21,"div",19),p.Tb(22,"a",20),p.bc("click",(function(){return e.goBack()})),p.Ob(23,"i",21),p.Ob(24,"img",22),p.Tb(25,"span",23),p.Tb(26,"strong",24),p.Oc(27),p.gc(28,"uppercase"),p.gc(29,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Ob(30,"div",14),p.Mc(31,Yo,2,1,"div",25),p.Mc(32,qo,2,1,"div",26),p.Tb(33,"div",27),p.Mc(34,Qo,6,4,"div",28),p.Mc(35,Wo,8,6,"div",28),p.Tb(36,"div",29),p.Tb(37,"div",14),p.Tb(38,"p-panel",30),p.bc("collapsedChange",(function(i){return e.areCollapsed[0]=i})),p.Tb(39,"p-header"),p.Oc(40,"Riepilogo anno precedente"),p.Sb(),p.Tb(41,"div",31),p.Ob(42,"div",14),p.Tb(43,"div",32),p.Oc(44,"Gasolio conto proprio"),p.Sb(),p.Tb(45,"div",32),p.Oc(46,"Gasolio conto terzi e svincolate"),p.Sb(),p.Tb(47,"div",32),p.Oc(48,"Gasolio totale"),p.Sb(),p.Tb(49,"div",32),p.Oc(50,"Benzina"),p.Sb(),p.Tb(51,"div",32),p.Oc(52,"Gasolio serre"),p.Sb(),p.Sb(),p.Tb(53,"div",29),p.Tb(54,"div",33),p.Tb(55,"small"),p.Oc(56,"Residuo campagna precedente (lt)"),p.Sb(),p.Sb(),p.Tb(57,"div",14),p.Ob(58,"input",34),p.Sb(),p.Tb(59,"div",14),p.Ob(60,"input",35),p.Sb(),p.Tb(61,"div",14),p.Ob(62,"input",36),p.Sb(),p.Tb(63,"div",14),p.Ob(64,"input",37),p.Sb(),p.Tb(65,"div",14),p.Ob(66,"input",38),p.Sb(),p.Sb(),p.Tb(67,"div",29),p.Tb(68,"div",33),p.Tb(69,"small"),p.Oc(70,"Ammissibile (lt)"),p.Sb(),p.Sb(),p.Tb(71,"div",14),p.Ob(72,"input",39),p.Sb(),p.Tb(73,"div",14),p.Tb(74,"div",40),p.Mc(75,Jo,1,0,"button",41),p.Mc(76,Xo,1,0,"button",42),p.Tb(77,"input",43,44),p.bc("blur",(function(){p.Ec(i);const t=p.Bc(78),o=p.Bc(97);return t.value>0&&!(null!=e.motivoRecuperoAmmissibile&&null!=e.motivoRecuperoAmmissibile.allegati&&e.motivoRecuperoAmmissibile.allegati.length)&&t.value!=o.value&&e.openDialogMotivazione("AMMISSIBILE_GASOLIO_TERZI")})),p.Sb(),p.Sb(),p.Tb(79,"div"),p.Mc(80,ia,1,0,"p-message",45),p.Mc(81,ea,1,0,"p-message",46),p.Mc(82,ta,1,0,"p-message",47),p.Sb(),p.Sb(),p.Tb(83,"div",14),p.Ob(84,"input",48),p.Sb(),p.Tb(85,"div",14),p.Ob(86,"input",49),p.Sb(),p.Tb(87,"div",14),p.Ob(88,"input",50),p.Sb(),p.Sb(),p.Tb(89,"div",29),p.Tb(90,"div",33),p.Tb(91,"small"),p.Oc(92,"Richiesto/Assegnato (lt)"),p.Sb(),p.Sb(),p.Tb(93,"div",14),p.Ob(94,"input",51),p.Sb(),p.Tb(95,"div",14),p.Ob(96,"input",52,53),p.Sb(),p.Tb(98,"div",14),p.Ob(99,"input",54),p.Sb(),p.Tb(100,"div",14),p.Ob(101,"input",55),p.Sb(),p.Tb(102,"div",14),p.Ob(103,"input",56),p.Sb(),p.Sb(),p.Sb(),p.Tb(104,"p-panel",30),p.bc("collapsedChange",(function(i){return e.areCollapsed[1]=i})),p.Tb(105,"p-header"),p.Oc(106,"Operazioni carburante"),p.Sb(),p.Tb(107,"div",31),p.Ob(108,"div",14),p.Ob(109,"div",32),p.Ob(110,"div",32),p.Tb(111,"div",32),p.Oc(112,"Gasolio totale"),p.Sb(),p.Tb(113,"div",32),p.Oc(114,"Benzina"),p.Sb(),p.Tb(115,"div",32),p.Oc(116,"Gasolio serre"),p.Sb(),p.Sb(),p.Tb(117,"div",29),p.Tb(118,"div",33),p.Tb(119,"small"),p.Oc(120,"Ricevuto (lt)"),p.Sb(),p.Sb(),p.Ob(121,"div",14),p.Ob(122,"div",14),p.Tb(123,"div",14),p.Ob(124,"input",57),p.Sb(),p.Tb(125,"div",14),p.Ob(126,"input",58),p.Sb(),p.Tb(127,"div",14),p.Ob(128,"input",59),p.Sb(),p.Sb(),p.Tb(129,"div",29),p.Tb(130,"div",33),p.Tb(131,"small"),p.Oc(132,"Trasferito (lt)"),p.Sb(),p.Sb(),p.Ob(133,"div",14),p.Ob(134,"div",14),p.Tb(135,"div",14),p.Ob(136,"input",60),p.Sb(),p.Tb(137,"div",14),p.Ob(138,"input",61),p.Sb(),p.Tb(139,"div",14),p.Ob(140,"input",62),p.Sb(),p.Sb(),p.Tb(141,"div",29),p.Tb(142,"div",33),p.Tb(143,"small"),p.Oc(144,"Prelevato (lt)"),p.Sb(),p.Sb(),p.Ob(145,"div",14),p.Ob(146,"div",14),p.Tb(147,"div",14),p.Ob(148,"input",63),p.Sb(),p.Tb(149,"div",14),p.Ob(150,"input",64),p.Sb(),p.Tb(151,"div",14),p.Ob(152,"input",65),p.Sb(),p.Sb(),p.Tb(153,"div",29),p.Tb(154,"div",33),p.Tb(155,"small"),p.Oc(156,"Disponibile (lt)"),p.Sb(),p.Sb(),p.Ob(157,"div",14),p.Ob(158,"div",14),p.Tb(159,"div",14),p.Ob(160,"input",66),p.Sb(),p.Tb(161,"div",14),p.Ob(162,"input",67),p.Sb(),p.Tb(163,"div",14),p.Ob(164,"input",68),p.Sb(),p.Sb(),p.Tb(165,"div",29),p.Tb(166,"div",33),p.Tb(167,"small"),p.Oc(168,"Accisa (lt)"),p.Sb(),p.Sb(),p.Ob(169,"div",14),p.Ob(170,"div",14),p.Tb(171,"div",14),p.Ob(172,"input",69),p.Sb(),p.Tb(173,"div",14),p.Ob(174,"input",70),p.Sb(),p.Tb(175,"div",14),p.Ob(176,"input",71),p.Sb(),p.Sb(),p.Tb(177,"div",29),p.Tb(178,"div",72),p.Tb(179,"small"),p.Oc(180,"Motivo accisa"),p.Sb(),p.Sb(),p.Ob(181,"div",73),p.Tb(182,"div",74),p.Tb(183,"p-dropdown",75),p.bc("onChange",(function(i){return e.onChangeMotivoAccisa(i)})),p.Sb(),p.Mc(184,aa,2,1,"div",76),p.Sb(),p.Sb(),p.Mc(185,na,3,0,"p-footer",76),p.Sb(),p.Tb(186,"p-panel",30),p.bc("collapsedChange",(function(i){return e.areCollapsed[2]=i})),p.Tb(187,"p-header"),p.Oc(188,"Dichiarazione consumi"),p.Sb(),p.Tb(189,"div",31),p.Ob(190,"div",14),p.Tb(191,"div",32),p.Oc(192,"Gasolio conto proprio"),p.Sb(),p.Tb(193,"div",32),p.Oc(194,"Gasolio conto terzi e svincolate"),p.Sb(),p.Tb(195,"div",32),p.Oc(196,"Gasolio totale"),p.Sb(),p.Tb(197,"div",32),p.Oc(198,"Benzina"),p.Sb(),p.Tb(199,"div",32),p.Oc(200,"Gasolio serre"),p.Sb(),p.Sb(),p.Tb(201,"div",29),p.Tb(202,"div",33),p.Tb(203,"small"),p.Oc(204,"Consumato (lt)"),p.Sb(),p.Sb(),p.Tb(205,"div",14),p.Ob(206,"input",77,78),p.Mc(208,ca,3,2,"div",76),p.Sb(),p.Tb(209,"div",14),p.Ob(210,"input",79,80),p.Mc(212,ba,3,2,"div",76),p.Sb(),p.Tb(213,"div",14),p.Ob(214,"input",81),p.Sb(),p.Tb(215,"div",14),p.Ob(216,"input",82,83),p.Mc(218,pa,3,2,"div",76),p.Sb(),p.Tb(219,"div",14),p.Ob(220,"input",84,85),p.Mc(222,fa,3,2,"div",76),p.Sb(),p.Sb(),p.Tb(223,"div",29),p.Tb(224,"div",33),p.Tb(225,"small"),p.Oc(226,"Rimanenza al 31 dicembre (lt)"),p.Sb(),p.Sb(),p.Tb(227,"div",14),p.Ob(228,"input",86,87),p.Mc(230,Ca,3,2,"div",76),p.Sb(),p.Tb(231,"div",14),p.Ob(232,"input",88,89),p.Mc(234,Ia,3,2,"div",76),p.Sb(),p.Tb(235,"div",14),p.Ob(236,"input",90),p.Sb(),p.Tb(237,"div",14),p.Ob(238,"input",91,92),p.Mc(240,Ea,3,2,"div",76),p.Sb(),p.Tb(241,"div",14),p.Ob(242,"input",93,94),p.Mc(244,Ma,3,2,"div",76),p.Sb(),p.Sb(),p.Tb(245,"div",29),p.Tb(246,"div",33),p.Tb(247,"small"),p.Oc(248,"Recupero (lt)"),p.Sb(),p.Sb(),p.Tb(249,"div",14),p.Tb(250,"div",40),p.Mc(251,Na,1,0,"button",41),p.Mc(252,Ba,1,0,"button",42),p.Tb(253,"input",95,96),p.bc("blur",(function(){return p.Ec(i),p.Bc(254).value>0&&!(null!=e.motivoRecuperoGasolioContoProprio&&null!=e.motivoRecuperoGasolioContoProprio.allegati&&e.motivoRecuperoGasolioContoProprio.allegati.length)&&e.openDialogMotivazione("RECUPERO_GASOLIO_PROPRIO")})),p.Sb(),p.Sb(),p.Mc(255,wa,5,4,"div",76),p.Sb(),p.Tb(256,"div",14),p.Tb(257,"div",40),p.Mc(258,xa,1,0,"button",41),p.Mc(259,La,1,0,"button",42),p.Tb(260,"input",97,98),p.bc("blur",(function(){return p.Ec(i),p.Bc(261).value>0&&!(null!=e.motivoRecuperoGasolioContoTerzi&&null!=e.motivoRecuperoGasolioContoTerzi.allegati&&e.motivoRecuperoGasolioContoTerzi.allegati.length)&&e.openDialogMotivazione("RECUPERO_GASOLIO_TERZI")})),p.Sb(),p.Sb(),p.Mc(262,Ha,5,4,"div",76),p.Sb(),p.Tb(263,"div",14),p.Ob(264,"input",99),p.Sb(),p.Tb(265,"div",14),p.Tb(266,"div",40),p.Mc(267,Za,1,0,"button",41),p.Mc(268,ja,1,0,"button",42),p.Tb(269,"input",100,101),p.bc("blur",(function(){return p.Ec(i),p.Bc(270).value>0&&!(null!=e.motivoRecuperoBenzina&&null!=e.motivoRecuperoBenzina.allegati&&e.motivoRecuperoBenzina.allegati.length)&&e.openDialogMotivazione("RECUPERO_BENZINA")})),p.Sb(),p.Sb(),p.Mc(271,Ka,5,4,"div",76),p.Sb(),p.Tb(272,"div",14),p.Tb(273,"div",40),p.Mc(274,Wa,1,0,"button",41),p.Mc(275,Ja,1,0,"button",42),p.Tb(276,"input",102,103),p.bc("blur",(function(){return p.Ec(i),p.Bc(277).value>0&&!(null!=e.motivoRecuperoGasolioSerre&&null!=e.motivoRecuperoGasolioSerre.allegati&&e.motivoRecuperoGasolioSerre.allegati.length)&&e.openDialogMotivazione("RECUPERO_GASOLIO_SERRE")})),p.Sb(),p.Sb(),p.Mc(278,an,5,4,"div",76),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=p.Bc(78),t=p.Bc(97),o=p.Bc(254),a=p.Bc(261),n=p.Bc(270),r=p.Bc(277);p.Bb(4),p.mc("ngIf",e.dichiarazioneConsumiDto),p.Bb(7),p.mc("closable",!1),p.Bb(1),p.Kc(p.rc(89,nn)),p.Bb(1),p.mc("modal",!0)("baseZIndex",5e4),p.Bb(4),p.mc("modal",!0)("baseZIndex",5e3),p.Bb(3),p.mc("formGroup",e.consumiForm),p.Bb(7),p.Pc(p.hc(28,85,p.hc(29,87,"UMA.DICHIARAZIONE_CONSUMI.DICHIARAZIONE_CONSUMI"))),p.Bb(4),p.mc("ngIf",!e.READONLY_MODE),p.Bb(1),p.mc("ngIf",!e.READONLY_MODE),p.Bb(2),p.mc("ngIf",!e.isUtenteIstruttoreUma||e.isUtenteIstruttoreUma&&(null==e.dichiarazioneConsumiDto?null:e.dichiarazioneConsumiDto.stato)==e.STATO_DICHIARAZIONE_CONSUMI.PROTOCOLLATA),p.Bb(1),p.mc("ngIf",e.isUtenteIstruttoreUma&&(null==e.dichiarazioneConsumiDto?null:e.dichiarazioneConsumiDto.stato)==e.STATO_DICHIARAZIONE_CONSUMI.IN_COMPILAZIONE),p.Bb(3),p.mc("toggleable",!e.loading)("collapsed",e.areCollapsed[0]),p.Bb(37),p.mc("ngIf",e.showAllegatiIconAmmissibile(i,t)),p.Bb(1),p.mc("ngIf",!i.disabled&&(null==e.motivoRecuperoAmmissibile||null==e.motivoRecuperoAmmissibile.allegati?null:e.motivoRecuperoAmmissibile.allegati.length)>0),p.Bb(1),p.mc("a4gNotEmptyList",p.tc(91,sn,null==e.motivoRecuperoAmmissibile?null:e.motivoRecuperoAmmissibile.allegati,p.rc(90,rn)))("a4gNotZero",p.tc(95,sn,null==e.motivoRecuperoAmmissibile?null:e.motivoRecuperoAmmissibile.allegati,p.rc(94,rn)))("maxlength",e.maxLengthInput),p.Bb(3),p.mc("ngIf",null==e.consumiForm.get("ammissibileGasolioContoTerzi").errors?null:e.consumiForm.get("ammissibileGasolioContoTerzi").errors.pattern),p.Bb(1),p.mc("ngIf",null==e.consumiForm.get("ammissibileGasolioContoTerzi").errors?null:e.consumiForm.get("ammissibileGasolioContoTerzi").errors.emptylist),p.Bb(1),p.mc("ngIf",null==e.consumiForm.get("ammissibileGasolioContoTerzi").errors?null:e.consumiForm.get("ammissibileGasolioContoTerzi").errors.notZero),p.Bb(22),p.mc("toggleable",!e.loading)("collapsed",e.areCollapsed[1]),p.Bb(79),p.mc("options",e.tipologicheService.motiviAccisa),p.Bb(1),p.mc("ngIf",e.consumiForm.get("accisaMotivo").invalid&&(e.consumiForm.get("accisaMotivo").dirty||e.consumiForm.get("accisaMotivo").touched)),p.Bb(1),p.mc("ngIf",e.isAccisaObbligatoria()&&!e.READONLY_MODE),p.Bb(1),p.mc("toggleable",!e.loading)("collapsed",e.areCollapsed[2]),p.Bb(20),p.mc("a4gLimitSumArray",p.sc(99,ln,p.rc(98,cn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("consumatoGasolioContoProprio").invalid&&(e.consumiForm.get("consumatoGasolioContoProprio").dirty||e.consumiForm.get("consumatoGasolioContoProprio").touched)),p.Bb(2),p.mc("a4gLimitSumArray",p.sc(102,ln,p.rc(101,un)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("consumatoGasolioContoTerzi").invalid&&(e.consumiForm.get("consumatoGasolioContoTerzi").dirty||e.consumiForm.get("consumatoGasolioContoTerzi").touched)),p.Bb(2),p.mc("maxlength",e.maxLengthInput),p.Bb(2),p.mc("a4gLimitSumArray",p.sc(105,hn,p.rc(104,bn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("consumatoBenzina").invalid&&(e.consumiForm.get("consumatoBenzina").dirty||e.consumiForm.get("consumatoBenzina").touched)),p.Bb(2),p.mc("a4gLimitSumArray",p.sc(108,pn,p.rc(107,mn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("consumatoGasolioSerre").invalid&&(e.consumiForm.get("consumatoGasolioSerre").dirty||e.consumiForm.get("consumatoGasolioSerre").touched)),p.Bb(6),p.mc("a4gLimitSumArray",p.sc(111,ln,p.rc(110,dn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("rimanenzaDicembreGasolioContoProprio").invalid&&(e.consumiForm.get("rimanenzaDicembreGasolioContoProprio").dirty||e.consumiForm.get("rimanenzaDicembreGasolioContoProprio").touched)),p.Bb(2),p.mc("a4gLimitSumArray",p.sc(114,ln,p.rc(113,gn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").invalid&&(e.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").dirty||e.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").touched)),p.Bb(2),p.mc("maxlength",e.maxLengthInput),p.Bb(2),p.mc("a4gLimitSumArray",p.sc(117,hn,p.rc(116,fn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("rimanenzaDicembreBenzina").invalid&&(e.consumiForm.get("rimanenzaDicembreBenzina").dirty||e.consumiForm.get("rimanenzaDicembreBenzina").touched)),p.Bb(2),p.mc("a4gLimitSumArray",p.sc(120,pn,p.rc(119,vn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("rimanenzaDicembreGasolioSerre").invalid&&(e.consumiForm.get("rimanenzaDicembreGasolioSerre").dirty||e.consumiForm.get("rimanenzaDicembreGasolioSerre").touched)),p.Bb(7),p.mc("ngIf",e.consumiForm.get("recuperoGasolioContoProprio").value>0||(null==e.motivoRecuperoGasolioContoProprio||null==e.motivoRecuperoGasolioContoProprio.allegati?null:e.motivoRecuperoGasolioContoProprio.allegati.length)),p.Bb(1),p.mc("ngIf",!(null!=o&&o.disabled)&&(null==e.motivoRecuperoGasolioContoProprio||null==e.motivoRecuperoGasolioContoProprio.allegati?null:e.motivoRecuperoGasolioContoProprio.allegati.length)),p.Bb(1),p.mc("a4gNotEmptyList",p.sc(122,Sn,null==e.motivoRecuperoGasolioContoProprio?null:e.motivoRecuperoGasolioContoProprio.allegati))("a4gNotZero",p.sc(124,Sn,null==e.motivoRecuperoGasolioContoProprio?null:e.motivoRecuperoGasolioContoProprio.allegati))("a4gLimitSumArray",p.sc(127,ln,p.rc(126,Cn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("recuperoGasolioContoProprio").invalid&&(e.consumiForm.get("recuperoGasolioContoProprio").dirty||e.consumiForm.get("recuperoGasolioContoProprio").touched)),p.Bb(3),p.mc("ngIf",a.value>0||(null==e.motivoRecuperoGasolioContoTerzi||null==e.motivoRecuperoGasolioContoTerzi.allegati?null:e.motivoRecuperoGasolioContoTerzi.allegati.length)),p.Bb(1),p.mc("ngIf",!a.disabled&&(null==e.motivoRecuperoGasolioContoTerzi||null==e.motivoRecuperoGasolioContoTerzi.allegati?null:e.motivoRecuperoGasolioContoTerzi.allegati.length)),p.Bb(1),p.mc("a4gNotEmptyList",p.sc(129,Sn,null==e.motivoRecuperoGasolioContoTerzi?null:e.motivoRecuperoGasolioContoTerzi.allegati))("a4gNotZero",p.sc(131,Sn,null==e.motivoRecuperoGasolioContoTerzi?null:e.motivoRecuperoGasolioContoTerzi.allegati))("a4gLimitSumArray",p.sc(134,ln,p.rc(133,On)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("recuperoGasolioContoTerzi").invalid&&(e.consumiForm.get("recuperoGasolioContoTerzi").dirty||e.consumiForm.get("recuperoGasolioContoTerzi").touched)),p.Bb(5),p.mc("ngIf",n.value>0||(null==e.motivoRecuperoBenzina||null==e.motivoRecuperoBenzina.allegati?null:e.motivoRecuperoBenzina.allegati.length)),p.Bb(1),p.mc("ngIf",!n.disabled&&(null==e.motivoRecuperoBenzina||null==e.motivoRecuperoBenzina.allegati?null:e.motivoRecuperoBenzina.allegati.length)),p.Bb(1),p.mc("a4gNotEmptyList",p.sc(136,Sn,null==e.motivoRecuperoBenzina?null:e.motivoRecuperoBenzina.allegati))("a4gNotZero",p.sc(138,Sn,null==e.motivoRecuperoBenzina?null:e.motivoRecuperoBenzina.allegati))("a4gLimitSumArray",p.sc(141,hn,p.rc(140,Tn)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("recuperoBenzina").invalid&&(e.consumiForm.get("recuperoBenzina").dirty||e.consumiForm.get("recuperoBenzina").touched)),p.Bb(3),p.mc("ngIf",r.value>0||(null==e.motivoRecuperoGasolioSerre||null==e.motivoRecuperoGasolioSerre.allegati?null:e.motivoRecuperoGasolioSerre.allegati.length)),p.Bb(1),p.mc("ngIf",!r.disabled&&(null==e.motivoRecuperoGasolioSerre||null==e.motivoRecuperoGasolioSerre.allegati?null:e.motivoRecuperoGasolioSerre.allegati.length)),p.Bb(1),p.mc("a4gNotEmptyList",p.sc(143,Sn,null==e.motivoRecuperoGasolioSerre?null:e.motivoRecuperoGasolioSerre.allegati))("a4gNotZero",p.sc(145,Sn,null==e.motivoRecuperoGasolioSerre?null:e.motivoRecuperoGasolioSerre.allegati))("a4gLimitSumArray",p.sc(148,pn,p.rc(147,In)))("maxlength",e.maxLengthInput),p.Bb(2),p.mc("ngIf",e.consumiForm.get("recuperoGasolioSerre").invalid&&(e.consumiForm.get("recuperoGasolioSerre").dirty||e.consumiForm.get("recuperoGasolioSerre").touched))}},directives:[Io,ao,o.t,R.a,A.b,M.b,E.a,A.e,L.I,L.t,L.k,z.h,Mo.a,A.c,L.c,ue.a,L.s,L.i,L.z,No.a,Bo.a,L.n,lo.a,yo.a,wo,xo.a,Lo.a,he.b],pipes:[o.G,ni.d,o.f],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-13m[_ngcontent-%COMP%]{width:13em}[_nghost-%COMP%]   p-dropdown[_ngcontent-%COMP%] >   .ui-dropdown label.ui-dropdown-label{height:100%;font-weight:400!important}[_nghost-%COMP%]   .font-12[_ngcontent-%COMP%]{font-size:12px}[_nghost-%COMP%]   .font-15[_ngcontent-%COMP%]{font-size:15px}[_nghost-%COMP%]   input.ui-inputtext[_ngcontent-%COMP%]:disabled{border-bottom:1px dotted;opacity:.9;background:#e8f5e9}[_nghost-%COMP%]     a.ui-panel-titlebar-icon>span.pi.pi-minus, [_nghost-%COMP%]     a.ui-panel-titlebar-icon>span.pi.pi-plus{font-size:1.7em}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border:.5px solid #81c784;border-radius:unset;height:auto!important;width:6em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}[_nghost-%COMP%]   .testo-vert-centr-11[_ngcontent-%COMP%]{margin-top:11px;margin-left:0}[_nghost-%COMP%]   .testo-vert-centr-19[_ngcontent-%COMP%]{margin-top:19px;margin-left:20px;cursor:pointer}[_nghost-%COMP%]   .icon-button-square-alt[_ngcontent-%COMP%]{background-color:#fff!important;border:2px solid #01985a;border-radius:unset;height:auto!important;width:6em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square-alt[_ngcontent-%COMP%] >   span.pi{color:#01985a!important}[_nghost-%COMP%]   .icon-button-square-alt[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .icon-button-square-alt[_ngcontent-%COMP%]:hover{background-color:#e8e8e8!important}[_nghost-%COMP%]     button.ui-datepicker-trigger.ui-calendar-button{width:5.5em!important;height:5.5em!important;background:transparent!important;position:absolute}[_nghost-%COMP%]     .ui-dialog-footer .ui-button-icon-left:before{color:#fff}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.pi{color:#01985a!important;font-size:x-large!important}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),i})();var An=t("wd/R");let En=(()=>{class i{constructor(){}ricevutiDtoToRicevutiViewModelBuilder(i){const e=[];return i&&i.length&&i.forEach(i=>{const t={};t.benzina=i.carburante.benzina,t.gasolio=i.carburante.gasolio,t.gasolioSerre=i.carburante.gasolioSerre,t.data=An(i.data).format("DD/MM/YYYY"),t.cuaa=i.mittente.cuaa,t.denominazione=i.mittente.denominazione,e.push(t)}),e}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Rn=function(){return{marginTop:"70px"}};let Dn=(()=>{class i{constructor(i,e,t,o,a,n,r){this.indiceUmaService=i,this.location=e,this.route=t,this.httpClientDichiarazioneConsumiUmaService=o,this.httpCLientCarburanteRicevutoService=a,this.ricevutiBuilderService=n,this.errorService=r}ngOnInit(){this.initVariables(),this.routerSubscription=this.route.params.pipe(Object(r.a)(i=>this.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(i.id)),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>this.httpCLientCarburanteRicevutoService.getCarburanteRicevuto(i.cuaa,i.campagnaRichiesta.toString()))).subscribe(i=>{this.datasource=this.ricevutiBuilderService.ricevutiDtoToRicevutiViewModelBuilder(i.dati)},i=>this.errorService.showError(i))}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}goBack(){this.location.back()}initVariables(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.cols=this.defineColumns()}defineColumns(){return[{field:"cuaa",header:"CUAA",sortable:!0,font:K.e.BOLD,width:"25%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"denominazione",header:"Denominazione",sortable:!0,font:K.e.BOLD,width:"45%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"gasolio",header:"Gasolio ricevuto (lt.)",sortable:!1,width:"10%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"benzina",header:"Benzina ricevuta (lt.)",sortable:!1,width:"10%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"gasolioSerre",header:"Gasolio serre ricevuto (lt.)",sortable:!1,width:"10%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(f),p.Nb(o.n),p.Nb(z.a),p.Nb(se.a),p.Nb(no.a),p.Nb(En),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-ricevuti"]],decls:19,vars:10,consts:[["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-ricevuti_black.svg"],[1,"ml-2"],[1,"fs-20"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"cols","values"]],template:function(i,e){1&i&&(p.Ob(0,"p-toast",0),p.Tb(1,"div",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Tb(7,"a",7),p.bc("click",(function(){return e.goBack()})),p.Ob(8,"i",8),p.Ob(9,"img",9),p.Tb(10,"span",10),p.Tb(11,"strong",11),p.Oc(12),p.gc(13,"uppercase"),p.gc(14,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(15,"div",12),p.Tb(16,"div",13),p.Tb(17,"div",14),p.Ob(18,"app-a4g-multi-table",15),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Kc(p.rc(9,Rn)),p.Bb(12),p.Pc(p.hc(13,5,p.hc(14,7,"UMA.DICHIARAZIONE_CONSUMI.RICEVUTI"))),p.Bb(6),p.mc("cols",e.cols)("values",e.datasource))},directives:[E.a,z.h,ai.a],pipes:[o.G,ni.d],styles:[""]}),i})(),Mn=(()=>{class i{constructor(i,e){this.http=i,this.httpClientCore=e,this.CTX_BASE_PATH="/consumi",this.CTX_PATH="/clienti"}postAllegatiClientiContoterzi(i,e,t){const o=new FormData;return t.forEach(i=>{o.append("allegati",i)}),this.http.post(`${this.urlConsumi()}/${i}/clienti/${e}/allegati`,o)}getAllegatiClientiContoterzi(i,e){return this.http.get(`${this.urlConsumi()}/${i}/clienti/${e}/allegati`)}validaClientiContoterzi(i,e){return this.http.post(`${this.urlConsumi()}/${i}/clienti/valida?idFascicolo=${e}`,{})}getLavorazioniClientiContoTerzi(i,e){return this.http.get(`${this.urlConsumi()}/${i}${this.CTX_PATH}/${e}/lavorazioni`)}getFabbisogniRichiestaCliente(i,e){return this.http.get(`${this.urlConsumi()}/${i}${this.CTX_PATH}/${e}/fabbisogni-richiesta`)}getFabbisogniContoTerzista(i,e){return this.http.get(`${this.urlConsumi()}/${i}${this.CTX_PATH}/${e}/fabbisogni`)}saveLavorazioniClientiContoTerzi(i,e,t){return this.http.post(`${this.urlConsumi()}/${i}${this.CTX_PATH}/${e}/fabbisogni`,t)}getClientiContoterzi(i){return this.http.get(`${this.urlConsumi()}/${i}/clienti`)}postClientiContoterzi(i,e,t){const o=new FormData;return t.forEach(i=>{o.append("allegati",i)}),this.http.post(`${this.urlConsumi()}/${i}/clienti?idFascicolo=${e}`,o)}getCliente(i,e){return this.http.get(`${this.urlConsumi()}/${i}${this.CTX_PATH}/${e}`)}deleteCliente(i,e){return this.http.delete(`${this.urlConsumi()}/${i}${this.CTX_PATH}/${e}`)}urlConsumi(){return this.httpClientCore.HOST+this.httpClientCore.BASE_PATH+this.httpClientCore.API_V1+this.CTX_BASE_PATH}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(h.b),p.Xb(m.a))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Nn=t("FLe/");const Bn=["accordion"];function yn(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",17),p.Tb(1,"button",18),p.bc("click",(function(){return p.Ec(i),p.fc().saveLavorazioni()})),p.Sb(),p.Sb()}}function _n(i,e){1&i&&p.Ob(0,"i",29)}function Fn(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-a4g-multi-table",30),p.bc("clickIcon",(function(e){return p.Ec(i),p.fc(3).onClickIcon(e)}))("changedValueForm",(function(e){return p.Ec(i),p.fc(3).onChangeForm(e)})),p.Sb()}if(2&i){const i=p.fc(3);p.mc("title",i.nomeRaggruppamento)("cols",i.colsBase)("values",i.datasourceBase)("readonly",i.READONLY_MODE)}}function Pn(i,e){if(1&i){const i=p.Ub();p.Tb(0,"app-a4g-multi-table",31),p.bc("clickIcon",(function(e){return p.Ec(i),p.fc(3).onClickIcon(e)}))("changedValueForm",(function(e){return p.Ec(i),p.fc(3).onChangeForm(e)})),p.Sb()}if(2&i){const i=p.fc(3);p.mc("cols",i.colsStraordinaria)("values",i.datasourceStraordinaria)("readonly",i.READONLY_MODE)}}function wn(i,e){if(1&i&&(p.Rb(0),p.Tb(1,"p-accordionTab"),p.Tb(2,"p-header"),p.Oc(3),p.gc(4,"uppercase"),p.Mc(5,_n,1,0,"i",25),p.Sb(),p.Tb(6,"div",21),p.Mc(7,Fn,1,4,"app-a4g-multi-table",26),p.Ob(8,"div",27),p.Mc(9,Pn,1,3,"app-a4g-multi-table",28),p.Sb(),p.Sb(),p.Qb()),2&i){const i=e.$implicit,t=e.index,o=p.fc(2);p.Bb(3),p.Rc(" ",i.indice," ",p.hc(4,5,i.nome)," "),p.Bb(2),p.mc("ngIf",o.quantitaLavorata[t]>0),p.Bb(2),p.mc("ngIf",null==o.datasourceBase?null:o.datasourceBase.length),p.Bb(2),p.mc("ngIf",null==o.datasourceStraordinaria?null:o.datasourceStraordinaria.length)}}function xn(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",19),p.Tb(1,"div",20),p.Tb(2,"div",21),p.Tb(3,"p-accordion",22,23),p.bc("onOpen",(function(e){return p.Ec(i),p.fc().onSelectAccordion(e)})),p.Mc(5,wn,10,7,"ng-container",24),p.Sb(),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(5),p.mc("ngForOf",i.raggruppamenti)}}const Ln=function(){return{marginTop:"70px"}};let Gn=(()=>{class i{constructor(i,e,t,o,a,n,r,s,c,l){this.confirmationService=i,this.location=e,this.messageService=t,this.indiceUmaService=o,this.httpClientClienteUmaService=a,this.activeRoute=n,this.lavorazioniBuiderService=r,this.errorService=s,this.formatConverterService=c,this.httpClientAnagraficaService=l,this.ambitoLavorazioneEnum=J}ngOnInit(){this.raggruppamentoForm=new L.j({raggruppamento:new L.g}),this.routerSubscription=this.activeRoute.params.pipe(Object(r.a)(i=>(this.idDichiarazione=i.id,this.httpClientClienteUmaService.getCliente(i.id,i.idCliente))),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>{this.cliente=i;const e=this.httpClientAnagraficaService.getFascicoloAgs(this.cliente.cuaa),t=this.httpClientClienteUmaService.getLavorazioniClientiContoTerzi(this.idDichiarazione,this.cliente.id),o=this.httpClientClienteUmaService.getFabbisogniRichiestaCliente(this.idDichiarazione,this.cliente.id),a=this.httpClientClienteUmaService.getFabbisogniContoTerzista(this.idDichiarazione,this.cliente.id);return Object(ii.a)([e,t,o,a])})).subscribe(([i,e,t,o])=>{this.initVariables(),this.sportelloCliente=this.getDetenzioneFromFascicoloAgs(i),this.fabbisogniRichiestaCliente=t,this.raggruppamenti=this.lavorazioniBuiderService.raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(e,o),this.raggruppamenti=W.orderBy(this.raggruppamenti,["indice"],["asc"]),this.calcolaQuantita()},i=>this.errorService.showError(i))}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveLavorazioniSubscription&&this.saveLavorazioniSubscription.unsubscribe()}onSelectAccordion(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.caricaDatiAccordionAperta(i)))}openAccordionByIndex(i){this.accordion.tabs.forEach((e,t)=>{e.selected=t==i})}onChangeForm(i){this.isChangedInputTable=i.isChanged,this.isValidFormTable=i.isValid}saveLavorazioni(){if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(g.a.raggruppamentiNotSelezionati),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(g.a.datiNonValidi),!1;const i=this.raggruppamentoForm.get("raggruppamento").value,e=this.lavorazioniBuiderService.lavorazioniViewModelToDichiarazioniDtoBuilder(i.lavorazioni);let t=!1,o=[];return e.forEach(e=>{this.fabbisogniRichiestaCliente.forEach(a=>{let n=0,r=0;e.lavorazioneId===a.lavorazioneId&&(n=e.fabbisogni.reduce((i,e)=>i+this.formatConverterService.toNumber(e.quantita),0),r=a.fabbisogni.reduce((i,e)=>i+this.formatConverterService.toNumber(e.quantita),0),console.log("totaleDichiaratoDalContoTerzista",n),console.log("totaleDichiaratoDalCliente",r),console.log("superficieMassima",i.superficieMassima),n>0&&n+r>i.superficieMassima&&(t=!0,o.push(...i.lavorazioni.filter(i=>i.id===e.lavorazioneId))))})}),t?(this.showDialogSuperficieMax(e,o),!1):(this.persistLavorazioni(e),!0)}goBack(){this.isChangedInputTable?this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.location.back()},reject:()=>{},key:"conto-terzi-dettaglio-dialog"}):this.location.back()}persistLavorazioni(i){console.log("Salvo dichiarazioni contoterzista: ",i),this.saveLavorazioniSubscription=this.httpClientClienteUmaService.saveLavorazioniClientiContoTerzi(this.idDichiarazione,this.cliente.id,i).subscribe(()=>{this.isChangedInputTable=!1,this.messageService.add(c.a.getToast("tst",c.b.success,g.a.salvataggioOKConsumiLavorazioni)),this.calcolaQuantita()},i=>this.errorService.showError(i))}initVariables(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.isValidFormTable=!0,this.isChangedInputTable=!1,this.nomeRaggruppamento=null,this.quantitaLavorata=[],this.datasourceBase=[],this.datasourceStraordinaria=[],this.colsBase=this.defineColumnsByTitle("Lavorazioni Base"),this.colsStraordinaria=this.defineColumnsByTitle("Lavorazioni Straordinarie"),this.raggruppamentoForm.controls.raggruppamento.setValue(null)}calcolaQuantita(){this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((i,e)=>{this.quantitaLavorata[e]=0,i.lavorazioni.forEach(i=>{const t=isNaN(Number(i.BENZINA))?0:Number(i.BENZINA),o=isNaN(Number(i.GASOLIO))?0:Number(i.GASOLIO);this.quantitaLavorata[e]=this.quantitaLavorata[e]+t+o})})}caricaDatiAccordionAperta(i){const e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1}splitDatasources(i){const e=[],t=[];i.forEach(i=>{i.tipo===X.BASE?t.push(i):e.push(i)}),this.datasourceBase=W.sortBy(t,["indice"]),this.datasourceStraordinaria=W.sortBy(e,["indice"])}onClickIcon(i){i.col.field!==N.a.GASOLIO&&i.col.field!==N.a.BENZINA||this.updateTable(i.element,i.col)}updateTable(i,e){let t=this.datasourceBase.filter(e=>e.id===i.id)[0];null==t&&(t=this.datasourceStraordinaria.filter(e=>e.id===i.id)[0]);const o=e.field===N.a.GASOLIO?N.a.BENZINA:N.a.GASOLIO;t[e.field]=t[e.field]!=t.superficieMassima?i.superficieMassima:"",t[o]=""}getDetenzioneFromFascicoloAgs(i){if(!i||!i.detenzioni||!i.detenzioni.length)return null;if(i&&i.detenzioni&&i.detenzioni.length&&1===i.detenzioni.length)return i.detenzioni[0];const e=i.detenzioni.filter(i=>i.tipoDetenzione===Nn.a.DELEGA),t=i.detenzioni.filter(i=>i.tipoDetenzione===Nn.a.MANDATO);return t||t.length||e||e.length?!t&&!t.length&&e&&e.length>1?(this.errorService.showErrorWithMessage("Il cliente dispone di pi\xf9 deleghe - Non \xe8 possibile reperire lo sportello!"),null):t||t.length||!e||1!==e.length?t&&t.length>1?(this.errorService.showErrorWithMessage("Il cliente dispone di piu mandati - Non \xe8 possibile reperire lo sportello!"),null):t&&1===t.length?t[0]:void 0:e[0]:(this.errorService.showErrorWithMessage("Il cliente non dispone di un mandato n\xe8 di una delega - Non \xe8 possibile reperire lo sportello!"),null)}showDialog(i){this.confirmationService.confirm({message:g.a.datiNonSalvati,accept:()=>{this.openedAccordion=i.index,this.caricaDatiAccordionAperta(i),this.openAccordionByIndex(this.openedAccordion)},reject:()=>{this.openAccordionByIndex(this.openedAccordion)},key:"conto-terzi-dettaglio-dialog"})}showDialogSuperficieMax(i,e){const t=e.map(i=>i.descrizioneCompleta.split(" ")[0]).join(", ");this.confirmationService.confirm({header:`Lavorazion${e.length>1?"i":"e"}: `+t,message:g.a.superficieDichiarataGtSupMax+this.sportelloCliente.sportello+" "+this.sportelloCliente.identificativoSportello+g.a.superficieDichiarataGtSupMax2,accept:()=>{this.persistLavorazioni(i)},reject:()=>{},key:"conto-terzi-superficie-max-alert"})}defineColumnsByTitle(i){return[{field:"descrizioneCompleta",header:i,sortable:!1,font:K.e.BOLD,width:"46%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"superficieMassima",suffix:"unitaDiMisura",header:"Superficie massima",sortable:!1,width:"18%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:N.a.GASOLIO,suffix:"unitaDiMisura",header:"Sup. gasolio",sortable:!1,disabled:!this.cliente.gasolio,inputOpts:{pattern:"^([0-9])+$",maxLength:"7",upperLimitField:"superficieMassima"},icon:"pi pi-chevron-circle-right",width:"18%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER},{field:N.a.BENZINA,suffix:"unitaDiMisura",header:"Sup. benzina",sortable:!1,disabled:!this.cliente.benzina,inputOpts:{pattern:"^([0-9])+$",maxLength:"7",upperLimitField:"superficieMassima"},icon:"pi pi-chevron-circle-right",width:"18%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(A.a),p.Nb(o.n),p.Nb(A.d),p.Nb(f),p.Nb(Mn),p.Nb(z.a),p.Nb(ti),p.Nb(T.a),p.Nb(Ii.a),p.Nb(ft))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-dettaglio-clienti-contoterzi"]],viewQuery:function(i,e){var t;1&i&&p.Uc(Bn,!0),2&i&&p.Ac(t=p.cc())&&(e.accordion=t.first)},decls:21,vars:12,consts:[["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","conto-terzi-dettaglio-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","conto-terzi-superficie-max-alert","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],["novalidate","",1,"w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-contoterzi_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed w-10m p-0 py-1",4,"ngIf"],["class","p-grid",4,"ngIf"],[1,"p-col-fixed","w-10m","p-0","py-1"],["pButton","","type","button","label","SALVA",3,"click"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[3,"title","cols","values","readonly","clickIcon","changedValueForm",4,"ngIf"],[1,"mb-1"],[3,"cols","values","readonly","clickIcon","changedValueForm",4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","values","readonly","clickIcon","changedValueForm"],[3,"cols","values","readonly","clickIcon","changedValueForm"]],template:function(i,e){1&i&&(p.Ob(0,"p-confirmDialog",0),p.Ob(1,"p-confirmDialog",1),p.Ob(2,"p-toast",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"form",6),p.Tb(7,"div",7),p.Tb(8,"div",8),p.Tb(9,"div",9),p.Tb(10,"a",10),p.bc("click",(function(){return e.goBack()})),p.Ob(11,"i",11),p.Ob(12,"img",12),p.Tb(13,"span",13),p.Oc(14),p.gc(15,"uppercase"),p.gc(16,"translate"),p.Tb(17,"strong",14),p.Oc(18),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Mc(19,yn,2,0,"div",15),p.Sb(),p.Mc(20,xn,6,1,"div",16),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Bb(2),p.Kc(p.rc(11,Ln)),p.Bb(4),p.mc("formGroup",e.raggruppamentoForm),p.Bb(8),p.Qc(" ",p.hc(15,7,p.hc(16,9,"UMA.DICHIARAZIONE_CONSUMI.CLIENTI_CONTOTERZI"))," / "),p.Bb(4),p.Pc(null==e.cliente?null:e.cliente.denominazione),p.Bb(1),p.mc("ngIf",!e.READONLY_MODE),p.Bb(1),p.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[R.a,E.a,L.I,L.t,L.k,z.h,o.t,M.b,oi.a,o.s,oi.c,A.c,ai.a],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),i})();var Un=t("6b9K");const kn=["dialog"],Vn=["table"],Hn=function(){return{width:"20%"}},Zn=function(){return{width:"70%"}},jn=function(){return{width:"10%","text-align":"center"}};function Yn(i,e){1&i&&(p.Tb(0,"tr"),p.Tb(1,"th",18),p.Oc(2,"CUAA"),p.Sb(),p.Tb(3,"th",19),p.Oc(4," DENOMINAZIONE "),p.Ob(5,"p-sortIcon",20),p.Sb(),p.Tb(6,"th",18),p.Oc(7,"AZIONI"),p.Sb(),p.Sb()),2&i&&(p.Bb(1),p.mc("ngStyle",p.rc(3,Hn)),p.Bb(2),p.mc("ngStyle",p.rc(4,Zn)),p.Bb(3),p.mc("ngStyle",p.rc(5,jn)))}function $n(i,e){if(1&i){const i=p.Ub();p.Tb(0,"tr"),p.Tb(1,"td",18),p.Oc(2),p.Sb(),p.Tb(3,"td",18),p.Oc(4),p.gc(5,"uppercase"),p.Sb(),p.Tb(6,"td",18),p.Tb(7,"button",21),p.bc("click",(function(){p.Ec(i);const t=e.$implicit;return p.fc(2).onClickButton("AGGIUNGI",t.cuaa,t.idAgs)})),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit;p.Bb(1),p.mc("ngStyle",p.rc(7,Hn)),p.Bb(1),p.Pc(i.cuaa),p.Bb(1),p.mc("ngStyle",p.rc(8,Zn)),p.Bb(1),p.Pc(p.hc(5,5,i.denominazione)),p.Bb(2),p.mc("ngStyle",p.rc(9,jn))}}function qn(i,e){1&i&&(p.Tb(0,"tr"),p.Tb(1,"td"),p.Oc(2,"Nessun risultato trovato."),p.Sb(),p.Sb()),2&i&&(p.Bb(1),p.Cb("colspan",4))}function Qn(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",12),p.Tb(1,"p-table",13,14),p.bc("onLazyLoad",(function(e){p.Ec(i);const t=p.fc();return t.changePage(e,t.testoRicerca)})),p.Mc(3,Yn,8,6,"ng-template",15),p.Mc(4,$n,8,10,"ng-template",16),p.Mc(5,qn,3,1,"ng-template",17),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(1),p.mc("autoLayout",!0)("value",null==i.datasource?null:i.datasource.risultati)("paginator",!0)("rows",i.elementiPerPagina)("scrollable",!0)("resetPageOnSort",!0)("first",i.first)("totalRecords",i.totalElements)("lazy",!0)}}const Kn=function(){return{overflow:"auto"}},Wn=function(){return{marginTop:"70px"}};let Jn=(()=>{class i{constructor(i,e,t,o,a){this.messageService=i,this.route=e,this.fascicoloService=t,this.httpClientClienteUmaService=o,this.errorService=a,this.clienteSelezionato={},this.chiudiPopup=new p.n}ngOnInit(){this.routerSubscription=this.route.params.subscribe(i=>{this.idDichiarazione=i.id})}ngOnDestroy(){this.postClienteSubscription&&this.postClienteSubscription.unsubscribe(),this.routerSubscription&&this.routerSubscription.unsubscribe(),this.pagedListSubscription&&this.pagedListSubscription.unsubscribe(),this.validaClientiSubscription&&this.validaClientiSubscription.unsubscribe()}open(){this.display=!0,this.datasource={},this.datasource.count=0,this.datasource.risultati=[],this.testoRicerca=null,this.initPaginator()}onHideDialog(){}onCloseToastRicercaClienti(){}chiudiDialog(i){this.display=!1,this.dialogElement._style.width="unset"}onClickButton(i,e,t){switch(i){case"CERCA":this.reset(),this.cercaClienti(e,this.buildPaginatorEvent());break;case"AGGIUNGI":this.validaClientiSubscription=this.httpClientClienteUmaService.validaClientiContoterzi(this.idDichiarazione,t).subscribe(()=>{this.clienteSelezionato.cuaa=e,this.clienteSelezionato.idFascicolo=t,this.addCliente(this.clienteSelezionato)},i=>this.errorService.showError(i,"tst-ricerca-clienti"))}}changePage(i,e){this.cercaClienti(e,i)}reset(){this.table&&this.table.reset()}cercaClienti(i,e){this.numeroPagina=Math.floor(e.first/this.elementiPerPagina),null==this.numeroPagina&&(this.numeroPagina=0),this.paginazione=Un.a.of(this.numeroPagina,this.elementiPerPagina,e.sortField,Un.a.getOrdine(e.sortOrder)),this.paginazione.numeroElementiPagina=this.elementiPerPagina,this.pagedListSubscription=this.fascicoloService.getListaPaged(i,this.paginazione).pipe(Object(r.a)(i=>(this.dialogElement.center(),this.dialogElement._style.width=1200,Object(y.a)(i))),Object(s.a)(i=>(this.errorService.showError(i,"tst-ricerca-clienti"),n.a))).subscribe(i=>{this.datasource=i,null!=this.datasource&&(this.totalElements=this.datasource.count)},i=>this.errorService.showError(i,"tst-ricerca-clienti"))}isNotValidText(i){return!(i&&i.length>2)}addCliente(i){this.chiudiDialog(),this.chiudiPopup.emit(i)}initPaginator(){this.first=0,this.totalElements=0,this.numeroPagina=0,this.elementiPerPagina=5,this.defaultPropertySort="denominazione"}buildPaginatorEvent(){return{filters:{},first:0,globalFilter:null,multiSortMeta:void 0,rows:this.elementiPerPagina,sortField:this.defaultPropertySort,sortOrder:1}}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(A.d),p.Nb(z.a),p.Nb(ut.a),p.Nb(Mn),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-popup-ricerca-clienti-contoterzi"]],viewQuery:function(i,e){var t;1&i&&(p.Jc(kn,!0),p.Uc(Vn,!0)),2&i&&(p.Ac(t=p.cc())&&(e.dialogElement=t.first),p.Ac(t=p.cc())&&(e.table=t.first))},outputs:{chiudiPopup:"chiudiPopup"},decls:15,vars:23,consts:[["id","popup-ricerca-clienti-contoterzi",3,"visible","focusOnShow","modal","closable","closeOnEscape","blockScroll","dismissableMask","contentStyle","header","visibleChange","onHide"],["dialog",""],["key","tst-dialog"],["key","tst-ricerca-clienti",3,"onClose"],[1,"ui-grid"],[1,"ui-g-12","ui-md-12","w-100"],[1,"ui-inputgroup"],["type","text","placeholder","Cerca cliente","id","testoRicerca","size","60",3,"ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-search",1,"icon-button-square",3,"disabled","click"],["class","ui-g-12 ui-md-12 w-100 boxgrey table-container",4,"ngIf"],[1,"ui-g-4"],["pButton","","type","button","label","Chiudi",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal",3,"click"],[1,"ui-g-12","ui-md-12","w-100","boxgrey","table-container"],[3,"autoLayout","value","paginator","rows","scrollable","resetPageOnSort","first","totalRecords","lazy","onLazyLoad"],["table",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"ngStyle"],["pSortableColumn","denominazione",3,"ngStyle"],["field","denominazione"],["pButton","","icon","pi pi-plus",1,"icon-button-square",3,"click"]],template:function(i,e){1&i&&(p.Tb(0,"p-dialog",0,1),p.bc("visibleChange",(function(i){return e.display=i}))("onHide",(function(){return e.onHideDialog()})),p.gc(2,"uppercase"),p.gc(3,"translate"),p.Ob(4,"p-toast",2),p.Tb(5,"p-toast",3),p.bc("onClose",(function(){return e.onCloseToastRicercaClienti()})),p.Sb(),p.Tb(6,"div",4),p.Tb(7,"div",5),p.Tb(8,"div",6),p.Tb(9,"input",7),p.bc("ngModelChange",(function(i){return e.testoRicerca=i})),p.Sb(),p.Tb(10,"button",8),p.bc("click",(function(){return e.onClickButton("CERCA",e.testoRicerca,0)})),p.Sb(),p.Sb(),p.Sb(),p.Mc(11,Qn,6,9,"div",9),p.Sb(),p.Tb(12,"div",4),p.Tb(13,"div",10),p.Tb(14,"button",11),p.bc("click",(function(i){return e.chiudiDialog(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.nc("header",p.hc(2,16,p.hc(3,18,"UMA.DICHIARAZIONE_CONSUMI.RICERCA_CLIENTI"))),p.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("blockScroll",!0)("dismissableMask",!0)("contentStyle",p.rc(20,Kn)),p.Bb(4),p.Kc(p.rc(21,Wn)),p.Bb(1),p.Kc(p.rc(22,Wn)),p.Bb(4),p.mc("ngModel",e.testoRicerca),p.Bb(1),p.mc("disabled",e.isNotValidText(e.testoRicerca)),p.Bb(1),p.mc("ngIf",null==e.datasource||null==e.datasource.risultati?null:e.datasource.risultati.length))},directives:[jt.a,E.a,L.c,L.s,L.v,M.b,o.t,w.q,A.e,o.w,w.p,w.o],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   th[_ngcontent-%COMP%]{color:#000}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:27em;max-height:27em;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]     .ui-widget-header{border:unset!important}"]}),i})();const Xn=["dialog"],ir=function(){return{overflow:"auto","max-height":"500px"}},er=function(){return{marginTop:"70px"}},tr=function(){return{"text-align":"right"}};let or=(()=>{class i{constructor(i){this.route=i,this.chiudiPopup=new p.n}ngOnInit(){this.clienteSelezionato=null,this.routerSubscription=this.route.params.subscribe(i=>{this.idDichiarazione=i.id})}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}open(i){this.clienteSelezionato=i,this.display=!0}onHideDialog(){}onCloseToastRicercaClienti(){}chiudiDialog(i){this.chiudiPopup.emit(this.clienteSelezionato),this.display=!1}annulla(){this.display=!1}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(z.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-popup-cancella-cliente-contoterzi"]],viewQuery:function(i,e){var t;1&i&&p.Jc(Xn,!0,p.l),2&i&&p.Ac(t=p.cc())&&(e.dialogElement=t.first)},inputs:{cliente:"cliente"},outputs:{chiudiPopup:"chiudiPopup"},decls:16,vars:18,consts:[["id","popup-ricerca-clienti-contoterzi","width","550","position","top",3,"visible","focusOnShow","modal","closable","closeOnEscape","contentStyle","header","dismissableMask","visibleChange","onHide"],["dialog",""],["key","tst-dialog"],[1,"p-grid"],[1,"p-col","w-100"],[1,"p-col"],["pButton","","type","button","label","SI",1,"ui-button-secondary","w-10m",3,"click"],[1,"p-col",3,"ngStyle"],["pButton","","type","button","label","NO",1,"w-10m",3,"click"]],template:function(i,e){1&i&&(p.Tb(0,"p-dialog",0,1),p.bc("visibleChange",(function(i){return e.display=i}))("onHide",(function(){return e.onHideDialog()})),p.gc(2,"uppercase"),p.gc(3,"translate"),p.Ob(4,"p-toast",2),p.Tb(5,"div",3),p.Tb(6,"div",4),p.Ob(7,"br"),p.Oc(8," Attenzione! Si desidera procedere con la cancellazione dell\u2019Azienda inserita, delle eventuali lavorazioni e allegati? "),p.Ob(9,"br"),p.Sb(),p.Sb(),p.Ob(10,"br"),p.Tb(11,"div",3),p.Tb(12,"div",5),p.Tb(13,"button",6),p.bc("click",(function(i){return e.chiudiDialog(i)})),p.Sb(),p.Sb(),p.Tb(14,"div",7),p.Tb(15,"button",8),p.bc("click",(function(){return e.annulla()})),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.nc("header",p.hc(2,11,p.hc(3,13,"UMA.DICHIARAZIONE_CONSUMI.ATTENZIONE"))),p.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("contentStyle",p.rc(15,ir))("dismissableMask",!0),p.Bb(4),p.Kc(p.rc(16,er)),p.Bb(10),p.mc("ngStyle",p.rc(17,tr)))},directives:[jt.a,E.a,M.b,o.w],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}"]}),i})();const ar=["dialog"],nr=["fileCaricato"];function rr(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",13),p.Tb(1,"button",14),p.bc("click",(function(){return p.Ec(i),p.fc().caricaAllegato()})),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(1),p.mc("disabled",(null==i.fileAllegati?null:i.fileAllegati.length)>=5)}}function sr(i,e){if(1&i){const i=p.Ub();p.Tb(0,"img",19),p.bc("click",(function(){p.Ec(i);const e=p.fc(2).index;return p.fc().eliminaAllegato(e)})),p.Sb()}}function cr(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div"),p.Tb(1,"h6",16),p.Mc(2,sr,1,0,"img",17),p.Tb(3,"span"),p.Tb(4,"a",18),p.bc("click",(function(){p.Ec(i);const e=p.fc().index;return p.fc().visualizzaAllegato(e)})),p.Oc(5),p.Sb(),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=p.fc().$implicit,e=p.fc();p.Bb(2),p.mc("ngIf",!e.READONLY_MODE),p.Bb(3),p.Qc(" ",i.name," ")}}function lr(i,e){if(1&i&&(p.Tb(0,"div",13),p.Mc(1,cr,6,2,"div",15),p.Sb()),2&i){const i=e.$implicit;p.Bb(1),p.mc("ngIf",i)}}const ur=function(){return{overflow:"auto","max-height":"400px"}},br=function(){return{marginTop:"70px"}};let hr=(()=>{class i{constructor(i,e,t,o){this.messageService=i,this.httpClientClienteUmaService=e,this.route=t,this.errorService=o,this.chiudiPopup=new p.n,this.fileExt=".pdf",this.fileAllegati=[],this.maxSize=2,this.uploadHelper=new Fe.a(this.fileExt,this.maxSize)}ngOnInit(){this.routerSubscription=this.route.params.subscribe(i=>{this.idDichiarazione=i.id})}ngOnDestroy(){this.postClienteSubscription&&this.postClienteSubscription.unsubscribe(),this.routerSubscription&&this.routerSubscription.unsubscribe(),this.getAllegatiSubscription&&this.getAllegatiSubscription.unsubscribe(),this.postAllegatiSuscription&&this.postAllegatiSuscription.unsubscribe()}open(i){this.display=!0,this.modalitaCrea=i.modalitaCrea,this.cliente=i.cliente,!i.modalitaCrea&&i.cliente&&i.cliente.id&&(this.getAllegatiSubscription=this.httpClientClienteUmaService.getAllegatiClientiContoterzi(this.idDichiarazione,i.cliente.id).subscribe(i=>{this.fileAllegati=[],i&&i.length&&i.forEach(i=>{const e=this.uploadHelper.stringToFile(i.allegato,i.nomeFile,"application/pdf");this.fileAllegati.push(e)})},i=>this.errorService.showError(i,"tst-allegati-clienti")))}salva(i){this.modalitaCrea?this.addCliente(this.cliente.idFascicolo):this.postAllegatiSuscription=this.httpClientClienteUmaService.postAllegatiClientiContoterzi(this.idDichiarazione,this.cliente.id,this.fileAllegati).subscribe(i=>{this.ripristinaValori(),this.display=!1,this.messageService.add(c.a.getToast("tst",c.b.success,g.a.salvataggioOKConsumiLavorazioni))},i=>this.errorService.showError(i,"tst-allegati-clienti"))}annulla(){this.ripristinaValori(),this.display=!1}caricaAllegato(){document.getElementById("fileCaricato").click()}addCliente(i){this.postClienteSubscription=this.httpClientClienteUmaService.postClientiContoterzi(this.idDichiarazione,i,this.fileAllegati).subscribe(i=>{this.chiudiPopup.emit(),this.ripristinaValori(),this.display=!1,this.messageService.add(c.a.getToast("tst",c.b.success,g.a.salvataggioOKConsumiLavorazioni))},i=>{console.log("ERRORE: ",i);let e="Errore nel recupero dati.";i&&i.error&&i.error.message&&(e=i.error.message),this.errorService.showErrorWithMessage(e,"tst-allegati-clienti")})}eliminaAllegato(i){this.modalitaCrea||!this.fileAllegati||1!=this.fileAllegati.length?(!this.modalitaCrea&&this.fileAllegati&&this.fileAllegati.length>1||this.modalitaCrea)&&this.fileAllegati.splice(i,1):this.errorService.showErrorWithMessage("E\u2019 obbligatorio aver caricato almeno un allegato","tst-allegati-clienti")}visualizzaAllegato(i){if(null!=this.fileAllegati[i]){const e=URL.createObjectURL(this.fileAllegati[i]);I.saveAs(this.fileAllegati[i],this.fileAllegati[i].name),this.fileAllegati[i].type===Zt.a.PDF&&window.open(e)}}numeroMassimoAllegati(){let i=!1;return this.fileAllegati.length>=5&&(i=!0),i}onFileChange(i){if(i.target.files&&i.target.files.length>0){const e=i.target.files[0];if(e.name.length>50)return void this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.FILENAME,"tst-dialog");if(!this.uploadHelper.isValidFileExtension(e))return void this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.EXT_PDF,"tst-dialog");if(!this.uploadHelper.isValidFileSize(e))return void this.errorService.showErrorWithMessage(g.a.FILE_ERRORS.SIZE,"tst-dialog");this.fileAllegati.push(e)}}ripristinaValori(){this.fileAllegati=[]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(A.d),p.Nb(Mn),p.Nb(z.a),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-popup-allegati-clienti-contoterzi"]],viewQuery:function(i,e){var t;1&i&&(p.Jc(ar,!0,p.l),p.Jc(nr,!0)),2&i&&(p.Ac(t=p.cc())&&(e.dialogElement=t.first),p.Ac(t=p.cc())&&(e.file=t.first))},inputs:{READONLY_MODE:"READONLY_MODE"},outputs:{chiudiPopup:"chiudiPopup"},decls:24,vars:26,consts:[["id","popup-allegati-clienti-contoterzi","width","600","position","top",3,"visible","focusOnShow","modal","closable","closeOnEscape","blockScroll","contentStyle","header","dismissableMask","visibleChange"],["dialog",""],["key","tst-dialog"],["key","tst-allegati-clienti"],[1,"ui-grid"],[1,"ui-g-12","ui-md-12","w-100"],["class","ui-inputgroup",4,"ngIf"],["type","file","id","fileCaricato","name","fileCaricato","onclick","this.value = null",1,"inputUploadFile",2,"display","none",3,"accept","change"],["fileCaricato",""],["class","ui-inputgroup",4,"ngFor","ngForOf"],[1,"p-grid","p-justify-end"],["pButton","","type","button","label","Annulla",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none","w-5m",3,"click"],["pButton","","type","button","label","Salva",1,"ui-button-text-only","p-1","text-uppercase","font-weight-normal","shadow-none","w-5m",3,"disabled","click"],[1,"ui-inputgroup"],["pButton","","type","button","label","CARICA ALLEGATO",3,"disabled","click"],[4,"ngIf"],[1,"text-confirm",2,"padding","0 !important"],["class","cursor-pointer","src","assets/img/ico-x.jpg",3,"click",4,"ngIf"],["target","_blank",1,"cursor-pointer","p-col",3,"click"],["src","assets/img/ico-x.jpg",1,"cursor-pointer",3,"click"]],template:function(i,e){1&i&&(p.Tb(0,"p-dialog",0,1),p.bc("visibleChange",(function(i){return e.display=i})),p.gc(2,"uppercase"),p.gc(3,"translate"),p.Ob(4,"p-toast",2),p.Ob(5,"p-toast",3),p.Tb(6,"div",4),p.Tb(7,"div",5),p.Tb(8,"div"),p.Oc(9),p.Ob(10,"br"),p.Ob(11,"br"),p.Sb(),p.Mc(12,rr,2,1,"div",6),p.Tb(13,"input",7,8),p.bc("change",(function(i){return e.onFileChange(i)})),p.Sb(),p.Sb(),p.Tb(15,"div",5),p.Ob(16,"br"),p.Mc(17,lr,2,1,"div",9),p.Sb(),p.Sb(),p.Ob(18,"br"),p.Tb(19,"div",10),p.Tb(20,"div"),p.Tb(21,"button",11),p.bc("click",(function(){return e.annulla()})),p.Sb(),p.Sb(),p.Tb(22,"div"),p.Tb(23,"button",12),p.bc("click",(function(i){return e.salva(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.nc("header",p.hc(2,19,p.hc(3,21,"UMA.DICHIARAZIONE_CONSUMI.ALLEGATI"))),p.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("blockScroll",!0)("contentStyle",p.rc(23,ur))("dismissableMask",!0),p.Bb(4),p.Kc(p.rc(24,br)),p.Bb(1),p.Kc(p.rc(25,br)),p.Bb(4),p.Rc(" CUAA: ",null==e.cliente?null:e.cliente.cuaa," - ID FASCICOLO: ",null==e.cliente?null:e.cliente.idFascicolo,""),p.Bb(3),p.mc("ngIf",!e.READONLY_MODE),p.Bb(1),p.nc("accept",e.fileExt),p.Bb(4),p.mc("ngForOf",e.fileAllegati),p.Bb(6),p.mc("disabled",0==(null==e.fileAllegati?null:e.fileAllegati.length)||e.READONLY_MODE))},directives:[jt.a,E.a,o.t,o.s,M.b],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:450px;max-height:450px;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),i})();const mr=["popupRicercaClienti"],pr=["popupCancellaCliente"],dr=["popupAllegatiCliente"];function gr(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",24),p.Tb(1,"button",25),p.bc("click",(function(){return p.Ec(i),p.fc().openRicercaClienteDialog()})),p.Sb(),p.Sb()}}const fr=function(){return{width:"4%"}};function vr(i,e){1&i&&p.Ob(0,"th",27),2&i&&p.mc("ngStyle",p.rc(1,fr))}const Sr=function(){return{width:"20%"}},Cr=function(){return{width:"55%"}},Or=function(){return{width:"10%","text-align":"center"}},Tr=function(){return{width:"6%","text-align":"center"}};function Ir(i,e){if(1&i&&(p.Tb(0,"tr"),p.Mc(1,vr,1,2,"th",26),p.Tb(2,"th",27),p.Oc(3,"CUAA"),p.Sb(),p.Tb(4,"th",28),p.Oc(5," Denominazione "),p.Ob(6,"p-sortIcon",29),p.Sb(),p.Tb(7,"th",27),p.Oc(8,"Lavorazioni"),p.Sb(),p.Tb(9,"th",27),p.Oc(10,"Allegati"),p.Sb(),p.Sb()),2&i){const i=p.fc();p.Bb(1),p.mc("ngIf",!i.READONLY_MODE),p.Bb(1),p.mc("ngStyle",p.rc(5,Sr)),p.Bb(2),p.mc("ngStyle",p.rc(6,Cr)),p.Bb(3),p.mc("ngStyle",p.rc(7,Or)),p.Bb(2),p.mc("ngStyle",p.rc(8,Tr))}}const zr=function(){return{"text-align":"center"}};function Ar(i,e){if(1&i){const i=p.Ub();p.Tb(0,"td",27),p.Tb(1,"img",32),p.bc("click",(function(){p.Ec(i);const e=p.fc().$implicit;return p.fc().deleteClientiContoterzi(e)})),p.Sb(),p.Sb()}2&i&&p.mc("ngStyle",p.rc(1,zr))}function Er(i,e){if(1&i){const i=p.Ub();p.Tb(0,"tr"),p.Mc(1,Ar,2,2,"td",26),p.Tb(2,"td"),p.Oc(3),p.Sb(),p.Tb(4,"td"),p.Oc(5),p.Sb(),p.Tb(6,"td"),p.Tb(7,"div"),p.Tb(8,"button",30),p.bc("click",(function(){p.Ec(i);const t=e.$implicit;return p.fc().onClickButton("LAVORAZIONI",t)})),p.Sb(),p.Sb(),p.Sb(),p.Tb(9,"td",27),p.Tb(10,"div"),p.Tb(11,"button",31),p.bc("click",(function(){p.Ec(i);const t=e.$implicit;return p.fc().onClickButton("ALLEGATI",t)})),p.Sb(),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit,t=p.fc();p.Bb(1),p.mc("ngIf",!t.READONLY_MODE),p.Bb(2),p.Pc(i.cuaa),p.Bb(2),p.Qc(" ",i.denominazione," "),p.Bb(4),p.mc("ngStyle",p.rc(4,zr))}}function Rr(i,e){1&i&&(p.Tb(0,"tr"),p.Tb(1,"td"),p.Oc(2,"Nessun cliente inserito"),p.Sb(),p.Sb()),2&i&&(p.Bb(1),p.Cb("colspan",5))}const Dr=function(){return{marginTop:"70px"}};let Mr=(()=>{class i{constructor(i,e,t,o,a,n,r,s){this.messageService=i,this.route=e,this.indiceUmaService=t,this.httpClientClienteUmaService=o,this.location=a,this.router=n,this.activeRoute=r,this.errorService=s}ngOnInit(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.routerSubscription=this.route.params.subscribe(i=>{this.idDichiarazione=i.id}),this.caricaListaClienti()}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.caricaSubscription&&this.caricaSubscription.unsubscribe(),this.getLavorazioniSubscription&&this.getLavorazioniSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe()}goBack(){this.location.back()}openRicercaClienteDialog(){this.popupRicercaClienti.open()}openAllegatiClienteEditaDialog(i){this.popupAllegatiCliente.open({modalitaCrea:!1,cliente:i})}openAllegatiClienteCreaDialog(i){this.popupAllegatiCliente.open({modalitaCrea:!0,cliente:i})}caricaListaClienti(){this.caricaSubscription=this.httpClientClienteUmaService.getClientiContoterzi(this.idDichiarazione).subscribe(i=>{this.listaClientiContoterzi=i},i=>this.errorService.showError(i))}deleteClientiContoterzi(i){this.popupCancellaCliente.open(i)}cancellaCliente(i){this.deleteSubscription=this.httpClientClienteUmaService.deleteCliente(this.idDichiarazione,i.id).pipe(Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(()=>(this.messageService.add(c.a.getToast("tst",c.b.success,g.a.cancellazioneClienteContoTerziOK)),this.httpClientClienteUmaService.getClientiContoterzi(this.idDichiarazione)))).subscribe(i=>{this.listaClientiContoterzi=i},i=>this.errorService.showError(i))}onClickButton(i,e){switch(i){case"LAVORAZIONI":this.getLavorazioniSubscription=this.httpClientClienteUmaService.getLavorazioniClientiContoTerzi(this.idDichiarazione.toString(),e.id).subscribe(i=>{i&&i.length?this.router.navigate([e.id],{relativeTo:this.activeRoute.parent}):this.messageService.add(c.a.getToast("tst",c.b.error,g.a.noLavorazioniDisponibili))},i=>this.errorService.showError(i));break;case"ALLEGATI":this.openAllegatiClienteEditaDialog(e)}}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(A.d),p.Nb(z.a),p.Nb(f),p.Nb(Mn),p.Nb(o.n),p.Nb(z.e),p.Nb(z.a),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-clienti-conto-terzi"]],viewQuery:function(i,e){var t;1&i&&(p.Jc(mr,!0),p.Jc(pr,!0),p.Jc(dr,!0)),2&i&&(p.Ac(t=p.cc())&&(e.popupRicercaClienti=t.first),p.Ac(t=p.cc())&&(e.popupCancellaCliente=t.first),p.Ac(t=p.cc())&&(e.popupAllegatiCliente=t.first))},decls:28,vars:11,consts:[[3,"chiudiPopup"],["popupRicercaClienti",""],[3,"READONLY_MODE","chiudiPopup"],["popupAllegatiCliente",""],["popupCancellaCliente",""],["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-contoterzi_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed w-10m p-0 py-1",4,"ngIf"],[1,"boxgrey"],[1,"p-grid"],[1,"p-col-12","align-self-center","w-100"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"p-col-fixed","w-10m","p-0","py-1"],["pButton","","type","button","label","NUOVO",3,"click"],[3,"ngStyle",4,"ngIf"],[3,"ngStyle"],["pSortableColumn","denominazione",3,"ngStyle"],["field","denominazione"],["pButton","","type","button","icon","pi pi-arrow-right",1,"icon-button-rect",3,"click"],["pButton","","type","button","icon","pi pi-attachment",1,"icon-button-square",3,"click"],["src","assets/img/icons/uma-icon/icon-delete.png",3,"click"]],template:function(i,e){1&i&&(p.Tb(0,"app-popup-ricerca-clienti-contoterzi",0,1),p.bc("chiudiPopup",(function(i){return e.openAllegatiClienteCreaDialog(i)})),p.Sb(),p.Tb(2,"app-popup-allegati-clienti-contoterzi",2,3),p.bc("chiudiPopup",(function(){return e.caricaListaClienti()})),p.Sb(),p.Tb(4,"app-popup-cancella-cliente-contoterzi",0,4),p.bc("chiudiPopup",(function(i){return e.cancellaCliente(i)})),p.Sb(),p.Ob(6,"p-toast",5),p.Tb(7,"div",6),p.Tb(8,"div",7),p.Tb(9,"div",8),p.Tb(10,"div",9),p.Tb(11,"div",10),p.Tb(12,"a",11),p.bc("click",(function(){return e.goBack()})),p.Ob(13,"i",12),p.Ob(14,"img",13),p.Tb(15,"span",14),p.Tb(16,"strong",15),p.Oc(17),p.gc(18,"uppercase"),p.gc(19,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Mc(20,gr,2,0,"div",16),p.Tb(21,"div",17),p.Tb(22,"div",18),p.Tb(23,"div",19),p.Tb(24,"p-table",20),p.Mc(25,Ir,11,9,"ng-template",21),p.Mc(26,Er,12,5,"ng-template",22),p.Mc(27,Rr,3,1,"ng-template",23),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Bb(2),p.mc("READONLY_MODE",e.READONLY_MODE),p.Bb(4),p.Kc(p.rc(10,Dr)),p.Bb(11),p.Pc(p.hc(18,6,p.hc(19,8,"UMA.DICHIARAZIONE_CONSUMI.CLIENTI_CONTOTERZI"))),p.Bb(3),p.mc("ngIf",!e.READONLY_MODE),p.Bb(4),p.mc("value",e.listaClientiContoterzi))},directives:[Jn,hr,or,E.a,z.h,o.t,w.q,A.e,M.b,o.w,w.p,w.o],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .icon-button-rect[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:13em!important;opacity:1}[_nghost-%COMP%]   .icon-button-rect[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .icon-button-rect[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}[_nghost-%COMP%]   .icon-button-rect[_ngcontent-%COMP%] >   span.ui-button-icon-left{font-size:2.5em}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border:1px solid #81c784;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}"]}),i})(),Nr=(()=>{class i{constructor(i,e){this.router=i,this.activeRoute=e}ngOnInit(){this.tipoIntestazioneEnum=gt.a}onClickTrasferimenti(){this.router.navigate(["trasferimenti"],{relativeTo:this.activeRoute.parent})}onClickRavvedimentoOperoso(){}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(z.e),p.Nb(z.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-gestione-esubero-carburante"]],decls:24,vars:12,consts:[[3,"ctx"],[1,"ui-grid-fixed","mt-5"],[1,"boxgrey"],[1,"p-col","block-100"],[1,"ui-header-sezioni-uma"],[1,"auto-cursor"],[1,"p-grid","p-justify-between","m-0"],[1,"p-grid","p-align-center","m-0","p-2"],[1,"p-col","p-col-align-center"],[1,"p-grid","p-nogutter"],[1,"p-col-6","p-0","cell","border-right-0"],[1,"pl-2","p-0","py-1","cell-content",3,"click"],["src","assets/img/icons/uma-icon/icon-prelievi.svg",1,"d-inline-block","mr-3"],[1,"p-col-6","p-0","cell"],["src","assets/img/icons/uma-icon/icon-ricevuti.svg",1,"d-inline-block","mr-3"]],template:function(i,e){1&i&&(p.Ob(0,"app-intestazione-uma",0),p.Tb(1,"div",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"a",5),p.Tb(6,"div",6),p.Tb(7,"div",7),p.Tb(8,"div",8),p.Tb(9,"strong"),p.Oc(10),p.gc(11,"uppercase"),p.gc(12,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(13,"div",9),p.Tb(14,"div",10),p.Tb(15,"div",11),p.bc("click",(function(){return e.onClickTrasferimenti()})),p.Ob(16,"img",12),p.Oc(17),p.gc(18,"translate"),p.Sb(),p.Sb(),p.Tb(19,"div",13),p.Tb(20,"div",11),p.bc("click",(function(){return e.onClickRavvedimentoOperoso()})),p.Ob(21,"img",14),p.Oc(22),p.gc(23,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.mc("ctx",null==e.tipoIntestazioneEnum?null:e.tipoIntestazioneEnum.GESTIONE_CARBURANTE_IN_ESUBERO),p.Bb(10),p.Pc(p.hc(11,4,p.hc(12,6,"UMA.GESTIONE_CARBURANTE_IN_ESUBERO"))),p.Bb(7),p.Qc(" ",p.hc(18,8,"UMA.TRASFERIMENTI")," "),p.Bb(5),p.Qc(" ",p.hc(23,10,"UMA.RAVVEDIMENTO_OPEROSO")," "))},directives:[Dt],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .cell[_ngcontent-%COMP%]{border:1px solid #cacaca;cursor:pointer}[_nghost-%COMP%]   .cell.disabled[_ngcontent-%COMP%] > .cell-content[_ngcontent-%COMP%]{opacity:.5;cursor:auto}[_nghost-%COMP%]   div.ui-header-sezioni-uma[_ngcontent-%COMP%]{background-color:#fff;border-top:2px solid #4caf50;border-left:1px solid #cacaca;border-right:1px solid #cacaca;font-size:1em}[_nghost-%COMP%]   .block-100[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.ui-clickable.pi.pi-trash{color:#01985a!important;font-size:x-large!important}[_nghost-%COMP%]     .ui-toast-message-custom{background-color:#fff;color:#4caf50}[_nghost-%COMP%]     .ui-toast-message-custom .ui-toast-close-icon{color:#4caf50}[_nghost-%COMP%]     .ui-dialog>.ui-dialog-content>.ui-confirmdialog-message{white-space:pre-line}"]}),i})(),Br=(()=>{class i{constructor(){}trasferitiDtoToRicevutiViewModelBuilder(i){const e=[];return i&&i.length&&i.forEach(i=>{const t={};t.id=i.id,t.benzina=i.carburante.benzina,t.gasolio=i.carburante.gasolio,t.gasolioSerre=i.carburante.gasolioSerre,t.data=An(i.data).format("DD/MM/YYYY"),t.cuaa=i.destinatario.cuaa,t.denominazione=i.destinatario.denominazione,e.push(t)}),e}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const yr=function(){return{marginTop:"70px"}};let _r=(()=>{class i{constructor(i,e,t,o,a,n,r){this.indiceUmaService=i,this.location=e,this.route=t,this.httpClientDichiarazioneConsumiUmaService=o,this.httpCLientCarburanteRicevutoService=a,this.trasferitiBuilderService=n,this.errorService=r}ngOnInit(){this.initVariables(),this.routerSubscription=this.route.params.pipe(Object(r.a)(i=>this.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(i.id)),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>this.httpCLientCarburanteRicevutoService.getCarburanteTrasferito(i.cuaa,i.campagnaRichiesta.toString()))).subscribe(i=>{this.datasource=this.trasferitiBuilderService.trasferitiDtoToRicevutiViewModelBuilder(i.dati)},i=>this.errorService.showError(i))}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe()}goBack(){this.location.back()}initVariables(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.cols=this.defineColumns()}defineColumns(){return[{field:"cuaa",header:"CUAA",sortable:!0,font:K.e.BOLD,width:"25%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"denominazione",header:"Denominazione",sortable:!0,font:K.e.BOLD,width:"45%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"gasolio",header:"Gasolio trasferito (lt.)",sortable:!1,width:"10%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"benzina",header:"Benzina trasferita (lt.)",sortable:!1,width:"10%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"gasolioSerre",header:"Gasolio serre trasferito (lt.)",sortable:!1,width:"10%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(f),p.Nb(o.n),p.Nb(z.a),p.Nb(se.a),p.Nb(no.a),p.Nb(Br),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-trasferimenti"]],decls:19,vars:10,consts:[["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-trasferimenti_black.svg"],[1,"ml-2"],[1,"fs-20"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"cols","values"]],template:function(i,e){1&i&&(p.Ob(0,"p-toast",0),p.Tb(1,"div",1),p.Tb(2,"div",2),p.Tb(3,"div",3),p.Tb(4,"div",4),p.Tb(5,"div",5),p.Tb(6,"div",6),p.Tb(7,"a",7),p.bc("click",(function(){return e.goBack()})),p.Ob(8,"i",8),p.Ob(9,"img",9),p.Tb(10,"span",10),p.Tb(11,"strong",11),p.Oc(12),p.gc(13,"uppercase"),p.gc(14,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(15,"div",12),p.Tb(16,"div",13),p.Tb(17,"div",14),p.Ob(18,"app-a4g-multi-table",15),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Kc(p.rc(9,yr)),p.Bb(12),p.Pc(p.hc(13,5,p.hc(14,7,"UMA.DICHIARAZIONE_CONSUMI.TRASFERIMENTI"))),p.Bb(6),p.mc("cols",e.cols)("values",e.datasource))},directives:[E.a,z.h,ai.a],pipes:[o.G,ni.d],styles:[""]}),i})();const Fr=["dialog"],Pr=["table"];function wr(i,e){1&i&&p.Ob(0,"p-message",14)}function xr(i,e){if(1&i&&(p.Tb(0,"div"),p.Tb(1,"div"),p.Mc(2,wr,1,0,"p-message",13),p.Sb(),p.Sb()),2&i){const i=p.fc();p.Bb(2),p.mc("ngIf",null==i.searchForm.get("idRichiestaDestinatario").errors?null:i.searchForm.get("idRichiestaDestinatario").errors.pattern)}}const Lr=function(){return{width:"20%"}},Gr=function(){return{width:"70%"}},Ur=function(){return{width:"10%","text-align":"center"}};function kr(i,e){1&i&&(p.Tb(0,"tr"),p.Tb(1,"th",21),p.Oc(2,"CUAA"),p.Sb(),p.Tb(3,"th",21),p.Oc(4,"DENOMINAZIONE"),p.Sb(),p.Tb(5,"th",21),p.Oc(6,"AZIONI"),p.Sb(),p.Sb()),2&i&&(p.Bb(1),p.mc("ngStyle",p.rc(3,Lr)),p.Bb(2),p.mc("ngStyle",p.rc(4,Gr)),p.Bb(2),p.mc("ngStyle",p.rc(5,Ur)))}function Vr(i,e){if(1&i){const i=p.Ub();p.Tb(0,"tr"),p.Tb(1,"td",21),p.Oc(2),p.Sb(),p.Tb(3,"td",21),p.Oc(4),p.gc(5,"uppercase"),p.Sb(),p.Tb(6,"td",21),p.Tb(7,"button",22),p.bc("click",(function(){p.Ec(i);const t=e.$implicit;return p.fc(2).onClickButton("AGGIUNGI",t.cuaa,t.denominazione)})),p.Sb(),p.Sb(),p.Sb()}if(2&i){const i=e.$implicit;p.Bb(1),p.mc("ngStyle",p.rc(7,Lr)),p.Bb(1),p.Pc(i.cuaa),p.Bb(1),p.mc("ngStyle",p.rc(8,Gr)),p.Bb(1),p.Pc(p.hc(5,5,i.denominazione)),p.Bb(2),p.mc("ngStyle",p.rc(9,Ur))}}function Hr(i,e){1&i&&(p.Tb(0,"tr"),p.Tb(1,"td"),p.Oc(2,"Nessun azienda trovato."),p.Sb(),p.Sb()),2&i&&(p.Bb(1),p.Cb("colspan",4))}function Zr(i,e){if(1&i){const i=p.Ub();p.Tb(0,"div",15),p.Tb(1,"p-table",16,17),p.bc("onLazyLoad",(function(e){p.Ec(i);const t=p.fc();return t.changePage(e,t.idRichiesta)})),p.Mc(3,kr,7,6,"ng-template",18),p.Mc(4,Vr,8,10,"ng-template",19),p.Mc(5,Hr,3,1,"ng-template",20),p.Sb(),p.Sb()}if(2&i){const i=p.fc();p.Bb(1),p.mc("autoLayout",!0)("value",i.datasource)("rows",1)("scrollable",!1)("resetPageOnSort",!1)("first",i.first)("totalRecords",i.totalElements)("lazy",!0)}}const jr=function(){return{overflow:"auto"}},Yr=function(){return{marginTop:"70px"}};let $r=(()=>{class i{constructor(i,e,t,o){this.trasferimentiService=i,this.errorService=e,this.formService=t,this.messageService=o,this.chiudiPopup=new p.n}ngOnInit(){this.searchForm=new L.j({idRichiestaDestinatario:new L.g(null)})}ngOnDestroy(){this.validaSubscription&&this.validaSubscription.unsubscribe()}open(i){this.display=!0,this.searchForm.get("idRichiestaDestinatario").setValue(null),this.datasource=null,this.idRichiestaMittente=i}onHideDialog(){}chiudiDialog(i){this.display=!1,this.datasource=null,this.dialogElement._style.width="unset"}onClickButton(i,e,t){switch(i){case"CERCA":this.cercaRichiesta(this.searchForm.get("idRichiestaDestinatario").value);break;case"AGGIUNGI":this.addTrasferimento(this.searchForm.get("idRichiestaDestinatario").value,e,t)}}cercaRichiesta(i){this.formService.validateForm(this.searchForm),this.searchForm.valid?this.validaSubscription=this.trasferimentiService.validaTrasferimento(this.idRichiestaMittente,i).subscribe(i=>{this.dialogElement._style.width="80vw",this.datasource=[],this.datasource.push(i),this.totalElements=1},i=>{i&&i.error&&i.error.message&&i.error.message.startsWith("Non \xe8 possibile modificare")?this.errorService.showErrorWithMessage(g.a.aziendaDestinatariaTrasferimentoKO,"tst-ricerca-richiesta-carburante"):this.errorService.showError(i,"tst-ricerca-richiesta-carburante")}):this.messageService.add(c.a.getToast("tst-ricerca-richiesta-carburante",c.b.error,g.a.datiNotCorretti))}addTrasferimento(i,e,t){this.chiudiDialog(),this.chiudiPopup.emit({idDestinatario:i,cuaa:e,denominazione:t,modalitaCrea:!0})}changePage(i){}reset(){this.table&&this.table.reset()}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(no.a),p.Nb(T.a),p.Nb(re.a),p.Nb(A.d))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-popup-ricerca-richiesta-carburante"]],viewQuery:function(i,e){var t;1&i&&(p.Jc(Fr,!0),p.Uc(Pr,!0)),2&i&&(p.Ac(t=p.cc())&&(e.dialogElement=t.first),p.Ac(t=p.cc())&&(e.table=t.first))},outputs:{chiudiPopup:"chiudiPopup"},decls:18,vars:22,consts:[["id","popup-ricerca-richiesta-carburante","position","center",3,"visible","focusOnShow","modal","closable","closeOnEscape","blockScroll","dismissableMask","contentStyle","header","visibleChange","onHide"],["dialog",""],["key","tst-ricerca-richiesta-carburante"],["novalidate","",1,"p-grid",3,"formGroup","ngSubmit"],[1,"p-col"],[1,"p-grid"],[1,"ui-inputgroup"],["type","text","placeholder","Inserire ID Richiesta di carburante","id","idRichiesta","pattern","^([0-9])+$","formControlName","idRichiestaDestinatario","size","60",3,"maxlength"],["richiestaRef",""],["pButton","","type","submit","icon","pi pi-search",1,"icon-button-square",3,"disabled"],[4,"ngIf"],["class","p-col boxgrey",4,"ngIf"],["pButton","","type","button","label","Chiudi",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","shadow-none","font-weight-normal",3,"click"],["class","font-12 extended","severity","error","text","Formato non valido",4,"ngIf"],["severity","error","text","Formato non valido",1,"font-12","extended"],[1,"p-col","boxgrey"],[3,"autoLayout","value","rows","scrollable","resetPageOnSort","first","totalRecords","lazy","onLazyLoad"],["table",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"ngStyle"],["pButton","","icon","pi pi-plus",1,"icon-button-square",3,"click"]],template:function(i,e){if(1&i&&(p.Tb(0,"p-dialog",0,1),p.bc("visibleChange",(function(i){return e.display=i}))("onHide",(function(){return e.onHideDialog()})),p.gc(2,"uppercase"),p.gc(3,"translate"),p.Ob(4,"p-toast",2),p.Tb(5,"form",3),p.bc("ngSubmit",(function(){return e.onClickButton("CERCA","","")})),p.Tb(6,"div",4),p.Tb(7,"div",5),p.Tb(8,"div",4),p.Tb(9,"div",6),p.Ob(10,"input",7,8),p.Ob(12,"button",9),p.Sb(),p.Mc(13,xr,3,1,"div",10),p.Sb(),p.Sb(),p.Mc(14,Zr,6,8,"div",11),p.Tb(15,"div",5),p.Tb(16,"div",4),p.Tb(17,"button",12),p.bc("click",(function(i){return e.chiudiDialog(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i){const i=p.Bc(11);p.nc("header",p.hc(2,16,p.hc(3,18,"UMA.DICHIARAZIONE_CONSUMI.DESTINATARIO_TRASFERIMENTO"))),p.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("blockScroll",!0)("dismissableMask",!0)("contentStyle",p.rc(20,jr)),p.Bb(4),p.Kc(p.rc(21,Yr)),p.Bb(1),p.mc("formGroup",e.searchForm),p.Bb(5),p.mc("maxlength",19),p.Bb(2),p.mc("disabled",(null==i.value?null:i.value.length)<3),p.Bb(1),p.mc("ngIf",e.searchForm.get("idRichiestaDestinatario").invalid&&(e.searchForm.get("idRichiestaDestinatario").dirty||e.searchForm.get("idRichiestaDestinatario").touched)),p.Bb(1),p.mc("ngIf",e.datasource)}},directives:[jt.a,E.a,L.I,L.t,L.k,L.c,L.z,L.s,L.i,L.n,M.b,o.t,he.b,w.q,A.e,o.w],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   th[_ngcontent-%COMP%]{color:#000}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:27em;max-height:27em;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]     .ui-widget-header{border:unset!important}[_nghost-%COMP%]     p-message.extended .ui-message.ui-message-error{width:33em;margin:0}"]}),i})();const qr=["dialog"],Qr=function(){return{overflow:"auto"}},Kr=function(){return{marginTop:"70px"}};let Wr=(()=>{class i{constructor(i,e,t,o){this.formatConverterService=i,this.errorService=e,this.trasferimentiService=t,this.messageService=o,this.chiudiPopup=new p.n}ngOnInit(){this.cols=this.defineColumns()}ngOnDestroy(){this.postTrasferimentoSub&&this.postTrasferimentoSub.unsubscribe(),this.putTrasferimento&&this.putTrasferimento.unsubscribe()}open(i){this.isValidFormTable=!0,this.display=!0,this.modalitaCrea=i.modalitaCrea,this.dichiarazioneConsumi=i.dichiarazioneConsumi,this.cuaa=i.cuaa,this.denominazione=i.denominazione,this.idMittente=i.idMittente,this.idDestinatario=i.idDestinatario,this.modalitaCrea?this.buildDataSource(i.trasferibile):(this.idTrasferimento=i.idTrasferimento,this.buildDataSource(i.trasferibile,i.trasferimento))}salva(i){const e=this.datasource.filter(i=>"Benzina"==i.carburante)[0],t=this.datasource.filter(i=>"Gasolio"==i.carburante)[0],o=this.datasource.filter(i=>"Gasolio Serre"==i.carburante)[0];if(0!=this.formatConverterService.toNumber(e.trasferito)||0!=this.formatConverterService.toNumber(t.trasferito)||0!=this.formatConverterService.toNumber(o.trasferito))if(this.formatConverterService.toNumber(t.trasferibile)<this.formatConverterService.toNumber(t.trasferito))this.errorService.showErrorWithMessage(g.a.trasferimentoGasolioLtError,"tst-dialog");else if(this.formatConverterService.toNumber(e.trasferibile)<this.formatConverterService.toNumber(e.trasferito))this.errorService.showErrorWithMessage(g.a.trasferimentoBenzinaLtError,"tst-dialog");else if(this.formatConverterService.toNumber(o.trasferibile)<this.formatConverterService.toNumber(o.trasferito))this.errorService.showErrorWithMessage(g.a.trasferimentoGasolioSerreLtError,"tst-dialog");else if(this.modalitaCrea)this.postTrasferimentoSub=this.trasferimentiService.postTrasferimento(this.idMittente,this.idDestinatario,{gasolio:t.trasferito?t.trasferito:0,benzina:e.trasferito?e.trasferito:0,gasolioSerre:o.trasferito?o.trasferito:0}).subscribe(i=>{console.log("Salvataggio effettuato correttamente!"),this.chiudiPopup.emit(!0),this.display=!1},i=>this.errorService.showError(i,"tst-dialog"));else{if(this.dichiarazioneConsumi&&this.dichiarazioneConsumi.stato===le.a.PROTOCOLLATA)return void this.errorService.showErrorWithMessage(g.a.modificaTrasferimentoKO,"tst-dialog");this.putTrasferimento=this.trasferimentiService.putTrasferimento(this.idTrasferimento,{gasolio:this.formatConverterService.toNumber(t.trasferito?t.trasferito:0),benzina:this.formatConverterService.toNumber(e.trasferito?e.trasferito:0),gasolioSerre:this.formatConverterService.toNumber(o.trasferito?o.trasferito:0)}).subscribe(i=>{console.log("Aggiornamento effettuato correttamente!"),this.chiudiPopup.emit(!0),this.display=!1},i=>this.errorService.showError(i,"tst-dialog"))}else this.errorService.showErrorWithMessage(g.a.trasferimentoObbligatorio,"tst-dialog")}onChangeForm(i){this.isChangedInputTable=i.isChanged,this.isValidFormTable=i.isValid}buildDataSource(i,e){this.datasource=[{carburante:"Gasolio",trasferibile:(i||{}).gasolio||Number("0"),trasferito:e?e.gasolio:null},{carburante:"Benzina",trasferibile:(i||{}).benzina||Number("0"),trasferito:e?e.benzina:null},{carburante:"Gasolio Serre",trasferibile:(i||{}).gasolioSerre||Number("0"),trasferito:e?e.gasolioSerre:null}]}defineColumns(){return[{field:"carburante",header:"Carburante",sortable:!1,disabled:!1,width:"44%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"trasferibile",header:"Quantit\xe0 Trasferibile",sortable:!1,width:"18%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"trasferito",header:"Quantit\xe0 Trasferita",sortable:!1,width:"18%",inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,type:K.d.INPUT_NUMBER}]}annulla(){this.display=!1}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(Ii.a),p.Nb(T.a),p.Nb(no.a),p.Nb(A.d))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-popup-inserisci-edita-trasferimento"]],viewQuery:function(i,e){var t;1&i&&p.Jc(qr,!0,p.l),2&i&&p.Ac(t=p.cc())&&(e.dialogElement=t.first)},inputs:{READONLY_MODE:"READONLY_MODE"},outputs:{chiudiPopup:"chiudiPopup"},decls:21,vars:21,consts:[["id","popup-visualizza-richiesta-carburante","position","center",3,"visible","focusOnShow","modal","closable","closeOnEscape","blockScroll","contentStyle","header","dismissableMask","visibleChange"],["dialog",""],["key","tst-dialog",3,"baseZIndex"],[1,"p-grid","m-0"],[1,"p-col"],[1,"p-grid","p-align-center"],[3,"cols","values","changedValueForm"],[1,"p-grid","p-justify-end"],["pButton","","type","button","label","Annulla",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none","w-5m",3,"click"],["pButton","","type","button","label","Salva",1,"ui-button-text-only","p-1","text-uppercase","font-weight-normal","shadow-none","w-5m",3,"disabled","click"]],template:function(i,e){1&i&&(p.Tb(0,"p-dialog",0,1),p.bc("visibleChange",(function(i){return e.display=i})),p.gc(2,"translate"),p.Ob(3,"p-toast",2),p.Tb(4,"div",3),p.Tb(5,"div",4),p.Tb(6,"div",5),p.Oc(7),p.Ob(8,"br"),p.Oc(9),p.Ob(10,"br"),p.Ob(11,"br"),p.Sb(),p.Sb(),p.Sb(),p.Tb(12,"div",5),p.Tb(13,"div",4),p.Tb(14,"app-a4g-multi-table",6),p.bc("changedValueForm",(function(i){return e.onChangeForm(i)})),p.Sb(),p.Sb(),p.Sb(),p.Ob(15,"br"),p.Tb(16,"div",7),p.Tb(17,"div"),p.Tb(18,"button",8),p.bc("click",(function(){return e.annulla()})),p.Sb(),p.Sb(),p.Tb(19,"div"),p.Tb(20,"button",9),p.bc("click",(function(i){return e.salva(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.nc("header",p.hc(2,17,"UMA.DICHIARAZIONE_CONSUMI.TRASFERIMENTO_CARBURANTE")),p.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("blockScroll",!0)("contentStyle",p.rc(19,Qr))("dismissableMask",!0),p.Bb(3),p.Kc(p.rc(20,Kr)),p.mc("baseZIndex",9999),p.Bb(4),p.Qc(" CUAA: ",e.cuaa," "),p.Bb(2),p.Qc(" DENOMINAZIONE: ",e.denominazione," "),p.Bb(5),p.mc("cols",e.cols)("values",e.datasource),p.Bb(6),p.mc("disabled",e.READONLY_MODE))},directives:[jt.a,E.a,ai.a,M.b],pipes:[ni.d],styles:["[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:450px;max-height:450px;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),i})();const Jr=["popupRicercaRichiesta"],Xr=["popupInserisciEditaTrasferimento"],is=function(){return{marginTop:"70px"}},es=[{path:"",component:rt,data:{mybreadcrumb:""},children:[{path:"richiedente/:tipoRichiesta",component:dt,data:{mybreadcrumb:vt.a.BREADCRUMB.richiedente}},{path:"richiesta/:idDomanda",component:Mt,children:[{path:"",redirectTo:"indice"},{path:"indice",component:at,data:{mybreadcrumb:vt.a.BREADCRUMB.gestione_domanda}}]},{path:"dichiarazione-consumi/:id",component:Nt,children:[{path:"",redirectTo:"sezioni"},{path:"sezioni",component:xt,data:{mybreadcrumb:vt.a.BREADCRUMB.gestione_dichiarazione_consumi}},{path:"prelievi",component:Ut,data:{mybreadcrumb:vt.a.BREADCRUMB.prelievi}},{path:"clienti-contoterzi",component:nt,data:{mybreadcrumb:""},children:[{path:"",redirectTo:"lista"},{path:"lista",component:Mr,data:{mybreadcrumb:vt.a.BREADCRUMB.clientiContoTerzi}},{path:":idCliente",component:Gn,data:{mybreadcrumb:vt.a.BREADCRUMB.clientiContoTerziDettaglio}}]},{path:"ricevuti",component:Dn,data:{mybreadcrumb:vt.a.BREADCRUMB.ricevuti}},{path:"consumi",component:zn,data:{mybreadcrumb:vt.a.BREADCRUMB.consumi}},{path:"trasferimenti",component:_r,data:{mybreadcrumb:vt.a.BREADCRUMB.trasferimenti}}]},{path:"esubero-carburante/:idDomanda",children:[{path:"",redirectTo:"sezioni"},{path:"sezioni",component:Nr,data:{mybreadcrumb:vt.a.BREADCRUMB.esubero_carburante}},{path:"trasferimenti",component:(()=>{class i{constructor(i,e,t,o,a,n,r,s,c,l){this.indiceUmaService=i,this.location=e,this.route=t,this.httpCLientCarburanteRicevutoService=o,this.httpClientDomandaUmaService=a,this.httpClientDichiarazioneConsumiUmaService=n,this.trasferitiBuilderService=r,this.confirmationService=s,this.messageService=c,this.errorService=l}ngOnInit(){this.initVariables(),this.caricaDatiTrasferimenti(!1)}ngOnDestroy(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe()}initVariables(){this.tipoIntestazioneEnum=gt.a,this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.cols=this.defineColumns()}goBack(){this.location.back()}caricaDatiTrasferimenti(i){i&&this.confirmationService.confirm({message:g.a.saveTrasferimentoCarburanteWarn,rejectVisible:!1,accept:()=>{},reject:()=>{},key:"trasferimenti-dialog-save"}),this.routerSubscription=this.route.params.pipe(Object(r.a)(i=>(this.idRichiesta=i.idDomanda,this.httpClientDomandaUmaService.getDomandaById(i.idDomanda))),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>(this.richiestaMittente=i,this.httpCLientCarburanteRicevutoService.getCarburanteTrasferito(i.cuaa,i.campagna.toString()))),Object(s.a)(i=>(this.errorService.showError(i),n.a)),Object(r.a)(i=>(this.datasource=this.trasferitiBuilderService.trasferitiDtoToRicevutiViewModelBuilder(i.dati),i&&i.dati.length?this.httpClientDichiarazioneConsumiUmaService.getDichiarazioniConsumi({cuaa:i.dati[0].destinatario.cuaa,campagna:[this.richiestaMittente.campagna.toString()],numeroElementiPagina:1,pagina:0}):n.a))).subscribe(i=>{i&&i.length&&(this.dichiarazioneConsumi=i[0])},i=>this.errorService.showError(i))}onClickIcon(i){"elimina"===i.col.buttonOpts.id?this.deleteTrasferimento(i.element):"modifica"===i.col.buttonOpts.id&&this.editTrasferimento(i.element)}editTrasferimento(i){this.openInserisciEditaTrasferimentoPopup({trasferimento:i,modalitaCrea:!1})}deleteTrasferimento(i){this.confirmationService.confirm({message:g.a.confermaCancellazioneTrasferimento,accept:()=>{this.cancellaDaID(i)},reject:()=>{},key:"trasferimenti-dialog"})}nuovoTrasferimento(){this.datasource.length>0?this.messageService.add(c.a.getToast("tst-trasferimenti",c.b.warn,g.a.erroreTrasferimentoPresente)):this.popupRicercaRichiesta.open(this.richiestaMittente.id.toString())}openInserisciEditaTrasferimentoPopup(i){const e=this.httpClientDichiarazioneConsumiUmaService.getResiduoAnnoPrecedente(this.richiestaMittente.cuaa,this.richiestaMittente.campagna-1,[le.a.PROTOCOLLATA]),t=this.httpClientDomandaUmaService.getPrelieviByCuaaAndCampagna(this.richiestaMittente.cuaa,this.richiestaMittente.campagna.toString());Object(ii.a)([e,t]).subscribe(([e,t])=>{const o=new ce.a;if(o.gasolio=(e&&e[0]?e[0].rimanenza.gasolio:0)+t.totale.gasolio,o.benzina=(e&&e[0]?e[0].rimanenza.benzina:0)+t.totale.benzina,o.gasolioSerre=(e&&e[0]?e[0].rimanenza.gasolioSerre:0)+t.totale.gasolioSerre,i.modalitaCrea)this.popupInserisciEditaTrasferimento.open({trasferibile:o,idMittente:this.idRichiesta,idDestinatario:i.idDestinatario.toString(),cuaa:i.cuaa,denominazione:i.denominazione,modalitaCrea:!0});else{let e=new ce.a;e.gasolio=i.trasferimento.gasolio,e.benzina=i.trasferimento.benzina,e.gasolioSerre=i.trasferimento.gasolioSerre,this.popupInserisciEditaTrasferimento.open({trasferibile:o,idTrasferimento:i.trasferimento.id.toString(),trasferimento:e,cuaa:i.trasferimento.cuaa,denominazione:i.trasferimento.denominazione,modalitaCrea:!1,dichiarazioneConsumi:this.dichiarazioneConsumi})}})}cancellaDaID(i){this.dichiarazioneConsumi&&this.dichiarazioneConsumi.stato===le.a.PROTOCOLLATA?this.errorService.showErrorWithMessage(g.a.cancellazioneTrasferimentoKO,"tst-trasferimenti"):this.deleteSubscription=this.httpCLientCarburanteRicevutoService.deleteTraseferito(i.id.toString()).subscribe(()=>{this.messageService.add(c.a.getToast("tst-trasferimenti",c.b.success,g.a.cancellazioneTrasferimentoOK)),this.caricaDatiTrasferimenti(!1)},i=>this.errorService.showError(i,"tst-trasferimenti"))}onChangeForm(i){}defineColumns(){return[{field:"",header:"",sortable:!1,width:"5%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,buttonOpts:{id:"elimina",icon:"pi pi-times-circle",hiddenBy:"isConsegnato"},type:K.d.ICON_BUTTON_CIRCLE},{field:"cuaa",header:"CUAA",sortable:!1,font:K.e.BOLD,width:"23%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"denominazione",header:"Denominazione",sortable:!1,font:K.e.BOLD,width:"43%",alignCellHorizontal:K.c.LEFT,alignHeader:K.c.LEFT,type:K.d.READONLY},{field:"gasolio",header:"Gasolio trasferito (lt.)",sortable:!1,width:"8%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"benzina",header:"Benzina trasferita (lt.)",sortable:!1,width:"8%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"gasolioSerre",header:"Gasolio serre trasferito (lt.)",sortable:!1,width:"8%",alignCellHorizontal:K.c.RIGHT,alignHeader:K.c.CENTER,type:K.d.READONLY},{field:"",header:"",sortable:!1,width:"5%",alignCellHorizontal:K.c.CENTER,alignHeader:K.c.CENTER,buttonOpts:{id:"modifica",icon:"pi pi-pencil"},type:K.d.ICON_BUTTON_SQUARE}]}}return i.\u0275fac=function(e){return new(e||i)(p.Nb(f),p.Nb(o.n),p.Nb(z.a),p.Nb(no.a),p.Nb(b.a),p.Nb(se.a),p.Nb(Br),p.Nb(A.a),p.Nb(A.d),p.Nb(T.a))},i.\u0275cmp=p.Hb({type:i,selectors:[["app-gestione-trasferimenti"]],viewQuery:function(i,e){var t;1&i&&(p.Jc(Jr,!0),p.Jc(Xr,!0)),2&i&&(p.Ac(t=p.cc())&&(e.popupRicercaRichiesta=t.first),p.Ac(t=p.cc())&&(e.popupInserisciEditaTrasferimento=t.first))},decls:28,vars:12,consts:[[3,"chiudiPopup"],["popupRicercaRichiesta",""],[3,"READONLY_MODE","chiudiPopup"],["popupInserisciEditaTrasferimento",""],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","trasferimenti-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","trasferimenti-dialog-save","acceptLabel","OK","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25"],["key","tst-trasferimenti"],[3,"ctx"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-trasferimenti_black.svg"],[1,"ml-2"],[1,"fs-20"],[1,"p-col-fixed","w-10m","p-0","py-1"],["pButton","","type","button","label","NUOVO",3,"click"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"cols","values","changedValueForm","clickIcon"]],template:function(i,e){1&i&&(p.Tb(0,"app-popup-ricerca-richiesta-carburante",0,1),p.bc("chiudiPopup",(function(i){return e.openInserisciEditaTrasferimentoPopup(i)})),p.Sb(),p.Tb(2,"app-popup-inserisci-edita-trasferimento",2,3),p.bc("chiudiPopup",(function(i){return e.caricaDatiTrasferimenti(i)})),p.Sb(),p.Ob(4,"p-confirmDialog",4),p.Ob(5,"p-confirmDialog",5),p.Ob(6,"p-toast",6),p.Ob(7,"app-intestazione-uma",7),p.Tb(8,"div",8),p.Tb(9,"div",9),p.Tb(10,"div",10),p.Tb(11,"div",11),p.Tb(12,"div",12),p.Tb(13,"div",13),p.Tb(14,"a",14),p.bc("click",(function(){return e.goBack()})),p.Ob(15,"i",15),p.Ob(16,"img",16),p.Tb(17,"span",17),p.Tb(18,"strong",18),p.Oc(19),p.gc(20,"uppercase"),p.gc(21,"translate"),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Tb(22,"div",19),p.Tb(23,"button",20),p.bc("click",(function(){return e.nuovoTrasferimento()})),p.Sb(),p.Sb(),p.Tb(24,"div",21),p.Tb(25,"div",22),p.Tb(26,"div",23),p.Tb(27,"app-a4g-multi-table",24),p.bc("changedValueForm",(function(i){return e.onChangeForm(i)}))("clickIcon",(function(i){return e.onClickIcon(i)})),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb(),p.Sb()),2&i&&(p.Bb(2),p.mc("READONLY_MODE",e.READONLY_MODE),p.Bb(4),p.Kc(p.rc(11,is)),p.Bb(1),p.mc("ctx",null==e.tipoIntestazioneEnum?null:e.tipoIntestazioneEnum.GESTIONE_CARBURANTE_IN_ESUBERO),p.Bb(12),p.Pc(p.hc(20,7,p.hc(21,9,"UMA.DICHIARAZIONE_CONSUMI.TRASFERIMENTI"))),p.Bb(8),p.mc("cols",e.cols)("values",e.datasource))},directives:[$r,Wr,R.a,E.a,Dt,z.h,M.b,ai.a],pipes:[o.G,ni.d],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),i})(),data:{mybreadcrumb:vt.a.BREADCRUMB.trasferimenti}}]}]}];let ts=(()=>{class i{}return i.\u0275mod=p.Lb({type:i}),i.\u0275inj=p.Kb({factory:function(e){return new(e||i)},imports:[[z.i.forChild(es)]]}),i})();var os=t("1IWC"),as=t.n(os),ns=t("R69K");const rs=[o.c],ss=[],cs=[Ge,ne.a,Ii.a];let ls=(()=>{class i{}return i.\u0275mod=p.Lb({type:i}),i.\u0275inj=p.Kb({factory:function(e){return new(e||i)},providers:[...cs,...ss],imports:[[...rs],o.c]}),i})(),us=(()=>{class i{constructor(){}openPanel(i,e=null,t=null){i.show(e,t)}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var bs=t("DYNa"),hs=function(i){return i.success="success",i.info="info",i.warn="warn",i.error="error",i}({});let ms=(()=>{class i{constructor(i,e,t){this.messageService=i,this.renderer=e,this.el=t}openFromComponent(i,e){this.addSingle(e)}addSingle(i){i=this.setSummary(i),this.messageService.add({severity:i.severity,summary:i.summary,detail:i.detail})}addMultiple(i){this.messageService.addAll(i)}clear(i){this.messageService.clear(i)}setSummary(i){switch(i.severity){case hs.error:i.summary="Errore!";break;case hs.info:i.summary="Informazione";break;case hs.success:i.summary="Avviso!";break;case hs.warn:i.summary="Attenzione!";break;default:i.summary="Informazione"}return i}}return i.\u0275fac=function(e){return new(e||i)(p.Xb(A.d),p.Xb(p.E),p.Xb(p.l))},i.\u0275prov=p.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var ps=t("fLRn"),ds=t("b53x"),gs=t("PMPK");const fs=[o.c,ls,ns.a],vs=[],Ss=[O,f,m.a,b.a,d,P,bs.a,us,we.a,ei,se.a,ms,Mn,no.a,ti,zi,Lt.a,En,Br,Eo,ps.a,ds.a,gs.a];let Cs=(()=>{class i{}return i.\u0275mod=p.Lb({type:i}),i.\u0275inj=p.Kb({factory:function(e){return new(e||i)},providers:[...Ss,...vs],imports:[[...fs],o.c,ls,ns.a]}),i})();const Os=[o.c,ns.a,ts,Cs],Ts=[],Is=[];let zs=(()=>{class i{constructor(){Object(o.K)(as.a,"it")}}return i.\u0275mod=p.Lb({type:i}),i.\u0275inj=p.Kb({factory:function(e){return new(e||i)},providers:[...Is,...Ts],imports:[[...Os],o.c,ns.a,ts,Cs]}),i})()},"2qMH":function(i,e,t){"use strict";var o=t("Q1FS"),a=t("zB/H");e.scheduleArray=function(i,e){return new o.Observable((function(t){var o=new a.Subscription,n=0;return o.add(e.schedule((function(){n!==i.length?(t.next(i[n++]),t.closed||o.add(this.schedule())):t.complete()}))),o}))}},"6aLS":function(i,e,t){"use strict";var o=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])})(e,t)};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),a=t("q3Kh"),n=t("gTqA"),r=t("wjEo");e.switchMap=function i(e,t){return"function"==typeof t?function(o){return o.pipe(i((function(i,o){return n.from(e(i,o)).pipe(a.map((function(e,a){return t(i,e,o,a)})))})))}:function(i){return i.lift(new s(e))}};var s=function(){function i(i){this.project=i}return i.prototype.call=function(i,e){return e.subscribe(new c(i,this.project))},i}(),c=function(i){function e(e,t){var o=i.call(this,e)||this;return o.project=t,o.index=0,o}return o(e,i),e.prototype._next=function(i){var e,t=this.index++;try{e=this.project(i,t)}catch(o){return void this.destination.error(o)}this._innerSub(e)},e.prototype._innerSub=function(i){var e=this.innerSubscription;e&&e.unsubscribe();var t=new r.SimpleInnerSubscriber(this),o=this.destination;o.add(t),this.innerSubscription=r.innerSubscribe(i,t),this.innerSubscription!==t&&o.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||i.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&i.prototype._complete.call(this)},e.prototype.notifyNext=function(i){this.destination.next(i)},e}(r.SimpleOuterSubscriber)},"6qA3":function(i,e,t){"use strict";var o=t("OAkW"),a=t("Z5tI"),n=t("poJ0"),r=t("ozli"),s=t("yRPT"),c=t("90cg"),l=t("GMZp"),u=t("VKeD"),b=t("zfKp");e.subscribeTo=function(i){if(i&&"function"==typeof i[b.observable])return r.subscribeToObservable(i);if(s.isArrayLike(i))return o.subscribeToArray(i);if(c.isPromise(i))return a.subscribeToPromise(i);if(i&&"function"==typeof i[u.iterator])return n.subscribeToIterable(i);var e=l.isObject(i)?"an invalid object":"'"+i+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},"90cg":function(i,e,t){"use strict";e.isPromise=function(i){return!!i&&"function"!=typeof i.subscribe&&"function"==typeof i.then}},EBtg:function(i,e,t){"use strict";var o=t("2KeD"),a=t("n73p"),n=t("2qMH"),r=t("LJ/p"),s=t("HZF8"),c=t("90cg"),l=t("yRPT"),u=t("0alx");e.scheduled=function(i,e){if(null!=i){if(s.isInteropObservable(i))return o.scheduleObservable(i,e);if(c.isPromise(i))return a.schedulePromise(i,e);if(l.isArrayLike(i))return n.scheduleArray(i,e);if(u.isIterable(i)||"string"==typeof i)return r.scheduleIterable(i,e)}throw new TypeError((null!==i&&typeof i||i)+" is not observable")}},HZF8:function(i,e,t){"use strict";var o=t("zfKp");e.isInteropObservable=function(i){return i&&"function"==typeof i[o.observable]}},"LJ/p":function(i,e,t){"use strict";var o=t("Q1FS"),a=t("zB/H"),n=t("VKeD");e.scheduleIterable=function(i,e){if(!i)throw new Error("Iterable cannot be null");return new o.Observable((function(t){var o,r=new a.Subscription;return r.add((function(){o&&"function"==typeof o.return&&o.return()})),r.add(e.schedule((function(){o=i[n.iterator](),r.add(e.schedule((function(){if(!t.closed){var i,e;try{var a=o.next();i=a.value,e=a.done}catch(n){return void t.error(n)}e?t.complete():(t.next(i),this.schedule())}})))}))),r}))}},OAkW:function(i,e,t){"use strict";e.subscribeToArray=function(i){return function(e){for(var t=0,o=i.length;t<o&&!e.closed;t++)e.next(i[t]);e.complete()}}},VKeD:function(i,e,t){"use strict";function o(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}e.getSymbolIterator=o,e.iterator=o(),e.$$iterator=e.iterator},Z5tI:function(i,e,t){"use strict";var o=t("MkmW");e.subscribeToPromise=function(i){return function(e){return i.then((function(i){e.closed||(e.next(i),e.complete())}),(function(i){return e.error(i)})).then(null,o.hostReportError),e}}},gTqA:function(i,e,t){"use strict";var o=t("Q1FS"),a=t("6qA3"),n=t("EBtg");e.from=function(i,e){return e?n.scheduled(i,e):i instanceof o.Observable?i:new o.Observable(a.subscribeTo(i))}},n73p:function(i,e,t){"use strict";var o=t("Q1FS"),a=t("zB/H");e.schedulePromise=function(i,e){return new o.Observable((function(t){var o=new a.Subscription;return o.add(e.schedule((function(){return i.then((function(i){o.add(e.schedule((function(){t.next(i),o.add(e.schedule((function(){return t.complete()})))})))}),(function(i){o.add(e.schedule((function(){return t.error(i)})))}))}))),o}))}},ozli:function(i,e,t){"use strict";var o=t("zfKp");e.subscribeToObservable=function(i){return function(e){var t=i[o.observable]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)}}},poJ0:function(i,e,t){"use strict";var o=t("VKeD");e.subscribeToIterable=function(i){return function(e){for(var t=i[o.iterator]();;){var a=void 0;try{a=t.next()}catch(n){return e.error(n),e}if(a.done){e.complete();break}if(e.next(a.value),e.closed)break}return"function"==typeof t.return&&e.add((function(){t.return&&t.return()})),e}}},q3Kh:function(i,e,t){"use strict";var o=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])})(e,t)};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),a=t("FWf1");e.map=function(i,e){return function(t){if("function"!=typeof i)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return t.lift(new n(i,e))}};var n=function(){function i(i,e){this.project=i,this.thisArg=e}return i.prototype.call=function(i,e){return e.subscribe(new r(i,this.project,this.thisArg))},i}();e.MapOperator=n;var r=function(i){function e(e,t,o){var a=i.call(this,e)||this;return a.project=t,a.count=0,a.thisArg=o||a,a}return o(e,i),e.prototype._next=function(i){var e;try{e=this.project.call(this.thisArg,i,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(a.Subscriber)},wjEo:function(i,e,t){"use strict";var o=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])})(e,t)};return function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}}(),a=t("FWf1"),n=t("Q1FS"),r=t("6qA3");e.SimpleInnerSubscriber=function(i){function e(e){var t=i.call(this)||this;return t.parent=e,t}return o(e,i),e.prototype._next=function(i){this.parent.notifyNext(i)},e.prototype._error=function(i){this.parent.notifyError(i),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(a.Subscriber),e.ComplexInnerSubscriber=function(i){function e(e,t,o){var a=i.call(this)||this;return a.parent=e,a.outerValue=t,a.outerIndex=o,a}return o(e,i),e.prototype._next=function(i){this.parent.notifyNext(this.outerValue,i,this.outerIndex,this)},e.prototype._error=function(i){this.parent.notifyError(i),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(a.Subscriber),e.SimpleOuterSubscriber=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return o(e,i),e.prototype.notifyNext=function(i){this.destination.next(i)},e.prototype.notifyError=function(i){this.destination.error(i)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(a.Subscriber),e.ComplexOuterSubscriber=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return o(e,i),e.prototype.notifyNext=function(i,e,t,o){this.destination.next(e)},e.prototype.notifyError=function(i){this.destination.error(i)},e.prototype.notifyComplete=function(i){this.destination.complete()},e}(a.Subscriber),e.innerSubscribe=function(i,e){if(!e.closed){if(i instanceof n.Observable)return i.subscribe(e);var t;try{t=r.subscribeTo(i)(e)}catch(o){e.error(o)}return t}}},yRPT:function(i,e,t){"use strict";e.isArrayLike=function(i){return i&&"number"==typeof i.length&&"function"!=typeof i}}}]);