(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"1gqn":function(i,e){i.exports=function(i){return i&&"object"==typeof i&&"function"==typeof i.copy&&"function"==typeof i.fill&&"function"==typeof i.readUInt8}},MCLT:function(i,e,a){var t=Object.getOwnPropertyDescriptors||function(i){for(var e=Object.keys(i),a={},t=0;t<e.length;t++)a[e[t]]=Object.getOwnPropertyDescriptor(i,e[t]);return a},o=/%[sdj%]/g;e.format=function(i){if(!f(i)){for(var e=[],a=0;a<arguments.length;a++)e.push(r(arguments[a]));return e.join(" ")}a=1;for(var t=arguments,n=t.length,c=String(i).replace(o,(function(i){if("%%"===i)return"%";if(a>=n)return i;switch(i){case"%s":return String(t[a++]);case"%d":return Number(t[a++]);case"%j":try{return JSON.stringify(t[a++])}catch(e){return"[Circular]"}default:return i}})),s=t[a];a<n;s=t[++a])u(s)||!z(s)?c+=" "+s:c+=" "+r(s);return c},e.deprecate=function(i,a){if("undefined"!=typeof process&&!0===process.noDeprecation)return i;if("undefined"==typeof process)return function(){return e.deprecate(i,a).apply(this,arguments)};var t=!1;return function(){if(!t){if(process.throwDeprecation)throw new Error(a);process.traceDeprecation?console.trace(a):console.error(a),t=!0}return i.apply(this,arguments)}};var n,c={};function r(i,a){var t={seen:[],stylize:l};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),m(a)?t.showHidden=a:a&&e._extend(t,a),v(t.showHidden)&&(t.showHidden=!1),v(t.depth)&&(t.depth=2),v(t.colors)&&(t.colors=!1),v(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=s),d(t,i,t.depth)}function s(i,e){var a=r.styles[e];return a?"\x1b["+r.colors[a][0]+"m"+i+"\x1b["+r.colors[a][1]+"m":i}function l(i,e){return i}function d(i,a,t){if(i.customInspect&&a&&I(a.inspect)&&a.inspect!==e.inspect&&(!a.constructor||a.constructor.prototype!==a)){var o=a.inspect(t,i);return f(o)||(o=d(i,o,t)),o}var n=function(i,e){if(v(e))return i.stylize("undefined","undefined");if(f(e)){var a="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return i.stylize(a,"string")}return p(e)?i.stylize(""+e,"number"):m(e)?i.stylize(""+e,"boolean"):u(e)?i.stylize("null","null"):void 0}(i,a);if(n)return n;var c=Object.keys(a),r=function(i){var e={};return i.forEach((function(i,a){e[i]=!0})),e}(c);if(i.showHidden&&(c=Object.getOwnPropertyNames(a)),A(a)&&(c.indexOf("message")>=0||c.indexOf("description")>=0))return b(a);if(0===c.length){if(I(a))return i.stylize("[Function"+(a.name?": "+a.name:"")+"]","special");if(S(a))return i.stylize(RegExp.prototype.toString.call(a),"regexp");if(T(a))return i.stylize(Date.prototype.toString.call(a),"date");if(A(a))return b(a)}var s,l="",z=!1,O=["{","}"];return g(a)&&(z=!0,O=["[","]"]),I(a)&&(l=" [Function"+(a.name?": "+a.name:"")+"]"),S(a)&&(l=" "+RegExp.prototype.toString.call(a)),T(a)&&(l=" "+Date.prototype.toUTCString.call(a)),A(a)&&(l=" "+b(a)),0!==c.length||z&&0!=a.length?t<0?S(a)?i.stylize(RegExp.prototype.toString.call(a),"regexp"):i.stylize("[Object]","special"):(i.seen.push(a),s=z?function(i,e,a,t,o){for(var n=[],c=0,r=e.length;c<r;++c)P(e,String(c))?n.push(h(i,e,a,t,String(c),!0)):n.push("");return o.forEach((function(o){o.match(/^\d+$/)||n.push(h(i,e,a,t,o,!0))})),n}(i,a,t,r,c):c.map((function(e){return h(i,a,t,r,e,z)})),i.seen.pop(),function(i,e,a){return i.reduce((function(i,e){return e.indexOf("\n"),i+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?a[0]+(""===e?"":e+"\n ")+" "+i.join(",\n  ")+" "+a[1]:a[0]+e+" "+i.join(", ")+" "+a[1]}(s,l,O)):O[0]+l+O[1]}function b(i){return"["+Error.prototype.toString.call(i)+"]"}function h(i,e,a,t,o,n){var c,r,s;if((s=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?r=i.stylize(s.set?"[Getter/Setter]":"[Getter]","special"):s.set&&(r=i.stylize("[Setter]","special")),P(t,o)||(c="["+o+"]"),r||(i.seen.indexOf(s.value)<0?(r=u(a)?d(i,s.value,null):d(i,s.value,a-1)).indexOf("\n")>-1&&(r=n?r.split("\n").map((function(i){return"  "+i})).join("\n").substr(2):"\n"+r.split("\n").map((function(i){return"   "+i})).join("\n")):r=i.stylize("[Circular]","special")),v(c)){if(n&&o.match(/^\d+$/))return r;(c=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.substr(1,c.length-2),c=i.stylize(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=i.stylize(c,"string"))}return c+": "+r}function g(i){return Array.isArray(i)}function m(i){return"boolean"==typeof i}function u(i){return null===i}function p(i){return"number"==typeof i}function f(i){return"string"==typeof i}function v(i){return void 0===i}function S(i){return z(i)&&"[object RegExp]"===O(i)}function z(i){return"object"==typeof i&&null!==i}function T(i){return z(i)&&"[object Date]"===O(i)}function A(i){return z(i)&&("[object Error]"===O(i)||i instanceof Error)}function I(i){return"function"==typeof i}function O(i){return Object.prototype.toString.call(i)}function C(i){return i<10?"0"+i.toString(10):i.toString(10)}e.debuglog=function(i){if(v(n)&&(n=process.env.NODE_DEBUG||""),i=i.toUpperCase(),!c[i])if(new RegExp("\\b"+i+"\\b","i").test(n)){var a=process.pid;c[i]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",i,a,t)}}else c[i]=function(){};return c[i]},e.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=g,e.isBoolean=m,e.isNull=u,e.isNullOrUndefined=function(i){return null==i},e.isNumber=p,e.isString=f,e.isSymbol=function(i){return"symbol"==typeof i},e.isUndefined=v,e.isRegExp=S,e.isObject=z,e.isDate=T,e.isError=A,e.isFunction=I,e.isPrimitive=function(i){return null===i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||"symbol"==typeof i||void 0===i},e.isBuffer=a("1gqn");var y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function D(){var i=new Date,e=[C(i.getHours()),C(i.getMinutes()),C(i.getSeconds())].join(":");return[i.getDate(),y[i.getMonth()],e].join(" ")}function P(i,e){return Object.prototype.hasOwnProperty.call(i,e)}e.log=function(){console.log("%s - %s",D(),e.format.apply(e,arguments))},e.inherits=a("P7XM"),e._extend=function(i,e){if(!e||!z(e))return i;for(var a=Object.keys(e),t=a.length;t--;)i[a[t]]=e[a[t]];return i};var E="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function F(i,e){if(!i){var a=new Error("Promise was rejected with a falsy value");a.reason=i,i=a}return e(i)}e.promisify=function(i){if("function"!=typeof i)throw new TypeError('The "original" argument must be of type Function');if(E&&i[E]){var e;if("function"!=typeof(e=i[E]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,a,t=new Promise((function(i,t){e=i,a=t})),o=[],n=0;n<arguments.length;n++)o.push(arguments[n]);o.push((function(i,t){i?a(i):e(t)}));try{i.apply(this,o)}catch(c){a(c)}return t}return Object.setPrototypeOf(e,Object.getPrototypeOf(i)),E&&Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,t(i))},e.promisify.custom=E,e.callbackify=function(i){if("function"!=typeof i)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=[],a=0;a<arguments.length;a++)e.push(arguments[a]);var t=e.pop();if("function"!=typeof t)throw new TypeError("The last argument must be of type Function");var o=this,n=function(){return t.apply(o,arguments)};i.apply(this,e).then((function(i){process.nextTick(n,null,i)}),(function(i){process.nextTick(F,i,n)}))}return Object.setPrototypeOf(e,Object.getPrototypeOf(i)),Object.defineProperties(e,t(i)),e}},P7XM:function(i,e){i.exports="function"==typeof Object.create?function(i,e){i.super_=e,i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}})}:function(i,e){i.super_=e;var a=function(){};a.prototype=e.prototype,i.prototype=new a,i.prototype.constructor=i}},u8hb:function(i,e,a){"use strict";a.r(e),a.d(e,"AntimafiaModule",(function(){return Ne}));var t=a("ofXK"),o=a("tyNb"),n=a("4IZF"),c=a("fXoL");let r=(()=>{class i{constructor(){this.dichiarazioneAntimafia=new n.a}setDichiarazioneAntimafia(i){this.dichiarazioneAntimafia=i}setAzienda(i){this.dichiarazioneAntimafia.azienda=i}getDichiarazioneAntimafia(){return this.dichiarazioneAntimafia}getEnabled(){return this.enabled}getTitle(){return this.textTitle}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=c.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var s=a("69Tm");let l=(()=>{class i{constructor(){this.stepIndex=0}next(){this.stepIndex++}previous(){this.stepIndex--}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=c.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var d=a("1v+U"),b=a("wH++"),h=a("ggqT"),g=a("Upfa"),m=a("Tn7N"),u=a("5gIc"),p=a("eIep"),f=a("RtSl"),v=a("arS9"),S=a("A1Yd"),z=a("D0mR");function T(i,e){if(1&i){const i=c.Ub();c.Tb(0,"button",13),c.bc("click",(function(){return c.Ec(i),c.fc().indietro()})),c.Sb()}}function A(i,e){if(1&i){const i=c.Ub();c.Tb(0,"button",14),c.bc("debounceClick",(function(){return c.Ec(i),c.fc().aggiorna()})),c.Sb()}}function I(i,e){if(1&i){const i=c.Ub();c.Tb(0,"button",15),c.bc("debounceClick",(function(){return c.Ec(i),c.fc().cancella()})),c.Sb()}}function O(i,e){if(1&i){const i=c.Ub();c.Tb(0,"button",16),c.bc("debounceClick",(function(){return c.Ec(i),c.fc().procedi()})),c.Sb()}if(2&i){const i=c.fc();c.mc("disabled",!i.isProtocollaReady)}}function C(i,e){if(1&i){const i=c.Ub();c.Tb(0,"button",17),c.bc("debounceClick",(function(){return c.Ec(i),c.fc().procedi()})),c.Sb()}}function y(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",18),c.Ob(1,"i",19),c.Tb(2,"h3"),c.Oc(3),c.Sb(),c.Tb(4,"p"),c.Oc(5),c.Sb(),c.Sb(),c.Tb(6,"div",20),c.Tb(7,"div",1),c.Tb(8,"button",21),c.bc("click",(function(){return c.Ec(i),c.fc().onConfirmAggiornaDichiarazione()})),c.Sb(),c.Sb(),c.Tb(9,"div",1),c.Tb(10,"button",22),c.bc("click",(function(){return c.Ec(i),c.fc().onRejectAggiornaDichiarazione()})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit;c.Bb(3),c.Pc(i.summary),c.Bb(2),c.Pc(i.detail)}}function D(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",18),c.Ob(1,"i",19),c.Tb(2,"h3"),c.Oc(3),c.Sb(),c.Tb(4,"p"),c.Oc(5),c.Sb(),c.Sb(),c.Tb(6,"div",20),c.Tb(7,"div",1),c.Tb(8,"button",21),c.bc("click",(function(){return c.Ec(i),c.fc().onConfirmCancellaDichiarazione()})),c.Sb(),c.Sb(),c.Tb(9,"div",1),c.Tb(10,"button",22),c.bc("click",(function(){return c.Ec(i),c.fc().onRejectCancellaDichiarazione()})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit;c.Bb(3),c.Pc(i.summary),c.Bb(2),c.Pc(i.detail)}}let P=(()=>{class i{constructor(i,e,a,t,o,n,r){this.router=i,this.route=e,this.stepEvent=a,this.messages=t,this.dichiarazioneAntimafiaService=o,this.antimafiaService=n,this.loader=r,this.next=new c.n}ngOnInit(){this.loader.setTimeout(48e4)}procedi(){this.next.emit(!0)}goNext(){this.stepEvent.next()}indietro(){this.stepEvent.previous()}aggiorna(){this.messages.add({key:"aggiornaDichiarazione",sticky:!0,severity:"warn",summary:"Tutti i dettagli della dichiarazione saranno eliminati",detail:"Sei sicuro di voler continuare?"})}cancella(){this.messages.add({key:"cancellaDichiarazione",sticky:!0,severity:"warn",summary:"Tutti i dettagli della dichiarazione saranno eliminati",detail:"Sei sicuro di voler continuare?"})}onConfirmAggiornaDichiarazione(){const i=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia();this.antimafiaService.eliminaDichiarazioneAntimafia(i.id.toString()).pipe(Object(p.a)(e=>{const a=new n.a,t=new h.b;t.richiedente=new h.c,t.richiedente.codiceFiscale=i.datiDichiarazione.richiedente.codiceFiscale,a.datiDichiarazione=t;const o=new g.a;return o.cuaa=i.azienda.cuaa,a.azienda=o,this.antimafiaService.creaDichiarazioneAntimafia(a)})).subscribe(i=>{console.log("Dichiarazione cancellata: "+i),this.messages.clear("aggiornaDichiarazione"),this.router.navigate(["./"+i],{relativeTo:this.route.parent}).then(()=>location.reload())},i=>{console.log("Error",i),m.a.handleError(this.messages,i,m.a.SERVIZIO_NON_DISPONIBILE)})}onConfirmCancellaDichiarazione(){const i=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia();this.antimafiaService.eliminaDichiarazioneAntimafia(i.id.toString()).subscribe(i=>{console.log("Dichiarazione cancellata: "+i),this.router.navigate(["./"],{relativeTo:this.route.parent.parent})},i=>{console.log("Error",i),m.a.handleError(this.messages,i,m.a.SERVIZIO_NON_DISPONIBILE)})}onRejectAggiornaDichiarazione(){this.messages.clear("aggiornaDichiarazione")}onRejectCancellaDichiarazione(){this.messages.clear("cancellaDichiarazione")}ngOnDestroy(){this.loader.resetTimeout()}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(o.e),c.Nb(o.a),c.Nb(l),c.Nb(f.d),c.Nb(r),c.Nb(b.a),c.Nb(u.a))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-step-action"]],inputs:{isProtocollaReady:"isProtocollaReady"},outputs:{next:"next"},decls:16,vars:9,consts:[[1,"ui-g"],[1,"ui-g-6"],[1,"back-button"],["pButton","","label","INDIETRO","class","blue-grey-btn","icon","pi pi-chevron-circle-left","iconPos","left",3,"click",4,"ngIf"],[1,"ui-g-3"],["appDebounceClick","","pButton","","label","AGGIORNA","class","orange-btn","icon","ui-icon-edit",3,"debounceClick",4,"ngIf"],["appDebounceClick","","pButton","","label","CANCELLA","class","red-btn","icon","ui-icon-delete-forever",3,"debounceClick",4,"ngIf"],["appDebounceClick","","pButton","","label","PROTOCOLLA DOMANDA","icon","pi pi-chevron-circle-right","iconPos","right","style","float: right;",3,"disabled","debounceClick",4,"ngIf"],[1,"next-button"],["appDebounceClick","","pButton","","label","PROCEDI","icon","pi pi-chevron-circle-right","iconPos","right",3,"debounceClick",4,"ngIf"],["position","center","key","aggiornaDichiarazione",3,"modal","baseZIndex","onClose"],["pTemplate","message"],["position","center","key","cancellaDichiarazione",3,"modal","baseZIndex","onClose"],["pButton","","label","INDIETRO","icon","pi pi-chevron-circle-left","iconPos","left",1,"blue-grey-btn",3,"click"],["appDebounceClick","","pButton","","label","AGGIORNA","icon","ui-icon-edit",1,"orange-btn",3,"debounceClick"],["appDebounceClick","","pButton","","label","CANCELLA","icon","ui-icon-delete-forever",1,"red-btn",3,"debounceClick"],["appDebounceClick","","pButton","","label","PROTOCOLLA DOMANDA","icon","pi pi-chevron-circle-right","iconPos","right",2,"float","right",3,"disabled","debounceClick"],["appDebounceClick","","pButton","","label","PROCEDI","icon","pi pi-chevron-circle-right","iconPos","right",3,"debounceClick"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){1&i&&(c.Tb(0,"div",0),c.Tb(1,"div",1),c.Tb(2,"div",2),c.Mc(3,T,1,0,"button",3),c.Tb(4,"div",4),c.Mc(5,A,1,0,"button",5),c.Sb(),c.Tb(6,"div",4),c.Mc(7,I,1,0,"button",6),c.Sb(),c.Sb(),c.Sb(),c.Tb(8,"div",1),c.Mc(9,O,1,1,"button",7),c.Tb(10,"div",8),c.Mc(11,C,1,0,"button",9),c.Sb(),c.Sb(),c.Sb(),c.Tb(12,"p-toast",10),c.bc("onClose",(function(){return e.onRejectAggiornaDichiarazione()})),c.Mc(13,y,11,2,"ng-template",11),c.Sb(),c.Tb(14,"p-toast",12),c.bc("onClose",(function(){return e.onRejectCancellaDichiarazione()})),c.Mc(15,D,11,2,"ng-template",11),c.Sb()),2&i&&(c.Bb(3),c.mc("ngIf",e.stepEvent.stepIndex>0),c.Bb(2),c.mc("ngIf",0==e.stepEvent.stepIndex),c.Bb(2),c.mc("ngIf",0==e.stepEvent.stepIndex),c.Bb(2),c.mc("ngIf",6==e.stepEvent.stepIndex),c.Bb(2),c.mc("ngIf",e.stepEvent.stepIndex<6),c.Bb(1),c.mc("modal",!0)("baseZIndex",5e3),c.Bb(2),c.mc("modal",!0)("baseZIndex",5e3))},directives:[t.t,v.a,f.e,S.b,z.a],styles:[""]}),i})();var E=function(i){return i[i.OK=0]="OK",i[i.ERROR=1]="ERROR",i[i.WARNING=2]="WARNING",i}({}),F=function(i){return i[i.success=0]="success",i[i.error=1]="error",i[i.warn=2]="warn",i[i.info=3]="info",i}({});let R=(()=>{class i{static getToast(e,a,t){return{key:e,severity:F[a],summary:"Messaggio "+F[a],detail:t,life:i.TOAST_LIFE}}}return i.TOAST_LIFE=3e3,i.OPERAZIONE_OK="Operazione terminata con successo",i.ERRORE_DATI="Dati compilati non validi",i.CARICAMENTO="Caricamento in corso",i.ERRORE_RESPONSABILITA="Dati Responsabilit\xe0 Mancanti",i.ERRORE_PROFILO="Dati Profilo Mancanti",i.ERRORE_CARICAMENTO="Errore Caricamento dei file",i.RICHIEDENTE_ERR="nessun richiedente trovato",i.PROCEDIMENTI_ERR="Selezionare almeno un procedimento",i.IMPRESA_ERR="nessuna Impresa trovata",i.SOGGETTI_ERR="Nessun Soggetto Impresa",i.SOGGETTI_DT="Dichiarazione Direttore Tecnico Assente",i.FAMILIARI_CF_ERR="Codice Fiscale Non Conforme",i.FAMILIARI_ALLEGATI="Attenzione - allegato dichiarazione familiari conviventi mancante",i.MAX_SIZE_FILE=15,i.FILE_EXTENSION_ACCEPTED=".pdf,.p7m",i})(),B=(()=>{class i{constructor(){}validaProcedimenti(i){const e={esito:E.OK};return i&&0!==i.length||(e.esito=E.ERROR,e.messaggio=R.PROCEDIMENTI_ERR),e}validaRichiedente(i){const e={esito:E.OK};return null==i?(e.esito=E.ERROR,e.messaggio=R.RICHIEDENTE_ERR,e):e}validaImpresa(i){const e={esito:E.OK};return null==i?(e.esito=E.ERROR,e.messaggio=R.IMPRESA_ERR,e):e}validaSoggettiCarica(i){const e={esito:E.OK},a=i.datiDichiarazione.dettaglioImpresa;if(a.soggettiImpresa&&0!==a.soggettiImpresa.length||(e.esito=E.ERROR,e.messaggio=R.SOGGETTI_ERR),"DI"===a.formaGiuridicaCodice){const t=a.soggettiImpresa.some(i=>i.carica.some(i=>"DT"===i.codice)),o=i.assenzaDt;if(!t&&!o)return e.esito=E.ERROR,e.messaggio=m.a.DT_ASSENTE,e}return e}validaAziendeCollegate(i){return{esito:E.OK}}validaFamiliariConviventiCheckDichiarazione(i,e){const a={esito:E.OK};if(null===i||0===i.length)return a.esito=E.ERROR,a.messaggio=R.SOGGETTI_ERR,a;const t=i.filter(i=>i.carica.some(i=>!0===i.selezionato));return 0===t.length?(a.esito=E.ERROR,a.messaggio=m.a.FAMILIARI_DIC,a):(t.forEach(i=>{if((void 0===i.familiariConviventi||null==i.familiariConviventi||0===i.familiariConviventi.length)&&!i.carica.some(i=>!0===i.dichiarazione))return a.esito=E.ERROR,a.messaggio=e?m.a.FAMILIARI_ERR_SPUNTA:m.a.FAMILIARI_ERR(i.codiceFiscale),a}),a)}validaFamiliariConviventiInserimentoCF(i){const e={esito:E.OK};if(null===i||0===i.length)return e.esito=E.ERROR,e.messaggio=R.SOGGETTI_ERR,e;let a=i.find(i=>!!i.familiariConviventi&&i.familiariConviventi.some(i=>null==i.codiceFiscale));return a?(e.esito=E.ERROR,e.messaggio=m.a.FAMILIARI_CF_ASSENTE(a.codiceFiscale),e):e}validaFamiliariConviventiGradoDiParentela(i){const e={esito:E.OK};if(null===i||0===i.length)return e.esito=E.ERROR,e.messaggio=R.SOGGETTI_ERR,e;let a=i.find(i=>!!i.familiariConviventi&&i.familiariConviventi.some(i=>null==i.gradoParentela));return a?(e.esito=E.ERROR,e.messaggio=m.a.FAMILIARI_PARENT(a.codiceFiscale),e):e}validaFamiliariConviventiMaggiorenni(i,e){const a={esito:E.OK};if(null==i)return a.esito=E.ERROR,a;const t=new Date;return Date.parse(t.toDateString())-Number(i)<5679936e5?(a.esito=E.ERROR,a.messaggio=m.a.FAMILIARI_MAGGIO(e),a):a}validaFamiliariConviventiAllegati(i){const e={esito:E.OK};return null===i||0===i.length?(e.esito=E.ERROR,e.messaggio=R.SOGGETTI_ERR,e):(i.filter(i=>i.carica.some(i=>!0===i.selezionato)).forEach(i=>{i.carica.filter(i=>i.selezionato).forEach(a=>{if(!a.href)return e.esito=E.ERROR,e.messaggio=m.a.ALLEGATO_MANCANTE(i.codiceFiscale),e})}),e)}validaVerificaDichiarazioneAllegata(i){const e={esito:E.OK};return null==i?(e.esito=E.ERROR,e.messaggio=m.a.DICHIARAZIONE_MANCANTE,e):e}validaAllegatoSize(i){const e={esito:E.OK};return m.a.UPLOAD_FILE_MAX_SIZE_FILE<0||Math.round(i.size/1024e3*100)/100>m.a.UPLOAD_FILE_MAX_SIZE_FILE&&(e.esito=E.ERROR,e.messaggio=m.a.FILE_MAXSIZE(m.a.UPLOAD_FILE_MAX_SIZE_FILE)),e}validaAllegatoType(i,e){const a={esito:E.OK};if(void 0!==i.name)return!e||i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDFP7M)||i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDF)?(e||i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDF)||(a.esito=E.ERROR,a.messaggio=m.a.FILE_TYPE(m.a.UPLOAD_FILE_TYPE_PDF)),a):(a.esito=E.ERROR,a.messaggio=m.a.FILE_TYPE(m.a.UPLOAD_FILE_TYPE_PDF+" oppure "+m.a.UPLOAD_FILE_TYPE_PDFP7M),a)}validaVerificaInformativaPrivacy(i,e){const a={esito:E.OK};return!i||i.length>1?(a.esito=E.ERROR,a.messaggio=m.a.ERRORE_GENERICO):0!=i.length&&i[0].nrProtocolloPrivacyGenerale||(a.esito=E.ERROR,a.messaggio=m.a.INFORMATIVA_PRIVACY_ASSENTE(e)),a}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=c.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var N=a("3Pt+"),M=a("R5y+"),w=a("sYmb");const x=function(){return{marginTop:"70px"}};let _=(()=>{class i{constructor(i,e,a,t){this.validator=i,this.messageService=e,this.dichiarazioneAntimafiaService=a,this.antimafiaService=t}ngOnInit(){this.dichirazioneAntimafia=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia(),this.antimafiaService.recuperaProcedimenti(this.dichirazioneAntimafia.id).subscribe(i=>{this.dichirazioneAntimafia.procedimenti=i})}conferma(i){console.log("userForm.dirty: ",i.dirty);const e=this.validator.validaProcedimenti(this.dichirazioneAntimafia.procedimenti);e.esito!==E.ERROR?(i.dirty&&this.antimafiaService.inserisciProcedimenti(this.dichirazioneAntimafia.id,this.dichirazioneAntimafia.procedimenti).subscribe(),this.stepComponent.goNext()):this.messageService.add(m.a.getToast("errorAssenzaProcedimento",m.b.error,e.messaggio))}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(B),c.Nb(f.d),c.Nb(r),c.Nb(b.a))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-procedimenti"]],viewQuery:function(i,e){var a;1&i&&c.Jc(P,!0),2&i&&c.Ac(a=c.cc())&&(e.stepComponent=a.first)},decls:20,vars:19,consts:[[1,"boxgrey"],[1,"ui-g"],["userForm","ngForm"],[1,"ui-g-12"],["name","groupProcedimenti","value","DU",3,"label","ngModel","ngModelChange"],["name","groupProcedimenti","value","PSR_SUPERFICIE",3,"label","ngModel","ngModelChange"],["name","groupProcedimenti","value","PSR_INVESTIMENTO",3,"label","ngModel","ngModelChange"],["name","groupProcedimenti","value","PAI",3,"label","ngModel","ngModelChange"],[3,"next"],["key","errorAssenzaProcedimento"]],template:function(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",0),c.Tb(1,"h3"),c.Oc(2," Procedimenti "),c.Sb(),c.Tb(3,"div",1),c.Tb(4,"form",null,2),c.Tb(6,"div",3),c.Tb(7,"p-checkbox",4),c.bc("ngModelChange",(function(i){return e.dichirazioneAntimafia.procedimenti=i})),c.gc(8,"translate"),c.Sb(),c.Sb(),c.Tb(9,"div",3),c.Tb(10,"p-checkbox",5),c.bc("ngModelChange",(function(i){return e.dichirazioneAntimafia.procedimenti=i})),c.gc(11,"translate"),c.Sb(),c.Sb(),c.Tb(12,"div",3),c.Tb(13,"p-checkbox",6),c.bc("ngModelChange",(function(i){return e.dichirazioneAntimafia.procedimenti=i})),c.gc(14,"translate"),c.Sb(),c.Sb(),c.Tb(15,"div",3),c.Tb(16,"p-checkbox",7),c.bc("ngModelChange",(function(i){return e.dichirazioneAntimafia.procedimenti=i})),c.gc(17,"translate"),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Tb(18,"app-step-action",8),c.bc("next",(function(){c.Ec(i);const a=c.Bc(5);return e.conferma(a)})),c.Sb(),c.Ob(19,"p-toast",9)}2&i&&(c.Bb(7),c.nc("label",c.hc(8,10,"DICH_AMF.DU")),c.mc("ngModel",e.dichirazioneAntimafia.procedimenti),c.Bb(3),c.nc("label",c.hc(11,12,"DICH_AMF.PSR_SUPERFICIE")),c.mc("ngModel",e.dichirazioneAntimafia.procedimenti),c.Bb(3),c.nc("label",c.hc(14,14,"DICH_AMF.PSR_INVESTIMENTO")),c.mc("ngModel",e.dichirazioneAntimafia.procedimenti),c.Bb(3),c.nc("label",c.hc(17,16,"DICH_AMF.PAI")),c.mc("ngModel",e.dichirazioneAntimafia.procedimenti),c.Bb(3),c.Kc(c.rc(18,x)))},directives:[N.I,N.t,N.u,M.a,N.s,N.v,P,v.a],pipes:[w.d],encapsulation:2}),i})();class U{constructor(i,e){this.mkey=i,this.mvalue=e}}var k=a("MCLT");class L{static setInizioCarica(i,e){i.forEach(i=>i.carica.forEach(i=>i.dataInizio?i.dataInizio:i.dataInizio=e))}static isImpresaDittaIndividuale(i){return"DI"===i}static setAllNullValuesToND(i){Object.keys(i).forEach(e=>{Object(k.isObject)(i[e])?this.setAllNullValuesToND(i[e]):i[e]||(i[e]=s.a.nd)})}static isObject(i){return console.log("is object : "+i),"object"==typeof i}static soggettiAppiattito(i){let e=i.map(i=>Object.assign({},i));const a=[];return e.forEach(i=>{i.carica.forEach(e=>{const t=Object.assign({},i);t.carica=[e],a.push(t)})}),a}}let j=(()=>{class i{constructor(i,e){this.dichiarazioneAntimafiaService=i,this.validator=e,this.labels=s.a,this.values=[new U("1","RLR")],this.select=new c.n}ngOnInit(){this.richiedente=this.getDati(this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia()),this.textTitle=s.a.datiAcquisiti,L.setAllNullValuesToND(this.richiedente)}selectItem(i){this.select.emit(i)}getDati(i){let e;return null!=i&&(console.log("dichiarazioneDettagli 1 "),e=i.datiDichiarazione),e.richiedente}conferma(){const i=this.validator.validaRichiedente(this.richiedente);i.esito===E.OK?(console.log("richiedente next"),this.stepComponent.goNext()):alert(i.messaggio)}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(r),c.Nb(B))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-richiedente"]],viewQuery:function(i,e){var a;1&i&&c.Jc(P,!0),2&i&&c.Ac(a=c.cc())&&(e.stepComponent=a.first)},outputs:{select:"select"},decls:65,vars:25,consts:[[1,"boxgrey"],[1,"ui-g"],[1,"ui-g-3","box-padded"],[3,"next"]],template:function(i,e){1&i&&(c.Tb(0,"div",0),c.Tb(1,"h3"),c.Oc(2),c.Sb(),c.Tb(3,"div",1),c.Tb(4,"div",2),c.Tb(5,"strong"),c.Oc(6),c.Sb(),c.Sb(),c.Tb(7,"div",2),c.Oc(8),c.Sb(),c.Tb(9,"div",2),c.Tb(10,"strong"),c.Oc(11),c.Sb(),c.Sb(),c.Tb(12,"div",2),c.Oc(13),c.Sb(),c.Tb(14,"div",2),c.Tb(15,"strong"),c.Oc(16),c.Sb(),c.Sb(),c.Tb(17,"div",2),c.Oc(18),c.Sb(),c.Tb(19,"div",2),c.Tb(20,"strong"),c.Oc(21),c.Sb(),c.Sb(),c.Tb(22,"div",2),c.Oc(23),c.Sb(),c.Tb(24,"div",2),c.Tb(25,"strong"),c.Oc(26),c.Sb(),c.Sb(),c.Tb(27,"div",2),c.Oc(28),c.Sb(),c.Tb(29,"div",2),c.Tb(30,"strong"),c.Oc(31),c.Sb(),c.Sb(),c.Tb(32,"div",2),c.Oc(33),c.Sb(),c.Tb(34,"div",2),c.Tb(35,"strong"),c.Oc(36),c.Sb(),c.Sb(),c.Tb(37,"div",2),c.Oc(38),c.Sb(),c.Tb(39,"div",2),c.Tb(40,"strong"),c.Oc(41),c.Sb(),c.Sb(),c.Tb(42,"div",2),c.Oc(43),c.Sb(),c.Tb(44,"div",2),c.Tb(45,"strong"),c.Oc(46),c.Sb(),c.Sb(),c.Tb(47,"div",2),c.Oc(48),c.Sb(),c.Tb(49,"div",2),c.Tb(50,"strong"),c.Oc(51),c.Sb(),c.Sb(),c.Tb(52,"div",2),c.Oc(53),c.Sb(),c.Tb(54,"div",2),c.Tb(55,"strong"),c.Oc(56),c.Sb(),c.Sb(),c.Tb(57,"div",2),c.Oc(58),c.Sb(),c.Tb(59,"div",2),c.Tb(60,"strong"),c.Oc(61),c.Sb(),c.Sb(),c.Tb(62,"div",2),c.Oc(63),c.Sb(),c.Sb(),c.Sb(),c.Tb(64,"app-step-action",3),c.bc("next",(function(){return e.conferma()})),c.Sb()),2&i&&(c.Bb(2),c.Qc(" ",e.textTitle," "),c.Bb(4),c.Pc(e.labels.cognome),c.Bb(2),c.Qc(" ",e.richiedente.cognome," "),c.Bb(3),c.Pc(e.labels.sesso),c.Bb(2),c.Qc(" ",e.richiedente.sesso," "),c.Bb(3),c.Pc(e.labels.nome),c.Bb(2),c.Qc(" ",e.richiedente.nome," "),c.Bb(3),c.Pc(e.labels.residenza),c.Bb(2),c.Qc(" ",e.richiedente.residenza.indirizzo," "),c.Bb(3),c.Pc(e.labels.codiceFiscale),c.Bb(2),c.Qc(" ",e.richiedente.codiceFiscale," "),c.Bb(3),c.Pc(e.labels.residenzaComune),c.Bb(2),c.Qc(" ",e.richiedente.residenza.comune," "),c.Bb(3),c.Pc(e.labels.dataNascita),c.Bb(2),c.Qc(" ",e.richiedente.dataNascita," "),c.Bb(3),c.Pc(e.labels.residenzaCAP),c.Bb(2),c.Qc(" ",e.richiedente.residenza.CAP," "),c.Bb(3),c.Pc(e.labels.comuneNascita),c.Bb(2),c.Qc(" ",e.richiedente.comuneNascita," "),c.Bb(3),c.Pc(e.labels.residenzaProvincia),c.Bb(2),c.Qc(" ",e.richiedente.residenza.provincia," "),c.Bb(3),c.Pc(e.labels.provinciaNascita),c.Bb(2),c.Qc(" ",e.richiedente.provinciaNascita," "),c.Bb(3),c.Pc(e.labels.carica),c.Bb(2),c.Qc(" ",e.richiedente.carica," "))},directives:[P],styles:[""]}),i})();var G=a("KDHY"),K=a("xpYo");function V(i,e){if(1&i&&(c.Tb(0,"div",6),c.Tb(1,"p-fieldset",7),c.Tb(2,"p-inplace",8),c.Tb(3,"span",9),c.Ob(4,"span",10),c.Tb(5,"span",11),c.Oc(6),c.gc(7,"slice"),c.Sb(),c.Sb(),c.Tb(8,"span",12),c.Oc(9),c.Sb(),c.Sb(),c.Sb(),c.Sb()),2&i){const i=c.fc();c.Bb(1),c.nc("legend",i.labels.oggettoSociale),c.Bb(1),c.mc("closable",!0),c.Bb(4),c.Qc(" ",c.jc(7,4,i.dettaglioImpresa.oggettoSociale,0,350)," ... ... ... "),c.Bb(3),c.Qc(" ",i.dettaglioImpresa.oggettoSociale?i.dettaglioImpresa.oggettoSociale:i.labels.nd," ")}}function Z(i,e){if(1&i&&(c.Tb(0,"div",1),c.Tb(1,"div",2),c.Tb(2,"strong"),c.Oc(3),c.Sb(),c.Sb(),c.Tb(4,"div",2),c.Oc(5),c.Sb(),c.Sb()),2&i){const i=c.fc();c.Bb(3),c.Pc(i.labels.oggettoSociale),c.Bb(2),c.Qc(" ",i.labels.nd," ")}}let Q=(()=>{class i{constructor(i,e){this.dichiarazioneAntimafiaService=i,this.validator=e,this.labels=s.a}ngOnInit(){this.dettaglioImpresa=this.getAnagraficaImpresa(this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia()),this.textTitle=s.a.datiAcquisiti}getAnagraficaImpresa(i){let e;return null!=i?(e=e=i.datiDichiarazione,e.dettaglioImpresa):null}conferma(){const i=this.validator.validaImpresa(this.dettaglioImpresa);i.esito===E.OK?(console.log("impresa next"),this.stepComponent.goNext()):alert(i.messaggio)}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(r),c.Nb(B))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-impresa"]],viewQuery:function(i,e){var a;1&i&&c.Jc(P,!0),2&i&&c.Ac(a=c.cc())&&(e.stepComponent=a.first)},decls:67,vars:27,consts:[[1,"boxgrey"],[1,"ui-g"],[1,"ui-g-3","box-padded"],["class","ui-g-12",4,"ngIf"],["class","ui-g",4,"ngIf"],[3,"next"],[1,"ui-g-12"],[3,"legend"],[3,"closable"],["pInplaceDisplay",""],[1,"fa","fa-table"],[2,"margin-left","8px"],["pInplaceContent",""]],template:function(i,e){1&i&&(c.Tb(0,"div",0),c.Tb(1,"h3"),c.Oc(2),c.Sb(),c.Tb(3,"div",1),c.Tb(4,"div",2),c.Tb(5,"strong"),c.Oc(6),c.Sb(),c.Sb(),c.Tb(7,"div",2),c.Oc(8),c.Sb(),c.Tb(9,"div",2),c.Tb(10,"strong"),c.Oc(11),c.Sb(),c.Sb(),c.Tb(12,"div",2),c.Oc(13),c.Sb(),c.Tb(14,"div",2),c.Tb(15,"strong"),c.Oc(16),c.Sb(),c.Sb(),c.Tb(17,"div",2),c.Oc(18),c.Sb(),c.Tb(19,"div",2),c.Tb(20,"strong"),c.Oc(21),c.Sb(),c.Sb(),c.Tb(22,"div",2),c.Oc(23),c.Sb(),c.Tb(24,"div",2),c.Tb(25,"strong"),c.Oc(26),c.Sb(),c.Sb(),c.Tb(27,"div",2),c.Oc(28),c.Sb(),c.Tb(29,"div",2),c.Tb(30,"strong"),c.Oc(31),c.Sb(),c.Sb(),c.Tb(32,"div",2),c.Oc(33),c.Sb(),c.Tb(34,"div",2),c.Tb(35,"strong"),c.Oc(36),c.Sb(),c.Sb(),c.Tb(37,"div",2),c.Oc(38),c.Sb(),c.Tb(39,"div",2),c.Tb(40,"strong"),c.Oc(41),c.Sb(),c.Sb(),c.Tb(42,"div",2),c.Oc(43),c.Sb(),c.Tb(44,"div",2),c.Tb(45,"strong"),c.Oc(46),c.Sb(),c.Sb(),c.Tb(47,"div",2),c.Oc(48),c.Sb(),c.Tb(49,"div",2),c.Tb(50,"strong"),c.Oc(51),c.Sb(),c.Sb(),c.Tb(52,"div",2),c.Oc(53),c.Sb(),c.Tb(54,"div",2),c.Tb(55,"strong"),c.Oc(56),c.Sb(),c.Sb(),c.Tb(57,"div",2),c.Oc(58),c.Sb(),c.Tb(59,"div",2),c.Tb(60,"strong"),c.Oc(61),c.Sb(),c.Sb(),c.Tb(62,"div",2),c.Oc(63),c.Sb(),c.Mc(64,V,10,8,"div",3),c.Sb(),c.Mc(65,Z,6,2,"div",4),c.Sb(),c.Tb(66,"app-step-action",5),c.bc("next",(function(){return e.conferma()})),c.Sb()),2&i&&(c.Bb(2),c.Qc(" ",e.textTitle," "),c.Bb(4),c.Pc(e.labels.descrizioneImpresa),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.denominazione?e.dettaglioImpresa.denominazione:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.CCIAAnumeroIscrizione),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.estremiCCIAA.numeroIscrizione?e.dettaglioImpresa.estremiCCIAA.numeroIscrizione:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.provinciaImpresa),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.estremiCCIAA.sede?e.dettaglioImpresa.estremiCCIAA.sede:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.CCIAAdataIscrizione),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.estremiCCIAA.dataIscrizione?e.dettaglioImpresa.estremiCCIAA.dataIscrizione:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.sedeLegale),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.sedeLegale?e.dettaglioImpresa.sedeLegale:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.formaGiuridica),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.dettaglioPersonaGiuridica.formaGiuridica?e.dettaglioImpresa.dettaglioPersonaGiuridica.formaGiuridica:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.estremiCostituzione),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.estremiCCIAA.dataIscrizione?e.dettaglioImpresa.estremiCCIAA.dataIscrizione:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.capitaleSociale),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.dettaglioPersonaGiuridica.capitaleSociale?e.dettaglioImpresa.dettaglioPersonaGiuridica.capitaleSociale:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.durataSocieta),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.dettaglioPersonaGiuridica.durata?e.dettaglioImpresa.dettaglioPersonaGiuridica.durata:e.labels.illimitata," "),c.Bb(3),c.Pc(e.labels.codiceFiscale),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.codiceFiscale?e.dettaglioImpresa.codiceFiscale:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.partitaIva),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.partitaIva?e.dettaglioImpresa.partitaIva:e.labels.nd," "),c.Bb(3),c.Pc(e.labels.indirizzoPEC),c.Bb(2),c.Qc(" ",e.dettaglioImpresa.indirizzoPEC?e.dettaglioImpresa.indirizzoPEC:e.labels.nd," "),c.Bb(1),c.mc("ngIf",e.dettaglioImpresa.oggettoSociale),c.Bb(1),c.mc("ngIf",!e.dettaglioImpresa.oggettoSociale))},directives:[t.t,P,G.a,K.a],pipes:[t.E],styles:["body .ui-fieldset .ui-fieldset-legend .ui-fieldset-legend-text{color:#000}"],encapsulation:2}),i})();var H=a("yWug");function $(i,e){if(1&i&&(c.Tb(0,"th",8),c.Oc(1),c.Ob(2,"p-sortIcon",9),c.Sb()),2&i){const i=e.$implicit;c.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),c.Bb(1),c.Qc(" ",i.header," "),c.Bb(1),c.mc("field",i.field)}}function W(i,e){if(1&i&&(c.Tb(0,"tr"),c.Mc(1,$,3,4,"th",7),c.Sb()),2&i){const i=e.$implicit;c.Bb(1),c.mc("ngForOf",i)}}function J(i,e){if(1&i&&(c.Tb(0,"tr"),c.Tb(1,"td"),c.Oc(2),c.Sb(),c.Tb(3,"td"),c.Oc(4),c.Sb(),c.Tb(5,"td"),c.Oc(6),c.Sb(),c.Tb(7,"td"),c.Oc(8),c.Sb(),c.Tb(9,"td"),c.Oc(10),c.Sb(),c.Tb(11,"td"),c.Oc(12),c.Sb(),c.Tb(13,"td"),c.Oc(14),c.Sb(),c.Tb(15,"td"),c.Oc(16),c.Sb(),c.Tb(17,"td"),c.Oc(18),c.Sb(),c.Tb(19,"td"),c.Oc(20),c.Sb(),c.Tb(21,"td"),c.Oc(22),c.Sb(),c.Tb(23,"td"),c.Oc(24),c.Sb(),c.Tb(25,"td"),c.Oc(26),c.Sb(),c.Tb(27,"td"),c.Oc(28),c.Sb(),c.Sb()),2&i){const i=e.$implicit,a=c.fc();c.Bb(2),c.Pc(i.cognome?i.cognome:a.labels.nd),c.Bb(2),c.Pc(i.nome?i.nome:a.labels.nd),c.Bb(2),c.Qc(" ",i.codiceFiscale?i.codiceFiscale:a.labels.nd," "),c.Bb(2),c.Pc(i.dataNascita?i.dataNascita:a.labels.nd),c.Bb(2),c.Qc(" ",i.comuneNascita?i.comuneNascita:a.labels.nd," "),c.Bb(2),c.Qc(" ",i.provinciaNascita?i.provinciaNascita:a.labels.nd," "),c.Bb(2),c.Pc(i.sesso?i.sesso:a.labels.nd),c.Bb(2),c.Qc(" ",i.comuneResidenza?i.comuneResidenza:a.labels.nd," "),c.Bb(2),c.Qc(" ",i.indirizzoResidenza?i.indirizzoResidenza:a.labels.nd," "),c.Bb(2),c.Qc(" ",i.provinciaResidenza?i.provinciaResidenza:a.labels.nd," "),c.Bb(2),c.Pc(i.capResidenza?i.capResidenza:a.labels.nd),c.Bb(2),c.Qc(" ",i.carica[0].tipologia?i.carica[0].tipologia:a.labels.nd," "),c.Bb(2),c.Qc(" ",i.carica[0].dataInizio?i.carica[0].dataInizio:a.labels.nd," "),c.Bb(2),c.Qc(" ",i.carica[0].dataFine?i.carica[0].dataFine:"Illimitata"," ")}}function Y(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",10),c.Tb(1,"div",11),c.Tb(2,"p-checkbox",12),c.bc("ngModelChange",(function(e){return c.Ec(i),c.fc().hasDirettoreTecnicoValue=e})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=c.fc();c.Bb(2),c.mc("disabled",i.hasDirettoreTecnicoNominato)("ngModel",i.hasDirettoreTecnicoValue)}}const q=function(){return{marginTop:"70px"}};let X=(()=>{class i{constructor(i,e,a,t,o){this.dichiarazioneAntimafiaService=i,this.antimafiaService=e,this.validator=a,this.messageService=t,this.loader=o,this.intestazioni=s.a,this.labels=s.a}ngOnInit(){this.loader.setTimeout(48e4),this.dichiarazioneAntimafia=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia(),this.listaSoggetti=this.popolaDati(this.dichiarazioneAntimafia),this.listaSoggettiTabella=this.isImpresaDittaIndividuale()?this.popolaSoggettiImportanti(this.listaSoggetti,this.dichiarazioneAntimafia.datiDichiarazione.richiedente):this.popolaSoggettiAltri(this.listaSoggetti),L.setInizioCarica(this.listaSoggettiTabella,this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.estremiCCIAA.dataIscrizione),this.hasDirettoreTecnicoNominato=this.checkDirettoreTecnicoNominato(this.listaSoggetti),this.hasDirettoreTecnicoValue=this.dichiarazioneAntimafia.assenzaDt,this.textTitle=s.a.datiAcquisitiTrib,this.cols=[{field:"cognome",header:this.intestazioni.cognome},{field:"nome",header:this.intestazioni.nome},{field:"codiceFiscale",header:this.intestazioni.codiceFiscale},{field:"dataNascita",header:this.intestazioni.dataNascita},{field:"comuneNascita",header:this.intestazioni.comuneNascita},{field:"provinciaNascita",header:this.intestazioni.provinciaNascita},{field:"sesso",header:this.intestazioni.sesso},{field:null,header:this.intestazioni.residenzaComune},{field:null,header:this.intestazioni.residenzaVia},{field:null,header:this.intestazioni.residenzaProvincia},{field:null,header:this.intestazioni.residenzaCAP},{field:null,header:this.intestazioni.carica},{field:null,header:this.intestazioni.dataInizioCarica},{field:null,header:this.intestazioni.dataFineCarica}]}isImpresaDittaIndividuale(){return"DI"===this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.formaGiuridicaCodice}conferma(){this.dichiarazioneAntimafia.assenzaDt=this.hasDirettoreTecnicoValue;const i=this.validator.validaSoggettiCarica(this.dichiarazioneAntimafia);if(i.esito===E.ERROR)return this.msgErrore=i.messaggio,void this.messageService.add(m.a.getToast("errorAssenzaDt",m.b.error,this.msgErrore));console.log("Inzio PUT"),console.log(this.dichiarazioneAntimafia),this.isImpresaDittaIndividuale()?this.antimafiaService.aggiornaDichiarazioneAntimafia(this.dichiarazioneAntimafia).subscribe(i=>{console.log("Modifica alla dichiarazione "+i.dichiarazione.id+" avvenuta con successo"),null!=i.esito&&m.a.getToast("generico",m.b.error,i.esito)},i=>{let e="Errore in aggiornaDichiarazioneAntimafia: "+i;console.error(e),m.a.getToast("generico",m.b.error,e)},()=>this.stepComponent.goNext()):this.stepComponent.goNext()}checkDirettoreTecnicoNominato(i){return i.some(i=>i.carica.some(i=>"DT"===i.codice))}popolaSoggettiAltri(i){return L.soggettiAppiattito(i)}popolaSoggettiImportanti(i,e){return i.forEach(i=>(i.carica=i.carica.filter(i=>i.codice.match("DT|TIT|TI")),i)),i.filter(i=>i.carica.length>0)}popolaDati(i){let e;return null==i?(console.log("dichiarazioneDettagli assente "),[]):(e=i.datiDichiarazione,null!=e.dettaglioImpresa.soggettiImpresa?e.dettaglioImpresa.soggettiImpresa:[])}ngOnDestroy(){this.loader.resetTimeout()}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(r),c.Nb(b.a),c.Nb(B),c.Nb(f.d),c.Nb(u.a))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-soggetti"]],viewQuery:function(i,e){var a;1&i&&c.Jc(P,!0),2&i&&c.Ac(a=c.cc())&&(e.stepComponent=a.first)},decls:9,vars:11,consts:[[1,"boxgrey"],["dataKey","cognome",3,"columns","value","autoLayout","paginator","rows","responsive"],["pTemplate","header"],["pTemplate","body"],["class","ui-g",4,"ngIf"],[3,"next"],["key","errorAssenzaDt"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[1,"ui-g"],[1,"ui-g-12"],["binary","true","label","Dichiaro che NON \xe8 stato nominato il Direttore Tecnico",3,"disabled","ngModel","ngModelChange"]],template:function(i,e){1&i&&(c.Tb(0,"div",0),c.Tb(1,"h3"),c.Oc(2),c.Sb(),c.Tb(3,"p-table",1),c.Mc(4,W,2,1,"ng-template",2),c.Mc(5,J,29,14,"ng-template",3),c.Sb(),c.Mc(6,Y,3,2,"div",4),c.Sb(),c.Tb(7,"app-step-action",5),c.bc("next",(function(){return e.conferma()})),c.Sb(),c.Ob(8,"p-toast",6)),2&i&&(c.Bb(2),c.Pc(e.textTitle),c.Bb(1),c.mc("columns",e.cols)("value",e.listaSoggettiTabella)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0),c.Bb(3),c.mc("ngIf",!e.hasDirettoreTecnicoNominato&&e.isImpresaDittaIndividuale()),c.Bb(2),c.Kc(c.rc(10,q)))},directives:[H.q,f.e,t.t,P,v.a,t.s,H.p,H.o,M.a,N.s,N.v],styles:[""]}),i})();function ii(i,e){if(1&i&&(c.Tb(0,"th",11),c.Oc(1),c.Ob(2,"p-sortIcon",12),c.Sb()),2&i){const i=e.$implicit;c.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),c.Bb(1),c.Qc(" ",i.header," "),c.Bb(1),c.mc("field",i.field)}}function ei(i,e){if(1&i&&(c.Tb(0,"tr"),c.Mc(1,ii,3,4,"th",10),c.Sb()),2&i){const i=e.$implicit;c.Bb(1),c.mc("ngForOf",i)}}function ai(i,e){if(1&i){const i=c.Ub();c.Tb(0,"tr"),c.Tb(1,"td"),c.Oc(2),c.Sb(),c.Tb(3,"td"),c.Oc(4),c.Sb(),c.Tb(5,"td"),c.Oc(6),c.Sb(),c.Tb(7,"td"),c.Oc(8),c.Sb(),c.Tb(9,"td"),c.Oc(10),c.Sb(),c.Tb(11,"td"),c.Oc(12),c.Sb(),c.Tb(13,"td"),c.Oc(14),c.Sb(),c.Tb(15,"td"),c.Oc(16),c.Sb(),c.Tb(17,"td"),c.Oc(18),c.Sb(),c.Tb(19,"td"),c.Oc(20),c.Sb(),c.Tb(21,"td"),c.Tb(22,"p-checkbox",13,14),c.bc("ngModelChange",(function(a){return c.Ec(i),e.$implicit.selezionato=a})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit,a=c.fc(2);c.Bb(2),c.Pc(i.denominazione?i.denominazione:a.intestazioni.nd),c.Bb(2),c.Pc(i.codiceFiscale?i.codiceFiscale:a.intestazioni.nd),c.Bb(2),c.Pc(i.comuneSede?i.comuneSede:a.intestazioni.nd),c.Bb(2),c.Pc(i.indirizzoSede?i.indirizzoSede:a.intestazioni.nd),c.Bb(2),c.Pc(i.civicoSede?i.civicoSede:a.intestazioni.nd),c.Bb(2),c.Pc(i.provinciaSede?i.provinciaSede:a.intestazioni.nd),c.Bb(2),c.Pc(i.capSede?i.capSede:a.intestazioni.nd),c.Bb(2),c.Pc(i.carica[0].tipologia?i.carica[0].tipologia:a.intestazioni.nessunaCarica),c.Bb(2),c.Pc(i.carica[0].dataInizio?i.carica[0].dataInizio:a.intestazioni.nd),c.Bb(2),c.Pc(i.carica[0].dataFine?i.carica[0].dataFine:a.intestazioni.illimitata),c.Bb(2),c.mc("ngModel",i.selezionato)}}function ti(i,e){1&i&&(c.Tb(0,"tr"),c.Tb(1,"td"),c.Oc(2," Nessuna Azienda Collegata "),c.Sb(),c.Sb()),2&i&&(c.Bb(1),c.Cb("colspan",11))}function oi(i,e){if(1&i&&(c.Tb(0,"div",3),c.Tb(1,"h3",4),c.Oc(2),c.Tb(3,"span"),c.Tb(4,"a",5),c.Oc(5," ? "),c.Sb(),c.Sb(),c.Sb(),c.Tb(6,"p-table",6),c.Mc(7,ei,2,1,"ng-template",7),c.Mc(8,ai,24,11,"ng-template",8),c.Mc(9,ti,3,1,"ng-template",9),c.Sb(),c.Sb()),2&i){const i=c.fc();c.Bb(2),c.Qc("",i.textTitle," "),c.Bb(4),c.mc("columns",i.cols)("value",i.aziendeCollegate)("autoLayout",!0)("responsive",!0)}}function ni(i,e){1&i&&(c.Tb(0,"div",15),c.Tb(1,"h5"),c.Oc(2," Informazioni disponibili solo per aziende "),c.Sb(),c.Sb())}let ci=(()=>{class i{constructor(i,e,a,t){this.dichiarazioneAntimafiaService=i,this.antimafiaService=e,this.messages=a,this.validator=t,this.intestazioni=s.a,this.loading=!1,this.aziendeCollegate=[]}ngOnInit(){this.dichiarazioneAntimafia=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia(),this.isImpresaDittaIndividuale()||(this.aziendeCollegate=this.popolaDati(this.dichiarazioneAntimafia)),console.log(this.aziendeCollegate),this.textTitle=s.a.datiAcquisiti,this.cols=[{field:"denominazione",header:this.intestazioni.denominazione},{field:"codiceFiscale",header:this.intestazioni.codiceFiscale},{field:"comuneSede",header:this.intestazioni.comune},{field:"indirizzoSede",header:this.intestazioni.indirizzo},{field:"civicoSede",header:this.intestazioni.civico},{field:"provinciaSede",header:this.intestazioni.provinciaSigla},{field:"capSede",header:this.intestazioni.cap},{field:null,header:this.intestazioni.carica},{field:null,header:this.intestazioni.dataInizioCarica},{field:null,header:this.intestazioni.dataFineCarica},{field:"selezionato",header:this.intestazioni.dichiarazione}]}isImpresaDittaIndividuale(){return L.isImpresaDittaIndividuale(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.formaGiuridicaCodice)}popolaDati(i){let e=[];return null==i?(console.log("dichiarazione Dettagli assente"),[]):(e=i.datiDichiarazione.dettaglioImpresa.aziendeCollegate,void 0!==e&&e.length>0?this.duplicaAziendeConCariche(e):[])}duplicaAziendeConCariche(i){const e=[];return i.forEach(i=>{i.carica.forEach(a=>{const t=Object.assign({},i);t.carica=[a],e.push(t)})}),this.assegnaDataInizioCarica(e)}assegnaDataInizioCarica(i){const e=[];return i.forEach(i=>{i.carica.forEach(a=>{void 0!==a.dataInizio&&null!=a.dataInizio&&a.dataInizio.length>0||(a.dataInizio=this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.estremiCCIAA.dataIscrizione),e.push(i)})}),e}conferma(){const i=this.validator.validaAziendeCollegate(this.aziendeCollegate);i.esito===E.OK?(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.aziendeCollegate=this.aziendeCollegate,this.loading=!0,this.antimafiaService.aggiornaDichiarazioneAntimafia(this.dichiarazioneAntimafia).subscribe(i=>{console.log("Modifica alla dichiarazione "+i.dichiarazione.id+" avvenuta con successo"),null!=i.esito&&this.messages.add(m.a.getToast("generico",m.b.error,i.esito))},i=>{let e="Errore in aggiornaDichiarazioneAntimafia: "+i;console.error(e),this.messages.add(m.a.getToast("generico",m.b.error,e))},()=>{this.loading=!1,this.stepComponent.goNext()})):alert(i.messaggio)}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(r),c.Nb(b.a),c.Nb(f.d),c.Nb(B))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-aziende"]],viewQuery:function(i,e){var a;1&i&&c.Jc(P,!0),2&i&&c.Ac(a=c.cc())&&(e.stepComponent=a.first)},decls:3,vars:2,consts:[["class","boxgrey",4,"ngIf"],["class","card no-margin",4,"ngIf"],[3,"next"],[1,"boxgrey"],[1,"w-auto"],["href","./assets/pages/informativa-familiari/informativa-familiari.html","target","_blank"],[3,"columns","value","autoLayout","responsive"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],["binary","true",3,"ngModel","ngModelChange"],["primeCheckBox",""],[1,"card","no-margin"]],template:function(i,e){1&i&&(c.Mc(0,oi,10,5,"div",0),c.Mc(1,ni,3,0,"div",1),c.Tb(2,"app-step-action",2),c.bc("next",(function(){return e.conferma()})),c.Sb()),2&i&&(c.mc("ngIf",!e.isImpresaDittaIndividuale()),c.Bb(1),c.mc("ngIf",e.isImpresaDittaIndividuale()))},directives:[t.t,P,H.q,f.e,t.s,H.p,H.o,M.a,N.s,N.v],styles:[""]}),i})();var ri=a("dkQB");class si{}var li=a("JEAp"),di=a("tk/3"),bi=a("FK/F"),hi=a("kPZZ"),gi=a("1SSY");const mi=["file"];function ui(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",11),c.Ob(1,"i",12),c.Tb(2,"h3"),c.Oc(3),c.Sb(),c.Tb(4,"p"),c.Oc(5),c.Sb(),c.Sb(),c.Tb(6,"div",13),c.Tb(7,"div",14),c.Tb(8,"button",15),c.bc("click",(function(){return c.Ec(i),c.fc().onConfirmCheckDichiarazione()})),c.Sb(),c.Sb(),c.Tb(9,"div",14),c.Tb(10,"button",16),c.bc("click",(function(){return c.Ec(i),c.fc().onRejectCheckDichiarazione()})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit;c.Bb(3),c.Pc(i.summary),c.Bb(2),c.Pc(i.detail)}}function pi(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",11),c.Ob(1,"i",12),c.Tb(2,"h3"),c.Oc(3),c.Sb(),c.Tb(4,"p"),c.Oc(5),c.Sb(),c.Sb(),c.Tb(6,"div",13),c.Tb(7,"div",14),c.Tb(8,"button",15),c.bc("click",(function(){return c.Ec(i),c.fc().onConfirmHasAlreadyUploadedFile()})),c.Sb(),c.Sb(),c.Tb(9,"div",14),c.Tb(10,"button",16),c.bc("click",(function(){return c.Ec(i),c.fc().onRejectHasAlreadyUploadedFile()})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit;c.Bb(3),c.Pc(i.summary),c.Bb(2),c.Pc(i.detail)}}function fi(i,e){if(1&i&&(c.Tb(0,"th",23),c.Oc(1),c.Ob(2,"p-sortIcon",24),c.Sb()),2&i){const i=e.$implicit;c.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),c.Bb(1),c.Qc(" ",i.header," "),c.Bb(1),c.mc("field",i.field)}}function vi(i,e){if(1&i&&(c.Tb(0,"tr"),c.Mc(1,fi,3,4,"th",22),c.Ob(2,"th"),c.Sb()),2&i){const i=e.$implicit;c.Bb(1),c.mc("ngForOf",i)}}function Si(i,e){if(1&i){const i=c.Ub();c.Tb(0,"tr"),c.Tb(1,"td"),c.Oc(2),c.Sb(),c.Tb(3,"td"),c.Oc(4),c.Sb(),c.Tb(5,"td"),c.Oc(6),c.Sb(),c.Tb(7,"td"),c.Oc(8),c.Sb(),c.Tb(9,"td"),c.Oc(10),c.Sb(),c.Tb(11,"td"),c.Oc(12),c.Sb(),c.Tb(13,"td"),c.Oc(14),c.Sb(),c.Tb(15,"td"),c.Tb(16,"p-checkbox",25,26),c.bc("ngModelChange",(function(a){return c.Ec(i),e.$implicit.carica[0].selezionato=a}))("onChange",(function(a){c.Ec(i);const t=e.$implicit,o=c.Bc(17);return c.fc(2).compilazioneDichiarazione(t,a,o)})),c.Sb(),c.Sb(),c.Tb(18,"td"),c.Tb(19,"action-menu",27,28),c.bc("click",(function(){c.Ec(i);const a=e.rowIndex,t=e.$implicit,o=c.Bc(20);return c.fc(2).onDropdownMenuOpen(a,o,t)})),c.Sb(),c.Tb(21,"input",29,30),c.bc("change",(function(e){return c.Ec(i),c.fc(2).onFileChange(e)})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit,a=c.fc(2);c.Bb(2),c.Pc(i.cognome),c.Bb(2),c.Pc(i.nome),c.Bb(2),c.Pc(i.codiceFiscale),c.Bb(2),c.Pc(i.dataNascita),c.Bb(2),c.Pc(i.carica[0].tipologia),c.Bb(2),c.Pc(i.carica[0].dataInizio?i.carica[0].dataInizio:a.labels.nd),c.Bb(2),c.Pc(i.carica[0].dataFine?i.carica[0].dataFine:a.labels.illimitata),c.Bb(2),c.mc("ngModel",i.carica[0].selezionato),c.Bb(3),c.mc("item",a.model)("reset",a.reset)}}function zi(i,e){1&i&&(c.Tb(0,"tr"),c.Tb(1,"td"),c.Oc(2," Nessun contenuto disponibile "),c.Sb(),c.Sb()),2&i&&(c.Bb(1),c.Cb("colspan",10))}function Ti(i,e){if(1&i&&(c.Tb(0,"div",17),c.Tb(1,"p-table",18),c.Mc(2,vi,3,1,"ng-template",19),c.Mc(3,Si,23,10,"ng-template",20),c.Mc(4,zi,3,1,"ng-template",21),c.Sb(),c.Sb()),2&i){const i=c.fc();c.Bb(1),c.mc("columns",i.cols)("value",i.listaSoggettiTable)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)}}function Ai(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div"),c.Tb(1,"p-checkbox",41),c.bc("ngModelChange",(function(e){return c.Ec(i),c.fc(2).soggettoSelezionato.carica[0].dichiarazione=e}))("onChange",(function(e){return c.Ec(i),c.fc(2).onChangeDichiarazione(e)})),c.Sb(),c.Sb()}if(2&i){const i=c.fc(2);c.Bb(1),c.mc("ngModel",i.soggettoSelezionato.carica[0].dichiarazione)}}function Ii(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",55),c.Ob(1,"input",56,57),c.Tb(3,"div",58),c.Tb(4,"button",59),c.bc("debounceClick",(function(e){c.Ec(i);const a=c.Bc(2),t=c.fc().$implicit,o=c.Bc(4);return c.fc(2).cercaPerCodiceFiscale(a.value,t,o,e)})),c.Tb(5,"i",60),c.Oc(6," search "),c.Sb(),c.Sb(),c.Sb(),c.Sb()}}function Oi(i,e){if(1&i&&(c.Tb(0,"div"),c.Oc(1),c.Sb()),2&i){const i=c.fc().$implicit;c.Bb(1),c.Qc(" ",i.codiceFiscale," ")}}function Ci(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",32),c.Tb(1,"div",42),c.Tb(2,"div",43),c.Tb(3,"p-panel",44,45),c.Tb(5,"p-header"),c.Tb(6,"div",32),c.Tb(7,"div",46),c.Ob(8,"img",47),c.Sb(),c.Tb(9,"div",48),c.Tb(10,"h4"),c.Oc(11),c.Sb(),c.Mc(12,Ii,7,0,"div",49),c.Mc(13,Oi,2,1,"div",37),c.Sb(),c.Tb(14,"div",50),c.Tb(15,"p-dropdown",51),c.bc("ngModelChange",(function(a){return c.Ec(i),e.$implicit.gradoParentela=a}))("onChange",(function(e){return c.Ec(i),c.fc(2).onGradoParentelaChange(e)})),c.Sb(),c.Sb(),c.Tb(16,"div",52),c.Tb(17,"button",53),c.bc("click",(function(){c.Ec(i);const a=e.$implicit;return c.fc(2).eliminaFamiliare(a)})),c.Sb(),c.Sb(),c.Ob(18,"div",46),c.Sb(),c.Sb(),c.Tb(19,"div",32),c.Tb(20,"div",54),c.Tb(21,"strong"),c.Oc(22),c.Sb(),c.Sb(),c.Tb(23,"div",54),c.Tb(24,"label"),c.Oc(25),c.gc(26,"date"),c.Sb(),c.Sb(),c.Tb(27,"div",54),c.Tb(28,"strong"),c.Oc(29),c.Sb(),c.Sb(),c.Tb(30,"div",54),c.Tb(31,"label"),c.Oc(32),c.Sb(),c.Sb(),c.Tb(33,"div",54),c.Tb(34,"strong"),c.Oc(35),c.Sb(),c.Sb(),c.Tb(36,"div",54),c.Tb(37,"label"),c.Oc(38),c.Sb(),c.Sb(),c.Tb(39,"div",54),c.Tb(40,"strong"),c.Oc(41),c.Sb(),c.Sb(),c.Tb(42,"div",54),c.Tb(43,"label"),c.Oc(44),c.Sb(),c.Sb(),c.Tb(45,"div",54),c.Tb(46,"strong"),c.Oc(47),c.Sb(),c.Sb(),c.Tb(48,"div",54),c.Tb(49,"label"),c.Oc(50),c.Sb(),c.Sb(),c.Tb(51,"div",54),c.Tb(52,"strong"),c.Oc(53),c.Sb(),c.Sb(),c.Tb(54,"div",54),c.Tb(55,"label"),c.Oc(56),c.Sb(),c.Sb(),c.Tb(57,"div",54),c.Tb(58,"strong"),c.Oc(59),c.Sb(),c.Sb(),c.Tb(60,"div",54),c.Tb(61,"label"),c.Oc(62),c.Sb(),c.Sb(),c.Tb(63,"div",54),c.Tb(64,"strong"),c.Oc(65),c.Sb(),c.Sb(),c.Tb(66,"div",54),c.Tb(67,"label"),c.Oc(68),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit,a=c.fc(2);c.Bb(3),c.mc("toggleable",!0)("collapsed",!0),c.Bb(8),c.Rc("",i.nome," ",i.cognome,""),c.Bb(1),c.mc("ngIf",!i.codiceFiscale),c.Bb(1),c.mc("ngIf",i.codiceFiscale),c.Bb(2),c.mc("options",a.gradoParentelaItems)("ngModel",i.gradoParentela),c.Bb(7),c.Pc(a.labels.dataNascita),c.Bb(3),c.Pc(c.ic(26,24,i.dataNascita,"dd/MM/yyyy")),c.Bb(4),c.Pc(a.labels.residenza),c.Bb(3),c.Pc(i.residenza.indirizzo),c.Bb(3),c.Pc(a.labels.comuneNascita),c.Bb(3),c.Pc(i.comuneNascita),c.Bb(3),c.Pc(a.labels.residenzaComune),c.Bb(3),c.Pc(i.residenza.comune),c.Bb(3),c.Pc(a.labels.provinciaNascita),c.Bb(3),c.Pc(i.provinciaNascita),c.Bb(3),c.Pc(a.labels.residenzaProvincia),c.Bb(3),c.Pc(i.residenza.provincia),c.Bb(3),c.Pc(a.labels.sesso),c.Bb(3),c.Pc(i.sesso),c.Bb(3),c.Pc(a.labels.residenzaCAP),c.Bb(3),c.Pc(i.residenza.CAP)}}function yi(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",31),c.Tb(1,"div",32),c.Tb(2,"div",33),c.Tb(3,"h3",34),c.Oc(4),c.Sb(),c.Sb(),c.Tb(5,"div",35),c.Tb(6,"button",36),c.bc("click",(function(){return c.Ec(i),c.fc().aggiungiFamiliare()})),c.Sb(),c.Oc(7," AGGIUNGI FAMILIARE "),c.Sb(),c.Sb(),c.Mc(8,Ai,2,1,"div",37),c.Mc(9,Ci,69,27,"div",38),c.Tb(10,"div"),c.Tb(11,"div",39),c.Tb(12,"button",40),c.bc("debounceClick",(function(){return c.Ec(i),c.fc().salvaFamiliari()})),c.Sb(),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=c.fc();c.Bb(4),c.Rc("Elenco familiari conviventi di ",i.soggettoSelezionato.cognome," ",i.soggettoSelezionato.nome,""),c.Bb(4),c.mc("ngIf",!i.soggettoSelezionato.familiariConviventi||0==i.soggettoSelezionato.familiariConviventi.length),c.Bb(1),c.mc("ngForOf",i.soggettoSelezionato.familiariConviventi)}}function Di(i,e){1&i&&c.Oc(0," Nessun contenuto disponibile ")}let Pi=(()=>{class i{constructor(i,e,a,t,o,n,r,l,d,b){this.dichiarazioneAntimafiaService=i,this._configuration=e,this.antimafiaService=a,this.stepEvent=t,this.validator=o,this.messages=n,this.confirmationService=r,this.http=l,this.datePipe=d,this.loader=b,this.intestazioni=s.a,this.labels=s.a,this.msgs=[],this.soggettoChange=new c.n,this.model=new Array,this.loading=!1,this.blobToFile=(i,e)=>{var a=i;return a.lastModifiedDate=new Date,a.name=e,i}}ngOnDestroy(){this.loader.resetTimeout()}ngOnInit(){this.loader.setTimeout(48e4),this.model=[{label:"AZIONI",items:[{label:"Carica Modello",check:"true",badgeStyle:"file-uploaded-ok",items:[{label:"Firma Autografa",command:()=>{this.uploadFile(!1)}},{label:"Firma Digitale",command:()=>{this.uploadFile(!0)}}]},{separator:!0},{label:"Scarica Modello",command:()=>{this.downloadPdfFamiliariConviventi()}},{separator:!0},{label:"Familiari",badge:"true",command:()=>{this.visualizzaFamiliari(this.soggettoSelezionatoMenuAction)}}]}],this.dichiarazioneAntimafia=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia(),this.listaSoggetti=this.popolaDati(this.dichiarazioneAntimafia),this.listaSoggettiTable=this.isImpresaDittaIndividuale()?this.getCaricheImportanti(this.listaSoggetti):this.getCaricheAltre(this.listaSoggetti),L.setInizioCarica(this.listaSoggettiTable,this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.estremiCCIAA.dataIscrizione),this.soggettoChange.subscribe(i=>{let e=i.data,a=this.listaSoggetti.find(i=>i.codiceFiscale==e.codiceFiscale);a.familiariConviventi=e.familiariConviventi;let t=a.carica.find(i=>i.codice==e.carica[0].codice);t.selezionato=e.carica[0].selezionato,t.dichiarazione=e.carica[0].dichiarazione,i.aggiornaDichiarazione&&this.antimafiaService.aggiornaDichiarazioneAntimafia(this.dichiarazioneAntimafia).subscribe(i=>{this.messages.add(m.a.getToast("generic",m.b.success,m.a.OPERAZIONE_OK))})}),this.gradoParentelaItems=[],this.gradoParentelaItems.push({label:"Seleziona una opzione",value:null}),this.gradoParentelaItems.push({label:s.a.coniuge,value:s.a.coniuge}),this.gradoParentelaItems.push({label:s.a.figlio,value:s.a.figlio}),this.gradoParentelaItems.push({label:s.a.altro,value:s.a.altro}),this.textTitle=s.a.familiariConvinentiTitle,this.cols=[{field:"cognome",header:this.intestazioni.cognome},{field:"nome",header:this.intestazioni.nome},{field:"codiceFiscale",header:this.intestazioni.codiceFiscale},{field:"dataNascita",header:this.intestazioni.dataNascita},{field:null,header:this.intestazioni.carica},{field:null,header:this.intestazioni.dataInizioCarica},{field:null,header:this.intestazioni.dataFineCarica},{field:null,header:this.intestazioni.dichiarazione}]}isImpresaDittaIndividuale(){return"DI"===this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.formaGiuridicaCodice}popolaDati(i){let e;return null==i?(console.log("dichiarazione Dettagli assente"),[]):(e=i.datiDichiarazione,null!=e.dettaglioImpresa.soggettiImpresa?e.dettaglioImpresa.soggettiImpresa:[])}onDropdownMenuOpen(i,e,a){this.soggettoSelezionatoMenuAction=a,this.soggettoTableIndex=i;let t=0;a.familiariConviventi&&a.familiariConviventi.length>0&&a.carica[0].selezionato&&(t=this.soggettoSelezionatoMenuAction.familiariConviventi.length),e.badgeCounters=t,this.hasAlreadyUpdateFile()&&(e.badgeStylezed=!0,e.badgeData={fileDownloadLink:this._configuration.antimafia_server+this.soggettoSelezionatoMenuAction.carica[0].href,fileName:"Allegato 3-Familiari Conviventi_"+this.soggettoSelezionatoMenuAction.codiceFiscale+"."+this.soggettoSelezionatoMenuAction.carica[0].tipoAllegato})}getCaricheAltre(i){let e=i.map(i=>Object.assign({},i));const a=[];return e.forEach(i=>{i.carica.forEach(e=>{const t=Object.assign({},i);t.carica=[e],a.push(t)})}),a}getCaricheImportanti(i){return JSON.parse(JSON.stringify(i)).filter(i=>i.carica=i.carica.filter(i=>i.codice.match("DT|TIT|TI"))).filter(i=>!!i.carica&&0!==i.carica.length)}onConfirmCheckDichiarazione(){this.soggettoSelezionato.familiariConviventi=null,this.soggettoSelezionato.carica[0].dichiarazione=!1,this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1}),this.soggettoSelezionato=null,this.messages.clear("checkDichiarazione")}onRejectCheckDichiarazione(){this.soggettoSelezionato.carica[0].selezionato=!0,this.primeCheckBox.checked=!0,this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1}),this.messages.clear("checkDichiarazione")}onChangeDichiarazione(i){this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1})}compilazioneDichiarazione(i,e,a){if(this.soggettoSelezionato=i,this.primeCheckBox=a,e){this.soggettoSelezionato=i;let e=this.listaSoggetti.find(e=>e.codiceFiscale==i.codiceFiscale&&!!e.familiariConviventi);console.log("soggetto Con Familiare Esistente: "+e),e&&(this.soggettoSelezionato.familiariConviventi=e.familiariConviventi),this.scrollToBottom()}else{let e=this.listaSoggettiTable.filter(e=>e.codiceFiscale==i.codiceFiscale&&e.carica[0].codice!=i.carica[0].codice).some(i=>i.carica.some(i=>i.selezionato));if(i.familiariConviventi&&i.familiariConviventi.length>0&&!e)return this.messages.clear(),void this.messages.add({key:"checkDichiarazione",sticky:!0,severity:"warn",summary:"Tutti i familiari collegati saranno cancellati",detail:"Sei sicuro di voler togliere la spunta?"});if(i.carica[0].dichiarazione)return this.messages.clear(),void this.messages.add({key:"checkDichiarazione",sticky:!0,severity:"warn",summary:"E' stata spuntata la dichiarazione che NON ci sono famigliari conviventi.",detail:"Sei sicuro di voler togliere la spunta?"});this.soggettoSelezionato=null}}manageSoggettoConFamiliareEsistente(){let i=this.listaSoggetti.find(i=>i.codiceFiscale==this.soggettoSelezionato.codiceFiscale&&!!i.familiariConviventi);console.log("soggetto Con Familiare Esistente: "+i),i&&this.listaSoggettiTable.forEach(e=>{e.codiceFiscale==this.soggettoSelezionato.codiceFiscale&&(e.familiariConviventi=i.familiariConviventi)})}visualizzaFamiliari(i){void 0!==i&&(i.familiariConviventi&&i.familiariConviventi.length>0&&i.carica[0].selezionato||i.carica[0].selezionato&&i.carica[0].dichiarazione?(this.soggettoSelezionato=i,this.scrollToBottom()):this.soggettoSelezionato=null)}scrollToBottom(){window.setTimeout(()=>{document.querySelector("#idTableFamiliari")&&document.querySelector("#idTableFamiliari").scrollIntoView()},500)}aggiungiFamiliare(){this.soggettoSelezionato.familiariConviventi||(this.soggettoSelezionato.familiariConviventi=new Array),this.soggettoSelezionato.familiariConviventi.find(i=>null==i.codiceFiscale)||this.soggettoSelezionato.familiariConviventi.splice(0,0,{nome:"",cognome:"",codiceFiscale:null,comuneNascita:"",provinciaNascita:"",dataNascita:"",sesso:"",residenza:{indirizzo:"",comune:"",provincia:"",CAP:""},gradoParentela:null}),this.soggettoSelezionato.carica[0].dichiarazione=!1,this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1})}onGradoParentelaChange(i){this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1})}cercaPerCodiceFiscale(i,e,a,t){/^[a-zA-Z0-9]{16}$/.test(i)?this.soggettoSelezionato.familiariConviventi.some(e=>(e.codiceFiscale?e.codiceFiscale.toUpperCase():"")==i.toUpperCase())?this.messages.add(m.a.getToast("generic",m.b.error,m.a.CF_ESISTENTE(i))):this.antimafiaService.getPersona(i).subscribe(i=>{if(i.esito.codice.match("012")){const t=i.risposta.persona.personaFisica.datiNascita.data.toString(),o=this.validator.validaFamiliariConviventiMaggiorenni(t,i.risposta.persona.personaFisica.codiceFiscale);o.esito===E.OK?(e.cognome=i.risposta.persona.personaFisica.cognome,e.nome=i.risposta.persona.personaFisica.nome,e.codiceFiscale=i.risposta.persona.personaFisica.codiceFiscale,e.dataNascita=t,e.sesso=i.risposta.persona.personaFisica.sesso.valore,e.comuneNascita=i.risposta.persona.personaFisica.datiNascita.comune,e.provinciaNascita=i.risposta.persona.personaFisica.datiNascita.provincia,e.residenza={comune:i.risposta.persona.personaFisica.domicilioFiscale.ubicazione.comune,indirizzo:i.risposta.persona.personaFisica.domicilioFiscale.ubicazione.toponimo,provincia:i.risposta.persona.personaFisica.domicilioFiscale.ubicazione.provincia,CAP:i.risposta.persona.personaFisica.domicilioFiscale.ubicazione.cap},a.collapsed=!1):this.messages.add(m.a.getToast("generic",m.b.error,o.messaggio))}else this.messages.add(m.a.getToast("generic",m.b.error,i.esito.descrizione))},i=>this.messages.add(m.a.getToast("generic",m.b.error,m.a.SERVIZIO_NON_DISPONIBILE))):this.messages.add(m.a.getToast("generic",m.b.error,m.a.CHECK_CONFORMITA_CF))}eliminaFamiliare(i){const e=this.soggettoSelezionato.familiariConviventi.indexOf(i,0);e>-1&&this.soggettoSelezionato.familiariConviventi.splice(e,1),this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1}),0==this.soggettoSelezionato.familiariConviventi.length&&(this.listaSoggettiTable.filter(i=>i.codiceFiscale==this.soggettoSelezionato.codiceFiscale).forEach(i=>i.carica[0].selezionato=!1),this.soggettoSelezionato.carica[0].selezionato=!1,this.soggettoSelezionato.familiariConviventi=void 0,this.soggettoSelezionato=null)}conferma(){if(console.log("Inzio PUT"),!this.validazioniFamiliari())return;let i=this.validator.validaFamiliariConviventiAllegati(this.listaSoggettiTable);i.esito!==E.ERROR?(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.soggettiImpresa=this.listaSoggetti,this.loading=!0,this.antimafiaService.aggiornaDichiarazioneAntimafia(this.dichiarazioneAntimafia).subscribe(i=>{console.log("Modifica alla dichiarazione "+i.dichiarazione.id+" avvenuta con successo"),null!=i.esito&&this.messages.add(m.a.getToast("generico",m.b.error,i.esito))},i=>{let e="Errore in aggiornaDichiarazioneAntimafia: "+i;console.error(e),this.messages.add(m.a.getToast("generico",m.b.error,e))},()=>{this.loading=!1,this.stepComponent.goNext()})):this.messages.add(m.a.getToast("generic",m.b.error,i.messaggio))}indietro(){this.stepEvent.previous()}onFileChange(i){if(i.target.files&&i.target.files.length>0){let e=new si;e.file=i.target.files[0],e.isFirmaDigitale=this.isFirmaDigitale;let a=i.target.files[0];const t=this.validator.validaAllegatoType(e.file,e.isFirmaDigitale),o=this.validator.validaAllegatoSize(e.file);t.esito==E.OK?o.esito==E.OK?this.uploadAndStoreFile(a,this.isFirmaDigitale):this.messages.add(m.a.getToast("generic",m.b.error,o.messaggio)):this.messages.add(m.a.getToast("generic",m.b.error,t.messaggio))}}uploadFile(i){this.isFirmaDigitale=i,this.hasAlreadyUpdateFile()?this.showWarnAlreadyUploadedFile():this.openWindowsSelectFile()}uploadAndStoreFile(i,e){let a=new h.a;void 0!==this.soggettoSelezionatoMenuAction&&(a.cfSoggettoImpresa=this.soggettoSelezionatoMenuAction.codiceFiscale,a.codCarica=this.soggettoSelezionatoMenuAction.carica[0].codice,a.tipoFile=i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDFP7M)?"pdf.p7m":i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDF)?"pdf":null,null!=this.soggettoSelezionatoMenuAction.carica[0].href&&(a.id=Number.parseInt(this.soggettoSelezionatoMenuAction.carica[0].href.split("/")[4])),a.allegatoFamiliariConviventiPdf=i,a.firmaDigitale=e,this.antimafiaService.allegaFamiliariConviventi(a,i,this.dichiarazioneAntimafia.id).subscribe(i=>{m.a.isUndefinedOrNull(i)||(m.a.isUndefinedOrNull(i.esito)?(this.messages.add(m.a.getToast("generic",m.b.success,m.a.OPERAZIONE_OK)),m.a.isUndefinedOrNull(i.carica)||m.a.isUndefinedOrNull(i.allegatoFamiliariConviventi)||(this.listaSoggettiTable.forEach(e=>{0==e.codiceFiscale.localeCompare(i.allegatoFamiliariConviventi.cfSoggettoImpresa)&&!m.a.isUndefinedOrNull(e.carica)&&e.carica.length>0&&e.carica.forEach(e=>{0==e.codice.localeCompare(i.carica.codice)&&(e.href=i.carica.href,e.tipoAllegato=a.tipoFile)})}),this.listaSoggetti.forEach(e=>{0==e.codiceFiscale.localeCompare(i.allegatoFamiliariConviventi.cfSoggettoImpresa)&&!m.a.isUndefinedOrNull(e.carica)&&e.carica.length>0&&e.carica.forEach(e=>{0==e.codice.localeCompare(i.carica.codice)&&(e.href=i.carica.href,e.tipoAllegato=a.tipoFile)})}))):(this.messages.add(m.a.getToast("generic",m.b.error,i.esito.split(":")[1])),console.error("Errore in Aggiornamento Dichiarazione Antimafia: "+i.esito.split(":")[1]+"\nErrorCode:"+i.esito.split(":")[0])))},i=>{this.messages.add(m.a.getToast("generic",m.b.error,i.error)),console.error(i)}))}readByteFile(i){return new Promise((e,a)=>{let t,o=new FileReader,n="Errore nell' estrapolare i byte dal file "+i.name;null==i||void 0===i?a(n):(o.readAsDataURL(i),o.onloadend=i=>{t=o.result,null==t?a(n):e(t.toString().split(",")[1])})})}openWindowsSelectFile(){this.file.nativeElement.click()}hasAlreadyUpdateFile(){return void 0!==this.soggettoSelezionatoMenuAction&&void 0!==this.soggettoSelezionatoMenuAction.carica[0].href}showWarnAlreadyUploadedFile(){this.messages.add(m.a.getToast("warn-already-uploadedFile",m.b.warn,m.a.FILE_ALREADY_UPLOADED))}onRejectHasAlreadyUploadedFile(){this.messages.clear("warn-already-uploadedFile")}onConfirmHasAlreadyUploadedFile(){this.messages.clear("warn-already-uploadedFile"),this.openWindowsSelectFile()}onReject(){this.onRejectCheckDichiarazione()}downloadPdfFamiliariConviventi(){this.validazioniFamiliari(this.soggettoSelezionatoMenuAction)&&this.http.get(this._configuration.UrlGetAllFamConv,{responseType:"blob"}).subscribe(i=>{let e=this._configuration.UrlStampaPDF,a=this.soggettoSelezionatoMenuAction,t=this.blobToFile(i,"all3famconv.docx");var o={soggetto:a,dettaglioImpresa:this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa,dataOdierna:this.datePipe.transform(Date.now(),"dd/MM/yyyy")};const n=new FormData;return n.append("file",t,t.name),n.append("dati",JSON.stringify(o)),n.append("formatoStampa","PDF_A"),this.http.post(e,n,{responseType:"blob"}).subscribe(i=>{li.saveAs(i,"Allegato 3-Familiari Conviventi_"+a.codiceFiscale+".pdf")},i=>{console.error("Errore nella creazione del file allegato famigliari:",i)})})}salvaFamiliari(){this.validazioniFamiliari(this.soggettoSelezionato,!0)&&(this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!0}),this.manageSoggettoConFamiliareEsistente())}validazioniFamiliari(i,e){let a=!0,t=[];i?t.push(i):t=this.listaSoggettiTable;let o=this.validator.validaFamiliariConviventiInserimentoCF(t);return o.esito===E.ERROR&&(this.messages.add(m.a.getToast("generic",m.b.error,o.messaggio)),a=!1),o=this.validator.validaFamiliariConviventiGradoDiParentela(t),o.esito===E.ERROR&&(this.messages.add(m.a.getToast("generic",m.b.error,o.messaggio)),a=!1),o=this.validator.validaFamiliariConviventiCheckDichiarazione(t,e),o.esito===E.ERROR&&(this.messages.add(m.a.getToast("generic",m.b.error,o.messaggio)),a=!1),a}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(r),c.Nb(ri.a),c.Nb(b.a),c.Nb(l),c.Nb(B),c.Nb(f.d),c.Nb(f.a),c.Nb(di.b),c.Nb(t.f),c.Nb(u.a))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-familiari"]],viewQuery:function(i,e){var a;1&i&&(c.Jc(P,!0),c.Uc(mi,!0)),2&i&&(c.Ac(a=c.cc())&&(e.stepComponent=a.first),c.Ac(a=c.cc())&&(e.file=a.first))},features:[c.Ab([f.a,t.f])],decls:18,vars:9,consts:[[1,"boxgrey","layout-actionmenu"],["position","top-center","key","generic",3,"baseZIndex"],["position","center","key","checkDichiarazione",3,"modal","baseZIndex","onClose"],["pTemplate","message"],["position","center","key","warn-already-uploadedFile",3,"modal","baseZIndex","onClose"],[1,"w-auto"],["href","./assets/pages/informativa-familiari/informativa-familiari.html","target","_blank"],["class","table-responsive","margin-top","30px",4,"ngIf","ngIfElse"],["class","contenitore_familiari",4,"ngIf"],[3,"next"],["noContent",""],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"],["margin-top","30px",1,"table-responsive"],[3,"columns","value","autoLayout","paginator","rows","responsive"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],["binary","true",3,"ngModel","ngModelChange","onChange"],["primeCheckBox",""],[3,"item","reset","click"],["actionMenu",""],["type","file","onclick","this.value = null","accept",".p7m, .pdf",1,"inputUploadFile",2,"display","none",3,"change"],["file",""],[1,"contenitore_familiari"],[1,"ui-g"],[1,"ui-g-9"],[2,"margin-bottom","0px"],[1,"ui-g-3","addfamiliari"],["pButton","","type","button","icon","ui-icon-add","title","Reply",1,"remove-btn",3,"click"],[4,"ngIf"],["class","ui-g",4,"ngFor","ngForOf"],[2,"text-align","right","margin-right","10px"],["appDebounceClick","","pButton","","label","SALVA",1,"white-btn",3,"debounceClick"],["binary","true","label","Dichiaro che NON ci sono famigliari conviventi per il soggetto",3,"ngModel","ngModelChange","onChange"],[1,"ui-g-12"],[1,"box-familiare"],[3,"toggleable","collapsed"],["familiarePanel",""],[1,"ui-g-1"],["src","assets/layout/images/cittadino.png",2,"width","80%"],[1,"ui-g-4","titlefamiliari"],["class","input-group mb-3",4,"ngIf"],[1,"ui-g-4","ui-fluid"],["placeholder","Seleziona una opzione",1,"dropdown",3,"options","ngModel","ngModelChange","onChange"],[1,"ui-g-2"],["pButton","","type","button","icon","ui-icon-close","title","Elimina",1,"remove-btn","blue-grey-btn",2,"margin-right","4px",3,"click"],[1,"ui-g-3"],[1,"input-group","mb-3"],["type","text","placeholder","Codice Fiscale","aria-label","Codice Fiscale","aria-describedby","basic-addon2",1,"form-control"],["inputCodiceFiscale",""],[1,"input-group-append"],["appDebounceClick","","pButton","","type","button",1,"btn","btn-outline-secondary",3,"debounceClick"],[1,"material-icons",2,"margin-top","7px"]],template:function(i,e){if(1&i&&(c.Tb(0,"div",0),c.Ob(1,"p-toast",1),c.Tb(2,"p-toast",2),c.bc("onClose",(function(){return e.onReject()})),c.Mc(3,ui,11,2,"ng-template",3),c.Sb(),c.Tb(4,"p-toast",4),c.bc("onClose",(function(){return e.onReject()})),c.Mc(5,pi,11,2,"ng-template",3),c.Sb(),c.Tb(6,"div"),c.Tb(7,"h3",5),c.Oc(8),c.Tb(9,"span"),c.Tb(10,"a",6),c.Oc(11," ? "),c.Sb(),c.Sb(),c.Sb(),c.Mc(12,Ti,5,6,"div",7),c.Ob(13,"br"),c.Mc(14,yi,13,4,"div",8),c.Sb(),c.Sb(),c.Tb(15,"app-step-action",9),c.bc("next",(function(){return e.conferma()})),c.Sb(),c.Mc(16,Di,1,0,"ng-template",null,10,c.Nc)),2&i){const i=c.Bc(17);c.Bb(1),c.mc("baseZIndex",5e4),c.Bb(1),c.mc("modal",!0)("baseZIndex",5e3),c.Bb(2),c.mc("modal",!0)("baseZIndex",5e3),c.Bb(4),c.Qc("",e.textTitle," "),c.Bb(4),c.mc("ngIf",e.listaSoggettiTable.length>0)("ngIfElse",i),c.Bb(2),c.mc("ngIf",e.soggettoSelezionato)}},directives:[v.a,f.e,t.t,P,S.b,H.q,t.s,H.p,H.o,M.a,N.s,N.v,bi.a,z.a,hi.a,f.c,gi.a],pipes:[t.f],styles:[".inputUploadFile[_ngcontent-%COMP%]{width:80px!important}.right[_ngcontent-%COMP%]{float:right}.dropdown[_ngcontent-%COMP%]{color:green!important}.ui-widget-header[_ngcontent-%COMP%], body[_ngcontent-%COMP%]   .ui-widget-header[_ngcontent-%COMP%]{background-color:#fff!important}"]}),i})();var Ei=a("/vOn"),Fi=a("BkRI"),Ri=a("bOdf");const Bi=["file"],Ni=["filePrivacy"];function Mi(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",10),c.Ob(1,"i",11),c.Tb(2,"h3"),c.Oc(3),c.Sb(),c.Tb(4,"p"),c.Oc(5),c.Sb(),c.Sb(),c.Tb(6,"div",12),c.Tb(7,"div",13),c.Tb(8,"button",14),c.bc("click",(function(){return c.Ec(i),c.fc().onConfirmHasAlreadyUploadedFile()})),c.Sb(),c.Sb(),c.Tb(9,"div",13),c.Tb(10,"button",15),c.bc("click",(function(){return c.Ec(i),c.fc().onRejectHasAlreadyUploadedFile()})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit;c.Bb(3),c.Pc(i.summary),c.Bb(2),c.Pc(i.detail)}}function wi(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div"),c.Tb(1,"action-menu",18,19),c.bc("click",(function(){c.Ec(i);const e=c.Bc(2);return c.fc(2).onDropdownMenuOpen(e,!1)})),c.Sb(),c.Tb(3,"input",20,21),c.bc("change",(function(e){return c.Ec(i),c.fc(2).onFileChange(e,!1)})),c.Sb(),c.Sb()}if(2&i){const i=c.fc(2);c.Bb(1),c.mc("item",i.menuActionAllegatoAntimafia)("reset",i.reset)}}function xi(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div"),c.Tb(1,"action-menu",18,22),c.bc("click",(function(){c.Ec(i);const e=c.Bc(2);return c.fc(2).onDropdownMenuOpen(e,!0)})),c.Sb(),c.Tb(3,"input",20,23),c.bc("change",(function(e){return c.Ec(i),c.fc(2).onFileChange(e,!0)})),c.Sb(),c.Sb()}if(2&i){const i=c.fc(2);c.Bb(1),c.mc("item",i.menuActionInformativaPrivacy)("reset",i.reset)}}function _i(i,e){if(1&i&&(c.Tb(0,"tr"),c.Tb(1,"td"),c.Oc(2),c.Sb(),c.Tb(3,"td"),c.Oc(4),c.Sb(),c.Tb(5,"td"),c.Ob(6,"span",16),c.Sb(),c.Tb(7,"td"),c.Oc(8),c.Sb(),c.Tb(9,"td"),c.Mc(10,wi,5,2,"div",17),c.Mc(11,xi,5,2,"div",17),c.Sb(),c.Sb()),2&i){const i=e.$implicit,a=c.fc();c.Bb(2),c.Pc(a.colDato[i]),c.Bb(2),c.Pc(a.colTipologia[i]),c.Bb(2),c.mc("ngClass",a.colValidation[i]),c.Bb(2),c.Pc(a.colErrori[i]),c.Bb(2),c.mc("ngIf","verifica"===i),c.Bb(1),c.mc("ngIf","privacy"===i&&!a.isPrivacyOk)}}let Ui=(()=>{class i{constructor(i,e,a,t,o,n,c,r,l,d,b,h){this.dichiarazioneAntimafiaService=i,this.antimafiaService=e,this._configuration=a,this.validator=t,this.http=o,this.route=n,this.datePipe=c,this.messages=r,this.loaderService=l,this.utentiservice=d,this.router=b,this.translate=h,this.statoValidazione={OK:"pi pi-check",ERROR:"ui-icon-error",WARNING:"pi pi-info-circle"},this.colDato={procedimenti:s.a.procedimenti,richiedente:s.a.anagraficaRichiedente,impresa:s.a.anagraficaImpresa,soggetti:s.a.soggettiCarica,aziende:s.a.aziendeCollegate,familiari:s.a.familiari,documentoFamiliari:s.a.dichiarazioneFamiliariConviventi,verifica:s.a.dichiarazioneAntimafia,privacy:s.a.documentoInformativaPrivacy},this.colTipologia={procedimenti:"",richiedente:s.a.datoCCIA,impresa:s.a.datoCCIA,soggetti:s.a.datoCCIA,aziende:s.a.datoCCIA,familiari:s.a.datoCCIA,documentoFamiliari:s.a.documentoFirmato,verifica:s.a.documentoFirmatoDigitalmente,privacy:s.a.documentoFirmatoDigitalmente},this.colValidation={procedimenti:this.statoValidazione.OK,richiedente:this.statoValidazione.OK,impresa:this.statoValidazione.OK,soggetti:this.statoValidazione.OK,aziende:this.statoValidazione.OK,familiari:this.statoValidazione.OK,documentoFamiliari:this.statoValidazione.OK,verifica:this.statoValidazione.OK,privacy:this.statoValidazione.ERROR},this.colErrori={procedimenti:"",richiedente:"",impresa:"",soggetti:"",aziende:"",familiari:"",documentoFamiliari:"",verifica:"",privacy:""},this.firmaPdf=!1,this.protocollaPdf=!1,this.labels=s.a,this.isProtocollaReady=!0,this.menuActionAllegatoAntimafia=new Array,this.menuActionInformativaPrivacy=new Array,this.hasUploadPrivacy=!1,this.blobToFile=(i,e)=>{var a=i;return a.lastModifiedDate=new Date,a.name=e,i}}ngOnInit(){this.loaderService.setTimeout(48e4),this.buildMenuActionAllegatoAntimafia(),this.buildMenuActionInformativaPrivacy();const i=this.route.snapshot.paramMap.get("idDichiarazione");this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(i).subscribe(i=>{this.dichiarazioneAntimafia=i,i.procedimenti=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia().procedimenti,m.a.isUndefinedOrNull(this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia().procedimenti)||this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia().procedimenti.forEach(i=>{this.translate.get("DICH_AMF."+i).subscribe(i=>{this.colTipologia.procedimenti=this.colTipologia.procedimenti?this.colTipologia.procedimenti+", "+i:i})}),this.pdfFirmato=i.pdfFirmato,this.dichiarazioneAntimafiaService.setDichiarazioneAntimafia(i),this.validaPerVerifica(this.dichiarazioneAntimafia)}),this.urlUploadFirma=this._configuration.UrlUploadFirma,this.urlUploaProtocolla=this._configuration.UrlUploadProtocolla,this.steps=Object.keys(this.colDato)}ngOnDestroy(){this.loaderService.resetTimeout()}getDocumentazioneInformativaPrivacy(i){const e=this._configuration.ProtocollaPrivacyOggetto+" - "+i.nome+" "+i.cognome+" - "+i.codiceFiscale,a=this._configuration.tipologiaDocumentoProtocolloPrivacy,t={name:i.nome,surname:i.cognome,email:m.a.isUndefinedOrNull(i.indirizzoPEC)?null:i.indirizzoPEC,nationalIdentificationNumber:i.codiceFiscale,description:i.nome+" "+i.cognome+" - "+i.codiceFiscale};return JSON.stringify({mittente:t,allegati:null,documento:{content:null,mimeType:"application/pdf",name:"InformativaGeneralePrivacy.pdf"},oggetto:e,tipologiaDocumentoPrincipale:a})}protocollaDomanda(){this.messages.add(m.a.getToast("warn-start-protocollazione",m.b.warn,m.a.WARNING_START_PROTOCOLLAZIONE))}onRejectStartProtocollazione(){this.clearWarnStartProtocollazione()}startProtocollazioneAsincrona(){if(this.isProtocollaReady){this.clearWarnStartProtocollazione();let i=this.dichiarazioneAntimafia.datiDichiarazione.richiedente;m.a.isUndefinedOrNull(this.informativaPrivacyDocument)?this.antimafiaService.newProtocollaDichiarazioneAntimafiaAsync(this.dichiarazioneAntimafia.id.toString()).subscribe(i=>{console.log("RESPONSE: "+i.status),this.messages.add(m.a.getToast("tst-protocolla",m.b.success,this.translate.instant("DICH_AMF.protocollazioneInCarico")))},i=>{this.messages.add(m.a.getToast("tst",m.b.error,m.a.PROTOCOLLA_ANTIMAFIA_ERROR))}):this.antimafiaService.newProtocollaDichiarazioneAntimafiaAsync(this.dichiarazioneAntimafia.id.toString()).pipe(Object(Ri.a)(e=>this.utentiservice.protocollaInformativaPrivacyDichiarazioneAntimafia(i.nome,i.cognome,i.codiceFiscale,this.getDocumentazioneInformativaPrivacy(i),this.informativaPrivacyDocument,null))).subscribe(i=>{this.messages.add(m.a.getToast("tst-protocolla",m.b.success,this.translate.instant("DICH_AMF.protocollazioneInCarico")))},i=>{this.messages.add(m.a.getToast("tst",m.b.error,m.a.PROTOCOLLA_ANTIMAFIA_ERROR))})}}checkInfoPrivacy(i){i.esito!==E.OK?(this.colErrori.privacy=i.messaggio,this.colValidation.privacy=this.statoValidazione.ERROR,this.isProtocollaReady=!1):(this.colErrori.privacy="",this.colValidation.privacy=this.statoValidazione.OK,this.verifyIfProtocollaIsReady())}validaPerVerifica(i){let e={esito:E.OK};e=this.validator.validaRichiedente(i.datiDichiarazione.richiedente),e.esito!==E.OK&&(this.colErrori.richiedente=e.messaggio,this.colValidation.richiedente=this.statoValidazione.ERROR,this.isProtocollaReady=!1),e=this.validator.validaImpresa(i.datiDichiarazione.dettaglioImpresa),e.esito!==E.OK&&(this.colErrori.impresa=e.messaggio,this.colValidation.impresa=this.statoValidazione.ERROR,this.isProtocollaReady=!1),e=this.validator.validaSoggettiCarica(i),e.esito!==E.OK&&(this.colErrori.soggetti=e.messaggio,this.colValidation.soggetti=this.statoValidazione.ERROR,this.isProtocollaReady=!1),e=this.validator.validaFamiliariConviventiAllegati(i.datiDichiarazione.dettaglioImpresa.soggettiImpresa),e.esito!==E.OK&&(this.colErrori.documentoFamiliari=e.messaggio,this.colValidation.documentoFamiliari=this.statoValidazione.ERROR,this.isProtocollaReady=!1),e=this.validator.validaFamiliariConviventiCheckDichiarazione(i.datiDichiarazione.dettaglioImpresa.soggettiImpresa),e.esito!==E.OK&&(this.colErrori.familiari=e.messaggio,this.colValidation.familiari=this.statoValidazione.ERROR,this.isProtocollaReady=!1),e=this.validator.validaAziendeCollegate(i.datiDichiarazione.dettaglioImpresa.aziendeCollegate),e.esito!==E.OK&&(this.colErrori.aziende=e.messaggio,this.colValidation.aziende=this.statoValidazione.ERROR,this.isProtocollaReady=!1),e=this.validator.validaVerificaDichiarazioneAllegata(this.dichiarazioneAntimafia.dtUploadPdfFirmato),e.esito!==E.OK&&(this.colErrori.verifica=e.messaggio,this.colValidation.verifica=this.statoValidazione.ERROR,this.isProtocollaReady=!1),this.utentiservice.ricercaPersone({codiceFiscale:i.datiDichiarazione.richiedente.codiceFiscale}).subscribe(a=>{e=this.validator.validaVerificaInformativaPrivacy(null==a?[]:a,i.datiDichiarazione.richiedente.codiceFiscale),this.checkInfoPrivacy(e),!m.a.isUndefinedOrNull(a)&&a.length>0&&(this.persona=a[0])},i=>{console.error("Errore in ricercaPersone: "+i),this.colErrori.privacy=i.message,this.colValidation.privacy=this.statoValidazione.ERROR,this.isProtocollaReady=!1})}downloadInformativaPrivacy(){this.http.get(this._configuration.UrlGetInfoPrivacy,{responseType:"blob"}).subscribe(i=>{li.saveAs(i,"informativa_privacy.pdf")})}sentenceCase(i,e){return i=null==i?"":i,e&&(i=i.toLowerCase()),i.toString().replace(/(^|\. *)([a-z])/g,(function(i,e,a){return i.toUpperCase()}))}fixOggettoSociale(i){return(i=null==i?"":i).toUpperCase()}downloadCertificazioneAntimafia(){let i=L.isImpresaDittaIndividuale(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.formaGiuridicaCodice);this.http.get(i?this._configuration.UrlGetDichiarazioneAntimafiaDI:this._configuration.UrlGetDichiarazioneAntimafiaPG,{responseType:"blob"}).subscribe(e=>{const a=this._configuration.UrlStampaPDF,t=this.blobToFile(e,"all3famconv.docx"),o=i?this.getCaricheImportanti():this.getSoggettiSelezionati(),n=Fi(this.dichiarazioneAntimafia),c=this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.oggettoSociale;this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.oggettoSociale=this.fixOggettoSociale(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.oggettoSociale);const r=this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.aziendeCollegate?this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.aziendeCollegate.filter(i=>!0===i.selezionato):[];n.datiDichiarazione.dettaglioImpresa.aziendeCollegate=r;const s={dichiarazioneAntimafia:n,soggettiConCarica:o,dataOdierna:this.datePipe.transform(Date.now(),"dd/MM/yyyy")},l=new FormData;return l.append("file",t,t.name),l.append("dati",JSON.stringify(s)),l.append("formatoStampa","PDF_A"),this.http.post(a,l,{responseType:"blob"}).subscribe(i=>{this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.oggettoSociale=c,li.saveAs(i,"DichiarazioneAntimafia_"+this.dichiarazioneAntimafia.id+".pdf")},i=>{console.error("Errore nella creazione della dichiarazione antimafia:",i)})})}getCaricheImportanti(){let i=this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.soggettiImpresa.map(i=>Object.assign({},i));return JSON.parse(JSON.stringify(i)).filter(i=>i.carica=i.carica.filter(i=>i.codice.match("DT"))).filter(i=>!!i.carica&&0!==i.carica.length)}getSoggettiSelezionati(){let i=this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.soggettiImpresa.map(i=>Object.assign({},i));return JSON.parse(JSON.stringify(i)).filter(i=>i.carica=i.carica.filter(i=>i.selezionato)).filter(i=>!!i.carica&&0!==i.carica.length)}onDropdownMenuOpen(i,e){this.hasAlreadyUpdateFile()&&!e&&(i.badgeStylezed=!1,i.item[0].items[1].disabled=!0,null!=this.dichiarazioneAntimafia&&(i.badgeStylezed=null!=this.dichiarazioneAntimafia.dtUploadPdfFirmato,i.item[0].items[1].disabled=!1,i.badgeData={file:this.dichiarazioneAntimafia.pdfFirmato,fileName:"DomandaCertificazioneAntimafia_"+this.dichiarazioneAntimafia.id+"."+(null==this.dichiarazioneAntimafia.tipoPdfFirmato?"pdf":this.dichiarazioneAntimafia.tipoPdfFirmato)})),e&&(i.badgeStylezed=this.hasUploadPrivacy,this.readByteFile(this.informativaPrivacyDocument).then(e=>{i.badgeData={file:e,fileName:"InformativaPrivacyDocument_"+this.informativaPrivacyDocument.name}}))}onFileChange(i,e){if(i.target.files&&i.target.files.length>0){let a=i.target.files[0];const t=this.validator.validaAllegatoType(a,!0),o=this.validator.validaAllegatoSize(a);t.esito==E.OK?o.esito==E.OK?e?this.uploadInfoPrivacy(a):this.converterByteBase64(a):this.messages.add(m.a.getToast("tst",m.b.error,o.messaggio)):this.messages.add(m.a.getToast("tst",m.b.error,t.messaggio))}}uploadFile(){this.hasAlreadyUpdateFile()?this.showWarnAlreadyUploadedFile():this.openWindowsSelectFile()}converterByteBase64(i){let e=this.dichiarazioneAntimafia.pdfFirmato;this.readByteFile(i).then(a=>{this.dichiarazioneAntimafia.pdfFirmato=a,this.dichiarazioneAntimafia.tipoPdfFirmato=i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDFP7M)?"pdf.p7m":i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDF)?"pdf":null,this.dichiarazioneAntimafia.pdfFirmatoName=i.name,this.antimafiaService.aggiornaDichiarazioneAntimafia(this.dichiarazioneAntimafia).subscribe(i=>{m.a.isUndefinedOrNull(i.esito)?(this.messages.add(m.a.getToast("tst",m.b.success,m.a.OPERAZIONE_OK)),this.colErrori.verifica="",this.colValidation.verifica=this.statoValidazione.OK,this.dichiarazioneAntimafia.dtUploadPdfFirmato=i.dichiarazione.dtUploadPdfFirmato,this.pdfFirmato=i.pdfFirmato,this.verifyIfProtocollaIsReady()):(this.messages.add(m.a.getToast("tst",m.b.error,i.esito.split(":")[1])),console.error("Errore in Aggiornamento Dichiarazione Antimafia: "+i.esito.split(":")[1]+"\nErrorCode:"+i.esito.split(":")[0]))},i=>{console.error(i),this.dichiarazioneAntimafia.pdfFirmato=e,this.messages.add(m.a.getToast("tst",m.b.error,i.error))})},i=>{console.error(i),this.dichiarazioneAntimafia.pdfFirmato=e})}readByteFile(i){return new Promise((e,a)=>{let t=new FileReader;m.a.isUndefinedOrNull(i)&&a("Errore nell' estrapolare i byte dal file");let o,n="Errore nell' estrapolare i byte dal file "+i.name;m.a.isUndefinedOrNull(i)?a(n):(t.readAsDataURL(i),t.onloadend=i=>{o=t.result,null==o?a(n):e(o.toString().split(",")[1])})})}openWindowsSelectFile(){this.file.nativeElement.click()}hasAlreadyUpdateFile(){return!m.a.isUndefinedOrNull(this.dichiarazioneAntimafia.dtUploadPdfFirmato)}showWarnAlreadyUploadedFile(){this.messages.add(m.a.getToast("warn-already-uploadedFile",m.b.warn,m.a.FILE_ALREADY_UPLOADED))}onRejectHasAlreadyUploadedFile(){this.messages.clear("warn-already-uploadedFile")}onConfirmHasAlreadyUploadedFile(){this.messages.clear("warn-already-uploadedFile"),this.hasUploadPrivacy?this.filePrivacy.nativeElement.click():this.openWindowsSelectFile()}buildMenuActionAllegatoAntimafia(){this.menuActionAllegatoAntimafia=[{label:s.a.azioni.toUpperCase(),items:[{label:s.a.CARICA_MODELLO,check:"true",badgeStyle:"file-uploaded-ok",command:()=>{this.uploadFile()}},{separator:!0},{label:s.a.SCARICA_MODELLO,command:()=>{this.downloadCertificazioneAntimafia()}}]}]}buildMenuActionInformativaPrivacy(){this.menuActionInformativaPrivacy=[{label:s.a.azioni.toUpperCase(),items:[{label:s.a.CARICA_MODELLO,check:"true",badgeStyle:"file-uploaded-ok",command:()=>{this.openInfoPrivacy()}},{separator:!0},{label:s.a.SCARICA_MODELLO,command:()=>{this.downloadInformativaPrivacy()}}]}]}openInfoPrivacy(){this.hasUploadPrivacy?this.showWarnAlreadyUploadedFile():this.filePrivacy.nativeElement.click()}openWindowSelectFilePrivacy(){this.hasUploadPrivacy?this.showWarnAlreadyUploadedFile():this.openInfoPrivacy()}uploadInfoPrivacy(i){this.antimafiaService.verificaFirma(i).subscribe(e=>{if(0!==e.warningFault.length){let i=e.warningFault[0];this.messages.add(m.a.getToast("tst",m.b.error,i.errorMsg)),this.checkInfoPrivacy({esito:E.ERROR,messaggio:m.a.INFORMATIVA_PRIVACY_ASSENTE(this.dichiarazioneAntimafia.datiDichiarazione.richiedente.codiceFiscale)}),console.error("Errore in Verifica Dichiarazione Antimafia per info privacy: "+i.errorMsg+"\nErrorCode:"+i.errorCode)}else this.messages.add(m.a.getToast("tst",m.b.success,m.a.OPERAZIONE_OK)),this.checkInfoPrivacy({esito:E.OK}),this.hasUploadPrivacy=!0,this.informativaPrivacyDocument=i})}verifyIfProtocollaIsReady(){Object.values(this.colValidation).some(i=>i===this.statoValidazione.ERROR)||(this.isProtocollaReady=!0)}onCloseMessageProtocolla(){this.router.navigate(["./"],{relativeTo:this.route.parent.parent})}clearWarnStartProtocollazione(){this.messages.clear("warn-start-protocollazione")}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(r),c.Nb(b.a),c.Nb(ri.a),c.Nb(B),c.Nb(di.b),c.Nb(o.a),c.Nb(t.f),c.Nb(f.d),c.Nb(u.a),c.Nb(Ei.a),c.Nb(o.e),c.Nb(w.e))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-verifica"]],viewQuery:function(i,e){var a;1&i&&(c.Uc(Bi,!0),c.Uc(Ni,!0)),2&i&&(c.Ac(a=c.cc())&&(e.file=a.first),c.Ac(a=c.cc())&&(e.filePrivacy=a.first))},features:[c.Ab([t.f])],decls:24,vars:11,consts:[[1,"boxgrey","layout-actionmenu"],["position","top-center","key","tst",3,"baseZIndex"],["position","top-center","key","tst-protocolla","modal","true",3,"baseZIndex","onClose"],["position","center","key","warn-already-uploadedFile","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[1,"table","table-bordered","table-hoover"],[1,"thead-light"],[4,"ngFor","ngForOf"],[1,"next-button"],[3,"isProtocollaReady","next"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"],[3,"ngClass"],[4,"ngIf"],[3,"item","reset","click"],["actionMenu",""],["type","file","onclick","this.value = null","accept",".p7m, .pdf",1,"inputUploadFile",2,"display","none",3,"change"],["file",""],["actionMenuPrivacy",""],["filePrivacy",""]],template:function(i,e){1&i&&(c.Tb(0,"div",0),c.Tb(1,"h3"),c.Oc(2," Elenco dei dati richiesti per la certificazione antimafia "),c.Sb(),c.Ob(3,"p-toast",1),c.Tb(4,"p-toast",2),c.bc("onClose",(function(){return e.onCloseMessageProtocolla()})),c.Sb(),c.Tb(5,"p-toast",3),c.bc("onClose",(function(){return e.onRejectHasAlreadyUploadedFile()})),c.Mc(6,Mi,11,2,"ng-template",4),c.Sb(),c.Tb(7,"table",5),c.Tb(8,"thead",6),c.Tb(9,"tr"),c.Tb(10,"th"),c.Oc(11),c.Sb(),c.Tb(12,"th"),c.Oc(13),c.Sb(),c.Tb(14,"th"),c.Oc(15),c.Sb(),c.Tb(16,"th"),c.Oc(17),c.Sb(),c.Tb(18,"th"),c.Oc(19),c.Sb(),c.Sb(),c.Sb(),c.Tb(20,"tbody"),c.Mc(21,_i,12,6,"tr",7),c.Sb(),c.Sb(),c.Sb(),c.Tb(22,"div",8),c.Tb(23,"app-step-action",9),c.bc("next",(function(){return e.startProtocollazioneAsincrona()})),c.Sb(),c.Sb()),2&i&&(c.Bb(3),c.mc("baseZIndex",5e4),c.Bb(1),c.mc("baseZIndex",5e4),c.Bb(1),c.mc("modal",!0)("baseZIndex",5e3),c.Bb(6),c.Pc(e.labels.dato),c.Bb(2),c.Pc(e.labels.tipologia),c.Bb(2),c.Pc(e.labels.stato),c.Bb(2),c.Pc(e.labels.errori),c.Bb(2),c.Pc(e.labels.azioni),c.Bb(2),c.mc("ngForOf",e.steps),c.Bb(2),c.mc("isProtocollaReady",e.isProtocollaReady))},directives:[v.a,f.e,t.s,P,S.b,t.q,t.t,bi.a],styles:[""]}),i})();function ki(i,e){1&i&&c.Ob(0,"app-procedimenti")}function Li(i,e){1&i&&c.Ob(0,"app-richiedente")}function ji(i,e){1&i&&c.Ob(0,"app-impresa")}function Gi(i,e){1&i&&c.Ob(0,"app-soggetti")}function Ki(i,e){1&i&&c.Ob(0,"app-aziende")}function Vi(i,e){1&i&&c.Ob(0,"app-familiari")}function Zi(i,e){1&i&&c.Ob(0,"app-verifica")}let Qi=(()=>{class i{constructor(i,e,a){this.dichiarazioneAntimafiaService=i,this.route=e,this.stepEvent=a}ngOnInit(){this.dichiarazioneAntimafiaService.setDichiarazioneAntimafia(this.route.snapshot.data.dichiarazione),this.stepsAntimafia=[{label:s.a.procedimenti},{label:s.a.anagraficaRichiedente},{label:s.a.anagraficaImpresa},{label:s.a.soggettiCarica},{label:s.a.aziendeCollegate},{label:s.a.familiari},{label:s.a.verifica}],this.stepEvent.stepIndex=0,this.textTitle=s.a.richiestaCertificazione}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(r),c.Nb(o.a),c.Nb(l))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-dichiarazione-antimafia"]],decls:17,vars:10,consts:[[1,"ui-grid-fixed"],[1,"richiesta-title"],[1,"ui-g"],[3,"model","activeIndex"],["stepModule",""],[1,"greybox"],[4,"ngIf"],[2,"margin-bottom","10px"]],template:function(i,e){if(1&i&&(c.Ob(0,"br"),c.Ob(1,"br"),c.Tb(2,"div",0),c.Tb(3,"h2",1),c.Oc(4),c.Sb(),c.Tb(5,"div",2),c.Ob(6,"p-steps",3,4),c.Sb(),c.Tb(8,"div",5),c.Mc(9,ki,1,0,"app-procedimenti",6),c.Mc(10,Li,1,0,"app-richiedente",6),c.Mc(11,ji,1,0,"app-impresa",6),c.Mc(12,Gi,1,0,"app-soggetti",6),c.Mc(13,Ki,1,0,"app-aziende",6),c.Mc(14,Vi,1,0,"app-familiari",6),c.Mc(15,Zi,1,0,"app-verifica",6),c.Sb(),c.Ob(16,"div",7),c.Sb()),2&i){const i=c.Bc(7);c.Bb(4),c.Qc(" ",e.textTitle," "),c.Bb(2),c.mc("model",e.stepsAntimafia)("activeIndex",e.stepEvent.stepIndex),c.Bb(3),c.mc("ngIf",0==i.activeIndex),c.Bb(1),c.mc("ngIf",1==i.activeIndex),c.Bb(1),c.mc("ngIf",2==i.activeIndex),c.Bb(1),c.mc("ngIf",3==i.activeIndex),c.Bb(1),c.mc("ngIf",4==i.activeIndex),c.Bb(1),c.mc("ngIf",5==i.activeIndex),c.Bb(1),c.mc("ngIf",6==i.activeIndex)}},directives:[d.a,t.t,_,j,Q,X,ci,Pi,Ui],styles:[".ui-steps-item,.ui-steps .ui-steps-item{width:unset}"],encapsulation:2}),i})();var Hi=a("0Dnl"),$i=a("d/lR");function Wi(i,e){if(1&i&&(c.Tb(0,"tr"),c.Tb(1,"td"),c.Oc(2),c.Sb(),c.Tb(3,"td"),c.Oc(4),c.Sb(),c.Tb(5,"td"),c.Tb(6,"a",4),c.Oc(7,"Apri"),c.Sb(),c.Sb(),c.Sb()),2&i){const i=e.$implicit;c.Bb(2),c.Pc(i.id),c.Bb(2),c.Pc(i.stato.identificativo),c.Bb(2),c.nc("routerLink",i.id)}}function Ji(i,e){if(1&i&&(c.Tb(0,"div"),c.Ob(1,"app-upload",5),c.Sb()),2&i){const i=c.fc();c.Bb(1),c.mc("id",i.dichiarazioneId)("title","Carica File Firmato "+i.dichiarazioneId)("serviceUrl",i.urlUploadFirma)("maxSize","-1")("fileExt",".PDF")}}function Yi(i,e){if(1&i&&(c.Tb(0,"div"),c.Ob(1,"app-upload",5),c.Sb()),2&i){const i=c.fc();c.Bb(1),c.mc("id",i.dichiarazioneId)("title","Carica File da Procollare "+i.dichiarazioneId)("serviceUrl",i.urlUploadFirma)("maxSize","-1")("fileExt",".PDF")}}let qi=(()=>{class i{constructor(i,e,a,t,o,n){this.route=i,this.router=e,this.dichiarazioneAntimafiaService=a,this.antimafiaService=t,this._configuration=o,this.fascicoloCorrente=n,this.firmaPdf=!1,this.protocollaPdf=!1,this.newDichiarazione=new c.n}ngOnInit(){}nuovaDichiarazione(){this.newDichiarazione.emit()}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(o.a),c.Nb(o.e),c.Nb(r),c.Nb(b.a),c.Nb(ri.a),c.Nb(Hi.a))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-sintesi-antimafia-list"]],inputs:{dichiarazioniAntimafia:"dichiarazioniAntimafia"},outputs:{newDichiarazione:"newDichiarazione"},decls:20,vars:12,consts:[[1,"button",3,"click"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"routerLink"],[3,"id","title","serviceUrl","maxSize","fileExt"]],template:function(i,e){1&i&&(c.Tb(0,"div"),c.Tb(1,"button",0),c.bc("click",(function(){return e.nuovaDichiarazione()})),c.Oc(2,"Nuova"),c.Sb(),c.Sb(),c.Tb(3,"div"),c.Tb(4,"table",1),c.Tb(5,"thead"),c.Tb(6,"tr"),c.Tb(7,"td"),c.Oc(8),c.gc(9,"translate"),c.Sb(),c.Tb(10,"td"),c.Oc(11),c.gc(12,"translate"),c.Sb(),c.Tb(13,"td"),c.Oc(14),c.gc(15,"translate"),c.Sb(),c.Sb(),c.Sb(),c.Tb(16,"tbody"),c.Mc(17,Wi,8,3,"tr",2),c.Sb(),c.Sb(),c.Sb(),c.Mc(18,Ji,2,5,"div",3),c.Mc(19,Yi,2,5,"div",3)),2&i&&(c.Bb(8),c.Pc(c.hc(9,6,"ANTIMAFIA.idDichiarazione")),c.Bb(3),c.Pc(c.hc(12,8,"ANTIMAFIA.stato")),c.Bb(3),c.Pc(c.hc(15,10,"ANTIMAFIA.action")),c.Bb(3),c.mc("ngForOf",e.dichiarazioniAntimafia),c.Bb(1),c.mc("ngIf",e.firmaPdf&&e.dichiarazioneId),c.Bb(1),c.mc("ngIf",e.protocollaPdf&&e.dichiarazioneId))},directives:[t.s,t.t,o.h,$i.a],pipes:[w.d],styles:[""]}),i})();var Xi=a("R69K");let ie=(()=>{class i{constructor(i){this.antimafiaService=i}resolve(i){return console.log("Carica antimafia da db "+i.paramMap.get("idDichiarazione")),this.antimafiaService.getDichiarazioneAntimafia(i.paramMap.get("idDichiarazione"))}}return i.\u0275fac=function(e){return new(e||i)(c.Xb(b.a))},i.\u0275prov=c.Jb({token:i,factory:i.\u0275fac}),i})();var ee=a("N00r"),ae=a("EY2u"),te=a("HDdC"),oe=a("D0XW"),ne=a("Y7HM");function ce(i=0,e=oe.a){return(!Object(ne.a)(i)||i<0)&&(i=0),e&&"function"==typeof e.schedule||(e=oe.a),new te.a(a=>(a.add(e.schedule(re,i,{subscriber:a,counter:0,period:i})),a))}function re(i){const{subscriber:e,counter:a,period:t}=i;e.next(a),this.schedule({subscriber:e,counter:a+1,period:t},t)}var se=a("QLoi"),le=a("7D9o"),de=a("qXBG"),be=a("zLRh");class he{}var ge=a("JIr8"),me=a("jLKh"),ue=a("GyhO");function pe(i,e){if(1&i&&(c.Tb(0,"option",13),c.Oc(1),c.Sb()),2&i){const i=e.$implicit;c.mc("value",i.codiceFiscale),c.Bb(1),c.Qc(" ",i.dati," ")}}function fe(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div"),c.Tb(1,"div",6),c.Tb(2,"label",7),c.Oc(3),c.gc(4,"translate"),c.Sb(),c.Sb(),c.Tb(5,"div",8),c.Tb(6,"select",9),c.bc("ngModelChange",(function(e){return c.Ec(i),c.fc().selectedCUAADD=e})),c.Mc(7,pe,2,2,"option",10),c.Sb(),c.Sb(),c.Tb(8,"div",11),c.Tb(9,"button",12),c.bc("debounceClick",(function(){return c.Ec(i),c.fc().Save()})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=c.fc();c.Bb(3),c.Qc(" ",c.hc(4,3,"ANTIMAFIA.codiceFiscaleRichiedente")," "),c.Bb(3),c.mc("ngModel",i.selectedCUAADD),c.Bb(1),c.mc("ngForOf",i.rappresentantiLegali)}}let ve=(()=>{class i{constructor(i,e,a,t,o,n){this.http=i,this._configuration=e,this.antimafiaService=a,this.messages=t,this.loader=o,this.authService=n,this.codiciCaricheRappresentanteLegale=["ACR","ADP","AMD","AMG","AMM","AMP","AMS","APR","ART","ATI","AUN","AUP","CDP","CDT","CLR","CM","CMS","COA","COD","COG","COL","COM","COP","COV","COZ","CRT","CST","CUE","CUF","CUM","IN","LER","LGR","LGT","LI","LIG","LR2","LRF","LRT","LSA","MPP","OAS","OPN","PAD","PCA","PCD","PCE","PCG","PCO","PDC","PDI","PED","PEO","PG","PGD","PGE","PGS","PM","PPP","PRE","PRP","PRQ","PSE","PSS","PTE","RAF","RAP","RAS","RES","RFM","RIN","RIT","RSS","SAO","SAP","SCR","SFC","SLR","SOA","SOL","SOR","SOT","SOU","SPR","TI","TI2","TIT","TTE","TU","UM1","VPC"],this.selectedCuaa=new c.n,this.personeGiuridicheSede=[],this.callsPersonaGiuridica=[]}ngOnInit(){console.log("ngOnInit cuaaImpresa "+this.cuaaImpresa),this.cuaaImpresa&&0!=this.cuaaImpresa.length&&(this.loader.setTimeout(48e4),this.utenteConnesso=this.authService.getUser().codiceFiscale,this.caricaRappresentantiLegali())}ngOnDestroy(){this.loader.resetTimeout()}getDettaglioCompletoImpresa(i){const e=this._configuration.UrlGetAnagraficaImpresa.replace("${cuaa}",String(i));return this.http.get(e).pipe(Object(p.a)(e=>{if(console.log("getDettaglioCompletoImpresa cuaa : "+i),"OK"===e.header.esito){const i=encodeURIComponent(JSON.stringify({numeroREASede:e.dati.listaimprese.estremiimpresa[0].datiiscrizionerea[0].nrea,provinciaSede:e.dati.listaimprese.estremiimpresa[0].datiiscrizionerea[0].cciaa})),a=this._configuration.UrlGetDettaglioCompletoImpresa+i;return console.log("getDettaglioCompletoImpresa paramsIn : "+i),this.antimafiaService.rappresentatiLegali(a)}if("NESSUNA IMPRESA TROVATA"!==e.dati.errore.msgerr)return this.messages.add(m.a.getToast("tst",m.b.error,e.dati.errore.msgerr)),ae.a;this.messages.add(m.a.getToast("tst",m.b.error,"Nessuna impresa trovata presso la Camera di Commercio"))}))}caricaRappresentantiLegali(){this.getDettaglioCompletoImpresa(this.cuaaImpresa).subscribe(i=>{this.rappresentantiLegali=[],this.personeSede=i.dati.datiimpresa.personesede.persona;for(const e of i.dati.datiimpresa.personesede.persona)e.cariche.carica.forEach(i=>{-1!==this.codiciCaricheRappresentanteLegale.indexOf(i.ccarica)&&(e.personafisica&&this.rappresentantiLegali.push(new me.a(e.personafisica.codicefiscale,e.personafisica.nome+" "+e.personafisica.cognome+" - "+i.descrizione)),e.personagiuridica&&this.callsPersonaGiuridica.push(this.getDettaglioCompletoImpresa(e.personagiuridica.codicefiscale)))});if(this.rappresentantiLegali&&this.rappresentantiLegali[0]){const i=this.rappresentantiLegali.find(i=>i.codiceFiscale===this.utenteConnesso);this.selectedCUAADD=i?i.codiceFiscale:this.rappresentantiLegali[0].codiceFiscale}},i=>{console.log("Error",i),this.messages.add(m.a.getToast("generic",m.b.error,"Errore in recupero rappresentanti: "+i.error.message))},()=>{Object(ue.a)(...this.callsPersonaGiuridica).subscribe({next:i=>{for(const e of i.dati.datiimpresa.personesede.persona)for(const i of e.cariche.carica)-1!==this.codiciCaricheRappresentanteLegale.indexOf(i.ccarica)&&e.personafisica&&(console.log("personagiuridica push: "+e.personafisica.codicefiscale),this.rappresentantiLegali.push(new me.a(e.personafisica.codicefiscale,e.personafisica.nome+" "+e.personafisica.cognome+" - "+i.descrizione)))}})})}Save(){this.selectedCUAADD&&(console.log("emit "+this.selectedCUAADD),this.selectedCuaa.emit(this.selectedCUAADD))}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(di.b),c.Nb(ri.a),c.Nb(b.a),c.Nb(f.d),c.Nb(u.a),c.Nb(de.a))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-select-richiedente"]],inputs:{cuaaImpresa:"cuaaImpresa"},outputs:{selectedCuaa:"selectedCuaa"},decls:10,vars:5,consts:[["position","top-center","key","generic",3,"baseZIndex"],[1,"ui-grid-fixed"],[1,"richiesta-title"],[1,"ui-g"],[1,"boxgrey"],[4,"ngIf"],[1,"ui-g-12","ui-md-2"],["id","basic-addon1",2,"margin-top","10px"],[1,"ui-g-12","ui-md-8"],["name","selectCUAA",1,"custom-select",2,"height","47px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"ui-g-12","ui-md-2","searchbutton"],["appDebounceClick","","pButton","","label","Crea Domanda",2,"width","100%",3,"debounceClick"],[3,"value"]],template:function(i,e){1&i&&(c.Ob(0,"p-toast",0),c.Ob(1,"br"),c.Ob(2,"br"),c.Tb(3,"div",1),c.Tb(4,"h2",2),c.Oc(5),c.gc(6,"translate"),c.Sb(),c.Tb(7,"div",3),c.Tb(8,"div",4),c.Mc(9,fe,10,5,"div",5),c.Sb(),c.Sb(),c.Sb()),2&i&&(c.mc("baseZIndex",5e4),c.Bb(5),c.Pc(c.hc(6,3,"ANTIMAFIA.richiestaCerificazioneAntimafia")),c.Bb(4),c.mc("ngIf",e.rappresentantiLegali))},directives:[v.a,t.t,N.E,N.s,N.v,t.s,z.a,S.b,N.x,N.H],pipes:[w.d],styles:[""]}),i})();function Se(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div"),c.Tb(1,"app-select-richiedente",5),c.bc("selectedCuaa",(function(e){return c.Ec(i),c.fc().selected(e)})),c.Sb(),c.Sb()}if(2&i){const i=c.fc();c.Bb(1),c.mc("cuaaImpresa",i.cuaaImpresa)}}function ze(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div"),c.Tb(1,"app-sintesi-antimafia-list",6),c.bc("newDichiarazione",(function(){return c.Ec(i),c.fc().rerouteAntimafia()})),c.Sb(),c.Sb()}if(2&i){const i=c.fc();c.Bb(1),c.mc("dichiarazioniAntimafia",i.listaDichiarazioni)}}function Te(i,e){if(1&i){const i=c.Ub();c.Tb(0,"div",7),c.Ob(1,"i",8),c.Tb(2,"h3"),c.Oc(3),c.Sb(),c.Tb(4,"p"),c.Oc(5),c.Sb(),c.Sb(),c.Tb(6,"div",9),c.Tb(7,"div",10),c.Tb(8,"button",11),c.bc("click",(function(){return c.Ec(i),c.fc().onConfirmUpdateAndCreateNew()})),c.Sb(),c.Sb(),c.Tb(9,"div",10),c.Tb(10,"button",12),c.bc("click",(function(){return c.Ec(i),c.fc().onRejectUpdateAndCreateNew()})),c.Sb(),c.Sb(),c.Sb()}if(2&i){const i=e.$implicit;c.Bb(3),c.Pc(i.summary),c.Bb(2),c.Pc(i.detail)}}const Ae=function(){return{marginTop:"70px"}},Ie=[{path:"",component:(()=>{class i{constructor(i,e,a,t,o,n,c,r,s,l,d,b){this.route=i,this.router=e,this.dichiarazioneAntimafiaService=a,this.antimafiaService=t,this.fascicoloCorrente=o,this.messageService=n,this.authservice=c,this.homeservice=r,this.istruttoriaAntimafiaService=s,this.loader=l,this.fascicoloService=d,this.errorService=b,this.showLista=!1}ngOnInit(){this.getDichiarazioniAntimafia(),this.loader.setTimeout(9e5)}getDichiarazioniAntimafia(){if(null==this.fascicoloCorrente||null==this.fascicoloCorrente.fascicoloLegacy||null==this.fascicoloCorrente.fascicoloLegacy.cuaa)this.getFascicoloAgsByCuaaSub=this.route.params.pipe(Object(p.a)(i=>this.fascicoloService.getLegacy(i.idFascicolo)),Object(ge.a)(i=>(this.errorService.showError(i),ae.a)),Object(p.a)(i=>{this.fascicoloCorrente.fascicoloLegacy=i;const e=new n.a;return e.azienda=new g.a,e.azienda.cuaa=this.fascicoloCorrente.fascicoloLegacy.cuaa,this.antimafiaService.getDichiarazioniAntimafia(e)})).subscribe(i=>{this.listaDichiarazioni=i||[],this.rerouteAntimafia()},i=>this.errorService.showError(i));else{const i=new n.a;i.azienda=new g.a,i.azienda.cuaa=this.fascicoloCorrente.fascicoloLegacy.cuaa,this.getFascicoloAgsByCuaaSub=this.antimafiaService.getDichiarazioniAntimafia(i).subscribe(i=>{this.listaDichiarazioni=i||[],this.rerouteAntimafia()},i=>this.errorService.showError(i))}}selected(i){i&&(this.cfRichiedente=i,this.rerouteAntimafiaCreaDomanda(i))}rerouteAntimafiaCreaDomanda(i){if(this.showLista=!1,this.listaDichiarazioni=this.listaDichiarazioni.filter(i=>"CHIUSA"!==i.stato.identificativo),this.listaDichiarazioni.filter(i=>"BOZZA"===i.stato.identificativo),0===this.listaDichiarazioni.length){const i=new n.a;i.azienda=new g.a,i.azienda.cuaa=this.fascicoloCorrente.fascicoloLegacy.cuaa,this.newDichiarazione(i,this.cfRichiedente)}else{const i=this.listaDichiarazioni.filter(i=>"BOZZA"!==i.stato.identificativo);!m.a.isUndefinedOrNull(i)&&i.length>0?(this.currentDichiarazioneAntimafia=i[0],this.showWarnDomandaProtocollata(this.fascicoloCorrente.fascicoloLegacy.cuaa)):(this.messageService.add(m.a.getToast("errorCreazioneDichiarazione",m.b.warn,"ATTENZIONE: Esistono pi\xf9 domande in stato BOZZA")),ce(3e3).subscribe(i=>{this.router.navigate(["./"],{relativeTo:this.route.parent})}))}}rerouteAntimafia(){this.showLista=!1,this.listaDichiarazioni=this.listaDichiarazioni.filter(i=>"CHIUSA"!==i.stato.identificativo);const i=this.listaDichiarazioni.filter(i=>"BOZZA"===i.stato.identificativo);if(0===this.listaDichiarazioni.length){if(!this.authservice.isUserPrivate()||!this.homeservice.isAziendaUtente(this.cuaaImpresa))return this.cuaaImpresa=this.fascicoloCorrente.fascicoloLegacy.cuaa,void console.log("cuaaImpresa rerouteAntimafia"+this.cuaaImpresa)}else if(1===i.length)this.router.navigate(["./"+i[0].id],{relativeTo:this.route});else{const i=this.listaDichiarazioni.filter(i=>"BOZZA"!==i.stato.identificativo);if(!m.a.isUndefinedOrNull(i)&&i.length>0){if(!this.authservice.isUserPrivate()||!this.homeservice.isAziendaUtente(this.cuaaImpresa))return this.cuaaImpresa=this.fascicoloCorrente.fascicoloLegacy.cuaa,void console.log("cuaaImpresa rerouteAntimafia more bozza"+this.cuaaImpresa)}else this.messageService.add(m.a.getToast("errorCreazioneDichiarazione",m.b.warn,"ATTENZIONE: Esistono pi\xf9 domande in stato BOZZA")),ce(3e3).subscribe(i=>{this.router.navigate(["./"],{relativeTo:this.route.parent.parent})})}}newDichiarazione(i,e){const a=new h.b;a.richiedente=new h.c,a.richiedente.codiceFiscale=e,console.log("Nuova dichiatazione utente "+e+" azienda "+this.fascicoloCorrente.fascicoloLegacy.cuaa),i.datiDichiarazione=a,this.antimafiaService.creaDichiarazioneAntimafia(i).subscribe(e=>{i.id=e,this.dichiarazioneAntimafiaService.setDichiarazioneAntimafia(i),this.router.navigate(["./"+i.id],{relativeTo:this.route})},i=>{console.log("Error",i),this.handleError(i)})}handleError(i){this.messageService.add(m.a.getToast("errorCreazioneDichiarazione",m.b.error,i.error.message?i.error.message:i.error))}onRejectUpdateAndCreateNew(){this.messageService.clear("warn-stato-protocollata"),this.router.navigate(["./"],{relativeTo:this.route.parent})}onConfirmUpdateAndCreateNew(){this.messageService.clear("warn-stato-protocollata");const i=new he;i.daChiudere=this.currentDichiarazioneAntimafia;const e=new n.a;e.azienda=new g.a,e.azienda.cuaa=this.fascicoloCorrente.fascicoloLegacy.cuaa;const a=new h.b;a.richiedente=new h.c,a.richiedente.codiceFiscale=this.cfRichiedente,e.datiDichiarazione=a,i.exNovo=e,this.antimafiaService.chiudiAndRicreaDichiarazioneAntimafia(i).subscribe(i=>{i.creataNuovaDichiarazione&&(this.dichiarazioneAntimafiaService.setDichiarazioneAntimafia(i.dichiarazione),this.router.navigate(["./"+i.dichiarazione.id],{relativeTo:this.route}))},i=>{console.log("Error",i),this.handleError(i)})}showWarnDomandaProtocollata(i){this.messageService.add(m.a.getToast("warn-stato-protocollata",m.b.warn,m.a.CHECK_DICHIARAZIONE_PROTOCOLLATA(i)))}ngOnDestroy(){this.loader.resetTimeout(),this.sub&&this.sub.unsubscribe(),this.getFascicoloAgsByCuaaSub&&this.getFascicoloAgsByCuaaSub.unsubscribe()}}return i.\u0275fac=function(e){return new(e||i)(c.Nb(o.a),c.Nb(o.e),c.Nb(r),c.Nb(b.a),c.Nb(Hi.a),c.Nb(f.d),c.Nb(de.a),c.Nb(se.a),c.Nb(le.a),c.Nb(u.a),c.Nb(be.a),c.Nb(ee.a))},i.\u0275cmp=c.Hb({type:i,selectors:[["app-antimafia"]],decls:6,vars:10,consts:[[4,"ngIf"],["key","errorCreazioneDichiarazione"],["key","tst"],["position","center","key","warn-stato-protocollata","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"cuaaImpresa","selectedCuaa"],[3,"dichiarazioniAntimafia","newDichiarazione"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){1&i&&(c.Mc(0,Se,2,1,"div",0),c.Mc(1,ze,2,1,"div",0),c.Ob(2,"p-toast",1),c.Ob(3,"p-toast",2),c.Tb(4,"p-toast",3),c.bc("onClose",(function(){return e.onRejectUpdateAndCreateNew()})),c.Mc(5,Te,11,2,"ng-template",4),c.Sb()),2&i&&(c.mc("ngIf",e.cuaaImpresa),c.Bb(1),c.mc("ngIf",e.showLista),c.Bb(1),c.Kc(c.rc(8,Ae)),c.Bb(1),c.Kc(c.rc(9,Ae)),c.Bb(1),c.mc("modal",!0)("baseZIndex",5e3))},directives:[t.t,v.a,f.e,ve,qi,S.b],styles:[""]}),i})(),pathMatch:"full"},{path:"lista",component:qi,pathMatch:"full"},{path:"richiedente",component:ve,pathMatch:"full"},{path:":idDichiarazione",component:Qi,resolve:{dichiarazione:ie},data:{mybreadcrumb:"Domanda Antimafia"}}];let Oe=(()=>{class i{}return i.\u0275mod=c.Lb({type:i}),i.\u0275inj=c.Kb({factory:function(e){return new(e||i)},providers:[{provide:r,useClass:r}],imports:[[o.i.forChild(Ie),Xi.a]]}),i})();var Ce=a("Mqm0"),ye=a("A+aF"),De=(a("Z7TK"),a("tQ6G"));let Pe=(()=>{let i=class{};return i.\u0275mod=c.Lb({type:i}),i.\u0275inj=c.Kb({factory:function(e){return new(e||i)},imports:[[t.c,f.f,De.b],f.f]}),i})();var Ee=a("yhG/"),Fe=a("3u2U"),Re=a("GdHY");a("P/hZ");let Be=(()=>{let i=class{};return i.\u0275mod=c.Lb({type:i}),i.\u0275inj=c.Kb({factory:function(e){return new(e||i)},imports:[[t.c]]}),i})(),Ne=(()=>{class i{}return i.\u0275mod=c.Lb({type:i}),i.\u0275inj=c.Kb({factory:function(e){return new(e||i)},providers:[r,ie,Ce.a,f.d],imports:[[t.c,Oe,N.m,Xi.a,H.t,M.b,S.c,ye.b,d.b,Pe,gi.b,Ee.b,hi.b,v.b,K.b,G.b,Fe.b,Re.b,Be]]}),i})()}}]);