(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"2mgZ":function(i,t,e){"use strict";e.r(t),e.d(t,"IstruttoriaAntimafiaModule",(function(){return Gt}));var a=e("ofXK"),n=e("tyNb"),o=e("wH++"),s=e("8PIW");class c{}var r=e("69Tm"),l=e("7D9o"),d=e("8k9x"),b=e("q1/g"),u=e("Tn7N"),m=e("PqYM"),p=e("dkQB"),g=e("eIep"),h=e("fXoL"),f=e("tk/3"),S=e("sYmb"),A=e("rgW5"),T=e("RtSl");class I{constructor(i){this.cuaa=i}}class O{}var z=e("arS9"),v=e("GLSp"),C=e("yWug"),D=e("A1Yd"),P=e("FK/F");function B(i,t){if(1&i&&(h.Tb(0,"th",15),h.Oc(1),h.Ob(2,"p-sortIcon",16),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.field)}}function N(i,t){if(1&i&&(h.Tb(0,"tr"),h.Mc(1,B,3,4,"th",13),h.Tb(2,"th",14),h.Oc(3),h.Sb(),h.Tb(4,"th",14),h.Oc(5),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.mc("ngForOf",i),h.Bb(2),h.Qc(" ",e.intestazioni.collegate," "),h.Bb(2),h.Qc(" ",e.intestazioni.azioni," ")}}function M(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr",17),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.gc(7,"date"),h.Sb(),h.Tb(8,"td",18),h.Tb(9,"div",19),h.Tb(10,"div",20),h.Tb(11,"p-button",21),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,0)})),h.Sb(),h.Sb(),h.Tb(12,"div",20),h.Tb(13,"p-button",22),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,1)})),h.Sb(),h.Sb(),h.Tb(14,"div",20),h.Tb(15,"p-button",23),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,2)})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(16,"td"),h.Tb(17,"action-menu",24,25),h.bc("click",(function(){h.Ec(i);const e=t.$implicit,a=t.rowIndex,n=h.Bc(18);return h.fc().onDropdownMenuOpen(n,e,a)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.mc("pSelectableRow",i),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.denominazione),h.Bb(2),h.Pc(h.ic(7,11,i.dtInizioCompilazione,"dd/MM/yyyy")),h.Bb(5),h.nc("title",e.intestazioni.DOMANDE_SUPERFICIE_EU),h.mc("disabled",!(i.idsDomandaSuperficie.length>0)),h.Bb(2),h.nc("title",e.intestazioni.DOMANDE_STRUTTURALI_EU),h.mc("disabled",!(i.idsDomandaStrutturale.length>0)),h.Bb(2),h.nc("title",e.intestazioni.DOMANDE_UNICHE),h.mc("disabled",!(i.idsDomandaDu.length>0)),h.Bb(2),h.mc("item",e.menuAction)}}function E(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.Cb("colspan",i.length+2),h.Bb(1),h.Qc(" ",e.intestazioni.noTableContent," ")}}function y(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",26),h.Ob(1,"i",27),h.Tb(2,"h3"),h.Oc(3),h.Sb(),h.Tb(4,"p"),h.Oc(5),h.Sb(),h.Sb(),h.Tb(6,"div",28),h.Tb(7,"div",29),h.Tb(8,"button",30),h.bc("click",(function(){return h.Ec(i),h.fc().onConfirmAggiornaStato()})),h.Sb(),h.Sb(),h.Tb(9,"div",29),h.Tb(10,"button",31),h.bc("click",(function(){return h.Ec(i),h.fc().onRejectAggiornaStato()})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit;h.Bb(3),h.Pc(i.summary),h.Bb(2),h.Pc(i.detail)}}let F=(()=>{class i{constructor(i,t,e,a,n){this.istruttoriaAntimafiaService=i,this.router=t,this.route=e,this.messages=a,this.antimafiaService=n,this.intestazioni=r.a,this.textTitle=r.a.CERTIFICAZIONE_ANTIMAFIA_BOZZA,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new O,this.elementiTotali=0,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new h.n,this.runStatoAvanzamentoProcesso=new h.n,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.intestazioni.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.intestazioni.descrizioneImpresa},{field:"dtInizioCompilazione",header:this.intestazioni.dataInizioCompilazione}]}ngOnInit(){this.menuAction=this.buildMenuAction(),this.isEmpty=!1}ngOnChanges(i){i.refreshFromParent.currentValue&&this.loadList(0,null)}checkIfIsEmpty(){return void 0===this.certificazioniBozzaView||0===this.certificazioniBozzaView.length}getDomandaAntimafiaSelezionataFromMenuAction(){return this.domandaAntimafiaSelezionataFromMenuAction}visualizzaDettaglioDomanda(i,t){let e={queryParams:{activeIndex:t,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:0},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],e)}buildMenuAction(){return[{label:r.a.azioni.toUpperCase(),items:[{label:r.a.ESITO_POSITIVO,command:()=>{this.openPopupEsitoPositivo(),this.currentMenuAction.reset=!0}}]}]}onDropdownMenuOpen(i,t,e){this.indexSelectedFromMenu=e,this.domandaAntimafiaSelezionataFromMenuAction=t,this.currentMenuAction=i,this.currentMenuAction.reset=!1}openPopupEsitoPositivo(){this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(s.a.POSITIVO)))}onConfirmAggiornaStato(){this.messages.clear(),this.esitoPositivo()}onRejectAggiornaStato(){this.messages.clear()}esitoPositivo(){let i=this.domandaAntimafiaSelezionataFromMenuAction;i.stato.descrizione=null,i.stato.id=null,i.stato.identificativo=s.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe(i=>{let t=new I(this.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);this.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe(i=>{i&&i.forEach(e=>{e.cuaa===t.cuaa&&(e.dtFineEsitoNegativo=null,e.dtFineSilenzioAssenso=null,e.dtInizioEsitoNegativo=null,e.dtInizioSilenzioAssenso=null),this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(i)}),this.loadList(0,null)},i=>console.log(i))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))})}loadData(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){let t="";switch(i.sortField){case this.cols[0].field:t="cuaa";break;case this.cols[1].field:t="denominazioneImpresa";break;default:t=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(t)}this.loadList(i.first,i.globalFilter)}loadList(i,t){this.ricercaAntimafiaFilter.filtroGenerico=t||null,this.ricercaAntimafiaFilter.statoDichiarazione=s.a.BOZZA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe(i=>{this.elementiTotali=i.total,this.certificazioniBozza=i.results?i.results:[],this.certificazioniBozzaView=this.certificazioniBozza,this.isEmpty=0===this.certificazioniBozza.length},i=>{console.log("error: "+i),this.isEmpty=!0})}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(l.a),h.Nb(n.e),h.Nb(n.a),h.Nb(T.d),h.Nb(o.a))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-cert-amf-bozza"]],inputs:{refreshFromParent:"refreshFromParent",itemBadges:"itemBadges"},outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters",runStatoAvanzamentoProcesso:"runStatoAvanzamentoProcesso"},features:[h.zb],decls:16,vars:13,consts:[[1,"ui-grid-fixed","boxgrey"],["position","top-center","key","generic",3,"baseZIndex"],[1,"layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",0),h.Ob(1,"p-toast",1),h.Tb(2,"div",2),h.Tb(3,"h3"),h.Oc(4),h.Sb(),h.Tb(5,"div",3),h.Tb(6,"i",4),h.Oc(7,"search"),h.Sb(),h.Tb(8,"input",5),h.bc("input",(function(t){return h.Ec(i),h.Bc(10).filterGlobal(t.target.value,"contains")})),h.Sb(),h.Sb(),h.Tb(9,"p-table",6,7),h.bc("onLazyLoad",(function(i){return t.loadData(i)})),h.Mc(11,N,6,3,"ng-template",8),h.Mc(12,M,19,14,"ng-template",9),h.Mc(13,E,3,2,"ng-template",10),h.Sb(),h.Sb(),h.Sb(),h.Tb(14,"p-toast",11),h.bc("onClose",(function(){return t.onRejectAggiornaStato()})),h.Mc(15,y,11,2,"ng-template",12),h.Sb()}2&i&&(h.Bb(1),h.mc("baseZIndex",5e4),h.Bb(3),h.Pc(t.textTitle),h.Bb(5),h.mc("columns",t.cols)("value",t.certificazioniBozzaView)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",t.elementiTotali)("rowsPerPageOptions",t.intestazioni.sizePerPagina),h.Bb(5),h.mc("modal",!0)("baseZIndex",5e3))},directives:[z.a,v.a,C.q,T.e,a.s,C.p,C.o,C.m,D.a,P.a,D.b],pipes:[a.f],styles:[""]}),i})();var R=e("lJxs"),_=e("LRne"),w=e("Rt+w"),x=e("D0mR"),U=e("x5p7");function L(i,t){if(1&i&&(h.Tb(0,"th",16),h.Oc(1),h.Ob(2,"p-sortIcon-wrapper",17),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumnWrapper",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.field)}}function k(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"th",14),h.Ob(2,"app-a4g-paged-table-checkbox"),h.Sb(),h.Mc(3,L,3,4,"th",15),h.Tb(4,"th",14),h.Oc(5),h.Sb(),h.Tb(6,"th",14),h.Oc(7),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(3),h.mc("ngForOf",i),h.Bb(2),h.Qc(" ",e.intestazioni.collegate," "),h.Bb(2),h.Qc(" ",e.intestazioni.azioni," ")}}function V(i,t){if(1&i&&h.Ob(0,"div",31),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function $(i,t){if(1&i&&h.Ob(0,"div",32),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function G(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr",18),h.Tb(1,"td"),h.Ob(2,"p-tableCheckbox-wrapper",19),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.Sb(),h.Tb(7,"td"),h.Oc(8),h.gc(9,"date"),h.Sb(),h.Tb(10,"td"),h.Oc(11),h.gc(12,"translate"),h.Sb(),h.Tb(13,"td"),h.Tb(14,"div",20),h.Mc(15,V,1,1,"div",21),h.Mc(16,$,1,1,"div",22),h.Sb(),h.Sb(),h.Tb(17,"td",23),h.Tb(18,"div",24),h.Tb(19,"div",25),h.Tb(20,"p-button",26),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,0)})),h.Sb(),h.Sb(),h.Tb(21,"div",25),h.Tb(22,"p-button",27),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,1)})),h.Sb(),h.Sb(),h.Tb(23,"div",25),h.Tb(24,"p-button",28),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,2)})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(25,"td"),h.Tb(26,"action-menu",29,30),h.bc("click",(function(){h.Ec(i);const e=t.$implicit,a=t.rowIndex,n=h.Bc(27);return h.fc().onDropdownMenuOpen(n,e,a)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.mc("pSelectableRowWrapper",i),h.Bb(2),h.mc("value",i),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.denominazione),h.Bb(2),h.Pc(h.ic(9,15,i.dtProtocollazione,"dd/MM/yyyy")),h.Bb(3),h.Pc(null!=i.idProtocollo?i.idProtocollo:h.hc(12,18,"gestioneUtenze.IN_PROTOCOLLAZIONE")),h.Bb(4),h.mc("ngIf","OK"===i.esito),h.Bb(1),h.mc("ngIf","KO"===i.esito),h.Bb(4),h.nc("title",e.intestazioni.DOMANDE_SUPERFICIE_EU),h.mc("disabled",!(i.idsDomandaSuperficie.length>0)),h.Bb(2),h.nc("title",e.intestazioni.DOMANDE_STRUTTURALI_EU),h.mc("disabled",!(i.idsDomandaStrutturale.length>0)),h.Bb(2),h.nc("title",e.intestazioni.DOMANDE_UNICHE),h.mc("disabled",!(i.idsDomandaDu.length>0)),h.Bb(2),h.mc("item",e.menuAction)}}function Z(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.Cb("colspan",i.length+3),h.Bb(1),h.Qc(" ",e.intestazioni.noTableContent," ")}}function K(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",33),h.Ob(1,"i",34),h.Tb(2,"h3"),h.Oc(3),h.Sb(),h.Tb(4,"p"),h.Oc(5),h.Sb(),h.Sb(),h.Tb(6,"div",35),h.Tb(7,"div",36),h.Tb(8,"button",37),h.bc("click",(function(){return h.Ec(i),h.fc().onConfirmAggiornaStato()})),h.Sb(),h.Sb(),h.Tb(9,"div",36),h.Tb(10,"button",38),h.bc("click",(function(){return h.Ec(i),h.fc().onRejectAggiornaStato()})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit;h.Bb(3),h.Pc(i.summary),h.Bb(2),h.Pc(i.detail)}}let j=(()=>{class i{constructor(i,t,e,a,n){this.antimafiaService=i,this.messages=t,this.istruttoriaAntimafiaService=e,this.route=a,this.router=n,this.intestazioni=r.a,this.textTitle=r.a.istruttoriaCertificazioneAntimafia,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new O,this.elementiTotali=0,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new h.n,this.runStatoAvanzamentoProcesso=new h.n,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.intestazioni.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.intestazioni.descrizioneImpresa},{field:"dtProtocollazione",header:this.intestazioni.data},{field:"idProtocollo",header:this.intestazioni.nrProtocollo},{field:"esito",header:this.intestazioni.esitoTrasmissione}]}ngOnInit(){this.menuAction=this.menuActionProtocollata(),this.isEmpty=!1}ngOnDestroy(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}ngOnChanges(i){i.refreshFromParent.currentValue&&this.loadList(0,null)}checkIfIsEmpty(){return void 0===this.certificazioniProtocollateView||0===this.certificazioniProtocollateView.length}avviaControllo(){this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length?(this.certificazioneProtocollateSelezionate.map(i=>i.id),Object(_.a)(this.isSelectedAll).pipe(Object(g.a)(i=>i?this.istruttoriaAntimafiaService.getCertificazioniAntimafiaByStato(s.a.PROTOCOLLATA).pipe(Object(R.a)(i=>i.results.map(i=>i.id))):Object(_.a)(this.certificazioneProtocollateSelezionate.map(i=>i.id)))).subscribe(i=>{console.log("SelectAll active: ",i),this.antimafiaService.avviaControllo(i).subscribe(t=>{this.runStatoAvanzamentoProcesso.emit(i.length),this.messages.add(u.a.getToast("generic",u.b.success,u.a.processoAvviatoOK))},i=>{this.messages.add(u.a.getToast("generic",u.b.warn,"BRIAMPRT001"!==i.error.message?"IMPPSRSUPERR"!==i.error.message?u.a.BRIAMPRT003:u.a.IMPPSRSUPERR:u.a.BRIAMPRT001))})})):this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMPRT001))}onDropdownMenuOpen(i,t,e){this.indexSelectedFromMenu=e,this.domandaAntimafiaSelezionataFromMenuAction=t,this.currentMenuAction=i,this.currentMenuAction.reset=!1}downloadDomandaCertificazioneAntimafia(){const i=this.getDomandaAntimafiaSelezionataFromMenuAction(),t=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(i.id.toString());this.dichiarazioneAntimafiaSubscpription=t.pipe(Object(g.a)(t=>(i.pdfFirmato=t.pdfFirmato,this.antimafiaService.downloadDichiarazioneAntimafia(t.pdfFirmato,t.tipoPdfFirmato),Object(_.a)(t)))).subscribe(i=>{const t=this.antimafiaService.getAllegati(i);this.antimafiaService.downloadAllegati(t)})}getDomandaAntimafiaSelezionataFromMenuAction(){return this.domandaAntimafiaSelezionataFromMenuAction}menuActionProtocollata(){return[{label:r.a.azioni.toUpperCase(),items:[{label:r.a.SCARICA,command:()=>{this.downloadDomandaCertificazioneAntimafia(),this.currentMenuAction.reset=!0}},{label:r.a.ESITO_POSITIVO,command:()=>{this.openPopupEsitoPositivo(),this.currentMenuAction.reset=!0}}]}]}visualizzaDettaglioDomanda(i,t){let e={queryParams:{activeIndex:t,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:1},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],e)}openPopupEsitoPositivo(){this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(s.a.POSITIVO)))}onConfirmAggiornaStato(){this.messages.clear(),this.esitoPositivo()}onRejectAggiornaStato(){this.messages.clear()}esitoPositivo(){let i=this.domandaAntimafiaSelezionataFromMenuAction;i.stato.descrizione=null,i.stato.id=null,i.stato.identificativo=s.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe(i=>{let t=new I(this.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);this.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe(i=>{i&&i.forEach(e=>{e.cuaa===t.cuaa&&(e.dtFineEsitoNegativo=null,e.dtFineSilenzioAssenso=null,e.dtInizioEsitoNegativo=null,e.dtInizioSilenzioAssenso=null),this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(i)}),this.loadList(0,null)},i=>console.log(i))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))})}loadData(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){let t="";switch(i.sortField){case this.cols[0].field:t="cuaa";break;case this.cols[1].field:t="denominazioneImpresa";break;default:t=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(t)}this.loadList(i.first,i.globalFilter)}loadList(i,t){this.ricercaAntimafiaFilter.filtroGenerico=t||null,this.ricercaAntimafiaFilter.statoDichiarazione=s.a.PROTOCOLLATA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe(i=>{this.elementiTotali=i.total,this.certificazioniProtocollate=i.results?i.results:[],this.certificazioniProtocollateView=this.certificazioniProtocollate,this.isEmpty=0===this.certificazioniProtocollate.length},i=>{console.log("error: "+i),this.isEmpty=!0})}buildDescrizioneTooltip(i){let t=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?t+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(t+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?t+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(t+=" | ESITO INVIO A BDNA NON DISPONIBILE"),t}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(o.a),h.Nb(T.d),h.Nb(l.a),h.Nb(n.a),h.Nb(n.e))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-cert-amf-protocollate"]],inputs:{refreshFromParent:"refreshFromParent",itemBadges:"itemBadges"},outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters",runStatoAvanzamentoProcesso:"runStatoAvanzamentoProcesso"},features:[h.zb],decls:18,vars:13,consts:[[1,"ui-grid-fixed","boxgrey"],["position","top-center","key","generic",3,"baseZIndex"],[1,"layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","totalRecords","selectedItems","isSelectedAll","lazy","sizeArray","selectedItemsChange","isSelectedAllChange","onLazyLoadPage"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["appDebounceClick","",3,"disabled","label","debounceClick"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[2,"width","3em"],[3,"pSortableColumnWrapper","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumnWrapper","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRowWrapper"],[3,"value"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",0),h.Ob(1,"p-toast",1),h.Tb(2,"div",2),h.Tb(3,"h3"),h.Oc(4),h.Sb(),h.Tb(5,"div",3),h.Tb(6,"i",4),h.Oc(7,"search"),h.Sb(),h.Tb(8,"input",5),h.bc("input",(function(t){return h.Ec(i),h.Bc(10).filterGlobal(t.target.value,"contains")})),h.Sb(),h.Sb(),h.Tb(9,"app-a4g-paged-table",6,7),h.bc("selectedItemsChange",(function(i){return t.certificazioneProtocollateSelezionate=i}))("isSelectedAllChange",(function(i){return t.isSelectedAll=i}))("onLazyLoadPage",(function(i){return t.loadData(i)})),h.Mc(11,k,8,3,"ng-template",8),h.Mc(12,G,28,20,"ng-template",9),h.Mc(13,Z,3,2,"ng-template",10),h.Sb(),h.Sb(),h.Tb(14,"div"),h.Tb(15,"p-button",11),h.bc("debounceClick",(function(){return t.avviaControllo()})),h.Sb(),h.Sb(),h.Sb(),h.Tb(16,"p-toast",12),h.bc("onClose",(function(){return t.onRejectAggiornaStato()})),h.Mc(17,K,11,2,"ng-template",13),h.Sb()}2&i&&(h.Bb(1),h.mc("baseZIndex",5e4),h.Bb(3),h.Pc(t.textTitle),h.Bb(5),h.mc("columns",t.cols)("value",t.certificazioniProtocollateView)("totalRecords",t.elementiTotali)("selectedItems",t.certificazioneProtocollateSelezionate)("isSelectedAll",t.isSelectedAll)("lazy",!0)("sizeArray",t.intestazioni.sizePerPagina),h.Bb(6),h.nc("label",t.intestazioni.AVVIA_CONTROLLO),h.mc("disabled",t.checkIfIsEmpty()),h.Bb(1),h.mc("modal",!0)("baseZIndex",5e3))},directives:[z.a,v.a,w.b,T.e,D.a,x.a,w.a,a.s,w.f,w.e,w.d,w.g,a.t,P.a,U.a,D.b],pipes:[a.f,S.d],styles:[".boxgrey[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#0d5f3f;font-weight:700;font-size:18px;text-transform:uppercase;padding-bottom:10px;margin-bottom:15px}.boxgrey[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > h5[_ngcontent-%COMP%]{border-bottom:2px solid #0d5f3f}.boxgrey[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{display:inline!important}",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),i})();class Q{}class J{}var H=e("JEAp"),q=e("oPyp");e("4IZF");let W=(()=>{class i{constructor(i,t){this.http=i,this._configuration=t}getSincronizzazioneAntimafia(i){return this.http.get(this._configuration.urlSincronizzazioneAntimafia.replace("${id}",i.toString()))}putSincronizzazioneAntimafia(i,t){let e=new f.f({"Content-Type":"application/json"});return this.http.put(this._configuration.urlSincronizzazioneAntimafia.replace("${id}",i.toString()),JSON.stringify(t),{headers:e})}postSincronizzazioneAntimafia(i){let t=new f.f({"Content-Type":"application/json"});return this.http.post(this._configuration.urlPostSincronizzazioneAntimafia,JSON.stringify(i),{headers:t})}}return i.\u0275fac=function(t){return new(t||i)(h.Xb(f.b),h.Xb(p.a))},i.\u0275prov=h.Jb({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var Y=e("5gIc"),X=e("A+aF"),ii=e("3Pt+");let ti=(()=>{class i{constructor(i,t,e,a){this.antimafiaService=i,this.sincronizzazioneAntimafiaService=t,this.messages=e,this.loader=a,this.labels=r.a,this.nrProtocolloComunicazione=void 0,this.noteDiChiusura=void 0,this.event=new h.n,this.onSuccess=i=>{this.antimafiaService.creaNotaDichiarazioneAntimafia(i.id,{nrProtocolloComunicazione:this.nrProtocolloComunicazione,noteDiChiusura:this.noteDiChiusura}).subscribe(t=>{i.stato.identificativo=s.a.RIFIUTATA,i.stato.id=null,i.stato.descrizione=null,i.dtFine=new Date,this.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe(t=>{this.event.emit(),this.sincronizzazioneAntimafiaService.getSincronizzazioneAntimafia(i.id).subscribe(t=>{t&&(t.dataFineVali=new Date,this.sincronizzazioneAntimafiaService.putSincronizzazioneAntimafia(i.id,t).subscribe(()=>{this.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.BRIAMCMN007))}))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.BRIAMCMN007))})},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))})},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))})},this.areValidFields=i=>!i||!!i.trim()}ngOnInit(){this.loader.setTimeout(48e4)}ngOnDestroy(){this.loader.resetTimeout()}open(){this.headerPopup=u.a.COMUNICAZIONE_RIFIUTO_DOMANDA(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.denominazione),this.displayDialog=!0}close(){this.displayDialog=!1}conferma(i){this.areValidFields(this.nrProtocolloComunicazione)&&this.areValidFields(this.noteDiChiusura)&&(this.onSuccess(this.dichiarazioneAntimafia),this.close()),i.form.reset()}annulla(i){this.close(),i.form.reset()}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(o.a),h.Nb(W),h.Nb(T.d),h.Nb(Y.a))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-popup-rifiuta-domanda"]],inputs:{dichiarazioneAntimafia:"dichiarazioneAntimafia"},outputs:{event:"event"},decls:39,vars:34,consts:[["showEffect","fade",3,"visible","responsive","modal","closable","visibleChange"],[1,"boxgrey","boxpopup"],[1,""],[3,"ngSubmit"],["popupForm","ngForm"],[1,"form-group"],[1,"ui-g-12"],["required","","id","nrProtocollo","type","text","pInputText","","name","nrProtocollo",1,"form-control",3,"placeholder","ngModel","ngModelChange"],["nrProtocollo","ngModel"],[1,"alert","alert-danger",3,"hidden"],["required","","pInputTextarea","","name","noteChiusura",1,"form-control",3,"placeholder","ngModel","ngModelChange"],["noteChiusura","ngModel"],[1,"ui-dialog-buttonpane","ui-helper-clearfix"],["type","submit","pButton","",1,"btn","btn-darkgreen",3,"disabled","label"],["type","button","pButton","",1,"btn","btn-dark",3,"label","click"]],template:function(i,t){if(1&i){const i=h.Ub();h.Tb(0,"p-dialog",0),h.bc("visibleChange",(function(i){return t.displayDialog=i})),h.Tb(1,"div",1),h.Tb(2,"p-header"),h.Oc(3),h.Sb(),h.Tb(4,"div",2),h.Tb(5,"form",3,4),h.bc("ngSubmit",(function(){h.Ec(i);const e=h.Bc(6);return t.conferma(e)})),h.Tb(7,"div",5),h.Tb(8,"div",6),h.Tb(9,"label"),h.Oc(10),h.gc(11,"translate"),h.Sb(),h.Tb(12,"input",7,8),h.bc("ngModelChange",(function(i){return t.nrProtocolloComunicazione=i})),h.gc(14,"translate"),h.Sb(),h.Tb(15,"div",9),h.Oc(16),h.gc(17,"translate"),h.Sb(),h.Sb(),h.Tb(18,"div",5),h.Tb(19,"div",6),h.Tb(20,"label"),h.Oc(21),h.gc(22,"translate"),h.Sb(),h.Tb(23,"textarea",10,11),h.bc("ngModelChange",(function(i){return t.noteDiChiusura=i})),h.gc(25,"translate"),h.Sb(),h.Tb(26,"div",9),h.Oc(27),h.gc(28,"translate"),h.Sb(),h.Sb(),h.Sb(),h.Ob(29,"br"),h.Ob(30,"br"),h.Ob(31,"br"),h.Sb(),h.Tb(32,"p-footer"),h.Tb(33,"div",12),h.Tb(34,"div",6),h.Ob(35,"button",13),h.gc(36,"translate"),h.Tb(37,"button",14),h.bc("click",(function(){h.Ec(i);const e=h.Bc(6);return t.annulla(e)})),h.gc(38,"translate"),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=h.Bc(6),e=h.Bc(13),a=h.Bc(24);h.mc("visible",t.displayDialog)("responsive",!0)("modal",!0)("closable",!1),h.Bb(3),h.Qc(" ",t.headerPopup," "),h.Bb(7),h.Pc(h.hc(11,18,"ANTIMAFIA.COMUNICAZIONE_NR_PROTOCOLLO")),h.Bb(2),h.nc("placeholder",h.hc(14,20,"ANTIMAFIA.COMUNICAZIONE_NR_PROTOCOLLO")),h.mc("ngModel",t.nrProtocolloComunicazione),h.Bb(3),h.mc("hidden",(e.valid||e.pristine)&&t.areValidFields(t.nrProtocolloComunicazione)),h.Bb(1),h.Qc(" ",h.hc(17,22,"ANTIMAFIA.CAMPO_OBBLIGATORIO")," "),h.Bb(5),h.Pc(h.hc(22,24,"ANTIMAFIA.NOTE_DI_CHIUSURA")),h.Bb(2),h.nc("placeholder",h.hc(25,26,"ANTIMAFIA.NOTE_DI_CHIUSURA")),h.mc("ngModel",t.noteDiChiusura),h.Bb(3),h.mc("hidden",(a.valid||a.pristine)&&t.areValidFields(t.noteDiChiusura)),h.Bb(1),h.Qc(" ",h.hc(28,28,"ANTIMAFIA.CAMPO_OBBLIGATORIO")," "),h.Bb(8),h.nc("label",h.hc(36,30,"ANTIMAFIA.PROCEDI")),h.mc("disabled",!i.form.valid),h.Bb(2),h.nc("label",h.hc(38,32,"ANTIMAFIA.ANNULLA"))}},directives:[X.a,T.c,ii.I,ii.t,ii.u,ii.c,ii.D,v.a,ii.s,ii.v,T.b,D.b],pipes:[S.d],styles:[""]}),i})();var ei=e("1ozv"),ai=e("MvQ6"),ni=e("MgAl"),oi=e("1SSY"),si=e("BGwN");const ci=["file"];function ri(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",38),h.Tb(1,"p-radioButton",41),h.bc("ngModelChange",(function(t){return h.Ec(i),h.fc().selectedCampagna=t})),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.nc("value",i),h.nc("label",i),h.nc("inputId",i),h.mc("ngModel",e.selectedCampagna)}}function li(i,t){if(1&i&&(h.Tb(0,"th",44),h.Oc(1),h.Ob(2,"p-sortIcon-wrapper",45),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumnWrapper",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.field)}}function di(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"th",42),h.Ob(2,"app-a4g-paged-table-checkbox"),h.Sb(),h.Mc(3,li,3,4,"th",43),h.Tb(4,"th",42),h.Oc(5),h.Sb(),h.Tb(6,"th",42),h.Oc(7),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(3),h.mc("ngForOf",i),h.Bb(2),h.Qc(" ",e.intestazioni.collegate," "),h.Bb(2),h.Qc(" ",e.intestazioni.azioni," ")}}function bi(i,t){if(1&i&&h.Ob(0,"div",58),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function ui(i,t){if(1&i&&h.Ob(0,"div",59),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function mi(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr",46),h.Tb(1,"td"),h.Ob(2,"p-tableCheckbox-wrapper",47),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.Sb(),h.Tb(7,"td"),h.Oc(8),h.gc(9,"date"),h.Sb(),h.Tb(10,"td"),h.Oc(11),h.Sb(),h.Tb(12,"td"),h.Tb(13,"div",20),h.Mc(14,bi,1,1,"div",48),h.Mc(15,ui,1,1,"div",49),h.Sb(),h.Sb(),h.Tb(16,"td",50),h.Tb(17,"div",51),h.Tb(18,"div",52),h.Tb(19,"p-button",53),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,0)})),h.Sb(),h.Sb(),h.Tb(20,"div",52),h.Tb(21,"p-button",54),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,1)})),h.Sb(),h.Sb(),h.Tb(22,"div",52),h.Tb(23,"p-button",55),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,2)})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(24,"td"),h.Tb(25,"action-menu",56,57),h.bc("click",(function(){h.Ec(i);const e=t.$implicit,a=t.rowIndex,n=h.Bc(26);return h.fc().onDropdownMenuOpen(n,e,a)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.mc("pSelectableRowWrapper",i),h.Bb(2),h.mc("value",i),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.denominazione),h.Bb(2),h.Pc(h.ic(9,15,i.dtProtocollazione,"dd/MM/yyyy")),h.Bb(3),h.Pc(i.idProtocollo),h.Bb(3),h.mc("ngIf","OK"===i.esito),h.Bb(1),h.mc("ngIf","KO"===i.esito),h.Bb(4),h.nc("title",e.intestazioni.DOMANDE_SUPERFICIE_EU),h.mc("disabled",!(i.idsDomandaSuperficie.length>0)),h.Bb(2),h.nc("title",e.intestazioni.DOMANDE_STRUTTURALI_EU),h.mc("disabled",!(i.idsDomandaStrutturale.length>0)),h.Bb(2),h.nc("title",e.intestazioni.DOMANDE_UNICHE),h.mc("disabled",!(i.idsDomandaDu.length>0)),h.Bb(2),h.mc("item",e.menuAction)}}function pi(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.Cb("colspan",i.length+3),h.Bb(1),h.Qc(" ",e.intestazioni.noTableContent," ")}}function gi(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",60),h.Ob(1,"i",61),h.Tb(2,"h3"),h.Oc(3),h.Sb(),h.Tb(4,"p"),h.Oc(5),h.Sb(),h.Sb(),h.Tb(6,"div",62),h.Tb(7,"div",63),h.Tb(8,"button",64),h.bc("click",(function(){return h.Ec(i),h.fc().onConfirmAggiornaStato()})),h.Sb(),h.Sb(),h.Tb(9,"div",63),h.Tb(10,"button",65),h.bc("click",(function(){return h.Ec(i),h.fc().onRejectAggiornaStato()})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit;h.Bb(3),h.Pc(i.summary),h.Bb(2),h.Pc(i.detail)}}function hi(i,t){if(1&i&&(h.Tb(0,"div"),h.Oc(1),h.Sb()),2&i){const i=t.$implicit;h.Bb(1),h.Qc(" ",i," ")}}function fi(i,t){if(1&i&&(h.Tb(0,"div"),h.Oc(1),h.Sb()),2&i){const i=t.$implicit;h.Bb(1),h.Qc(" ",i," ")}}const Si=function(){return{marginTop:"70px"}},Ai=function(){return{overflow:"auto","max-height":"900px"}};let Ti=(()=>{class i{constructor(i,t,e,a,n,o,s,c){this.istruttoriaAntimafiaService=i,this.messages=t,this.router=e,this.messageService=a,this.confirmationService=n,this.route=o,this.antimafiaService=s,this.istruttoriaService=c,this.tipoDomanda=q.a,this.textTitle=r.a.istruttoriaCertificazioneAntimafia,this.intestazioni=r.a,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new O,this.elementiTotali=0,this.isSelectedAll=!1,this.dialogVisibile=!1,this.selectedCampagna="",this.menuAction=new Array,this.aggiornaCertificazioniCounters=new h.n,this.runStatoAvanzamentoProcesso=new h.n,this.sogliaAcquisizione=new J,this.activeIndexDettaglioDomande=[-1,-1,-1],this.elencoCsvDaConfermare=[],this.esitiBdna=new Q,this.checkMassiveExport=!1,this.getFileNameFromResponseContentDisposition=i=>{const t=i.headers.get("content-disposition")||"";return(/filename=([^;]+)/gi.exec(t)[1]||"untitled").trim()},this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.intestazioni.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.intestazioni.descrizioneImpresa},{field:"dtProtocollazione",header:this.intestazioni.data},{field:"idProtocollo",header:this.intestazioni.nrProtocollo},{field:"esito",header:this.intestazioni.esitoTrasmissione}]}ngOnInit(){this.recuperaTrasmissioni(),this.isEmpty=!1,this.menuAction=this.buildMenuAction(),this.recuperaAnniCampagna()}ngOnDestroy(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}ngOnChanges(i){i.refreshFromParent.currentValue&&this.loadList(0,null)}recuperaAnniCampagna(){this.istruttoriaService.caricaAnniCampagna(ni.a.PAC_2014_2020).toPromise().then(i=>{console.log("anni campagna",i),this.campagne=i})}recuperaTrasmissioni(){this.elencoCsvDaConfermare=[],this.istruttoriaAntimafiaService.getTrasmissioniDaConfermare(null).subscribe(i=>{i&&i.length>0&&i.forEach(i=>{let t=new a.f("it-IT").transform(i.dtCreazione,"yyyyMMdd_HHmmss"),e="";e=e.concat(i.cfOperatore).concat("_").concat("Flusso_"),i.tipoDomanda==q.a.DOMANDA_UNICA&&(e=e.concat("DU_").concat(t)),i.tipoDomanda==q.a.PSR_STRUTTURALI_EU&&(e=e.concat("PSR_STR_").concat(t)),i.tipoDomanda==q.a.PSR_SUPERFICIE_EU&&(e=e.concat("PSR_SUP_").concat(t)),e=e.concat(".csv"),this.elencoCsvDaConfermare.push({label:e,value:i})})})}openDialog(i){this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length?(this.checkMassiveExport=i,this.dialogVisibile=!0):this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMCNT002))}annullaImportPsrSuperficie(){this.dialogVisibile=!1,this.selectedCampagna=""}confermaImportPsrSuperficie(){this.selectedCampagna&&0!==this.selectedCampagna.length&&(this.confirmationService.confirm({message:"Il processo di acquisizione delle domande richiede un tempo proporzionale al numero di domande selezionate. E' possibile visualizzare l'avanzamento nella barra dei processi.",header:"ATTENZIONE",icon:"pi pi-exclamation-triangle",accept:()=>{this.importSuperficieEU()},reject:()=>{this.messageService.add(u.a.getToast("tst",u.b.reject,u.a.operazioneAnnullata))}}),this.dialogVisibile=!1)}importSuperficieEU(){this.sogliaAcquisizione.settore=q.a.PSR_SUPERFICIE_EU,this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length?this.istruttoriaAntimafiaService.getSogliaAcquisizione(this.sogliaAcquisizione).subscribe(i=>{Object(_.a)(this.isSelectedAll).pipe(Object(g.a)(i=>i?this.istruttoriaAntimafiaService.getCertificazioniAntimafiaByStato(s.a.CONTROLLATA).pipe(Object(R.a)(i=>i.results.map(i=>i.datiDichiarazione.dettaglioImpresa.codiceFiscale))):Object(_.a)(this.certificazioneProtocollateSelezionate.map(i=>i.datiDichiarazione.dettaglioImpresa.codiceFiscale)))).subscribe(t=>{this.istruttoriaAntimafiaService.importaDatiSuperficie(t,i,this.selectedCampagna).subscribe(i=>{this.runStatoAvanzamentoProcesso.emit(t.length),this.messages.add(u.a.getToast("generic",u.b.success,u.a.processoAvviatoOK))},i=>{console.log(i),this.messages.add("IMPPSRSUPERR"!==i.error.message?"BRIAMPRT001"!==i.error.message?u.a.getToast("generic",u.b.error,u.a.errorIstruttoriaAntimafiaImportDati):u.a.getToast("generic",u.b.warn,u.a.BRIAMPRT001):u.a.getToast("generic",u.b.warn,u.a.IMPPSRSUPERR))},()=>this.loadList(0,null))})},i=>{console.log(i)}):this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMCNT002))}importStrutturaliEU(){this.sogliaAcquisizione.settore=q.a.PSR_STRUTTURALI_EU,this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length?this.istruttoriaAntimafiaService.getSogliaAcquisizione(this.sogliaAcquisizione).subscribe(i=>{Object(_.a)(this.isSelectedAll).pipe(Object(g.a)(i=>i?this.istruttoriaAntimafiaService.getCertificazioniAntimafiaByStato(s.a.CONTROLLATA).pipe(Object(R.a)(i=>i.results.map(i=>i.datiDichiarazione.dettaglioImpresa.codiceFiscale))):Object(_.a)(this.certificazioneProtocollateSelezionate.map(i=>i.datiDichiarazione.dettaglioImpresa.codiceFiscale)))).subscribe(t=>{this.istruttoriaAntimafiaService.importaDatiStrutturali(t,i).subscribe(i=>{this.insertSincronizzazioneAgs(i),this.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.errorIstruttoriaAntimafiaImportDati))},()=>this.loadList(0,null))})},i=>{console.log(i)}):this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMCNT002))}importDomandaUnica(i){this.sogliaAcquisizione.settore=q.a.DOMANDA_UNICA,this.istruttoriaAntimafiaService.getSogliaAcquisizione(this.sogliaAcquisizione).subscribe(t=>{this.istruttoriaAntimafiaService.importaDatiDU(i,t).subscribe(i=>{this.insertSincronizzazioneAgs(i),this.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,i.error.message))},()=>this.loadList(0,null))},i=>{console.log(i)})}confermaExportFileCSV(){this.selectedCampagna&&0!==this.selectedCampagna.length&&(this.exportFileCSV(q.a.PSR_SUPERFICIE_EU),this.dialogVisibile=!1)}exportFileCSV(i){if(!this.certificazioneProtocollateSelezionate||0===this.certificazioneProtocollateSelezionate.length)return void this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMCNT002));let t;switch(i){case q.a.DOMANDA_UNICA:t="idDomandaDu";break;case q.a.PSR_STRUTTURALI_EU:t="idDomandaStrutturale";break;case q.a.PSR_SUPERFICIE_EU:t="idDomandaSuperficie"}this.certificazioneProtocollateSelezionate.map(i=>{if(i[t])return i.datiDichiarazione.dettaglioImpresa.codiceFiscale}),Object(_.a)(this.isSelectedAll).pipe(Object(g.a)(i=>i?this.istruttoriaAntimafiaService.getCertificazioniAntimafiaByStato(s.a.CONTROLLATA).pipe(Object(R.a)(i=>i.results.map(i=>i.datiDichiarazione.dettaglioImpresa.codiceFiscale))):Object(_.a)(this.certificazioneProtocollateSelezionate.map(i=>i.datiDichiarazione.dettaglioImpresa.codiceFiscale)))).subscribe(t=>{this.istruttoriaAntimafiaService.getEsportaCSV(t,i,this.selectedCampagna).subscribe(i=>{const t=this.getFileNameFromResponseContentDisposition(i);H.saveAs(i.body,t),this.recuperaTrasmissioni()},i=>{if(i.error){const t=new FileReader;t.onload=()=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.IMPOSSILE_GENERARE_FILE+": "+t.result))},t.readAsText(i.error)}else this.messages.add(u.a.getToast("generic",u.b.error,u.a.IMPOSSILE_GENERARE_FILE))})})}importaEsitiBDNA(i){this.istruttoriaAntimafiaService.importaEsitiBdna(i).subscribe(i=>{this.displayPopup=!0,this.esitiBdna=i},i=>{this.messages.add(u.a.getToast("generic",u.b.error,i.error.message))})}conferma(){if(!this.trasmissioneBdnaSelected)return;let i=new ei.a;i=this.trasmissioneBdnaSelected,i.dtConferma=new Date,this.istruttoriaAntimafiaService.confermaDomandeCollegate(i).subscribe(()=>{this.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK)),this.recuperaTrasmissioni(),this.trasmissioneBdnaSelected=null},i=>{this.messages.add(u.a.getToast("generic",u.b.error,i.error.message))})}annulla(){this.trasmissioneBdnaSelected&&this.istruttoriaAntimafiaService.annullaDomandeCollegate(this.trasmissioneBdnaSelected.id).subscribe(()=>{this.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK)),this.recuperaTrasmissioni(),this.trasmissioneBdnaSelected=null},i=>{this.messages.add(u.a.getToast("generic",u.b.error,i.error.message))})}scarica(){this.trasmissioneBdnaSelected&&this.istruttoriaAntimafiaService.downloadFileCsv(this.trasmissioneBdnaSelected.id).subscribe(i=>{const t=this.getFileNameFromResponseContentDisposition(i);H.saveAs(i.body,t)},i=>{this.messages.add(u.a.getToast("generic",u.b.error,i.error.message))})}uploadFileCsv(i){if(i.target.files&&i.target.files.length>0){let t=i.target.files[0];if(!t.name)return void this.messages.add(u.a.getToast("generic",u.b.error,u.a.FILE_TYPE(u.a.UPLOAD_FILE_TYPE_CSV)));if(!t.name.endsWith(u.a.UPLOAD_FILE_TYPE_CSV))return void this.messages.add(u.a.getToast("generic",u.b.error,u.a.FILE_TYPE(u.a.UPLOAD_FILE_TYPE_CSV)));"du"==this.typeImport?this.importDomandaUnica(t):"bdna"==this.typeImport&&this.importaEsitiBDNA(t)}}openSOConsole(i){this.file.nativeElement.click(),this.typeImport=i}visualizzaDettaglioDomanda(i,t){let e={queryParams:{activeIndex:t,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:2},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],e)}insertSincronizzazioneAgs(i){let t=new Array;i&&(i.forEach(i=>{t.push({cuaa:i.cuaa,tipoDomanda:i.tipoDomanda,idDomanda:i.idDomanda,dtInizioEsitoNegativo:null,dtInizioSilenzioAssenso:null,dtFineEsitoNegativo:null,dtFineSilenzioAssenso:null})}),t&&this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(t))}downloadDichiarazioneAntimafia(){const i=this.domandaAntimafiaSelezionataFromMenuAction.id.toString(),t=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(i);this.dichiarazioneAntimafiaSubscpription=t.pipe(Object(g.a)(i=>(this.antimafiaService.downloadDichiarazioneAntimafia(i.pdfFirmato,i.tipoPdfFirmato),Object(_.a)(i)))).subscribe(i=>{const t=this.antimafiaService.getAllegati(i);this.antimafiaService.downloadAllegati(t)})}onDropdownMenuOpen(i,t,e){this.indexSelectedFromMenu=e,this.domandaAntimafiaSelezionataFromMenuAction=t,this.currentMenuAction=i,this.currentMenuAction.reset=!1}buildMenuAction(){return[{label:r.a.azioni.toUpperCase(),items:[{label:r.a.SCARICA,command:()=>{this.downloadDichiarazioneAntimafia(),this.currentMenuAction.reset=!0}},{label:r.a.RIFIUTA,command:()=>{this.openPopup(s.a.RIFIUTATA),this.currentMenuAction.reset=!0}},{label:r.a.ESITO_POSITIVO,command:()=>{this.openPopup(s.a.POSITIVO),this.currentMenuAction.reset=!0}}]}]}openPopup(i){this.statoDaAggiornare=i,this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(i)))}onConfirmAggiornaStato(){switch(this.messages.clear(),this.statoDaAggiornare){case s.a.RIFIUTATA:this.popupComponent.open();break;case s.a.POSITIVO:this.esitoPositivo()}}onRejectAggiornaStato(){this.messages.clear()}esitoPositivo(){let i=this.domandaAntimafiaSelezionataFromMenuAction;i.stato.descrizione=null,i.stato.id=null,i.stato.identificativo=s.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe(i=>{let t=new I(this.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);this.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe(i=>{i&&i.forEach(e=>{e.cuaa===t.cuaa&&(e.dtFineEsitoNegativo=null,e.dtFineSilenzioAssenso=null,e.dtInizioEsitoNegativo=null,e.dtInizioSilenzioAssenso=null),this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(i)}),this.loadList(0,null)},i=>console.log(i))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))})}exportEsitiBdna(){this.istruttoriaAntimafiaService.exportCsvEsitiBdna().subscribe(i=>{const t=this.getFileNameFromResponseContentDisposition(i);H.saveAs(i.body,t),this.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK))},i=>{console.log(i.error.error),this.messages.add(u.a.getToast("generic",u.b.error,u.a.ExportCsvKo))})}onC(){this.displayPopup=!1}loadData(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){let t="";switch(i.sortField){case this.cols[0].field:t="cuaa";break;case this.cols[1].field:t="denominazioneImpresa";break;default:t=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(t)}this.loadList(i.first,i.globalFilter)}loadList(i,t){this.ricercaAntimafiaFilter.filtroGenerico=t||null,this.ricercaAntimafiaFilter.statoDichiarazione=s.a.CONTROLLATA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe(i=>{this.elementiTotali=i.total,this.certificazioniControllate=i.results?i.results:[],this.isEmpty=0===this.certificazioniControllate.length},i=>{console.log("error: "+i),this.isEmpty=!0})}buildDescrizioneTooltip(i){let t=i.esitoDescrizione;return("OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea||"ND"===i.esitoInvioAgea)&&(t+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?t+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(t+=" | ESITO INVIO A BDNA NON DISPONIBILE"),t}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(l.a),h.Nb(T.d),h.Nb(n.e),h.Nb(T.d),h.Nb(T.a),h.Nb(n.a),h.Nb(o.a),h.Nb(ai.a))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-cert-amf-controllate"]],viewQuery:function(i,t){var e;1&i&&(h.Jc(ci,!0),h.Jc(ti,!0)),2&i&&(h.Ac(e=h.cc())&&(t.file=e.first),h.Ac(e=h.cc())&&(t.popupComponent=e.first))},inputs:{refreshFromParent:"refreshFromParent"},outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters",runStatoAvanzamentoProcesso:"runStatoAvanzamentoProcesso"},features:[h.zb],decls:101,vars:63,consts:[["key","tst"],["showEffect","fade",3,"visible","responsive","modal","closable","contentStyle","visibleChange"],[1,"p-grid","boxpopup"],["class","ui-g-12",4,"ngFor","ngForOf"],[1,"p-grid"],[1,"ui-g-6","text-left"],["pButton","","type","button",1,"btn-green",2,"min-height","42px","box-shadow","none",3,"label","click"],[1,"ui-g-6","text-right"],["pButton","","type","submit",1,"btn-green",2,"min-height","42px","box-shadow","none","margin-right","10px",3,"disabled","label","click"],[1,"ui-grid-fixed"],["position","top-center","key","generic",3,"baseZIndex"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","totalRecords","selectedItems","isSelectedAll","lazy","sizeArray","selectedItemsChange","isSelectedAllChange","onLazyLoadPage"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"ui-g"],[1,"ui-g-3","box-padded"],[1,"ui-g-11"],[1,"ui-g-11","box-padded"],[1,"ui-fluid",3,"label","onClick"],["type","file","onclick","this.value = null","accept",".csv",1,"inputUploadFile",2,"display","none",3,"change"],["file",""],[1,"ui-g-11","ui-fluid"],["placeholder","Seleziona CSV","name","trasmissioneBdnaSelected",3,"disabled","options","ngModel","ngModelChange"],[1,"ui-fluid",3,"label","disabled","onClick"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],["width","710","appendTo","body",3,"visible","modal","closable","focusOnShow","visibleChange"],["dialog",""],[1,"popup-istruttoria"],[1,"table","table-striped",2,"text-align","center"],[1,"badgesGreen"],[4,"ngFor","ngForOf"],[1,"ui-g-12"],["pButton","","type","button","label","CHIUDI",1,"annulla",3,"click"],[3,"dichiarazioneAntimafia","event"],["name","annoDiCampagna",3,"value","label","ngModel","inputId","ngModelChange"],[2,"width","3em"],[3,"pSortableColumnWrapper","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumnWrapper","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRowWrapper"],[3,"value"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,t){if(1&i){const i=h.Ub();h.Ob(0,"p-toast",0),h.Tb(1,"p-dialog",1),h.bc("visibleChange",(function(i){return t.dialogVisibile=i})),h.Tb(2,"div",2),h.Tb(3,"p-header"),h.Oc(4),h.gc(5,"uppercase"),h.gc(6,"translate"),h.Sb(),h.Mc(7,ri,2,4,"div",3),h.Sb(),h.Tb(8,"div",4),h.Tb(9,"div",5),h.Tb(10,"button",6),h.bc("click",(function(){return t.annullaImportPsrSuperficie()})),h.gc(11,"translate"),h.Sb(),h.Sb(),h.Tb(12,"div",7),h.Tb(13,"button",8),h.bc("click",(function(){return t.checkMassiveExport?t.confermaExportFileCSV():t.confermaImportPsrSuperficie()})),h.gc(14,"translate"),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(15,"div",9),h.Ob(16,"p-toast",10),h.Tb(17,"div",11),h.Tb(18,"h3"),h.Oc(19),h.Sb(),h.Tb(20,"div",12),h.Tb(21,"i",13),h.Oc(22,"search"),h.Sb(),h.Tb(23,"input",14),h.bc("input",(function(t){return h.Ec(i),h.Bc(25).filterGlobal(t.target.value,"contains")})),h.Sb(),h.Sb(),h.Tb(24,"app-a4g-paged-table",15,16),h.bc("selectedItemsChange",(function(i){return t.certificazioneProtocollateSelezionate=i}))("isSelectedAllChange",(function(i){return t.isSelectedAll=i}))("onLazyLoadPage",(function(i){return t.loadData(i)})),h.Mc(26,di,8,3,"ng-template",17),h.Mc(27,mi,27,18,"ng-template",18),h.Mc(28,pi,3,2,"ng-template",19),h.Sb(),h.Tb(29,"div",20),h.Tb(30,"div",21),h.Tb(31,"div",22),h.Tb(32,"h5"),h.Oc(33),h.Sb(),h.Sb(),h.Tb(34,"div",23),h.Tb(35,"p-button",24),h.bc("onClick",(function(){return t.openDialog(!1)})),h.Sb(),h.Sb(),h.Tb(36,"div",23),h.Tb(37,"p-button",24),h.bc("onClick",(function(){return t.importStrutturaliEU()})),h.Sb(),h.Sb(),h.Tb(38,"div",23),h.Tb(39,"p-button",24),h.bc("onClick",(function(){return t.openSOConsole("du")})),h.Sb(),h.Tb(40,"input",25,26),h.bc("change",(function(i){return t.uploadFileCsv(i)})),h.Sb(),h.Sb(),h.Sb(),h.Tb(42,"div",21),h.Tb(43,"div",22),h.Tb(44,"h5"),h.Oc(45),h.Sb(),h.Sb(),h.Tb(46,"div",23),h.Tb(47,"p-button",24),h.bc("onClick",(function(){return t.openDialog(!0)})),h.Sb(),h.Sb(),h.Tb(48,"div",23),h.Tb(49,"p-button",24),h.bc("onClick",(function(){return t.exportFileCSV(t.tipoDomanda.PSR_STRUTTURALI_EU)})),h.Sb(),h.Sb(),h.Tb(50,"div",23),h.Tb(51,"p-button",24),h.bc("onClick",(function(){return t.exportFileCSV(t.tipoDomanda.DOMANDA_UNICA)})),h.Sb(),h.Sb(),h.Sb(),h.Tb(52,"div",21),h.Tb(53,"div",22),h.Tb(54,"h5"),h.Oc(55),h.Sb(),h.Sb(),h.Tb(56,"div",27),h.Tb(57,"p-dropdown",28),h.bc("ngModelChange",(function(i){return t.trasmissioneBdnaSelected=i})),h.Sb(),h.Sb(),h.Tb(58,"div",23),h.Tb(59,"p-button",29),h.bc("onClick",(function(){return t.conferma()})),h.Sb(),h.Sb(),h.Tb(60,"div",23),h.Tb(61,"p-button",29),h.bc("onClick",(function(){return t.annulla()})),h.Sb(),h.Sb(),h.Tb(62,"div",23),h.Tb(63,"p-button",29),h.bc("onClick",(function(){return t.scarica()})),h.Sb(),h.Sb(),h.Sb(),h.Tb(64,"div",21),h.Tb(65,"div",22),h.Tb(66,"h5"),h.Oc(67),h.Sb(),h.Sb(),h.Tb(68,"div",23),h.Tb(69,"p-button",24),h.bc("onClick",(function(){return t.openSOConsole("bdna")})),h.Sb(),h.Tb(70,"input",25,26),h.bc("change",(function(i){return t.uploadFileCsv(i)})),h.Sb(),h.Sb(),h.Tb(72,"div",23),h.Tb(73,"p-button",24),h.bc("onClick",(function(){return t.exportEsitiBdna()})),h.Sb(),h.Tb(74,"input",25,26),h.bc("change",(function(i){return t.uploadFileCsv(i)})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(76,"p-toast",30),h.bc("onClose",(function(){return t.onRejectAggiornaStato()})),h.Mc(77,gi,11,2,"ng-template",31),h.Sb(),h.Tb(78,"p-dialog",32,33),h.bc("visibleChange",(function(i){return t.displayPopup=i})),h.Tb(80,"div",34),h.Tb(81,"h1"),h.Oc(82,"ESITI IMPORTA DOMANDE"),h.Sb(),h.Tb(83,"table",35),h.Tb(84,"tr"),h.Tb(85,"th"),h.Oc(86,"Cuaa Domande aggiornate "),h.Tb(87,"span",36),h.Oc(88),h.Sb(),h.Sb(),h.Tb(89,"th"),h.Oc(90,"Cuaa Domande con errori "),h.Tb(91,"span",36),h.Oc(92),h.Sb(),h.Sb(),h.Sb(),h.Tb(93,"tr"),h.Tb(94,"td"),h.Mc(95,hi,2,1,"div",37),h.Sb(),h.Tb(96,"td"),h.Mc(97,fi,2,1,"div",37),h.Sb(),h.Sb(),h.Sb(),h.Tb(98,"div",38),h.Tb(99,"button",39),h.bc("click",(function(){return t.onC()})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(100,"app-popup-rifiuta-domanda",40),h.bc("event",(function(){return t.loadList(0,null)})),h.Sb(),h.Sb()}2&i&&(h.Kc(h.rc(61,Si)),h.Bb(1),h.mc("visible",t.dialogVisibile)("responsive",!0)("modal",!0)("closable",!1)("contentStyle",h.rc(62,Ai)),h.Bb(3),h.Qc(" ",h.hc(5,53,h.hc(6,55,"ANNO_CAMPAGNA"))," "),h.Bb(3),h.mc("ngForOf",t.campagne),h.Bb(3),h.nc("label",h.hc(11,57,"NuovoFascicolo.ANNULLA")),h.Bb(3),h.nc("label",h.hc(14,59,"NuovoFascicolo.CONFERMA")),h.mc("disabled",0===t.selectedCampagna.length),h.Bb(3),h.mc("baseZIndex",5e4),h.Bb(3),h.Pc(t.textTitle),h.Bb(5),h.mc("columns",t.cols)("value",t.certificazioniControllate)("totalRecords",t.elementiTotali)("selectedItems",t.certificazioneProtocollateSelezionate)("isSelectedAll",t.isSelectedAll)("lazy",!0)("sizeArray",t.intestazioni.sizePerPagina),h.Bb(9),h.Pc(t.intestazioni.ACQUISIZIONE_DATI_DOMANDE),h.Bb(2),h.nc("label",t.intestazioni.IMPORTA_DATI_PSR_SUPERFICIE_EU),h.Bb(2),h.nc("label",t.intestazioni.IMPORTA_DATI_PSR_STRUTTURALI_EU),h.Bb(2),h.nc("label",t.intestazioni.IMPORTA_DATI_DOMANDA_UNICA),h.Bb(6),h.Pc(t.intestazioni.ESPORTATIONI_MASSIVE_DATI_BDNA),h.Bb(2),h.nc("label",t.intestazioni.ESPORTA_DATI_PSR_SUPERFICIE_EU),h.Bb(2),h.nc("label",t.intestazioni.ESPORTA_DATI_PSR_STRUTTURALI_EU),h.Bb(2),h.nc("label",t.intestazioni.ESPORTA_DATI_DOMANDA_UNICA),h.Bb(4),h.Pc(t.intestazioni.CONFERMA_IMPORTAZIONE_BDNA),h.Bb(2),h.mc("disabled",0==t.elencoCsvDaConfermare.length)("options",t.elencoCsvDaConfermare)("ngModel",t.trasmissioneBdnaSelected),h.Bb(2),h.nc("label",t.intestazioni.CONFERMA),h.mc("disabled",!t.trasmissioneBdnaSelected),h.Bb(2),h.nc("label",t.intestazioni.ANNULLA),h.mc("disabled",!t.trasmissioneBdnaSelected),h.Bb(2),h.nc("label",t.intestazioni.SCARICA),h.mc("disabled",!t.trasmissioneBdnaSelected),h.Bb(4),h.Pc(t.intestazioni.IMPORTANZIONE_ESITI_BDNA),h.Bb(2),h.nc("label",t.intestazioni.IMPORTA_ESITI_BDNA),h.Bb(4),h.nc("label",t.intestazioni.ESPORTA_ESITI_BDNA),h.Bb(3),h.mc("modal",!0)("baseZIndex",5e3),h.Bb(2),h.mc("visible",t.displayPopup)("modal",!0)("closable",!0)("focusOnShow",!1),h.Bb(10),h.Pc(t.esitiBdna.domandeAggiornate?t.esitiBdna.domandeAggiornate.length:0),h.Bb(4),h.Pc(t.esitiBdna.domandeConErrori?t.esitiBdna.domandeConErrori.length:0),h.Bb(3),h.mc("ngForOf",t.esitiBdna.domandeAggiornate),h.Bb(2),h.mc("ngForOf",t.esitiBdna.domandeConErrori),h.Bb(3),h.mc("dichiarazioneAntimafia",t.domandaAntimafiaSelezionataFromMenuAction))},directives:[z.a,X.a,T.c,a.s,D.b,v.a,w.b,T.e,D.a,oi.a,ii.s,ii.v,ti,si.a,w.a,w.f,w.e,w.d,w.g,a.t,P.a,U.a],pipes:[a.G,S.d,a.f],styles:[".boxgrey[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#0d5f3f;font-weight:700;font-size:18px;text-transform:uppercase;padding-bottom:10px;margin-bottom:15px}.boxgrey[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > h5[_ngcontent-%COMP%]{border-bottom:2px solid #0d5f3f}.boxgrey[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{display:inline!important}.badgesGreen[_ngcontent-%COMP%]{background:#00985a;line-height:0;color:#fff;font-size:13px;border-radius:30px;display:inline;padding:0 7px}.checkbox[_ngcontent-%COMP%]{padding:10px}",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),i})();function Ii(i,t){if(1&i&&(h.Tb(0,"th",16),h.Oc(1),h.Ob(2,"p-sortIcon",17),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.field)}}function Oi(i,t){if(1&i&&(h.Tb(0,"tr"),h.Mc(1,Ii,3,4,"th",14),h.Tb(2,"th",15),h.Oc(3),h.Sb(),h.Tb(4,"th",15),h.Oc(5),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.mc("ngForOf",i),h.Bb(2),h.Qc(" ",e.labels.collegate," "),h.Bb(2),h.Qc(" ",e.labels.azioni," ")}}function zi(i,t){if(1&i&&h.Ob(0,"div",30),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function vi(i,t){if(1&i&&h.Ob(0,"div",31),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function Ci(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr",18),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.gc(7,"date"),h.Sb(),h.Tb(8,"td"),h.Oc(9),h.Sb(),h.Tb(10,"td"),h.Tb(11,"div",19),h.Mc(12,zi,1,1,"div",20),h.Mc(13,vi,1,1,"div",21),h.Sb(),h.Sb(),h.Tb(14,"td",22),h.Tb(15,"div",23),h.Tb(16,"div",24),h.Tb(17,"p-button",25),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,0)})),h.Sb(),h.Sb(),h.Tb(18,"div",24),h.Tb(19,"p-button",26),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,1)})),h.Sb(),h.Sb(),h.Tb(20,"div",24),h.Tb(21,"p-button",27),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,2)})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(22,"td"),h.Tb(23,"action-menu",28,29),h.bc("click",(function(){h.Ec(i);const e=t.$implicit,a=t.rowIndex,n=h.Bc(24);return h.fc().onDropdownMenuOpen(n,e,a)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.mc("pSelectableRow",i),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.denominazione),h.Bb(2),h.Pc(h.ic(7,14,i.dtProtocollazione,"dd/MM/yyyy")),h.Bb(3),h.Pc(i.idProtocollo),h.Bb(3),h.mc("ngIf","OK"===i.esito),h.Bb(1),h.mc("ngIf","KO"===i.esito),h.Bb(4),h.nc("title",e.labels.DOMANDE_SUPERFICIE_EU),h.mc("disabled",!(i.idsDomandaSuperficie.length>0)),h.Bb(2),h.nc("title",e.labels.DOMANDE_STRUTTURALI_EU),h.mc("disabled",!(i.idsDomandaStrutturale.length>0)),h.Bb(2),h.nc("title",e.labels.DOMANDE_UNICHE),h.mc("disabled",!(i.idsDomandaDu.length>0)),h.Bb(2),h.mc("item",e.menuAction)}}function Di(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.Cb("colspan",i.length+3),h.Bb(1),h.Qc(" ",e.labels.noTableContent," ")}}function Pi(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",32),h.Ob(1,"i",33),h.Tb(2,"h3"),h.Oc(3),h.Sb(),h.Tb(4,"p"),h.Oc(5),h.Sb(),h.Sb(),h.Tb(6,"div",34),h.Tb(7,"div",35),h.Tb(8,"button",36),h.bc("click",(function(){return h.Ec(i),h.fc().onConfirmAggiornaStato()})),h.Sb(),h.Sb(),h.Tb(9,"div",35),h.Tb(10,"button",37),h.bc("click",(function(){return h.Ec(i),h.fc().onRejectAggiornaStato()})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit;h.Bb(3),h.Pc(i.summary),h.Bb(2),h.Pc(i.detail)}}let Bi=(()=>{class i{constructor(i,t,e,a,n,o){this.istruttoriaAntimafiaService=i,this.antimafiaService=t,this.messages=e,this.loader=a,this.router=n,this.route=o,this.labels=r.a,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new h.n,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new O,this.elementiTotali=0,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.labels.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.labels.descrizioneImpresa},{field:"dtProtocollazione",header:this.labels.data},{field:"idProtocollo",header:this.labels.nrProtocollo},{field:"esito",header:this.labels.esitoTrasmissione}]}ngOnInit(){this.loader.setTimeout(48e4),this.menuAction=this.menuActionProtocollata(),this.textTitle=r.a.CONTROLLO_CERTIFICAZIONE_ANTIMAFIA_CONTROLLO_MANUALE}ngOnDestroy(){this.loader.resetTimeout(),this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}onDropdownMenuOpen(i,t,e){this.indexSelectedFromMenu=e,this.domandaAntimafiaSelezionataFromMenuAction=t,this.currentMenuAction=i,this.currentMenuAction.reset=!1}menuActionProtocollata(){return[{label:r.a.azioni.toUpperCase(),items:[{label:this.labels.ESITO_CONTROLLO,command:()=>{this.getEsitoControlloAntimafia(),this.currentMenuAction.reset=!0}},{separator:!0},{label:this.labels.SCARICA,command:()=>{this.downloadDomandaCertificazioneAntimafia(),this.currentMenuAction.reset=!0}},{label:this.labels.RIFIUTA,command:()=>{this.openPopup(s.a.RIFIUTATA),this.currentMenuAction.reset=!0}},{label:this.labels.APPROVA,command:()=>{this.approvaDomandaControllataManualmente(),this.currentMenuAction.reset=!0}},{label:r.a.ESITO_POSITIVO,command:()=>{this.openPopup(s.a.POSITIVO),this.currentMenuAction.reset=!0}}]}]}getEsitoControlloAntimafia(){let i=this.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale;this.antimafiaService.getEsitoControlloAntimafia(this.domandaAntimafiaSelezionataFromMenuAction.id).subscribe(t=>{t.domandeGestite.forEach(t=>{let e=JSON.parse(t);if(this.messages.add(u.a.getToast("generic",u.b.info,e.parixMessage?e.parixMessage:i+" valido in Parix")),this.messages.add(u.a.getToast("generic",u.b.info,e.siapMessage?e.siapMessage:i+" valido in Siap")),e.soggettiMessages){let i="";e.soggettiMessages.forEach(t=>{i+=t}),this.messages.add(u.a.getToast("generic",u.b.info,i))}else this.messages.add(u.a.getToast("generic",u.b.info,"Tutti i soggetti con carica validi in Parix"))})},i=>{this.messages.add(u.a.getToast("generic",u.b.error,i.error.message))})}downloadDomandaCertificazioneAntimafia(){const i=this.domandaAntimafiaSelezionataFromMenuAction,t=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(i.id.toString());this.dichiarazioneAntimafiaSubscpription=t.pipe(Object(g.a)(t=>(i.pdfFirmato=t.pdfFirmato,this.antimafiaService.downloadDichiarazioneAntimafia(t.pdfFirmato,t.tipoPdfFirmato),Object(_.a)(t)))).subscribe(i=>{const t=this.antimafiaService.getAllegati(i);this.antimafiaService.downloadAllegati(t)})}approvaDomandaControllataManualmente(){let i=this.domandaAntimafiaSelezionataFromMenuAction;i.stato.identificativo=s.a.CONTROLLATA,this.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe(i=>{i.dichiarazione.stato.identificativo.toString()==s.a.CONTROLLATA?(this.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK)),this.certificazioneAntimafia.splice(this.indexSelectedFromMenu,1),this.aggiornaCertificazioniCounters.emit()):this.messages.add(u.a.getToast("generic",u.b.error,"Passaggio di stato della domanda non riuscito"))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,"Passaggio di stato della domanda non riuscito"))})}openPopup(i){this.statoDaAggiornare=i,this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(i)))}onConfirmAggiornaStato(){switch(this.messages.clear(),this.statoDaAggiornare){case s.a.RIFIUTATA:this.popupComponent.open();break;case s.a.POSITIVO:this.esitoPositivo()}}onRejectAggiornaStato(){this.messages.clear()}aggiornaTabella(){this.aggiornaCertificazioniCounters.emit(),this.certificazioneAntimafia.splice(this.indexSelectedFromMenu,1)}visualizzaDettaglioDomanda(i,t){let e={queryParams:{activeIndex:t,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:3},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],e)}esitoPositivo(){let i=this.domandaAntimafiaSelezionataFromMenuAction;i.stato.descrizione=null,i.stato.id=null,i.stato.identificativo=s.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe(i=>{let t=new I(this.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);this.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe(i=>{i&&i.forEach(e=>{e.cuaa===t.cuaa&&(e.dtFineEsitoNegativo=null,e.dtFineSilenzioAssenso=null,e.dtInizioEsitoNegativo=null,e.dtInizioSilenzioAssenso=null),this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(i)}),this.aggiornaTabella()},i=>console.log(i))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))})}loadData(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){let t="";switch(i.sortField){case this.cols[0].field:t="cuaa";break;case this.cols[1].field:t="denominazioneImpresa";break;default:t=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(t)}this.loadList(i.first,i.globalFilter)}loadList(i,t){this.ricercaAntimafiaFilter.filtroGenerico=t||null,this.ricercaAntimafiaFilter.statoDichiarazione=s.a.CONTROLLO_MANUALE,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe(i=>{this.elementiTotali=i.total,this.certificazioneAntimafia=i.results?i.results:[]},i=>{console.log("error: "+i)})}buildDescrizioneTooltip(i){let t=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?t+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(t+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?t+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(t+=" | ESITO INVIO A BDNA NON DISPONIBILE"),t}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(l.a),h.Nb(o.a),h.Nb(T.d),h.Nb(Y.a),h.Nb(n.e),h.Nb(n.a))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-cert-amf-controllo-manuale"]],viewQuery:function(i,t){var e;1&i&&h.Jc(ti,!0),2&i&&h.Ac(e=h.cc())&&(t.popupComponent=e.first)},outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters"},decls:17,vars:14,consts:[[1,"ui-grid-fixed"],["position","top-center","key","generic",3,"baseZIndex"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"dichiarazioneAntimafia","event"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",0),h.Ob(1,"p-toast",1),h.Tb(2,"div",2),h.Tb(3,"h3"),h.Oc(4),h.Sb(),h.Tb(5,"div",3),h.Tb(6,"i",4),h.Oc(7,"search"),h.Sb(),h.Tb(8,"input",5),h.bc("input",(function(t){return h.Ec(i),h.Bc(10).filterGlobal(t.target.value,"contains")})),h.Sb(),h.Sb(),h.Tb(9,"p-table",6,7),h.bc("onLazyLoad",(function(i){return t.loadData(i)})),h.Mc(11,Oi,6,3,"ng-template",8),h.Mc(12,Ci,25,17,"ng-template",9),h.Mc(13,Di,3,2,"ng-template",10),h.Sb(),h.Sb(),h.Tb(14,"app-popup-rifiuta-domanda",11),h.bc("event",(function(){return t.aggiornaTabella()})),h.Sb(),h.Tb(15,"p-toast",12),h.bc("onClose",(function(){return t.onRejectAggiornaStato()})),h.Mc(16,Pi,11,2,"ng-template",13),h.Sb(),h.Sb()}2&i&&(h.Bb(1),h.mc("baseZIndex",5e4),h.Bb(3),h.Pc(t.textTitle),h.Bb(5),h.mc("columns",t.cols)("value",t.certificazioneAntimafia)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",t.elementiTotali)("rowsPerPageOptions",t.labels.sizePerPagina),h.Bb(5),h.mc("dichiarazioneAntimafia",t.domandaAntimafiaSelezionataFromMenuAction),h.Bb(1),h.mc("modal",!0)("baseZIndex",5e3))},directives:[z.a,v.a,C.q,T.e,ti,a.s,C.p,C.o,C.m,a.t,D.a,P.a,U.a,D.b],pipes:[a.f],styles:["",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),i})();var Ni=e("8KUc");function Mi(i,t){if(1&i&&(h.Tb(0,"th",15),h.Oc(1),h.Ob(2,"p-sortIcon",16),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.field)}}function Ei(i,t){if(1&i&&(h.Tb(0,"tr"),h.Mc(1,Mi,3,4,"th",13),h.Tb(2,"th",14),h.Oc(3),h.Sb(),h.Tb(4,"th",14),h.Oc(5),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.mc("ngForOf",i),h.Bb(2),h.Qc(" ",e.labels.collegate," "),h.Bb(2),h.Qc(" ",e.labels.azioni," ")}}function yi(i,t){if(1&i&&h.Ob(0,"div",29),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function Fi(i,t){if(1&i&&h.Ob(0,"div",30),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function Ri(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr",17),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.gc(7,"date"),h.Sb(),h.Tb(8,"td"),h.Oc(9),h.Sb(),h.Tb(10,"td"),h.Tb(11,"div",18),h.Mc(12,yi,1,1,"div",19),h.Mc(13,Fi,1,1,"div",20),h.Sb(),h.Sb(),h.Tb(14,"td",21),h.Tb(15,"div",22),h.Tb(16,"div",23),h.Tb(17,"p-button",24),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,0)})),h.Sb(),h.Sb(),h.Tb(18,"div",23),h.Tb(19,"p-button",25),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,1)})),h.Sb(),h.Sb(),h.Tb(20,"div",23),h.Tb(21,"p-button",26),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,2)})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(22,"td"),h.Tb(23,"action-menu",27,28),h.bc("click",(function(){h.Ec(i);const e=t.$implicit,a=t.rowIndex,n=h.Bc(24);return h.fc().onDropdownMenuOpen(n,e,a)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.mc("pSelectableRow",i),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.denominazione),h.Bb(2),h.Pc(h.ic(7,14,i.dtProtocollazione,"dd/MM/yyyy")),h.Bb(3),h.Pc(i.idProtocollo),h.Bb(3),h.mc("ngIf","OK"===i.esito),h.Bb(1),h.mc("ngIf","KO"===i.esito),h.Bb(4),h.nc("title",e.labels.DOMANDE_SUPERFICIE_EU),h.mc("disabled",!(i.idsDomandaSuperficie.length>0)),h.Bb(2),h.nc("title",e.labels.DOMANDE_STRUTTURALI_EU),h.mc("disabled",!(i.idsDomandaStrutturale.length>0)),h.Bb(2),h.nc("title",e.labels.DOMANDE_UNICHE),h.mc("disabled",!(i.idsDomandaDu.length>0)),h.Bb(2),h.mc("item",e.menuAction)}}function _i(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.Cb("colspan",i.length+3),h.Bb(1),h.Qc(" ",e.labels.noTableContent," ")}}function wi(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",31),h.Ob(1,"i",32),h.Tb(2,"h3"),h.Oc(3),h.Sb(),h.Tb(4,"p"),h.Oc(5),h.Sb(),h.Sb(),h.Tb(6,"div",33),h.Tb(7,"div",34),h.Tb(8,"button",35),h.bc("click",(function(){return h.Ec(i),h.fc().onConfirmAggiornaStato()})),h.Sb(),h.Sb(),h.Tb(9,"div",34),h.Tb(10,"button",36),h.bc("click",(function(){return h.Ec(i),h.fc().onRejectAggiornaStato()})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit;h.Bb(3),h.Pc(i.summary),h.Bb(2),h.Pc(i.detail)}}let xi=(()=>{class i{constructor(i,t,e,a,n){this.antimafiaService=i,this.istruttoriaAntimafiaService=t,this.messages=e,this.router=a,this.route=n,this.labels=r.a,this.textTitle=r.a.CERTIFICAZIONI_ANTIMAFIA_RIFIUTATE,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new h.n,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new O,this.elementiTotali=0,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.labels.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.labels.descrizioneImpresa},{field:"dtProtocollazione",header:this.labels.data},{field:"idProtocollo",header:this.labels.nrProtocollo},{field:"esito",header:this.labels.esitoTrasmissione}]}ngOnInit(){this.menuAction=this.menuActionDisplay()}ngOnDestroy(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}menuActionDisplay(){return[{label:r.a.azioni.toUpperCase(),items:[{label:this.labels.DETTAGLIO_RIFIUTO,command:()=>{this.dettaglioRifiuto(),this.currentMenuAction.reset=!0}},{separator:!0},{label:this.labels.SCARICA,command:()=>{this.downloadDichiarazioneAntimafia(),this.currentMenuAction.reset=!0}},{label:r.a.ESITO_POSITIVO,command:()=>{this.openPopupEsitoPositivo(),this.currentMenuAction.reset=!0}}]}]}onDropdownMenuOpen(i,t,e){this.indexSelectedFromMenu=e,this.domandaAntimafiaSelezionataFromMenuAction=t,this.currentMenuAction=i,this.currentMenuAction.reset=!1}dettaglioRifiuto(){this.antimafiaService.getNoteDichiarazioneAntimafia(this.domandaAntimafiaSelezionataFromMenuAction.id,Ni.a.RIFIUTO_DICHIARAZIONE_ANTIMAFIA).subscribe(i=>{u.a.isUndefinedOrNull(i)||i.forEach(i=>{let t=JSON.parse(i.nota);u.a.isUndefinedOrNull(i)||u.a.isUndefinedOrNull(t)||(u.a.isUndefinedOrNull(t.nrProtocolloComunicazione)||this.messages.add(u.a.getToast("generic",u.b.info,r.a.COMUNICAZIONE_NR_PROTOCOLLO+": "+t.nrProtocolloComunicazione)),u.a.isUndefinedOrNull(t.noteDiChiusura)||this.messages.add(u.a.getToast("generic",u.b.info,r.a.NOTE_DI_CHIUSURA+": "+t.noteDiChiusura)))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,i.error.message))})})}downloadDichiarazioneAntimafia(){const i=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(this.domandaAntimafiaSelezionataFromMenuAction.id.toString());this.dichiarazioneAntimafiaSubscpription=i.pipe(Object(g.a)(i=>(this.antimafiaService.downloadDichiarazioneAntimafia(i.pdfFirmato,i.tipoPdfFirmato),Object(_.a)(i)))).subscribe(i=>{const t=this.antimafiaService.getAllegati(i);this.antimafiaService.downloadAllegati(t)})}visualizzaDettaglioDomanda(i,t){let e={queryParams:{activeIndex:t,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:4},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],e)}openPopupEsitoPositivo(){this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(s.a.POSITIVO)))}onConfirmAggiornaStato(){this.messages.clear(),this.esitoPositivo()}onRejectAggiornaStato(){this.messages.clear()}esitoPositivo(){let i=this.domandaAntimafiaSelezionataFromMenuAction;i.stato.descrizione=null,i.stato.id=null,i.stato.identificativo=s.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe(i=>{let t=new I(this.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);this.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe(i=>{i&&i.forEach(e=>{e.cuaa===t.cuaa&&(e.dtFineEsitoNegativo=null,e.dtFineSilenzioAssenso=null,e.dtInizioEsitoNegativo=null,e.dtInizioSilenzioAssenso=null),this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(i)}),this.loadList(0,null)},i=>console.log(i))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))})}loadData(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){let t="";switch(i.sortField){case this.cols[0].field:t="cuaa";break;case this.cols[1].field:t="denominazioneImpresa";break;default:t=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(t)}this.loadList(i.first,i.globalFilter)}loadList(i,t){this.ricercaAntimafiaFilter.filtroGenerico=t||null,this.ricercaAntimafiaFilter.statoDichiarazione=s.a.RIFIUTATA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe(i=>{this.elementiTotali=i.total,this.certificazioneAntimafia=i.results?i.results:[]},i=>{console.log("error: "+i)})}buildDescrizioneTooltip(i){let t=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?t+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(t+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?t+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(t+=" | ESITO INVIO A BDNA NON DISPONIBILE"),t}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(o.a),h.Nb(l.a),h.Nb(T.d),h.Nb(n.e),h.Nb(n.a))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-cert-amf-rifiutate"]],outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters"},decls:16,vars:13,consts:[[1,"ui-grid-fixed"],["position","top-center","key","generic",3,"baseZIndex"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",0),h.Ob(1,"p-toast",1),h.Tb(2,"div",2),h.Tb(3,"h3"),h.Oc(4),h.Sb(),h.Tb(5,"div",3),h.Tb(6,"i",4),h.Oc(7,"search"),h.Sb(),h.Tb(8,"input",5),h.bc("input",(function(t){return h.Ec(i),h.Bc(10).filterGlobal(t.target.value,"contains")})),h.Sb(),h.Sb(),h.Tb(9,"p-table",6,7),h.bc("onLazyLoad",(function(i){return t.loadData(i)})),h.Mc(11,Ei,6,3,"ng-template",8),h.Mc(12,Ri,25,17,"ng-template",9),h.Mc(13,_i,3,2,"ng-template",10),h.Sb(),h.Sb(),h.Tb(14,"p-toast",11),h.bc("onClose",(function(){return t.onRejectAggiornaStato()})),h.Mc(15,wi,11,2,"ng-template",12),h.Sb(),h.Sb()}2&i&&(h.Bb(1),h.mc("baseZIndex",5e4),h.Bb(3),h.Pc(t.textTitle),h.Bb(5),h.mc("columns",t.cols)("value",t.certificazioneAntimafia)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",t.elementiTotali)("rowsPerPageOptions",t.labels.sizePerPagina),h.Bb(5),h.mc("modal",!0)("baseZIndex",5e3))},directives:[z.a,v.a,C.q,T.e,a.s,C.p,C.o,C.m,a.t,D.a,P.a,U.a,D.b],pipes:[a.f],styles:["",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),i})();function Ui(i,t){if(1&i&&(h.Tb(0,"th",13),h.Oc(1),h.Ob(2,"p-sortIcon",14),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.field)}}function Li(i,t){if(1&i&&(h.Tb(0,"tr"),h.Mc(1,Ui,3,4,"th",11),h.Tb(2,"th",12),h.Oc(3),h.Sb(),h.Tb(4,"th",12),h.Oc(5),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.mc("ngForOf",i),h.Bb(2),h.Qc(" ",e.labels.collegate," "),h.Bb(2),h.Qc(" ",e.labels.azioni," ")}}function ki(i,t){if(1&i&&h.Ob(0,"div",27),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function Vi(i,t){if(1&i&&h.Ob(0,"div",28),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function $i(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr",15),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.gc(7,"date"),h.Sb(),h.Tb(8,"td"),h.Oc(9),h.Sb(),h.Tb(10,"td"),h.Tb(11,"div",16),h.Mc(12,ki,1,1,"div",17),h.Mc(13,Vi,1,1,"div",18),h.Sb(),h.Sb(),h.Tb(14,"td",19),h.Tb(15,"div",20),h.Tb(16,"div",21),h.Tb(17,"p-button",22),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,0)})),h.Sb(),h.Sb(),h.Tb(18,"div",21),h.Tb(19,"p-button",23),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,1)})),h.Sb(),h.Sb(),h.Tb(20,"div",21),h.Tb(21,"p-button",24),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,2)})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(22,"td"),h.Tb(23,"action-menu",25,26),h.bc("click",(function(){h.Ec(i);const e=t.$implicit,a=t.rowIndex,n=h.Bc(24);return h.fc().onDropdownMenuOpen(n,e,a)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.mc("pSelectableRow",i),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.denominazione),h.Bb(2),h.Pc(h.ic(7,14,i.dtProtocollazione,"dd/MM/yyyy")),h.Bb(3),h.Pc(i.idProtocollo),h.Bb(3),h.mc("ngIf","OK"===i.esito),h.Bb(1),h.mc("ngIf","KO"===i.esito),h.Bb(4),h.nc("title",e.labels.DOMANDE_SUPERFICIE_EU),h.mc("disabled",!(i.idsDomandaSuperficie.length>0)),h.Bb(2),h.nc("title",e.labels.DOMANDE_STRUTTURALI_EU),h.mc("disabled",!(i.idsDomandaStrutturale.length>0)),h.Bb(2),h.nc("title",e.labels.DOMANDE_UNICHE),h.mc("disabled",!(i.idsDomandaDu.length>0)),h.Bb(2),h.mc("item",e.menuAction)}}function Gi(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.Cb("colspan",i.length+3),h.Bb(1),h.Qc(" ",e.labels.noTableContent," ")}}let Zi=(()=>{class i{constructor(i,t,e,a){this.istruttoriaAntimafiaService=i,this.antimafiaService=t,this.route=e,this.router=a,this.labels=r.a,this.menuAction=new Array,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new O,this.elementiTotali=0,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.labels.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.labels.descrizioneImpresa},{field:"dtProtocollazione",header:this.labels.data},{field:"idProtocollo",header:this.labels.nrProtocollo},{field:"esito",header:this.labels.esitoTrasmissione}]}onDropdownMenuOpen(i,t,e){this.indexSelectedFromMenu=e,this.domandaAntimafiaSelezionataFromMenuAction=t,this.currentMenuAction=i}menuActionDisplay(){return[{label:r.a.azioni.toUpperCase(),items:[{label:this.labels.SCARICA,command:()=>{this.downloadDichiarazioneAntimafia(),this.currentMenuAction.reset=!0}}]}]}ngOnInit(){this.menuAction=this.menuActionDisplay(),this.textTitle=r.a.CERTIFICAZIONI_ANTIMAFIA_POSITIVE}ngOnDestroy(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}downloadDichiarazioneAntimafia(){const i=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(this.domandaAntimafiaSelezionataFromMenuAction.id.toString());this.dichiarazioneAntimafiaSubscpription=i.pipe(Object(g.a)(i=>(this.antimafiaService.downloadDichiarazioneAntimafia(i.pdfFirmato,i.tipoPdfFirmato),Object(_.a)(i)))).subscribe(i=>{const t=this.antimafiaService.getAllegati(i);this.antimafiaService.downloadAllegati(t)})}visualizzaDettaglioDomanda(i,t){let e={queryParams:{activeIndex:t,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:5},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],e)}loadData(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){let t="";switch(i.sortField){case this.cols[0].field:t="cuaa";break;case this.cols[1].field:t="denominazioneImpresa";break;default:t=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(t)}this.loadList(i.first,i.globalFilter)}loadList(i,t){this.ricercaAntimafiaFilter.filtroGenerico=t||null,this.ricercaAntimafiaFilter.statoDichiarazione=s.a.POSITIVO,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe(i=>{this.elementiTotali=i.total,this.certificazioneAntimafia=i.results?i.results:[]},i=>{console.log("error: "+i)})}buildDescrizioneTooltip(i){let t=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?t+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(t+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?t+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(t+=" | ESITO INVIO A BDNA NON DISPONIBILE"),t}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(l.a),h.Nb(o.a),h.Nb(n.a),h.Nb(n.e))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-cert-amf-esito-positivo"]],decls:14,vars:11,consts:[[1,"ui-grid-fixed"],["position","top-center","key","generic",3,"baseZIndex"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"]],template:function(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",0),h.Ob(1,"p-toast",1),h.Tb(2,"div",2),h.Tb(3,"h3"),h.Oc(4),h.Sb(),h.Tb(5,"div",3),h.Tb(6,"i",4),h.Oc(7,"search"),h.Sb(),h.Tb(8,"input",5),h.bc("input",(function(t){return h.Ec(i),h.Bc(10).filterGlobal(t.target.value,"contains")})),h.Sb(),h.Sb(),h.Tb(9,"p-table",6,7),h.bc("onLazyLoad",(function(i){return t.loadData(i)})),h.Mc(11,Li,6,3,"ng-template",8),h.Mc(12,$i,25,17,"ng-template",9),h.Mc(13,Gi,3,2,"ng-template",10),h.Sb(),h.Sb(),h.Sb()}2&i&&(h.Bb(1),h.mc("baseZIndex",5e4),h.Bb(3),h.Pc(t.textTitle),h.Bb(5),h.mc("columns",t.cols)("value",t.certificazioneAntimafia)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",t.elementiTotali)("rowsPerPageOptions",t.labels.sizePerPagina))},directives:[z.a,v.a,C.q,T.e,a.s,C.p,C.o,C.m,a.t,D.a,P.a,U.a],pipes:[a.f],styles:["",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),i})();function Ki(i,t){if(1&i&&(h.Tb(0,"th",15),h.Oc(1),h.Ob(2,"p-sortIcon",16),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.field)}}function ji(i,t){if(1&i&&(h.Tb(0,"tr"),h.Mc(1,Ki,3,4,"th",13),h.Tb(2,"th",14),h.Oc(3),h.Sb(),h.Tb(4,"th",14),h.Oc(5),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.mc("ngForOf",i),h.Bb(2),h.Qc(" ",e.labels.collegate," "),h.Bb(2),h.Qc(" ",e.labels.azioni," ")}}function Qi(i,t){if(1&i&&h.Ob(0,"div",29),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function Ji(i,t){if(1&i&&h.Ob(0,"div",30),2&i){const i=h.fc().$implicit,t=h.fc();h.mc("pTooltip",t.buildDescrizioneTooltip(i))}}function Hi(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr",17),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.gc(7,"date"),h.Sb(),h.Tb(8,"td"),h.Oc(9),h.Sb(),h.Tb(10,"td"),h.Tb(11,"div",18),h.Mc(12,Qi,1,1,"div",19),h.Mc(13,Ji,1,1,"div",20),h.Sb(),h.Sb(),h.Tb(14,"td",21),h.Tb(15,"div",22),h.Tb(16,"div",23),h.Tb(17,"p-button",24),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,0)})),h.Sb(),h.Sb(),h.Tb(18,"div",23),h.Tb(19,"p-button",25),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,1)})),h.Sb(),h.Sb(),h.Tb(20,"div",23),h.Tb(21,"p-button",26),h.bc("onClick",(function(){h.Ec(i);const e=t.$implicit;return h.fc().visualizzaDettaglioDomanda(e,2)})),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(22,"td"),h.Tb(23,"action-menu",27,28),h.bc("click",(function(){h.Ec(i);const e=t.$implicit,a=t.rowIndex,n=h.Bc(24);return h.fc().onDropdownMenuOpen(n,e,a)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.mc("pSelectableRow",i),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),h.Bb(2),h.Pc(i.datiDichiarazione.dettaglioImpresa.denominazione),h.Bb(2),h.Pc(h.ic(7,14,i.dtProtocollazione,"dd/MM/yyyy")),h.Bb(3),h.Pc(i.idProtocollo),h.Bb(3),h.mc("ngIf","OK"===i.esito),h.Bb(1),h.mc("ngIf","KO"===i.esito),h.Bb(4),h.nc("title",e.labels.DOMANDE_SUPERFICIE_EU),h.mc("disabled",!(i.idsDomandaSuperficie.length>0)),h.Bb(2),h.nc("title",e.labels.DOMANDE_STRUTTURALI_EU),h.mc("disabled",!(i.idsDomandaStrutturale.length>0)),h.Bb(2),h.nc("title",e.labels.DOMANDE_UNICHE),h.mc("disabled",!(i.idsDomandaDu.length>0)),h.Bb(2),h.mc("item",e.menuAction)}}function qi(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=t.$implicit,e=h.fc();h.Bb(1),h.Cb("colspan",i.length+3),h.Bb(1),h.Qc(" ",e.labels.noTableContent," ")}}function Wi(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",31),h.Ob(1,"i",32),h.Tb(2,"h3"),h.Oc(3),h.Sb(),h.Tb(4,"p"),h.Oc(5),h.Sb(),h.Sb(),h.Tb(6,"div",33),h.Tb(7,"div",34),h.Tb(8,"button",35),h.bc("click",(function(){return h.Ec(i),h.fc().onConfirmAggiornaStato()})),h.Sb(),h.Sb(),h.Tb(9,"div",34),h.Tb(10,"button",36),h.bc("click",(function(){return h.Ec(i),h.fc().onRejectAggiornaStato()})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit;h.Bb(3),h.Pc(i.summary),h.Bb(2),h.Pc(i.detail)}}let Yi=(()=>{class i{constructor(i,t,e,a,n){this.antimafiaService=i,this.istruttoriaAntimafiaService=t,this.route=e,this.router=a,this.messages=n,this.textTitle=r.a.CERTIFICAZIONI_ANTIMAFIA_VERIFICA_PERIODICA,this.labels=r.a,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new h.n,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new O,this.elementiTotali=0,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.labels.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.labels.descrizioneImpresa},{field:"dtProtocollazione",header:this.labels.data},{field:"idProtocollo",header:this.labels.nrProtocollo},{field:"esito",header:this.labels.esitoTrasmissione}]}ngOnInit(){this.menuAction=this.menuActionDisplay()}ngOnDestroy(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}menuActionDisplay(){return[{label:r.a.azioni.toUpperCase(),items:[{label:this.labels.SCARICA,command:()=>{this.downloadDichiarazioneAntimafia(this.domandaAntimafiaSelezionataFromMenuAction.id.toString()),this.currentMenuAction.reset=!0}},{label:r.a.ESITO_POSITIVO,command:()=>{this.openPopupEsitoPositivo(),this.currentMenuAction.reset=!0}}]}]}downloadDichiarazioneAntimafia(i){const t=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(i);this.dichiarazioneAntimafiaSubscpription=t.pipe(Object(g.a)(i=>(this.antimafiaService.downloadDichiarazioneAntimafia(i.pdfFirmato,i.tipoPdfFirmato),Object(_.a)(i)))).subscribe(i=>{const t=this.antimafiaService.getAllegati(i);this.antimafiaService.downloadAllegati(t)})}visualizzaDettaglioDomanda(i,t){let e={queryParams:{activeIndex:t,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:6},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],e)}onDropdownMenuOpen(i,t,e){this.indexSelectedFromMenu=e,this.domandaAntimafiaSelezionataFromMenuAction=t,this.currentMenuAction=i,this.currentMenuAction.reset=!1}openPopupEsitoPositivo(){this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(s.a.POSITIVO)))}onConfirmAggiornaStato(){this.messages.clear(),this.esitoPositivo()}onRejectAggiornaStato(){this.messages.clear()}esitoPositivo(){let i=this.domandaAntimafiaSelezionataFromMenuAction;i.stato.descrizione=null,i.stato.id=null,i.stato.identificativo=s.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe(i=>{let t=new I(this.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);this.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe(i=>{i&&i.forEach(e=>{e.cuaa===t.cuaa&&(e.dtFineEsitoNegativo=null,e.dtFineSilenzioAssenso=null,e.dtInizioEsitoNegativo=null,e.dtInizioSilenzioAssenso=null),this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(i)}),this.loadList(0,null)},i=>console.log(i))},i=>{this.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))})}loadData(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){let t="";switch(i.sortField){case this.cols[0].field:t="cuaa";break;case this.cols[1].field:t="denominazioneImpresa";break;default:t=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(t)}this.loadList(i.first,i.globalFilter)}loadList(i,t){this.ricercaAntimafiaFilter.filtroGenerico=t||null,this.ricercaAntimafiaFilter.statoDichiarazione=s.a.VERIFICA_PERIODICA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe(i=>{this.elementiTotali=i.total,this.certificazioneAntimafia=i.results?i.results:[]},i=>{console.log("error: "+i)})}buildDescrizioneTooltip(i){let t=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?t+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(t+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?t+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(t+=" | ESITO INVIO A BDNA NON DISPONIBILE"),t}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(o.a),h.Nb(l.a),h.Nb(n.a),h.Nb(n.e),h.Nb(T.d))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-cert-amf-verifica-periodica"]],outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters"},decls:16,vars:13,consts:[[1,"ui-grid-fixed"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","top-center","key","generic",3,"baseZIndex"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",0),h.Tb(1,"div",1),h.Tb(2,"h3"),h.Oc(3),h.Sb(),h.Tb(4,"div",2),h.Tb(5,"i",3),h.Oc(6,"search"),h.Sb(),h.Tb(7,"input",4),h.bc("input",(function(t){return h.Ec(i),h.Bc(9).filterGlobal(t.target.value,"contains")})),h.Sb(),h.Sb(),h.Tb(8,"p-table",5,6),h.bc("onLazyLoad",(function(i){return t.loadData(i)})),h.Mc(10,ji,6,3,"ng-template",7),h.Mc(11,Hi,25,17,"ng-template",8),h.Mc(12,qi,3,2,"ng-template",9),h.Sb(),h.Sb(),h.Sb(),h.Ob(13,"p-toast",10),h.Tb(14,"p-toast",11),h.bc("onClose",(function(){return t.onRejectAggiornaStato()})),h.Mc(15,Wi,11,2,"ng-template",12),h.Sb()}2&i&&(h.Bb(3),h.Pc(t.textTitle),h.Bb(5),h.mc("columns",t.cols)("value",t.certificazioneAntimafia)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",t.elementiTotali)("rowsPerPageOptions",t.labels.sizePerPagina),h.Bb(5),h.mc("baseZIndex",5e4),h.Bb(1),h.mc("modal",!0)("baseZIndex",5e3))},directives:[v.a,C.q,T.e,z.a,a.s,C.p,C.o,C.m,a.t,D.a,P.a,U.a,D.b],pipes:[a.f],styles:["",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),i})();function Xi(i,t){if(1&i&&(h.Tb(0,"span",7),h.Oc(1),h.gc(2,"translate"),h.Tb(3,"span"),h.Oc(4),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Qc("",h.hc(2,2,"ANTIMAFIA.BOZZA")," "),h.Bb(3),h.Pc(i.itemBadges.bozza)}}function it(i,t){if(1&i){const i=h.Ub();h.Tb(0,"app-cert-amf-bozza",8),h.bc("aggiornaCertificazioniCounters",(function(t){return h.Ec(i),h.fc().aggiornaCounters(t)}))("runStatoAvanzamentoProcesso",(function(t){return h.Ec(i),h.fc().runStatoAvanzamentoProcesso(t,null)})),h.Sb()}if(2&i){const i=h.fc();h.mc("refreshFromParent",i.refresh)}}function tt(i,t){if(1&i&&(h.Tb(0,"span",7),h.Oc(1),h.gc(2,"translate"),h.Tb(3,"span"),h.Oc(4),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Qc("",h.hc(2,2,"ANTIMAFIA.PROTOCOLLATE")," "),h.Bb(3),h.Pc(i.itemBadges.protocollata)}}function et(i,t){if(1&i){const i=h.Ub();h.Tb(0,"app-cert-amf-protocollate",8),h.bc("aggiornaCertificazioniCounters",(function(t){return h.Ec(i),h.fc().aggiornaCounters(t)}))("runStatoAvanzamentoProcesso",(function(t){h.Ec(i);const e=h.fc();return e.runStatoAvanzamentoProcesso(t,e.controlloAntimafia)})),h.Sb()}if(2&i){const i=h.fc();h.mc("refreshFromParent",i.refresh)}}function at(i,t){if(1&i&&(h.Tb(0,"span",7),h.Oc(1),h.gc(2,"translate"),h.Tb(3,"span"),h.Oc(4),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Qc("",h.hc(2,2,"ANTIMAFIA.IN_ISTRUTTORIA")," "),h.Bb(3),h.Pc(i.itemBadges.controllata)}}function nt(i,t){if(1&i){const i=h.Ub();h.Tb(0,"app-cert-amf-controllate",8),h.bc("aggiornaCertificazioniCounters",(function(t){return h.Ec(i),h.fc().aggiornaCounters(t)}))("runStatoAvanzamentoProcesso",(function(t){h.Ec(i);const e=h.fc();return e.runStatoAvanzamentoProcesso(t,e.processoImportaDomandePsr)})),h.Sb()}if(2&i){const i=h.fc();h.mc("refreshFromParent",i.refresh)}}function ot(i,t){if(1&i&&(h.Tb(0,"span",7),h.Oc(1),h.gc(2,"translate"),h.Tb(3,"span"),h.Oc(4),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Qc("",h.hc(2,2,"ANTIMAFIA.CONTROLLO_MANUALE")," "),h.Bb(3),h.Pc(i.itemBadges.controlloManuale)}}function st(i,t){if(1&i){const i=h.Ub();h.Tb(0,"app-cert-amf-controllo-manuale",9),h.bc("aggiornaCertificazioniCounters",(function(t){return h.Ec(i),h.fc().aggiornaCounters(t)})),h.Sb()}}function ct(i,t){if(1&i&&(h.Tb(0,"span",7),h.Oc(1),h.gc(2,"translate"),h.Tb(3,"span"),h.Oc(4),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Qc("",h.hc(2,2,"ANTIMAFIA.RIFIUTATE")," "),h.Bb(3),h.Pc(i.itemBadges.rifiutata)}}function rt(i,t){if(1&i){const i=h.Ub();h.Tb(0,"app-cert-amf-rifiutate",9),h.bc("aggiornaCertificazioniCounters",(function(t){return h.Ec(i),h.fc().aggiornaCounters(t)})),h.Sb()}}function lt(i,t){if(1&i&&(h.Tb(0,"span",7),h.Oc(1),h.gc(2,"translate"),h.Tb(3,"span"),h.Oc(4),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Qc("",h.hc(2,2,"ANTIMAFIA.ESITO_POSITIVO")," "),h.Bb(3),h.Pc(i.itemBadges.positiva)}}function dt(i,t){1&i&&h.Ob(0,"app-cert-amf-esito-positivo")}function bt(i,t){if(1&i&&(h.Tb(0,"span",7),h.Oc(1),h.gc(2,"translate"),h.Tb(3,"span"),h.Oc(4),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Qc("",h.hc(2,2,"ANTIMAFIA.VERIFICA_PERIODICA")," "),h.Bb(3),h.Pc(i.itemBadges.verificaPeriodica)}}function ut(i,t){if(1&i){const i=h.Ub();h.Tb(0,"app-cert-amf-verifica-periodica",9),h.bc("aggiornaCertificazioniCounters",(function(t){return h.Ec(i),h.fc().aggiornaCounters(t)})),h.Sb()}}let mt=(()=>{class i{constructor(i,t,e,a,n){this.antimafiaService=i,this.istruttoriaAntimafiaService=t,this.http=e,this._configuration=a,this.translateService=n,this.labels=r.a,this.processiInCorso=r.a.NESSUN_PROCESSO_DI_CONTROLLO,this.refresh=!1,this.controlloAntimafia=d.a.CONTROLLO_ANTIMAFIA,this.processoImportaDomandePsr=d.a.IMPORTA_DOMANDE_PSR_SUPERFICIE,this.timeout=3e4}ngOnInit(){this.loadCounters(),this.index=this.istruttoriaAntimafiaService.getTabIndex(),this.newCheckStatoAvanzamento()}ngOnDestroy(){u.a.isUndefinedOrNull(this.timer)||this.timer.unsubscribe(),this.refresh=!1}aggiornaCounters(i){this.loadCounters()}loadCounters(){this.itemBadges=new c,this.antimafiaService.getStatoDichiarazioniCount({statiDichiarazione:[s.a.BOZZA,s.a.PROTOCOLLATA,s.a.CONTROLLATA,s.a.CONTROLLO_MANUALE,s.a.RIFIUTATA,s.a.POSITIVO,s.a.VERIFICA_PERIODICA]}).subscribe(i=>{console.log("NEXT = "+JSON.stringify(i)),this.itemBadges=i})}newCheckStatoAvanzamento(){this.istruttoriaAntimafiaService.getProcessiDiControllo(d.a.CONTROLLO_ANTIMAFIA).pipe(Object(g.a)(i=>i?(this.runStatoAvanzamentoProcesso(Number(i[0].datiElaborazioneProcesso.daElaborare),d.a.CONTROLLO_ANTIMAFIA),null):this.istruttoriaAntimafiaService.getProcessiDiControllo(d.a.IMPORTA_DOMANDE_PSR_SUPERFICIE))).subscribe(i=>(i&&this.runStatoAvanzamentoProcesso(Number(i[0].datiElaborazioneProcesso.daElaborare),d.a.IMPORTA_DOMANDE_PSR_SUPERFICIE),null))}runStatoAvanzamentoProcesso(i,t){let e=0,a=i;this.processiInCorso=u.a.procesioDiControlloIstruttoria(String(this.translateService.instant("PROCESSI."+t)),String(e),String(a));let n=encodeURIComponent(JSON.stringify({tipoProcesso:t,statoProcesso:b.a.RUN}));this.timer=Object(m.a)(0,this.timeout).subscribe(i=>{this.http.get(this._configuration.urlControlloAntimafiaStatoAvanzamento+n).subscribe(n=>{if(i>1&&String(n.esito)===r.a.NESSUN_PROCESSO_DI_CONTROLLO)return this.timer.unsubscribe(),this.processiInCorso=r.a.NESSUN_PROCESSO_DI_CONTROLLO,this.refresh=!0,void this.loadCounters();u.a.isUndefinedOrNull(n.totale)||(e=n.totale,this.processiInCorso=u.a.procesioDiControlloIstruttoria(String(this.translateService.instant("PROCESSI."+t)),String(e),String(a))),e>=a&&(this.timer.unsubscribe(),this.processiInCorso=r.a.NESSUN_PROCESSO_DI_CONTROLLO,this.refresh=!0,this.loadCounters())},i=>{this.timer.unsubscribe(),this.processiInCorso=r.a.NESSUN_PROCESSO_DI_CONTROLLO})})}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(o.a),h.Nb(l.a),h.Nb(f.b),h.Nb(p.a),h.Nb(S.e))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-certificazioni-antimafia"]],decls:31,vars:5,consts:[[1,"ui-g-12"],[1,"ui-grid-fixed"],[1,"funzioni-grid","tab-new","boxgrey"],[3,"activeIndex"],["pTemplate","header"],["pTemplate","content"],[1,"boxgrey"],[1,"ui-tabview-title","ng-star-inserted"],[3,"refreshFromParent","aggiornaCertificazioniCounters","runStatoAvanzamentoProcesso"],[3,"aggiornaCertificazioniCounters"]],template:function(i,t){1&i&&(h.Tb(0,"div",0),h.Tb(1,"div",1),h.Tb(2,"div",2),h.Tb(3,"p-tabView",3),h.Tb(4,"p-tabPanel"),h.Mc(5,Xi,5,4,"ng-template",4),h.Mc(6,it,1,1,"ng-template",5),h.Sb(),h.Tb(7,"p-tabPanel"),h.Mc(8,tt,5,4,"ng-template",4),h.Mc(9,et,1,1,"ng-template",5),h.Sb(),h.Tb(10,"p-tabPanel"),h.Mc(11,at,5,4,"ng-template",4),h.Mc(12,nt,1,1,"ng-template",5),h.Sb(),h.Tb(13,"p-tabPanel"),h.Mc(14,ot,5,4,"ng-template",4),h.Mc(15,st,1,0,"ng-template",5),h.Sb(),h.Tb(16,"p-tabPanel"),h.Mc(17,ct,5,4,"ng-template",4),h.Mc(18,rt,1,0,"ng-template",5),h.Sb(),h.Tb(19,"p-tabPanel"),h.Mc(20,lt,5,4,"ng-template",4),h.Mc(21,dt,1,0,"ng-template",5),h.Sb(),h.Tb(22,"p-tabPanel"),h.Mc(23,bt,5,4,"ng-template",4),h.Mc(24,ut,1,0,"ng-template",5),h.Sb(),h.Sb(),h.Tb(25,"div",6),h.Tb(26,"h5"),h.Oc(27),h.gc(28,"translate"),h.Sb(),h.Tb(29,"div"),h.Oc(30),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb()),2&i&&(h.Bb(3),h.mc("activeIndex",t.index),h.Bb(24),h.Pc(h.hc(28,3,"PROCESSI_DI_CONTROLLO")),h.Bb(3),h.Pc(t.processiInCorso))},directives:[A.b,A.a,T.e,F,j,Ti,Bi,xi,Zi,Yi],pipes:[S.d],styles:[".boxgrey[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#0d5f3f;font-weight:700;font-size:18px;text-transform:uppercase;padding-bottom:10px;margin-bottom:15px}.boxgrey[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > h5[_ngcontent-%COMP%]{border-bottom:2px solid #0d5f3f}[_nghost-%COMP%] .ui-paginator{display:flex;justify-content:flex-end}[_nghost-%COMP%] .ui-dropdown .ui-dropdown-trigger{top:-5px}"]}),i})();var pt=e("jcoe"),gt=function(i){return i.CHIUSA_CON_ESITO_NEGATIVO="CHIUSA_CON_ESITO_NEGATIVO",i.ANOMALIA="ANOMALIA",i.IN_LAVORAZIONE="IN_LAVORAZIONE",i.IN_ISTRUTTORIA="IN_ISTRUTTORIA",i.IN_INSERIMENTO="IN_INSERIMENTO",i.IN_CODA="IN_CODA",i.ATTI="ATTI",i.ESITO_POSITIVO="ESITO_POSITIVO",i.RIFIUTATO="RIFIUTATO",i.NON_CARICATO="NON_CARICATO",i}({}),ht=e("yhG/"),ft=e("DYOT");function St(i,t){if(1&i){const i=h.Ub();h.Tb(0,"div",17),h.Ob(1,"i",18),h.Tb(2,"h3"),h.Oc(3),h.Sb(),h.Tb(4,"p"),h.Oc(5),h.Sb(),h.Sb(),h.Tb(6,"div",19),h.Tb(7,"div",20),h.Tb(8,"button",21),h.bc("click",(function(){return h.Ec(i),h.fc().onConfirmAggiornaStato()})),h.Sb(),h.Sb(),h.Tb(9,"div",20),h.Tb(10,"button",22),h.bc("click",(function(){return h.Ec(i),h.fc().onRejectAggiornaStato()})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit;h.Bb(3),h.Pc(i.summary),h.Bb(2),h.Pc(i.detail)}}function At(i,t){if(1&i&&(h.Tb(0,"th",24),h.Oc(1),h.Ob(2,"p-sortIcon",25),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.header)}}function Tt(i,t){if(1&i&&(h.Tb(0,"tr"),h.Mc(1,At,3,4,"th",23),h.Sb()),2&i){const i=t.$implicit;h.Bb(1),h.mc("ngForOf",i)}}function It(i,t){if(1&i){const i=h.Ub();h.Tb(0,"p-calendar",34),h.bc("ngModelChange",(function(t){return h.Ec(i),h.fc().$implicit.dtBdna=t})),h.Sb()}if(2&i){const i=h.fc().$implicit;h.mc("ngModel",i.dtBdna)("showIcon",!0)}}function Ot(i,t){if(1&i&&(h.Oc(0),h.gc(1,"date")),2&i){const i=h.fc().$implicit;h.Qc(" ",h.ic(1,1,i.dtBdna,"dd/MM/yyyy")," ")}}function zt(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.gc(7,"date"),h.Sb(),h.Tb(8,"td"),h.Oc(9),h.Sb(),h.Tb(10,"td"),h.Oc(11),h.gc(12,"number"),h.Sb(),h.Tb(13,"td"),h.Oc(14),h.gc(15,"date"),h.Sb(),h.Tb(16,"td"),h.Oc(17),h.gc(18,"date"),h.Sb(),h.Tb(19,"td"),h.Oc(20),h.gc(21,"date"),h.Sb(),h.Tb(22,"td"),h.Oc(23),h.gc(24,"date"),h.Sb(),h.Tb(25,"td"),h.Oc(26),h.gc(27,"date"),h.Sb(),h.Tb(28,"td",26),h.Tb(29,"p-cellEditor"),h.Mc(30,It,1,2,"ng-template",27),h.Mc(31,Ot,2,4,"ng-template",28),h.Sb(),h.Sb(),h.Tb(32,"td",29),h.Tb(33,"input",30),h.bc("ngModelChange",(function(e){return h.Ec(i),t.$implicit.protocollo=e})),h.Sb(),h.Sb(),h.Tb(34,"td"),h.Oc(35),h.gc(36,"translate"),h.Sb(),h.Tb(37,"td",31),h.Tb(38,"action-menu",32,33),h.bc("click",(function(){h.Ec(i);const e=t.$implicit;return h.fc().onDropdownMenuOpen(0,e)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.Bb(2),h.Pc(i.cuaa),h.Bb(2),h.Pc(i.idDomanda),h.Bb(2),h.Pc(i.dtDomanda?h.ic(7,14,i.dtDomanda,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.campagna),h.Bb(2),h.Pc(h.jc(12,17,i.importoRichiesto,"1.2-2","it")),h.Bb(3),h.Pc(i.dtBdnaOp?h.ic(15,21,i.dtBdnaOp,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtInizioSilenzioAssenso?h.ic(18,24,i.dtInizioSilenzioAssenso,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtFineSilenzioAssenso?h.ic(21,27,i.dtFineSilenzioAssenso,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtInizioEsitoNegativo?h.ic(24,30,i.dtInizioEsitoNegativo,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtFineEsitoNegativo?h.ic(27,33,i.dtFineEsitoNegativo,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(7),h.mc("ngModel",i.protocollo),h.Bb(2),h.Pc(h.hc(36,36,i.statoBdna)),h.Bb(3),h.mc("item",e.menuActionDomanda)("reset",e.reset)}}function vt(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Cb("colspan",14),h.Bb(1),h.Qc(" ",i.intestazioni.noTableContent," ")}}function Ct(i,t){if(1&i&&(h.Tb(0,"th",24),h.Oc(1),h.Ob(2,"p-sortIcon",25),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.header)}}function Dt(i,t){if(1&i&&(h.Tb(0,"tr"),h.Mc(1,Ct,3,4,"th",23),h.Sb()),2&i){const i=t.$implicit;h.Bb(1),h.mc("ngForOf",i)}}function Pt(i,t){if(1&i){const i=h.Ub();h.Tb(0,"p-calendar",35),h.bc("ngModelChange",(function(t){return h.Ec(i),h.fc().$implicit.dtBdna=t})),h.Sb()}if(2&i){const i=h.fc().$implicit;h.mc("ngModel",i.dtBdna)("showIcon",!0)("baseZIndex",1e9)}}function Bt(i,t){if(1&i&&(h.Oc(0),h.gc(1,"date")),2&i){const i=h.fc().$implicit;h.Qc(" ",h.ic(1,1,i.dtBdna,"dd/MM/yyyy")," ")}}function Nt(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.Sb(),h.Tb(7,"td"),h.Oc(8),h.gc(9,"date"),h.Sb(),h.Tb(10,"td"),h.Oc(11),h.gc(12,"number"),h.Sb(),h.Tb(13,"td"),h.Oc(14),h.gc(15,"date"),h.Sb(),h.Tb(16,"td"),h.Oc(17),h.gc(18,"date"),h.Sb(),h.Tb(19,"td"),h.Oc(20),h.gc(21,"date"),h.Sb(),h.Tb(22,"td"),h.Oc(23),h.gc(24,"date"),h.Sb(),h.Tb(25,"td"),h.Oc(26),h.gc(27,"date"),h.Sb(),h.Tb(28,"td",26),h.Tb(29,"p-cellEditor"),h.Mc(30,Pt,1,3,"ng-template",27),h.Mc(31,Bt,2,4,"ng-template",28),h.Sb(),h.Sb(),h.Tb(32,"td",29),h.Tb(33,"input",30),h.bc("ngModelChange",(function(e){return h.Ec(i),t.$implicit.protocollo=e})),h.Sb(),h.Sb(),h.Tb(34,"td"),h.Oc(35),h.gc(36,"translate"),h.Sb(),h.Tb(37,"td",31),h.Tb(38,"action-menu",32,33),h.bc("click",(function(){h.Ec(i);const e=t.$implicit;return h.fc().onDropdownMenuOpen(1,e)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.Bb(2),h.Pc(i.misurePsr),h.Bb(2),h.Pc(i.cuaa),h.Bb(2),h.Pc(i.idDomanda),h.Bb(2),h.Pc(i.dtDomanda?h.ic(9,14,i.dtDomanda,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(h.jc(12,17,i.importoRichiesto,"1.2-2","it")),h.Bb(3),h.Pc(i.dtBdnaOp?h.ic(15,21,i.dtBdnaOp,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtInizioSilenzioAssenso?h.ic(18,24,i.dtInizioSilenzioAssenso,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtFineSilenzioAssenso?h.ic(21,27,i.dtFineSilenzioAssenso,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtInizioEsitoNegativo?h.ic(24,30,i.dtInizioEsitoNegativo,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtFineEsitoNegativo?h.ic(27,33,i.dtFineEsitoNegativo,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(7),h.mc("ngModel",i.protocollo),h.Bb(2),h.Pc(h.hc(36,36,i.statoBdna)),h.Bb(3),h.mc("item",e.menuActionDomanda)("reset",e.reset)}}function Mt(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Cb("colspan",14),h.Bb(1),h.Qc(" ",i.intestazioni.noTableContent," ")}}function Et(i,t){if(1&i&&(h.Tb(0,"th",24),h.Oc(1),h.Ob(2,"p-sortIcon",25),h.Sb()),2&i){const i=t.$implicit;h.mc("pSortableColumn",i.field)("pSortableColumnDisabled",null==i.field),h.Bb(1),h.Qc(" ",i.header," "),h.Bb(1),h.mc("field",i.header)}}function yt(i,t){if(1&i&&(h.Tb(0,"tr"),h.Mc(1,Et,3,4,"th",23),h.Sb()),2&i){const i=t.$implicit;h.Bb(1),h.mc("ngForOf",i)}}function Ft(i,t){if(1&i){const i=h.Ub();h.Tb(0,"p-calendar",35),h.bc("ngModelChange",(function(t){return h.Ec(i),h.fc().$implicit.dtBdna=t})),h.Sb()}if(2&i){const i=h.fc().$implicit;h.mc("ngModel",i.dtBdna)("showIcon",!0)("baseZIndex",1e9)}}function Rt(i,t){if(1&i&&(h.Oc(0),h.gc(1,"date")),2&i){const i=h.fc().$implicit;h.Qc(" ",h.ic(1,1,i.dtBdna,"dd/MM/yyyy")," ")}}function _t(i,t){if(1&i){const i=h.Ub();h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Tb(3,"td"),h.Oc(4),h.Sb(),h.Tb(5,"td"),h.Oc(6),h.gc(7,"date"),h.Sb(),h.Tb(8,"td"),h.Oc(9),h.Sb(),h.Tb(10,"td"),h.Oc(11),h.gc(12,"number"),h.Sb(),h.Tb(13,"td"),h.Oc(14),h.gc(15,"date"),h.Sb(),h.Tb(16,"td"),h.Oc(17),h.gc(18,"date"),h.Sb(),h.Tb(19,"td"),h.Oc(20),h.gc(21,"date"),h.Sb(),h.Tb(22,"td"),h.Oc(23),h.gc(24,"date"),h.Sb(),h.Tb(25,"td"),h.Oc(26),h.gc(27,"date"),h.Sb(),h.Tb(28,"td",26),h.Tb(29,"p-cellEditor"),h.Mc(30,Ft,1,3,"ng-template",27),h.Mc(31,Rt,2,4,"ng-template",28),h.Sb(),h.Sb(),h.Tb(32,"td",29),h.Tb(33,"input",30),h.bc("ngModelChange",(function(e){return h.Ec(i),t.$implicit.protocollo=e})),h.Sb(),h.Sb(),h.Tb(34,"td"),h.Oc(35),h.gc(36,"translate"),h.Sb(),h.Tb(37,"td",31),h.Tb(38,"action-menu",32,33),h.bc("click",(function(){h.Ec(i);const e=t.$implicit;return h.fc().onDropdownMenuOpen(2,e)})),h.Sb(),h.Sb(),h.Sb()}if(2&i){const i=t.$implicit,e=h.fc();h.Bb(2),h.Pc(i.cuaa),h.Bb(2),h.Pc(i.idDomanda),h.Bb(2),h.Pc(i.dtDomanda?h.ic(7,14,i.dtDomanda,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.campagna),h.Bb(2),h.Pc(h.jc(12,17,i.importoRichiesto,"1.2-2","it")),h.Bb(3),h.Pc(i.dtBdnaOp?h.ic(15,21,i.dtBdnaOp,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtInizioSilenzioAssenso?h.ic(18,24,i.dtInizioSilenzioAssenso,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtFineSilenzioAssenso?h.ic(21,27,i.dtFineSilenzioAssenso,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtInizioEsitoNegativo?h.ic(24,30,i.dtInizioEsitoNegativo,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(3),h.Pc(i.dtFineEsitoNegativo?h.ic(27,33,i.dtFineEsitoNegativo,"dd/MM/yyyy"):e.intestazioni.nd),h.Bb(7),h.mc("ngModel",i.protocollo),h.Bb(2),h.Pc(h.hc(36,36,i.statoBdna)),h.Bb(3),h.mc("item",e.menuActionDomanda)("reset",e.reset)}}function wt(i,t){if(1&i&&(h.Tb(0,"tr"),h.Tb(1,"td"),h.Oc(2),h.Sb(),h.Sb()),2&i){const i=h.fc();h.Bb(1),h.Cb("colspan",14),h.Bb(1),h.Qc(" ",i.intestazioni.noTableContent," ")}}const xt=[{path:"",component:mt,pathMatch:"full"},{path:"dettaglioDomandeCollegate",component:(()=>{class i{constructor(i,t,e,a,n,o){this.route=i,this.istruttoriaAntimafiaService=t,this.messages=e,this.location=a,this.antimafiaService=n,this.loader=o,this.activeIndex=-1,this.activeIndexMenuAction=-1,this.intestazioni=r.a,this.textTitleInner=r.a.domandeCollegateAntimafia,this.textTitle="",this.loaded=[!1,!1,!1],this.domandeUnicheView=new Array,this.domandeStrutturaliView=new Array,this.domandeSuperficieView=new Array,this.menuActionDomanda=new Array,this.colsSUPDU=[{field:"cuaa",header:this.intestazioni.cuaaSigla},{field:"idDomanda",header:this.intestazioni.idDomanda},{field:"dtDomanda",header:this.intestazioni.dtDomanda},{field:"campagna",header:this.intestazioni.campagna},{field:"importoRichiesto",header:this.intestazioni.importoRichiesto},{field:"dtBdnaOp",header:this.intestazioni.dtBdnaOp},{field:"dtInizioSilenzioAssenso",header:this.intestazioni.dtInizioSilenzioAssenso},{field:"dtFineSilenzioAssenso",header:this.intestazioni.dtFineSilenzioAssenso},{field:"dtInizioEsitoNegativo",header:this.intestazioni.dtInizioEsitoNegativo},{field:"dtFineEsitoNegativo",header:this.intestazioni.dtFineEsitoNegativo},{field:"dtBdna",header:this.intestazioni.dtBdna},{field:"protocollo",header:this.intestazioni.protocollo},{field:"statoBdna",header:this.intestazioni.statoBdna},{header:this.intestazioni.azioni}],this.colsPSRStr=[{field:"misura",header:this.intestazioni.misura},{field:"cuaa",header:this.intestazioni.cuaaSigla},{field:"idDomanda",header:this.intestazioni.idDomanda},{field:"dtDomanda",header:this.intestazioni.dtDomanda},{field:"importoRichiesto",header:this.intestazioni.importoRichiesto},{field:"dtBdnaOp",header:this.intestazioni.dtBdnaOp},{field:"dtInizioSilenzioAssenso",header:this.intestazioni.dtInizioSilenzioAssenso},{field:"dtFineSilenzioAssenso",header:this.intestazioni.dtFineSilenzioAssenso},{field:"dtInizioEsitoNegativo",header:this.intestazioni.dtInizioEsitoNegativo},{field:"dtFineEsitoNegativo",header:this.intestazioni.dtFineEsitoNegativo},{field:"dtBdna",header:this.intestazioni.dtBdna},{field:"protocollo",header:this.intestazioni.protocollo},{field:"statoBdna",header:this.intestazioni.statoBdna},{header:this.intestazioni.azioni}],this.menuActionDomanda=[{label:r.a.azioni.toUpperCase(),items:[{label:r.a.ESITO_NEGATIVO,command:()=>{this.aggiornaStato(gt.CHIUSA_CON_ESITO_NEGATIVO)}},{separator:!0},{label:r.a.ACCETTATO_BDNA,command:()=>{this.aggiornaStato(gt.IN_ISTRUTTORIA)}},{separator:!0},{label:r.a.ANOMALIA_BDNA,command:()=>{this.aggiornaStato(gt.ANOMALIA)}}]}]}ngOnDestroy(){this.loader.resetTimeout()}ngOnInit(){this.loader.setTimeout(48e4),this.route.queryParams.subscribe(i=>{this.activeIndex=Number.parseInt(JSON.parse(i.activeIndex)),this.textTitle=r.a.descAziendaDomandeCollegateAntimafia+JSON.parse(i.descAzienda),this.idDichiarazioneAntimafia=Number.parseInt(JSON.parse(i.idDichiarazioneAntimafia)),this.cuaa=JSON.parse(i.cuaa),this.parentTabIndex=Number.parseInt(JSON.parse(i.parentTabIndex))}),!this.loaded[this.activeIndex]&&this.cuaa&&this.selectView(this.activeIndex,this.cuaa),this.antimafiaService.getDichiarazioneAntimafia(this.idDichiarazioneAntimafia.toString()).subscribe(i=>{this.dichiarazioneAntimafia=i},i=>{console.log("err - get dichiarazione antimafia"+this.idDichiarazioneAntimafia)})}goBack(){this.istruttoriaAntimafiaService.setTabIndex(this.parentTabIndex),this.location.back()}onTabClose(i){}onTabOpen(i){let t=i.index;!this.loaded[t]&&this.cuaa&&this.selectView(t,this.cuaa)}onConfirmAggiornaStato(){switch(this.messages.clear(),this.statoDaAggiornare){case gt.IN_ISTRUTTORIA:this.accettata(this.domandaDaAggiornare);break;case gt.ANOMALIA:this.inAnomalia(this.domandaDaAggiornare);break;case gt.CHIUSA_CON_ESITO_NEGATIVO:this.esitoNegativo(this.domandaDaAggiornare)}}setDomandaView(i,t){switch(t&&t.sort((i,t)=>i.dtDomanda>t.dtDomanda?-1:1).forEach(i=>{i.dtBdna&&(i.dtBdna=new Date(i.dtBdna))}),i){case 0:this.domandeSuperficieView=t,this.loaded[i]=!0;break;case 1:this.domandeStrutturaliView=t,this.loaded[i]=!0;break;case 2:this.domandeUnicheView=t,this.loaded[i]=!0}}selectView(i,t){switch(i){case 0:let e=new pt.a;e.cuaa=t,e.tipoDomanda=q.a.PSR_SUPERFICIE_EU,this.istruttoriaAntimafiaService.getDomandeCollegateFilter(e).subscribe(t=>{this.setDomandaView(i,t)});break;case 1:let a=new pt.a;a.cuaa=t,a.tipoDomanda=q.a.PSR_STRUTTURALI_EU,this.istruttoriaAntimafiaService.getDomandeCollegateFilter(a).subscribe(t=>{this.setDomandaView(i,t)});break;case 2:let n=new pt.a;n.cuaa=t,n.tipoDomanda=q.a.DOMANDA_UNICA,this.istruttoriaAntimafiaService.getDomandeCollegateFilter(n).subscribe(t=>{this.setDomandaView(i,t)})}}onDropdownMenuOpen(i,t){this.activeIndexMenuAction=i,this.domandaDaAggiornare=t}esitoNegativo(i){i.dtInizioSilenzioAssenso=new Date(i.dtBdna.getTime()),i.dtInizioSilenzioAssenso.setDate(i.dtInizioSilenzioAssenso.getDate()+30),i.dtFineSilenzioAssenso=new Date(i.dtBdna.getTime()),i.dtFineSilenzioAssenso.setDate(i.dtFineSilenzioAssenso.getDate()+210),i.dtInizioEsitoNegativo=i.dtBdna,i.dtFineEsitoNegativo=new Date(i.dtBdna.getTime()),i.dtFineEsitoNegativo.setDate(i.dtFineEsitoNegativo.getDate()+365),i.statoBdna=gt.CHIUSA_CON_ESITO_NEGATIVO,this.istruttoriaAntimafiaService.aggiornaDomandeCollegate(i).subscribe(i=>{this.selectView(this.activeIndexMenuAction,i.cuaa),this.sincronizzaDateBDNA(i),this.messages.add(u.a.getToast("tst",u.b.success,u.a.OPERAZIONE_OK))},i=>{console.log("Err -"+i.toString()),this.messages.add(u.a.getToast("tst",u.b.warn,u.a.CTRLIAMCNT007_KO))})}inAnomalia(i){i.dtInizioEsitoNegativo=null,i.dtFineEsitoNegativo=null,i.statoBdna=gt.ANOMALIA,this.istruttoriaAntimafiaService.aggiornaDomandeCollegate(i).subscribe(i=>{this.selectView(this.activeIndexMenuAction,i.cuaa),this.sincronizzaDateBDNA(i),this.messages.add(u.a.getToast("tst",u.b.success,u.a.OPERAZIONE_OK))},i=>{console.log("Err -"+i.toString()),this.messages.add(u.a.getToast("tst",u.b.warn,u.a.CTRLIAMCNT007_KO))})}accettata(i){i.dtInizioSilenzioAssenso=new Date(i.dtBdna.getTime()),i.dtInizioSilenzioAssenso.setDate(i.dtInizioSilenzioAssenso.getDate()+30),i.dtFineSilenzioAssenso=new Date(i.dtBdna.getTime()),i.dtFineSilenzioAssenso.setDate(i.dtFineSilenzioAssenso.getDate()+210),i.dtInizioEsitoNegativo=null,i.dtFineEsitoNegativo=null,i.statoBdna=gt.IN_ISTRUTTORIA,this.istruttoriaAntimafiaService.aggiornaDomandeCollegate(i).subscribe(i=>{this.selectView(this.activeIndexMenuAction,i.cuaa),this.sincronizzaDateBDNA(i),this.messages.add(u.a.getToast("tst",u.b.success,u.a.OPERAZIONE_OK))},i=>{console.log("Err -"+i.toString()),this.messages.add(u.a.getToast("tst",u.b.warn,u.a.CTRLIAMCNT007_KO))})}aggiornaStato(i){let t=this.domandaDaAggiornare;if(t.statoBdna===gt.NON_CARICATO)this.messages.add(u.a.getToast("tst",u.b.error,u.a.CTRLIAMCNT012));else{if(!t.dtBdna||!(t.protocollo||"").trim())return void this.messages.add(u.a.getToast("tst",u.b.warn,u.a.CTRLIAMCNT007));this.statoDaAggiornare=i,this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA_COLLEGATA(i)))}}sincronizzaDateBDNA(i){let t;t={cuaa:i.cuaa,idDomanda:i.idDomanda,tipoDomanda:i.tipoDomanda,dtInizioEsitoNegativo:i.dtInizioEsitoNegativo,dtInizioSilenzioAssenso:i.dtInizioSilenzioAssenso,dtFineEsitoNegativo:i.dtFineEsitoNegativo,dtFineSilenzioAssenso:i.dtFineSilenzioAssenso},this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia([t])}onRejectAggiornaStato(){this.messages.clear()}}return i.\u0275fac=function(t){return new(t||i)(h.Nb(n.a),h.Nb(l.a),h.Nb(T.d),h.Nb(a.n),h.Nb(o.a),h.Nb(Y.a))},i.\u0275cmp=h.Hb({type:i,selectors:[["app-dettaglio-domande-collegate"]],decls:39,vars:32,consts:[[1,"boxgrey","layout-actionmenu"],["position","top-center","key","tst",3,"baseZIndex"],["position","top-center","key","tst-esito-positivo",3,"baseZIndex","modal","onClose"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[1,"ui-g"],[1,"ui-g-12"],[3,"activeIndex","onClose","onOpen"],[3,"header"],[1,"boxgrey"],[1,"tabella-full"],[3,"columns","value","autoLayout","paginator","rows","responsive"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"columns","value","responsive","autoLayout","paginator","rows"],["type","button",1,"btn","btn-darkgreen",3,"click"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],["pEditableColumn","",1,"editabile"],["pTemplate","input"],["pTemplate","output"],[1,"editabile"],["type","text","pInputText","",3,"ngModel","ngModelChange"],[1,"pos-drop"],[3,"item","reset","click"],["actionMenu",""],["dateFormat","dd/mm/yy",3,"ngModel","showIcon","ngModelChange"],["dateFormat","dd/mm/yy",3,"ngModel","showIcon","baseZIndex","ngModelChange"]],template:function(i,t){1&i&&(h.Tb(0,"div",0),h.Ob(1,"p-toast",1),h.Tb(2,"p-toast",2),h.bc("onClose",(function(){return t.goBack()})),h.Sb(),h.Tb(3,"p-toast",3),h.bc("onClose",(function(){return t.onRejectAggiornaStato()})),h.Mc(4,St,11,2,"ng-template",4),h.Sb(),h.Tb(5,"div",5),h.Tb(6,"div",6),h.Tb(7,"h3"),h.Oc(8),h.Sb(),h.Tb(9,"p-accordion",7),h.bc("onClose",(function(i){return t.onTabClose(i)}))("onOpen",(function(i){return t.onTabOpen(i)})),h.Tb(10,"p-accordionTab",8),h.Tb(11,"div",9),h.Tb(12,"h3"),h.Oc(13),h.Sb(),h.Tb(14,"div",10),h.Tb(15,"p-table",11),h.Mc(16,Tt,2,1,"ng-template",12),h.Mc(17,zt,40,38,"ng-template",13),h.Mc(18,vt,3,2,"ng-template",14),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(19,"p-accordionTab",8),h.Tb(20,"div",9),h.Tb(21,"h3"),h.Oc(22),h.Sb(),h.Tb(23,"div",10),h.Tb(24,"p-table",11),h.Mc(25,Dt,2,1,"ng-template",12),h.Mc(26,Nt,40,38,"ng-template",13),h.Mc(27,Mt,3,2,"ng-template",14),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(28,"p-accordionTab",8),h.Tb(29,"div",9),h.Tb(30,"h3"),h.Oc(31),h.Sb(),h.Tb(32,"div",10),h.Tb(33,"p-table",15),h.Mc(34,yt,2,1,"ng-template",12),h.Mc(35,_t,40,38,"ng-template",13),h.Mc(36,wt,3,2,"ng-template",14),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Sb(),h.Tb(37,"button",16),h.bc("click",(function(){return t.goBack()})),h.Oc(38,"Indietro"),h.Sb(),h.Sb(),h.Sb(),h.Sb()),2&i&&(h.Bb(1),h.mc("baseZIndex",5e4),h.Bb(1),h.mc("baseZIndex",5e4)("modal",!0),h.Bb(1),h.mc("modal",!0)("baseZIndex",5e3),h.Bb(5),h.Pc(t.textTitle),h.Bb(1),h.mc("activeIndex",t.activeIndex),h.Bb(1),h.nc("header",t.intestazioni.PSR_SUPERFICIE_EU),h.Bb(3),h.Pc(t.textTitleInner),h.Bb(2),h.mc("columns",t.colsSUPDU)("value",t.domandeSuperficieView)("autoLayout",!1)("paginator",!0)("rows",5)("responsive",!0),h.Bb(4),h.nc("header",t.intestazioni.PSR_STRUTTURALI_EU),h.Bb(3),h.Pc(t.textTitleInner),h.Bb(2),h.mc("columns",t.colsPSRStr)("value",t.domandeStrutturaliView)("autoLayout",!1)("paginator",!0)("rows",5)("responsive",!0),h.Bb(4),h.nc("header",t.intestazioni.DOMANDA_UNICA),h.Bb(3),h.Pc(t.textTitleInner),h.Bb(2),h.mc("columns",t.colsSUPDU)("value",t.domandeUnicheView)("responsive",!0)("autoLayout",!1)("paginator",!0)("rows",5)("responsive",!0))},directives:[z.a,T.e,ht.a,ht.c,C.q,D.b,a.s,C.p,C.o,C.d,C.b,ii.c,v.a,ii.s,ii.v,P.a,ft.a],pipes:[a.f,a.g,S.d],encapsulation:2}),i})(),pathMatch:"full",data:{mybreadcrumb:"Domande Collegate"}}];let Ut=(()=>{class i{}return i.\u0275mod=h.Lb({type:i}),i.\u0275inj=h.Kb({factory:function(t){return new(t||i)},imports:[[n.i.forChild(xt)]]}),i})();var Lt=e("b7oP"),kt=e("R69K"),Vt=e("1IWC"),$t=e.n(Vt);Object(a.K)($t.a,"it");let Gt=(()=>{class i{}return i.\u0275mod=h.Lb({type:i}),i.\u0275inj=h.Kb({factory:function(t){return new(t||i)},imports:[[a.c,Ut,Lt.b,D.c,A.c,Lt.b,z.b,kt.a,ft.b,X.b]]}),i})()}}]);