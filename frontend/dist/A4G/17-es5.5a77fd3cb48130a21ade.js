function _toConsumableArray(i){return _arrayWithoutHoles(i)||_iterableToArray(i)||_unsupportedIterableToArray(i)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(i){if("undefined"!=typeof Symbol&&null!=i[Symbol.iterator]||null!=i["@@iterator"])return Array.from(i)}function _arrayWithoutHoles(i){if(Array.isArray(i))return _arrayLikeToArray(i)}function _createForOfIteratorHelper(i,e){var a="undefined"!=typeof Symbol&&i[Symbol.iterator]||i["@@iterator"];if(!a){if(Array.isArray(i)||(a=_unsupportedIterableToArray(i))||e&&i&&"number"==typeof i.length){a&&(i=a);var t=0,n=function(){};return{s:n,n:function(){return t>=i.length?{done:!0}:{done:!1,value:i[t++]}},e:function(i){throw i},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,r=!0,c=!1;return{s:function(){a=a.call(i)},n:function(){var i=a.next();return r=i.done,i},e:function(i){c=!0,o=i},f:function(){try{r||null==a.return||a.return()}finally{if(c)throw o}}}}function _unsupportedIterableToArray(i,e){if(i){if("string"==typeof i)return _arrayLikeToArray(i,e);var a=Object.prototype.toString.call(i).slice(8,-1);return"Object"===a&&i.constructor&&(a=i.constructor.name),"Map"===a||"Set"===a?Array.from(i):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(i,e):void 0}}function _arrayLikeToArray(i,e){(null==e||e>i.length)&&(e=i.length);for(var a=0,t=new Array(e);a<e;a++)t[a]=i[a];return t}function _classCallCheck(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,e){for(var a=0;a<e.length;a++){var t=e[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(i,t.key,t)}}function _createClass(i,e,a){return e&&_defineProperties(i.prototype,e),a&&_defineProperties(i,a),i}(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"1gqn":function(i,e){i.exports=function(i){return i&&"object"==typeof i&&"function"==typeof i.copy&&"function"==typeof i.fill&&"function"==typeof i.readUInt8}},MCLT:function(i,e,a){var t=Object.getOwnPropertyDescriptors||function(i){for(var e=Object.keys(i),a={},t=0;t<e.length;t++)a[e[t]]=Object.getOwnPropertyDescriptor(i,e[t]);return a},n=/%[sdj%]/g;e.format=function(i){if(!p(i)){for(var e=[],a=0;a<arguments.length;a++)e.push(c(arguments[a]));return e.join(" ")}a=1;for(var t=arguments,o=t.length,r=String(i).replace(n,(function(i){if("%%"===i)return"%";if(a>=o)return i;switch(i){case"%s":return String(t[a++]);case"%d":return Number(t[a++]);case"%j":try{return JSON.stringify(t[a++])}catch(e){return"[Circular]"}default:return i}})),s=t[a];a<o;s=t[++a])g(s)||!z(s)?r+=" "+s:r+=" "+c(s);return r},e.deprecate=function(i,a){if("undefined"!=typeof process&&!0===process.noDeprecation)return i;if("undefined"==typeof process)return function(){return e.deprecate(i,a).apply(this,arguments)};var t=!1;return function(){if(!t){if(process.throwDeprecation)throw new Error(a);process.traceDeprecation?console.trace(a):console.error(a),t=!0}return i.apply(this,arguments)}};var o,r={};function c(i,a){var t={seen:[],stylize:l};return arguments.length>=3&&(t.depth=arguments[2]),arguments.length>=4&&(t.colors=arguments[3]),h(a)?t.showHidden=a:a&&e._extend(t,a),v(t.showHidden)&&(t.showHidden=!1),v(t.depth)&&(t.depth=2),v(t.colors)&&(t.colors=!1),v(t.customInspect)&&(t.customInspect=!0),t.colors&&(t.stylize=s),d(t,i,t.depth)}function s(i,e){var a=c.styles[e];return a?"\x1b["+c.colors[a][0]+"m"+i+"\x1b["+c.colors[a][1]+"m":i}function l(i,e){return i}function d(i,a,t){if(i.customInspect&&a&&A(a.inspect)&&a.inspect!==e.inspect&&(!a.constructor||a.constructor.prototype!==a)){var n=a.inspect(t,i);return p(n)||(n=d(i,n,t)),n}var o=function(i,e){if(v(e))return i.stylize("undefined","undefined");if(p(e)){var a="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return i.stylize(a,"string")}return m(e)?i.stylize(""+e,"number"):h(e)?i.stylize(""+e,"boolean"):g(e)?i.stylize("null","null"):void 0}(i,a);if(o)return o;var r=Object.keys(a),c=function(i){var e={};return i.forEach((function(i,a){e[i]=!0})),e}(r);if(i.showHidden&&(r=Object.getOwnPropertyNames(a)),y(a)&&(r.indexOf("message")>=0||r.indexOf("description")>=0))return u(a);if(0===r.length){if(A(a))return i.stylize("[Function"+(a.name?": "+a.name:"")+"]","special");if(S(a))return i.stylize(RegExp.prototype.toString.call(a),"regexp");if(T(a))return i.stylize(Date.prototype.toString.call(a),"date");if(y(a))return u(a)}var s,l="",z=!1,C=["{","}"];return f(a)&&(z=!0,C=["[","]"]),A(a)&&(l=" [Function"+(a.name?": "+a.name:"")+"]"),S(a)&&(l=" "+RegExp.prototype.toString.call(a)),T(a)&&(l=" "+Date.prototype.toUTCString.call(a)),y(a)&&(l=" "+u(a)),0!==r.length||z&&0!=a.length?t<0?S(a)?i.stylize(RegExp.prototype.toString.call(a),"regexp"):i.stylize("[Object]","special"):(i.seen.push(a),s=z?function(i,e,a,t,n){for(var o=[],r=0,c=e.length;r<c;++r)P(e,String(r))?o.push(b(i,e,a,t,String(r),!0)):o.push("");return n.forEach((function(n){n.match(/^\d+$/)||o.push(b(i,e,a,t,n,!0))})),o}(i,a,t,c,r):r.map((function(e){return b(i,a,t,c,e,z)})),i.seen.pop(),function(i,e,a){return i.reduce((function(i,e){return e.indexOf("\n"),i+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?a[0]+(""===e?"":e+"\n ")+" "+i.join(",\n  ")+" "+a[1]:a[0]+e+" "+i.join(", ")+" "+a[1]}(s,l,C)):C[0]+l+C[1]}function u(i){return"["+Error.prototype.toString.call(i)+"]"}function b(i,e,a,t,n,o){var r,c,s;if((s=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?c=i.stylize(s.set?"[Getter/Setter]":"[Getter]","special"):s.set&&(c=i.stylize("[Setter]","special")),P(t,n)||(r="["+n+"]"),c||(i.seen.indexOf(s.value)<0?(c=g(a)?d(i,s.value,null):d(i,s.value,a-1)).indexOf("\n")>-1&&(c=o?c.split("\n").map((function(i){return"  "+i})).join("\n").substr(2):"\n"+c.split("\n").map((function(i){return"   "+i})).join("\n")):c=i.stylize("[Circular]","special")),v(r)){if(o&&n.match(/^\d+$/))return c;(r=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),r=i.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),r=i.stylize(r,"string"))}return r+": "+c}function f(i){return Array.isArray(i)}function h(i){return"boolean"==typeof i}function g(i){return null===i}function m(i){return"number"==typeof i}function p(i){return"string"==typeof i}function v(i){return void 0===i}function S(i){return z(i)&&"[object RegExp]"===C(i)}function z(i){return"object"==typeof i&&null!==i}function T(i){return z(i)&&"[object Date]"===C(i)}function y(i){return z(i)&&("[object Error]"===C(i)||i instanceof Error)}function A(i){return"function"==typeof i}function C(i){return Object.prototype.toString.call(i)}function I(i){return i<10?"0"+i.toString(10):i.toString(10)}e.debuglog=function(i){if(v(o)&&(o=process.env.NODE_DEBUG||""),i=i.toUpperCase(),!r[i])if(new RegExp("\\b"+i+"\\b","i").test(o)){var a=process.pid;r[i]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",i,a,t)}}else r[i]=function(){};return r[i]},e.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=f,e.isBoolean=h,e.isNull=g,e.isNullOrUndefined=function(i){return null==i},e.isNumber=m,e.isString=p,e.isSymbol=function(i){return"symbol"==typeof i},e.isUndefined=v,e.isRegExp=S,e.isObject=z,e.isDate=T,e.isError=y,e.isFunction=A,e.isPrimitive=function(i){return null===i||"boolean"==typeof i||"number"==typeof i||"string"==typeof i||"symbol"==typeof i||void 0===i},e.isBuffer=a("1gqn");var O=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function D(){var i=new Date,e=[I(i.getHours()),I(i.getMinutes()),I(i.getSeconds())].join(":");return[i.getDate(),O[i.getMonth()],e].join(" ")}function P(i,e){return Object.prototype.hasOwnProperty.call(i,e)}e.log=function(){console.log("%s - %s",D(),e.format.apply(e,arguments))},e.inherits=a("P7XM"),e._extend=function(i,e){if(!e||!z(e))return i;for(var a=Object.keys(e),t=a.length;t--;)i[a[t]]=e[a[t]];return i};var E="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function F(i,e){if(!i){var a=new Error("Promise was rejected with a falsy value");a.reason=i,i=a}return e(i)}e.promisify=function(i){if("function"!=typeof i)throw new TypeError('The "original" argument must be of type Function');if(E&&i[E]){var e;if("function"!=typeof(e=i[E]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,a,t=new Promise((function(i,t){e=i,a=t})),n=[],o=0;o<arguments.length;o++)n.push(arguments[o]);n.push((function(i,t){i?a(i):e(t)}));try{i.apply(this,n)}catch(r){a(r)}return t}return Object.setPrototypeOf(e,Object.getPrototypeOf(i)),E&&Object.defineProperty(e,E,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,t(i))},e.promisify.custom=E,e.callbackify=function(i){if("function"!=typeof i)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=[],a=0;a<arguments.length;a++)e.push(arguments[a]);var t=e.pop();if("function"!=typeof t)throw new TypeError("The last argument must be of type Function");var n=this,o=function(){return t.apply(n,arguments)};i.apply(this,e).then((function(i){process.nextTick(o,null,i)}),(function(i){process.nextTick(F,i,o)}))}return Object.setPrototypeOf(e,Object.getPrototypeOf(i)),Object.defineProperties(e,t(i)),e}},P7XM:function(i,e){i.exports="function"==typeof Object.create?function(i,e){i.super_=e,i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}})}:function(i,e){i.super_=e;var a=function(){};a.prototype=e.prototype,i.prototype=new a,i.prototype.constructor=i}},u8hb:function(i,e,a){"use strict";a.r(e),a.d(e,"AntimafiaModule",(function(){return Xe}));var t,n,o=a("ofXK"),r=a("tyNb"),c=a("4IZF"),s=a("fXoL"),l=((t=function(){function i(){_classCallCheck(this,i),this.dichiarazioneAntimafia=new c.a}return _createClass(i,[{key:"setDichiarazioneAntimafia",value:function(i){this.dichiarazioneAntimafia=i}},{key:"setAzienda",value:function(i){this.dichiarazioneAntimafia.azienda=i}},{key:"getDichiarazioneAntimafia",value:function(){return this.dichiarazioneAntimafia}},{key:"getEnabled",value:function(){return this.enabled}},{key:"getTitle",value:function(){return this.textTitle}}]),i}()).\u0275fac=function(i){return new(i||t)},t.\u0275prov=s.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t),d=a("69Tm"),u=((n=function(){function i(){_classCallCheck(this,i),this.stepIndex=0}return _createClass(i,[{key:"next",value:function(){this.stepIndex++}},{key:"previous",value:function(){this.stepIndex--}}]),i}()).\u0275fac=function(i){return new(i||n)},n.\u0275prov=s.Jb({token:n,factory:n.\u0275fac,providedIn:"root"}),n),b=a("1v+U"),f=a("wH++"),h=a("ggqT"),g=a("Upfa"),m=a("Tn7N"),p=a("5gIc"),v=a("eIep"),S=a("RtSl"),z=a("arS9"),T=a("A1Yd"),y=a("D0mR");function A(i,e){if(1&i){var a=s.Ub();s.Tb(0,"button",13),s.bc("click",(function(){return s.Ec(a),s.fc().indietro()})),s.Sb()}}function C(i,e){if(1&i){var a=s.Ub();s.Tb(0,"button",14),s.bc("debounceClick",(function(){return s.Ec(a),s.fc().aggiorna()})),s.Sb()}}function I(i,e){if(1&i){var a=s.Ub();s.Tb(0,"button",15),s.bc("debounceClick",(function(){return s.Ec(a),s.fc().cancella()})),s.Sb()}}function O(i,e){if(1&i){var a=s.Ub();s.Tb(0,"button",16),s.bc("debounceClick",(function(){return s.Ec(a),s.fc().procedi()})),s.Sb()}if(2&i){var t=s.fc();s.mc("disabled",!t.isProtocollaReady)}}function D(i,e){if(1&i){var a=s.Ub();s.Tb(0,"button",17),s.bc("debounceClick",(function(){return s.Ec(a),s.fc().procedi()})),s.Sb()}}function P(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",18),s.Ob(1,"i",19),s.Tb(2,"h3"),s.Oc(3),s.Sb(),s.Tb(4,"p"),s.Oc(5),s.Sb(),s.Sb(),s.Tb(6,"div",20),s.Tb(7,"div",1),s.Tb(8,"button",21),s.bc("click",(function(){return s.Ec(a),s.fc().onConfirmAggiornaDichiarazione()})),s.Sb(),s.Sb(),s.Tb(9,"div",1),s.Tb(10,"button",22),s.bc("click",(function(){return s.Ec(a),s.fc().onRejectAggiornaDichiarazione()})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit;s.Bb(3),s.Pc(t.summary),s.Bb(2),s.Pc(t.detail)}}function E(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",18),s.Ob(1,"i",19),s.Tb(2,"h3"),s.Oc(3),s.Sb(),s.Tb(4,"p"),s.Oc(5),s.Sb(),s.Sb(),s.Tb(6,"div",20),s.Tb(7,"div",1),s.Tb(8,"button",21),s.bc("click",(function(){return s.Ec(a),s.fc().onConfirmCancellaDichiarazione()})),s.Sb(),s.Sb(),s.Tb(9,"div",1),s.Tb(10,"button",22),s.bc("click",(function(){return s.Ec(a),s.fc().onRejectCancellaDichiarazione()})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit;s.Bb(3),s.Pc(t.summary),s.Bb(2),s.Pc(t.detail)}}var F,R,k,B,N=((F=function(){function i(e,a,t,n,o,r,c){_classCallCheck(this,i),this.router=e,this.route=a,this.stepEvent=t,this.messages=n,this.dichiarazioneAntimafiaService=o,this.antimafiaService=r,this.loader=c,this.next=new s.n}return _createClass(i,[{key:"ngOnInit",value:function(){this.loader.setTimeout(48e4)}},{key:"procedi",value:function(){this.next.emit(!0)}},{key:"goNext",value:function(){this.stepEvent.next()}},{key:"indietro",value:function(){this.stepEvent.previous()}},{key:"aggiorna",value:function(){this.messages.add({key:"aggiornaDichiarazione",sticky:!0,severity:"warn",summary:"Tutti i dettagli della dichiarazione saranno eliminati",detail:"Sei sicuro di voler continuare?"})}},{key:"cancella",value:function(){this.messages.add({key:"cancellaDichiarazione",sticky:!0,severity:"warn",summary:"Tutti i dettagli della dichiarazione saranno eliminati",detail:"Sei sicuro di voler continuare?"})}},{key:"onConfirmAggiornaDichiarazione",value:function(){var i=this,e=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia();this.antimafiaService.eliminaDichiarazioneAntimafia(e.id.toString()).pipe(Object(v.a)((function(a){var t=new c.a,n=new h.b;n.richiedente=new h.c,n.richiedente.codiceFiscale=e.datiDichiarazione.richiedente.codiceFiscale,t.datiDichiarazione=n;var o=new g.a;return o.cuaa=e.azienda.cuaa,t.azienda=o,i.antimafiaService.creaDichiarazioneAntimafia(t)}))).subscribe((function(e){console.log("Dichiarazione cancellata: "+e),i.messages.clear("aggiornaDichiarazione"),i.router.navigate(["./"+e],{relativeTo:i.route.parent}).then((function(){return location.reload()}))}),(function(e){console.log("Error",e),m.a.handleError(i.messages,e,m.a.SERVIZIO_NON_DISPONIBILE)}))}},{key:"onConfirmCancellaDichiarazione",value:function(){var i=this,e=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia();this.antimafiaService.eliminaDichiarazioneAntimafia(e.id.toString()).subscribe((function(e){console.log("Dichiarazione cancellata: "+e),i.router.navigate(["./"],{relativeTo:i.route.parent.parent})}),(function(e){console.log("Error",e),m.a.handleError(i.messages,e,m.a.SERVIZIO_NON_DISPONIBILE)}))}},{key:"onRejectAggiornaDichiarazione",value:function(){this.messages.clear("aggiornaDichiarazione")}},{key:"onRejectCancellaDichiarazione",value:function(){this.messages.clear("cancellaDichiarazione")}},{key:"ngOnDestroy",value:function(){this.loader.resetTimeout()}}]),i}()).\u0275fac=function(i){return new(i||F)(s.Nb(r.e),s.Nb(r.a),s.Nb(u),s.Nb(S.d),s.Nb(l),s.Nb(f.a),s.Nb(p.a))},F.\u0275cmp=s.Hb({type:F,selectors:[["app-step-action"]],inputs:{isProtocollaReady:"isProtocollaReady"},outputs:{next:"next"},decls:16,vars:9,consts:[[1,"ui-g"],[1,"ui-g-6"],[1,"back-button"],["pButton","","label","INDIETRO","class","blue-grey-btn","icon","pi pi-chevron-circle-left","iconPos","left",3,"click",4,"ngIf"],[1,"ui-g-3"],["appDebounceClick","","pButton","","label","AGGIORNA","class","orange-btn","icon","ui-icon-edit",3,"debounceClick",4,"ngIf"],["appDebounceClick","","pButton","","label","CANCELLA","class","red-btn","icon","ui-icon-delete-forever",3,"debounceClick",4,"ngIf"],["appDebounceClick","","pButton","","label","PROTOCOLLA DOMANDA","icon","pi pi-chevron-circle-right","iconPos","right","style","float: right;",3,"disabled","debounceClick",4,"ngIf"],[1,"next-button"],["appDebounceClick","","pButton","","label","PROCEDI","icon","pi pi-chevron-circle-right","iconPos","right",3,"debounceClick",4,"ngIf"],["position","center","key","aggiornaDichiarazione",3,"modal","baseZIndex","onClose"],["pTemplate","message"],["position","center","key","cancellaDichiarazione",3,"modal","baseZIndex","onClose"],["pButton","","label","INDIETRO","icon","pi pi-chevron-circle-left","iconPos","left",1,"blue-grey-btn",3,"click"],["appDebounceClick","","pButton","","label","AGGIORNA","icon","ui-icon-edit",1,"orange-btn",3,"debounceClick"],["appDebounceClick","","pButton","","label","CANCELLA","icon","ui-icon-delete-forever",1,"red-btn",3,"debounceClick"],["appDebounceClick","","pButton","","label","PROTOCOLLA DOMANDA","icon","pi pi-chevron-circle-right","iconPos","right",2,"float","right",3,"disabled","debounceClick"],["appDebounceClick","","pButton","","label","PROCEDI","icon","pi pi-chevron-circle-right","iconPos","right",3,"debounceClick"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){1&i&&(s.Tb(0,"div",0),s.Tb(1,"div",1),s.Tb(2,"div",2),s.Mc(3,A,1,0,"button",3),s.Tb(4,"div",4),s.Mc(5,C,1,0,"button",5),s.Sb(),s.Tb(6,"div",4),s.Mc(7,I,1,0,"button",6),s.Sb(),s.Sb(),s.Sb(),s.Tb(8,"div",1),s.Mc(9,O,1,1,"button",7),s.Tb(10,"div",8),s.Mc(11,D,1,0,"button",9),s.Sb(),s.Sb(),s.Sb(),s.Tb(12,"p-toast",10),s.bc("onClose",(function(){return e.onRejectAggiornaDichiarazione()})),s.Mc(13,P,11,2,"ng-template",11),s.Sb(),s.Tb(14,"p-toast",12),s.bc("onClose",(function(){return e.onRejectCancellaDichiarazione()})),s.Mc(15,E,11,2,"ng-template",11),s.Sb()),2&i&&(s.Bb(3),s.mc("ngIf",e.stepEvent.stepIndex>0),s.Bb(2),s.mc("ngIf",0==e.stepEvent.stepIndex),s.Bb(2),s.mc("ngIf",0==e.stepEvent.stepIndex),s.Bb(2),s.mc("ngIf",6==e.stepEvent.stepIndex),s.Bb(2),s.mc("ngIf",e.stepEvent.stepIndex<6),s.Bb(1),s.mc("modal",!0)("baseZIndex",5e3),s.Bb(2),s.mc("modal",!0)("baseZIndex",5e3))},directives:[o.t,z.a,S.e,T.b,y.a],styles:[""]}),F),_=function(i){return i[i.OK=0]="OK",i[i.ERROR=1]="ERROR",i[i.WARNING=2]="WARNING",i}({}),M=function(i){return i[i.success=0]="success",i[i.error=1]="error",i[i.warn=2]="warn",i[i.info=3]="info",i}({}),w=function(){var i=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"getToast",value:function(e,a,t){return{key:e,severity:M[a],summary:"Messaggio "+M[a],detail:t,life:i.TOAST_LIFE}}}]),i}();return i.TOAST_LIFE=3e3,i.OPERAZIONE_OK="Operazione terminata con successo",i.ERRORE_DATI="Dati compilati non validi",i.CARICAMENTO="Caricamento in corso",i.ERRORE_RESPONSABILITA="Dati Responsabilit\xe0 Mancanti",i.ERRORE_PROFILO="Dati Profilo Mancanti",i.ERRORE_CARICAMENTO="Errore Caricamento dei file",i.RICHIEDENTE_ERR="nessun richiedente trovato",i.PROCEDIMENTI_ERR="Selezionare almeno un procedimento",i.IMPRESA_ERR="nessuna Impresa trovata",i.SOGGETTI_ERR="Nessun Soggetto Impresa",i.SOGGETTI_DT="Dichiarazione Direttore Tecnico Assente",i.FAMILIARI_CF_ERR="Codice Fiscale Non Conforme",i.FAMILIARI_ALLEGATI="Attenzione - allegato dichiarazione familiari conviventi mancante",i.MAX_SIZE_FILE=15,i.FILE_EXTENSION_ACCEPTED=".pdf,.p7m",i}(),x=((R=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"validaProcedimenti",value:function(i){var e={esito:_.OK};return i&&0!==i.length||(e.esito=_.ERROR,e.messaggio=w.PROCEDIMENTI_ERR),e}},{key:"validaRichiedente",value:function(i){var e={esito:_.OK};return null==i?(e.esito=_.ERROR,e.messaggio=w.RICHIEDENTE_ERR,e):e}},{key:"validaImpresa",value:function(i){var e={esito:_.OK};return null==i?(e.esito=_.ERROR,e.messaggio=w.IMPRESA_ERR,e):e}},{key:"validaSoggettiCarica",value:function(i){var e={esito:_.OK},a=i.datiDichiarazione.dettaglioImpresa;if(a.soggettiImpresa&&0!==a.soggettiImpresa.length||(e.esito=_.ERROR,e.messaggio=w.SOGGETTI_ERR),"DI"===a.formaGiuridicaCodice){var t=a.soggettiImpresa.some((function(i){return i.carica.some((function(i){return"DT"===i.codice}))})),n=i.assenzaDt;if(!t&&!n)return e.esito=_.ERROR,e.messaggio=m.a.DT_ASSENTE,e}return e}},{key:"validaAziendeCollegate",value:function(i){return{esito:_.OK}}},{key:"validaFamiliariConviventiCheckDichiarazione",value:function(i,e){var a={esito:_.OK};if(null===i||0===i.length)return a.esito=_.ERROR,a.messaggio=w.SOGGETTI_ERR,a;var t=i.filter((function(i){return i.carica.some((function(i){return!0===i.selezionato}))}));return 0===t.length?(a.esito=_.ERROR,a.messaggio=m.a.FAMILIARI_DIC,a):(t.forEach((function(i){if((void 0===i.familiariConviventi||null==i.familiariConviventi||0===i.familiariConviventi.length)&&!i.carica.some((function(i){return!0===i.dichiarazione})))return a.esito=_.ERROR,a.messaggio=e?m.a.FAMILIARI_ERR_SPUNTA:m.a.FAMILIARI_ERR(i.codiceFiscale),a})),a)}},{key:"validaFamiliariConviventiInserimentoCF",value:function(i){var e={esito:_.OK};if(null===i||0===i.length)return e.esito=_.ERROR,e.messaggio=w.SOGGETTI_ERR,e;var a=i.find((function(i){return!!i.familiariConviventi&&i.familiariConviventi.some((function(i){return null==i.codiceFiscale}))}));return a?(e.esito=_.ERROR,e.messaggio=m.a.FAMILIARI_CF_ASSENTE(a.codiceFiscale),e):e}},{key:"validaFamiliariConviventiGradoDiParentela",value:function(i){var e={esito:_.OK};if(null===i||0===i.length)return e.esito=_.ERROR,e.messaggio=w.SOGGETTI_ERR,e;var a=i.find((function(i){return!!i.familiariConviventi&&i.familiariConviventi.some((function(i){return null==i.gradoParentela}))}));return a?(e.esito=_.ERROR,e.messaggio=m.a.FAMILIARI_PARENT(a.codiceFiscale),e):e}},{key:"validaFamiliariConviventiMaggiorenni",value:function(i,e){var a={esito:_.OK};if(null==i)return a.esito=_.ERROR,a;var t=new Date;return Date.parse(t.toDateString())-Number(i)<5679936e5?(a.esito=_.ERROR,a.messaggio=m.a.FAMILIARI_MAGGIO(e),a):a}},{key:"validaFamiliariConviventiAllegati",value:function(i){var e={esito:_.OK};return null===i||0===i.length?(e.esito=_.ERROR,e.messaggio=w.SOGGETTI_ERR,e):(i.filter((function(i){return i.carica.some((function(i){return!0===i.selezionato}))})).forEach((function(i){i.carica.filter((function(i){return i.selezionato})).forEach((function(a){if(!a.href)return e.esito=_.ERROR,e.messaggio=m.a.ALLEGATO_MANCANTE(i.codiceFiscale),e}))})),e)}},{key:"validaVerificaDichiarazioneAllegata",value:function(i){var e={esito:_.OK};return null==i?(e.esito=_.ERROR,e.messaggio=m.a.DICHIARAZIONE_MANCANTE,e):e}},{key:"validaAllegatoSize",value:function(i){var e={esito:_.OK};return m.a.UPLOAD_FILE_MAX_SIZE_FILE<0||Math.round(i.size/1024e3*100)/100>m.a.UPLOAD_FILE_MAX_SIZE_FILE&&(e.esito=_.ERROR,e.messaggio=m.a.FILE_MAXSIZE(m.a.UPLOAD_FILE_MAX_SIZE_FILE)),e}},{key:"validaAllegatoType",value:function(i,e){var a={esito:_.OK};if(void 0!==i.name)return!e||i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDFP7M)||i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDF)?(e||i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDF)||(a.esito=_.ERROR,a.messaggio=m.a.FILE_TYPE(m.a.UPLOAD_FILE_TYPE_PDF)),a):(a.esito=_.ERROR,a.messaggio=m.a.FILE_TYPE(m.a.UPLOAD_FILE_TYPE_PDF+" oppure "+m.a.UPLOAD_FILE_TYPE_PDFP7M),a)}},{key:"validaVerificaInformativaPrivacy",value:function(i,e){var a={esito:_.OK};return!i||i.length>1?(a.esito=_.ERROR,a.messaggio=m.a.ERRORE_GENERICO):0!=i.length&&i[0].nrProtocolloPrivacyGenerale||(a.esito=_.ERROR,a.messaggio=m.a.INFORMATIVA_PRIVACY_ASSENTE(e)),a}}]),i}()).\u0275fac=function(i){return new(i||R)},R.\u0275prov=s.Jb({token:R,factory:R.\u0275fac,providedIn:"root"}),R),U=a("3Pt+"),L=a("R5y+"),j=a("sYmb"),G=function(){return{marginTop:"70px"}},K=((k=function(){function i(e,a,t,n){_classCallCheck(this,i),this.validator=e,this.messageService=a,this.dichiarazioneAntimafiaService=t,this.antimafiaService=n}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.dichirazioneAntimafia=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia(),this.antimafiaService.recuperaProcedimenti(this.dichirazioneAntimafia.id).subscribe((function(e){i.dichirazioneAntimafia.procedimenti=e}))}},{key:"conferma",value:function(i){console.log("userForm.dirty: ",i.dirty);var e=this.validator.validaProcedimenti(this.dichirazioneAntimafia.procedimenti);e.esito!==_.ERROR?(i.dirty&&this.antimafiaService.inserisciProcedimenti(this.dichirazioneAntimafia.id,this.dichirazioneAntimafia.procedimenti).subscribe(),this.stepComponent.goNext()):this.messageService.add(m.a.getToast("errorAssenzaProcedimento",m.b.error,e.messaggio))}}]),i}()).\u0275fac=function(i){return new(i||k)(s.Nb(x),s.Nb(S.d),s.Nb(l),s.Nb(f.a))},k.\u0275cmp=s.Hb({type:k,selectors:[["app-procedimenti"]],viewQuery:function(i,e){var a;1&i&&s.Jc(N,!0),2&i&&s.Ac(a=s.cc())&&(e.stepComponent=a.first)},decls:20,vars:19,consts:[[1,"boxgrey"],[1,"ui-g"],["userForm","ngForm"],[1,"ui-g-12"],["name","groupProcedimenti","value","DU",3,"label","ngModel","ngModelChange"],["name","groupProcedimenti","value","PSR_SUPERFICIE",3,"label","ngModel","ngModelChange"],["name","groupProcedimenti","value","PSR_INVESTIMENTO",3,"label","ngModel","ngModelChange"],["name","groupProcedimenti","value","PAI",3,"label","ngModel","ngModelChange"],[3,"next"],["key","errorAssenzaProcedimento"]],template:function(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",0),s.Tb(1,"h3"),s.Oc(2," Procedimenti "),s.Sb(),s.Tb(3,"div",1),s.Tb(4,"form",null,2),s.Tb(6,"div",3),s.Tb(7,"p-checkbox",4),s.bc("ngModelChange",(function(i){return e.dichirazioneAntimafia.procedimenti=i})),s.gc(8,"translate"),s.Sb(),s.Sb(),s.Tb(9,"div",3),s.Tb(10,"p-checkbox",5),s.bc("ngModelChange",(function(i){return e.dichirazioneAntimafia.procedimenti=i})),s.gc(11,"translate"),s.Sb(),s.Sb(),s.Tb(12,"div",3),s.Tb(13,"p-checkbox",6),s.bc("ngModelChange",(function(i){return e.dichirazioneAntimafia.procedimenti=i})),s.gc(14,"translate"),s.Sb(),s.Sb(),s.Tb(15,"div",3),s.Tb(16,"p-checkbox",7),s.bc("ngModelChange",(function(i){return e.dichirazioneAntimafia.procedimenti=i})),s.gc(17,"translate"),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Tb(18,"app-step-action",8),s.bc("next",(function(){s.Ec(a);var i=s.Bc(5);return e.conferma(i)})),s.Sb(),s.Ob(19,"p-toast",9)}2&i&&(s.Bb(7),s.nc("label",s.hc(8,10,"DICH_AMF.DU")),s.mc("ngModel",e.dichirazioneAntimafia.procedimenti),s.Bb(3),s.nc("label",s.hc(11,12,"DICH_AMF.PSR_SUPERFICIE")),s.mc("ngModel",e.dichirazioneAntimafia.procedimenti),s.Bb(3),s.nc("label",s.hc(14,14,"DICH_AMF.PSR_INVESTIMENTO")),s.mc("ngModel",e.dichirazioneAntimafia.procedimenti),s.Bb(3),s.nc("label",s.hc(17,16,"DICH_AMF.PAI")),s.mc("ngModel",e.dichirazioneAntimafia.procedimenti),s.Bb(3),s.Kc(s.rc(18,G)))},directives:[U.I,U.t,U.u,L.a,U.s,U.v,N,z.a],pipes:[j.d],encapsulation:2}),k),V=function i(e,a){_classCallCheck(this,i),this.mkey=e,this.mvalue=a},Z=a("MCLT"),Q=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"setInizioCarica",value:function(i,e){i.forEach((function(i){return i.carica.forEach((function(i){return i.dataInizio?i.dataInizio:i.dataInizio=e}))}))}},{key:"isImpresaDittaIndividuale",value:function(i){return"DI"===i}},{key:"setAllNullValuesToND",value:function(i){var e=this;Object.keys(i).forEach((function(a){Object(Z.isObject)(i[a])?e.setAllNullValuesToND(i[a]):i[a]||(i[a]=d.a.nd)}))}},{key:"isObject",value:function(i){return console.log("is object : "+i),"object"==typeof i}},{key:"soggettiAppiattito",value:function(i){var e=i.map((function(i){return Object.assign({},i)})),a=[];return e.forEach((function(i){i.carica.forEach((function(e){var t=Object.assign({},i);t.carica=[e],a.push(t)}))})),a}}]),i}(),H=((B=function(){function i(e,a){_classCallCheck(this,i),this.dichiarazioneAntimafiaService=e,this.validator=a,this.labels=d.a,this.values=[new V("1","RLR")],this.select=new s.n}return _createClass(i,[{key:"ngOnInit",value:function(){this.richiedente=this.getDati(this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia()),this.textTitle=d.a.datiAcquisiti,Q.setAllNullValuesToND(this.richiedente)}},{key:"selectItem",value:function(i){this.select.emit(i)}},{key:"getDati",value:function(i){var e;return null!=i&&(console.log("dichiarazioneDettagli 1 "),e=i.datiDichiarazione),e.richiedente}},{key:"conferma",value:function(){var i=this.validator.validaRichiedente(this.richiedente);i.esito===_.OK?(console.log("richiedente next"),this.stepComponent.goNext()):alert(i.messaggio)}}]),i}()).\u0275fac=function(i){return new(i||B)(s.Nb(l),s.Nb(x))},B.\u0275cmp=s.Hb({type:B,selectors:[["app-richiedente"]],viewQuery:function(i,e){var a;1&i&&s.Jc(N,!0),2&i&&s.Ac(a=s.cc())&&(e.stepComponent=a.first)},outputs:{select:"select"},decls:65,vars:25,consts:[[1,"boxgrey"],[1,"ui-g"],[1,"ui-g-3","box-padded"],[3,"next"]],template:function(i,e){1&i&&(s.Tb(0,"div",0),s.Tb(1,"h3"),s.Oc(2),s.Sb(),s.Tb(3,"div",1),s.Tb(4,"div",2),s.Tb(5,"strong"),s.Oc(6),s.Sb(),s.Sb(),s.Tb(7,"div",2),s.Oc(8),s.Sb(),s.Tb(9,"div",2),s.Tb(10,"strong"),s.Oc(11),s.Sb(),s.Sb(),s.Tb(12,"div",2),s.Oc(13),s.Sb(),s.Tb(14,"div",2),s.Tb(15,"strong"),s.Oc(16),s.Sb(),s.Sb(),s.Tb(17,"div",2),s.Oc(18),s.Sb(),s.Tb(19,"div",2),s.Tb(20,"strong"),s.Oc(21),s.Sb(),s.Sb(),s.Tb(22,"div",2),s.Oc(23),s.Sb(),s.Tb(24,"div",2),s.Tb(25,"strong"),s.Oc(26),s.Sb(),s.Sb(),s.Tb(27,"div",2),s.Oc(28),s.Sb(),s.Tb(29,"div",2),s.Tb(30,"strong"),s.Oc(31),s.Sb(),s.Sb(),s.Tb(32,"div",2),s.Oc(33),s.Sb(),s.Tb(34,"div",2),s.Tb(35,"strong"),s.Oc(36),s.Sb(),s.Sb(),s.Tb(37,"div",2),s.Oc(38),s.Sb(),s.Tb(39,"div",2),s.Tb(40,"strong"),s.Oc(41),s.Sb(),s.Sb(),s.Tb(42,"div",2),s.Oc(43),s.Sb(),s.Tb(44,"div",2),s.Tb(45,"strong"),s.Oc(46),s.Sb(),s.Sb(),s.Tb(47,"div",2),s.Oc(48),s.Sb(),s.Tb(49,"div",2),s.Tb(50,"strong"),s.Oc(51),s.Sb(),s.Sb(),s.Tb(52,"div",2),s.Oc(53),s.Sb(),s.Tb(54,"div",2),s.Tb(55,"strong"),s.Oc(56),s.Sb(),s.Sb(),s.Tb(57,"div",2),s.Oc(58),s.Sb(),s.Tb(59,"div",2),s.Tb(60,"strong"),s.Oc(61),s.Sb(),s.Sb(),s.Tb(62,"div",2),s.Oc(63),s.Sb(),s.Sb(),s.Sb(),s.Tb(64,"app-step-action",3),s.bc("next",(function(){return e.conferma()})),s.Sb()),2&i&&(s.Bb(2),s.Qc(" ",e.textTitle," "),s.Bb(4),s.Pc(e.labels.cognome),s.Bb(2),s.Qc(" ",e.richiedente.cognome," "),s.Bb(3),s.Pc(e.labels.sesso),s.Bb(2),s.Qc(" ",e.richiedente.sesso," "),s.Bb(3),s.Pc(e.labels.nome),s.Bb(2),s.Qc(" ",e.richiedente.nome," "),s.Bb(3),s.Pc(e.labels.residenza),s.Bb(2),s.Qc(" ",e.richiedente.residenza.indirizzo," "),s.Bb(3),s.Pc(e.labels.codiceFiscale),s.Bb(2),s.Qc(" ",e.richiedente.codiceFiscale," "),s.Bb(3),s.Pc(e.labels.residenzaComune),s.Bb(2),s.Qc(" ",e.richiedente.residenza.comune," "),s.Bb(3),s.Pc(e.labels.dataNascita),s.Bb(2),s.Qc(" ",e.richiedente.dataNascita," "),s.Bb(3),s.Pc(e.labels.residenzaCAP),s.Bb(2),s.Qc(" ",e.richiedente.residenza.CAP," "),s.Bb(3),s.Pc(e.labels.comuneNascita),s.Bb(2),s.Qc(" ",e.richiedente.comuneNascita," "),s.Bb(3),s.Pc(e.labels.residenzaProvincia),s.Bb(2),s.Qc(" ",e.richiedente.residenza.provincia," "),s.Bb(3),s.Pc(e.labels.provinciaNascita),s.Bb(2),s.Qc(" ",e.richiedente.provinciaNascita," "),s.Bb(3),s.Pc(e.labels.carica),s.Bb(2),s.Qc(" ",e.richiedente.carica," "))},directives:[N],styles:[""]}),B),$=a("KDHY"),W=a("xpYo");function J(i,e){if(1&i&&(s.Tb(0,"div",6),s.Tb(1,"p-fieldset",7),s.Tb(2,"p-inplace",8),s.Tb(3,"span",9),s.Ob(4,"span",10),s.Tb(5,"span",11),s.Oc(6),s.gc(7,"slice"),s.Sb(),s.Sb(),s.Tb(8,"span",12),s.Oc(9),s.Sb(),s.Sb(),s.Sb(),s.Sb()),2&i){var a=s.fc();s.Bb(1),s.nc("legend",a.labels.oggettoSociale),s.Bb(1),s.mc("closable",!0),s.Bb(4),s.Qc(" ",s.jc(7,4,a.dettaglioImpresa.oggettoSociale,0,350)," ... ... ... "),s.Bb(3),s.Qc(" ",a.dettaglioImpresa.oggettoSociale?a.dettaglioImpresa.oggettoSociale:a.labels.nd," ")}}function Y(i,e){if(1&i&&(s.Tb(0,"div",1),s.Tb(1,"div",2),s.Tb(2,"strong"),s.Oc(3),s.Sb(),s.Sb(),s.Tb(4,"div",2),s.Oc(5),s.Sb(),s.Sb()),2&i){var a=s.fc();s.Bb(3),s.Pc(a.labels.oggettoSociale),s.Bb(2),s.Qc(" ",a.labels.nd," ")}}var q,X=((q=function(){function i(e,a){_classCallCheck(this,i),this.dichiarazioneAntimafiaService=e,this.validator=a,this.labels=d.a}return _createClass(i,[{key:"ngOnInit",value:function(){this.dettaglioImpresa=this.getAnagraficaImpresa(this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia()),this.textTitle=d.a.datiAcquisiti}},{key:"getAnagraficaImpresa",value:function(i){return null!=i?i.datiDichiarazione.dettaglioImpresa:null}},{key:"conferma",value:function(){var i=this.validator.validaImpresa(this.dettaglioImpresa);i.esito===_.OK?(console.log("impresa next"),this.stepComponent.goNext()):alert(i.messaggio)}}]),i}()).\u0275fac=function(i){return new(i||q)(s.Nb(l),s.Nb(x))},q.\u0275cmp=s.Hb({type:q,selectors:[["app-impresa"]],viewQuery:function(i,e){var a;1&i&&s.Jc(N,!0),2&i&&s.Ac(a=s.cc())&&(e.stepComponent=a.first)},decls:67,vars:27,consts:[[1,"boxgrey"],[1,"ui-g"],[1,"ui-g-3","box-padded"],["class","ui-g-12",4,"ngIf"],["class","ui-g",4,"ngIf"],[3,"next"],[1,"ui-g-12"],[3,"legend"],[3,"closable"],["pInplaceDisplay",""],[1,"fa","fa-table"],[2,"margin-left","8px"],["pInplaceContent",""]],template:function(i,e){1&i&&(s.Tb(0,"div",0),s.Tb(1,"h3"),s.Oc(2),s.Sb(),s.Tb(3,"div",1),s.Tb(4,"div",2),s.Tb(5,"strong"),s.Oc(6),s.Sb(),s.Sb(),s.Tb(7,"div",2),s.Oc(8),s.Sb(),s.Tb(9,"div",2),s.Tb(10,"strong"),s.Oc(11),s.Sb(),s.Sb(),s.Tb(12,"div",2),s.Oc(13),s.Sb(),s.Tb(14,"div",2),s.Tb(15,"strong"),s.Oc(16),s.Sb(),s.Sb(),s.Tb(17,"div",2),s.Oc(18),s.Sb(),s.Tb(19,"div",2),s.Tb(20,"strong"),s.Oc(21),s.Sb(),s.Sb(),s.Tb(22,"div",2),s.Oc(23),s.Sb(),s.Tb(24,"div",2),s.Tb(25,"strong"),s.Oc(26),s.Sb(),s.Sb(),s.Tb(27,"div",2),s.Oc(28),s.Sb(),s.Tb(29,"div",2),s.Tb(30,"strong"),s.Oc(31),s.Sb(),s.Sb(),s.Tb(32,"div",2),s.Oc(33),s.Sb(),s.Tb(34,"div",2),s.Tb(35,"strong"),s.Oc(36),s.Sb(),s.Sb(),s.Tb(37,"div",2),s.Oc(38),s.Sb(),s.Tb(39,"div",2),s.Tb(40,"strong"),s.Oc(41),s.Sb(),s.Sb(),s.Tb(42,"div",2),s.Oc(43),s.Sb(),s.Tb(44,"div",2),s.Tb(45,"strong"),s.Oc(46),s.Sb(),s.Sb(),s.Tb(47,"div",2),s.Oc(48),s.Sb(),s.Tb(49,"div",2),s.Tb(50,"strong"),s.Oc(51),s.Sb(),s.Sb(),s.Tb(52,"div",2),s.Oc(53),s.Sb(),s.Tb(54,"div",2),s.Tb(55,"strong"),s.Oc(56),s.Sb(),s.Sb(),s.Tb(57,"div",2),s.Oc(58),s.Sb(),s.Tb(59,"div",2),s.Tb(60,"strong"),s.Oc(61),s.Sb(),s.Sb(),s.Tb(62,"div",2),s.Oc(63),s.Sb(),s.Mc(64,J,10,8,"div",3),s.Sb(),s.Mc(65,Y,6,2,"div",4),s.Sb(),s.Tb(66,"app-step-action",5),s.bc("next",(function(){return e.conferma()})),s.Sb()),2&i&&(s.Bb(2),s.Qc(" ",e.textTitle," "),s.Bb(4),s.Pc(e.labels.descrizioneImpresa),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.denominazione?e.dettaglioImpresa.denominazione:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.CCIAAnumeroIscrizione),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.estremiCCIAA.numeroIscrizione?e.dettaglioImpresa.estremiCCIAA.numeroIscrizione:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.provinciaImpresa),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.estremiCCIAA.sede?e.dettaglioImpresa.estremiCCIAA.sede:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.CCIAAdataIscrizione),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.estremiCCIAA.dataIscrizione?e.dettaglioImpresa.estremiCCIAA.dataIscrizione:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.sedeLegale),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.sedeLegale?e.dettaglioImpresa.sedeLegale:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.formaGiuridica),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.dettaglioPersonaGiuridica.formaGiuridica?e.dettaglioImpresa.dettaglioPersonaGiuridica.formaGiuridica:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.estremiCostituzione),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.estremiCCIAA.dataIscrizione?e.dettaglioImpresa.estremiCCIAA.dataIscrizione:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.capitaleSociale),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.dettaglioPersonaGiuridica.capitaleSociale?e.dettaglioImpresa.dettaglioPersonaGiuridica.capitaleSociale:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.durataSocieta),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.dettaglioPersonaGiuridica.durata?e.dettaglioImpresa.dettaglioPersonaGiuridica.durata:e.labels.illimitata," "),s.Bb(3),s.Pc(e.labels.codiceFiscale),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.codiceFiscale?e.dettaglioImpresa.codiceFiscale:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.partitaIva),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.partitaIva?e.dettaglioImpresa.partitaIva:e.labels.nd," "),s.Bb(3),s.Pc(e.labels.indirizzoPEC),s.Bb(2),s.Qc(" ",e.dettaglioImpresa.indirizzoPEC?e.dettaglioImpresa.indirizzoPEC:e.labels.nd," "),s.Bb(1),s.mc("ngIf",e.dettaglioImpresa.oggettoSociale),s.Bb(1),s.mc("ngIf",!e.dettaglioImpresa.oggettoSociale))},directives:[o.t,N,$.a,W.a],pipes:[o.E],styles:["body .ui-fieldset .ui-fieldset-legend .ui-fieldset-legend-text{color:#000}"],encapsulation:2}),q),ii=a("yWug");function ei(i,e){if(1&i&&(s.Tb(0,"th",8),s.Oc(1),s.Ob(2,"p-sortIcon",9),s.Sb()),2&i){var a=e.$implicit;s.mc("pSortableColumn",a.field)("pSortableColumnDisabled",null==a.field),s.Bb(1),s.Qc(" ",a.header," "),s.Bb(1),s.mc("field",a.field)}}function ai(i,e){if(1&i&&(s.Tb(0,"tr"),s.Mc(1,ei,3,4,"th",7),s.Sb()),2&i){var a=e.$implicit;s.Bb(1),s.mc("ngForOf",a)}}function ti(i,e){if(1&i&&(s.Tb(0,"tr"),s.Tb(1,"td"),s.Oc(2),s.Sb(),s.Tb(3,"td"),s.Oc(4),s.Sb(),s.Tb(5,"td"),s.Oc(6),s.Sb(),s.Tb(7,"td"),s.Oc(8),s.Sb(),s.Tb(9,"td"),s.Oc(10),s.Sb(),s.Tb(11,"td"),s.Oc(12),s.Sb(),s.Tb(13,"td"),s.Oc(14),s.Sb(),s.Tb(15,"td"),s.Oc(16),s.Sb(),s.Tb(17,"td"),s.Oc(18),s.Sb(),s.Tb(19,"td"),s.Oc(20),s.Sb(),s.Tb(21,"td"),s.Oc(22),s.Sb(),s.Tb(23,"td"),s.Oc(24),s.Sb(),s.Tb(25,"td"),s.Oc(26),s.Sb(),s.Tb(27,"td"),s.Oc(28),s.Sb(),s.Sb()),2&i){var a=e.$implicit,t=s.fc();s.Bb(2),s.Pc(a.cognome?a.cognome:t.labels.nd),s.Bb(2),s.Pc(a.nome?a.nome:t.labels.nd),s.Bb(2),s.Qc(" ",a.codiceFiscale?a.codiceFiscale:t.labels.nd," "),s.Bb(2),s.Pc(a.dataNascita?a.dataNascita:t.labels.nd),s.Bb(2),s.Qc(" ",a.comuneNascita?a.comuneNascita:t.labels.nd," "),s.Bb(2),s.Qc(" ",a.provinciaNascita?a.provinciaNascita:t.labels.nd," "),s.Bb(2),s.Pc(a.sesso?a.sesso:t.labels.nd),s.Bb(2),s.Qc(" ",a.comuneResidenza?a.comuneResidenza:t.labels.nd," "),s.Bb(2),s.Qc(" ",a.indirizzoResidenza?a.indirizzoResidenza:t.labels.nd," "),s.Bb(2),s.Qc(" ",a.provinciaResidenza?a.provinciaResidenza:t.labels.nd," "),s.Bb(2),s.Pc(a.capResidenza?a.capResidenza:t.labels.nd),s.Bb(2),s.Qc(" ",a.carica[0].tipologia?a.carica[0].tipologia:t.labels.nd," "),s.Bb(2),s.Qc(" ",a.carica[0].dataInizio?a.carica[0].dataInizio:t.labels.nd," "),s.Bb(2),s.Qc(" ",a.carica[0].dataFine?a.carica[0].dataFine:"Illimitata"," ")}}function ni(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",10),s.Tb(1,"div",11),s.Tb(2,"p-checkbox",12),s.bc("ngModelChange",(function(i){return s.Ec(a),s.fc().hasDirettoreTecnicoValue=i})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=s.fc();s.Bb(2),s.mc("disabled",t.hasDirettoreTecnicoNominato)("ngModel",t.hasDirettoreTecnicoValue)}}var oi,ri=function(){return{marginTop:"70px"}},ci=((oi=function(){function i(e,a,t,n,o){_classCallCheck(this,i),this.dichiarazioneAntimafiaService=e,this.antimafiaService=a,this.validator=t,this.messageService=n,this.loader=o,this.intestazioni=d.a,this.labels=d.a}return _createClass(i,[{key:"ngOnInit",value:function(){this.loader.setTimeout(48e4),this.dichiarazioneAntimafia=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia(),this.listaSoggetti=this.popolaDati(this.dichiarazioneAntimafia),this.listaSoggettiTabella=this.isImpresaDittaIndividuale()?this.popolaSoggettiImportanti(this.listaSoggetti,this.dichiarazioneAntimafia.datiDichiarazione.richiedente):this.popolaSoggettiAltri(this.listaSoggetti),Q.setInizioCarica(this.listaSoggettiTabella,this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.estremiCCIAA.dataIscrizione),this.hasDirettoreTecnicoNominato=this.checkDirettoreTecnicoNominato(this.listaSoggetti),this.hasDirettoreTecnicoValue=this.dichiarazioneAntimafia.assenzaDt,this.textTitle=d.a.datiAcquisitiTrib,this.cols=[{field:"cognome",header:this.intestazioni.cognome},{field:"nome",header:this.intestazioni.nome},{field:"codiceFiscale",header:this.intestazioni.codiceFiscale},{field:"dataNascita",header:this.intestazioni.dataNascita},{field:"comuneNascita",header:this.intestazioni.comuneNascita},{field:"provinciaNascita",header:this.intestazioni.provinciaNascita},{field:"sesso",header:this.intestazioni.sesso},{field:null,header:this.intestazioni.residenzaComune},{field:null,header:this.intestazioni.residenzaVia},{field:null,header:this.intestazioni.residenzaProvincia},{field:null,header:this.intestazioni.residenzaCAP},{field:null,header:this.intestazioni.carica},{field:null,header:this.intestazioni.dataInizioCarica},{field:null,header:this.intestazioni.dataFineCarica}]}},{key:"isImpresaDittaIndividuale",value:function(){return"DI"===this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.formaGiuridicaCodice}},{key:"conferma",value:function(){var i=this;this.dichiarazioneAntimafia.assenzaDt=this.hasDirettoreTecnicoValue;var e=this.validator.validaSoggettiCarica(this.dichiarazioneAntimafia);if(e.esito===_.ERROR)return this.msgErrore=e.messaggio,void this.messageService.add(m.a.getToast("errorAssenzaDt",m.b.error,this.msgErrore));console.log("Inzio PUT"),console.log(this.dichiarazioneAntimafia),this.isImpresaDittaIndividuale()?this.antimafiaService.aggiornaDichiarazioneAntimafia(this.dichiarazioneAntimafia).subscribe((function(i){console.log("Modifica alla dichiarazione "+i.dichiarazione.id+" avvenuta con successo"),null!=i.esito&&m.a.getToast("generico",m.b.error,i.esito)}),(function(i){var e="Errore in aggiornaDichiarazioneAntimafia: "+i;console.error(e),m.a.getToast("generico",m.b.error,e)}),(function(){return i.stepComponent.goNext()})):this.stepComponent.goNext()}},{key:"checkDirettoreTecnicoNominato",value:function(i){return i.some((function(i){return i.carica.some((function(i){return"DT"===i.codice}))}))}},{key:"popolaSoggettiAltri",value:function(i){return Q.soggettiAppiattito(i)}},{key:"popolaSoggettiImportanti",value:function(i,e){return i.forEach((function(i){return i.carica=i.carica.filter((function(i){return i.codice.match("DT|TIT|TI")})),i})),i.filter((function(i){return i.carica.length>0}))}},{key:"popolaDati",value:function(i){var e;return null==i?(console.log("dichiarazioneDettagli assente "),[]):null!=(e=i.datiDichiarazione).dettaglioImpresa.soggettiImpresa?e.dettaglioImpresa.soggettiImpresa:[]}},{key:"ngOnDestroy",value:function(){this.loader.resetTimeout()}}]),i}()).\u0275fac=function(i){return new(i||oi)(s.Nb(l),s.Nb(f.a),s.Nb(x),s.Nb(S.d),s.Nb(p.a))},oi.\u0275cmp=s.Hb({type:oi,selectors:[["app-soggetti"]],viewQuery:function(i,e){var a;1&i&&s.Jc(N,!0),2&i&&s.Ac(a=s.cc())&&(e.stepComponent=a.first)},decls:9,vars:11,consts:[[1,"boxgrey"],["dataKey","cognome",3,"columns","value","autoLayout","paginator","rows","responsive"],["pTemplate","header"],["pTemplate","body"],["class","ui-g",4,"ngIf"],[3,"next"],["key","errorAssenzaDt"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[1,"ui-g"],[1,"ui-g-12"],["binary","true","label","Dichiaro che NON \xe8 stato nominato il Direttore Tecnico",3,"disabled","ngModel","ngModelChange"]],template:function(i,e){1&i&&(s.Tb(0,"div",0),s.Tb(1,"h3"),s.Oc(2),s.Sb(),s.Tb(3,"p-table",1),s.Mc(4,ai,2,1,"ng-template",2),s.Mc(5,ti,29,14,"ng-template",3),s.Sb(),s.Mc(6,ni,3,2,"div",4),s.Sb(),s.Tb(7,"app-step-action",5),s.bc("next",(function(){return e.conferma()})),s.Sb(),s.Ob(8,"p-toast",6)),2&i&&(s.Bb(2),s.Pc(e.textTitle),s.Bb(1),s.mc("columns",e.cols)("value",e.listaSoggettiTabella)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0),s.Bb(3),s.mc("ngIf",!e.hasDirettoreTecnicoNominato&&e.isImpresaDittaIndividuale()),s.Bb(2),s.Kc(s.rc(10,ri)))},directives:[ii.q,S.e,o.t,N,z.a,o.s,ii.p,ii.o,L.a,U.s,U.v],styles:[""]}),oi);function si(i,e){if(1&i&&(s.Tb(0,"th",11),s.Oc(1),s.Ob(2,"p-sortIcon",12),s.Sb()),2&i){var a=e.$implicit;s.mc("pSortableColumn",a.field)("pSortableColumnDisabled",null==a.field),s.Bb(1),s.Qc(" ",a.header," "),s.Bb(1),s.mc("field",a.field)}}function li(i,e){if(1&i&&(s.Tb(0,"tr"),s.Mc(1,si,3,4,"th",10),s.Sb()),2&i){var a=e.$implicit;s.Bb(1),s.mc("ngForOf",a)}}function di(i,e){if(1&i){var a=s.Ub();s.Tb(0,"tr"),s.Tb(1,"td"),s.Oc(2),s.Sb(),s.Tb(3,"td"),s.Oc(4),s.Sb(),s.Tb(5,"td"),s.Oc(6),s.Sb(),s.Tb(7,"td"),s.Oc(8),s.Sb(),s.Tb(9,"td"),s.Oc(10),s.Sb(),s.Tb(11,"td"),s.Oc(12),s.Sb(),s.Tb(13,"td"),s.Oc(14),s.Sb(),s.Tb(15,"td"),s.Oc(16),s.Sb(),s.Tb(17,"td"),s.Oc(18),s.Sb(),s.Tb(19,"td"),s.Oc(20),s.Sb(),s.Tb(21,"td"),s.Tb(22,"p-checkbox",13,14),s.bc("ngModelChange",(function(i){return s.Ec(a),e.$implicit.selezionato=i})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit,n=s.fc(2);s.Bb(2),s.Pc(t.denominazione?t.denominazione:n.intestazioni.nd),s.Bb(2),s.Pc(t.codiceFiscale?t.codiceFiscale:n.intestazioni.nd),s.Bb(2),s.Pc(t.comuneSede?t.comuneSede:n.intestazioni.nd),s.Bb(2),s.Pc(t.indirizzoSede?t.indirizzoSede:n.intestazioni.nd),s.Bb(2),s.Pc(t.civicoSede?t.civicoSede:n.intestazioni.nd),s.Bb(2),s.Pc(t.provinciaSede?t.provinciaSede:n.intestazioni.nd),s.Bb(2),s.Pc(t.capSede?t.capSede:n.intestazioni.nd),s.Bb(2),s.Pc(t.carica[0].tipologia?t.carica[0].tipologia:n.intestazioni.nessunaCarica),s.Bb(2),s.Pc(t.carica[0].dataInizio?t.carica[0].dataInizio:n.intestazioni.nd),s.Bb(2),s.Pc(t.carica[0].dataFine?t.carica[0].dataFine:n.intestazioni.illimitata),s.Bb(2),s.mc("ngModel",t.selezionato)}}function ui(i,e){1&i&&(s.Tb(0,"tr"),s.Tb(1,"td"),s.Oc(2," Nessuna Azienda Collegata "),s.Sb(),s.Sb()),2&i&&(s.Bb(1),s.Cb("colspan",11))}function bi(i,e){if(1&i&&(s.Tb(0,"div",3),s.Tb(1,"h3",4),s.Oc(2),s.Tb(3,"span"),s.Tb(4,"a",5),s.Oc(5," ? "),s.Sb(),s.Sb(),s.Sb(),s.Tb(6,"p-table",6),s.Mc(7,li,2,1,"ng-template",7),s.Mc(8,di,24,11,"ng-template",8),s.Mc(9,ui,3,1,"ng-template",9),s.Sb(),s.Sb()),2&i){var a=s.fc();s.Bb(2),s.Qc("",a.textTitle," "),s.Bb(4),s.mc("columns",a.cols)("value",a.aziendeCollegate)("autoLayout",!0)("responsive",!0)}}function fi(i,e){1&i&&(s.Tb(0,"div",15),s.Tb(1,"h5"),s.Oc(2," Informazioni disponibili solo per aziende "),s.Sb(),s.Sb())}var hi,gi=((hi=function(){function i(e,a,t,n){_classCallCheck(this,i),this.dichiarazioneAntimafiaService=e,this.antimafiaService=a,this.messages=t,this.validator=n,this.intestazioni=d.a,this.loading=!1,this.aziendeCollegate=[]}return _createClass(i,[{key:"ngOnInit",value:function(){this.dichiarazioneAntimafia=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia(),this.isImpresaDittaIndividuale()||(this.aziendeCollegate=this.popolaDati(this.dichiarazioneAntimafia)),console.log(this.aziendeCollegate),this.textTitle=d.a.datiAcquisiti,this.cols=[{field:"denominazione",header:this.intestazioni.denominazione},{field:"codiceFiscale",header:this.intestazioni.codiceFiscale},{field:"comuneSede",header:this.intestazioni.comune},{field:"indirizzoSede",header:this.intestazioni.indirizzo},{field:"civicoSede",header:this.intestazioni.civico},{field:"provinciaSede",header:this.intestazioni.provinciaSigla},{field:"capSede",header:this.intestazioni.cap},{field:null,header:this.intestazioni.carica},{field:null,header:this.intestazioni.dataInizioCarica},{field:null,header:this.intestazioni.dataFineCarica},{field:"selezionato",header:this.intestazioni.dichiarazione}]}},{key:"isImpresaDittaIndividuale",value:function(){return Q.isImpresaDittaIndividuale(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.formaGiuridicaCodice)}},{key:"popolaDati",value:function(i){var e=[];return null==i?(console.log("dichiarazione Dettagli assente"),[]):void 0!==(e=i.datiDichiarazione.dettaglioImpresa.aziendeCollegate)&&e.length>0?this.duplicaAziendeConCariche(e):[]}},{key:"duplicaAziendeConCariche",value:function(i){var e=[];return i.forEach((function(i){i.carica.forEach((function(a){var t=Object.assign({},i);t.carica=[a],e.push(t)}))})),this.assegnaDataInizioCarica(e)}},{key:"assegnaDataInizioCarica",value:function(i){var e=this,a=[];return i.forEach((function(i){i.carica.forEach((function(t){void 0!==t.dataInizio&&null!=t.dataInizio&&t.dataInizio.length>0||(t.dataInizio=e.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.estremiCCIAA.dataIscrizione),a.push(i)}))})),a}},{key:"conferma",value:function(){var i=this,e=this.validator.validaAziendeCollegate(this.aziendeCollegate);e.esito===_.OK?(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.aziendeCollegate=this.aziendeCollegate,this.loading=!0,this.antimafiaService.aggiornaDichiarazioneAntimafia(this.dichiarazioneAntimafia).subscribe((function(e){console.log("Modifica alla dichiarazione "+e.dichiarazione.id+" avvenuta con successo"),null!=e.esito&&i.messages.add(m.a.getToast("generico",m.b.error,e.esito))}),(function(e){var a="Errore in aggiornaDichiarazioneAntimafia: "+e;console.error(a),i.messages.add(m.a.getToast("generico",m.b.error,a))}),(function(){i.loading=!1,i.stepComponent.goNext()}))):alert(e.messaggio)}}]),i}()).\u0275fac=function(i){return new(i||hi)(s.Nb(l),s.Nb(f.a),s.Nb(S.d),s.Nb(x))},hi.\u0275cmp=s.Hb({type:hi,selectors:[["app-aziende"]],viewQuery:function(i,e){var a;1&i&&s.Jc(N,!0),2&i&&s.Ac(a=s.cc())&&(e.stepComponent=a.first)},decls:3,vars:2,consts:[["class","boxgrey",4,"ngIf"],["class","card no-margin",4,"ngIf"],[3,"next"],[1,"boxgrey"],[1,"w-auto"],["href","./assets/pages/informativa-familiari/informativa-familiari.html","target","_blank"],[3,"columns","value","autoLayout","responsive"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],["binary","true",3,"ngModel","ngModelChange"],["primeCheckBox",""],[1,"card","no-margin"]],template:function(i,e){1&i&&(s.Mc(0,bi,10,5,"div",0),s.Mc(1,fi,3,0,"div",1),s.Tb(2,"app-step-action",2),s.bc("next",(function(){return e.conferma()})),s.Sb()),2&i&&(s.mc("ngIf",!e.isImpresaDittaIndividuale()),s.Bb(1),s.mc("ngIf",e.isImpresaDittaIndividuale()))},directives:[o.t,N,ii.q,S.e,o.s,ii.p,ii.o,L.a,U.s,U.v],styles:[""]}),hi),mi=a("dkQB"),pi=function i(){_classCallCheck(this,i)},vi=a("JEAp"),Si=a("tk/3"),zi=a("FK/F"),Ti=a("kPZZ"),yi=a("1SSY"),Ai=["file"];function Ci(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",11),s.Ob(1,"i",12),s.Tb(2,"h3"),s.Oc(3),s.Sb(),s.Tb(4,"p"),s.Oc(5),s.Sb(),s.Sb(),s.Tb(6,"div",13),s.Tb(7,"div",14),s.Tb(8,"button",15),s.bc("click",(function(){return s.Ec(a),s.fc().onConfirmCheckDichiarazione()})),s.Sb(),s.Sb(),s.Tb(9,"div",14),s.Tb(10,"button",16),s.bc("click",(function(){return s.Ec(a),s.fc().onRejectCheckDichiarazione()})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit;s.Bb(3),s.Pc(t.summary),s.Bb(2),s.Pc(t.detail)}}function Ii(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",11),s.Ob(1,"i",12),s.Tb(2,"h3"),s.Oc(3),s.Sb(),s.Tb(4,"p"),s.Oc(5),s.Sb(),s.Sb(),s.Tb(6,"div",13),s.Tb(7,"div",14),s.Tb(8,"button",15),s.bc("click",(function(){return s.Ec(a),s.fc().onConfirmHasAlreadyUploadedFile()})),s.Sb(),s.Sb(),s.Tb(9,"div",14),s.Tb(10,"button",16),s.bc("click",(function(){return s.Ec(a),s.fc().onRejectHasAlreadyUploadedFile()})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit;s.Bb(3),s.Pc(t.summary),s.Bb(2),s.Pc(t.detail)}}function Oi(i,e){if(1&i&&(s.Tb(0,"th",23),s.Oc(1),s.Ob(2,"p-sortIcon",24),s.Sb()),2&i){var a=e.$implicit;s.mc("pSortableColumn",a.field)("pSortableColumnDisabled",null==a.field),s.Bb(1),s.Qc(" ",a.header," "),s.Bb(1),s.mc("field",a.field)}}function Di(i,e){if(1&i&&(s.Tb(0,"tr"),s.Mc(1,Oi,3,4,"th",22),s.Ob(2,"th"),s.Sb()),2&i){var a=e.$implicit;s.Bb(1),s.mc("ngForOf",a)}}function Pi(i,e){if(1&i){var a=s.Ub();s.Tb(0,"tr"),s.Tb(1,"td"),s.Oc(2),s.Sb(),s.Tb(3,"td"),s.Oc(4),s.Sb(),s.Tb(5,"td"),s.Oc(6),s.Sb(),s.Tb(7,"td"),s.Oc(8),s.Sb(),s.Tb(9,"td"),s.Oc(10),s.Sb(),s.Tb(11,"td"),s.Oc(12),s.Sb(),s.Tb(13,"td"),s.Oc(14),s.Sb(),s.Tb(15,"td"),s.Tb(16,"p-checkbox",25,26),s.bc("ngModelChange",(function(i){return s.Ec(a),e.$implicit.carica[0].selezionato=i}))("onChange",(function(i){s.Ec(a);var t=e.$implicit,n=s.Bc(17);return s.fc(2).compilazioneDichiarazione(t,i,n)})),s.Sb(),s.Sb(),s.Tb(18,"td"),s.Tb(19,"action-menu",27,28),s.bc("click",(function(){s.Ec(a);var i=e.rowIndex,t=e.$implicit,n=s.Bc(20);return s.fc(2).onDropdownMenuOpen(i,n,t)})),s.Sb(),s.Tb(21,"input",29,30),s.bc("change",(function(i){return s.Ec(a),s.fc(2).onFileChange(i)})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit,n=s.fc(2);s.Bb(2),s.Pc(t.cognome),s.Bb(2),s.Pc(t.nome),s.Bb(2),s.Pc(t.codiceFiscale),s.Bb(2),s.Pc(t.dataNascita),s.Bb(2),s.Pc(t.carica[0].tipologia),s.Bb(2),s.Pc(t.carica[0].dataInizio?t.carica[0].dataInizio:n.labels.nd),s.Bb(2),s.Pc(t.carica[0].dataFine?t.carica[0].dataFine:n.labels.illimitata),s.Bb(2),s.mc("ngModel",t.carica[0].selezionato),s.Bb(3),s.mc("item",n.model)("reset",n.reset)}}function Ei(i,e){1&i&&(s.Tb(0,"tr"),s.Tb(1,"td"),s.Oc(2," Nessun contenuto disponibile "),s.Sb(),s.Sb()),2&i&&(s.Bb(1),s.Cb("colspan",10))}function Fi(i,e){if(1&i&&(s.Tb(0,"div",17),s.Tb(1,"p-table",18),s.Mc(2,Di,3,1,"ng-template",19),s.Mc(3,Pi,23,10,"ng-template",20),s.Mc(4,Ei,3,1,"ng-template",21),s.Sb(),s.Sb()),2&i){var a=s.fc();s.Bb(1),s.mc("columns",a.cols)("value",a.listaSoggettiTable)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)}}function Ri(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div"),s.Tb(1,"p-checkbox",41),s.bc("ngModelChange",(function(i){return s.Ec(a),s.fc(2).soggettoSelezionato.carica[0].dichiarazione=i}))("onChange",(function(i){return s.Ec(a),s.fc(2).onChangeDichiarazione(i)})),s.Sb(),s.Sb()}if(2&i){var t=s.fc(2);s.Bb(1),s.mc("ngModel",t.soggettoSelezionato.carica[0].dichiarazione)}}function ki(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",55),s.Ob(1,"input",56,57),s.Tb(3,"div",58),s.Tb(4,"button",59),s.bc("debounceClick",(function(i){s.Ec(a);var e=s.Bc(2),t=s.fc().$implicit,n=s.Bc(4);return s.fc(2).cercaPerCodiceFiscale(e.value,t,n,i)})),s.Tb(5,"i",60),s.Oc(6," search "),s.Sb(),s.Sb(),s.Sb(),s.Sb()}}function Bi(i,e){if(1&i&&(s.Tb(0,"div"),s.Oc(1),s.Sb()),2&i){var a=s.fc().$implicit;s.Bb(1),s.Qc(" ",a.codiceFiscale," ")}}function Ni(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",32),s.Tb(1,"div",42),s.Tb(2,"div",43),s.Tb(3,"p-panel",44,45),s.Tb(5,"p-header"),s.Tb(6,"div",32),s.Tb(7,"div",46),s.Ob(8,"img",47),s.Sb(),s.Tb(9,"div",48),s.Tb(10,"h4"),s.Oc(11),s.Sb(),s.Mc(12,ki,7,0,"div",49),s.Mc(13,Bi,2,1,"div",37),s.Sb(),s.Tb(14,"div",50),s.Tb(15,"p-dropdown",51),s.bc("ngModelChange",(function(i){return s.Ec(a),e.$implicit.gradoParentela=i}))("onChange",(function(i){return s.Ec(a),s.fc(2).onGradoParentelaChange(i)})),s.Sb(),s.Sb(),s.Tb(16,"div",52),s.Tb(17,"button",53),s.bc("click",(function(){s.Ec(a);var i=e.$implicit;return s.fc(2).eliminaFamiliare(i)})),s.Sb(),s.Sb(),s.Ob(18,"div",46),s.Sb(),s.Sb(),s.Tb(19,"div",32),s.Tb(20,"div",54),s.Tb(21,"strong"),s.Oc(22),s.Sb(),s.Sb(),s.Tb(23,"div",54),s.Tb(24,"label"),s.Oc(25),s.gc(26,"date"),s.Sb(),s.Sb(),s.Tb(27,"div",54),s.Tb(28,"strong"),s.Oc(29),s.Sb(),s.Sb(),s.Tb(30,"div",54),s.Tb(31,"label"),s.Oc(32),s.Sb(),s.Sb(),s.Tb(33,"div",54),s.Tb(34,"strong"),s.Oc(35),s.Sb(),s.Sb(),s.Tb(36,"div",54),s.Tb(37,"label"),s.Oc(38),s.Sb(),s.Sb(),s.Tb(39,"div",54),s.Tb(40,"strong"),s.Oc(41),s.Sb(),s.Sb(),s.Tb(42,"div",54),s.Tb(43,"label"),s.Oc(44),s.Sb(),s.Sb(),s.Tb(45,"div",54),s.Tb(46,"strong"),s.Oc(47),s.Sb(),s.Sb(),s.Tb(48,"div",54),s.Tb(49,"label"),s.Oc(50),s.Sb(),s.Sb(),s.Tb(51,"div",54),s.Tb(52,"strong"),s.Oc(53),s.Sb(),s.Sb(),s.Tb(54,"div",54),s.Tb(55,"label"),s.Oc(56),s.Sb(),s.Sb(),s.Tb(57,"div",54),s.Tb(58,"strong"),s.Oc(59),s.Sb(),s.Sb(),s.Tb(60,"div",54),s.Tb(61,"label"),s.Oc(62),s.Sb(),s.Sb(),s.Tb(63,"div",54),s.Tb(64,"strong"),s.Oc(65),s.Sb(),s.Sb(),s.Tb(66,"div",54),s.Tb(67,"label"),s.Oc(68),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit,n=s.fc(2);s.Bb(3),s.mc("toggleable",!0)("collapsed",!0),s.Bb(8),s.Rc("",t.nome," ",t.cognome,""),s.Bb(1),s.mc("ngIf",!t.codiceFiscale),s.Bb(1),s.mc("ngIf",t.codiceFiscale),s.Bb(2),s.mc("options",n.gradoParentelaItems)("ngModel",t.gradoParentela),s.Bb(7),s.Pc(n.labels.dataNascita),s.Bb(3),s.Pc(s.ic(26,24,t.dataNascita,"dd/MM/yyyy")),s.Bb(4),s.Pc(n.labels.residenza),s.Bb(3),s.Pc(t.residenza.indirizzo),s.Bb(3),s.Pc(n.labels.comuneNascita),s.Bb(3),s.Pc(t.comuneNascita),s.Bb(3),s.Pc(n.labels.residenzaComune),s.Bb(3),s.Pc(t.residenza.comune),s.Bb(3),s.Pc(n.labels.provinciaNascita),s.Bb(3),s.Pc(t.provinciaNascita),s.Bb(3),s.Pc(n.labels.residenzaProvincia),s.Bb(3),s.Pc(t.residenza.provincia),s.Bb(3),s.Pc(n.labels.sesso),s.Bb(3),s.Pc(t.sesso),s.Bb(3),s.Pc(n.labels.residenzaCAP),s.Bb(3),s.Pc(t.residenza.CAP)}}function _i(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",31),s.Tb(1,"div",32),s.Tb(2,"div",33),s.Tb(3,"h3",34),s.Oc(4),s.Sb(),s.Sb(),s.Tb(5,"div",35),s.Tb(6,"button",36),s.bc("click",(function(){return s.Ec(a),s.fc().aggiungiFamiliare()})),s.Sb(),s.Oc(7," AGGIUNGI FAMILIARE "),s.Sb(),s.Sb(),s.Mc(8,Ri,2,1,"div",37),s.Mc(9,Ni,69,27,"div",38),s.Tb(10,"div"),s.Tb(11,"div",39),s.Tb(12,"button",40),s.bc("debounceClick",(function(){return s.Ec(a),s.fc().salvaFamiliari()})),s.Sb(),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=s.fc();s.Bb(4),s.Rc("Elenco familiari conviventi di ",t.soggettoSelezionato.cognome," ",t.soggettoSelezionato.nome,""),s.Bb(4),s.mc("ngIf",!t.soggettoSelezionato.familiariConviventi||0==t.soggettoSelezionato.familiariConviventi.length),s.Bb(1),s.mc("ngForOf",t.soggettoSelezionato.familiariConviventi)}}function Mi(i,e){1&i&&s.Oc(0," Nessun contenuto disponibile ")}var wi,xi=((wi=function(){function i(e,a,t,n,o,r,c,l,u,b){_classCallCheck(this,i),this.dichiarazioneAntimafiaService=e,this._configuration=a,this.antimafiaService=t,this.stepEvent=n,this.validator=o,this.messages=r,this.confirmationService=c,this.http=l,this.datePipe=u,this.loader=b,this.intestazioni=d.a,this.labels=d.a,this.msgs=[],this.soggettoChange=new s.n,this.model=new Array,this.loading=!1,this.blobToFile=function(i,e){var a=i;return a.lastModifiedDate=new Date,a.name=e,i}}return _createClass(i,[{key:"ngOnDestroy",value:function(){this.loader.resetTimeout()}},{key:"ngOnInit",value:function(){var i=this;this.loader.setTimeout(48e4),this.model=[{label:"AZIONI",items:[{label:"Carica Modello",check:"true",badgeStyle:"file-uploaded-ok",items:[{label:"Firma Autografa",command:function(){i.uploadFile(!1)}},{label:"Firma Digitale",command:function(){i.uploadFile(!0)}}]},{separator:!0},{label:"Scarica Modello",command:function(){i.downloadPdfFamiliariConviventi()}},{separator:!0},{label:"Familiari",badge:"true",command:function(){i.visualizzaFamiliari(i.soggettoSelezionatoMenuAction)}}]}],this.dichiarazioneAntimafia=this.dichiarazioneAntimafiaService.getDichiarazioneAntimafia(),this.listaSoggetti=this.popolaDati(this.dichiarazioneAntimafia),this.listaSoggettiTable=this.isImpresaDittaIndividuale()?this.getCaricheImportanti(this.listaSoggetti):this.getCaricheAltre(this.listaSoggetti),Q.setInizioCarica(this.listaSoggettiTable,this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.estremiCCIAA.dataIscrizione),this.soggettoChange.subscribe((function(e){var a=e.data,t=i.listaSoggetti.find((function(i){return i.codiceFiscale==a.codiceFiscale}));t.familiariConviventi=a.familiariConviventi;var n=t.carica.find((function(i){return i.codice==a.carica[0].codice}));n.selezionato=a.carica[0].selezionato,n.dichiarazione=a.carica[0].dichiarazione,e.aggiornaDichiarazione&&i.antimafiaService.aggiornaDichiarazioneAntimafia(i.dichiarazioneAntimafia).subscribe((function(e){i.messages.add(m.a.getToast("generic",m.b.success,m.a.OPERAZIONE_OK))}))})),this.gradoParentelaItems=[],this.gradoParentelaItems.push({label:"Seleziona una opzione",value:null}),this.gradoParentelaItems.push({label:d.a.coniuge,value:d.a.coniuge}),this.gradoParentelaItems.push({label:d.a.figlio,value:d.a.figlio}),this.gradoParentelaItems.push({label:d.a.altro,value:d.a.altro}),this.textTitle=d.a.familiariConvinentiTitle,this.cols=[{field:"cognome",header:this.intestazioni.cognome},{field:"nome",header:this.intestazioni.nome},{field:"codiceFiscale",header:this.intestazioni.codiceFiscale},{field:"dataNascita",header:this.intestazioni.dataNascita},{field:null,header:this.intestazioni.carica},{field:null,header:this.intestazioni.dataInizioCarica},{field:null,header:this.intestazioni.dataFineCarica},{field:null,header:this.intestazioni.dichiarazione}]}},{key:"isImpresaDittaIndividuale",value:function(){return"DI"===this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.formaGiuridicaCodice}},{key:"popolaDati",value:function(i){var e;return null==i?(console.log("dichiarazione Dettagli assente"),[]):null!=(e=i.datiDichiarazione).dettaglioImpresa.soggettiImpresa?e.dettaglioImpresa.soggettiImpresa:[]}},{key:"onDropdownMenuOpen",value:function(i,e,a){this.soggettoSelezionatoMenuAction=a,this.soggettoTableIndex=i;var t=0;a.familiariConviventi&&a.familiariConviventi.length>0&&a.carica[0].selezionato&&(t=this.soggettoSelezionatoMenuAction.familiariConviventi.length),e.badgeCounters=t,this.hasAlreadyUpdateFile()&&(e.badgeStylezed=!0,e.badgeData={fileDownloadLink:this._configuration.antimafia_server+this.soggettoSelezionatoMenuAction.carica[0].href,fileName:"Allegato 3-Familiari Conviventi_"+this.soggettoSelezionatoMenuAction.codiceFiscale+"."+this.soggettoSelezionatoMenuAction.carica[0].tipoAllegato})}},{key:"getCaricheAltre",value:function(i){var e=i.map((function(i){return Object.assign({},i)})),a=[];return e.forEach((function(i){i.carica.forEach((function(e){var t=Object.assign({},i);t.carica=[e],a.push(t)}))})),a}},{key:"getCaricheImportanti",value:function(i){return JSON.parse(JSON.stringify(i)).filter((function(i){return i.carica=i.carica.filter((function(i){return i.codice.match("DT|TIT|TI")}))})).filter((function(i){return!!i.carica&&0!==i.carica.length}))}},{key:"onConfirmCheckDichiarazione",value:function(){this.soggettoSelezionato.familiariConviventi=null,this.soggettoSelezionato.carica[0].dichiarazione=!1,this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1}),this.soggettoSelezionato=null,this.messages.clear("checkDichiarazione")}},{key:"onRejectCheckDichiarazione",value:function(){this.soggettoSelezionato.carica[0].selezionato=!0,this.primeCheckBox.checked=!0,this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1}),this.messages.clear("checkDichiarazione")}},{key:"onChangeDichiarazione",value:function(i){this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1})}},{key:"compilazioneDichiarazione",value:function(i,e,a){if(this.soggettoSelezionato=i,this.primeCheckBox=a,e){this.soggettoSelezionato=i;var t=this.listaSoggetti.find((function(e){return e.codiceFiscale==i.codiceFiscale&&!!e.familiariConviventi}));console.log("soggetto Con Familiare Esistente: "+t),t&&(this.soggettoSelezionato.familiariConviventi=t.familiariConviventi),this.scrollToBottom()}else{var n=this.listaSoggettiTable.filter((function(e){return e.codiceFiscale==i.codiceFiscale&&e.carica[0].codice!=i.carica[0].codice})).some((function(i){return i.carica.some((function(i){return i.selezionato}))}));if(i.familiariConviventi&&i.familiariConviventi.length>0&&!n)return this.messages.clear(),void this.messages.add({key:"checkDichiarazione",sticky:!0,severity:"warn",summary:"Tutti i familiari collegati saranno cancellati",detail:"Sei sicuro di voler togliere la spunta?"});if(i.carica[0].dichiarazione)return this.messages.clear(),void this.messages.add({key:"checkDichiarazione",sticky:!0,severity:"warn",summary:"E' stata spuntata la dichiarazione che NON ci sono famigliari conviventi.",detail:"Sei sicuro di voler togliere la spunta?"});this.soggettoSelezionato=null}}},{key:"manageSoggettoConFamiliareEsistente",value:function(){var i=this,e=this.listaSoggetti.find((function(e){return e.codiceFiscale==i.soggettoSelezionato.codiceFiscale&&!!e.familiariConviventi}));console.log("soggetto Con Familiare Esistente: "+e),e&&this.listaSoggettiTable.forEach((function(a){a.codiceFiscale==i.soggettoSelezionato.codiceFiscale&&(a.familiariConviventi=e.familiariConviventi)}))}},{key:"visualizzaFamiliari",value:function(i){void 0!==i&&(i.familiariConviventi&&i.familiariConviventi.length>0&&i.carica[0].selezionato||i.carica[0].selezionato&&i.carica[0].dichiarazione?(this.soggettoSelezionato=i,this.scrollToBottom()):this.soggettoSelezionato=null)}},{key:"scrollToBottom",value:function(){window.setTimeout((function(){document.querySelector("#idTableFamiliari")&&document.querySelector("#idTableFamiliari").scrollIntoView()}),500)}},{key:"aggiungiFamiliare",value:function(){this.soggettoSelezionato.familiariConviventi||(this.soggettoSelezionato.familiariConviventi=new Array),this.soggettoSelezionato.familiariConviventi.find((function(i){return null==i.codiceFiscale}))||this.soggettoSelezionato.familiariConviventi.splice(0,0,{nome:"",cognome:"",codiceFiscale:null,comuneNascita:"",provinciaNascita:"",dataNascita:"",sesso:"",residenza:{indirizzo:"",comune:"",provincia:"",CAP:""},gradoParentela:null}),this.soggettoSelezionato.carica[0].dichiarazione=!1,this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1})}},{key:"onGradoParentelaChange",value:function(i){this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1})}},{key:"cercaPerCodiceFiscale",value:function(i,e,a,t){var n=this;/^[a-zA-Z0-9]{16}$/.test(i)?this.soggettoSelezionato.familiariConviventi.some((function(e){return(e.codiceFiscale?e.codiceFiscale.toUpperCase():"")==i.toUpperCase()}))?this.messages.add(m.a.getToast("generic",m.b.error,m.a.CF_ESISTENTE(i))):this.antimafiaService.getPersona(i).subscribe((function(i){if(i.esito.codice.match("012")){var t=i.risposta.persona.personaFisica.datiNascita.data.toString(),o=n.validator.validaFamiliariConviventiMaggiorenni(t,i.risposta.persona.personaFisica.codiceFiscale);o.esito===_.OK?(e.cognome=i.risposta.persona.personaFisica.cognome,e.nome=i.risposta.persona.personaFisica.nome,e.codiceFiscale=i.risposta.persona.personaFisica.codiceFiscale,e.dataNascita=t,e.sesso=i.risposta.persona.personaFisica.sesso.valore,e.comuneNascita=i.risposta.persona.personaFisica.datiNascita.comune,e.provinciaNascita=i.risposta.persona.personaFisica.datiNascita.provincia,e.residenza={comune:i.risposta.persona.personaFisica.domicilioFiscale.ubicazione.comune,indirizzo:i.risposta.persona.personaFisica.domicilioFiscale.ubicazione.toponimo,provincia:i.risposta.persona.personaFisica.domicilioFiscale.ubicazione.provincia,CAP:i.risposta.persona.personaFisica.domicilioFiscale.ubicazione.cap},a.collapsed=!1):n.messages.add(m.a.getToast("generic",m.b.error,o.messaggio))}else n.messages.add(m.a.getToast("generic",m.b.error,i.esito.descrizione))}),(function(i){return n.messages.add(m.a.getToast("generic",m.b.error,m.a.SERVIZIO_NON_DISPONIBILE))})):this.messages.add(m.a.getToast("generic",m.b.error,m.a.CHECK_CONFORMITA_CF))}},{key:"eliminaFamiliare",value:function(i){var e=this,a=this.soggettoSelezionato.familiariConviventi.indexOf(i,0);a>-1&&this.soggettoSelezionato.familiariConviventi.splice(a,1),this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!1}),0==this.soggettoSelezionato.familiariConviventi.length&&(this.listaSoggettiTable.filter((function(i){return i.codiceFiscale==e.soggettoSelezionato.codiceFiscale})).forEach((function(i){return i.carica[0].selezionato=!1})),this.soggettoSelezionato.carica[0].selezionato=!1,this.soggettoSelezionato.familiariConviventi=void 0,this.soggettoSelezionato=null)}},{key:"conferma",value:function(){var i=this;if(console.log("Inzio PUT"),this.validazioniFamiliari()){var e=this.validator.validaFamiliariConviventiAllegati(this.listaSoggettiTable);e.esito!==_.ERROR?(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.soggettiImpresa=this.listaSoggetti,this.loading=!0,this.antimafiaService.aggiornaDichiarazioneAntimafia(this.dichiarazioneAntimafia).subscribe((function(e){console.log("Modifica alla dichiarazione "+e.dichiarazione.id+" avvenuta con successo"),null!=e.esito&&i.messages.add(m.a.getToast("generico",m.b.error,e.esito))}),(function(e){var a="Errore in aggiornaDichiarazioneAntimafia: "+e;console.error(a),i.messages.add(m.a.getToast("generico",m.b.error,a))}),(function(){i.loading=!1,i.stepComponent.goNext()}))):this.messages.add(m.a.getToast("generic",m.b.error,e.messaggio))}}},{key:"indietro",value:function(){this.stepEvent.previous()}},{key:"onFileChange",value:function(i){if(i.target.files&&i.target.files.length>0){var e=new pi;e.file=i.target.files[0],e.isFirmaDigitale=this.isFirmaDigitale;var a=i.target.files[0],t=this.validator.validaAllegatoType(e.file,e.isFirmaDigitale),n=this.validator.validaAllegatoSize(e.file);t.esito==_.OK?n.esito==_.OK?this.uploadAndStoreFile(a,this.isFirmaDigitale):this.messages.add(m.a.getToast("generic",m.b.error,n.messaggio)):this.messages.add(m.a.getToast("generic",m.b.error,t.messaggio))}}},{key:"uploadFile",value:function(i){this.isFirmaDigitale=i,this.hasAlreadyUpdateFile()?this.showWarnAlreadyUploadedFile():this.openWindowsSelectFile()}},{key:"uploadAndStoreFile",value:function(i,e){var a=this,t=new h.a;void 0!==this.soggettoSelezionatoMenuAction&&(t.cfSoggettoImpresa=this.soggettoSelezionatoMenuAction.codiceFiscale,t.codCarica=this.soggettoSelezionatoMenuAction.carica[0].codice,t.tipoFile=i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDFP7M)?"pdf.p7m":i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDF)?"pdf":null,null!=this.soggettoSelezionatoMenuAction.carica[0].href&&(t.id=Number.parseInt(this.soggettoSelezionatoMenuAction.carica[0].href.split("/")[4])),t.allegatoFamiliariConviventiPdf=i,t.firmaDigitale=e,this.antimafiaService.allegaFamiliariConviventi(t,i,this.dichiarazioneAntimafia.id).subscribe((function(i){m.a.isUndefinedOrNull(i)||(m.a.isUndefinedOrNull(i.esito)?(a.messages.add(m.a.getToast("generic",m.b.success,m.a.OPERAZIONE_OK)),m.a.isUndefinedOrNull(i.carica)||m.a.isUndefinedOrNull(i.allegatoFamiliariConviventi)||(a.listaSoggettiTable.forEach((function(e){0==e.codiceFiscale.localeCompare(i.allegatoFamiliariConviventi.cfSoggettoImpresa)&&!m.a.isUndefinedOrNull(e.carica)&&e.carica.length>0&&e.carica.forEach((function(e){0==e.codice.localeCompare(i.carica.codice)&&(e.href=i.carica.href,e.tipoAllegato=t.tipoFile)}))})),a.listaSoggetti.forEach((function(e){0==e.codiceFiscale.localeCompare(i.allegatoFamiliariConviventi.cfSoggettoImpresa)&&!m.a.isUndefinedOrNull(e.carica)&&e.carica.length>0&&e.carica.forEach((function(e){0==e.codice.localeCompare(i.carica.codice)&&(e.href=i.carica.href,e.tipoAllegato=t.tipoFile)}))})))):(a.messages.add(m.a.getToast("generic",m.b.error,i.esito.split(":")[1])),console.error("Errore in Aggiornamento Dichiarazione Antimafia: "+i.esito.split(":")[1]+"\nErrorCode:"+i.esito.split(":")[0])))}),(function(i){a.messages.add(m.a.getToast("generic",m.b.error,i.error)),console.error(i)})))}},{key:"readByteFile",value:function(i){return new Promise((function(e,a){var t,n=new FileReader,o="Errore nell' estrapolare i byte dal file "+i.name;null==i||void 0===i?a(o):(n.readAsDataURL(i),n.onloadend=function(i){null==(t=n.result)?a(o):e(t.toString().split(",")[1])})}))}},{key:"openWindowsSelectFile",value:function(){this.file.nativeElement.click()}},{key:"hasAlreadyUpdateFile",value:function(){return void 0!==this.soggettoSelezionatoMenuAction&&void 0!==this.soggettoSelezionatoMenuAction.carica[0].href}},{key:"showWarnAlreadyUploadedFile",value:function(){this.messages.add(m.a.getToast("warn-already-uploadedFile",m.b.warn,m.a.FILE_ALREADY_UPLOADED))}},{key:"onRejectHasAlreadyUploadedFile",value:function(){this.messages.clear("warn-already-uploadedFile")}},{key:"onConfirmHasAlreadyUploadedFile",value:function(){this.messages.clear("warn-already-uploadedFile"),this.openWindowsSelectFile()}},{key:"onReject",value:function(){this.onRejectCheckDichiarazione()}},{key:"downloadPdfFamiliariConviventi",value:function(){var i=this;this.validazioniFamiliari(this.soggettoSelezionatoMenuAction)&&this.http.get(this._configuration.UrlGetAllFamConv,{responseType:"blob"}).subscribe((function(e){var a=i._configuration.UrlStampaPDF,t=i.soggettoSelezionatoMenuAction,n=i.blobToFile(e,"all3famconv.docx"),o={soggetto:t,dettaglioImpresa:i.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa,dataOdierna:i.datePipe.transform(Date.now(),"dd/MM/yyyy")},r=new FormData;return r.append("file",n,n.name),r.append("dati",JSON.stringify(o)),r.append("formatoStampa","PDF_A"),i.http.post(a,r,{responseType:"blob"}).subscribe((function(i){vi.saveAs(i,"Allegato 3-Familiari Conviventi_"+t.codiceFiscale+".pdf")}),(function(i){console.error("Errore nella creazione del file allegato famigliari:",i)}))}))}},{key:"salvaFamiliari",value:function(){this.validazioniFamiliari(this.soggettoSelezionato,!0)&&(this.soggettoChange.emit({data:this.soggettoSelezionato,aggiornaDichiarazione:!0}),this.manageSoggettoConFamiliareEsistente())}},{key:"validazioniFamiliari",value:function(i,e){var a=!0,t=[];i?t.push(i):t=this.listaSoggettiTable;var n=this.validator.validaFamiliariConviventiInserimentoCF(t);return n.esito===_.ERROR&&(this.messages.add(m.a.getToast("generic",m.b.error,n.messaggio)),a=!1),(n=this.validator.validaFamiliariConviventiGradoDiParentela(t)).esito===_.ERROR&&(this.messages.add(m.a.getToast("generic",m.b.error,n.messaggio)),a=!1),(n=this.validator.validaFamiliariConviventiCheckDichiarazione(t,e)).esito===_.ERROR&&(this.messages.add(m.a.getToast("generic",m.b.error,n.messaggio)),a=!1),a}}]),i}()).\u0275fac=function(i){return new(i||wi)(s.Nb(l),s.Nb(mi.a),s.Nb(f.a),s.Nb(u),s.Nb(x),s.Nb(S.d),s.Nb(S.a),s.Nb(Si.b),s.Nb(o.f),s.Nb(p.a))},wi.\u0275cmp=s.Hb({type:wi,selectors:[["app-familiari"]],viewQuery:function(i,e){var a;1&i&&(s.Jc(N,!0),s.Uc(Ai,!0)),2&i&&(s.Ac(a=s.cc())&&(e.stepComponent=a.first),s.Ac(a=s.cc())&&(e.file=a.first))},features:[s.Ab([S.a,o.f])],decls:18,vars:9,consts:[[1,"boxgrey","layout-actionmenu"],["position","top-center","key","generic",3,"baseZIndex"],["position","center","key","checkDichiarazione",3,"modal","baseZIndex","onClose"],["pTemplate","message"],["position","center","key","warn-already-uploadedFile",3,"modal","baseZIndex","onClose"],[1,"w-auto"],["href","./assets/pages/informativa-familiari/informativa-familiari.html","target","_blank"],["class","table-responsive","margin-top","30px",4,"ngIf","ngIfElse"],["class","contenitore_familiari",4,"ngIf"],[3,"next"],["noContent",""],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"],["margin-top","30px",1,"table-responsive"],[3,"columns","value","autoLayout","paginator","rows","responsive"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],["binary","true",3,"ngModel","ngModelChange","onChange"],["primeCheckBox",""],[3,"item","reset","click"],["actionMenu",""],["type","file","onclick","this.value = null","accept",".p7m, .pdf",1,"inputUploadFile",2,"display","none",3,"change"],["file",""],[1,"contenitore_familiari"],[1,"ui-g"],[1,"ui-g-9"],[2,"margin-bottom","0px"],[1,"ui-g-3","addfamiliari"],["pButton","","type","button","icon","ui-icon-add","title","Reply",1,"remove-btn",3,"click"],[4,"ngIf"],["class","ui-g",4,"ngFor","ngForOf"],[2,"text-align","right","margin-right","10px"],["appDebounceClick","","pButton","","label","SALVA",1,"white-btn",3,"debounceClick"],["binary","true","label","Dichiaro che NON ci sono famigliari conviventi per il soggetto",3,"ngModel","ngModelChange","onChange"],[1,"ui-g-12"],[1,"box-familiare"],[3,"toggleable","collapsed"],["familiarePanel",""],[1,"ui-g-1"],["src","assets/layout/images/cittadino.png",2,"width","80%"],[1,"ui-g-4","titlefamiliari"],["class","input-group mb-3",4,"ngIf"],[1,"ui-g-4","ui-fluid"],["placeholder","Seleziona una opzione",1,"dropdown",3,"options","ngModel","ngModelChange","onChange"],[1,"ui-g-2"],["pButton","","type","button","icon","ui-icon-close","title","Elimina",1,"remove-btn","blue-grey-btn",2,"margin-right","4px",3,"click"],[1,"ui-g-3"],[1,"input-group","mb-3"],["type","text","placeholder","Codice Fiscale","aria-label","Codice Fiscale","aria-describedby","basic-addon2",1,"form-control"],["inputCodiceFiscale",""],[1,"input-group-append"],["appDebounceClick","","pButton","","type","button",1,"btn","btn-outline-secondary",3,"debounceClick"],[1,"material-icons",2,"margin-top","7px"]],template:function(i,e){if(1&i&&(s.Tb(0,"div",0),s.Ob(1,"p-toast",1),s.Tb(2,"p-toast",2),s.bc("onClose",(function(){return e.onReject()})),s.Mc(3,Ci,11,2,"ng-template",3),s.Sb(),s.Tb(4,"p-toast",4),s.bc("onClose",(function(){return e.onReject()})),s.Mc(5,Ii,11,2,"ng-template",3),s.Sb(),s.Tb(6,"div"),s.Tb(7,"h3",5),s.Oc(8),s.Tb(9,"span"),s.Tb(10,"a",6),s.Oc(11," ? "),s.Sb(),s.Sb(),s.Sb(),s.Mc(12,Fi,5,6,"div",7),s.Ob(13,"br"),s.Mc(14,_i,13,4,"div",8),s.Sb(),s.Sb(),s.Tb(15,"app-step-action",9),s.bc("next",(function(){return e.conferma()})),s.Sb(),s.Mc(16,Mi,1,0,"ng-template",null,10,s.Nc)),2&i){var a=s.Bc(17);s.Bb(1),s.mc("baseZIndex",5e4),s.Bb(1),s.mc("modal",!0)("baseZIndex",5e3),s.Bb(2),s.mc("modal",!0)("baseZIndex",5e3),s.Bb(4),s.Qc("",e.textTitle," "),s.Bb(4),s.mc("ngIf",e.listaSoggettiTable.length>0)("ngIfElse",a),s.Bb(2),s.mc("ngIf",e.soggettoSelezionato)}},directives:[z.a,S.e,o.t,N,T.b,ii.q,o.s,ii.p,ii.o,L.a,U.s,U.v,zi.a,y.a,Ti.a,S.c,yi.a],pipes:[o.f],styles:[".inputUploadFile[_ngcontent-%COMP%]{width:80px!important}.right[_ngcontent-%COMP%]{float:right}.dropdown[_ngcontent-%COMP%]{color:green!important}.ui-widget-header[_ngcontent-%COMP%], body[_ngcontent-%COMP%]   .ui-widget-header[_ngcontent-%COMP%]{background-color:#fff!important}"]}),wi),Ui=a("/vOn"),Li=a("BkRI"),ji=a("bOdf"),Gi=["file"],Ki=["filePrivacy"];function Vi(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",10),s.Ob(1,"i",11),s.Tb(2,"h3"),s.Oc(3),s.Sb(),s.Tb(4,"p"),s.Oc(5),s.Sb(),s.Sb(),s.Tb(6,"div",12),s.Tb(7,"div",13),s.Tb(8,"button",14),s.bc("click",(function(){return s.Ec(a),s.fc().onConfirmHasAlreadyUploadedFile()})),s.Sb(),s.Sb(),s.Tb(9,"div",13),s.Tb(10,"button",15),s.bc("click",(function(){return s.Ec(a),s.fc().onRejectHasAlreadyUploadedFile()})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit;s.Bb(3),s.Pc(t.summary),s.Bb(2),s.Pc(t.detail)}}function Zi(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div"),s.Tb(1,"action-menu",18,19),s.bc("click",(function(){s.Ec(a);var i=s.Bc(2);return s.fc(2).onDropdownMenuOpen(i,!1)})),s.Sb(),s.Tb(3,"input",20,21),s.bc("change",(function(i){return s.Ec(a),s.fc(2).onFileChange(i,!1)})),s.Sb(),s.Sb()}if(2&i){var t=s.fc(2);s.Bb(1),s.mc("item",t.menuActionAllegatoAntimafia)("reset",t.reset)}}function Qi(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div"),s.Tb(1,"action-menu",18,22),s.bc("click",(function(){s.Ec(a);var i=s.Bc(2);return s.fc(2).onDropdownMenuOpen(i,!0)})),s.Sb(),s.Tb(3,"input",20,23),s.bc("change",(function(i){return s.Ec(a),s.fc(2).onFileChange(i,!0)})),s.Sb(),s.Sb()}if(2&i){var t=s.fc(2);s.Bb(1),s.mc("item",t.menuActionInformativaPrivacy)("reset",t.reset)}}function Hi(i,e){if(1&i&&(s.Tb(0,"tr"),s.Tb(1,"td"),s.Oc(2),s.Sb(),s.Tb(3,"td"),s.Oc(4),s.Sb(),s.Tb(5,"td"),s.Ob(6,"span",16),s.Sb(),s.Tb(7,"td"),s.Oc(8),s.Sb(),s.Tb(9,"td"),s.Mc(10,Zi,5,2,"div",17),s.Mc(11,Qi,5,2,"div",17),s.Sb(),s.Sb()),2&i){var a=e.$implicit,t=s.fc();s.Bb(2),s.Pc(t.colDato[a]),s.Bb(2),s.Pc(t.colTipologia[a]),s.Bb(2),s.mc("ngClass",t.colValidation[a]),s.Bb(2),s.Pc(t.colErrori[a]),s.Bb(2),s.mc("ngIf","verifica"===a),s.Bb(1),s.mc("ngIf","privacy"===a&&!t.isPrivacyOk)}}var $i,Wi=(($i=function(){function i(e,a,t,n,o,r,c,s,l,u,b,f){_classCallCheck(this,i),this.dichiarazioneAntimafiaService=e,this.antimafiaService=a,this._configuration=t,this.validator=n,this.http=o,this.route=r,this.datePipe=c,this.messages=s,this.loaderService=l,this.utentiservice=u,this.router=b,this.translate=f,this.statoValidazione={OK:"pi pi-check",ERROR:"ui-icon-error",WARNING:"pi pi-info-circle"},this.colDato={procedimenti:d.a.procedimenti,richiedente:d.a.anagraficaRichiedente,impresa:d.a.anagraficaImpresa,soggetti:d.a.soggettiCarica,aziende:d.a.aziendeCollegate,familiari:d.a.familiari,documentoFamiliari:d.a.dichiarazioneFamiliariConviventi,verifica:d.a.dichiarazioneAntimafia,privacy:d.a.documentoInformativaPrivacy},this.colTipologia={procedimenti:"",richiedente:d.a.datoCCIA,impresa:d.a.datoCCIA,soggetti:d.a.datoCCIA,aziende:d.a.datoCCIA,familiari:d.a.datoCCIA,documentoFamiliari:d.a.documentoFirmato,verifica:d.a.documentoFirmatoDigitalmente,privacy:d.a.documentoFirmatoDigitalmente},this.colValidation={procedimenti:this.statoValidazione.OK,richiedente:this.statoValidazione.OK,impresa:this.statoValidazione.OK,soggetti:this.statoValidazione.OK,aziende:this.statoValidazione.OK,familiari:this.statoValidazione.OK,documentoFamiliari:this.statoValidazione.OK,verifica:this.statoValidazione.OK,privacy:this.statoValidazione.ERROR},this.colErrori={procedimenti:"",richiedente:"",impresa:"",soggetti:"",aziende:"",familiari:"",documentoFamiliari:"",verifica:"",privacy:""},this.firmaPdf=!1,this.protocollaPdf=!1,this.labels=d.a,this.isProtocollaReady=!0,this.menuActionAllegatoAntimafia=new Array,this.menuActionInformativaPrivacy=new Array,this.hasUploadPrivacy=!1,this.blobToFile=function(i,e){var a=i;return a.lastModifiedDate=new Date,a.name=e,i}}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.loaderService.setTimeout(48e4),this.buildMenuActionAllegatoAntimafia(),this.buildMenuActionInformativaPrivacy();var e=this.route.snapshot.paramMap.get("idDichiarazione");this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(e).subscribe((function(e){i.dichiarazioneAntimafia=e,e.procedimenti=i.dichiarazioneAntimafiaService.getDichiarazioneAntimafia().procedimenti,m.a.isUndefinedOrNull(i.dichiarazioneAntimafiaService.getDichiarazioneAntimafia().procedimenti)||i.dichiarazioneAntimafiaService.getDichiarazioneAntimafia().procedimenti.forEach((function(e){i.translate.get("DICH_AMF."+e).subscribe((function(e){i.colTipologia.procedimenti=i.colTipologia.procedimenti?i.colTipologia.procedimenti+", "+e:e}))})),i.pdfFirmato=e.pdfFirmato,i.dichiarazioneAntimafiaService.setDichiarazioneAntimafia(e),i.validaPerVerifica(i.dichiarazioneAntimafia)})),this.urlUploadFirma=this._configuration.UrlUploadFirma,this.urlUploaProtocolla=this._configuration.UrlUploadProtocolla,this.steps=Object.keys(this.colDato)}},{key:"ngOnDestroy",value:function(){this.loaderService.resetTimeout()}},{key:"getDocumentazioneInformativaPrivacy",value:function(i){var e=this._configuration.ProtocollaPrivacyOggetto+" - "+i.nome+" "+i.cognome+" - "+i.codiceFiscale,a=this._configuration.tipologiaDocumentoProtocolloPrivacy,t={name:i.nome,surname:i.cognome,email:m.a.isUndefinedOrNull(i.indirizzoPEC)?null:i.indirizzoPEC,nationalIdentificationNumber:i.codiceFiscale,description:i.nome+" "+i.cognome+" - "+i.codiceFiscale};return JSON.stringify({mittente:t,allegati:null,documento:{content:null,mimeType:"application/pdf",name:"InformativaGeneralePrivacy.pdf"},oggetto:e,tipologiaDocumentoPrincipale:a})}},{key:"protocollaDomanda",value:function(){this.messages.add(m.a.getToast("warn-start-protocollazione",m.b.warn,m.a.WARNING_START_PROTOCOLLAZIONE))}},{key:"onRejectStartProtocollazione",value:function(){this.clearWarnStartProtocollazione()}},{key:"startProtocollazioneAsincrona",value:function(){var i=this;if(this.isProtocollaReady){this.clearWarnStartProtocollazione();var e=this.dichiarazioneAntimafia.datiDichiarazione.richiedente;m.a.isUndefinedOrNull(this.informativaPrivacyDocument)?this.antimafiaService.newProtocollaDichiarazioneAntimafiaAsync(this.dichiarazioneAntimafia.id.toString()).subscribe((function(e){console.log("RESPONSE: "+e.status),i.messages.add(m.a.getToast("tst-protocolla",m.b.success,i.translate.instant("DICH_AMF.protocollazioneInCarico")))}),(function(e){i.messages.add(m.a.getToast("tst",m.b.error,m.a.PROTOCOLLA_ANTIMAFIA_ERROR))})):this.antimafiaService.newProtocollaDichiarazioneAntimafiaAsync(this.dichiarazioneAntimafia.id.toString()).pipe(Object(ji.a)((function(a){return i.utentiservice.protocollaInformativaPrivacyDichiarazioneAntimafia(e.nome,e.cognome,e.codiceFiscale,i.getDocumentazioneInformativaPrivacy(e),i.informativaPrivacyDocument,null)}))).subscribe((function(e){i.messages.add(m.a.getToast("tst-protocolla",m.b.success,i.translate.instant("DICH_AMF.protocollazioneInCarico")))}),(function(e){i.messages.add(m.a.getToast("tst",m.b.error,m.a.PROTOCOLLA_ANTIMAFIA_ERROR))}))}}},{key:"checkInfoPrivacy",value:function(i){i.esito!==_.OK?(this.colErrori.privacy=i.messaggio,this.colValidation.privacy=this.statoValidazione.ERROR,this.isProtocollaReady=!1):(this.colErrori.privacy="",this.colValidation.privacy=this.statoValidazione.OK,this.verifyIfProtocollaIsReady())}},{key:"validaPerVerifica",value:function(i){var e=this,a={esito:_.OK};(a=this.validator.validaRichiedente(i.datiDichiarazione.richiedente)).esito!==_.OK&&(this.colErrori.richiedente=a.messaggio,this.colValidation.richiedente=this.statoValidazione.ERROR,this.isProtocollaReady=!1),(a=this.validator.validaImpresa(i.datiDichiarazione.dettaglioImpresa)).esito!==_.OK&&(this.colErrori.impresa=a.messaggio,this.colValidation.impresa=this.statoValidazione.ERROR,this.isProtocollaReady=!1),(a=this.validator.validaSoggettiCarica(i)).esito!==_.OK&&(this.colErrori.soggetti=a.messaggio,this.colValidation.soggetti=this.statoValidazione.ERROR,this.isProtocollaReady=!1),(a=this.validator.validaFamiliariConviventiAllegati(i.datiDichiarazione.dettaglioImpresa.soggettiImpresa)).esito!==_.OK&&(this.colErrori.documentoFamiliari=a.messaggio,this.colValidation.documentoFamiliari=this.statoValidazione.ERROR,this.isProtocollaReady=!1),(a=this.validator.validaFamiliariConviventiCheckDichiarazione(i.datiDichiarazione.dettaglioImpresa.soggettiImpresa)).esito!==_.OK&&(this.colErrori.familiari=a.messaggio,this.colValidation.familiari=this.statoValidazione.ERROR,this.isProtocollaReady=!1),(a=this.validator.validaAziendeCollegate(i.datiDichiarazione.dettaglioImpresa.aziendeCollegate)).esito!==_.OK&&(this.colErrori.aziende=a.messaggio,this.colValidation.aziende=this.statoValidazione.ERROR,this.isProtocollaReady=!1),(a=this.validator.validaVerificaDichiarazioneAllegata(this.dichiarazioneAntimafia.dtUploadPdfFirmato)).esito!==_.OK&&(this.colErrori.verifica=a.messaggio,this.colValidation.verifica=this.statoValidazione.ERROR,this.isProtocollaReady=!1),this.utentiservice.ricercaPersone({codiceFiscale:i.datiDichiarazione.richiedente.codiceFiscale}).subscribe((function(t){a=e.validator.validaVerificaInformativaPrivacy(null==t?[]:t,i.datiDichiarazione.richiedente.codiceFiscale),e.checkInfoPrivacy(a),!m.a.isUndefinedOrNull(t)&&t.length>0&&(e.persona=t[0])}),(function(i){console.error("Errore in ricercaPersone: "+i),e.colErrori.privacy=i.message,e.colValidation.privacy=e.statoValidazione.ERROR,e.isProtocollaReady=!1}))}},{key:"downloadInformativaPrivacy",value:function(){this.http.get(this._configuration.UrlGetInfoPrivacy,{responseType:"blob"}).subscribe((function(i){vi.saveAs(i,"informativa_privacy.pdf")}))}},{key:"sentenceCase",value:function(i,e){return i=null==i?"":i,e&&(i=i.toLowerCase()),i.toString().replace(/(^|\. *)([a-z])/g,(function(i,e,a){return i.toUpperCase()}))}},{key:"fixOggettoSociale",value:function(i){return(i=null==i?"":i).toUpperCase()}},{key:"downloadCertificazioneAntimafia",value:function(){var i=this,e=Q.isImpresaDittaIndividuale(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.formaGiuridicaCodice);this.http.get(e?this._configuration.UrlGetDichiarazioneAntimafiaDI:this._configuration.UrlGetDichiarazioneAntimafiaPG,{responseType:"blob"}).subscribe((function(a){var t=i._configuration.UrlStampaPDF,n=i.blobToFile(a,"all3famconv.docx"),o=e?i.getCaricheImportanti():i.getSoggettiSelezionati(),r=Li(i.dichiarazioneAntimafia),c=i.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.oggettoSociale;i.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.oggettoSociale=i.fixOggettoSociale(i.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.oggettoSociale);var s=i.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.aziendeCollegate?i.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.aziendeCollegate.filter((function(i){return!0===i.selezionato})):[];r.datiDichiarazione.dettaglioImpresa.aziendeCollegate=s;var l={dichiarazioneAntimafia:r,soggettiConCarica:o,dataOdierna:i.datePipe.transform(Date.now(),"dd/MM/yyyy")},d=new FormData;return d.append("file",n,n.name),d.append("dati",JSON.stringify(l)),d.append("formatoStampa","PDF_A"),i.http.post(t,d,{responseType:"blob"}).subscribe((function(e){i.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.oggettoSociale=c,vi.saveAs(e,"DichiarazioneAntimafia_"+i.dichiarazioneAntimafia.id+".pdf")}),(function(i){console.error("Errore nella creazione della dichiarazione antimafia:",i)}))}))}},{key:"getCaricheImportanti",value:function(){var i=this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.soggettiImpresa.map((function(i){return Object.assign({},i)}));return JSON.parse(JSON.stringify(i)).filter((function(i){return i.carica=i.carica.filter((function(i){return i.codice.match("DT")}))})).filter((function(i){return!!i.carica&&0!==i.carica.length}))}},{key:"getSoggettiSelezionati",value:function(){var i=this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.soggettiImpresa.map((function(i){return Object.assign({},i)}));return JSON.parse(JSON.stringify(i)).filter((function(i){return i.carica=i.carica.filter((function(i){return i.selezionato}))})).filter((function(i){return!!i.carica&&0!==i.carica.length}))}},{key:"onDropdownMenuOpen",value:function(i,e){var a=this;this.hasAlreadyUpdateFile()&&!e&&(i.badgeStylezed=!1,i.item[0].items[1].disabled=!0,null!=this.dichiarazioneAntimafia&&(i.badgeStylezed=null!=this.dichiarazioneAntimafia.dtUploadPdfFirmato,i.item[0].items[1].disabled=!1,i.badgeData={file:this.dichiarazioneAntimafia.pdfFirmato,fileName:"DomandaCertificazioneAntimafia_"+this.dichiarazioneAntimafia.id+"."+(null==this.dichiarazioneAntimafia.tipoPdfFirmato?"pdf":this.dichiarazioneAntimafia.tipoPdfFirmato)})),e&&(i.badgeStylezed=this.hasUploadPrivacy,this.readByteFile(this.informativaPrivacyDocument).then((function(e){i.badgeData={file:e,fileName:"InformativaPrivacyDocument_"+a.informativaPrivacyDocument.name}})))}},{key:"onFileChange",value:function(i,e){if(i.target.files&&i.target.files.length>0){var a=i.target.files[0],t=this.validator.validaAllegatoType(a,!0),n=this.validator.validaAllegatoSize(a);t.esito==_.OK?n.esito==_.OK?e?this.uploadInfoPrivacy(a):this.converterByteBase64(a):this.messages.add(m.a.getToast("tst",m.b.error,n.messaggio)):this.messages.add(m.a.getToast("tst",m.b.error,t.messaggio))}}},{key:"uploadFile",value:function(){this.hasAlreadyUpdateFile()?this.showWarnAlreadyUploadedFile():this.openWindowsSelectFile()}},{key:"converterByteBase64",value:function(i){var e=this,a=this.dichiarazioneAntimafia.pdfFirmato;this.readByteFile(i).then((function(t){e.dichiarazioneAntimafia.pdfFirmato=t,e.dichiarazioneAntimafia.tipoPdfFirmato=i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDFP7M)?"pdf.p7m":i.name.endsWith(m.a.UPLOAD_FILE_TYPE_PDF)?"pdf":null,e.dichiarazioneAntimafia.pdfFirmatoName=i.name,e.antimafiaService.aggiornaDichiarazioneAntimafia(e.dichiarazioneAntimafia).subscribe((function(i){m.a.isUndefinedOrNull(i.esito)?(e.messages.add(m.a.getToast("tst",m.b.success,m.a.OPERAZIONE_OK)),e.colErrori.verifica="",e.colValidation.verifica=e.statoValidazione.OK,e.dichiarazioneAntimafia.dtUploadPdfFirmato=i.dichiarazione.dtUploadPdfFirmato,e.pdfFirmato=i.pdfFirmato,e.verifyIfProtocollaIsReady()):(e.messages.add(m.a.getToast("tst",m.b.error,i.esito.split(":")[1])),console.error("Errore in Aggiornamento Dichiarazione Antimafia: "+i.esito.split(":")[1]+"\nErrorCode:"+i.esito.split(":")[0]))}),(function(i){console.error(i),e.dichiarazioneAntimafia.pdfFirmato=a,e.messages.add(m.a.getToast("tst",m.b.error,i.error))}))}),(function(i){console.error(i),e.dichiarazioneAntimafia.pdfFirmato=a}))}},{key:"readByteFile",value:function(i){return new Promise((function(e,a){var t=new FileReader;m.a.isUndefinedOrNull(i)&&a("Errore nell' estrapolare i byte dal file");var n,o="Errore nell' estrapolare i byte dal file "+i.name;m.a.isUndefinedOrNull(i)?a(o):(t.readAsDataURL(i),t.onloadend=function(i){null==(n=t.result)?a(o):e(n.toString().split(",")[1])})}))}},{key:"openWindowsSelectFile",value:function(){this.file.nativeElement.click()}},{key:"hasAlreadyUpdateFile",value:function(){return!m.a.isUndefinedOrNull(this.dichiarazioneAntimafia.dtUploadPdfFirmato)}},{key:"showWarnAlreadyUploadedFile",value:function(){this.messages.add(m.a.getToast("warn-already-uploadedFile",m.b.warn,m.a.FILE_ALREADY_UPLOADED))}},{key:"onRejectHasAlreadyUploadedFile",value:function(){this.messages.clear("warn-already-uploadedFile")}},{key:"onConfirmHasAlreadyUploadedFile",value:function(){this.messages.clear("warn-already-uploadedFile"),this.hasUploadPrivacy?this.filePrivacy.nativeElement.click():this.openWindowsSelectFile()}},{key:"buildMenuActionAllegatoAntimafia",value:function(){var i=this;this.menuActionAllegatoAntimafia=[{label:d.a.azioni.toUpperCase(),items:[{label:d.a.CARICA_MODELLO,check:"true",badgeStyle:"file-uploaded-ok",command:function(){i.uploadFile()}},{separator:!0},{label:d.a.SCARICA_MODELLO,command:function(){i.downloadCertificazioneAntimafia()}}]}]}},{key:"buildMenuActionInformativaPrivacy",value:function(){var i=this;this.menuActionInformativaPrivacy=[{label:d.a.azioni.toUpperCase(),items:[{label:d.a.CARICA_MODELLO,check:"true",badgeStyle:"file-uploaded-ok",command:function(){i.openInfoPrivacy()}},{separator:!0},{label:d.a.SCARICA_MODELLO,command:function(){i.downloadInformativaPrivacy()}}]}]}},{key:"openInfoPrivacy",value:function(){this.hasUploadPrivacy?this.showWarnAlreadyUploadedFile():this.filePrivacy.nativeElement.click()}},{key:"openWindowSelectFilePrivacy",value:function(){this.hasUploadPrivacy?this.showWarnAlreadyUploadedFile():this.openInfoPrivacy()}},{key:"uploadInfoPrivacy",value:function(i){var e=this;this.antimafiaService.verificaFirma(i).subscribe((function(a){if(0!==a.warningFault.length){var t=a.warningFault[0];e.messages.add(m.a.getToast("tst",m.b.error,t.errorMsg)),e.checkInfoPrivacy({esito:_.ERROR,messaggio:m.a.INFORMATIVA_PRIVACY_ASSENTE(e.dichiarazioneAntimafia.datiDichiarazione.richiedente.codiceFiscale)}),console.error("Errore in Verifica Dichiarazione Antimafia per info privacy: "+t.errorMsg+"\nErrorCode:"+t.errorCode)}else e.messages.add(m.a.getToast("tst",m.b.success,m.a.OPERAZIONE_OK)),e.checkInfoPrivacy({esito:_.OK}),e.hasUploadPrivacy=!0,e.informativaPrivacyDocument=i}))}},{key:"verifyIfProtocollaIsReady",value:function(){var i=this;Object.values(this.colValidation).some((function(e){return e===i.statoValidazione.ERROR}))||(this.isProtocollaReady=!0)}},{key:"onCloseMessageProtocolla",value:function(){this.router.navigate(["./"],{relativeTo:this.route.parent.parent})}},{key:"clearWarnStartProtocollazione",value:function(){this.messages.clear("warn-start-protocollazione")}}]),i}()).\u0275fac=function(i){return new(i||$i)(s.Nb(l),s.Nb(f.a),s.Nb(mi.a),s.Nb(x),s.Nb(Si.b),s.Nb(r.a),s.Nb(o.f),s.Nb(S.d),s.Nb(p.a),s.Nb(Ui.a),s.Nb(r.e),s.Nb(j.e))},$i.\u0275cmp=s.Hb({type:$i,selectors:[["app-verifica"]],viewQuery:function(i,e){var a;1&i&&(s.Uc(Gi,!0),s.Uc(Ki,!0)),2&i&&(s.Ac(a=s.cc())&&(e.file=a.first),s.Ac(a=s.cc())&&(e.filePrivacy=a.first))},features:[s.Ab([o.f])],decls:24,vars:11,consts:[[1,"boxgrey","layout-actionmenu"],["position","top-center","key","tst",3,"baseZIndex"],["position","top-center","key","tst-protocolla","modal","true",3,"baseZIndex","onClose"],["position","center","key","warn-already-uploadedFile","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[1,"table","table-bordered","table-hoover"],[1,"thead-light"],[4,"ngFor","ngForOf"],[1,"next-button"],[3,"isProtocollaReady","next"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"],[3,"ngClass"],[4,"ngIf"],[3,"item","reset","click"],["actionMenu",""],["type","file","onclick","this.value = null","accept",".p7m, .pdf",1,"inputUploadFile",2,"display","none",3,"change"],["file",""],["actionMenuPrivacy",""],["filePrivacy",""]],template:function(i,e){1&i&&(s.Tb(0,"div",0),s.Tb(1,"h3"),s.Oc(2," Elenco dei dati richiesti per la certificazione antimafia "),s.Sb(),s.Ob(3,"p-toast",1),s.Tb(4,"p-toast",2),s.bc("onClose",(function(){return e.onCloseMessageProtocolla()})),s.Sb(),s.Tb(5,"p-toast",3),s.bc("onClose",(function(){return e.onRejectHasAlreadyUploadedFile()})),s.Mc(6,Vi,11,2,"ng-template",4),s.Sb(),s.Tb(7,"table",5),s.Tb(8,"thead",6),s.Tb(9,"tr"),s.Tb(10,"th"),s.Oc(11),s.Sb(),s.Tb(12,"th"),s.Oc(13),s.Sb(),s.Tb(14,"th"),s.Oc(15),s.Sb(),s.Tb(16,"th"),s.Oc(17),s.Sb(),s.Tb(18,"th"),s.Oc(19),s.Sb(),s.Sb(),s.Sb(),s.Tb(20,"tbody"),s.Mc(21,Hi,12,6,"tr",7),s.Sb(),s.Sb(),s.Sb(),s.Tb(22,"div",8),s.Tb(23,"app-step-action",9),s.bc("next",(function(){return e.startProtocollazioneAsincrona()})),s.Sb(),s.Sb()),2&i&&(s.Bb(3),s.mc("baseZIndex",5e4),s.Bb(1),s.mc("baseZIndex",5e4),s.Bb(1),s.mc("modal",!0)("baseZIndex",5e3),s.Bb(6),s.Pc(e.labels.dato),s.Bb(2),s.Pc(e.labels.tipologia),s.Bb(2),s.Pc(e.labels.stato),s.Bb(2),s.Pc(e.labels.errori),s.Bb(2),s.Pc(e.labels.azioni),s.Bb(2),s.mc("ngForOf",e.steps),s.Bb(2),s.mc("isProtocollaReady",e.isProtocollaReady))},directives:[z.a,S.e,o.s,N,T.b,o.q,o.t,zi.a],styles:[""]}),$i);function Ji(i,e){1&i&&s.Ob(0,"app-procedimenti")}function Yi(i,e){1&i&&s.Ob(0,"app-richiedente")}function qi(i,e){1&i&&s.Ob(0,"app-impresa")}function Xi(i,e){1&i&&s.Ob(0,"app-soggetti")}function ie(i,e){1&i&&s.Ob(0,"app-aziende")}function ee(i,e){1&i&&s.Ob(0,"app-familiari")}function ae(i,e){1&i&&s.Ob(0,"app-verifica")}var te,ne=((te=function(){function i(e,a,t){_classCallCheck(this,i),this.dichiarazioneAntimafiaService=e,this.route=a,this.stepEvent=t}return _createClass(i,[{key:"ngOnInit",value:function(){this.dichiarazioneAntimafiaService.setDichiarazioneAntimafia(this.route.snapshot.data.dichiarazione),this.stepsAntimafia=[{label:d.a.procedimenti},{label:d.a.anagraficaRichiedente},{label:d.a.anagraficaImpresa},{label:d.a.soggettiCarica},{label:d.a.aziendeCollegate},{label:d.a.familiari},{label:d.a.verifica}],this.stepEvent.stepIndex=0,this.textTitle=d.a.richiestaCertificazione}}]),i}()).\u0275fac=function(i){return new(i||te)(s.Nb(l),s.Nb(r.a),s.Nb(u))},te.\u0275cmp=s.Hb({type:te,selectors:[["app-dichiarazione-antimafia"]],decls:17,vars:10,consts:[[1,"ui-grid-fixed"],[1,"richiesta-title"],[1,"ui-g"],[3,"model","activeIndex"],["stepModule",""],[1,"greybox"],[4,"ngIf"],[2,"margin-bottom","10px"]],template:function(i,e){if(1&i&&(s.Ob(0,"br"),s.Ob(1,"br"),s.Tb(2,"div",0),s.Tb(3,"h2",1),s.Oc(4),s.Sb(),s.Tb(5,"div",2),s.Ob(6,"p-steps",3,4),s.Sb(),s.Tb(8,"div",5),s.Mc(9,Ji,1,0,"app-procedimenti",6),s.Mc(10,Yi,1,0,"app-richiedente",6),s.Mc(11,qi,1,0,"app-impresa",6),s.Mc(12,Xi,1,0,"app-soggetti",6),s.Mc(13,ie,1,0,"app-aziende",6),s.Mc(14,ee,1,0,"app-familiari",6),s.Mc(15,ae,1,0,"app-verifica",6),s.Sb(),s.Ob(16,"div",7),s.Sb()),2&i){var a=s.Bc(7);s.Bb(4),s.Qc(" ",e.textTitle," "),s.Bb(2),s.mc("model",e.stepsAntimafia)("activeIndex",e.stepEvent.stepIndex),s.Bb(3),s.mc("ngIf",0==a.activeIndex),s.Bb(1),s.mc("ngIf",1==a.activeIndex),s.Bb(1),s.mc("ngIf",2==a.activeIndex),s.Bb(1),s.mc("ngIf",3==a.activeIndex),s.Bb(1),s.mc("ngIf",4==a.activeIndex),s.Bb(1),s.mc("ngIf",5==a.activeIndex),s.Bb(1),s.mc("ngIf",6==a.activeIndex)}},directives:[b.a,o.t,K,H,X,ci,gi,xi,Wi],styles:[".ui-steps-item,.ui-steps .ui-steps-item{width:unset}"],encapsulation:2}),te),oe=a("0Dnl"),re=a("d/lR");function ce(i,e){if(1&i&&(s.Tb(0,"tr"),s.Tb(1,"td"),s.Oc(2),s.Sb(),s.Tb(3,"td"),s.Oc(4),s.Sb(),s.Tb(5,"td"),s.Tb(6,"a",4),s.Oc(7,"Apri"),s.Sb(),s.Sb(),s.Sb()),2&i){var a=e.$implicit;s.Bb(2),s.Pc(a.id),s.Bb(2),s.Pc(a.stato.identificativo),s.Bb(2),s.nc("routerLink",a.id)}}function se(i,e){if(1&i&&(s.Tb(0,"div"),s.Ob(1,"app-upload",5),s.Sb()),2&i){var a=s.fc();s.Bb(1),s.mc("id",a.dichiarazioneId)("title","Carica File Firmato "+a.dichiarazioneId)("serviceUrl",a.urlUploadFirma)("maxSize","-1")("fileExt",".PDF")}}function le(i,e){if(1&i&&(s.Tb(0,"div"),s.Ob(1,"app-upload",5),s.Sb()),2&i){var a=s.fc();s.Bb(1),s.mc("id",a.dichiarazioneId)("title","Carica File da Procollare "+a.dichiarazioneId)("serviceUrl",a.urlUploadFirma)("maxSize","-1")("fileExt",".PDF")}}var de,ue,be=((de=function(){function i(e,a,t,n,o,r){_classCallCheck(this,i),this.route=e,this.router=a,this.dichiarazioneAntimafiaService=t,this.antimafiaService=n,this._configuration=o,this.fascicoloCorrente=r,this.firmaPdf=!1,this.protocollaPdf=!1,this.newDichiarazione=new s.n}return _createClass(i,[{key:"ngOnInit",value:function(){}},{key:"nuovaDichiarazione",value:function(){this.newDichiarazione.emit()}}]),i}()).\u0275fac=function(i){return new(i||de)(s.Nb(r.a),s.Nb(r.e),s.Nb(l),s.Nb(f.a),s.Nb(mi.a),s.Nb(oe.a))},de.\u0275cmp=s.Hb({type:de,selectors:[["app-sintesi-antimafia-list"]],inputs:{dichiarazioniAntimafia:"dichiarazioniAntimafia"},outputs:{newDichiarazione:"newDichiarazione"},decls:20,vars:12,consts:[[1,"button",3,"click"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"],[4,"ngIf"],[3,"routerLink"],[3,"id","title","serviceUrl","maxSize","fileExt"]],template:function(i,e){1&i&&(s.Tb(0,"div"),s.Tb(1,"button",0),s.bc("click",(function(){return e.nuovaDichiarazione()})),s.Oc(2,"Nuova"),s.Sb(),s.Sb(),s.Tb(3,"div"),s.Tb(4,"table",1),s.Tb(5,"thead"),s.Tb(6,"tr"),s.Tb(7,"td"),s.Oc(8),s.gc(9,"translate"),s.Sb(),s.Tb(10,"td"),s.Oc(11),s.gc(12,"translate"),s.Sb(),s.Tb(13,"td"),s.Oc(14),s.gc(15,"translate"),s.Sb(),s.Sb(),s.Sb(),s.Tb(16,"tbody"),s.Mc(17,ce,8,3,"tr",2),s.Sb(),s.Sb(),s.Sb(),s.Mc(18,se,2,5,"div",3),s.Mc(19,le,2,5,"div",3)),2&i&&(s.Bb(8),s.Pc(s.hc(9,6,"ANTIMAFIA.idDichiarazione")),s.Bb(3),s.Pc(s.hc(12,8,"ANTIMAFIA.stato")),s.Bb(3),s.Pc(s.hc(15,10,"ANTIMAFIA.action")),s.Bb(3),s.mc("ngForOf",e.dichiarazioniAntimafia),s.Bb(1),s.mc("ngIf",e.firmaPdf&&e.dichiarazioneId),s.Bb(1),s.mc("ngIf",e.protocollaPdf&&e.dichiarazioneId))},directives:[o.s,o.t,r.h,re.a],pipes:[j.d],styles:[""]}),de),fe=a("R69K"),he=((ue=function(){function i(e){_classCallCheck(this,i),this.antimafiaService=e}return _createClass(i,[{key:"resolve",value:function(i){return console.log("Carica antimafia da db "+i.paramMap.get("idDichiarazione")),this.antimafiaService.getDichiarazioneAntimafia(i.paramMap.get("idDichiarazione"))}}]),i}()).\u0275fac=function(i){return new(i||ue)(s.Xb(f.a))},ue.\u0275prov=s.Jb({token:ue,factory:ue.\u0275fac}),ue),ge=a("N00r"),me=a("EY2u"),pe=a("HDdC"),ve=a("D0XW"),Se=a("Y7HM");function ze(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ve.a;return(!Object(Se.a)(i)||i<0)&&(i=0),e&&"function"==typeof e.schedule||(e=ve.a),new pe.a((function(a){return a.add(e.schedule(Te,i,{subscriber:a,counter:0,period:i})),a}))}function Te(i){var e=i.subscriber,a=i.counter,t=i.period;e.next(a),this.schedule({subscriber:e,counter:a+1,period:t},t)}var ye=a("QLoi"),Ae=a("7D9o"),Ce=a("qXBG"),Ie=a("zLRh"),Oe=function i(){_classCallCheck(this,i)},De=a("JIr8"),Pe=a("jLKh"),Ee=a("GyhO");function Fe(i,e){if(1&i&&(s.Tb(0,"option",13),s.Oc(1),s.Sb()),2&i){var a=e.$implicit;s.mc("value",a.codiceFiscale),s.Bb(1),s.Qc(" ",a.dati," ")}}function Re(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div"),s.Tb(1,"div",6),s.Tb(2,"label",7),s.Oc(3),s.gc(4,"translate"),s.Sb(),s.Sb(),s.Tb(5,"div",8),s.Tb(6,"select",9),s.bc("ngModelChange",(function(i){return s.Ec(a),s.fc().selectedCUAADD=i})),s.Mc(7,Fe,2,2,"option",10),s.Sb(),s.Sb(),s.Tb(8,"div",11),s.Tb(9,"button",12),s.bc("debounceClick",(function(){return s.Ec(a),s.fc().Save()})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=s.fc();s.Bb(3),s.Qc(" ",s.hc(4,3,"ANTIMAFIA.codiceFiscaleRichiedente")," "),s.Bb(3),s.mc("ngModel",t.selectedCUAADD),s.Bb(1),s.mc("ngForOf",t.rappresentantiLegali)}}var ke,Be=((ke=function(){function i(e,a,t,n,o,r){_classCallCheck(this,i),this.http=e,this._configuration=a,this.antimafiaService=t,this.messages=n,this.loader=o,this.authService=r,this.codiciCaricheRappresentanteLegale=["ACR","ADP","AMD","AMG","AMM","AMP","AMS","APR","ART","ATI","AUN","AUP","CDP","CDT","CLR","CM","CMS","COA","COD","COG","COL","COM","COP","COV","COZ","CRT","CST","CUE","CUF","CUM","IN","LER","LGR","LGT","LI","LIG","LR2","LRF","LRT","LSA","MPP","OAS","OPN","PAD","PCA","PCD","PCE","PCG","PCO","PDC","PDI","PED","PEO","PG","PGD","PGE","PGS","PM","PPP","PRE","PRP","PRQ","PSE","PSS","PTE","RAF","RAP","RAS","RES","RFM","RIN","RIT","RSS","SAO","SAP","SCR","SFC","SLR","SOA","SOL","SOR","SOT","SOU","SPR","TI","TI2","TIT","TTE","TU","UM1","VPC"],this.selectedCuaa=new s.n,this.personeGiuridicheSede=[],this.callsPersonaGiuridica=[]}return _createClass(i,[{key:"ngOnInit",value:function(){console.log("ngOnInit cuaaImpresa "+this.cuaaImpresa),this.cuaaImpresa&&0!=this.cuaaImpresa.length&&(this.loader.setTimeout(48e4),this.utenteConnesso=this.authService.getUser().codiceFiscale,this.caricaRappresentantiLegali())}},{key:"ngOnDestroy",value:function(){this.loader.resetTimeout()}},{key:"getDettaglioCompletoImpresa",value:function(i){var e=this,a=this._configuration.UrlGetAnagraficaImpresa.replace("${cuaa}",String(i));return this.http.get(a).pipe(Object(v.a)((function(a){if(console.log("getDettaglioCompletoImpresa cuaa : "+i),"OK"===a.header.esito){var t=encodeURIComponent(JSON.stringify({numeroREASede:a.dati.listaimprese.estremiimpresa[0].datiiscrizionerea[0].nrea,provinciaSede:a.dati.listaimprese.estremiimpresa[0].datiiscrizionerea[0].cciaa})),n=e._configuration.UrlGetDettaglioCompletoImpresa+t;return console.log("getDettaglioCompletoImpresa paramsIn : "+t),e.antimafiaService.rappresentatiLegali(n)}if("NESSUNA IMPRESA TROVATA"!==a.dati.errore.msgerr)return e.messages.add(m.a.getToast("tst",m.b.error,a.dati.errore.msgerr)),me.a;e.messages.add(m.a.getToast("tst",m.b.error,"Nessuna impresa trovata presso la Camera di Commercio"))})))}},{key:"caricaRappresentantiLegali",value:function(){var i=this;this.getDettaglioCompletoImpresa(this.cuaaImpresa).subscribe((function(e){i.rappresentantiLegali=[],i.personeSede=e.dati.datiimpresa.personesede.persona;var a,t=_createForOfIteratorHelper(e.dati.datiimpresa.personesede.persona);try{var n=function(){var e=a.value;e.cariche.carica.forEach((function(a){-1!==i.codiciCaricheRappresentanteLegale.indexOf(a.ccarica)&&(e.personafisica&&i.rappresentantiLegali.push(new Pe.a(e.personafisica.codicefiscale,e.personafisica.nome+" "+e.personafisica.cognome+" - "+a.descrizione)),e.personagiuridica&&i.callsPersonaGiuridica.push(i.getDettaglioCompletoImpresa(e.personagiuridica.codicefiscale)))}))};for(t.s();!(a=t.n()).done;)n()}catch(r){t.e(r)}finally{t.f()}if(i.rappresentantiLegali&&i.rappresentantiLegali[0]){var o=i.rappresentantiLegali.find((function(e){return e.codiceFiscale===i.utenteConnesso}));i.selectedCUAADD=o?o.codiceFiscale:i.rappresentantiLegali[0].codiceFiscale}}),(function(e){console.log("Error",e),i.messages.add(m.a.getToast("generic",m.b.error,"Errore in recupero rappresentanti: "+e.error.message))}),(function(){Object(Ee.a).apply(void 0,_toConsumableArray(i.callsPersonaGiuridica)).subscribe({next:function(e){var a,t=_createForOfIteratorHelper(e.dati.datiimpresa.personesede.persona);try{for(t.s();!(a=t.n()).done;){var n,o=a.value,r=_createForOfIteratorHelper(o.cariche.carica);try{for(r.s();!(n=r.n()).done;){var c=n.value;-1!==i.codiciCaricheRappresentanteLegale.indexOf(c.ccarica)&&o.personafisica&&(console.log("personagiuridica push: "+o.personafisica.codicefiscale),i.rappresentantiLegali.push(new Pe.a(o.personafisica.codicefiscale,o.personafisica.nome+" "+o.personafisica.cognome+" - "+c.descrizione)))}}catch(s){r.e(s)}finally{r.f()}}}catch(s){t.e(s)}finally{t.f()}}})}))}},{key:"Save",value:function(){this.selectedCUAADD&&(console.log("emit "+this.selectedCUAADD),this.selectedCuaa.emit(this.selectedCUAADD))}}]),i}()).\u0275fac=function(i){return new(i||ke)(s.Nb(Si.b),s.Nb(mi.a),s.Nb(f.a),s.Nb(S.d),s.Nb(p.a),s.Nb(Ce.a))},ke.\u0275cmp=s.Hb({type:ke,selectors:[["app-select-richiedente"]],inputs:{cuaaImpresa:"cuaaImpresa"},outputs:{selectedCuaa:"selectedCuaa"},decls:10,vars:5,consts:[["position","top-center","key","generic",3,"baseZIndex"],[1,"ui-grid-fixed"],[1,"richiesta-title"],[1,"ui-g"],[1,"boxgrey"],[4,"ngIf"],[1,"ui-g-12","ui-md-2"],["id","basic-addon1",2,"margin-top","10px"],[1,"ui-g-12","ui-md-8"],["name","selectCUAA",1,"custom-select",2,"height","47px",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"ui-g-12","ui-md-2","searchbutton"],["appDebounceClick","","pButton","","label","Crea Domanda",2,"width","100%",3,"debounceClick"],[3,"value"]],template:function(i,e){1&i&&(s.Ob(0,"p-toast",0),s.Ob(1,"br"),s.Ob(2,"br"),s.Tb(3,"div",1),s.Tb(4,"h2",2),s.Oc(5),s.gc(6,"translate"),s.Sb(),s.Tb(7,"div",3),s.Tb(8,"div",4),s.Mc(9,Re,10,5,"div",5),s.Sb(),s.Sb(),s.Sb()),2&i&&(s.mc("baseZIndex",5e4),s.Bb(5),s.Pc(s.hc(6,3,"ANTIMAFIA.richiestaCerificazioneAntimafia")),s.Bb(4),s.mc("ngIf",e.rappresentantiLegali))},directives:[z.a,o.t,U.E,U.s,U.v,o.s,y.a,T.b,U.x,U.H],pipes:[j.d],styles:[""]}),ke);function Ne(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div"),s.Tb(1,"app-select-richiedente",5),s.bc("selectedCuaa",(function(i){return s.Ec(a),s.fc().selected(i)})),s.Sb(),s.Sb()}if(2&i){var t=s.fc();s.Bb(1),s.mc("cuaaImpresa",t.cuaaImpresa)}}function _e(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div"),s.Tb(1,"app-sintesi-antimafia-list",6),s.bc("newDichiarazione",(function(){return s.Ec(a),s.fc().rerouteAntimafia()})),s.Sb(),s.Sb()}if(2&i){var t=s.fc();s.Bb(1),s.mc("dichiarazioniAntimafia",t.listaDichiarazioni)}}function Me(i,e){if(1&i){var a=s.Ub();s.Tb(0,"div",7),s.Ob(1,"i",8),s.Tb(2,"h3"),s.Oc(3),s.Sb(),s.Tb(4,"p"),s.Oc(5),s.Sb(),s.Sb(),s.Tb(6,"div",9),s.Tb(7,"div",10),s.Tb(8,"button",11),s.bc("click",(function(){return s.Ec(a),s.fc().onConfirmUpdateAndCreateNew()})),s.Sb(),s.Sb(),s.Tb(9,"div",10),s.Tb(10,"button",12),s.bc("click",(function(){return s.Ec(a),s.fc().onRejectUpdateAndCreateNew()})),s.Sb(),s.Sb(),s.Sb()}if(2&i){var t=e.$implicit;s.Bb(3),s.Pc(t.summary),s.Bb(2),s.Pc(t.detail)}}var we,xe,Ue,Le=function(){return{marginTop:"70px"}},je=[{path:"",component:(we=function(){function i(e,a,t,n,o,r,c,s,l,d,u,b){_classCallCheck(this,i),this.route=e,this.router=a,this.dichiarazioneAntimafiaService=t,this.antimafiaService=n,this.fascicoloCorrente=o,this.messageService=r,this.authservice=c,this.homeservice=s,this.istruttoriaAntimafiaService=l,this.loader=d,this.fascicoloService=u,this.errorService=b,this.showLista=!1}return _createClass(i,[{key:"ngOnInit",value:function(){this.getDichiarazioniAntimafia(),this.loader.setTimeout(9e5)}},{key:"getDichiarazioniAntimafia",value:function(){var i=this;if(null==this.fascicoloCorrente||null==this.fascicoloCorrente.fascicoloLegacy||null==this.fascicoloCorrente.fascicoloLegacy.cuaa)this.getFascicoloAgsByCuaaSub=this.route.params.pipe(Object(v.a)((function(e){return i.fascicoloService.getLegacy(e.idFascicolo)})),Object(De.a)((function(e){return i.errorService.showError(e),me.a})),Object(v.a)((function(e){i.fascicoloCorrente.fascicoloLegacy=e;var a=new c.a;return a.azienda=new g.a,a.azienda.cuaa=i.fascicoloCorrente.fascicoloLegacy.cuaa,i.antimafiaService.getDichiarazioniAntimafia(a)}))).subscribe((function(e){i.listaDichiarazioni=e||[],i.rerouteAntimafia()}),(function(e){return i.errorService.showError(e)}));else{var e=new c.a;e.azienda=new g.a,e.azienda.cuaa=this.fascicoloCorrente.fascicoloLegacy.cuaa,this.getFascicoloAgsByCuaaSub=this.antimafiaService.getDichiarazioniAntimafia(e).subscribe((function(e){i.listaDichiarazioni=e||[],i.rerouteAntimafia()}),(function(e){return i.errorService.showError(e)}))}}},{key:"selected",value:function(i){i&&(this.cfRichiedente=i,this.rerouteAntimafiaCreaDomanda(i))}},{key:"rerouteAntimafiaCreaDomanda",value:function(i){var e=this;if(this.showLista=!1,this.listaDichiarazioni=this.listaDichiarazioni.filter((function(i){return"CHIUSA"!==i.stato.identificativo})),this.listaDichiarazioni.filter((function(i){return"BOZZA"===i.stato.identificativo})),0===this.listaDichiarazioni.length){var a=new c.a;a.azienda=new g.a,a.azienda.cuaa=this.fascicoloCorrente.fascicoloLegacy.cuaa,this.newDichiarazione(a,this.cfRichiedente)}else{var t=this.listaDichiarazioni.filter((function(i){return"BOZZA"!==i.stato.identificativo}));!m.a.isUndefinedOrNull(t)&&t.length>0?(this.currentDichiarazioneAntimafia=t[0],this.showWarnDomandaProtocollata(this.fascicoloCorrente.fascicoloLegacy.cuaa)):(this.messageService.add(m.a.getToast("errorCreazioneDichiarazione",m.b.warn,"ATTENZIONE: Esistono pi\xf9 domande in stato BOZZA")),ze(3e3).subscribe((function(i){e.router.navigate(["./"],{relativeTo:e.route.parent})})))}}},{key:"rerouteAntimafia",value:function(){var i=this;this.showLista=!1,this.listaDichiarazioni=this.listaDichiarazioni.filter((function(i){return"CHIUSA"!==i.stato.identificativo}));var e=this.listaDichiarazioni.filter((function(i){return"BOZZA"===i.stato.identificativo}));if(0===this.listaDichiarazioni.length){if(!this.authservice.isUserPrivate()||!this.homeservice.isAziendaUtente(this.cuaaImpresa))return this.cuaaImpresa=this.fascicoloCorrente.fascicoloLegacy.cuaa,void console.log("cuaaImpresa rerouteAntimafia"+this.cuaaImpresa)}else if(1===e.length)this.router.navigate(["./"+e[0].id],{relativeTo:this.route});else{var a=this.listaDichiarazioni.filter((function(i){return"BOZZA"!==i.stato.identificativo}));if(!m.a.isUndefinedOrNull(a)&&a.length>0){if(!this.authservice.isUserPrivate()||!this.homeservice.isAziendaUtente(this.cuaaImpresa))return this.cuaaImpresa=this.fascicoloCorrente.fascicoloLegacy.cuaa,void console.log("cuaaImpresa rerouteAntimafia more bozza"+this.cuaaImpresa)}else this.messageService.add(m.a.getToast("errorCreazioneDichiarazione",m.b.warn,"ATTENZIONE: Esistono pi\xf9 domande in stato BOZZA")),ze(3e3).subscribe((function(e){i.router.navigate(["./"],{relativeTo:i.route.parent.parent})}))}}},{key:"newDichiarazione",value:function(i,e){var a=this,t=new h.b;t.richiedente=new h.c,t.richiedente.codiceFiscale=e,console.log("Nuova dichiatazione utente "+e+" azienda "+this.fascicoloCorrente.fascicoloLegacy.cuaa),i.datiDichiarazione=t,this.antimafiaService.creaDichiarazioneAntimafia(i).subscribe((function(e){i.id=e,a.dichiarazioneAntimafiaService.setDichiarazioneAntimafia(i),a.router.navigate(["./"+i.id],{relativeTo:a.route})}),(function(i){console.log("Error",i),a.handleError(i)}))}},{key:"handleError",value:function(i){this.messageService.add(m.a.getToast("errorCreazioneDichiarazione",m.b.error,i.error.message?i.error.message:i.error))}},{key:"onRejectUpdateAndCreateNew",value:function(){this.messageService.clear("warn-stato-protocollata"),this.router.navigate(["./"],{relativeTo:this.route.parent})}},{key:"onConfirmUpdateAndCreateNew",value:function(){var i=this;this.messageService.clear("warn-stato-protocollata");var e=new Oe;e.daChiudere=this.currentDichiarazioneAntimafia;var a=new c.a;a.azienda=new g.a,a.azienda.cuaa=this.fascicoloCorrente.fascicoloLegacy.cuaa;var t=new h.b;t.richiedente=new h.c,t.richiedente.codiceFiscale=this.cfRichiedente,a.datiDichiarazione=t,e.exNovo=a,this.antimafiaService.chiudiAndRicreaDichiarazioneAntimafia(e).subscribe((function(e){e.creataNuovaDichiarazione&&(i.dichiarazioneAntimafiaService.setDichiarazioneAntimafia(e.dichiarazione),i.router.navigate(["./"+e.dichiarazione.id],{relativeTo:i.route}))}),(function(e){console.log("Error",e),i.handleError(e)}))}},{key:"showWarnDomandaProtocollata",value:function(i){this.messageService.add(m.a.getToast("warn-stato-protocollata",m.b.warn,m.a.CHECK_DICHIARAZIONE_PROTOCOLLATA(i)))}},{key:"ngOnDestroy",value:function(){this.loader.resetTimeout(),this.sub&&this.sub.unsubscribe(),this.getFascicoloAgsByCuaaSub&&this.getFascicoloAgsByCuaaSub.unsubscribe()}}]),i}(),we.\u0275fac=function(i){return new(i||we)(s.Nb(r.a),s.Nb(r.e),s.Nb(l),s.Nb(f.a),s.Nb(oe.a),s.Nb(S.d),s.Nb(Ce.a),s.Nb(ye.a),s.Nb(Ae.a),s.Nb(p.a),s.Nb(Ie.a),s.Nb(ge.a))},we.\u0275cmp=s.Hb({type:we,selectors:[["app-antimafia"]],decls:6,vars:10,consts:[[4,"ngIf"],["key","errorCreazioneDichiarazione"],["key","tst"],["position","center","key","warn-stato-protocollata","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"cuaaImpresa","selectedCuaa"],[3,"dichiarazioniAntimafia","newDichiarazione"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){1&i&&(s.Mc(0,Ne,2,1,"div",0),s.Mc(1,_e,2,1,"div",0),s.Ob(2,"p-toast",1),s.Ob(3,"p-toast",2),s.Tb(4,"p-toast",3),s.bc("onClose",(function(){return e.onRejectUpdateAndCreateNew()})),s.Mc(5,Me,11,2,"ng-template",4),s.Sb()),2&i&&(s.mc("ngIf",e.cuaaImpresa),s.Bb(1),s.mc("ngIf",e.showLista),s.Bb(1),s.Kc(s.rc(8,Le)),s.Bb(1),s.Kc(s.rc(9,Le)),s.Bb(1),s.mc("modal",!0)("baseZIndex",5e3))},directives:[o.t,z.a,S.e,Be,be,T.b],styles:[""]}),we),pathMatch:"full"},{path:"lista",component:be,pathMatch:"full"},{path:"richiedente",component:Be,pathMatch:"full"},{path:":idDichiarazione",component:ne,resolve:{dichiarazione:he},data:{mybreadcrumb:"Domanda Antimafia"}}],Ge=((xe=function i(){_classCallCheck(this,i)}).\u0275mod=s.Lb({type:xe}),xe.\u0275inj=s.Kb({factory:function(i){return new(i||xe)},providers:[{provide:l,useClass:l}],imports:[[r.i.forChild(je),fe.a]]}),xe),Ke=a("Mqm0"),Ve=a("A+aF"),Ze=(a("Z7TK"),a("tQ6G")),Qe=((Ue=function i(){_classCallCheck(this,i)}).\u0275mod=s.Lb({type:Ue}),Ue.\u0275inj=s.Kb({factory:function(i){return new(i||Ue)},imports:[[o.c,S.f,Ze.b],S.f]}),Ue),He=a("yhG/"),$e=a("3u2U"),We=a("GdHY");a("P/hZ");var Je,Ye,qe=((Ye=function i(){_classCallCheck(this,i)}).\u0275mod=s.Lb({type:Ye}),Ye.\u0275inj=s.Kb({factory:function(i){return new(i||Ye)},imports:[[o.c]]}),Ye),Xe=((Je=function i(){_classCallCheck(this,i)}).\u0275mod=s.Lb({type:Je}),Je.\u0275inj=s.Kb({factory:function(i){return new(i||Je)},providers:[l,he,Ke.a,S.d],imports:[[o.c,Ge,U.m,fe.a,ii.t,L.b,T.c,Ve.b,b.b,Qe,yi.b,He.b,Ti.b,z.b,W.b,$.b,$e.b,We.b,qe]]}),Je)}}]);