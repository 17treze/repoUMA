function _toConsumableArray(i){return _arrayWithoutHoles(i)||_iterableToArray(i)||_unsupportedIterableToArray(i)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(i){if("undefined"!=typeof Symbol&&null!=i[Symbol.iterator]||null!=i["@@iterator"])return Array.from(i)}function _arrayWithoutHoles(i){if(Array.isArray(i))return _arrayLikeToArray(i)}function _slicedToArray(i,e){return _arrayWithHoles(i)||_iterableToArrayLimit(i,e)||_unsupportedIterableToArray(i,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(i,e){if(i){if("string"==typeof i)return _arrayLikeToArray(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);return"Object"===t&&i.constructor&&(t=i.constructor.name),"Map"===t||"Set"===t?Array.from(i):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(i,e):void 0}}function _arrayLikeToArray(i,e){(null==e||e>i.length)&&(e=i.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=i[t];return o}function _iterableToArrayLimit(i,e){var t=null==i?null:"undefined"!=typeof Symbol&&i[Symbol.iterator]||i["@@iterator"];if(null!=t){var o,n,a=[],r=!0,c=!1;try{for(t=t.call(i);!(r=(o=t.next()).done)&&(a.push(o.value),!e||a.length!==e);r=!0);}catch(s){c=!0,n=s}finally{try{r||null==t.return||t.return()}finally{if(c)throw n}}return a}}function _arrayWithHoles(i){if(Array.isArray(i))return i}function _classCallCheck(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(i,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}function _createClass(i,e,t){return e&&_defineProperties(i.prototype,e),t&&_defineProperties(i,t),i}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"0alx":function(i,e,t){"use strict";var o=t("VKeD");e.isIterable=function(i){return i&&"function"==typeof i[o.iterator]}},"2KeD":function(i,e,t){"use strict";var o=t("Q1FS"),n=t("zB/H"),a=t("zfKp");e.scheduleObservable=function(i,e){return new o.Observable((function(t){var o=new n.Subscription;return o.add(e.schedule((function(){var n=i[a.observable]();o.add(n.subscribe({next:function(i){o.add(e.schedule((function(){return t.next(i)})))},error:function(i){o.add(e.schedule((function(){return t.error(i)})))},complete:function(){o.add(e.schedule((function(){return t.complete()})))}}))}))),o}))}},"2Ocl":function(i,e,t){"use strict";t.r(e),t.d(e,"UmaModule",(function(){return Ts}));var o,n,a,r,c,s=t("ofXK"),l=function(i){return i[i.MACCHINE=0]="MACCHINE",i[i.LAVORAZIONI=1]="LAVORAZIONI",i[i.FABBISOGNO=2]="FABBISOGNO",i[i.PROTOCOLLAZIONE=3]="PROTOCOLLAZIONE",i}({}),u=t("EY2u"),b=t("eIep"),h=t("JIr8"),m=t("Tn7N"),p=t("VpP9"),d=t("8X0W"),g=t("xiDf"),f=t("tk/3"),v=t("Pust"),S=t("fXoL"),C=((o=function(){function i(e,t){_classCallCheck(this,i),this.http=e,this.httpClientCore=t,this.CTX_PATH="/richieste"}return _createClass(i,[{key:"dichiaraMacchinariDomanda",value:function(i,e){return this.http.post("".concat(this.urlDomanda(),"/").concat(i,"/macchine"),e)}},{key:"validaRichiestaCarburante",value:function(i){var e=new f.f({"Content-Type":"application/json"});return this.http.post("".concat(this.urlDomanda(),"/").concat(i,"/valida"),{headers:e})}},{key:"getMacchineByIdDomanda",value:function(i){return this.http.get("".concat(this.urlDomanda(),"/").concat(i,"/macchine"))}},{key:"urlDomanda",value:function(){return this.httpClientCore.HOST+this.httpClientCore.BASE_PATH+this.httpClientCore.API_V1+this.CTX_PATH}}]),i}()).\u0275fac=function(i){return new(i||o)(S.Xb(f.b),S.Xb(v.a))},o.\u0275prov=S.Jb({token:o,factory:o.\u0275fac,providedIn:"root"}),o),O=t("s0xf"),T=((n=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"READONLY_MODE",get:function(){return this._READONLY_MODE},set:function(i){this._READONLY_MODE=i}},{key:"READONLY_MODE_DICHIARAZIONE",get:function(){return this._READONLY_MODE_DICHIARAZIONE},set:function(i){this._READONLY_MODE_DICHIARAZIONE=i}},{key:"idFascicolo",get:function(){return this._idFascicolo},set:function(i){this._idFascicolo=i}}]),i}()).\u0275fac=function(i){return new(i||n)},n.\u0275prov=S.Jb({token:n,factory:n.\u0275fac,providedIn:"root"}),n),I=t("2Vo4"),z=t("Caez"),A=t("qXBG"),E=((a=function(){function i(e,t){_classCallCheck(this,i),this.indiceUmaService=e,this.authService=t,this._readonlyDomanda$=new I.a(!1),this._fabbisognoDichiarato$=new I.a(null)}return _createClass(i,[{key:"updatedDomandaUmaStatus",value:function(i){this._readonlyDomanda$.next(i)}},{key:"updateDichiarazioneFabbisogno",value:function(i){this._fabbisognoDichiarato$.next(i)}},{key:"isInCompilazione",value:function(i,e){var t=!1,o=!1;return i.stato===z.a.IN_COMPILAZIONE&&this.authService.userSelectedRole!==A.a.roleIstruttoreUMA&&this.authService.userSelectedRole!==A.a.roleAppag&&this.authService.userSelectedRole!==A.a.roleViewerPAT&&this.authService.userSelectedRole!==A.a.roleAltroEnte?(this.indiceUmaService.READONLY_MODE=!1,t=!this.indiceUmaService.READONLY_MODE,o=!1,e&&e.length&&e.push({label:"Protocollazione"})):(this.indiceUmaService.READONLY_MODE=!0,t=!this.indiceUmaService.READONLY_MODE,o=i.stato!==z.a.IN_COMPILAZIONE),localStorage.setItem("UMA_RO",this.indiceUmaService.READONLY_MODE.toString()),{inCompilazione:t,mostraScarica:o}}},{key:"getTipoCarburanteDichiarato",value:function(i){return{gasolio:i.haMacchineGasolio,benzina:i.haMacchineBenzina}}},{key:"readonlyDomanda$",get:function(){return this._readonlyDomanda$}},{key:"fabbisognoDichiarato$",get:function(){return this._fabbisognoDichiarato$}}]),i}()).\u0275fac=function(i){return new(i||a)(S.Xb(T),S.Xb(A.a))},a.\u0275prov=S.Jb({token:a,factory:a.\u0275fac,providedIn:"root"}),a),y=t("N00r"),R=t("JEAp"),D=t("tyNb"),M=t("RtSl"),N=t("arS9"),_=t("3u2U"),B=t("1v+U"),k=t("A1Yd"),F=t("NC7Y"),P=((r=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"fabbisognoDichiaratoBuilder",value:function(i){var e=i.filter((function(i){return i.isUtilizzata}));return{benzina:e.some((function(i){return i.alimentazione===F.a.BENZINA})),gasolio:e.some((function(i){return i.alimentazione===F.a.GASOLIO}))}}}]),i}()).\u0275fac=function(i){return new(i||r)},r.\u0275prov=S.Jb({token:r,factory:r.\u0275fac,providedIn:"root"}),r),w=t("LRne"),x=function i(){_classCallCheck(this,i)},L=t("nqMk"),G=((c=function(){function i(e,t,o){_classCallCheck(this,i),this.http=e,this.httpClientCore=t,this.httpHelperService=o,this.CTX_PATH="/richieste"}return _createClass(i,[{key:"getLavorazioni",value:function(i,e){var t=null!=e?"?"+this.httpHelperService.buildQueryStringFromObject({ambito:e}):"";return this.http.get("".concat(this.urlRichiesta(),"/").concat(i,"/lavorazioni")+t)}},{key:"getDichiarazioni",value:function(i,e){var t=null!=e?"?"+this.httpHelperService.buildQueryStringFromObject({ambito:e}):"";return this.http.get("".concat(this.urlRichiesta(),"/").concat(i,"/fabbisogni")+t)}},{key:"getFabbisogniFabbricati",value:function(i,e){var t=null!=e?"?"+this.httpHelperService.buildQueryStringFromObject({ambito:e}):"";return this.http.get("".concat(this.urlRichiesta(),"/").concat(i,"/fabbisogni-fabbricati")+t)}},{key:"saveDomandaUma",value:function(i){return this.http.post("".concat(this.urlRichiesta(),"/").concat(i.id),i)}},{key:"updateDomandaUma",value:function(i,e){return this.http.put("".concat(this.urlRichiesta(),"/").concat(i),e)}},{key:"saveFabbisogni",value:function(i,e){return this.http.post("".concat(this.urlRichiesta(),"/").concat(i,"/fabbisogni"),e)}},{key:"saveFabbisogniFabbricati",value:function(i,e){return this.http.post("".concat(this.urlRichiesta(),"/").concat(i,"/fabbisogni-fabbricati"),e)}},{key:"deleteFabbisogniById",value:function(i,e){var t=null!=e?"?"+this.httpHelperService.buildQueryStringFromObject({tipiCarburante:e}):"";return this.http.delete("".concat(this.urlRichiesta(),"/").concat(i,"/fabbisogni")+t)}},{key:"getDomandaById",value:function(i){return this.http.get("".concat(this.urlRichiesta(),"/").concat(i))}},{key:"urlRichiesta",value:function(){return this.httpClientCore.HOST+this.httpClientCore.BASE_PATH+this.httpClientCore.API_V1+this.CTX_PATH}}]),i}()).\u0275fac=function(i){return new(i||c)(S.Xb(f.b),S.Xb(v.a),S.Xb(L.a))},c.\u0275prov=S.Jb({token:c,factory:c.\u0275fac,providedIn:"root"}),c),U=t("yWug"),V=t("KwdP"),H=t("3Pt+");function Z(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",4),S.Tb(1,"button",12),S.bc("click",(function(){return S.Ec(t),S.fc().saveMacchine()})),S.Sb(),S.Sb()}}function j(i,e){if(1&i&&S.Ob(0,"p-sortIcon",18),2&i){var t=S.fc().$implicit;S.mc("field",t.field)}}function Y(i,e){if(1&i&&(S.Tb(0,"th",16),S.Oc(1),S.Mc(2,j,1,1,"p-sortIcon",17),S.Sb()),2&i){var t=e.$implicit;S.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field)("width",t.width),S.Bb(1),S.Qc(" ",t.header," "),S.Bb(1),S.mc("ngIf",null!=t.field)}}function q(i,e){if(1&i){var t=S.Ub();S.Tb(0,"tr"),S.Mc(1,Y,3,5,"th",14),S.Tb(2,"th"),S.Tb(3,"p-inputSwitch",15),S.bc("onChange",(function(){return S.Ec(t),S.fc(2).onClickSelezionaTutto()}))("ngModelChange",(function(i){return S.Ec(t),S.fc(2).isSelectedAll=i})),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=S.fc(2);S.Bb(1),S.mc("ngForOf",o.cols),S.Bb(2),S.mc("disabled",!o.inCompilazione)("ngModel",o.isSelectedAll)}}function Q(i,e){1&i&&S.Mc(0,q,4,3,"ng-template",13)}function K(i,e){if(1&i){var t=S.Ub();S.Tb(0,"tr"),S.Tb(1,"td",19),S.Oc(2),S.Sb(),S.Tb(3,"td",19),S.Oc(4),S.Sb(),S.Tb(5,"td",19),S.Oc(6),S.Sb(),S.Tb(7,"td",19),S.Oc(8),S.Sb(),S.Tb(9,"td",19),S.Oc(10),S.Sb(),S.Tb(11,"td",19),S.Oc(12),S.Sb(),S.Tb(13,"td"),S.Tb(14,"p-inputSwitch",15),S.bc("onChange",(function(){return S.Ec(t),S.fc().setIsSelectedAll()}))("ngModelChange",(function(i){return S.Ec(t),e.$implicit.isUtilizzata=i})),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit,n=S.fc();S.Bb(2),S.Pc(o.descrizione),S.Bb(2),S.Pc(o.classe),S.Bb(2),S.Pc(o.marca),S.Bb(2),S.Pc(o.alimentazione),S.Bb(2),S.Pc(o.targa),S.Bb(2),S.Pc(o.possesso),S.Bb(2),S.mc("disabled",!n.inCompilazione)("ngModel",o.isUtilizzata)}}var W,$,J,X=function(){return{marginTop:"70px"}},ii=((W=function(){function i(e,t,o,n,a,r,c,s,l){_classCallCheck(this,i),this.confirmationService=e,this.messageService=t,this.dateUtilService=o,this.httpClientMacchineUmaService=n,this.httpClientDomandaUmaService=a,this.httpClientLavorazioniUmaService=r,this.authService=c,this.modelBuilderService=s,this.errorService=l,this.nextStep=new S.n,this.updateRichiesta=new S.n,this.valoriOriginari=[],this.isSelectedAll=!1}return _createClass(i,[{key:"ngOnInit",value:function(){this.controllaIstruttoreUMA(),this.cols=this.defineTableColumns(),this.macchine=[]}},{key:"ngOnChanges",value:function(i){i&&i.richiestaCarburante&&i.richiestaCarburante.currentValue&&this.getMacchine()}},{key:"goNextStep",value:function(){var i=this;this.inCompilazione?this.richiestaCarburante.haMacchineBenzina||this.richiestaCarburante.haMacchineGasolio?this.macchine.filter((function(i){return i.isUtilizzata})).length?this.isChangedInputSwitch()?this.confirmationService.confirm({message:O.a.macchineNonSalvate,accept:function(){i.nextStep.emit(l.MACCHINE)},reject:function(){},key:"macchine-dialog"}):this.nextStep.emit(l.MACCHINE):this.errorService.showErrorWithMessage(O.a.macchineNotSelezionate,"tst-macchine"):this.errorService.showErrorWithMessage(O.a.macchineNotPresenti,"tst-macchine"):this.nextStep.emit(l.MACCHINE)}},{key:"ngOnDestroy",value:function(){this.macchineSubscription&&this.macchineSubscription.unsubscribe(),this.dichiarazioneMacchineSubscription&&this.dichiarazioneMacchineSubscription.unsubscribe()}},{key:"saveMacchine",value:function(){var i=this;if(this.macchine.filter((function(i){return i.isUtilizzata})).length){var e=this.modelBuilderService.fabbisognoDichiaratoBuilder(this.macchine);!this.richiestaCarburante.haMacchineBenzina||e.benzina?!this.richiestaCarburante.haMacchineGasolio||e.gasolio?this.saveMacchineAndUpdateRichiesta(!1,!1):this.confirmationService.confirm({message:O.a.macchineGasolioRimosse,accept:function(){i.saveMacchineAndUpdateRichiesta(!1,!0)},reject:function(){i.getMacchine()},key:"macchine-dialog"}):this.confirmationService.confirm({message:O.a.macchineBenzinaRimosse,accept:function(){i.saveMacchineAndUpdateRichiesta(!0,!1)},reject:function(){i.getMacchine()},key:"macchine-dialog"})}else this.errorService.showErrorWithMessage(O.a.macchineNotSelezionate,"tst-macchine")}},{key:"onClickSelezionaTutto",value:function(){0==this.isSelectedAll&&this.macchine.forEach((function(i){i.isUtilizzata=!1})),1==this.isSelectedAll&&this.macchine.forEach((function(i){i.isUtilizzata=!0}))}},{key:"saveMacchineAndUpdateRichiesta",value:function(i,e){var t=this;this.dichiarazioneMacchineSubscription=this.httpClientMacchineUmaService.dichiaraMacchinariDomanda(this.richiestaCarburante.id.toString(),this.macchine).pipe(Object(b.a)((function(o){var n;if(i||e){var a=i?[F.a.BENZINA]:[F.a.GASOLIO];n=t.httpClientLavorazioniUmaService.deleteFabbisogniById(t.richiestaCarburante.id.toString(),a)}else n=Object(w.a)({});return n})),Object(h.a)((function(i){return t.errorService.showError(i,"tst-macchine"),u.a})),Object(b.a)((function(){return t.httpClientDomandaUmaService.getDomandaById(t.richiestaCarburante.id.toString())}))).subscribe((function(i){t.messageService.add(m.a.getToast("tst-macchine",m.b.success,O.a.salvataggioOK)),t.initValoriOriginari(),t.richiestaCarburante=i,t.updateRichiesta.emit(i)}),(function(i){return t.errorService.showError(i,"tst-macchine")}))}},{key:"getMacchine",value:function(){var i=this;this.macchineSubscription=this.httpClientMacchineUmaService.getMacchineByIdDomanda(this.richiestaCarburante.id.toString()).subscribe((function(e){i.macchine=e,i.setIsSelectedAll(),i.initValoriOriginari()}),(function(e){return i.errorService.showError(e,"tst-macchine")}))}},{key:"setIsSelectedAll",value:function(){this.isSelectedAll=!(null==this.macchine||this.macchine.length<=0||!this.macchine.every((function(i){return 1==i.isUtilizzata})))}},{key:"isChangedInputSwitch",value:function(){var i=this,e=0,t=!1;return this.macchine.forEach((function(o){i.valoriOriginari[e]!=o.isUtilizzata&&(t=!0),e+=1})),t}},{key:"initValoriOriginari",value:function(){var i=this;if(null!=this.macchine&&this.macchine.length){var e=0;this.macchine.forEach((function(t){i.valoriOriginari[e]=t.isUtilizzata,e+=1}))}else this.isSelectedAll=!1}},{key:"defineTableColumns",value:function(){return[{field:null,header:"Macchina",width:"30%"},{field:"classe",header:"Classe",width:"10%"},{field:null,header:"Marca",width:"20%"},{field:"alimentazione",header:"Alimentazione",width:"15%"},{field:null,header:"Targa",width:"10%"},{field:null,header:"Possesso",width:"10%"}]}},{key:"controllaIstruttoreUMA",value:function(){this.authService.userSelectedRole!=A.a.roleIstruttoreUMA&&this.authService.userSelectedRole!=A.a.roleAppag||(this.inCompilazione=!1)}}]),i}()).\u0275fac=function(i){return new(i||W)(S.Nb(M.a),S.Nb(M.d),S.Nb(d.a),S.Nb(C),S.Nb(g.a),S.Nb(G),S.Nb(A.a),S.Nb(P),S.Nb(y.a))},W.\u0275cmp=S.Hb({type:W,selectors:[["app-macchine"]],inputs:{inCompilazione:"inCompilazione",richiestaCarburante:"richiestaCarburante",idFascicolo:"idFascicolo"},outputs:{nextStep:"nextStep",updateRichiesta:"updateRichiesta"},features:[S.zb],decls:15,vars:7,consts:[["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","macchine-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["key","tst-macchine"],[1,"p-grid"],[1,"p-grid","w-100"],[1,"p-col"],[1,"p-col-fixed","p-0"],[1,"p-grid","m-0"],["class","p-col",4,"ngIf"],["pButton","","type","button","icon","pi pi-chevron-circle-right","iconPos","right","label","PROCEDI",1,"w-10m",3,"click"],[3,"value","resizableColumns"],[4,"ngIf"],["pTemplate","body"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],["pTemplate","header"],["pResizableColumn","",3,"pSortableColumn","pSortableColumnDisabled","width",4,"ngFor","ngForOf"],[3,"disabled","ngModel","onChange","ngModelChange"],["pResizableColumn","",3,"pSortableColumn","pSortableColumnDisabled","width"],[3,"field",4,"ngIf"],[3,"field"],[1,"ui-resizable-column"]],template:function(i,e){1&i&&(S.Ob(0,"p-confirmDialog",0),S.Ob(1,"p-toast",1),S.Tb(2,"div",2),S.Tb(3,"div",3),S.Ob(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Mc(7,Z,2,0,"div",7),S.Tb(8,"div",4),S.Tb(9,"button",8),S.bc("click",(function(){return e.goNextStep()})),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(10,"div",3),S.Tb(11,"div",4),S.Tb(12,"p-table",9),S.Mc(13,Q,1,0,void 0,10),S.Mc(14,K,15,8,"ng-template",11),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Bb(1),S.Kc(S.rc(6,X)),S.Bb(6),S.mc("ngIf",e.inCompilazione),S.Bb(5),S.mc("value",e.macchine)("resizableColumns",!0),S.Bb(1),S.mc("ngIf",null==e.cols?null:e.cols.length))},directives:[_.a,N.a,s.t,k.b,U.q,M.e,s.s,V.a,H.s,H.v,U.j,U.p,U.o],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),W),ei=function(i){return i.COLTIVAZIONI_SOTTO_SERRA="COLTIVAZIONI_SOTTO_SERRA",i.TRASFORMAZIONE_PRODOTTI="TRASFROMAZIONE_PRODOTTI",i}({}),ti=function(i){return i[i.SUPERFICI=0]="SUPERFICI",i[i.ALTRE=1]="ALTRE",i[i.SOTTO_SERRA=2]="SOTTO_SERRA",i[i.TRASFORMAZIONI_PRODOTTI=3]="TRASFORMAZIONI_PRODOTTI",i[i.ZOOTECNIA=4]="ZOOTECNIA",i}({}),oi=t("rgW5"),ni=t("w95V"),ai=t("LvDl"),ri=function(i){return i.SUPERFICIE="SUPERFICIE",i.ZOOTECNIA="ZOOTECNIA",i.FABBRICATI="FABBRICATI",i.ALTRO="ALTRO",i.SERRE="SERRE",i}({}),ci=function(i){return i.BASE="BASE",i.STRAORDINARIA="STRAORDINARIA",i.BOVINI_BUFALINI_LATTE_CARNE="BOVINI E BUFALINI DA LATTE/CARNE (OLTRE 6 MESI)",i.VITELLI="VITELLI (FINO A 6 MESI)",i.SUINI_DA_RIPRODUZIONE="SUINI DA RIPRODUZIONE",i.SUINI_DA_INGRASSO="SUINI DA INGRASSO",i.SUINI_A_CICLO_CHIUSO="SUINI A CICLO CHIUSO",i.OVINI_E_CAPRINI="OVINI E CAPRINI",i.AVICOLI_CUNICOLI_STRUZZI="AVICOLI, CUNICOLI E STRUZZI",i.EQUINI_E_UNGULATI="EQUINI E UNGULATI",i.PISCICOLTURA_INTENSIVA="PISCICOLTURA INTENSIVA",i.PISCICOLTURA_ESTENSIVA="PISCICOLTURA ESTENSIVA",i.APICOLTURA="APICOLTURA",i}({}),si=t("cp0P"),li=((J=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"decodificaUnitaDiMisura",value:function(i){switch(i.toUpperCase()){case"ARNIE":return"Arnie";case"KM":return"Km";case"UBA":return"UBA";case"MC":return"Mc";case"T":return"T";case"CAPO":return"Capo";case"MQ":return"Mq";case"HA":return"Ha";case"CVH":return"CVh";case"QLI":return"Quintali";case"QLI_LATTE":return"Q.li Latte";case"QLI_OLIVE":return"Q.li Olive";case"QLI_ACQUA":return"Q.li Acqua";case"QLI_PRODOTTO":return"Q.li Prodotto";case"NUM":return"Num";case"HL_VINO":return"Hl Vino";case"HL_ACQUA":return"Hl Acqua";default:return i||"Quantita"}}}]),i}()).\u0275fac=function(i){return new(i||J)},J.\u0275prov=S.Jb({token:J,factory:J.\u0275fac,providedIn:"root"}),J),ui=(($=function(){function i(e){_classCallCheck(this,i),this.converterUnitaDiMisuraService=e}return _createClass(i,[{key:"raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel",value:function(i,e){var t=this,o=[];return i&&i.length?(i.forEach((function(i){var n={};n.indice=i.indice,n.nome=i.nome,n.superficieMassima=i.superficieMassima,n.descrizioneCompleta=i.indice+" "+i.nome,n.lavorazioni=t.getLavorazioni(i,e),o.push(n)})),o):o}},{key:"getLavorazioni",value:function(i,e){var t=this;if(!i.lavorazioni||!i.lavorazioni.length)return[];var o=[];return i.lavorazioni.forEach((function(n){var a={};a.id=n.id,a.indice=n.indice,a.descrizioneCompleta=i.indice+"."+n.indice+" "+n.nome,a.unitaDiMisura=t.converterUnitaDiMisuraService.decodificaUnitaDiMisura(n.unitaDiMisura),a.tipo=n.tipologia,a.superficieMassima=i.superficieMassima,a=t.addFabbisogniToLavorazioni(e,n,a),o.push(a)})),o}},{key:"addFabbisogniToLavorazioni",value:function(i,e,t){if(!i||!i.length)return t;var o=i.filter((function(i){return e.id==i.lavorazioneId}));if(o&&o.length){var n=o[0].fabbisogni;n&&n.length&&n.forEach((function(i){var e=i.quantita.toString().replace(".",",");t[i.carburante]=e}))}return t}},{key:"lavorazioniViewModelToDichiarazioniDtoBuilder",value:function(i){var e=this,t=[];return i.filter((function(i){return null!=i[F.a.GASOLIO]||null!=i[F.a.BENZINA]})).forEach((function(i){var o={fabbisogni:[]};o.lavorazioneId=i.id,null!=i[F.a.GASOLIO]&&o.fabbisogni.push(e.buildFabbisogno(i[F.a.GASOLIO],F.a.GASOLIO)),null!=i[F.a.BENZINA]&&o.fabbisogni.push(e.buildFabbisogno(i[F.a.BENZINA],F.a.BENZINA)),o.fabbisogni&&o.fabbisogni.length&&t.push(o)})),t}},{key:"buildFabbisogno",value:function(i,e){return{quantita:i.toString().replace(",","."),carburante:e}}}]),i}()).\u0275fac=function(i){return new(i||$)(S.Xb(li))},$.\u0275prov=S.Jb({token:$,factory:$.\u0275fac,providedIn:"root"}),$),bi=t("yhG/"),hi=t("V6/s"),mi=t("sYmb"),pi=["accordion"];function di(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",13),S.Tb(1,"button",14),S.bc("click",(function(){return S.Ec(t),S.fc().saveLavorazioni()})),S.Sb(),S.Sb()}}function gi(i,e){1&i&&S.Ob(0,"i",23)}function fi(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-a4g-multi-table",24),S.bc("clickIcon",(function(i){return S.Ec(t),S.fc(3).onClickIcon(i)}))("changedValueForm",(function(i){return S.Ec(t),S.fc(3).onChangeForm(i)})),S.Sb()}if(2&i){var o=S.fc(3);S.mc("title",o.nomeRaggruppamento)("cols",o.colsBase)("values",o.datasourceBase)("readonly",!o.inCompilazione)}}function vi(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-a4g-multi-table",25),S.bc("clickIcon",(function(i){return S.Ec(t),S.fc(3).onClickIcon(i)}))("changedValueForm",(function(i){return S.Ec(t),S.fc(3).onChangeForm(i)})),S.Sb()}if(2&i){var o=S.fc(3);S.mc("cols",o.colsStraordinaria)("values",o.datasourceStraordinaria)("readonly",!o.inCompilazione)}}function Si(i,e){if(1&i&&(S.Rb(0),S.Tb(1,"p-accordionTab"),S.Tb(2,"p-header"),S.Oc(3),S.gc(4,"uppercase"),S.Mc(5,gi,1,0,"i",18),S.Sb(),S.Tb(6,"div",19),S.Mc(7,fi,1,4,"app-a4g-multi-table",20),S.Ob(8,"div",21),S.Mc(9,vi,1,3,"app-a4g-multi-table",22),S.Sb(),S.Sb(),S.Qb()),2&i){var t=e.$implicit,o=e.index,n=S.fc(2);S.Bb(3),S.Rc(" ",t.indice," ",S.hc(4,5,t.nome)," "),S.Bb(2),S.mc("ngIf",n.quantitaLavorata[o]>0),S.Bb(2),S.mc("ngIf",null==n.datasourceBase?null:n.datasourceBase.length),S.Bb(2),S.mc("ngIf",null==n.datasourceStraordinaria?null:n.datasourceStraordinaria.length)}}function Ci(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",3),S.Tb(1,"p-accordion",15,16),S.bc("onOpen",(function(i){return S.Ec(t),S.fc().onSelectAccordion(i)})),S.Mc(3,Si,10,7,"ng-container",17),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(3),S.mc("ngForOf",o.raggruppamenti)}}var Oi,Ti=function(){return{marginTop:"70px"}},Ii=((Oi=function(){function i(e,t,o,n,a,r,c,s){_classCallCheck(this,i),this.activeRoute=e,this.messageService=t,this.confirmationService=o,this.gestioneDomandaUmaService=n,this.httpClientLavorazioniUmaService=a,this.location=r,this.lavorazioniBuiderService=c,this.errorService=s,this.changeFabbisogno=new S.n,this.quantitaLavorata=[],this.ambitoLavorazioneEnum=ri}return _createClass(i,[{key:"ngOnInit",value:function(){this.raggruppamentoForm=new H.j({raggruppamento:new H.g}),this.initVariables(),this.loadRaggruppamenti()}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveFabbisognoSubscription&&this.saveFabbisognoSubscription.unsubscribe()}},{key:"loadRaggruppamenti",value:function(){var i=this;this.routerSubscription=this.activeRoute.params.pipe(Object(h.a)(this.errorService.handleError),Object(b.a)((function(e){i.idDomanda=e.idDomanda;var t=i.httpClientLavorazioniUmaService.getLavorazioni(i.idDomanda,i.ambitoLavorazioneEnum.SUPERFICIE),o=i.httpClientLavorazioniUmaService.getDichiarazioni(i.idDomanda,i.ambitoLavorazioneEnum.SUPERFICIE);return Object(si.a)([t,o])}))).subscribe((function(e){var t=_slicedToArray(e,2),o=t[0],n=t[1];i.raggruppamenti=i.lavorazioniBuiderService.raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(o,n),i.raggruppamenti=ai.orderBy(i.raggruppamenti,["indice"],["asc"]),i.calcolaQuantita()}),(function(e){return i.errorService.showError(e,"tst-lav-sup")}))}},{key:"calcolaQuantita",value:function(){var i=this;this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((function(e,t){i.quantitaLavorata[t]=0,e.lavorazioni.forEach((function(e){var o=isNaN(Number(e.BENZINA))?0:Number(e.BENZINA),n=isNaN(Number(e.GASOLIO))?0:Number(e.GASOLIO);i.quantitaLavorata[t]=i.quantitaLavorata[t]+o+n}))}))}},{key:"initVariables",value:function(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.nomeRaggruppamento=null,this.isValidFormTable=!0,this.datasourceBase=[],this.datasourceStraordinaria=[],this.colsBase=this.defineColumnsByTitle("Lavorazioni Base"),this.colsStraordinaria=this.defineColumnsByTitle("Lavorazioni Straordinarie"),this.raggruppamentoForm.controls.raggruppamento.setValue(null)}},{key:"goBack",value:function(){var i=this;this.isChangedInputTable?this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){i.location.back()},reject:function(){},key:"lavorazioni-dialog"}):this.location.back()}},{key:"onSelectAccordion",value:function(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.onChangeRaggruppamento(i)))}},{key:"openAccordionByIndex",value:function(i){this.accordion.tabs.forEach((function(e,t){e.selected=t==i}))}},{key:"onChangeRaggruppamento",value:function(i){var e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable)}},{key:"onChangeForm",value:function(i){this.isChangedInputTable=i.isChanged,this.changeFabbisogno.emit(this.isChangedInputTable),this.isValidFormTable=i.isValid}},{key:"saveLavorazioni",value:function(){var i=this;if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(O.a.raggruppamentiNotSelezionati,"tst-lav-sup"),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(O.a.datiNonValidi,"tst-lav-sup"),!1;var e=this.raggruppamentoForm.get("raggruppamento").value,t=this.lavorazioniBuiderService.lavorazioniViewModelToDichiarazioniDtoBuilder(e.lavorazioni);return console.log("Salvo dichiarazioni: ",t),this.saveFabbisognoSubscription=this.httpClientLavorazioniUmaService.saveFabbisogni(this.idDomanda,t).subscribe((function(){i.isChangedInputTable=!1,i.changeFabbisogno.emit(i.isChangedInputTable),i.messageService.add(m.a.getToast("tst-lav-sup",m.b.success,O.a.salvataggioOKLavorazioniSuperficie)),i.loadRaggruppamenti()}),(function(e){return i.errorService.showError(e,"tst-lav-sup")})),!0}},{key:"splitDatasources",value:function(i){var e=[],t=[];i.forEach((function(i){i.tipo===ci.BASE?t.push(i):e.push(i)})),this.datasourceBase=ai.sortBy(t,["indice"]),this.datasourceStraordinaria=ai.sortBy(e,["indice"])}},{key:"onClickIcon",value:function(i){i.col.field!==F.a.GASOLIO&&i.col.field!==F.a.BENZINA||this.updateTable(i.element,i.col)}},{key:"updateTable",value:function(i,e){var t=this.datasourceBase.filter((function(e){return e.id===i.id}))[0];null==t&&(t=this.datasourceStraordinaria.filter((function(e){return e.id===i.id}))[0]);var o=e.field===F.a.GASOLIO?F.a.BENZINA:F.a.GASOLIO;t[e.field]=t[e.field]!=t.superficieMassima?i.superficieMassima:"",t[o]=""}},{key:"showDialog",value:function(i){var e=this;this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){e.openedAccordion=i.index,e.onChangeRaggruppamento(i),e.openAccordionByIndex(e.openedAccordion)},reject:function(){e.openAccordionByIndex(e.openedAccordion)},key:"lavorazioni-dialog"})}},{key:"defineColumnsByTitle",value:function(i){return[{field:"descrizioneCompleta",header:i,sortable:!1,font:ni.e.BOLD,width:"46%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"superficieMassima",suffix:"unitaDiMisura",header:"Superficie massima",sortable:!1,width:"16%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:F.a.GASOLIO,suffix:"unitaDiMisura",header:"Sup. gasolio",sortable:!1,disabled:null!=this.fabbisognoDichiarato&&!this.fabbisognoDichiarato.gasolio,inputOpts:{pattern:"^([0-9])+$",maxLength:"7",upperLimitField:"superficieMassima"},icon:"pi pi-chevron-circle-right",width:"19%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER},{field:F.a.BENZINA,suffix:"unitaDiMisura",header:"Sup. benzina",sortable:!1,disabled:null!=this.fabbisognoDichiarato&&!this.fabbisognoDichiarato.benzina,inputOpts:{pattern:"^([0-9])+$",maxLength:"7",upperLimitField:"superficieMassima"},icon:"pi pi-chevron-circle-right",width:"19%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER}]}}]),i}()).\u0275fac=function(i){return new(i||Oi)(S.Nb(D.a),S.Nb(M.d),S.Nb(M.a),S.Nb(E),S.Nb(G),S.Nb(s.n),S.Nb(ui),S.Nb(y.a))},Oi.\u0275cmp=S.Hb({type:Oi,selectors:[["app-lavorazioni-superficie"]],viewQuery:function(i,e){var t;1&i&&S.Uc(pi,!0),2&i&&S.Ac(t=S.cc())&&(e.accordion=t.first)},inputs:{inCompilazione:"inCompilazione",richiestaCarburante:"richiestaCarburante"},outputs:{changeFabbisogno:"changeFabbisogno"},decls:16,vars:9,consts:[["key","tst-lav-sup"],[1,"p-grid","ui-fluid"],["novalidate","",1,"p-grid","m-0","w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid"],[1,"p-grid","p-align-center","py-4","w-100"],[1,"p-grid","m-0","p-align-center","color-primary"],["src","assets/img/icons/uma-icon/icon-superficie_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed",4,"ngIf"],[1,"p-grid","w-100"],["class","p-col",4,"ngIf"],[1,"p-col-fixed"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[1,"p-col-12","align-self-center","w-100"],[3,"title","cols","values","readonly","clickIcon","changedValueForm",4,"ngIf"],[1,"mb-1"],[3,"cols","values","readonly","clickIcon","changedValueForm",4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","values","readonly","clickIcon","changedValueForm"],[3,"cols","values","readonly","clickIcon","changedValueForm"]],template:function(i,e){1&i&&(S.Ob(0,"p-toast",0),S.Tb(1,"div",1),S.Tb(2,"form",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",3),S.Tb(7,"div",6),S.Ob(8,"img",7),S.Tb(9,"span",8),S.Tb(10,"strong",9),S.Oc(11),S.gc(12,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Mc(13,di,2,0,"div",10),S.Sb(),S.Tb(14,"div",11),S.Mc(15,Ci,4,1,"div",12),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Kc(S.rc(8,Ti)),S.Bb(2),S.mc("formGroup",e.raggruppamentoForm),S.Bb(9),S.Qc(" ",S.hc(12,6,"UMA.LAVORAZIONI_SUPERFICIE")," / Raggruppamenti"),S.Bb(2),S.mc("ngIf",e.inCompilazione),S.Bb(2),S.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[N.a,H.I,H.t,H.k,s.t,k.b,bi.a,s.s,bi.c,M.c,hi.a],pipes:[mi.d,s.G],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}"]}),Oi),zi=["accordion"];function Ai(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",13),S.Tb(1,"button",14),S.bc("click",(function(){return S.Ec(t),S.fc().saveLavorazioni()})),S.Sb(),S.Sb()}}function Ei(i,e){1&i&&S.Ob(0,"i",19)}function yi(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div"),S.Tb(1,"app-a4g-multi-table",20),S.bc("changedValueForm",(function(i){return S.Ec(t),S.fc(3).onChangeForm(i)})),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit,n=e.index,a=S.fc(3);S.Bb(1),S.mc("title",o.title)("cols",a.colsArray[n])("values",o.datasource)("readonly",!a.inCompilazione)}}function Ri(i,e){if(1&i&&(S.Rb(0),S.Tb(1,"p-accordionTab"),S.Tb(2,"p-header"),S.Oc(3),S.Mc(4,Ei,1,0,"i",18),S.Sb(),S.Mc(5,yi,2,4,"div",17),S.Sb(),S.Qb()),2&i){var t=e.$implicit,o=e.index,n=S.fc(2);S.Bb(3),S.Rc(" ",t.indice," ",t.nome," "),S.Bb(1),S.mc("ngIf",n.quantitaLavorata[o]>0),S.Bb(1),S.mc("ngForOf",n.tables)}}function Di(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",3),S.Tb(1,"p-accordion",15,16),S.bc("onOpen",(function(i){return S.Ec(t),S.fc().onSelectAccordion(i)})),S.Mc(3,Ri,6,4,"ng-container",17),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(3),S.mc("ngForOf",o.raggruppamenti)}}var Mi,Ni,_i=function(){return{marginTop:"70px"}},Bi=((Mi=function(){function i(e,t,o,n,a,r,c,s){_classCallCheck(this,i),this.activeRoute=e,this.gestioneDomandaUmaService=t,this.httpClientLavorazioniUmaService=o,this.confirmationService=n,this.messageService=a,this.location=r,this.lavorazioniBuiderService=c,this.errorService=s,this.changeFabbisogno=new S.n,this.ambitoLavorazioneEnum=ri}return _createClass(i,[{key:"ngOnInit",value:function(){this.raggruppamentoForm=new H.j({raggruppamento:new H.g}),this.initVariables(),this.loadRaggruppamenti()}},{key:"calcolaQuantita",value:function(){var i=this;this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((function(e,t){i.quantitaLavorata[t]=0,e.lavorazioni.forEach((function(e){var o=isNaN(Number(e.BENZINA))?0:Number(e.BENZINA),n=isNaN(Number(e.GASOLIO))?0:Number(e.GASOLIO);i.quantitaLavorata[t]=i.quantitaLavorata[t]+o+n}))}))}},{key:"loadRaggruppamenti",value:function(){var i=this;this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){i.idDomanda=e.idDomanda;var t=i.httpClientLavorazioniUmaService.getLavorazioni(i.idDomanda,i.ambitoLavorazioneEnum.ALTRO),o=i.httpClientLavorazioniUmaService.getDichiarazioni(i.idDomanda,i.ambitoLavorazioneEnum.ALTRO);return Object(si.a)([t,o])})),Object(h.a)((function(e){return i.errorService.showError(e,"tst-lav-altre"),u.a}))).subscribe((function(e){var t=_slicedToArray(e,2),o=t[0],n=t[1];i.raggruppamenti=i.lavorazioniBuiderService.raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(o,n),i.raggruppamenti=ai.orderBy(i.raggruppamenti,["indice"],["asc"]),i.calcolaQuantita()}),(function(e){return i.errorService.showError(e,"tst-lav-altre")}))}},{key:"initVariables",value:function(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.nomeRaggruppamento=null,this.isValidFormTable=!0,this.colsArray=[],this.tables=[],this.datasources=[],this.quantitaLavorata=[],this.raggruppamentoForm.controls.raggruppamento.setValue(null)}},{key:"onSelectAccordion",value:function(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.onChangeRaggruppamento(i)))}},{key:"openAccordionByIndex",value:function(i){this.accordion.tabs.forEach((function(e,t){e.selected=t==i}))}},{key:"onChangeRaggruppamento",value:function(i){var e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable)}},{key:"onChangeForm",value:function(i){this.isChangedInputTable=i.isChanged,this.changeFabbisogno.emit(this.isChangedInputTable),this.isValidFormTable=i.isValid}},{key:"goBack",value:function(){var i=this;this.isChangedInputTable?this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){i.location.back()},reject:function(){},key:"lavorazioni-dialog"}):this.location.back()}},{key:"saveLavorazioni",value:function(){var i=this;if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(O.a.raggruppamentiNotSelezionati,"tst-lav-altre"),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(O.a.datiNonValidi,"tst-lav-altre"),!1;var e=this.raggruppamentoForm.get("raggruppamento").value,t=this.lavorazioniBuiderService.lavorazioniViewModelToDichiarazioniDtoBuilder(e.lavorazioni);return this.saveFabbisogniSubscription=this.httpClientLavorazioniUmaService.saveFabbisogni(this.idDomanda,t).subscribe((function(){i.isChangedInputTable=!1,i.changeFabbisogno.emit(i.isChangedInputTable),i.messageService.add(m.a.getToast("tst-lav-altre",m.b.success,O.a.salvataggioOKLavorazioniSuperficie)),i.loadRaggruppamenti()}),(function(e){return i.errorService.showError(e,"tst-lav-altre")})),!0}},{key:"splitDatasources",value:function(i){var e=this,t=ai.groupBy(i,"tipo");this.tables=[],this.colsArray=[],this.datasources=[],Object.keys(t).forEach((function(i){var o=new ni.a;0==e.tables.length&&(o.title=e.nomeRaggruppamento);var n=e.defineColumnsByTitle(ci[i]);e.colsArray.push(n),o.datasource=t[i],e.datasources.push(o.datasource),e.tables.push(o)}))}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveFabbisogniSubscription&&this.saveFabbisogniSubscription.unsubscribe()}},{key:"showDialog",value:function(i){var e=this;this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){e.openedAccordion=i.index,e.onChangeRaggruppamento(i),e.openAccordionByIndex(e.openedAccordion)},reject:function(){e.openAccordionByIndex(e.openedAccordion)},key:"lavorazioni-dialog"})}},{key:"defineColumnsByTitle",value:function(i){return[{field:"descrizioneCompleta",header:"STRAORDINARIA"===i?"Lavorazioni Straordinarie":"Lavorazioni Base",sortable:!1,font:ni.e.BOLD,width:"80%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:F.a.GASOLIO,suffix:"unitaDiMisura",header:"Gasolio",sortable:!1,disabled:null!=this.fabbisognoDichiarato&&!this.fabbisognoDichiarato.gasolio,inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},width:"20%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER},{field:F.a.BENZINA,suffix:"unitaDiMisura",header:"Benzina",sortable:!1,disabled:null!=this.fabbisognoDichiarato&&!this.fabbisognoDichiarato.benzina,inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},width:"20%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER}]}}]),i}()).\u0275fac=function(i){return new(i||Mi)(S.Nb(D.a),S.Nb(E),S.Nb(G),S.Nb(M.a),S.Nb(M.d),S.Nb(s.n),S.Nb(ui),S.Nb(y.a))},Mi.\u0275cmp=S.Hb({type:Mi,selectors:[["app-lavorazioni-altre"]],viewQuery:function(i,e){var t;1&i&&S.Uc(zi,!0),2&i&&S.Ac(t=S.cc())&&(e.accordion=t.first)},inputs:{inCompilazione:"inCompilazione",richiestaCarburante:"richiestaCarburante"},outputs:{changeFabbisogno:"changeFabbisogno"},decls:16,vars:9,consts:[["key","tst-lav-altre"],[1,"p-grid","ui-fluid"],["novalidate","",1,"p-grid","m-0","w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid"],[1,"p-grid","p-align-center","py-4","w-100"],[1,"p-grid","m-0","p-align-center","color-primary"],["src","assets/img/icons/uma-icon/icon-altre_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed",4,"ngIf"],[1,"p-grid","w-100"],["class","p-col",4,"ngIf"],[1,"p-col-fixed"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","values","readonly","changedValueForm"]],template:function(i,e){1&i&&(S.Ob(0,"p-toast",0),S.Tb(1,"div",1),S.Tb(2,"form",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",3),S.Tb(7,"div",6),S.Ob(8,"img",7),S.Tb(9,"span",8),S.Tb(10,"strong",9),S.Oc(11),S.gc(12,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Mc(13,Ai,2,0,"div",10),S.Sb(),S.Tb(14,"div",11),S.Mc(15,Di,4,1,"div",12),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Kc(S.rc(8,_i)),S.Bb(2),S.mc("formGroup",e.raggruppamentoForm),S.Bb(9),S.Qc("",S.hc(12,6,"UMA.LAVORAZIONI_ALTRE")," / Raggruppamenti"),S.Bb(2),S.mc("ngIf",e.inCompilazione),S.Bb(2),S.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[N.a,H.I,H.t,H.k,s.t,k.b,bi.a,s.s,bi.c,M.c,hi.a],pipes:[mi.d],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}"]}),Mi),ki=t("Q1Ke"),Fi=((Ni=function(){function i(e,t){_classCallCheck(this,i),this.converterUnitaDiMisuraService=e,this.formatConverterService=t}return _createClass(i,[{key:"fabbricatiDtoToRaggruppamentiLavorazioneViewModel",value:function(i,e){var t=this,o=[];return i&&i.length?(i.forEach((function(i){var n={};n.indice=i.indice,n.nome=i.nome,n.descrizioneCompleta=i.indice+" "+i.nome;var a=t.getLavorazioniFromFabbricati(i);n.lavorazioni=t.addFabbisogniToFabbricati(t.replicaLavorazioni(a,i.fabbricati),e),o.push(n)})),o):o}},{key:"replicaLavorazioni",value:function(i,e){if(!e||!e.length)return i;var t=[];return i.forEach((function(i){e.forEach((function(e){var o=Object.assign({},i);o.comuneProvincia=e.comune+"("+e.siglaProvincia+")",o.idFabbricato=e.id,o.particella=e.particella,o.subalterno=e.subalterno,o.volume=e.volume.toString(),t.push(o)}))})),t}},{key:"getLavorazioniFromFabbricati",value:function(i){var e=this;if(!i.lavorazioni||!i.lavorazioni.length)return[];var t=[];return i.lavorazioni.forEach((function(o){var n={};n.id=o.id,n.indice=o.indice,n.descrizioneCompleta=i.indice+"."+o.indice+" "+o.nome,n.unitaDiMisura=e.converterUnitaDiMisuraService.decodificaUnitaDiMisura(o.unitaDiMisura),n.tipo=o.tipologia,n.superficieMassima=i.superficieMassima,t.push(n)})),t}},{key:"addFabbisogniToFabbricati",value:function(i,e){var t=this;return e&&e.length?(e.forEach((function(e){e.dichiarazioni&&e.dichiarazioni.length&&i.forEach((function(i){e.idFabbricato==i.idFabbricato&&e.dichiarazioni.forEach((function(e){e.lavorazioneId==i.id&&e.fabbisogni.forEach((function(e){var o=e.quantita.toString().replace(".",",");i[e.carburante]=o;var n=t.formatConverterService.toNumber(o),a=t.formatConverterService.toNumber(i.volume);i.mesi=n>0&&a>0&&t.formatConverterService.isMultipleBy(n,a)?n/a:null}))}))}))})),i):i}},{key:"lavorazioniViewModelToDichiarazioniFabbricatoDtoBuilder",value:function(i){var e=this,t=[];return i.filter((function(i){return null!=i[F.a.GASOLIO]})).forEach((function(i){var o,n,a=t.filter((function(e){return e.idFabbricato==i.idFabbricato}));a.length?o=a[0]:((o={}).idFabbricato=i.idFabbricato,o.dichiarazioni=[]);var r=o.dichiarazioni.filter((function(e){return e.lavorazioneId==i.id}));r.length?n=r[0]:((n={}).lavorazioneId=i.id,n.fabbisogni=[]),n.fabbisogni.push(e.buildFabbisogno(i[F.a.GASOLIO],F.a.GASOLIO)),o.dichiarazioni.push(n),o.dichiarazioni&&o.dichiarazioni.length&&(a.length||t.push(o))})),t}},{key:"buildFabbisogno",value:function(i,e){return{quantita:i.toString().replace(",","."),carburante:e}}}]),i}()).\u0275fac=function(i){return new(i||Ni)(S.Xb(li),S.Xb(ki.a))},Ni.\u0275prov=S.Jb({token:Ni,factory:Ni.\u0275fac,providedIn:"root"}),Ni),Pi=["accordion"];function wi(i,e){1&i&&S.Ob(0,"img",14)}function xi(i,e){1&i&&S.Ob(0,"img",15)}function Li(i,e){1&i&&(S.Tb(0,"strong",16),S.Oc(1),S.gc(2,"translate"),S.Sb()),2&i&&(S.Bb(1),S.Qc("",S.hc(2,1,"UMA.LAVORAZIONI_COLTIVAZIONI_SOTTO_SERRA")," / Raggruppamenti"))}function Gi(i,e){1&i&&(S.Tb(0,"strong",16),S.Oc(1),S.gc(2,"translate"),S.Sb()),2&i&&(S.Bb(1),S.Qc("",S.hc(2,1,"UMA.LAVORAZIONI_TRASFORMAZIONI_PRODOTTI")," / Raggruppamenti"))}function Ui(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",17),S.Tb(1,"button",18),S.bc("click",(function(){return S.Ec(t),S.fc().saveLavorazioni()})),S.Sb(),S.Sb()}}function Vi(i,e){1&i&&S.Ob(0,"i",25)}function Hi(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div"),S.Tb(1,"app-a4g-multi-table",26),S.bc("changedValueForm",(function(i){return S.Ec(t),S.fc(4).onChangeForm(i)})),S.Sb(),S.Ob(2,"div",27),S.Sb()}if(2&i){var o=e.$implicit,n=e.index,a=S.fc(4);S.Bb(1),S.mc("title",o.title)("cols",a.colsArray[n])("header",a.headersTable[n])("values",o.datasource)("readonly",!a.inCompilazione)}}function Zi(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Hi,3,5,"div",21),S.Sb()),2&i){var t=S.fc(3);S.Bb(1),S.mc("ngForOf",t.tables)}}function ji(i,e){if(1&i&&(S.Rb(0),S.Tb(1,"p-accordionTab"),S.Tb(2,"p-header"),S.Oc(3),S.gc(4,"uppercase"),S.Mc(5,Vi,1,0,"i",22),S.Sb(),S.Tb(6,"div",23),S.Mc(7,Zi,2,1,"div",24),S.Sb(),S.Sb(),S.Qb()),2&i){var t=e.$implicit,o=e.index,n=S.fc(2);S.Bb(3),S.Rc(" ",t.indice," ",S.hc(4,4,t.nome)," "),S.Bb(2),S.mc("ngIf",n.quantitaLavorata[o]>0),S.Bb(2),S.mc("ngIf",null==n.tables?null:n.tables.length)}}function Yi(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",3),S.Tb(1,"p-accordion",19,20),S.bc("onOpen",(function(i){return S.Ec(t),S.fc().onSelectAccordion(i)})),S.Mc(3,ji,8,6,"ng-container",21),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(3),S.mc("ngForOf",o.raggruppamenti)}}var qi,Qi=function(){return{marginTop:"70px"}},Ki=((qi=function(){function i(e,t,o,n,a,r,c,s,l){_classCallCheck(this,i),this.activeRoute=e,this.gestioneDomandaUmaService=t,this.httpClientLavorazioniUmaService=o,this.confirmationService=n,this.messageService=a,this.location=r,this.lavorazioneFabbricatiBuiderService=c,this.errorService=s,this.formatConverterService=l,this.changeFabbisogno=new S.n,this.ambitoLavorazioneEnum=ri,this.lavorazioniFabbricatiTipoEnum=ei}return _createClass(i,[{key:"ngOnInit",value:function(){this.raggruppamentoForm=new H.j({raggruppamento:new H.g}),this.initVariables(),this.loadRaggruppamenti()}},{key:"initVariables",value:function(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.nomeRaggruppamento=null,this.isValidFormTable=!0,this.colsArray=[],this.tables=[],this.datasources=[],this.quantitaLavorata=[],this.headersTable=[],this.raggruppamentoForm.controls.raggruppamento.setValue(null)}},{key:"onSelectAccordion",value:function(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.onChangeRaggruppamento(i)))}},{key:"openAccordionByIndex",value:function(i){this.accordion.tabs.forEach((function(e,t){e.selected=t==i}))}},{key:"onChangeForm",value:function(i){var e=this;this.isChangedInputTable=i.isChanged,this.changeFabbisogno.emit(this.isChangedInputTable),this.isValidFormTable=i.isValid,i&&i.action&&i.action.type&&"MULTIPLY_BY"===i.action.type&&this.tables.forEach((function(t,o){o===i.action.index&&t.datasource.forEach((function(i){i.GASOLIO=(e.formatConverterService.toNumber(i.volume)*e.formatConverterService.toNumber(i.mesi)).toString(),i.BENZINA=(e.formatConverterService.toNumber(i.volume)*e.formatConverterService.toNumber(i.mesi)).toString()}))}))}},{key:"goBack",value:function(){var i=this;this.isChangedInputTable?this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){i.location.back()},reject:function(){},key:"lavorazioni-dialog"}):this.location.back()}},{key:"saveLavorazioni",value:function(){var i=this;if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(O.a.raggruppamentiNotSelezionati,"tst-lav-fab"),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(O.a.datiNonValidi,"tst-lav-fab"),!1;var e=this.raggruppamentoForm.get("raggruppamento").value,t=this.lavorazioneFabbricatiBuiderService.lavorazioniViewModelToDichiarazioniFabbricatoDtoBuilder(e.lavorazioni);return console.log("Salvo dichiarazioni: ",t),this.saveFabbisognoSubscription=this.httpClientLavorazioniUmaService.saveFabbisogniFabbricati(this.idDomanda,t).subscribe((function(){i.isChangedInputTable=!1,i.changeFabbisogno.emit(i.isChangedInputTable),i.messageService.add(m.a.getToast("tst-lav-fab",m.b.success,O.a.salvataggioOKLavorazioniSuperficie)),i.loadRaggruppamenti()}),(function(e){return i.errorService.showError(e,"tst-lav-fab")})),!0}},{key:"loadRaggruppamenti",value:function(){var i=this;this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){i.idDomanda=e.idDomanda;var t=i.ctx===ei.COLTIVAZIONI_SOTTO_SERRA?i.ambitoLavorazioneEnum.SERRE:i.ambitoLavorazioneEnum.FABBRICATI,o=i.httpClientLavorazioniUmaService.getLavorazioni(i.idDomanda,t),n=i.httpClientLavorazioniUmaService.getFabbisogniFabbricati(i.idDomanda,t);return Object(si.a)([o,n])}))).subscribe((function(e){var t=_slicedToArray(e,2),o=t[0],n=t[1];i.raggruppamenti=i.lavorazioneFabbricatiBuiderService.fabbricatiDtoToRaggruppamentiLavorazioneViewModel(o,n),i.raggruppamenti=ai.orderBy(i.raggruppamenti,["indice"],["asc"]),i.calcolaQuantita()}),(function(e){return i.errorService.showError(e,"tst-lav-fab")}))}},{key:"showDialog",value:function(i){var e=this;this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){e.openedAccordion=i.index,e.onChangeRaggruppamento(i),e.openAccordionByIndex(e.openedAccordion)},reject:function(){e.openAccordionByIndex(e.openedAccordion)},key:"lavorazioni-dialog"})}},{key:"onChangeRaggruppamento",value:function(i){var e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.tables=[],this.colsArray=[],this.datasources=[],this.headersTable=[],this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable)}},{key:"calcolaQuantita",value:function(){var i=this;this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((function(e,t){i.quantitaLavorata[t]=0,e.lavorazioni.forEach((function(e){var o=i.formatConverterService.toNumber(e.BENZINA),n=i.formatConverterService.toNumber(e.GASOLIO);i.quantitaLavorata[t]=i.quantitaLavorata[t]+o+n}))}))}},{key:"splitDatasources",value:function(i){var e=this;if(i&&i.length){var t=ai.groupBy(i,"idFabbricato");Object.keys(t).forEach((function(i,o){var n,a=t[i],r=new ni.a;e.headersTable.push(e.defineHeader(a)),r.title=e.tables.length?"":e.nomeRaggruppamento;var c=e.ctx===ei.COLTIVAZIONI_SOTTO_SERRA?e.defineColumnsSottoSerraByTitle(a[0].tipo,o,"Quantit\xe0"):e.defineColumnsFabbricatiByTitle(a[0].tipo);e.colsArray.push(c),r.datasource=a,(n=e.datasources).push.apply(n,_toConsumableArray(r.datasource)),e.tables.push(r)}))}}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveFabbisognoSubscription&&this.saveFabbisognoSubscription.unsubscribe()}},{key:"defineHeader",value:function(i){if(i&&i.length)return[{key:"Comune",value:i[0].comuneProvincia},{key:"Particella",value:this.buildParticella(i[0])},{key:"Volume mc",value:i[0].volume||""}]}},{key:"buildParticella",value:function(i){var e;return this.formatConverterService.isEmptyString(i.subalterno)||(e="("+i.subalterno+")"),e?i.particella+e:i.particella}},{key:"defineColumnsFabbricatiByTitle",value:function(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Quantit\xe0";return[{field:"descrizioneCompleta",header:i,sortable:!1,font:ni.e.BOLD,width:"80%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:F.a.GASOLIO,suffix:"unitaDiMisura",header:e,sortable:!1,disabled:!1,inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},width:"20%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER}]}},{key:"defineColumnsSottoSerraByTitle",value:function(i,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Quantit\xe0";return[{field:"descrizioneCompleta",header:i,sortable:!1,font:ni.e.BOLD,width:"60%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"mesi",header:"Mesi",sortable:!1,disabled:!1,inputOpts:{pattern:"^([0-9])+$",maxLength:"1",max:6,action:{type:ni.b.MULTIPLY_BY,byField:this.quantitaLavorata,index:e}},width:"20%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER_ACTION},{field:F.a.GASOLIO,suffix:"unitaDiMisura",header:t,sortable:!1,disabled:!0,inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},width:"20%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER}]}}]),i}()).\u0275fac=function(i){return new(i||qi)(S.Nb(D.a),S.Nb(E),S.Nb(G),S.Nb(M.a),S.Nb(M.d),S.Nb(s.n),S.Nb(Fi),S.Nb(y.a),S.Nb(ki.a))},qi.\u0275cmp=S.Hb({type:qi,selectors:[["app-lavorazioni-fabbricati"]],viewQuery:function(i,e){var t;1&i&&S.Uc(Pi,!0),2&i&&S.Ac(t=S.cc())&&(e.accordion=t.first)},inputs:{inCompilazione:"inCompilazione",ctx:"ctx",richiestaCarburante:"richiestaCarburante"},outputs:{changeFabbisogno:"changeFabbisogno"},decls:16,vars:10,consts:[["key","tst-lav-fab"],[1,"p-grid","ui-fluid"],["novalidate","",1,"p-grid","m-0","w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid"],[1,"p-grid","p-align-center","py-4","w-100"],[1,"p-grid","m-0","p-align-center","color-primary"],["src","assets/img/icons/uma-icon/icon-fabbricati_black.svg",4,"ngIf"],["src","assets/img/icons/uma-icon/icon-farm_black.svg",4,"ngIf"],[1,"ml-2"],["class","fs-20",4,"ngIf"],["class","p-col-fixed",4,"ngIf"],[1,"p-grid","w-100"],["class","p-col",4,"ngIf"],["src","assets/img/icons/uma-icon/icon-fabbricati_black.svg"],["src","assets/img/icons/uma-icon/icon-farm_black.svg"],[1,"fs-20"],[1,"p-col-fixed"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[1,"p-col-12","align-self-center","w-100"],[4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","header","values","readonly","changedValueForm"],[1,"mb-1"]],template:function(i,e){1&i&&(S.Ob(0,"p-toast",0),S.Tb(1,"div",1),S.Tb(2,"form",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",3),S.Tb(7,"div",6),S.Mc(8,wi,1,0,"img",7),S.Mc(9,xi,1,0,"img",8),S.Tb(10,"span",9),S.Mc(11,Li,3,3,"strong",10),S.Mc(12,Gi,3,3,"strong",10),S.Sb(),S.Sb(),S.Sb(),S.Mc(13,Ui,2,0,"div",11),S.Sb(),S.Tb(14,"div",12),S.Mc(15,Yi,4,1,"div",13),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Kc(S.rc(9,Qi)),S.Bb(2),S.mc("formGroup",e.raggruppamentoForm),S.Bb(6),S.mc("ngIf",e.ctx==e.lavorazioniFabbricatiTipoEnum.COLTIVAZIONI_SOTTO_SERRA),S.Bb(1),S.mc("ngIf",e.ctx==e.lavorazioniFabbricatiTipoEnum.TRASFORMAZIONE_PRODOTTI),S.Bb(2),S.mc("ngIf",e.ctx==e.lavorazioniFabbricatiTipoEnum.COLTIVAZIONI_SOTTO_SERRA),S.Bb(1),S.mc("ngIf",e.ctx==e.lavorazioniFabbricatiTipoEnum.TRASFORMAZIONE_PRODOTTI),S.Bb(1),S.mc("ngIf",e.inCompilazione),S.Bb(2),S.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[N.a,H.I,H.t,H.k,s.t,k.b,bi.a,s.s,bi.c,M.c,hi.a],pipes:[mi.d,s.G],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}"]}),qi),Wi=["accordion"];function $i(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",13),S.Tb(1,"button",14),S.bc("click",(function(){return S.Ec(t),S.fc().saveLavorazioni()})),S.Sb(),S.Sb()}}function Ji(i,e){1&i&&S.Ob(0,"i",19)}function Xi(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div"),S.Tb(1,"app-a4g-multi-table",20),S.bc("changedValueForm",(function(i){return S.Ec(t),S.fc(3).onChangeForm(i)})),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit,n=e.index,a=S.fc(3);S.Bb(1),S.mc("title",o.title)("cols",a.colsArray[n])("values",o.datasource)("readonly",!a.inCompilazione)}}function ie(i,e){if(1&i&&(S.Rb(0),S.Tb(1,"p-accordionTab"),S.Tb(2,"p-header"),S.Oc(3),S.gc(4,"uppercase"),S.Mc(5,Ji,1,0,"i",18),S.Sb(),S.Mc(6,Xi,2,4,"div",17),S.Sb(),S.Qb()),2&i){var t=e.$implicit,o=e.index,n=S.fc(2);S.Bb(3),S.Rc(" ",t.indice," ",S.hc(4,4,t.nome)," "),S.Bb(2),S.mc("ngIf",n.quantitaLavorata[o]>0),S.Bb(1),S.mc("ngForOf",n.tables)}}function ee(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",3),S.Tb(1,"p-accordion",15,16),S.bc("onOpen",(function(i){return S.Ec(t),S.fc().onSelectAccordion(i)})),S.Mc(3,ie,7,6,"ng-container",17),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(3),S.mc("ngForOf",o.raggruppamenti)}}var te,oe=function(){return{marginTop:"70px"}},ne=((te=function(){function i(e,t,o,n,a,r,c,s){_classCallCheck(this,i),this.activeRoute=e,this.messageService=t,this.confirmationService=o,this.gestioneDomandaUmaService=n,this.httpClientLavorazioniUmaService=a,this.lavorazioniBuiderService=r,this.location=c,this.errorService=s,this.changeFabbisogno=new S.n,this.ambitoLavorazioneEnum=ri}return _createClass(i,[{key:"ngOnInit",value:function(){this.raggruppamentoForm=new H.j({raggruppamento:new H.g}),this.initVariables(),this.loadRaggruppamenti()}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveFabbisogniSubscription&&this.saveFabbisogniSubscription.unsubscribe()}},{key:"loadRaggruppamenti",value:function(){var i=this;this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){i.idDomanda=e.idDomanda;var t=i.httpClientLavorazioniUmaService.getLavorazioni(i.idDomanda,i.ambitoLavorazioneEnum.ZOOTECNIA),o=i.httpClientLavorazioniUmaService.getDichiarazioni(i.idDomanda,i.ambitoLavorazioneEnum.ZOOTECNIA);return Object(si.a)([t,o])}))).subscribe((function(e){var t=_slicedToArray(e,2),o=t[0],n=t[1];i.raggruppamenti=i.lavorazioniBuiderService.raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(o,n),i.raggruppamenti=ai.orderBy(i.raggruppamenti,["indice"],["asc"]),i.calcolaQuantita()}),(function(e){return i.errorService.showError(e,"tst-lav-zoot")}))}},{key:"calcolaQuantita",value:function(){var i=this;this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((function(e,t){i.quantitaLavorata[t]=0,e.lavorazioni.forEach((function(e){var o=isNaN(Number(e.BENZINA))?0:Number(e.BENZINA),n=isNaN(Number(e.GASOLIO))?0:Number(e.GASOLIO);i.quantitaLavorata[t]=i.quantitaLavorata[t]+o+n}))}))}},{key:"initVariables",value:function(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.nomeRaggruppamento=null,this.isValidFormTable=!0,this.tables=[],this.colsArray=[],this.datasources=[],this.quantitaLavorata=[],this.raggruppamentoForm.controls.raggruppamento.setValue(null)}},{key:"goBack",value:function(){var i=this;this.isChangedInputTable?this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){i.location.back()},reject:function(){},key:"lavorazioni-dialog"}):this.location.back()}},{key:"onSelectAccordion",value:function(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.onChangeRaggruppamento(i)))}},{key:"openAccordionByIndex",value:function(i){this.accordion.tabs.forEach((function(e,t){e.selected=t==i}))}},{key:"onChangeRaggruppamento",value:function(i){var e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1,this.changeFabbisogno.emit(this.isChangedInputTable)}},{key:"onChangeForm",value:function(i){this.isChangedInputTable=i.isChanged,this.changeFabbisogno.emit(this.isChangedInputTable),this.isValidFormTable=i.isValid}},{key:"saveLavorazioni",value:function(){var i=this;if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(O.a.raggruppamentiNotSelezionati,"tst-lav-zoot"),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(O.a.datiNonValidi,"tst-lav-zoot"),!1;var e=this.raggruppamentoForm.get("raggruppamento").value,t=this.lavorazioniBuiderService.lavorazioniViewModelToDichiarazioniDtoBuilder(e.lavorazioni);return console.log("Salvo dichiarazioni: ",t),this.saveFabbisogniSubscription=this.httpClientLavorazioniUmaService.saveFabbisogni(this.idDomanda,t).subscribe((function(){i.isChangedInputTable=!1,i.changeFabbisogno.emit(i.isChangedInputTable),i.messageService.add(m.a.getToast("tst-lav-zoot",m.b.success,O.a.salvataggioOKLavorazioniSuperficie)),i.loadRaggruppamenti()}),(function(e){return i.errorService.showError(e,"tst-lav-zoot")})),!0}},{key:"splitDatasources",value:function(i){var e=this,t=ai.groupBy(i,"tipo");this.tables=[],this.colsArray=[],this.datasources=[],Object.keys(t).forEach((function(i){var o,n=new ni.a,a=e.defineColumnsByTitle(ci[i]);n.title=e.tables.length?"":e.nomeRaggruppamento,e.colsArray.push(a),n.datasource=t[i],(o=e.datasources).push.apply(o,_toConsumableArray(n.datasource)),e.tables.push(n)}))}},{key:"showDialog",value:function(i){var e=this;this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){e.openedAccordion=i.index,e.onChangeRaggruppamento(i),e.openAccordionByIndex(e.openedAccordion)},reject:function(){e.openAccordionByIndex(e.openedAccordion)},key:"lavorazioni-dialog"})}},{key:"defineColumnsByTitle",value:function(i){return[{field:"descrizioneCompleta",header:i,sortable:!1,font:ni.e.BOLD,width:"78%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:F.a.GASOLIO,header:"Quantit\xe0",sortable:!1,disabled:!1,width:"22%",inputOpts:{pattern:"^(([0-9])([0-9]+)?([,][0-9]{1})?)?$",maxLength:"7"},suffix:"unitaDiMisura",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER}]}}]),i}()).\u0275fac=function(i){return new(i||te)(S.Nb(D.a),S.Nb(M.d),S.Nb(M.a),S.Nb(E),S.Nb(G),S.Nb(ui),S.Nb(s.n),S.Nb(y.a))},te.\u0275cmp=S.Hb({type:te,selectors:[["app-lavorazioni-zootecnia"]],viewQuery:function(i,e){var t;1&i&&S.Uc(Wi,!0),2&i&&S.Ac(t=S.cc())&&(e.accordion=t.first)},inputs:{inCompilazione:"inCompilazione",richiestaCarburante:"richiestaCarburante"},outputs:{changeFabbisogno:"changeFabbisogno"},decls:16,vars:9,consts:[["key","tst-lav-zoot"],[1,"p-grid","ui-fluid"],["novalidate","",1,"p-grid","m-0","w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid"],[1,"p-grid","p-align-center","py-4","w-100"],[1,"p-grid","m-0","p-align-center","color-primary"],["src","assets/img/icons/uma-icon/icon-zootecnia_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed",4,"ngIf"],[1,"p-grid","w-100"],["class","p-col",4,"ngIf"],[1,"p-col-fixed"],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","values","readonly","changedValueForm"]],template:function(i,e){1&i&&(S.Ob(0,"p-toast",0),S.Tb(1,"div",1),S.Tb(2,"form",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",3),S.Tb(7,"div",6),S.Ob(8,"img",7),S.Tb(9,"span",8),S.Tb(10,"strong",9),S.Oc(11),S.gc(12,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Mc(13,$i,2,0,"div",10),S.Sb(),S.Tb(14,"div",11),S.Mc(15,ee,4,1,"div",12),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Kc(S.rc(8,oe)),S.Bb(2),S.mc("formGroup",e.raggruppamentoForm),S.Bb(9),S.Qc("",S.hc(12,6,"UMA.LAVORAZIONI_ZOOTECNIA")," / Raggruppamenti"),S.Bb(2),S.mc("ngIf",e.inCompilazione),S.Bb(2),S.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[N.a,H.I,H.t,H.k,s.t,k.b,bi.a,s.s,bi.c,M.c,hi.a],pipes:[mi.d,s.G],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}"]}),te),ae=["tabView"];function re(i,e){1&i&&(S.Tb(0,"div",13),S.Tb(1,"div",14),S.Ob(2,"img",15),S.Sb(),S.Tb(3,"div",3),S.Oc(4,"Lavorazioni a superficie"),S.Sb(),S.Sb())}function ce(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-lavorazioni-superficie",16),S.bc("changeFabbisogno",(function(i){return S.Ec(t),S.fc().changeFabbisogno(i)})),S.Sb()}if(2&i){var o=S.fc();S.mc("richiestaCarburante",o.richiestaCarburante)("inCompilazione",o.inCompilazione)}}function se(i,e){1&i&&(S.Tb(0,"div",17),S.Tb(1,"div",14),S.Ob(2,"img",18),S.Sb(),S.Tb(3,"div",3),S.Oc(4,"Altre lavorazioni"),S.Sb(),S.Sb())}function le(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-lavorazioni-altre",16),S.bc("changeFabbisogno",(function(i){return S.Ec(t),S.fc().changeFabbisogno(i)})),S.Sb()}if(2&i){var o=S.fc();S.mc("richiestaCarburante",o.richiestaCarburante)("inCompilazione",o.inCompilazione)}}function ue(i,e){1&i&&(S.Tb(0,"div",17),S.Tb(1,"div",14),S.Ob(2,"img",19),S.Sb(),S.Tb(3,"div",3),S.Oc(4,"Lavorazioni coltivazioni sotto serra"),S.Sb(),S.Sb())}function be(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-lavorazioni-fabbricati",20),S.bc("changeFabbisogno",(function(i){return S.Ec(t),S.fc().changeFabbisogno(i)})),S.Sb()}if(2&i){var o=S.fc();S.mc("richiestaCarburante",o.richiestaCarburante)("inCompilazione",o.inCompilazione)("ctx",o.fabbricatoEnum.COLTIVAZIONI_SOTTO_SERRA)}}function he(i,e){1&i&&(S.Tb(0,"div",17),S.Tb(1,"div",14),S.Ob(2,"img",21),S.Sb(),S.Tb(3,"div",3),S.Oc(4,"Lavorazioni trasformazioni prodotti"),S.Sb(),S.Sb())}function me(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-lavorazioni-fabbricati",20),S.bc("changeFabbisogno",(function(i){return S.Ec(t),S.fc().changeFabbisogno(i)})),S.Sb()}if(2&i){var o=S.fc();S.mc("richiestaCarburante",o.richiestaCarburante)("inCompilazione",o.inCompilazione)("ctx",o.fabbricatoEnum.TRASFORMAZIONE_PRODOTTI)}}function pe(i,e){1&i&&(S.Tb(0,"div",17),S.Tb(1,"div",14),S.Ob(2,"img",22),S.Sb(),S.Tb(3,"div",3),S.Oc(4,"Lavorazioni zootecnia"),S.Sb(),S.Sb())}function de(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-lavorazioni-zootecnia",16),S.bc("changeFabbisogno",(function(i){return S.Ec(t),S.fc().changeFabbisogno(i)})),S.Sb()}if(2&i){var o=S.fc();S.mc("richiestaCarburante",o.richiestaCarburante)("inCompilazione",o.inCompilazione)}}var ge,fe=((ge=function(){function i(e,t,o){_classCallCheck(this,i),this.confirmationService=e,this.authService=t,this.messageService=o,this.nextStep=new S.n,this.prevStep=new S.n,this.fabbricatoEnum=ei}return _createClass(i,[{key:"ngOnInit",value:function(){this.controllaIstruttoreUMA(),this.prevActiveIndex=this.getDefaultActiveIndex()}},{key:"changeFabbisogno",value:function(i){this.isChangedFabbisogno=i}},{key:"onChangeTab",value:function(i){var e=this;this.openTabByIndex(this.prevActiveIndex),this.isChangedFabbisogno?this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){e.openTabByIndex(i.index),e.activeIndex=i.index,e.prevActiveIndex=e.activeIndex,e.isChangedFabbisogno=!1},reject:function(){},key:"lavorazioni-dialog"}):(this.openTabByIndex(i.index),this.activeIndex=i.index,this.prevActiveIndex=this.activeIndex)}},{key:"goPrevStep",value:function(){var i=this;this.inCompilazione&&this.isChangedFabbisogno?this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){i.prevStep.emit(l.LAVORAZIONI)},reject:function(){},key:"lavorazioni-dialog"}):this.prevStep.emit(l.LAVORAZIONI)}},{key:"goNextStep",value:function(){var i=this;this.inCompilazione&&this.isChangedFabbisogno?this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){i.nextStep.emit(l.LAVORAZIONI)},reject:function(){},key:"lavorazioni-dialog"}):this.nextStep.emit(l.LAVORAZIONI)}},{key:"getDefaultActiveIndex",value:function(){return this.richiestaCarburante&&(this.richiestaCarburante.haMacchineBenzina||this.richiestaCarburante.haMacchineGasolio)?(this.activeIndex=this.richiestaCarburante.haSuperfici?ti.SUPERFICI:ti.ALTRE,this.activeIndex):(this.messageService.add(m.a.getToast("tst",m.b.error,O.a.macchineNotPresenti)),this.activeIndex=null,this.activeIndex)}},{key:"openTabByIndex",value:function(i){this.tabView.tabs.forEach((function(e,t){e.selected=t==i}))}},{key:"controllaIstruttoreUMA",value:function(){this.authService.userSelectedRole!=A.a.roleIstruttoreUMA&&this.authService.userSelectedRole!=A.a.roleAppag||(this.inCompilazione=!1)}}]),i}()).\u0275fac=function(i){return new(i||ge)(S.Nb(M.a),S.Nb(A.a),S.Nb(M.d))},ge.\u0275cmp=S.Hb({type:ge,selectors:[["app-lavorazioni-indice"]],viewQuery:function(i,e){var t;1&i&&S.Jc(ae,!0),2&i&&S.Ac(t=S.cc())&&(e.tabView=t.first)},inputs:{richiestaCarburante:"richiestaCarburante",inCompilazione:"inCompilazione",idFascicolo:"idFascicolo"},outputs:{nextStep:"nextStep",prevStep:"prevStep"},decls:30,vars:11,consts:[["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","lavorazioni-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],[1,"p-grid"],[1,"p-grid","w-100"],[1,"p-col"],["pButton","","type","button","icon","pi pi-chevron-circle-left","iconPos","left","label","INDIETRO",1,"w-10m",3,"click"],[1,"p-col-fixed","p-0"],[1,"p-grid","m-0"],["pButton","","type","button","icon","pi pi-chevron-circle-right","iconPos","right","label","PROCEDI",1,"w-10m",3,"click"],["orientation","left",1,"p-col",3,"activeIndex","onChange"],["tabView",""],[3,"cache","disabled"],["pTemplate","header"],["pTemplate","content"],[1,"p-grid","p-align-center","menu-item"],[1,"p-col-fixed"],["src","assets/img/icons/uma-icon/icon-superficie.svg"],[3,"richiestaCarburante","inCompilazione","changeFabbisogno"],[1,"p-grid","p-align-center"],["src","assets/img/icons/uma-icon/icon-altre.svg"],["src","assets/img/icons/uma-icon/icon-fabbricati.svg"],[3,"richiestaCarburante","inCompilazione","ctx","changeFabbisogno"],["src","assets/img/icons/uma-icon/icon-farm.svg"],["src","assets/img/icons/uma-icon/icon-zootecnia.svg"]],template:function(i,e){1&i&&(S.Ob(0,"p-confirmDialog",0),S.Tb(1,"div",1),S.Tb(2,"div",2),S.Tb(3,"div",3),S.Tb(4,"button",4),S.bc("click",(function(){return e.goPrevStep()})),S.Sb(),S.Sb(),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Ob(7,"div",3),S.Tb(8,"div",3),S.Tb(9,"button",7),S.bc("click",(function(){return e.goNextStep()})),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(10,"div",2),S.Tb(11,"div",3),S.Tb(12,"div",6),S.Tb(13,"p-tabView",8,9),S.bc("onChange",(function(i){return e.onChangeTab(i)})),S.Tb(15,"p-tabPanel",10),S.Mc(16,re,5,0,"ng-template",11),S.Mc(17,ce,1,2,"ng-template",12),S.Sb(),S.Tb(18,"p-tabPanel",10),S.Mc(19,se,5,0,"ng-template",11),S.Mc(20,le,1,2,"ng-template",12),S.Sb(),S.Tb(21,"p-tabPanel",10),S.Mc(22,ue,5,0,"ng-template",11),S.Mc(23,be,1,3,"ng-template",12),S.Sb(),S.Tb(24,"p-tabPanel",10),S.Mc(25,he,5,0,"ng-template",11),S.Mc(26,me,1,3,"ng-template",12),S.Sb(),S.Tb(27,"p-tabPanel",10),S.Mc(28,pe,5,0,"ng-template",11),S.Mc(29,de,1,2,"ng-template",12),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Bb(13),S.mc("activeIndex",e.activeIndex),S.Bb(2),S.mc("cache",!1)("disabled",!((null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)&&null!=e.richiestaCarburante&&e.richiestaCarburante.haSuperfici)),S.Bb(3),S.mc("cache",!1)("disabled",!(null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)),S.Bb(3),S.mc("cache",!1)("disabled",!((null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)&&null!=e.richiestaCarburante&&e.richiestaCarburante.haSerre)),S.Bb(3),S.mc("cache",!1)("disabled",!((null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)&&null!=e.richiestaCarburante&&e.richiestaCarburante.haFabbricati)),S.Bb(3),S.mc("cache",!1)("disabled",!(null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineGasolio||null!=e.richiestaCarburante&&e.richiestaCarburante.haMacchineBenzina)))},directives:[_.a,k.b,oi.b,oi.a,M.e,Ii,Bi,Ki,ne],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]     p-accordiontab .pi{color:#fff}[_nghost-%COMP%]     .ui-tabview.ui-tabview-left{display:flex;flex-wrap:wrap;margin-right:-.5em;margin-left:-.5em;margin-top:-.5em}[_nghost-%COMP%]     .ui-tabview.ui-tabview-left>.ui-tabview-nav{display:flex;flex-wrap:wrap;align-items:center;min-height:22em}[_nghost-%COMP%]     .ui-tabview .ui-tabview-nav>li.ui-state-active{background-color:#f6f6f7}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),ge),ve=t("R5Gv"),Se=t("Q01X"),Ce=t("sazn"),Oe=t("sFKl"),Te=t("RFNi"),Ie=t("ucsd"),ze=t("GLSp"),Ae=t("NYM0"),Ee=t("P028");function ye(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",8),S.Tb(1,"button",39),S.bc("click",(function(){return S.Ec(t),S.fc().saveFabbisogno()})),S.Sb(),S.Sb()}}function Re(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",8),S.Tb(1,"button",40),S.bc("click",(function(){return S.Ec(t),S.fc().goNextStep()})),S.Sb(),S.Sb()}}function De(i,e){1&i&&(S.Tb(0,"div",18),S.Tb(1,"div",19),S.Oc(2," Quantitativo gi\xe0 prelevato (anno in corso) "),S.Sb(),S.Ob(3,"div",16),S.Tb(4,"div",8),S.Ob(5,"input",41),S.Sb(),S.Tb(6,"div",8),S.Ob(7,"input",42),S.Sb(),S.Tb(8,"div",8),S.Ob(9,"input",43),S.Sb(),S.Ob(10,"div",8),S.Sb())}function Me(i,e){1&i&&S.Ob(0,"p-message",46)}function Ne(i,e){1&i&&S.Ob(0,"p-message",47)}function _e(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Me,1,0,"p-message",44),S.Mc(2,Ne,1,0,"p-message",45),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",t.fabbisogniForm.get("richiestoGasolio").errors.pattern),S.Bb(1),S.mc("ngIf",t.fabbisogniForm.get("richiestoGasolio").errors.max)}}function Be(i,e){1&i&&S.Ob(0,"p-message",46)}function ke(i,e){1&i&&S.Ob(0,"p-message",47)}function Fe(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Be,1,0,"p-message",44),S.Mc(2,ke,1,0,"p-message",45),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",t.fabbisogniForm.get("richiestoBenzina").errors.pattern),S.Bb(1),S.mc("ngIf",t.fabbisogniForm.get("richiestoBenzina").errors.max)}}function Pe(i,e){1&i&&S.Ob(0,"p-message",46)}function we(i,e){1&i&&S.Ob(0,"p-message",47)}function xe(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Pe,1,0,"p-message",44),S.Mc(2,we,1,0,"p-message",45),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",t.fabbisogniForm.get("richiestoGasolioSerre").errors.pattern),S.Bb(1),S.mc("ngIf",t.fabbisogniForm.get("richiestoGasolioSerre").errors.max)}}function Le(i,e){1&i&&S.Ob(0,"p-message",46)}function Ge(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Le,1,0,"p-message",44),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",t.fabbisogniForm.controls.richiestoGasolioTerzi.errors.pattern)}}function Ue(i,e){if(1&i&&S.Ob(0,"p-message",49),2&i){var t=S.fc(2);S.nc("text",t.umaMessages.mandatory)}}function Ve(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Ue,1,1,"p-message",48),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",t.fabbisogniForm.get("note").errors.required)}}var He,Ze,je,Ye=function(){return{marginTop:"70px"}},qe=function(){return{limit:"ammissibileGasolio"}},Qe=function(){return{limit:"ammissibileBenzina"}},Ke=function(){return{limit:"ammissibileGasolioSerre"}},We=((He=function(){function i(e,t,o,n,a,r,c,s,l,u,b,h,m,p,d){_classCallCheck(this,i),this.activeRoute=e,this.httpClientLavorazioniUmaService=t,this.httpClientDomandaUmaService=o,this.httpClientDichiarazioneConsumiUmaService=n,this.httpClientMacchineUmaService=a,this.confirmationService=r,this.gestioneDomandaUmaService=c,this.authService=s,this.messageService=l,this.errorService=u,this.formService=b,this.nullCheckService=h,this.dateUtilService=m,this.navigatorService=p,this.converterService=d,this.nextStep=new S.n,this.prevStep=new S.n,this.STATO_RICHIESTA_UMA=z.a,this.umaMessages=O.a}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.controllaIstruttoreUMA(),this.initVariables(),this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){return i.httpClientLavorazioniUmaService.getDomandaById(e.idDomanda)})),Object(h.a)((function(e){return i.errorService.showError(e,"tst-fabbisogno"),u.a})),Object(b.a)((function(e){i.richiestaCarburante=e;var t=i.httpClientDomandaUmaService.getCarburanteAmmissibile(i.richiestaCarburante.id.toString()),o=i.httpClientDichiarazioneConsumiUmaService.getResiduoAnnoPrecedente(i.richiestaCarburante.cuaa,i.richiestaCarburante.campagna-1,[Ie.a.PROTOCOLLATA]),n=i.httpClientDomandaUmaService.getPrelieviByCuaaAndCampagna(i.richiestaCarburante.cuaa,i.richiestaCarburante.campagna.toString(),i.dateUtilService.toLocalDate(i.richiestaCarburante.dataPresentazione));return Object(si.a)([t,o,n])}))).subscribe((function(e){var t,o,n,a=_slicedToArray(e,3),r=a[0],c=a[1],s=a[2];if(i.isRettifica=null!=i.richiestaCarburante.idRettificata,null!=i.richiestaCarburante.idRettificata&&i.richiestaCarburante.stato===i.STATO_RICHIESTA_UMA.IN_COMPILAZIONE&&i.fabbisogniForm.get("note").setValidators(H.G.required),c&&c.length>0&&c[0]&&c[0].rimanenza){var l=c[0].rimanenza;i.fabbisogniForm.get("residuoGasolio").setValue(null==l.gasolio?0:l.gasolio),i.fabbisogniForm.get("residuoBenzina").setValue(null==l.benzina?0:l.benzina),i.fabbisogniForm.get("residuoGasolioSerre").setValue(null==l.gasolioSerre?0:l.gasolioSerre),i.fabbisogniForm.get("residuoGasolioTerzi").setValue(null==l.gasolioTerzi?0:l.gasolioTerzi)}r&&(i.fabbisogniForm.get("ammissibileGasolio").setValue(r.gasolio||"0"),i.fabbisogniForm.get("ammissibileBenzina").setValue(r.benzina||"0"),i.fabbisogniForm.get("ammissibileGasolioSerre").setValue(r.gasolioSerre||"0")),i.isRettifica&&(i.fabbisogniForm.get("prelevatoGasolio").setValue(null===(t=null==s?void 0:s.totale)||void 0===t?void 0:t.gasolio),i.fabbisogniForm.get("prelevatoBenzina").setValue(null===(o=null==s?void 0:s.totale)||void 0===o?void 0:o.benzina),i.fabbisogniForm.get("prelevatoGasolioSerre").setValue(null===(n=null==s?void 0:s.totale)||void 0===n?void 0:n.gasolioSerre)),i.fabbisogniForm.get("richiestoGasolio").setValue(null!=i.richiestaCarburante.carburanteRichiesto&&null!=i.richiestaCarburante.carburanteRichiesto.gasolio?i.richiestaCarburante.carburanteRichiesto.gasolio:null),i.fabbisogniForm.get("richiestoBenzina").setValue(null!=i.richiestaCarburante.carburanteRichiesto&&null!=i.richiestaCarburante.carburanteRichiesto.benzina?i.richiestaCarburante.carburanteRichiesto.benzina:null),i.fabbisogniForm.get("richiestoGasolioSerre").setValue(null!=i.richiestaCarburante.carburanteRichiesto&&null!=i.richiestaCarburante.carburanteRichiesto.gasolioSerre?i.richiestaCarburante.carburanteRichiesto.gasolioSerre:null),i.fabbisogniForm.get("richiestoGasolioTerzi").setValue(null!=i.richiestaCarburante.carburanteRichiesto&&null!=i.richiestaCarburante.carburanteRichiesto.gasolioTerzi?i.richiestaCarburante.carburanteRichiesto.gasolioTerzi:null),i.fabbisogniForm.get("note").setValue(i.richiestaCarburante.note||null)}),(function(e){return i.errorService.showError(e,"tst-fabbisogno")}))}},{key:"initVariables",value:function(){this.fabbisognoDichiarato=this.gestioneDomandaUmaService.getTipoCarburanteDichiarato(this.richiestaCarburante),this.initForm()}},{key:"goPrevStep",value:function(){var i=this;this.inCompilazione?this.confirmationService.confirm({message:O.a.datiFabbisognoEliminazioneAlert,accept:function(){i.updateDichiarazioniSubscription=i.httpClientLavorazioniUmaService.updateDomandaUma(i.richiestaCarburante.id.toString(),i.toCarburanteRichiestoDtoWithNull()).subscribe((function(){i.messageService.add(m.a.getToast("tst-fabbisogno",m.b.error,O.a.fabbisognoDatiEliminati)),i.prevStep.emit(l.FABBISOGNO)}),(function(e){return i.errorService.showError(e,"tst-fabbisogno")}))},reject:function(){},key:"fabbisogno-dialog"}):this.prevStep.emit(l.FABBISOGNO)}},{key:"goNextStep",value:function(){this.isRichiestoAssegnatoInserito()?this.fabbisogniForm.pristine&&this.fabbisogniForm.untouched?this.isRichiestoAssegnatoEqualsZeroWithAmmissibile()||this.isAmmissibileEqualsZero()?this.showWarningDialog():this.validaRichiesta():this.errorService.showErrorWithMessage(O.a.fabbisognoDatiNonSalvati,"tst-fabbisogno"):this.errorService.showErrorWithMessage(O.a.richiestoAssegnatoObbligatorio,"tst-fabbisogno")}},{key:"validaRichiesta",value:function(){var i=this;this.validaSubscription=this.httpClientMacchineUmaService.validaRichiestaCarburante(this.richiestaCarburante.id.toString()).subscribe((function(e){i.nextStep.emit(l.FABBISOGNO)}),(function(e){i.confirmationService.confirm({message:m.a.fascicoloNonValido,accept:function(){i.deleteSubscription=i.httpClientDomandaUmaService.deleteDomandaById(i.richiestaCarburante.id.toString()).subscribe((function(){return i.messageService.add(m.a.getToast("tst-eliminazione",m.b.success,O.a.cancellazioneDomandaOK))}),(function(e){return i.errorService.showError(e,"tst-fabbisogno")}))},reject:function(){},key:"fabbisogno-dialog"})}))}},{key:"onCloseToastEliminazione",value:function(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo.toString())}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveDichiarazioniSubscription&&this.saveDichiarazioniSubscription.unsubscribe(),this.updateDichiarazioniSubscription&&this.updateDichiarazioniSubscription.unsubscribe(),this.validaSubscription&&this.validaSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe()}},{key:"saveFabbisogno",value:function(){var i=this;if(this.formService.validateFormByErrors(this.fabbisogniForm,["max","pattern","required"]),this.fabbisogniForm.get("note").hasError("required"))this.errorService.showErrorWithMessage(O.a.noteRettificaObbligatorio,"tst-fabbisogno");else if(this.fabbisogniForm.valid)if(this.fabbisogniForm.valid){if(this.isRichiestoAssegnatoInserito())return this.fillWithZeros(),this.saveDichiarazioniSubscription=this.httpClientLavorazioniUmaService.updateDomandaUma(this.richiestaCarburante.id.toString(),this.toCarburanteRichiestoDto()).subscribe((function(){i.messageService.add(m.a.getToast("tst-fabbisogno",m.b.success,O.a.salvataggioOKFabbisogno)),i.fabbisogniForm.markAsPristine(),i.fabbisogniForm.markAsUntouched()}),(function(e){return i.errorService.showError(e,"tst-fabbisogno")})),!0;this.errorService.showErrorWithMessage(O.a.richiestoAssegnatoObbligatorio,"tst-fabbisogno")}else this.errorService.showErrorWithMessage(O.a.datiNonValidi,"tst-fabbisogno");else this.errorService.showErrorWithMessage(O.a.datiNonValidi,"tst-fabbisogno")}},{key:"initForm",value:function(){this.fabbisogniForm=new H.j({residuoGasolio:new H.g({value:"0",disabled:!0}),residuoBenzina:new H.g({value:"0",disabled:!0}),residuoGasolioSerre:new H.g({value:"0",disabled:!0}),residuoGasolioTerzi:new H.g({value:"0",disabled:!0}),ammissibileGasolio:new H.g({value:"0",disabled:!0}),ammissibileBenzina:new H.g({value:"0",disabled:!0}),ammissibileGasolioSerre:new H.g({value:"0",disabled:!0}),prelevatoGasolio:new H.g({value:"0",disabled:!0}),prelevatoBenzina:new H.g({value:"0",disabled:!0}),prelevatoGasolioSerre:new H.g({value:"0",disabled:!0}),richiestoGasolio:new H.g({value:null,disabled:!this.inCompilazione||!this.fabbisognoDichiarato||!this.fabbisognoDichiarato.gasolio}),richiestoBenzina:new H.g({value:null,disabled:!this.inCompilazione||!this.fabbisognoDichiarato||!this.fabbisognoDichiarato.benzina}),richiestoGasolioSerre:new H.g({value:null,disabled:!this.inCompilazione}),richiestoGasolioTerzi:new H.g({value:null,disabled:!this.inCompilazione}),note:new H.g({value:null,disabled:!this.inCompilazione})})}},{key:"fillWithZeros",value:function(){this.nullCheckService.isEmpty(this.fabbisogniForm.get("richiestoGasolio").value)&&this.fabbisogniForm.get("richiestoGasolio").setValue("0"),this.nullCheckService.isEmpty(this.fabbisogniForm.get("richiestoBenzina").value)&&this.fabbisogniForm.get("richiestoBenzina").setValue("0"),this.nullCheckService.isEmpty(this.fabbisogniForm.get("richiestoGasolioSerre").value)&&this.fabbisogniForm.get("richiestoGasolioSerre").setValue("0"),this.nullCheckService.isEmpty(this.fabbisogniForm.get("richiestoGasolioTerzi").value)&&this.fabbisogniForm.get("richiestoGasolioTerzi").setValue("0")}},{key:"showWarningDialog",value:function(){var i=this;this.confirmationService.confirm({message:O.a.fabbisognoZero,accept:function(){i.validaRichiesta()},reject:function(){},key:"fabbisogno-dialog"})}},{key:"isRichiestoAssegnatoInserito",value:function(){var i=!0,e=this.fabbisogniForm.get("richiestoGasolio").value,t=this.fabbisogniForm.get("richiestoBenzina").value,o=this.fabbisogniForm.get("richiestoGasolioSerre").value,n=this.fabbisogniForm.get("richiestoGasolioTerzi").value;return null!=e&&!ai.isEmpty(e.toString())||null!=t&&!ai.isEmpty(t.toString())||null!=o&&!ai.isEmpty(o.toString())||null!=n&&!ai.isEmpty(n.toString())||(i=!1),i}},{key:"isRichiestoAssegnatoEqualsZeroWithAmmissibile",value:function(){var i=!1,e=this.fabbisogniForm.get("richiestoGasolio").value,t=this.fabbisogniForm.get("richiestoBenzina").value,o=this.fabbisogniForm.get("richiestoGasolioSerre").value,n=this.fabbisogniForm.get("ammissibileGasolio").value,a=this.fabbisogniForm.get("ammissibileBenzina").value,r=this.fabbisogniForm.get("ammissibileGasolioSerre").value;return("0"==e&&this.converterService.toNumber(n)>0||"0"==t&&this.converterService.toNumber(a)>0||"0"==o&&this.converterService.toNumber(r)>0)&&(i=!0),i}},{key:"isAmmissibileEqualsZero",value:function(){var i=!1,e=this.fabbisogniForm.get("richiestoGasolio").value,t=this.fabbisogniForm.get("richiestoBenzina").value,o=this.fabbisogniForm.get("richiestoGasolioSerre").value,n=this.fabbisogniForm.get("ammissibileGasolio").value,a=this.fabbisogniForm.get("ammissibileBenzina").value,r=this.fabbisogniForm.get("ammissibileGasolioSerre").value;return"0"==e&&0==this.converterService.toNumber(n)&&"0"==t&&0==this.converterService.toNumber(a)&&"0"==o&&0==this.converterService.toNumber(r)&&(i=!0),i}},{key:"toCarburanteRichiestoDto",value:function(){var i=new x;return i.carburanteRichiesto=new Te.a,i.carburanteRichiesto.gasolio=+this.fabbisogniForm.get("richiestoGasolio").value,i.carburanteRichiesto.benzina=+this.fabbisogniForm.get("richiestoBenzina").value,i.carburanteRichiesto.gasolioSerre=+this.fabbisogniForm.get("richiestoGasolioSerre").value,i.carburanteRichiesto.gasolioTerzi=+this.fabbisogniForm.get("richiestoGasolioTerzi").value,i.note=this.fabbisogniForm.get("note").value,i}},{key:"toCarburanteRichiestoDtoWithNull",value:function(){var i=new x;return i.carburanteRichiesto=new Te.a,i.carburanteRichiesto.gasolio=null,i.carburanteRichiesto.benzina=null,i.carburanteRichiesto.gasolioSerre=null,i.carburanteRichiesto.gasolioTerzi=null,i.note=null,i}},{key:"controllaIstruttoreUMA",value:function(){this.authService.userSelectedRole!=A.a.roleIstruttoreUMA&&this.authService.userSelectedRole!=A.a.roleAppag||(this.inCompilazione=!1)}}]),i}()).\u0275fac=function(i){return new(i||He)(S.Nb(D.a),S.Nb(G),S.Nb(g.a),S.Nb(Oe.a),S.Nb(C),S.Nb(M.a),S.Nb(E),S.Nb(A.a),S.Nb(M.d),S.Nb(y.a),S.Nb(Ce.a),S.Nb(Se.a),S.Nb(d.a),S.Nb(ve.a),S.Nb(ki.a))},He.\u0275cmp=S.Hb({type:He,selectors:[["app-fabbisogno"]],inputs:{richiestaCarburante:"richiestaCarburante",idFascicolo:"idFascicolo",inCompilazione:"inCompilazione"},outputs:{nextStep:"nextStep",prevStep:"prevStep"},decls:78,vars:20,consts:[["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","fabbisogno-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["key","tst-fabbisogno"],["position","top-center","key","tst-eliminazione",3,"baseZIndex","onClose"],[1,"p-grid","ui-fluid"],[1,"p-col","p-0","w-100"],["novalidate","",1,"w-100",3,"formGroup"],[1,"p-col","p-0"],[1,"p-grid","w-100"],[1,"p-col"],["pButton","","type","button","icon","pi pi-chevron-circle-left","iconPos","left","label","INDIETRO",1,"w-10m",3,"click"],[1,"p-col-fixed","p-0"],[1,"p-grid","m-0"],["class","p-col",4,"ngIf"],[1,"p-col","mx-2","mt-2","ui-header"],[1,"p-grid","text-center"],[1,"p-col-2"],[1,"p-col-1"],[1,"p-col","p-col-align-center"],[1,"p-grid"],[1,"p-col-2","p-col-align-center"],["type","text","formControlName","residuoGasolio","pInputText","",1,"text-right"],["type","text","formControlName","residuoBenzina","pInputText","",1,"text-right"],["type","text","formControlName","residuoGasolioSerre","pInputText","",1,"text-right"],["type","text","formControlName","residuoGasolioTerzi","pInputText","",1,"text-right"],["type","text","formControlName","ammissibileGasolio","pInputText","",1,"text-right"],["type","text","formControlName","ammissibileBenzina","pInputText","",1,"text-right"],["type","text","formControlName","ammissibileGasolioSerre","pInputText","",1,"text-right"],["class","p-grid",4,"ngIf"],["type","text","pattern","^([0-9])+$","maxlength","7","formControlName","richiestoGasolio","pInputText","",1,"text-right",3,"a4gLimitSup"],["inputRefGasolio",""],[4,"ngIf"],["type","text","pattern","^([0-9])+$","maxlength","7","formControlName","richiestoBenzina","pInputText","",1,"text-right",3,"a4gLimitSup"],["inputRefBenzina",""],["type","text","pattern","^([0-9])+$","maxlength","7","formControlName","richiestoGasolioSerre","pInputText","",1,"text-right",3,"a4gLimitSup"],["inputRefSerre",""],["type","text","pattern","^([0-9])+$","maxlength","7","formControlName","richiestoGasolioTerzi","pInputText","",1,"text-right"],[1,"p-col-9"],["pInputTextarea","","maxlength","500","placeholder","Scrivi qui eventuali note aggiuntive...","formControlName","note",1,"w-100",3,"rows"],["txtAreaInpuRef",""],["pButton","","type","button","label","SALVA",1,"w-10m",3,"click"],["pButton","","type","button","icon","pi pi-chevron-circle-right","iconPos","right","label","PROCEDI",1,"w-10m",3,"click"],["type","text","formControlName","prelevatoGasolio","pInputText","",1,"text-right"],["type","text","formControlName","prelevatoBenzina","pInputText","",1,"text-right"],["type","text","formControlName","prelevatoGasolioSerre","pInputText","",1,"text-right"],["severity","error","text","Formato non valido",4,"ngIf"],["severity","error","text","Il carburante richiesto non pu\xf2 superare il carburante ammesso",4,"ngIf"],["severity","error","text","Formato non valido"],["severity","error","text","Il carburante richiesto non pu\xf2 superare il carburante ammesso"],["severity","error",3,"text",4,"ngIf"],["severity","error",3,"text"]],template:function(i,e){1&i&&(S.Ob(0,"p-confirmDialog",0),S.Ob(1,"p-toast",1),S.Tb(2,"p-toast",2),S.bc("onClose",(function(){return e.onCloseToastEliminazione()})),S.Sb(),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"form",5),S.Tb(6,"div",6),S.Tb(7,"div",7),S.Tb(8,"div",8),S.Tb(9,"button",9),S.bc("click",(function(){return e.goPrevStep()})),S.Sb(),S.Sb(),S.Tb(10,"div",10),S.Tb(11,"div",11),S.Mc(12,ye,2,0,"div",12),S.Mc(13,Re,2,0,"div",12),S.Sb(),S.Sb(),S.Sb(),S.Tb(14,"div",7),S.Tb(15,"div",13),S.Tb(16,"div",14),S.Ob(17,"div",15),S.Ob(18,"div",16),S.Tb(19,"div",17),S.Oc(20,"Gasolio"),S.Sb(),S.Tb(21,"div",17),S.Oc(22,"Benzina"),S.Sb(),S.Tb(23,"div",17),S.Oc(24,"Gasolio serre"),S.Sb(),S.Tb(25,"div",17),S.Oc(26,"Gasolio conto terzi e svincolate"),S.Sb(),S.Sb(),S.Tb(27,"div",18),S.Tb(28,"div",19),S.Oc(29,"Residuo a inizio anno (Lt.)"),S.Sb(),S.Ob(30,"div",16),S.Tb(31,"div",8),S.Ob(32,"input",20),S.Sb(),S.Tb(33,"div",8),S.Ob(34,"input",21),S.Sb(),S.Tb(35,"div",8),S.Ob(36,"input",22),S.Sb(),S.Tb(37,"div",8),S.Ob(38,"input",23),S.Sb(),S.Sb(),S.Tb(39,"div",18),S.Tb(40,"div",19),S.Oc(41,"Ammissibile (Lt.)"),S.Sb(),S.Ob(42,"div",16),S.Tb(43,"div",8),S.Ob(44,"input",24),S.Sb(),S.Tb(45,"div",8),S.Ob(46,"input",25),S.Sb(),S.Tb(47,"div",8),S.Ob(48,"input",26),S.Sb(),S.Ob(49,"div",8),S.Sb(),S.Mc(50,De,11,0,"div",27),S.Tb(51,"div",18),S.Tb(52,"div",19),S.Oc(53,"Richiesto/Assegnato (Lt.)"),S.Sb(),S.Ob(54,"div",16),S.Tb(55,"div",8),S.Ob(56,"input",28,29),S.Mc(58,_e,3,2,"div",30),S.Sb(),S.Tb(59,"div",8),S.Ob(60,"input",31,32),S.Mc(62,Fe,3,2,"div",30),S.Sb(),S.Tb(63,"div",8),S.Ob(64,"input",33,34),S.Mc(66,xe,3,2,"div",30),S.Sb(),S.Tb(67,"div",8),S.Ob(68,"input",35),S.Mc(69,Ge,2,1,"div",30),S.Sb(),S.Sb(),S.Tb(70,"div",18),S.Tb(71,"div",15),S.Oc(72,"Note"),S.Sb(),S.Ob(73,"div",16),S.Tb(74,"div",36),S.Ob(75,"textarea",37,38),S.Mc(77,Ve,2,1,"div",30),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Bb(1),S.Kc(S.rc(16,Ye)),S.Bb(1),S.mc("baseZIndex",5e4),S.Bb(3),S.mc("formGroup",e.fabbisogniForm),S.Bb(7),S.mc("ngIf",e.inCompilazione),S.Bb(1),S.mc("ngIf",e.inCompilazione),S.Bb(37),S.mc("ngIf",e.isRettifica),S.Bb(6),S.mc("a4gLimitSup",S.rc(17,qe)),S.Bb(2),S.mc("ngIf",e.fabbisogniForm.get("richiestoGasolio").invalid&&(e.fabbisogniForm.get("richiestoGasolio").dirty||e.fabbisogniForm.get("richiestoGasolio").touched)),S.Bb(2),S.mc("a4gLimitSup",S.rc(18,Qe)),S.Bb(2),S.mc("ngIf",e.fabbisogniForm.get("richiestoBenzina").invalid&&(e.fabbisogniForm.get("richiestoBenzina").dirty||e.fabbisogniForm.get("richiestoBenzina").touched)),S.Bb(2),S.mc("a4gLimitSup",S.rc(19,Ke)),S.Bb(2),S.mc("ngIf",e.fabbisogniForm.get("richiestoGasolioSerre").invalid&&(e.fabbisogniForm.get("richiestoGasolioSerre").dirty||e.fabbisogniForm.get("richiestoGasolioSerre").touched)),S.Bb(3),S.mc("ngIf",e.fabbisogniForm.controls.richiestoGasolioTerzi.invalid&&(e.fabbisogniForm.controls.richiestoGasolioTerzi.dirty||e.fabbisogniForm.controls.richiestoGasolioTerzi.touched)),S.Bb(6),S.mc("rows",5),S.Bb(2),S.mc("ngIf",e.fabbisogniForm.get("note").invalid&&(e.fabbisogniForm.get("note").dirty||e.fabbisogniForm.get("note").touched)))},directives:[_.a,N.a,H.I,H.t,H.k,k.b,s.t,H.c,H.s,H.i,ze.a,H.z,H.n,Ae.a,Ee.b],styles:["[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-1m[_ngcontent-%COMP%]{width:1em}[_nghost-%COMP%]   .w-16em[_ngcontent-%COMP%]{width:16.3em}[_nghost-%COMP%]   .font-15[_ngcontent-%COMP%]{font-size:15px}[_nghost-%COMP%]   input.ui-inputtext[_ngcontent-%COMP%]:disabled{border-bottom:1px dotted;opacity:.9;background:#e8f5e9}[_nghost-%COMP%]   .ui-header[_ngcontent-%COMP%]{border-top:2px solid #0d5f3f}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),He),$e=t("cS1N"),Je=function(i){return i.download_richiesta="download_richiesta",i.carica_richiesta_firmata="carica_richiesta_firmata",i.protocolla_richiesta="protocolla_richiesta",i.elimina_allegato="elimina_allegato",i}({}),Xe=t("2yZY"),it=function(i){return i.FIRMATARIO_TITOLARE_DIVERSI="FIRMATARIO_TITOLARE_DIVERSI",i.FILE_NON_FIRMATO="FILE_NON_FIRMATO",i.FIRMA_NON_VALIDA="FIRMA_NON_VALIDA",i.DATI_FIRMATARIO_MANCANTI="DATI_FIRMATARIO_MANCANTI",i.FIRMATARIO_NON_UNIVOCO="FIRMATARIO_NON_UNIVOCO",i}({}),et=t("dkQB"),tt=((Ze=function(){function i(e,t){_classCallCheck(this,i),this.http=e,this.configuration=t}return _createClass(i,[{key:"getTemplate",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"assets/templates/templateRichiestaCarburante.docx";return this.http.get(this.configuration.getUrlTemplateStampa(i),{responseType:"blob"})}},{key:"stampaFile",value:function(i,e){var t=new FormData;return t.append("file",i,i.name),t.append("dati",JSON.stringify(e)),t.append("formatoStampa","PDF"),this.http.post(this.configuration.UrlStampaPDF,t,{responseType:"blob"})}},{key:"verificaFirmaSingola",value:function(i,e){var t=new FormData;return t.append("documentoFirmato",i),this.http.post(this.configuration.UrlVerificaFirmaSingola.replace("${codiceFiscaleTitolareRl}",e),t)}}]),i}()).\u0275fac=function(i){return new(i||Ze)(S.Xb(f.b),S.Xb(et.a))},Ze.\u0275prov=S.Jb({token:Ze,factory:Ze.\u0275fac,providedIn:"root"}),Ze),ot=t("GtbX"),nt=t("/vOn"),at=t("spED"),rt=function(i){return i.file="file",i.button="button",i}({}),ct=t("jTGf"),st=["fileInput"],lt=["filePrivacyInput"],ut=((je=function(){function i(e,t,o,n,a,r,c,s,l){_classCallCheck(this,i),this.httpClientProxy=e,this.messageService=t,this.fileService=o,this.httpClientDomandaUmaService=n,this.errorService=a,this.anagraficaFascicoloService=r,this._configuration=c,this.utentiService=s,this.navigatorService=l,this.prevStep=new S.n,this.BUTTONS_ENUM=Je,this.BUTTONS_TYPE_ENUM=rt,this.FIRMA_CHECK_DISABLED=!0}return _createClass(i,[{key:"goPrevStep",value:function(){this.prevStep.emit(l.PROTOCOLLAZIONE)}},{key:"ngOnInit",value:function(){this.fileConfig=this.fileService.loadConfig(),this.initVariables()}},{key:"ngOnDestroy",value:function(){this.stampaSubscription&&this.stampaSubscription.unsubscribe(),this.protocollaRichiestaSubscription&&this.protocollaRichiestaSubscription.unsubscribe(),this.firmaSingolaSubscription&&this.firmaSingolaSubscription.unsubscribe(),this.stampaPrivacySubscription&&this.stampaPrivacySubscription.unsubscribe()}},{key:"initVariables",value:function(){this.enabledDownload={enableButton:!0,enableHeader:!1},this.enabledUpload={enableButton:!1,enableHeader:!1},this.enabledPrivacy={enableButton:!0,enableHeader:!1},this.enabledProtocolla={enableButton:!1,enableHeader:!1},this.fileRichiesta=new at.a,this.fileRichiesta.showDeleteButton=!0,this.resetRichiesta()}},{key:"onClickBoxButton",value:function(i,e){switch(i.idButton){case Je.download_richiesta:this.stampaRichiestaCarburantePDF();break;case Je.carica_richiesta_firmata:this.caricaRichiesta(i,e);break;case Je.protocolla_richiesta:this.protocollaRichiesta();break;case Je.elimina_allegato:this.eliminaAllegato(i.componentName);break;default:console.log("Click non identificato")}}},{key:"stampaRichiestaCarburantePDF",value:function(){var i=this;this.stampaSubscription=this.httpClientDomandaUmaService.getRichiestaCarburanteFile(this.richiestaCarburante.id.toString()).subscribe((function(e){R.saveAs(new Blob([e],{type:"application/pdf"}),i.richiestaCarburante.id.toString()+i.getFileName()),i.enabledDownload.enableHeader=!0,i.enabledUpload.enableButton=!0}),(function(e){console.log("ERRORE: ",e),i.errorService.showErrorWithMessage(O.a.erroreStampaRichiesta,"tst-dlg")}))}},{key:"getFileName",value:function(){return null==this.richiestaCarburante.idRettificata?"_richiestacarburante.pdf":"_rettificacarburante.pdf"}},{key:"caricaRichiesta",value:function(i,e){e||(e=document.getElementById("caricaFileInput")),i.typeButton===rt.file&&e&&e.click()}},{key:"protocollaRichiesta",value:function(){var i=this;this.protocollaRichiestaSubscription=this.httpClientDomandaUmaService.protocollaDomanda(this.richiestaCarburante.id,this.fileRichiesta.file,this.haFirma).subscribe((function(e){i.messageService.add(m.a.getToast("tst-dlg-protocollazione",m.b.success,O.a.protocollaRichiestaOK))}),(function(e){console.log("ERRORE: ",e),i.errorService.showErrorWithMessage(e&&e.error&&e.error.message?e.error.message:O.a.erroreProtocollaRichiesta,"tst-dlg")}))}},{key:"onCloseToastProtocollazione",value:function(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo.toString())}},{key:"onFileChange",value:function(i,e){var t=this;if(i.target.files&&i.target.files.length){this.enabledProtocolla.enableHeader=!1;var o=i.target.files[0],n=new $e.a(this.fileConfig.fileExt,this.fileConfig.maxSize);n.isValidFileExtension(o,O.a.FILE_ERRORS.EXT)&&n.isValidFileSize(o,O.a.FILE_ERRORS.SIZE)&&(this.firmaSingolaSubscription=this.httpClientProxy.verificaFirmaSingola(o,this.richiestaCarburante.cfRichiedente).subscribe((function(i){t.enableNextFields(e,o),t.haFirma=!0}),(function(i){t.haFirma=!0,console.log("ERRORE: ",i),t.FIRMA_CHECK_DISABLED?(t.enableNextFields(e,o),t.handleErrorFirma(i,!0)):(t.handleErrorFirma(i,!0),t.fileInput.nativeElement.value=null)}))),this.showErrors(n.getErrors())}}},{key:"onFileChangePrivacy",value:function(i,e){var t=this;if(i.target.files&&i.target.files.length){this.enabledProtocolla.enableHeader=!1;var o=i.target.files[0],n=new $e.a(this.fileConfig.fileExt,this.fileConfig.maxSize);n.isValidFileExtension(o,O.a.FILE_ERRORS.EXT)&&n.isValidFileSize(o,O.a.FILE_ERRORS.SIZE)&&(this.firmaSingolaSubscription=this.httpClientProxy.verificaFirmaSingola(o,this.richiestaCarburante.cfRichiedente).subscribe((function(i){t.enableNextFields(e,o)}),(function(i){console.log("ERRORE: ",i),t.handleErrorFirma(i,!1),t.fileInput.nativeElement.value=null}))),this.showErrors(n.getErrors())}}},{key:"enableNextFields",value:function(i,e){"richiesta"===i&&(this.fileRichiesta.nome=e.name,this.fileRichiesta.file=e,this.enabledUpload.enableHeader=!0),this.fileRichiesta.file&&(this.enabledProtocolla.enableButton=!0)}},{key:"handleErrorFirma",value:function(i,e){if(i&&i.error&&i.error.message)switch(i.error.message){case it.FIRMATARIO_TITOLARE_DIVERSI:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.CODICE_FISCALE_NO_MATCH,"tst-dlg");break;case it.FILE_NON_FIRMATO:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.NO_FIRMA,"tst-dlg"),e&&(this.haFirma=!1);break;case it.FIRMA_NON_VALIDA:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.NO_FIRMA_VALIDA,"tst-dlg");break;case it.DATI_FIRMATARIO_MANCANTI:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.NO_DATI_FIRMATARIO,"tst-dlg");break;case it.FIRMATARIO_NON_UNIVOCO:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.NO_SINGLE_FIRMATARIO,"tst-dlg");break;default:this.errorService.showError(i,"tst-dlg")}else this.errorService.showError(i,"tst-dlg")}},{key:"getHeader",value:function(i,e,t){return{title:i,subtitle:e,icon:t}}},{key:"getButtonModel",value:function(i,e,t,o){return{label:i,icon:e,id:t,type:o}}},{key:"showErrors",value:function(i){var e=this;i&&i.length&&i.forEach((function(i){e.messageService.add(m.a.getToast("tst-dlg",m.b.error,i))}))}},{key:"eliminaAllegato",value:function(i){"richiesta"===i&&(this.resetRichiesta(),this.enabledUpload.enableHeader=!1,this.enabledProtocolla.enableButton=!1)}},{key:"resetRichiesta",value:function(){this.fileRichiesta.file=null,this.fileRichiesta.nome=null,this.fileInput.nativeElement.value=null}},{key:"getDocumentazioneInformativaPrivacy",value:function(i,e,t,o){return JSON.stringify({mittente:{name:i,surname:e,nationalIdentificationNumber:t,description:o+" - "+t},oggetto:this._configuration.ProtocollaPrivacyOggetto+" - "+o+" - "+t,tipologiaDocumentoPrincipale:this._configuration.tipologiaDocumentoProtocolloPrivacy})}}]),i}()).\u0275fac=function(i){return new(i||je)(S.Nb(tt),S.Nb(M.d),S.Nb(Xe.a),S.Nb(g.a),S.Nb(y.a),S.Nb(ot.a),S.Nb(et.a),S.Nb(nt.a),S.Nb(ve.a))},je.\u0275cmp=S.Hb({type:je,selectors:[["app-protocollazione"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(st,!0),S.Jc(lt,!0)),2&i&&(S.Ac(t=S.cc())&&(e.fileInput=t.first),S.Ac(t=S.cc())&&(e.filePrivacyInput=t.first))},inputs:{richiestaCarburante:"richiestaCarburante",inCompilazione:"inCompilazione",idFascicolo:"idFascicolo"},outputs:{prevStep:"prevStep"},decls:22,vars:18,consts:[["position","top-center","key","tst-dlg",3,"baseZIndex"],["position","top-center","key","tst-dlg-protocollazione",3,"baseZIndex","onClose"],[1,"p-grid","ui-fluid"],[1,"p-grid","w-100"],[1,"p-col"],["pButton","","type","button","icon","pi pi-chevron-circle-left","iconPos","left","label","INDIETRO",1,"w-10m",3,"click"],[1,"popup-approvazione","popup--custom"],[1,"text-center"],[3,"innerHtml"],[1,"p-grid"],[1,"p-col-4"],[3,"header","button","enableBox","onClickButton"],[3,"name","header","button","enableBox","document","onClickButton"],["id","caricaFileInput","name","caricaFileInput","type","file",3,"hidden","accept","change"],["fileInput",""]],template:function(i,e){if(1&i){var t=S.Ub();S.Ob(0,"p-toast",0),S.Tb(1,"p-toast",1),S.bc("onClose",(function(){return e.onCloseToastProtocollazione()})),S.Sb(),S.Tb(2,"div",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"button",5),S.bc("click",(function(){return e.goPrevStep()})),S.Sb(),S.Sb(),S.Sb(),S.Tb(6,"div",3),S.Tb(7,"div",4),S.Tb(8,"div",6),S.Tb(9,"div",7),S.Tb(10,"h6"),S.Ob(11,"p",8),S.gc(12,"translate"),S.Sb(),S.Sb(),S.Tb(13,"div",9),S.Tb(14,"div",10),S.Tb(15,"app-box",11),S.bc("onClickButton",(function(i){return e.onClickBoxButton(i)})),S.Sb(),S.Sb(),S.Tb(16,"div",10),S.Tb(17,"app-box",12),S.bc("onClickButton",(function(i){S.Ec(t);var o=S.Bc(19);return e.onClickBoxButton(i,o)})),S.Sb(),S.Tb(18,"input",13,14),S.bc("change",(function(i){return e.onFileChange(i,"richiesta")})),S.Sb(),S.Sb(),S.Tb(20,"div",10),S.Tb(21,"app-box",11),S.bc("onClickButton",(function(i){return e.onClickBoxButton(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()}2&i&&(S.mc("baseZIndex",5e4),S.Bb(1),S.mc("baseZIndex",5e4),S.Bb(10),S.mc("innerHtml",S.hc(12,16,"UMA.MESSAGGIO_DLG"),S.Fc),S.Bb(4),S.mc("header",e.getHeader("UMA.SCARICA_RICHIESTA","UMA.DESC_SCARICA_RICHIESTA","assets/img/icons/icon-download2.png"))("button",e.getButtonModel("UMA.SCARICA","pi pi-arrow-down",e.BUTTONS_ENUM.download_richiesta,e.BUTTONS_TYPE_ENUM.button))("enableBox",e.enabledDownload),S.Bb(2),S.mc("name","richiesta")("header",e.getHeader("UMA.FIRMA_RICHIESTA","UMA.DESC_FIRMA_RICHIESTA","assets/img/icons/icon-signature.svg"))("button",e.getButtonModel("UMA.CARICA","pi pi-arrow-up",e.BUTTONS_ENUM.carica_richiesta_firmata,e.BUTTONS_TYPE_ENUM.file))("enableBox",e.enabledUpload)("document",e.fileRichiesta),S.Bb(1),S.nc("accept",e.fileConfig.fileExt),S.mc("hidden",!0),S.Bb(3),S.mc("header",e.getHeader("UMA.PROTOCOLLA_RICHIESTA","UMA.DESC_PROTOCOLLA_RICHIESTA","assets/img/icons/icon-file-check.svg"))("button",e.getButtonModel("UMA.PROTOCOLLA","",e.BUTTONS_ENUM.protocolla_richiesta,e.BUTTONS_TYPE_ENUM.button))("enableBox",e.enabledProtocolla))},directives:[N.a,k.b,ct.a],pipes:[mi.d],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .cell[_ngcontent-%COMP%]{border:1px solid #cacaca;cursor:pointer}[_nghost-%COMP%]   .cell.disabled[_ngcontent-%COMP%] > .cell-content[_ngcontent-%COMP%]{opacity:.5;cursor:auto}[_nghost-%COMP%]   div.ui-header-sezioni-uma[_ngcontent-%COMP%]{background-color:#fff;border-top:2px solid #4caf50;border-left:1px solid #cacaca;border-right:1px solid #cacaca;font-size:1em}[_nghost-%COMP%]   .block-100[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.ui-clickable.pi.pi-trash{color:#01985a;font-size:x-large}"]}),je);function bt(i,e){1&i&&S.Pb(0)}function ht(i,e){1&i&&(S.Tb(0,"h5",14),S.Tb(1,"strong"),S.Oc(2),S.gc(3,"uppercase"),S.gc(4,"translate"),S.Sb(),S.Sb()),2&i&&(S.Bb(2),S.Pc(S.hc(3,1,S.hc(4,3,"UMA.RICHIESTA_CARBURANTE"))))}function mt(i,e){1&i&&(S.Tb(0,"h5",14),S.Tb(1,"strong"),S.Oc(2),S.gc(3,"uppercase"),S.gc(4,"translate"),S.Sb(),S.Sb()),2&i&&(S.Bb(2),S.Pc(S.hc(3,1,S.hc(4,3,"UMA.RETTIFICA_CARBURANTE"))))}function pt(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",15),S.Tb(1,"div",5),S.Tb(2,"button",16),S.bc("click",(function(){return S.Ec(t),S.fc().stampaRichiestaCarburantePDF()})),S.Sb(),S.Sb(),S.Sb()}}function dt(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",15),S.Tb(1,"div",5),S.Tb(2,"button",17),S.bc("click",(function(){return S.Ec(t),S.fc().eliminaDomanda()})),S.Sb(),S.Sb(),S.Sb()}}function gt(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div"),S.Tb(1,"app-macchine",18),S.bc("updateRichiesta",(function(i){return S.Ec(t),S.fc().updateRichiesta(i)}))("nextStep",(function(i){return S.Ec(t),S.fc().nextStep(i)})),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(1),S.mc("inCompilazione",o.inCompilazione)("idFascicolo",o.idFascicolo)("richiestaCarburante",o.richiestaCarburante)}}function ft(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div"),S.Tb(1,"app-lavorazioni-indice",19),S.bc("nextStep",(function(i){return S.Ec(t),S.fc().nextStep(i)}))("prevStep",(function(i){return S.Ec(t),S.fc().prevStep(i)})),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(1),S.mc("inCompilazione",o.inCompilazione)("idFascicolo",o.idFascicolo)("richiestaCarburante",o.richiestaCarburante)}}function vt(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div"),S.Tb(1,"app-fabbisogno",19),S.bc("nextStep",(function(i){return S.Ec(t),S.fc().nextStep(i)}))("prevStep",(function(i){return S.Ec(t),S.fc().prevStep(i)})),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(1),S.mc("inCompilazione",o.inCompilazione)("idFascicolo",o.idFascicolo)("richiestaCarburante",o.richiestaCarburante)}}function St(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div"),S.Tb(1,"app-protocollazione",20),S.bc("prevStep",(function(i){return S.Ec(t),S.fc().prevStep(i)})),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(1),S.mc("inCompilazione",o.inCompilazione)("idFascicolo",o.idFascicolo)("richiestaCarburante",o.richiestaCarburante)}}var Ct,Ot,Tt,It=function(){return{marginTop:"70px"}},zt=((Tt=function(){function i(e,t,o,n,a,r,c,s,l,u){_classCallCheck(this,i),this.dateUtilService=e,this.httpClientDomandaUma=t,this.activeRoute=o,this.router=n,this.httpClientMacchineUmaService=a,this.gestioneDomandaUmaService=r,this.messageService=c,this.confirmationService=s,this.breadCrumbService=l,this.errorService=u}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.items=[],this.macchine=[],this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){return i.idFascicolo=e.idFascicolo,i.httpClientDomandaUma.getDomandaById(e.idDomanda)})),Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){i.richiestaCarburante=e,i.items=[{label:"Macchine"},{label:"Lavorazioni"},{label:"Fabbisogno"}];var t=i.gestioneDomandaUmaService.isInCompilazione(e,i.items);return i.inCompilazione=t.inCompilazione,i.mostraScarica=t.mostraScarica,i.loadLastStep(),i.httpClientMacchineUmaService.getMacchineByIdDomanda(i.richiestaCarburante.id.toString())}))).subscribe((function(e){i.macchine=e}),(function(e){return i.errorService.showError(e)}))}},{key:"ngOnDestroy",value:function(){this.stampaSubscription&&this.stampaSubscription.unsubscribe(),this.routerSubscription&&this.routerSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe()}},{key:"updateRichiesta",value:function(i){this.richiestaCarburante=i}},{key:"activeIndexChange",value:function(i){}},{key:"nextStep",value:function(i){this.activeIndex=i>=l.MACCHINE&&i<=l.PROTOCOLLAZIONE?i+1:l.MACCHINE}},{key:"prevStep",value:function(i){this.activeIndex=i>=l.LAVORAZIONI&&i<=l.PROTOCOLLAZIONE?i-1:l.MACCHINE}},{key:"eliminaDomanda",value:function(){var i=this;this.confirmationService.confirm({message:O.a.confermaCancellazioneDomanda,accept:function(){i.confermaEliminaDomanda()},reject:function(){},key:"cancellazione-domanda-dialog"})}},{key:"loadLastStep",value:function(){this.activeIndex=this.inCompilazione?null==this.richiestaCarburante.carburanteRichiesto||null==this.richiestaCarburante.carburanteRichiesto.benzina&&null==this.richiestaCarburante.carburanteRichiesto.gasolio&&null==this.richiestaCarburante.carburanteRichiesto.gasolioSerre&&null==this.richiestaCarburante.carburanteRichiesto.gasolioTerzi?this.richiestaCarburante.haDichiarazioni?l.LAVORAZIONI:l.MACCHINE:l.FABBISOGNO:l.MACCHINE}},{key:"confermaEliminaDomanda",value:function(){var i=this;this.deleteSubscription=this.httpClientDomandaUma.deleteDomandaById(this.richiestaCarburante.id.toString()).subscribe((function(){i.messageService.add(m.a.getToast("tst-cancellazione",m.b.success,O.a.cancellazioneDomandaOK))}),(function(e){return i.errorService.showError(e)}))}},{key:"stampaRichiestaCarburantePDF",value:function(){var i=this;this.stampaSubscription=this.httpClientDomandaUma.getRichiestaCarburanteFile(this.richiestaCarburante.id.toString()).subscribe((function(e){R.saveAs(new Blob([e],{type:"application/pdf"}),i.richiestaCarburante.id.toString()+i.getFileName())}),(function(e){console.log("ERRORE: ",e),i.errorService.showErrorWithMessage(O.a.erroreStampaRichiesta,"tst")}))}},{key:"getFileName",value:function(){return null==this.richiestaCarburante.idRettificata?"_richiestacarburante.pdf":"_rettificacarburante.pdf"}},{key:"onCloseToastCancellazione",value:function(){var i;null==this.idFascicolo&&this.router.navigate(["/"]),"appag"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"amministratore"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"caa"==localStorage.getItem("selectedRole")&&(i="funzioniCaa/"),"azienda"==localStorage.getItem("selectedRole")&&(i="/"),"gestoreutenti"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"viewer_pat"==localStorage.getItem("selectedRole")&&(i="funzioniPatVisualizzatore/"),"istruttoreuma"==localStorage.getItem("selectedRole")&&(i="funzioniPatIstruttoreUMA/"),"operatore_distributore"==localStorage.getItem("selectedRole")&&(i="funzioniDistributore/"),"amministratore"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"istruttoreamf"==localStorage.getItem("selectedRole")&&(i="funzioniPat/"),"istruttoredu"==localStorage.getItem("selectedRole")&&(i="funzioniPat/gestioneIstruttoria/"),"viewer_altro_ente"==localStorage.getItem("selectedRole")&&(i="funzioniOperatoreVisualizzatore/"),this.router.navigate(["".concat(i,"fascicolo/").concat(this.idFascicolo.toString(),"/presentazioneIstanze")])}}]),i}()).\u0275fac=function(i){return new(i||Tt)(S.Nb(d.a),S.Nb(g.a),S.Nb(D.a),S.Nb(D.e),S.Nb(C),S.Nb(E),S.Nb(M.d),S.Nb(M.a),S.Nb(p.a),S.Nb(y.a))},Tt.\u0275cmp=S.Hb({type:Tt,selectors:[["app-indice-domanda-uma"]],decls:20,vars:17,consts:[["position","top-center","key","tst-cancellazione",3,"modal","baseZIndex","onClose"],["key","tst"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","cancellazione-domanda-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],[1,"ui-grid-fixed","position-unset","top-rettifica"],[1,"boxgrey"],[1,"p-col"],[1,"p-grid","py-2","p-align-center","p-justify-between"],[4,"ngIf","ngIfThen","ngIfElse"],["richiestaTpl",""],["rettificaTpl",""],["class","p-col-fixed",4,"ngIf"],[1,"p-grid"],[3,"model","readonly","activeIndex","activeIndexChange"],[4,"ngIf"],[1,"p-col","p-col-align-center"],[1,"p-col-fixed"],["pButton","","icon","pi pi-file-pdf","iconPos","right","type","button","label","SCARICA",1,"w-10m","ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],["pButton","","icon","pi pi-trash","iconPos","right","type","button","label","ELIMINA",1,"w-10m","ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],[3,"inCompilazione","idFascicolo","richiestaCarburante","updateRichiesta","nextStep"],[3,"inCompilazione","idFascicolo","richiestaCarburante","nextStep","prevStep"],[3,"inCompilazione","idFascicolo","richiestaCarburante","prevStep"]],template:function(i,e){if(1&i&&(S.Tb(0,"p-toast",0),S.bc("onClose",(function(){return e.onCloseToastCancellazione()})),S.Sb(),S.Ob(1,"p-toast",1),S.Ob(2,"p-confirmDialog",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Mc(7,bt,1,0,"ng-container",7),S.Mc(8,ht,5,5,"ng-template",null,8,S.Nc),S.Mc(10,mt,5,5,"ng-template",null,9,S.Nc),S.Mc(12,pt,3,0,"div",10),S.Mc(13,dt,3,0,"div",10),S.Sb(),S.Tb(14,"div",11),S.Tb(15,"p-steps",12),S.bc("activeIndexChange",(function(i){return e.activeIndexChange(i)})),S.Sb(),S.Sb(),S.Mc(16,gt,2,3,"div",13),S.Mc(17,ft,2,3,"div",13),S.Mc(18,vt,2,3,"div",13),S.Mc(19,St,2,3,"div",13),S.Sb(),S.Sb(),S.Sb()),2&i){var t=S.Bc(9),o=S.Bc(11);S.mc("modal",!0)("baseZIndex",5e3),S.Bb(1),S.Kc(S.rc(16,It)),S.Bb(6),S.mc("ngIf",null==(null==e.richiestaCarburante?null:e.richiestaCarburante.idRettificata))("ngIfThen",t)("ngIfElse",o),S.Bb(5),S.mc("ngIf",e.mostraScarica),S.Bb(1),S.mc("ngIf",e.inCompilazione),S.Bb(2),S.mc("model",e.items)("readonly",!1)("activeIndex",e.activeIndex),S.Bb(1),S.mc("ngIf",0==e.activeIndex),S.Bb(1),S.mc("ngIf",1==e.activeIndex),S.Bb(1),S.mc("ngIf",2==e.activeIndex),S.Bb(1),S.mc("ngIf",3==e.activeIndex)}},directives:[N.a,_.a,s.t,B.a,k.b,ii,fe,We,ut],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .top-rettifica[_ngcontent-%COMP%]{position:relative;top:40px}[_nghost-%COMP%]   .block-100[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.ui-clickable.pi.pi-file-pdf, [_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.ui-clickable.pi.pi-trash{color:#01985a;font-size:x-large}[_nghost-%COMP%]     p-steps>.ui-steps>ul{display:flex;flex-wrap:wrap}[_nghost-%COMP%]     p-steps>.ui-steps>ul li.ui-steps-item{flex-grow:1;flex-basis:0;padding:.5em}[_nghost-%COMP%]   .position-unset[_ngcontent-%COMP%]{position:unset}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),Tt),At=((Ot=function(){function i(e){_classCallCheck(this,i),this.breadCrumbService=e}return _createClass(i,[{key:"ngOnInit",value:function(){}}]),i}()).\u0275fac=function(i){return new(i||Ot)(S.Nb(p.a))},Ot.\u0275cmp=S.Hb({type:Ot,selectors:[["app-clienti-conto-terzi-container"]],decls:1,vars:0,template:function(i,e){1&i&&S.Ob(0,"router-outlet")},directives:[D.j],styles:[""]}),Ot),Et=((Ct=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"ngOnInit",value:function(){}},{key:"ngOnDestroy",value:function(){}}]),i}()).\u0275fac=function(i){return new(i||Ct)},Ct.\u0275cmp=S.Hb({type:Ct,selectors:[["app-home-uma"]],decls:1,vars:0,template:function(i,e){1&i&&S.Ob(0,"router-outlet")},directives:[D.j],styles:[""]}),Ct),yt=t("OlUD"),Rt=t("0Dnl"),Dt=t("6aLS"),Mt=t("zLRh"),Nt=t("KkCm"),_t=t("D0mR");function Bt(i,e){if(1&i&&(S.Tb(0,"option",13),S.Oc(1),S.Sb()),2&i){var t=e.$implicit;S.mc("ngValue",t),S.Bb(1),S.Rc(" ",null==t?null:t.denominazione," - ",null==t?null:t.carica," ")}}var kt,Ft,Pt=function(){return{marginTop:"70px"}},wt=((kt=function(){function i(e,t,o,n,a,r,c,s,l,u){_classCallCheck(this,i),this.dateUtilService=e,this.messageService=t,this.anagraficaFascicoloService=o,this.fascicoloCorrente=n,this.router=a,this.route=r,this.httpClientDomandaUmaService=c,this.httpClientDichiarazioneConsumiUmaService=s,this.fascicoloService=l,this.errorService=u}return _createClass(i,[{key:"ngOnInit",value:function(){this.soggetti=[],this.initForm(),this.setSubscriptions()}},{key:"ngOnDestroy",value:function(){this.subscription&&this.subscription.unsubscribe(),this.creaDichiarazioneSubscription&&this.creaDichiarazioneSubscription.unsubscribe(),this.creaRichiestaSubscription&&this.creaRichiestaSubscription.unsubscribe()}},{key:"setSubscriptions",value:function(){var i=this;this.subscription=this.route.params.pipe(Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(Dt.switchMap)((function(e){return i.TIPO_RICHIEDENTE=e.tipoRichiesta,Object(si.a)([i.fascicoloService.getFascicolo(e.idFascicolo),i.fascicoloService.getLegacy(e.idFascicolo)])})),Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(Dt.switchMap)((function(e){var t=_slicedToArray(e,2),o=t[0],n=t[1];return i.cuaa=null,o&&o.cuaa&&(i.fascicoloCorrente.fascicolo=o,i.cuaa=i.fascicoloCorrente.fascicolo.cuaa),n&&n.cuaa&&(i.fascicoloCorrente.fascicoloLegacy=n),i.fascicoloCorrente.isPersonaFisica(i.cuaa)&&null!=i.fascicoloCorrente.fascicoloLegacy.dataMorteTitolare?i.fascicoloService.getEredi(i.cuaa):i.anagraficaFascicoloService.getTitolariRappresentantiLegali(i.cuaa)}))).subscribe((function(e){i.soggetti=e.map((function(i){var e=i;return e.carica=e.carica.split("_").join(" "),e})),i.richiedenteForm.get("richiedente").setValue(i.soggetti[0])}),(function(e){return i.errorService.showError(e)}))}},{key:"initForm",value:function(){this.richiedenteForm=new H.j({richiedente:new H.g(null)})}},{key:"getLabel",value:function(){return this.TIPO_RICHIEDENTE===yt.a.richiesta?"UMA.CREA_DOMANDA":"UMA.CREA_DICHIARAZIONE"}},{key:"getTitle",value:function(){return this.TIPO_RICHIEDENTE===yt.a.richiesta?"UMA.RICHIEDENTE_DOMANDA_SCELTA":"UMA.DICHIARAZIONE_CONSUMI.DICHIARAZIONE_CONSUMI"}},{key:"onClick",value:function(){var i=this.richiedenteForm.get("richiedente").value;if(null!=i)return this.TIPO_RICHIEDENTE===yt.a.richiesta?this.creaRichiestaUma(i):this.creaDichiarazioneUma(i);this.messageService.add(m.a.getToast("tst",m.b.warn,O.a.noRichiedenteUmaSelezionato))}},{key:"creaRichiestaUma",value:function(i){var e=this;this.creaRichiestaSubscription=this.httpClientDomandaUmaService.presentaDomanda(this.cuaa,i.codiceFiscale).subscribe((function(i){e.router.navigate(["./richiesta",i],{relativeTo:e.route.parent})}),(function(i){return e.errorService.showError(i)}))}},{key:"creaDichiarazioneUma",value:function(i){var e=this;this.creaDichiarazioneSubscription=this.httpClientDichiarazioneConsumiUmaService.presentaDichiarazioneConsumi(this.cuaa,i.codiceFiscale).subscribe((function(i){e.router.navigate(["./dichiarazione-consumi",i],{relativeTo:e.route.parent})}),(function(i){return e.errorService.showError(i)}))}}]),i}()).\u0275fac=function(i){return new(i||kt)(S.Nb(d.a),S.Nb(M.d),S.Nb(ot.a),S.Nb(Rt.a),S.Nb(D.e),S.Nb(D.a),S.Nb(g.a),S.Nb(Oe.a),S.Nb(Mt.a),S.Nb(y.a))},kt.\u0275cmp=S.Hb({type:kt,selectors:[["app-richiedente-uma"]],decls:20,vars:14,consts:[["key","tst"],[1,"ui-grid-fixed","mt-4"],[1,"richiesta-title"],[1,"p-col","p-0"],[1,"boxgrey"],[3,"formGroup"],[1,"p-grid"],[1,"p-col-12","p-md-2","align-self-center"],["id","basic-addon1",1,"m-0"],[1,"p-col-12","p-md-8","align-self-center"],["formControlName","richiedente",1,"custom-select",2,"height","47px"],[3,"ngValue",4,"ngFor","ngForOf"],["appDebounceClick","","pButton","",1,"w-100",3,"label","debounceClick"],[3,"ngValue"]],template:function(i,e){1&i&&(S.Ob(0,"app-fascicolo-aperto"),S.Ob(1,"p-toast",0),S.Tb(2,"div",1),S.Tb(3,"h2",2),S.Oc(4),S.gc(5,"translate"),S.Sb(),S.Tb(6,"div",3),S.Tb(7,"div",4),S.Tb(8,"form",5),S.Tb(9,"div",6),S.Tb(10,"div",7),S.Tb(11,"label",8),S.Oc(12),S.gc(13,"translate"),S.Sb(),S.Sb(),S.Tb(14,"div",9),S.Tb(15,"select",10),S.Mc(16,Bt,2,3,"option",11),S.Sb(),S.Sb(),S.Tb(17,"div",7),S.Tb(18,"button",12),S.bc("debounceClick",(function(){return e.onClick()})),S.gc(19,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Bb(1),S.Kc(S.rc(13,Pt)),S.Bb(3),S.Pc(S.hc(5,7,e.getTitle())),S.Bb(4),S.mc("formGroup",e.richiedenteForm),S.Bb(4),S.Qc(" ",S.hc(13,9,"UMA.CF_RICHIEDENTE")," "),S.Bb(4),S.mc("ngForOf",e.soggetti),S.Bb(2),S.mc("label",S.hc(19,11,e.getLabel())))},directives:[Nt.a,N.a,H.I,H.t,H.k,H.E,H.s,H.i,s.s,_t.a,k.b,H.x,H.H],pipes:[mi.d],styles:[""],encapsulation:2}),kt),xt=t("lAEH"),Lt=((Ft=function(){function i(e,t){_classCallCheck(this,i),this.http=e,this.configuration=t}return _createClass(i,[{key:"getFascicoloAgs",value:function(i){return this.http.get("".concat(this.urlGetFascicoloAgsFromAnagrafica(),"/").concat(i))}},{key:"urlGetFascicoloAgsFromAnagrafica",value:function(){return this.configuration.anagrafica_server+"/fascicolo/legacy"}}]),i}()).\u0275fac=function(i){return new(i||Ft)(S.Xb(f.b),S.Xb(et.a))},Ft.\u0275prov=S.Jb({token:Ft,factory:Ft.\u0275fac,providedIn:"root"}),Ft),Gt=t("xm8s"),Ut=t("Pgx+");function Vt(i,e){1&i&&S.Pb(0)}function Ht(i,e){if(1&i&&(S.Tb(0,"div",20),S.Tb(1,"h6",7),S.Oc(2),S.gc(3,"translate"),S.Sb(),S.Tb(4,"span",8),S.Oc(5),S.gc(6,"date"),S.Sb(),S.Sb()),2&i){var t=S.fc(2);S.Bb(2),S.Pc(S.hc(3,2,"UMA.INTESTAZIONE.DATA_INSERIMENTO")),S.Bb(3),S.Pc(S.ic(6,4,null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.dataPresentazione,"dd/MM/yyyy"))}}function Zt(i,e){if(1&i&&(S.Tb(0,"div",20),S.Tb(1,"h6",7),S.Oc(2),S.gc(3,"translate"),S.Sb(),S.Tb(4,"span",8),S.Oc(5),S.gc(6,"date"),S.Sb(),S.Sb()),2&i){var t=S.fc(2);S.Bb(2),S.Pc(S.hc(3,2,"UMA.INTESTAZIONE.DATA_PROTOCOLLAZIONE")),S.Bb(3),S.Pc(S.ic(6,4,(null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.dataProtocollazione)||"01/01/2001","dd/MM/yyyy"))}}function jt(i,e){if(1&i&&(S.Tb(0,"div",20),S.Tb(1,"h6",7),S.Oc(2),S.gc(3,"translate"),S.Sb(),S.Tb(4,"span",8),S.Oc(5),S.Sb(),S.Sb(),S.Mc(6,Ht,7,7,"div",21),S.Mc(7,Zt,7,7,"div",21),S.Tb(8,"div",20),S.Tb(9,"h6",7),S.Oc(10),S.gc(11,"translate"),S.Sb(),S.Tb(12,"span",8),S.Oc(13),S.Sb(),S.Sb()),2&i){var t=S.fc();S.Bb(2),S.Pc(S.hc(3,6,"UMA.INTESTAZIONE.ID_DICHIARAZIONE")),S.Bb(3),S.Pc(null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.id),S.Bb(1),S.mc("ngIf",null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.dataPresentazione),S.Bb(1),S.mc("ngIf",null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.dataProtocollazione),S.Bb(3),S.Pc(S.hc(11,8,"UMA.INTESTAZIONE.RIF_RICHIESTA")),S.Bb(3),S.Pc(null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.idRichiesta)}}function Yt(i,e){if(1&i&&(S.Tb(0,"div",20),S.Tb(1,"h6",7),S.Oc(2),S.gc(3,"translate"),S.Sb(),S.Tb(4,"span",8),S.Oc(5),S.Sb(),S.Sb()),2&i){var t=S.fc(2);S.Bb(2),S.Pc(S.hc(3,2,"UMA.INTESTAZIONE.ID_RICHIESTA_RETTIFICATA")),S.Bb(3),S.Pc(null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.idRettificata)}}function qt(i,e){if(1&i&&(S.Tb(0,"div",20),S.Tb(1,"h6",7),S.Oc(2),S.gc(3,"translate"),S.Sb(),S.Tb(4,"span",8),S.Oc(5),S.gc(6,"date"),S.Sb(),S.Sb()),2&i){var t=S.fc(2);S.Bb(2),S.Pc(S.hc(3,2,"UMA.INTESTAZIONE.DATA_PROTOCOLLAZIONE")),S.Bb(3),S.Pc(S.ic(6,4,null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.dataProtocollazione,"dd/MM/yyyy"))}}function Qt(i,e){if(1&i&&(S.Tb(0,"div",20),S.Tb(1,"h6",7),S.Oc(2),S.gc(3,"translate"),S.Sb(),S.Tb(4,"span",8),S.Oc(5),S.Sb(),S.Sb(),S.Mc(6,Yt,6,4,"div",21),S.Tb(7,"div",20),S.Tb(8,"h6",7),S.Oc(9),S.gc(10,"translate"),S.Sb(),S.Tb(11,"span",8),S.Oc(12),S.gc(13,"date"),S.Sb(),S.Sb(),S.Mc(14,qt,7,7,"div",21)),2&i){var t=S.fc();S.Bb(2),S.Pc(S.hc(3,6,"UMA.INTESTAZIONE.ID_RICHIESTA")),S.Bb(3),S.Pc(null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.id),S.Bb(1),S.mc("ngIf",null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.idRettificata),S.Bb(3),S.Pc(S.hc(10,8,"UMA.INTESTAZIONE.DATA_INSERIMENTO")),S.Bb(3),S.Pc(S.ic(13,10,null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.dataPresentazione,"dd/MM/yyyy")),S.Bb(2),S.mc("ngIf",null==t.richiestaOrDichiarazione?null:t.richiestaOrDichiarazione.dataProtocollazione)}}var Kt,Wt,$t,Jt=function(){return{marginTop:"70px"}},Xt=(($t=function(){function i(e,t,o,n,a){_classCallCheck(this,i),this.httpClientDomandaUma=e,this.httpClientDichiarazioneConsumiUmaService=t,this.httpClientAnagraficaService=o,this.activeRoute=n,this.errorService=a}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.tipoIntestazioneEnum=xt.a,this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){var t=e.idDomanda||e.id,o=null;return null!=e.idDomanda?(i.isRichiestaOrRettifica=!0,o=i.httpClientDomandaUma.getDomandaById(t)):(i.isRichiestaOrRettifica=!1,o=i.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(t)),o})),Object(h.a)((function(e){return i.errorService.showError(e,"tst-intestazione-uma"),u.a})),Object(b.a)((function(e){return i.richiestaOrDichiarazione=e,i.httpClientAnagraficaService.getFascicoloAgs(i.richiestaOrDichiarazione.cuaa)}))).subscribe((function(e){i.richiestaOrDichiarazione.denominazione=e.denominazione,i.setTemplateIntestazioneByType(i.ctx==xt.a.GESTIONE_CARBURANTE_IN_ESUBERO?xt.a.GESTIONE_CARBURANTE_IN_ESUBERO:i.isRichiestaOrRettifica?xt.a.RICHIESTA:xt.a.DICHIARAZIONE_CONSUMI)}),(function(e){return i.errorService.showError(e,"tst-intestazione-uma")}))}},{key:"ngOnChanges",value:function(i){i&&i.ctx&&i.ctx.currentValue&&this.setTemplateIntestazioneByType(i.ctx.currentValue)}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe()}},{key:"setTemplateIntestazioneByType",value:function(i){this.title=i===xt.a.GESTIONE_CARBURANTE_IN_ESUBERO?Gt.a.INTESTAZIONE.titleGestioneCarburanteInEsubero:i===xt.a.DICHIARAZIONE_CONSUMI?Gt.a.INTESTAZIONE.titleDichiarazione:this.richiestaOrDichiarazione&&null!=this.richiestaOrDichiarazione.idRettificata?Gt.a.INTESTAZIONE.titleRettifica:Gt.a.INTESTAZIONE.titleRichiesta}}]),i}()).\u0275fac=function(i){return new(i||$t)(S.Nb(g.a),S.Nb(Oe.a),S.Nb(Lt),S.Nb(D.a),S.Nb(y.a))},$t.\u0275cmp=S.Hb({type:$t,selectors:[["app-intestazione-uma"]],inputs:{ctx:"ctx"},features:[S.zb],decls:37,vars:24,consts:[["key","tst-intestazione-uma"],[1,"p-grid"],[1,"p-grid","no-gutters","tophome"],[1,"ui-grid-fixed"],[1,"d-flex","justify-content-between","align-items-center"],[1,"subhome"],[1,"p-col-3","border-r"],[1,"mb-0"],[1,"fw-700"],[1,"p-col-6","border-r","d-flex","flex-column"],[1,"fw-700","d-block"],[1,"p-col-3"],[1,"d-flex","align-items-center"],[1,"mb-0","mr-2"],[1,"d-flex","align-items-center",2,"padding","8px 0 0 0"],[1,"btn","btn-outline-light"],[4,"ngIf","ngIfThen","ngIfElse"],["dichiarazioneTpl",""],["richiestaTpl",""],[1,"p-grid","no-gutters","h-15m"],[1,"box-border-bottom"],["class","box-border-bottom",4,"ngIf"]],template:function(i,e){if(1&i&&(S.Ob(0,"p-toast",0),S.Tb(1,"div",1),S.Tb(2,"div",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"h4"),S.Oc(6),S.Sb(),S.Sb(),S.Tb(7,"div",5),S.Tb(8,"div",1),S.Tb(9,"div",6),S.Tb(10,"h6",7),S.Oc(11),S.gc(12,"uppercase"),S.gc(13,"translate"),S.Sb(),S.Tb(14,"span",8),S.Oc(15),S.Sb(),S.Sb(),S.Tb(16,"div",9),S.Tb(17,"h6",7),S.Oc(18),S.gc(19,"translate"),S.Sb(),S.Tb(20,"span",10),S.Oc(21),S.Sb(),S.Sb(),S.Tb(22,"div",11),S.Tb(23,"div",12),S.Tb(24,"h6",13),S.Oc(25),S.gc(26,"translate"),S.Sb(),S.Sb(),S.Tb(27,"div",14),S.Tb(28,"span",15),S.Oc(29),S.gc(30,"replaceWithSpaceBy"),S.Sb(),S.Sb(),S.Mc(31,Vt,1,0,"ng-container",16),S.Mc(32,jt,14,10,"ng-template",null,17,S.Nc),S.Mc(34,Qt,15,13,"ng-template",null,18,S.Nc),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Ob(36,"div",19),S.Sb()),2&i){var t=S.Bc(33),o=S.Bc(35);S.Kc(S.rc(23,Jt)),S.Bb(6),S.Pc(e.title),S.Bb(5),S.Qc("",S.hc(12,12,S.hc(13,14,"UMA.INTESTAZIONE.CUAA")),":"),S.Bb(4),S.Qc(" ",null==e.richiestaOrDichiarazione?null:e.richiestaOrDichiarazione.cuaa," "),S.Bb(3),S.Qc("",S.hc(19,16,"UMA.INTESTAZIONE.DENOMINAZIONE"),":"),S.Bb(3),S.Qc(" ",null==e.richiestaOrDichiarazione?null:e.richiestaOrDichiarazione.denominazione," "),S.Bb(4),S.Qc("",S.hc(26,18,"UMA.INTESTAZIONE.STATO_DOMANDA"),":"),S.Bb(4),S.Qc(" ",S.ic(30,20,null==e.richiestaOrDichiarazione?null:e.richiestaOrDichiarazione.stato,"_")," "),S.Bb(2),S.mc("ngIf",e.ctx===e.tipoIntestazioneEnum.DICHIARAZIONE_CONSUMI)("ngIfThen",t)("ngIfElse",o)}},directives:[N.a,s.t],pipes:[s.G,mi.d,Ut.a,s.f],styles:['[_nghost-%COMP%]   .h-15m[_ngcontent-%COMP%]{height:15em}[_nghost-%COMP%]   .h-11m[_ngcontent-%COMP%]{height:11em}[_nghost-%COMP%]   .box-border-bottom[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:space-between}[_nghost-%COMP%]   .box-border-bottom[_ngcontent-%COMP%]:after{content:"";position:absolute;left:0;bottom:8px;width:100%;border-bottom:1px dashed #fff}[_nghost-%COMP%]   .box-border-bottom[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{position:relative;z-index:1;display:inline-block;padding:2px;background-color:#0d5f3f}[_nghost-%COMP%]   span.btn.btn-outline-light[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   span.btn.btn-outline-light[_ngcontent-%COMP%]:hover{border-color:hsla(0,0%,100%,.3);background-color:transparent;color:#f8f9fa}']}),$t),io=((Wt=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"ngOnInit",value:function(){this.tipoIntestazioneEnum=xt.a}}]),i}()).\u0275fac=function(i){return new(i||Wt)},Wt.\u0275cmp=S.Hb({type:Wt,selectors:[["app-gestione-domanda-uma"]],decls:2,vars:1,consts:[[3,"ctx"]],template:function(i,e){1&i&&(S.Ob(0,"app-intestazione-uma",0),S.Ob(1,"router-outlet")),2&i&&S.mc("ctx",null==e.tipoIntestazioneEnum?null:e.tipoIntestazioneEnum.RICHIESTA)},directives:[Xt,D.j],styles:[""]}),Wt),eo=((Kt=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"ngOnInit",value:function(){this.tipoIntestazioneEnum=xt.a}}]),i}()).\u0275fac=function(i){return new(i||Kt)},Kt.\u0275cmp=S.Hb({type:Kt,selectors:[["app-gestione-dichiarazione-consumi"]],decls:2,vars:1,consts:[[3,"ctx"]],template:function(i,e){1&i&&(S.Ob(0,"app-intestazione-uma",0),S.Ob(1,"router-outlet")),2&i&&S.mc("ctx",null==e.tipoIntestazioneEnum?null:e.tipoIntestazioneEnum.DICHIARAZIONE_CONSUMI)},directives:[Xt,D.j],styles:[""]}),Kt),to=function(i){return i.PRELIEVI="PRELIEVI",i.CLIENTI_CONTOTERZI="CLIENTI_CONTOTERZI",i.RICEVUTI="RICEVUTI",i.CONSUMI="CONSUMI",i.TRASFERIMENTI="TRASFERIMENTI",i}({});function oo(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",28),S.Tb(1,"button",29),S.bc("click",(function(){return S.Ec(t),S.fc().scaricaDichiarazioneConsumiFile()})),S.Sb(),S.Sb()}}function no(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",28),S.Tb(1,"button",30),S.bc("click",(function(){return S.Ec(t),S.fc().eliminaDichiarazione()})),S.Sb(),S.Sb()}}function ao(i,e){if(1&i&&(S.Tb(0,"div",31),S.Ob(1,"p-message",32),S.gc(2,"date"),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.pc("text","",t.umaMessages.prelieviOltreDataScadenza," ",S.ic(2,2,null==t.dichiarazioneConsumiDto?null:t.dichiarazioneConsumiDto.dataLimitePrelievi,"dd/MM/yyyy"),"")}}var ro,co,so=function(){return{marginTop:"70px"}},lo=function(i,e){return{"p-col":i,"p-col-fixed":e}},uo=((ro=function(){function i(e,t,o,n,a,r,c,s,l,u){_classCallCheck(this,i),this.dateUtilService=e,this.httpClientDichiarazioneConsumiUmaService=t,this.activeRoute=o,this.indiceUmaService=n,this.router=a,this.messageService=r,this.confirmationService=c,this.errorService=s,this.authService=l,this.navigatorService=u,this.sezioni=to,this.umaMessages=O.a}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){return i.idFascicolo=e.idFascicolo,i.indiceUmaService.idFascicolo=e.idFascicolo,i.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(e.id)}))).subscribe((function(e){i.dichiarazioneConsumiDto=e,i.setPageStatus(e)}),(function(e){return i.errorService.showError(e)}))}},{key:"setPageStatus",value:function(i){i.stato===Ie.a.IN_COMPILAZIONE&&this.authService.userSelectedRole!==A.a.roleIstruttoreUMA&&this.authService.userSelectedRole!==A.a.roleAppag&&this.authService.userSelectedRole!==A.a.roleViewerPAT&&this.authService.userSelectedRole!==A.a.roleAltroEnte?(this.indiceUmaService.READONLY_MODE_DICHIARAZIONE=!1,this.isInCompilazione=!0,this.mostraScarica=!1):(this.indiceUmaService.READONLY_MODE_DICHIARAZIONE=!0,this.isInCompilazione=!1,this.mostraScarica=i.stato!==Ie.a.IN_COMPILAZIONE),localStorage.setItem("UMA_RO_DICH",this.indiceUmaService.READONLY_MODE_DICHIARAZIONE.toString())}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe(),this.getDomandeSubscription&&this.getDomandeSubscription.unsubscribe(),this.getConsuntiviSubscription&&this.getConsuntiviSubscription.unsubscribe()}},{key:"eliminaDichiarazione",value:function(){var i=this;this.confirmationService.confirm({message:O.a.confermaCancellazioneDichiarazioneConsumi,accept:function(){i.confermaEliminaDichiarazione()},reject:function(){},key:"cancellazione-dichiarazione-dialog"})}},{key:"isCaa",value:function(){return this.authService.userSelectedRole===A.a.roleCaa}},{key:"confermaEliminaDichiarazione",value:function(){var i=this;this.deleteSubscription=this.httpClientDichiarazioneConsumiUmaService.deleteDichiarazioneConsumi(this.dichiarazioneConsumiDto.id.toString()).subscribe((function(){i.messageService.add(m.a.getToast("tst",m.b.success,O.a.cancellazioneDichiarazioneConsumiOK))}),(function(e){return i.errorService.showError(e)}))}},{key:"onCloseToastCancellazione",value:function(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo)}},{key:"onClickBox",value:function(i){switch(i){case to.PRELIEVI:this.router.navigate(["prelievi"],{relativeTo:this.activeRoute.parent});break;case to.CLIENTI_CONTOTERZI:this.router.navigate(["clienti-contoterzi"],{relativeTo:this.activeRoute.parent});break;case to.RICEVUTI:this.router.navigate(["ricevuti"],{relativeTo:this.activeRoute.parent});break;case to.CONSUMI:this.router.navigate(["consumi"],{relativeTo:this.activeRoute.parent});break;case to.TRASFERIMENTI:this.router.navigate(["trasferimenti"],{relativeTo:this.activeRoute.parent})}}},{key:"scaricaDichiarazioneConsumiFile",value:function(){var i=this;this.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiFile(this.dichiarazioneConsumiDto.id.toString()).subscribe((function(e){R.saveAs(new Blob([e],{type:"application/pdf"}),i.dichiarazioneConsumiDto.id.toString()+"_dichiarazioneconsumi.pdf")}),(function(e){console.log("ERRORE: ",e),i.messageService.add(m.a.getToast("tst-valida",m.b.error,"Errore imprevisto. Si prega di riprovare pi\xf9 tardi"))}))}}]),i}()).\u0275fac=function(i){return new(i||ro)(S.Nb(d.a),S.Nb(Oe.a),S.Nb(D.a),S.Nb(T),S.Nb(D.e),S.Nb(M.d),S.Nb(M.a),S.Nb(y.a),S.Nb(A.a),S.Nb(ve.a))},ro.\u0275cmp=S.Hb({type:ro,selectors:[["app-sezioni-dichiarazione-consumi"]],decls:48,vars:33,consts:[["position","top-center","key","tst",3,"modal","baseZIndex","onClose"],["key","tst-valida"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","cancellazione-dichiarazione-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","rettifica-error-dialog","acceptLabel","OK","rejectLabel","Annulla","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible",3,"closable"],[1,"ui-grid-fixed","mt-5"],[1,"boxgrey"],[1,"p-col","block-100"],[1,"ui-header-sezioni-uma"],[1,"auto-cursor"],[1,"p-grid","p-justify-between","m-0"],[1,"p-grid","p-align-center","m-0","p-2"],[1,"p-col","p-col-align-center"],[1,"p-grid","m-0"],["class","p-col",4,"ngIf"],[1,"p-grid","cell","p-nogutter"],[1,"p-col-6","p-0","cell-content","border-bottom","border-right"],[1,"p-grid","p-align-center","m-0"],[1,"w-10m",3,"ngClass","click"],["src","assets/img/icons/uma-icon/icon-prelievi.svg",1,"d-inline-block","mr-3"],["class","p-col text-right",4,"ngIf"],[1,"p-col-6","p-0","cell-content","border-bottom"],[1,"p-col",3,"click"],["src","assets/img/icons/uma-icon/icon-contoterzi.svg",1,"d-inline-block","mr-3"],["src","assets/img/icons/uma-icon/icon-ricevuti.svg",1,"d-inline-block","mr-3"],["src","assets/img/icons/uma-icon/icon-consumi.svg",1,"d-inline-block","mr-3"],[1,"p-col-6","p-0","cell-content","border-right"],["src","assets/img/icons/uma-icon/icon-trasferimenti.svg",1,"d-inline-block","mr-3"],[1,"p-col-6","p-0","cursor-text"],[1,"p-col"],["pButton","","icon","pi pi-file-pdf","iconPos","right","type","button","label","SCARICA",1,"w-10m","ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],["pButton","","icon","pi pi-trash","iconPos","right","type","button","label","ELIMINA",1,"w-10m","ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],[1,"p-col","text-right"],["severity","warn",1,"light-message","cursor-text",3,"text"]],template:function(i,e){1&i&&(S.Tb(0,"p-toast",0),S.bc("onClose",(function(){return e.onCloseToastCancellazione()})),S.Sb(),S.Ob(1,"p-toast",1),S.Ob(2,"p-confirmDialog",2),S.Ob(3,"p-confirmDialog",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Tb(7,"div",7),S.Tb(8,"a",8),S.Tb(9,"div",9),S.Tb(10,"div",10),S.Tb(11,"div",11),S.Tb(12,"strong"),S.Oc(13),S.gc(14,"uppercase"),S.gc(15,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Tb(16,"div",12),S.Mc(17,oo,2,0,"div",13),S.Mc(18,no,2,0,"div",13),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(19,"div",14),S.Tb(20,"div",15),S.Tb(21,"div",16),S.Tb(22,"div",17),S.bc("click",(function(){return e.onClickBox(e.sezioni.PRELIEVI)})),S.Ob(23,"img",18),S.Oc(24),S.gc(25,"translate"),S.Sb(),S.Mc(26,ao,3,5,"div",19),S.Sb(),S.Sb(),S.Tb(27,"div",20),S.Tb(28,"div",21),S.bc("click",(function(){return e.onClickBox(e.sezioni.CLIENTI_CONTOTERZI)})),S.Ob(29,"img",22),S.Oc(30),S.gc(31,"translate"),S.Sb(),S.Sb(),S.Tb(32,"div",15),S.Tb(33,"div",21),S.bc("click",(function(){return e.onClickBox(e.sezioni.RICEVUTI)})),S.Ob(34,"img",23),S.Oc(35),S.gc(36,"translate"),S.Sb(),S.Sb(),S.Tb(37,"div",20),S.Tb(38,"div",21),S.bc("click",(function(){return e.onClickBox(e.sezioni.CONSUMI)})),S.Ob(39,"img",24),S.Oc(40),S.gc(41,"translate"),S.Sb(),S.Sb(),S.Tb(42,"div",25),S.Tb(43,"div",21),S.bc("click",(function(){return e.onClickBox(e.sezioni.TRASFERIMENTI)})),S.Ob(44,"img",26),S.Oc(45),S.gc(46,"translate"),S.Sb(),S.Sb(),S.Ob(47,"div",27),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.mc("modal",!0)("baseZIndex",5e4),S.Bb(1),S.Kc(S.rc(29,so)),S.Bb(2),S.mc("closable",!1),S.Bb(10),S.Pc(S.hc(14,15,S.hc(15,17,"UMA.DICHIARAZIONE_CONSUMI.DICHIARAZIONE_CONSUMI"))),S.Bb(4),S.mc("ngIf",e.mostraScarica),S.Bb(1),S.mc("ngIf",e.isInCompilazione),S.Bb(4),S.mc("ngClass",S.tc(30,lo,!(null!=e.dichiarazioneConsumiDto&&e.dichiarazioneConsumiDto.haPrelieviOltreLimite),null==e.dichiarazioneConsumiDto?null:e.dichiarazioneConsumiDto.haPrelieviOltreLimite)),S.Bb(2),S.Qc(" ",S.hc(25,19,"UMA.DICHIARAZIONE_CONSUMI.PRELIEVI")," "),S.Bb(2),S.mc("ngIf",(null==e.dichiarazioneConsumiDto?null:e.dichiarazioneConsumiDto.haPrelieviOltreLimite)&&e.isCaa()),S.Bb(4),S.Qc(" ",S.hc(31,21,"UMA.DICHIARAZIONE_CONSUMI.CLIENTI_CONTOTERZI")," "),S.Bb(5),S.Qc(" ",S.hc(36,23,"UMA.DICHIARAZIONE_CONSUMI.RICEVUTI")," "),S.Bb(5),S.Qc(" ",S.hc(41,25,"UMA.DICHIARAZIONE_CONSUMI.DICHIARAZIONE_CONSUMI")," "),S.Bb(5),S.Qc(" ",S.hc(46,27,"UMA.DICHIARAZIONE_CONSUMI.TRASFERIMENTI")," "))},directives:[N.a,_.a,s.t,s.q,k.b,Ee.b],pipes:[s.G,mi.d,s.f],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .cursor-text[_ngcontent-%COMP%]{cursor:text}[_nghost-%COMP%]     .light-message>div{border-radius:.75em;background-color:#fff;color:#a1887f;border:3px solid #ffba01}[_nghost-%COMP%]     .light-message>div>span.ui-message-icon{color:#ffba01}[_nghost-%COMP%]   .cell[_ngcontent-%COMP%]{border:1px solid #cacaca;cursor:pointer}[_nghost-%COMP%]   .cell.disabled[_ngcontent-%COMP%] > .cell-content[_ngcontent-%COMP%]{opacity:.5;cursor:auto}[_nghost-%COMP%]   .cell-content[_ngcontent-%COMP%]{color:#01985a}[_nghost-%COMP%]   .cell-content[_ngcontent-%COMP%]:hover{background-color:#e8f5e9}[_nghost-%COMP%]   div.ui-header-sezioni-uma[_ngcontent-%COMP%]{background-color:#fff;border-top:2px solid #4caf50;border-left:1px solid #cacaca;border-right:1px solid #cacaca;font-size:1em}[_nghost-%COMP%]   .block-100[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.pi{color:#01985a!important;font-size:x-large!important}[_nghost-%COMP%]     .ui-toast-message-custom{background-color:#fff;color:#4caf50}[_nghost-%COMP%]     .ui-toast-message-custom .ui-toast-close-icon{color:#4caf50}[_nghost-%COMP%]     .ui-dialog>.ui-dialog-content>.ui-confirmdialog-message{white-space:pre-line}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),ro),bo=t("0WKn"),ho=function(){return{marginTop:"70px"}},mo=((co=function(){function i(e,t,o,n,a,r,c){_classCallCheck(this,i),this.indiceUmaService=e,this.location=t,this.route=o,this.httpClientDichiarazioneConsumiUmaService=n,this.httpClientDomandaUmaService=a,this.prelieviBuilderService=r,this.errorService=c}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.initVariables(),this.routerSubscription=this.route.params.pipe(Object(b.a)((function(e){return i.idDichiarazione=e.id,i.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(i.idDichiarazione)})),Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){return i.httpClientDomandaUmaService.getPrelieviByCuaaAndCampagna(e.cuaa,e.campagnaRichiesta.toString())}))).subscribe((function(e){i.datasource=i.prelieviBuilderService.prelieviDtoToPrelieviViewModelBuilder(e.dati)}),(function(e){return i.errorService.showError(e)}))}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe()}},{key:"goBack",value:function(){this.location.back()}},{key:"initVariables",value:function(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.titles=[{name:"Distributore",width:"62%",align:ni.c.CENTER},{name:"Prelievo",width:"38%",align:ni.c.CENTER}],this.cols=this.defineColumns()}},{key:"defineColumns",value:function(){return[{field:"distributoreNome",header:"Distributore",sortable:!0,font:ni.e.BOLD,width:"38%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"distributoreIndirizzo",header:"Indirizzo",sortable:!1,font:ni.e.BOLD,width:"24%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"data",header:"Data prelievo",sortable:!0,width:"12%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:F.a.GASOLIO.toLocaleLowerCase(),header:"Gasolio",sortable:!1,width:"8%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:F.a.BENZINA.toLocaleLowerCase(),header:"Benzina",sortable:!1,width:"8%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"gasolioSerre",header:"Gasolio serre",sortable:!1,width:"10%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY}]}}]),i}()).\u0275fac=function(i){return new(i||co)(S.Nb(T),S.Nb(s.n),S.Nb(D.a),S.Nb(Oe.a),S.Nb(g.a),S.Nb(bo.a),S.Nb(y.a))},co.\u0275cmp=S.Hb({type:co,selectors:[["app-prelievi"]],decls:19,vars:11,consts:[["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-prelievi_black.svg"],[1,"ml-2"],[1,"fs-20"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"titles","cols","values"]],template:function(i,e){1&i&&(S.Ob(0,"p-toast",0),S.Tb(1,"div",1),S.Tb(2,"div",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Tb(7,"a",7),S.bc("click",(function(){return e.goBack()})),S.Ob(8,"i",8),S.Ob(9,"img",9),S.Tb(10,"span",10),S.Tb(11,"strong",11),S.Oc(12),S.gc(13,"uppercase"),S.gc(14,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(15,"div",12),S.Tb(16,"div",13),S.Tb(17,"div",14),S.Ob(18,"app-a4g-multi-table",15),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Kc(S.rc(10,ho)),S.Bb(12),S.Pc(S.hc(13,6,S.hc(14,8,"UMA.DICHIARAZIONE_CONSUMI.PRELIEVI"))),S.Bb(6),S.mc("titles",e.titles)("cols",e.cols)("values",e.datasource))},directives:[N.a,D.h,hi.a],pipes:[s.G,mi.d],styles:[""]}),co),po=t("mrSG"),go=function(i){return i.AMMISSIBILE_GASOLIO_TERZI="AMMISSIBILE_GASOLIO_TERZI",i.RECUPERO_GASOLIO_PROPRIO="RECUPERO_GASOLIO_PROPRIO",i.RECUPERO_GASOLIO_TERZI="RECUPERO_GASOLIO_TERZI",i.RECUPERO_BENZINA="RECUPERO_BENZINA",i.RECUPERO_GASOLIO_SERRE="RECUPERO_GASOLIO_SERRE",i}({}),fo=function(i){return i.FURTO="FURTO",i.UTILIZZO_IMPROPRIO="UTILIZZO_IMPROPRIO",i.ASSEGNAZIONE_SVINCOLATA="ASSEGNAZIONE_SVINCOLATA",i.ALTRO="ALTRO",i}({}),vo=t("6AgI"),So=t("A+aF"),Co=t("BGwN"),Oo=["dialogRecupero"],To=["fileCaricato"];function Io(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",21),S.bc("click",(function(){return S.Ec(t),S.fc(2).caricaAllegato()})),S.Sb()}if(2&i){var o=S.fc(2);S.mc("disabled",(null==o.motivazioneConsuntiviDto||null==o.motivazioneConsuntiviDto.allegati?null:o.motivazioneConsuntiviDto.allegati.length)>4)}}function zo(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",5),S.Tb(1,"div",6),S.Tb(2,"strong"),S.Oc(3,"Allega documentazione"),S.Sb(),S.Oc(4," (obbligatoria) "),S.Sb(),S.Tb(5,"div",17),S.Mc(6,Io,1,1,"button",18),S.Tb(7,"input",19,20),S.bc("change",(function(i){return S.Ec(t),S.fc().onFileChange(i)})),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(6),S.mc("ngIf",!o.READONLY_MODE),S.Bb(1),S.nc("accept",o.fileConfig.fileExt)}}function Ao(i,e){1&i&&(S.Tb(0,"th",27),S.Ob(1,"strong"),S.Sb())}function Eo(i,e){if(1&i&&(S.Tb(0,"tr"),S.Mc(1,Ao,2,0,"th",25),S.Tb(2,"th",26),S.Tb(3,"strong"),S.Oc(4,"File"),S.Sb(),S.Sb(),S.Sb()),2&i){var t=S.fc(2);S.Bb(1),S.mc("ngIf",!t.READONLY_MODE)}}function yo(i,e){if(1&i){var t=S.Ub();S.Tb(0,"td"),S.Tb(1,"img",30),S.bc("click",(function(){S.Ec(t);var i=S.fc(),e=i.rowIndex,o=i.$implicit;return S.fc(2).eliminaAllegato(e,o)})),S.Sb(),S.Sb()}}function Ro(i,e){if(1&i){var t=S.Ub();S.Tb(0,"tr"),S.Mc(1,yo,2,0,"td",28),S.Tb(2,"td"),S.Tb(3,"span"),S.Tb(4,"a",29),S.bc("click",(function(){S.Ec(t);var i=e.rowIndex,o=e.$implicit;return S.fc(2).visualizzaAllegato(i,o)})),S.Oc(5),S.Sb(),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit,n=S.fc(2);S.Bb(1),S.mc("ngIf",!n.READONLY_MODE),S.Bb(4),S.Qc(" ",o.name," ")}}function Do(i,e){if(1&i&&(S.Tb(0,"div",6),S.Tb(1,"p-table",22),S.Mc(2,Eo,5,1,"ng-template",23),S.Mc(3,Ro,6,2,"ng-template",24),S.Sb(),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("value",t.motivazioneConsuntiviDto.allegati)}}var Mo,No=function(){return{"overflow-y":"auto","overflow-x":"hidden","max-height":"90%",height:"auto"}},_o=function(){return{marginTop:"70px"}},Bo=((Mo=function(){function i(e,t,o,n){_classCallCheck(this,i),this.messageService=e,this.fileService=t,this.httpClientDichiarazioneConsumiUmaService=o,this.indiceUmaService=n,this.chiudiPopup=new S.n,this.motivazioneEnum=fo}return _createClass(i,[{key:"ngOnInit",value:function(){this.intestazionePopup="Motivo recupero",this.fileConfig=this.fileService.loadConfigPdf(),this.motivazioneForm=new H.j({tipo:new H.g(null)})}},{key:"open",value:function(i,e){this.display=!0,this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.tipoMotivazione=i,null!=e&&null!=e.allegati&&e.allegati.length?(this.motivazioneConsuntiviDto=ai.cloneDeep(e),this.motivazioneForm.get("tipo").setValue(e.motivazione)):this.initValue()}},{key:"caricaAllegato",value:function(){document.getElementById("fileCaricato").click()}},{key:"eliminaAllegato",value:function(i,e){this.motivazioneConsuntiviDto&&this.motivazioneConsuntiviDto.allegati&&1==this.motivazioneConsuntiviDto.allegati.length?this.messageService.add(m.a.getToast("tst-allegati",m.b.error,O.a.FILE_ERRORS.NO_ALLEGATI)):this.motivazioneConsuntiviDto&&this.motivazioneConsuntiviDto.allegati&&this.motivazioneConsuntiviDto.allegati.length>1&&this.motivazioneConsuntiviDto.allegati.splice(i,1)}},{key:"salva",value:function(i){if(null!=this.motivazioneForm.get("tipo").value)if(!this.motivazioneConsuntiviDto.allegati||this.motivazioneConsuntiviDto.allegati&&!this.motivazioneConsuntiviDto.allegati.length)this.messageService.add(m.a.getToast("tst-allegati",m.b.error,O.a.FILE_ERRORS.NO_ALLEGATI));else{this.motivazioneConsuntiviDto.motivazione=this.motivazioneForm.get("tipo").value;var e=ai.cloneDeep(this.motivazioneConsuntiviDto);this.chiudiPopup.emit({tipo:this.tipoMotivazione,motivazioneConsuntivoDto:e}),this.display=!1}else this.messageService.add(m.a.getToast("tst-allegati",m.b.error,O.a.motivazioneNotSeleziona))}},{key:"annulla",value:function(){this.motivazioneConsuntiviDto=null,this.display=!1}},{key:"visualizzaAllegato",value:function(i,e){if(null!=e&&null==e.idAllegato){var t=URL.createObjectURL(e.file);R.saveAs(e.file,e.file.name),e.file.type===vo.a.PDF&&window.open(t)}else null!=e.idAllegato?this.httpClientDichiarazioneConsumiUmaService.getAllegatoConsuntivo(e.idDichiarazione,e.idConsuntivo,e.idAllegato).subscribe((function(i){var e=URL.createObjectURL(i);window.open(e)})):console.log("Allegato non trovato!!!")}},{key:"onFileChange",value:function(i){if(i.target.files&&i.target.files.length>0){var e=i.target.files[0],t=new $e.a(this.fileConfig.fileExt,this.fileConfig.maxSize);if(e.name.indexOf("$$")>-1)return void this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.SPECIAL_CHAR));if(e.name.length>50)return void this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.FILENAME));if(!t.isValidFileExtension(e))return void this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.EXT_PDF));if(!t.isValidFileSize(e))return void this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.SIZE));this.motivazioneConsuntiviDto.allegati.push({file:e,name:e.name,idAllegato:null}),this.dialog.center()}}},{key:"initValue",value:function(){this.motivazioneConsuntiviDto={},this.motivazioneConsuntiviDto.allegati=[],this.motivazioneForm.get("tipo").setValue(null)}}]),i}()).\u0275fac=function(i){return new(i||Mo)(S.Nb(M.d),S.Nb(Xe.a),S.Nb(Oe.a),S.Nb(T))},Mo.\u0275cmp=S.Hb({type:Mo,selectors:[["app-popup-motivo-recupero"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(Oo,!0),S.Uc(To,!0)),2&i&&(S.Ac(t=S.cc())&&(e.dialog=t.first),S.Ac(t=S.cc())&&(e.file=t.first))},outputs:{chiudiPopup:"chiudiPopup"},decls:28,vars:21,consts:[["id","popup-motivo-recupero","showEffect","fade","styleClass","small-dialog",3,"visible","modal","closable","blockScroll","contentStyle","header","visibleChange"],["dialogRecupero",""],["key","tst-dialog"],["key","tst-allegati"],["novalidate","",3,"formGroup"],[1,"p-grid","p-align-center"],[1,"p-col"],[1,"p-grid","m-0","px-4"],["formControlName","tipo","label","Furto",3,"disabled","value"],["formControlName","tipo","label","Utilizzo improprio",3,"disabled","value"],[1,"p-grid"],["class","p-grid p-align-center",4,"ngIf"],["class","p-col",4,"ngIf"],[1,"p-grid","p-justify-end"],["pButton","","type","button","label","Annulla",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none","w-5m",3,"click"],[1,"pr-0_5m"],["pButton","","type","button","label","Salva",1,"ui-button-text-only","p-1","text-uppercase","font-weight-normal","shadow-none","w-5m",3,"disabled","click"],[1,"p-col-fixed","pr-0_5m"],["pButton","","type","button","class","w-10m","label","CARICA ALLEGATO",3,"disabled","click",4,"ngIf"],["type","file","id","fileCaricato","name","fileCaricato","onclick","this.value = null",1,"inputUploadFile",2,"display","none",3,"accept","change"],["fileCaricato",""],["pButton","","type","button","label","CARICA ALLEGATO",1,"w-10m",3,"disabled","click"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["width","5%",4,"ngIf"],["width","95%"],["width","5%"],[4,"ngIf"],["target","_blank",1,"cursor-pointer","p-col",3,"click"],["src","assets/img/ico-x.jpg",1,"cursor-pointer",3,"click"]],template:function(i,e){if(1&i&&(S.Tb(0,"p-dialog",0,1),S.bc("visibleChange",(function(i){return e.display=i})),S.Ob(2,"p-toast",2),S.Ob(3,"p-toast",3),S.Tb(4,"form",4),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Tb(7,"div",5),S.Tb(8,"div",6),S.Tb(9,"strong"),S.Oc(10,"Motivazione"),S.Sb(),S.Oc(11," (obbligatoria) "),S.Sb(),S.Tb(12,"div",7),S.Ob(13,"p-radioButton",8),S.Sb(),S.Tb(14,"div",7),S.Ob(15,"p-radioButton",9),S.Sb(),S.Sb(),S.Tb(16,"div",10),S.Tb(17,"div",6),S.Ob(18,"hr"),S.Sb(),S.Sb(),S.Mc(19,zo,9,2,"div",11),S.Sb(),S.Sb(),S.Tb(20,"div",5),S.Mc(21,Do,4,1,"div",12),S.Sb(),S.Ob(22,"br"),S.Tb(23,"div",13),S.Tb(24,"div"),S.Tb(25,"button",14),S.bc("click",(function(){return e.annulla()})),S.Sb(),S.Sb(),S.Tb(26,"div",15),S.Tb(27,"button",16),S.bc("click",(function(i){return e.salva(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i){var t,o=null!=(null==(t=e.motivazioneForm.get("tipo"))?null:t.value);S.nc("header",e.intestazionePopup),S.mc("visible",e.display)("modal",!0)("closable",!1)("blockScroll",!0)("contentStyle",S.rc(18,No)),S.Bb(2),S.Kc(S.rc(19,_o)),S.Bb(1),S.Kc(S.rc(20,_o)),S.Bb(1),S.mc("formGroup",e.motivazioneForm),S.Bb(9),S.nc("value",e.motivazioneEnum.FURTO),S.mc("disabled",e.READONLY_MODE),S.Bb(2),S.nc("value",e.motivazioneEnum.UTILIZZO_IMPROPRIO),S.mc("disabled",e.READONLY_MODE),S.Bb(4),S.mc("ngIf",o),S.Bb(2),S.mc("ngIf",null==e.motivazioneConsuntiviDto||null==e.motivazioneConsuntiviDto.allegati?null:e.motivazioneConsuntiviDto.allegati.length),S.Bb(6),S.mc("disabled",e.READONLY_MODE)}},directives:[So.a,N.a,H.I,H.t,H.k,Co.a,H.s,H.i,s.t,k.b,U.q,M.e],styles:["[_nghost-%COMP%]     label.ui-radiobutton-label{margin:0}[_nghost-%COMP%]   .pr-0_5m[_ngcontent-%COMP%]{padding-right:.5em}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]     .small-dialog{width:50vw}"]}),Mo),ko=t("Juyb"),Fo=function i(){_classCallCheck(this,i)},Po=function i(){_classCallCheck(this,i)},wo=t("7QKl"),xo=t("1SSY"),Lo=["dialog"],Go=["fileCaricato"];function Uo(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",22),S.bc("click",(function(){return S.Ec(t),S.fc(2).caricaAllegato()})),S.Sb()}if(2&i){var o=S.fc(2);S.mc("disabled",(null==o.motivoRecuperoAmmissibile||null==o.motivoRecuperoAmmissibile.allegati?null:o.motivoRecuperoAmmissibile.allegati.length)>4)}}function Vo(i,e){if(1&i&&(S.Tb(0,"div",20),S.Tb(1,"div",5),S.Tb(2,"strong"),S.Oc(3,"Allega documentazione"),S.Sb(),S.Oc(4," (obbligatoria) "),S.Sb(),S.Mc(5,Uo,1,1,"button",21),S.Sb()),2&i){var t=S.fc();S.Bb(5),S.mc("ngIf",!t.READONLY_MODE)}}function Ho(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",23),S.Tb(1,"div",6),S.Tb(2,"div",11),S.Tb(3,"div",20),S.Tb(4,"div"),S.Tb(5,"h6",24),S.Tb(6,"img",25),S.bc("click",(function(){return S.Ec(t),S.fc().eliminaAllegatoCaricato()})),S.Sb(),S.Tb(7,"span"),S.Tb(8,"a",26),S.bc("click",(function(){S.Ec(t);var i=S.fc();return i.visualizzaAllegatoCaricato(i.index)})),S.Oc(9),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(10,"div",27),S.Tb(11,"input",28),S.bc("ngModelChange",(function(i){return S.Ec(t),S.fc().fileAllegato.descrizione=i})),S.Sb(),S.Sb(),S.Tb(12,"div",27),S.Tb(13,"p-dropdown",29),S.bc("ngModelChange",(function(i){return S.Ec(t),S.fc().tipoDocumento=i})),S.Sb(),S.Sb(),S.Tb(14,"div",9),S.Tb(15,"button",30),S.bc("click",(function(){return S.Ec(t),S.fc().salvaAllegato()})),S.Sb(),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(9),S.Qc(" ",o.fileAllegato.name," "),S.Bb(2),S.mc("ngModel",o.fileAllegato.descrizione),S.Bb(2),S.mc("options",o.tipologicheService.tipiDocumento)("ngModel",o.tipoDocumento),S.Bb(2),S.mc("disabled",!o.validoSalvaAllegato())}}function Zo(i,e){1&i&&(S.Tb(0,"th",37),S.Ob(1,"strong"),S.Sb())}function jo(i,e){if(1&i&&(S.Tb(0,"tr"),S.Mc(1,Zo,2,0,"th",34),S.Tb(2,"th",35),S.Tb(3,"strong"),S.Oc(4,"File"),S.Sb(),S.Sb(),S.Tb(5,"th",35),S.Tb(6,"strong"),S.Oc(7,"Descrizione"),S.Sb(),S.Sb(),S.Tb(8,"th",36),S.Tb(9,"strong"),S.Oc(10,"Tipo documento"),S.Sb(),S.Sb(),S.Sb()),2&i){var t=S.fc(2);S.Bb(1),S.mc("ngIf",!t.READONLY_MODE)}}function Yo(i,e){if(1&i){var t=S.Ub();S.Tb(0,"td"),S.Tb(1,"img",25),S.bc("click",(function(){S.Ec(t);var i=S.fc().rowIndex;return S.fc(2).eliminaAllegato(i)})),S.Sb(),S.Sb()}}function qo(i,e){if(1&i){var t=S.Ub();S.Tb(0,"tr"),S.Mc(1,Yo,2,0,"td",38),S.Tb(2,"td"),S.Tb(3,"span"),S.Tb(4,"a",26),S.bc("click",(function(){S.Ec(t);var i=e.$implicit;return S.fc(2).visualizzaAllegato(i)})),S.Oc(5),S.Sb(),S.Sb(),S.Sb(),S.Tb(6,"td"),S.Oc(7),S.Sb(),S.Tb(8,"td"),S.Oc(9),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit,n=S.fc(2);S.Bb(1),S.mc("ngIf",!n.READONLY_MODE),S.Bb(4),S.Qc(" ",o.name," "),S.Bb(2),S.Pc(o.descrizione),S.Bb(2),S.Qc(" ",n.descrizioneTipoDocumento(o.tipoDocumento)," ")}}function Qo(i,e){if(1&i&&(S.Tb(0,"div",5),S.Tb(1,"p-table",31),S.Mc(2,jo,11,1,"ng-template",32),S.Mc(3,qo,10,4,"ng-template",33),S.Sb(),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("value",t.motivoRecuperoAmmissibile.allegati)}}var Ko,Wo,$o,Jo=function(){return{"overflow-y":"auto","overflow-x":"hidden","max-height":"90%",height:"auto"}},Xo=function(){return{marginTop:"70px"}},en=((Ko=function(){function i(e,t,o,n,a,r){_classCallCheck(this,i),this.tipologicheService=e,this.messageService=t,this.httpClientDichiarazioneConsumiUmaService=o,this.fileService=n,this.indiceUmaService=a,this.formatConverte=r,this.chiudiPopup=new S.n,this.motivazioneEnum=fo,this.SEPARATOR="$$"}return _createClass(i,[{key:"ngOnInit",value:function(){this.intestazionePopup="Motivo ammesso",this.tipologicheService.setTipiDocumento(),this.fileConfig=this.fileService.loadConfigPdf()}},{key:"open",value:function(i){this.display=!0,this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.tipoMotivazione=go.AMMISSIBILE_GASOLIO_TERZI,null!=i&&null!=i.allegati&&i.allegati.length?(this.motivoRecuperoAmmissibile=ai.cloneDeep(i),this.motivazione=i.motivazione,this.setDescrizioneAndTipo()):this.initValue()}},{key:"reset",value:function(){this.motivoRecuperoAmmissibile=new Fo,this.motivoRecuperoAmmissibile.allegati=[],this.motivazione=null,this.tipoDocumento=null,this.initFile()}},{key:"setDescrizioneAndTipo",value:function(){var i=this;this.motivoRecuperoAmmissibile.allegati&&this.motivoRecuperoAmmissibile.allegati.length&&this.motivoRecuperoAmmissibile.allegati.forEach((function(e){var t=e.file&&e.file.name&&e.file.name.split(i.SEPARATOR);if(t&&t.length>1){var o=t[1],n=t[2],a=new File([e.file],t[0],{type:e.file.type});e.file=a,e.tipoDocumento=o,e.descrizione=n}}))}},{key:"salva",value:function(i){if(!this.motivoRecuperoAmmissibile.allegati||this.motivoRecuperoAmmissibile.allegati&&!this.motivoRecuperoAmmissibile.allegati.length)this.messageService.add(m.a.getToast("tst-allegati",m.b.error,O.a.FILE_ERRORS.NO_ALLEGATI));else{this.motivoRecuperoAmmissibile.motivazione=this.motivazione;var e=ai.cloneDeep(this.motivoRecuperoAmmissibile);this.chiudiPopup.emit({idConsuntivo:this.motivoRecuperoAmmissibile.idConsuntivo,tipo:go.AMMISSIBILE_GASOLIO_TERZI,motivazioneConsuntivoDto:e}),this.display=!1}}},{key:"annulla",value:function(){this.motivoRecuperoAmmissibile=new Fo,this.motivoRecuperoAmmissibile.allegati=[],this.motivazione=null,this.tipoDocumento=null,this.initFile(),this.display=!1}},{key:"caricaAllegato",value:function(){document.getElementById("fileCaricato").click(),this.tipoDocumento=null}},{key:"eliminaAllegato",value:function(i){this.motivoRecuperoAmmissibile&&this.motivoRecuperoAmmissibile.allegati&&1==this.motivoRecuperoAmmissibile.allegati.length?this.messageService.add(m.a.getToast("tst-allegati",m.b.error,"E\u2019 obbligatorio aver caricato almeno un allegato")):this.motivoRecuperoAmmissibile&&this.motivoRecuperoAmmissibile.allegati&&this.motivoRecuperoAmmissibile.allegati.length>1&&this.motivoRecuperoAmmissibile.allegati.splice(i,1)}},{key:"visualizzaAllegato",value:function(i){var e=this;if(null!=i&&null==i.idAllegato){var t=this.removeSeparators(i.file),o=URL.createObjectURL(t);R.saveAs(t,t.name),i.file.type===vo.a.PDF&&window.open(o)}else null!=i.idAllegato?this.httpClientDichiarazioneConsumiUmaService.getAllegatoConsuntivo(i.idDichiarazione,i.idConsuntivo,i.idAllegato).subscribe((function(t){var o=new $e.a(e.fileConfig.fileExt,e.fileConfig.maxSize).blobToFile(new Blob([t]),i.name);R.saveAs(o);var n=URL.createObjectURL(t);window.open(n)})):console.log("Allegato non trovato!!!")}},{key:"removeSeparators",value:function(i){var e=i&&i.name.split(this.SEPARATOR);return e&&e.length>1&&e[0].indexOf(this.fileConfig.fileExt)?new File([i],e[0],{type:i.type}):new File([i],i.name,{type:i.type})}},{key:"initValue",value:function(){this.motivoRecuperoAmmissibile||(this.motivoRecuperoAmmissibile=new Fo),this.motivoRecuperoAmmissibile.allegati||(this.motivoRecuperoAmmissibile.allegati=[]),this.tipoDocumento=null,this.motivazione=null,this.initFile()}},{key:"initFile",value:function(){this.fileAllegato=new Po,this.fileAllegato.name="",this.fileAllegato.file=null,this.fileAllegato.descrizione="",this.fileAllegato.tipoDocumento=null}},{key:"onFileChange",value:function(i){if(i.target.files&&i.target.files.length>0){var e=i.target.files[0],t=new $e.a(this.fileConfig.fileExt,this.fileConfig.maxSize);if(e.name.indexOf(this.SEPARATOR)>-1)return void(e.name.split(this.SEPARATOR)[0].indexOf(this.fileConfig.fileExt)<0&&this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.SPECIAL_CHAR)));if(e.name.indexOf(this.SEPARATOR)>-1){if(e.name.split(this.SEPARATOR)[0].length>50)return void this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.FILENAME))}else if(e.name.length>50)return void this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.FILENAME));if(!t.isValidFileExtension(e))return void this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.EXT_PDF));if(!t.isValidFileSize(e))return void this.messageService.add(m.a.getToast("tst-dialog",m.b.error,O.a.FILE_ERRORS.SIZE));this.fileAllegato=new Po,this.fileAllegato.file=e,this.fileAllegato.name=e.name,this.fileAllegato.descrizione="",this.fileAllegato.tipoDocumento=null,this.dialog.center()}}},{key:"eliminaAllegatoCaricato",value:function(){this.initFile()}},{key:"visualizzaAllegatoCaricato",value:function(i){if(null!=this.fileAllegato.file){var e=URL.createObjectURL(this.fileAllegato.file);R.saveAs(this.fileAllegato.file,this.fileAllegato.file.name),this.fileAllegato.file.type===vo.a.PDF&&window.open(e)}}},{key:"validoSalvaAllegato",value:function(){return!(this.formatConverte.isEmptyString(this.fileAllegato.descrizione)||!this.tipoDocumento)}},{key:"salvaAllegato",value:function(){var i=this;this.motivoRecuperoAmmissibile.motivazione=this.motivazione,this.fileAllegato.tipoDocumento=this.tipologicheService.tipiDocumento.find((function(e){return e===i.tipoDocumento})).enum,this.motivoRecuperoAmmissibile.allegati.push(this.fileAllegato),this.initFile()}},{key:"descrizioneTipoDocumento",value:function(i){return this.tipologicheService.tipiDocumento.find((function(e){return e.enum===i})).label}}]),i}()).\u0275fac=function(i){return new(i||Ko)(S.Nb(wo.a),S.Nb(M.d),S.Nb(Oe.a),S.Nb(Xe.a),S.Nb(T),S.Nb(ki.a))},Ko.\u0275cmp=S.Hb({type:Ko,selectors:[["app-popup-allegati-motivo-consumi"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(Lo,!0),S.Jc(Go,!0)),2&i&&(S.Ac(t=S.cc())&&(e.dialog=t.first),S.Ac(t=S.cc())&&(e.file=t.first))},outputs:{chiudiPopup:"chiudiPopup"},decls:31,vars:25,consts:[["id","popup-allegati-motivo","showEffect","fade","styleClass","small-dialog",3,"visible","modal","closable","blockScroll","contentStyle","header","dismissableMask","visibleChange"],["dialog",""],["key","tst-dialog"],["key","tst-allegati"],[1,"p-grid","p-align-center"],[1,"p-col"],[1,"p-grid"],[1,"p-col-4"],["name","motivazione","label","Assegnazione Svincolata","inputId","motivazione1",3,"disabled","value","ngModel","ngModelChange"],[1,"p-col-2"],["name","motivazione","label","Altro","inputId","motivazione2",3,"disabled","value","ngModel","ngModelChange"],[1,"p-col-12"],["class","ui-inputgroup",4,"ngIf"],["type","file","id","fileCaricato","name","fileCaricato","onclick","this.value = null",1,"inputUploadFile",2,"display","none",3,"accept","change"],["fileCaricato",""],["class","p-col boxgrey",4,"ngIf"],["class","p-col",4,"ngIf"],[1,"p-grid","p-justify-end"],["pButton","","type","button","label","Annulla",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none","w-5m",3,"click"],["pButton","","type","button","label","Salva",1,"ui-button-text-only","p-1","text-uppercase","font-weight-normal","shadow-none","w-5m",3,"disabled","click"],[1,"ui-inputgroup"],["pButton","","type","button","label","CARICA ALLEGATO",3,"disabled","click",4,"ngIf"],["pButton","","type","button","label","CARICA ALLEGATO",3,"disabled","click"],[1,"p-col","boxgrey"],[1,"text-confirm",2,"padding","0 !important"],["src","assets/img/ico-x.jpg",1,"cursor-pointer",3,"click"],["target","_blank",1,"cursor-pointer","p-col",3,"click"],[1,"p-col-5"],["type","text","pInputText","","placeholder","Aggiungi descrizione file","maxlength","100",1,"bg-white","d-block","w-100",2,"border","1px solid #323232","height","100%",3,"ngModel","ngModelChange"],["placeholder","Tipo documento","optionLabel","label",3,"options","ngModel","ngModelChange"],["pButton","","label","AGGIUNGI",3,"disabled","click"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["width","5%",4,"ngIf"],["width","35%"],["width","25%"],["width","5%"],[4,"ngIf"]],template:function(i,e){1&i&&(S.Tb(0,"p-dialog",0,1),S.bc("visibleChange",(function(i){return e.display=i})),S.Ob(2,"p-toast",2),S.Ob(3,"p-toast",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Tb(7,"div",7),S.Tb(8,"strong"),S.Oc(9,"Motivazione"),S.Sb(),S.Oc(10," (obbligatoria) "),S.Sb(),S.Tb(11,"div",7),S.Tb(12,"p-radioButton",8),S.bc("ngModelChange",(function(i){return e.motivazione=i})),S.Sb(),S.Sb(),S.Tb(13,"div",9),S.Tb(14,"p-radioButton",10),S.bc("ngModelChange",(function(i){return e.motivazione=i})),S.Sb(),S.Sb(),S.Tb(15,"div",11),S.Ob(16,"hr"),S.Sb(),S.Tb(17,"div",11),S.Mc(18,Vo,6,1,"div",12),S.Sb(),S.Sb(),S.Tb(19,"input",13,14),S.bc("change",(function(i){return e.onFileChange(i)})),S.Sb(),S.Sb(),S.Sb(),S.Tb(21,"div",4),S.Mc(22,Ho,16,5,"div",15),S.Sb(),S.Tb(23,"div",4),S.Mc(24,Qo,4,1,"div",16),S.Sb(),S.Ob(25,"br"),S.Tb(26,"div",17),S.Tb(27,"div"),S.Tb(28,"button",18),S.bc("click",(function(){return e.annulla()})),S.Sb(),S.Sb(),S.Tb(29,"div"),S.Tb(30,"button",19),S.bc("click",(function(i){return e.salva(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.nc("header",e.intestazionePopup),S.mc("visible",e.display)("modal",!0)("closable",!1)("blockScroll",!0)("contentStyle",S.rc(22,Jo))("dismissableMask",!0),S.Bb(2),S.Kc(S.rc(23,Xo)),S.Bb(1),S.Kc(S.rc(24,Xo)),S.Bb(9),S.nc("value",e.motivazioneEnum.ASSEGNAZIONE_SVINCOLATA),S.mc("disabled",e.READONLY_MODE)("ngModel",e.motivazione),S.Bb(2),S.nc("value",e.motivazioneEnum.ALTRO),S.mc("disabled",e.READONLY_MODE)("ngModel",e.motivazione),S.Bb(4),S.mc("ngIf",e.motivazione&&!(null!=e.fileAllegato&&e.fileAllegato.file)),S.Bb(1),S.nc("accept",e.fileConfig.fileExt),S.Bb(3),S.mc("ngIf",null==e.fileAllegato?null:e.fileAllegato.file),S.Bb(2),S.mc("ngIf",null==e.motivoRecuperoAmmissibile||null==e.motivoRecuperoAmmissibile.allegati?null:e.motivoRecuperoAmmissibile.allegati.length),S.Bb(6),S.mc("disabled",0==(null==e.motivoRecuperoAmmissibile||null==e.motivoRecuperoAmmissibile.allegati?null:e.motivoRecuperoAmmissibile.allegati.length)||e.READONLY_MODE))},directives:[So.a,N.a,Co.a,H.s,H.v,s.t,k.b,H.c,ze.a,H.n,xo.a,U.q,M.e],styles:["[_nghost-%COMP%]     label.ui-radiobutton-label{margin:0}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:450px;max-height:450px;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.pi{color:#01985a!important;font-size:x-large!important}[_nghost-%COMP%]   p-dropdown[_ngcontent-%COMP%] >   .ui-dropdown{height:100%}[_nghost-%COMP%]   p-dropdown[_ngcontent-%COMP%] >   .ui-dropdown label.ui-dropdown-label{height:100%;font-weight:400!important;padding-top:.3em}[_nghost-%COMP%]   p-dropdown[_ngcontent-%COMP%] >   .ui-dropdown div.ui-corner-right{top:.3em!important;margin:0!important}[_nghost-%COMP%]     .small-dialog{width:50vw}"]}),Ko),tn=function(i){return i.CONSUMATO="CONSUMATO",i.RIMANENZA="RIMANENZA",i.RECUPERO="RECUPERO",i.AMMISSIBILE="AMMISSIBILE",i}({}),on=function(i){return i.GASOLIO="GASOLIO",i.BENZINA="BENZINA",i.GASOLIO_SERRE="GASOLIO_SERRE",i.GASOLIO_TERZI="GASOLIO_TERZI",i}({}),nn=((Wo=function(){function i(e){_classCallCheck(this,i),this.formatSrv=e}return _createClass(i,[{key:"toAllegatoMotivazione",value:function(i,e){if(!i||!i.infoAllegati||!i.infoAllegati.length)return null;var t=[];return i.infoAllegati.forEach((function(o){var n={};n.descrizione=o.descrizione||void 0,n.name=o.nome,n.idAllegato=o.id,n.idConsuntivo=i.id,n.idDichiarazione=e,n.tipoDocumento=o.tipoDocumento||void 0,t.push(n)})),t}},{key:"toFile",value:function(i){var e=[];return i&&i.length?(i.forEach((function(i){i.file&&e.push(i.file)})),e):e}},{key:"toFileWithMetaDati",value:function(i,e){var t=[];return i&&i.length?(i.forEach((function(i){if(i.file){var o=new File([i.file],i.file.name+e+i.tipoDocumento+e+i.descrizione,{type:i.file.type});i.file=o,t.push(i.file)}})),t):t}},{key:"toInfoMetadatoConsuntivo",value:function(i){var e=[];return i&&i.length?(i.forEach((function(i){if(!i.file){var t={};t.id=i.idAllegato,e.push(t)}})),e):e}},{key:"buildConsuntiviDto",value:function(i){var e=[],t=Object(po.d)(i,["accisaMotivo"]);for(var o in t)"ammissibileGasolioContoTerzi"===o?e.push(this.buildConsuntivoDto(t[o],on.GASOLIO_TERZI,tn.AMMISSIBILE)):o.indexOf("consumato")>-1?e.push(this.setConsumato(o,t[o])):o.indexOf("rimanenza")>-1?e.push(this.setRimanenza(o,t[o])):o.indexOf("recupero")>-1&&e.push(this.setRecupero(o,t[o]));return e}},{key:"buildConsuntivoDto",value:function(i,e,t,o){var n={};return n.quantita=this.formatSrv.toNumberOrNull(i),n.carburante=e,n.tipo=t,n.motivazione=o&&o.motivazione||void 0,n.infoAllegati=o&&o.allegati&&this.toInfoMetadatoConsuntivo(o.allegati)||void 0,n}},{key:"buildAllegatiConsuntivoDto",value:function(i){return i&&i.allegati&&this.toInfoMetadatoConsuntivo(i.allegati).map((function(i){return i.id}))}},{key:"buildDichiarazioneConsumiPatch",value:function(i,e){var t={};return t.dataConduzione=e,t.motivazioneAccisa=i,t}},{key:"setConsumato",value:function(i,e){switch(i){case"consumatoGasolioContoProprio":return this.buildConsuntivoDto(e,on.GASOLIO,tn.CONSUMATO);case"consumatoGasolioContoTerzi":return this.buildConsuntivoDto(e,on.GASOLIO_TERZI,tn.CONSUMATO);case"consumatoBenzina":return this.buildConsuntivoDto(e,on.BENZINA,tn.CONSUMATO);case"consumatoGasolioSerre":return this.buildConsuntivoDto(e,on.GASOLIO_SERRE,tn.CONSUMATO)}}},{key:"setRimanenza",value:function(i,e){switch(i){case"rimanenzaDicembreGasolioContoProprio":return this.buildConsuntivoDto(e,on.GASOLIO,tn.RIMANENZA);case"rimanenzaDicembreGasolioContoTerzi":return this.buildConsuntivoDto(e,on.GASOLIO_TERZI,tn.RIMANENZA);case"rimanenzaDicembreBenzina":return this.buildConsuntivoDto(e,on.BENZINA,tn.RIMANENZA);case"rimanenzaDicembreGasolioSerre":return this.buildConsuntivoDto(e,on.GASOLIO_SERRE,tn.RIMANENZA)}}},{key:"setRecupero",value:function(i,e){switch(i){case"recuperoGasolioContoProprio":return this.buildConsuntivoDto(e,on.GASOLIO,tn.RECUPERO);case"recuperoGasolioContoTerzi":return this.buildConsuntivoDto(e,on.GASOLIO_TERZI,tn.RECUPERO);case"recuperoBenzina":return this.buildConsuntivoDto(e,on.BENZINA,tn.RECUPERO);case"recuperoGasolioSerre":return this.buildConsuntivoDto(e,on.GASOLIO_SERRE,tn.RECUPERO)}}}]),i}()).\u0275fac=function(i){return new(i||Wo)(S.Xb(ki.a))},Wo.\u0275prov=S.Jb({token:Wo,factory:Wo.\u0275fac,providedIn:"root"}),Wo),an=t("WpDp"),rn=t("4jpa"),cn=t("kPZZ"),sn=t("FVER"),ln=t("jkBy"),un=t("a6xG"),bn=function(i){return i.download_dichiarazione="download_dichiarazione",i.carica_dichiarazione_firmata="carica_dichiarazione_firmata",i.protocolla_dichiarazione="protocolla_dichiarazione",i.elimina_allegato="elimina_allegato",i}({}),hn=["fileInput"],mn=function(){return{overflow:"auto","max-height":"900px"}},pn=(($o=function(){function i(e,t,o,n,a,r,c,s,l){_classCallCheck(this,i),this.httpClientProxy=e,this.httpClientDichiarazioneConsumiUma=t,this.messageService=o,this.fileService=n,this.errorService=a,this.navigatorService=r,this.anagraficaFascicoloService=c,this._configuration=s,this.utentiService=l,this.chiudiPopup=new S.n,this.BUTTONS_ENUM=bn,this.BUTTONS_TYPE_ENUM=rt,this.FIRMA_CHECK_DISABLED=!0}return _createClass(i,[{key:"ngOnInit",value:function(){this.fileConfig=this.fileService.loadConfig(),this.initVariables()}},{key:"ngOnDestroy",value:function(){this.firmaSingolaSubscription&&this.firmaSingolaSubscription.unsubscribe(),this.protocollaDichiarazioneSubscription&&this.protocollaDichiarazioneSubscription.unsubscribe(),this.stampaPrivacySubscription&&this.stampaPrivacySubscription.unsubscribe()}},{key:"annulla",value:function(){this.popupVisibile=!1,this.chiudiPopup.emit()}},{key:"onFileChange",value:function(i,e){var t=this;if(i.target.files&&i.target.files.length){var o=i.target.files[0],n=new $e.a(this.fileConfig.fileExt,this.fileConfig.maxSize);n.isValidFileExtension(o,O.a.FILE_ERRORS.EXT)&&n.isValidFileSize(o,O.a.FILE_ERRORS.SIZE)&&(this.firmaSingolaSubscription=this.httpClientProxy.verificaFirmaSingola(o,this.cfRichiedente).subscribe((function(i){t.enableNextFields(e,o),t.haFirma=!0}),(function(i){t.haFirma=!0,console.log("ERRORE: ",i),t.FIRMA_CHECK_DISABLED?(t.enableNextFields(e,o),t.handleErrorFirma(i,!0)):(t.handleErrorFirma(i,!0),t.fileInput.nativeElement.value=null)}))),this.showErrors(n.getErrors())}}},{key:"onFileChangePrivacy",value:function(i,e){var t=this;if(i.target.files&&i.target.files.length){var o=i.target.files[0],n=new $e.a(this.fileConfig.fileExt,this.fileConfig.maxSize);n.isValidFileExtension(o,O.a.FILE_ERRORS.EXT)&&n.isValidFileSize(o,O.a.FILE_ERRORS.SIZE)&&(this.firmaSingolaSubscription=this.httpClientProxy.verificaFirmaSingola(o,this.cfRichiedente).subscribe((function(i){t.enableNextFields(e,o)}),(function(i){console.log("ERRORE: ",i),t.handleErrorFirma(i,!1),t.fileInput.nativeElement.value=null}))),this.showErrors(n.getErrors())}}},{key:"showErrors",value:function(i){var e=this;i&&i.length&&i.forEach((function(i){e.messageService.add(m.a.getToast("tst-dlg",m.b.error,i))}))}},{key:"enableNextFields",value:function(i,e){"dichiarazione"===i&&(this.fileDichiarazione.nome=e.name,this.fileDichiarazione.file=e,this.enabledUpload.enableHeader=!0),this.fileDichiarazione.file&&(this.enabledProtocolla.enableButton=!0)}},{key:"handleErrorFirma",value:function(i,e){if(i&&i.error&&i.error.message)switch(i.error.message){case it.FIRMATARIO_TITOLARE_DIVERSI:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.CODICE_FISCALE_NO_MATCH,"tst-dlg");break;case it.FILE_NON_FIRMATO:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.NO_FIRMA,"tst-dlg"),e&&(this.haFirma=!1);break;case it.FIRMA_NON_VALIDA:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.NO_FIRMA_VALIDA,"tst-dlg");break;case it.DATI_FIRMATARIO_MANCANTI:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.NO_DATI_FIRMATARIO,"tst-dlg");break;case it.FIRMATARIO_NON_UNIVOCO:this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.NO_SINGLE_FIRMATARIO,"tst-dlg");break;default:this.errorService.showError(i,"tst-dlg")}else this.errorService.showError(i,"tst-dlg")}},{key:"getHeader",value:function(i,e,t){return{title:i,subtitle:e,icon:t}}},{key:"getButtonModel",value:function(i,e,t,o){return{label:i,icon:e,id:t,type:o}}},{key:"initVariables",value:function(){this.enabledDownload={enableButton:!0,enableHeader:!1},this.enabledUpload={enableButton:!1,enableHeader:!1},this.enabledProtocolla={enableButton:!1,enableHeader:!1},this.fileDichiarazione=new at.a,this.fileDichiarazione.showDeleteButton=!0,this.fileInput.nativeElement.value=null}},{key:"onClickBoxButton",value:function(i,e){switch(i.idButton){case bn.download_dichiarazione:this.scaricaDichiarazioneConsumiFile();break;case bn.carica_dichiarazione_firmata:this.caricaDichiarazione(i,e);break;case bn.protocolla_dichiarazione:this.protocollaDichiarazione();break;case bn.elimina_allegato:this.eliminaAllegato(i.componentName);break;default:console.log("Click non identificato")}}},{key:"protocollaDichiarazione",value:function(){var i=this;this.protocollaDichiarazioneSubscription=this.httpClientDichiarazioneConsumiUma.protocollaDichiarazioneConsumi(Number(this.idDichiarazione),this.fileDichiarazione.file,this.haFirma).subscribe((function(e){i.messageService.add(m.a.getToast("tst-dlg-protocollazione",m.b.success,O.a.protocollaDichiarazioneOK))}),(function(e){console.log("ERRORE: ",e),i.errorService.showErrorWithMessage(e&&e.error&&e.error.message?e.error.message:O.a.erroreProtocollaRichiesta,"tst-dlg")}))}},{key:"scaricaDichiarazioneConsumiFile",value:function(){var i=this;this.httpClientDichiarazioneConsumiUma.getDichiarazioneConsumiFile(this.idDichiarazione).subscribe((function(e){i.dichiarazioneConsumiFile=new Blob([e],{type:"application/pdf"}),R.saveAs(i.dichiarazioneConsumiFile,i.idDichiarazione+"_dichiarazioneconsumi.pdf"),i.enabledDownload={enableButton:!0,enableHeader:!0},i.enabledUpload={enableButton:!0,enableHeader:!1}}),(function(e){i.dichiarazioneConsumiFile=null,console.log("ERRORE: ",e),i.messageService.add(m.a.getToast("tst-dlg",m.b.error,"Errore imprevisto. Si prega di riprovare pi\xf9 tardi"))}))}},{key:"caricaDichiarazione",value:function(i,e){e||(e=document.getElementById("caricaFileInput")),i.typeButton===rt.file&&e&&e.click()}},{key:"eliminaAllegato",value:function(i){"dichiarazione"===i&&(this.resetDichiarazione(),this.enabledUpload.enableHeader=!1,this.enabledProtocolla.enableButton=!1)}},{key:"resetDichiarazione",value:function(){this.fileDichiarazione.file=null,this.fileDichiarazione.nome=null,this.fileInput.nativeElement.value=null}},{key:"onCloseToastProtocollazione",value:function(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo)}}]),i}()).\u0275fac=function(i){return new(i||$o)(S.Nb(tt),S.Nb(Oe.a),S.Nb(M.d),S.Nb(Xe.a),S.Nb(y.a),S.Nb(ve.a),S.Nb(ot.a),S.Nb(et.a),S.Nb(nt.a))},$o.\u0275cmp=S.Hb({type:$o,selectors:[["app-popup-protocollazione-dichiarazione"]],viewQuery:function(i,e){var t;1&i&&S.Jc(hn,!0),2&i&&S.Ac(t=S.cc())&&(e.fileInput=t.first)},inputs:{cfRichiedente:"cfRichiedente",cuaa:"cuaa",idDichiarazione:"idDichiarazione",idFascicolo:"idFascicolo",popupVisibile:"popupVisibile"},outputs:{chiudiPopup:"chiudiPopup"},decls:25,vars:29,consts:[["width","1100","showEffect","fade",3,"visible","modal","closable","contentStyle","visibleChange"],["key","tst-dlg",3,"baseZIndex"],["position","top-center","key","tst-dlg-protocollazione",3,"baseZIndex","onClose"],[1,"p-grid","w-100"],[1,"p-col"],[1,"popup-approvazione","popup--custom"],[3,"innerHtml"],[1,"p-grid"],[1,"p-col-4"],[3,"header","button","enableBox","onClickButton"],[3,"name","header","button","enableBox","document","onClickButton"],["id","caricaFileInput","name","caricaFileInput","type","file",3,"hidden","accept","change"],["fileInput",""],[1,"d-flex","align-items-center","justify-content-between"],["pButton","",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none",3,"click"]],template:function(i,e){if(1&i){var t=S.Ub();S.Tb(0,"p-dialog",0),S.bc("visibleChange",(function(i){return e.popupVisibile=i})),S.Ob(1,"p-toast",1),S.Tb(2,"p-toast",2),S.bc("onClose",(function(){return e.onCloseToastProtocollazione()})),S.Sb(),S.Tb(3,"p-header"),S.Oc(4),S.gc(5,"translate"),S.Sb(),S.Tb(6,"div",3),S.Tb(7,"div",4),S.Tb(8,"div",5),S.Tb(9,"h6"),S.Ob(10,"p",6),S.gc(11,"translate"),S.Sb(),S.Tb(12,"div",7),S.Tb(13,"div",8),S.Tb(14,"app-box",9),S.bc("onClickButton",(function(i){return e.onClickBoxButton(i)})),S.Sb(),S.Sb(),S.Tb(15,"div",8),S.Tb(16,"app-box",10),S.bc("onClickButton",(function(i){S.Ec(t);var o=S.Bc(18);return e.onClickBoxButton(i,o)})),S.Sb(),S.Tb(17,"input",11,12),S.bc("change",(function(i){return e.onFileChange(i,"dichiarazione")})),S.Sb(),S.Sb(),S.Tb(19,"div",8),S.Tb(20,"app-box",9),S.bc("onClickButton",(function(i){return e.onClickBoxButton(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(21,"div",13),S.Tb(22,"button",14),S.bc("click",(function(){return e.annulla()})),S.Oc(23),S.gc(24,"translate"),S.Sb(),S.Sb(),S.Sb()}2&i&&(S.mc("visible",e.popupVisibile)("modal",!0)("closable",!1)("contentStyle",S.rc(28,mn)),S.Bb(1),S.mc("baseZIndex",5e4),S.Bb(1),S.mc("baseZIndex",5e4),S.Bb(2),S.Qc(" ",S.hc(5,22,"UMA.PROTOCOLLAZIONE_DICHIARAZIONE")," "),S.Bb(6),S.mc("innerHtml",S.hc(11,24,"UMA.PROTOCOLLAZIONE_DICHIARAZIONE_MSG"),S.Fc),S.Bb(4),S.mc("header",e.getHeader("UMA.SCARICA_DICHIARAZIONE","UMA.DESC_SCARICA_DICHIARAZIONE","assets/img/icons/icon-download2.png"))("button",e.getButtonModel("UMA.SCARICA","pi pi-arrow-down",e.BUTTONS_ENUM.download_dichiarazione,e.BUTTONS_TYPE_ENUM.button))("enableBox",e.enabledDownload),S.Bb(2),S.mc("name","dichiarazione")("header",e.getHeader("UMA.FIRMA_DICHIARAZIONE","UMA.DESC_FIRMA_DICHIARAZIONE","assets/img/icons/icon-signature.svg"))("button",e.getButtonModel("UMA.CARICA","pi pi-arrow-up",e.BUTTONS_ENUM.carica_dichiarazione_firmata,e.BUTTONS_TYPE_ENUM.file))("enableBox",e.enabledUpload)("document",e.fileDichiarazione),S.Bb(1),S.nc("accept",e.fileConfig.fileExt),S.mc("hidden",!0),S.Bb(3),S.mc("header",e.getHeader("UMA.PROTOCOLLA_DICHIARAZIONE","UMA.DESC_PROTOCOLLA_DICHIARAZIONE","assets/img/icons/icon-file-check.svg"))("button",e.getButtonModel("UMA.PROTOCOLLA","",e.BUTTONS_ENUM.protocolla_dichiarazione,e.BUTTONS_TYPE_ENUM.button))("enableBox",e.enabledProtocolla),S.Bb(3),S.Qc(" ",S.hc(24,26,"chiudi")," "))},directives:[So.a,N.a,M.c,ct.a,k.b],pipes:[mi.d],styles:["[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}"]}),$o),dn=t("1SOg"),gn=t("DYOT"),fn=["popupAllegatiMotivoConsumi"],vn=["popupAllegatiMotivoRecupero"],Sn=["dataConduzioneRef"],Cn=["cd"];function On(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-popup-protocollazione-dichiarazione",104),S.bc("chiudiPopup",(function(){return S.Ec(t),S.fc().closeProtocollazioneDialog()})),S.Sb()}if(2&i){var o=S.fc();S.mc("cfRichiedente",o.dichiarazioneConsumiDto.cfRichiedente)("idFascicolo",o.idFascicolo)("idDichiarazione",o.dichiarazioneConsumiDto.id)("popupVisibile",o.popupProtocollaVisibile)("cuaa",o.dichiarazioneConsumiDto.cuaa)}}function Tn(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",105),S.Ob(1,"i",106),S.Tb(2,"h3"),S.Oc(3),S.Sb(),S.Tb(4,"p"),S.Oc(5),S.Sb(),S.Sb(),S.Tb(6,"div",107),S.Tb(7,"div",108),S.Tb(8,"button",109),S.bc("click",(function(){S.Ec(t);var i=S.fc(),e=S.Bc(18);return i.confermaCancellazioneConsuntivo(e)})),S.Sb(),S.Sb(),S.Tb(9,"div",108),S.Tb(10,"button",110),S.bc("click",(function(){S.Ec(t);var i=S.fc(),e=S.Bc(18);return i.rifiutaCancellazioneConsuntivo(e)})),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit;S.Bb(3),S.Pc(o.summary),S.Bb(2),S.Pc(o.detail)}}function In(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",113),S.bc("click",(function(){S.Ec(t);var i=S.fc(2);return!i.loading&&i.validaDichiarazione()&&i.saveDichiarazione()})),S.Sb()}}function zn(i,e){if(1&i&&(S.Tb(0,"div",111),S.Mc(1,In,1,0,"button",112),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("loading",t.loading)}}function An(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",116),S.bc("click",(function(){S.Ec(t);var i=S.fc(2);return!i.loading&&i.validaDichiarazioneDaProtocollare()&&i.saveAndProtocollaDichiarazione()})),S.Sb()}}function En(i,e){if(1&i&&(S.Tb(0,"div",114),S.Mc(1,An,1,0,"button",115),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("loading",t.loading)}}function yn(i,e){if(1&i&&(S.Tb(0,"div",117),S.Tb(1,"div",33),S.Oc(2," Data di riferimento conduzione: "),S.Tb(3,"strong"),S.Oc(4),S.gc(5,"date"),S.Sb(),S.Sb(),S.Sb()),2&i){var t=S.fc();S.Bb(4),S.Pc(S.ic(5,1,null==t.dichiarazioneConsumiDto?null:t.dichiarazioneConsumiDto.dataConduzione,"dd MMMM yyyy"))}}function Rn(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",122),S.bc("click",(function(){return S.Ec(t),S.fc(2).ripristinaDataConduzione()})),S.Tb(1,"span",123),S.Tb(2,"u"),S.Oc(3),S.gc(4,"date"),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=S.fc(2);S.Bb(3),S.Qc(" ripristina data ",S.ic(4,1,o.dataConduzioneDefault,"dd/MM/yyyy")," ")}}function Dn(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",117),S.Tb(1,"div",118),S.Oc(2,"Data riferimento conduzione:"),S.Sb(),S.Tb(3,"div",118),S.Tb(4,"p-calendar",119,120),S.bc("onSelect",(function(i){return S.Ec(t),S.fc().salvaDataConduzione(i)})),S.Sb(),S.Sb(),S.Mc(6,Rn,5,4,"div",121),S.Ob(7,"div",14),S.Sb()}if(2&i){var o=S.fc();S.Bb(4),S.mc("locale",o.calendarService.localeITA)("showIcon",!0)("minDate",o.minDate)("maxDate",o.maxDate)("readonlyInput",!0),S.Bb(2),S.mc("ngIf",!o.isDataDefault())}}function Mn(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",124),S.bc("click",(function(){return S.Ec(t),S.fc().openDialogMotivazione("AMMISSIBILE_GASOLIO_TERZI")})),S.Sb()}}function Nn(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",125),S.bc("click",(function(){return S.Ec(t),S.fc().cancellaAllegati("AMMISSIBILE_GASOLIO_TERZI")})),S.Sb()}}function _n(i,e){1&i&&S.Ob(0,"p-message",126)}function Bn(i,e){1&i&&S.Ob(0,"p-message",127)}function kn(i,e){1&i&&S.Ob(0,"p-message",128)}function Fn(i,e){1&i&&S.Ob(0,"p-message",130)}function Pn(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Fn,1,0,"p-message",129),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("accisaMotivo").errors?null:t.consumiForm.get("accisaMotivo").errors.required)}}function wn(i,e){1&i&&(S.Tb(0,"p-footer"),S.Tb(1,"i"),S.Oc(2,"Nota: \xe8 obbligatorio inserire una motivazione per il campo Accisa"),S.Sb(),S.Sb())}function xn(i,e){1&i&&S.Ob(0,"p-message",126)}function Ln(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioTotale").value)}}function Gn(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,xn,1,0,"p-message",45),S.Mc(2,Ln,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("consumatoGasolioContoProprio").errors?null:t.consumiForm.get("consumatoGasolioContoProprio").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("consumatoGasolioContoProprio").errors?null:t.consumiForm.get("consumatoGasolioContoProprio").errors.maxArray)}}function Un(i,e){1&i&&S.Ob(0,"p-message",126)}function Vn(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioTotale").value)}}function Hn(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Un,1,0,"p-message",45),S.Mc(2,Vn,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("consumatoGasolioContoTerzi").errors?null:t.consumiForm.get("consumatoGasolioContoTerzi").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("consumatoGasolioContoTerzi").errors?null:t.consumiForm.get("consumatoGasolioContoTerzi").errors.maxArray)}}function Zn(i,e){1&i&&S.Ob(0,"p-message",126)}function jn(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileBenzina").value)}}function Yn(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Zn,1,0,"p-message",45),S.Mc(2,jn,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("consumatoBenzina").errors?null:t.consumiForm.get("consumatoBenzina").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("consumatoBenzina").errors?null:t.consumiForm.get("consumatoBenzina").errors.maxArray)}}function qn(i,e){1&i&&S.Ob(0,"p-message",126)}function Qn(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioSerre").value)}}function Kn(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,qn,1,0,"p-message",45),S.Mc(2,Qn,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("consumatoGasolioSerre").errors?null:t.consumiForm.get("consumatoGasolioSerre").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("consumatoGasolioSerre").errors?null:t.consumiForm.get("consumatoGasolioSerre").errors.maxArray)}}function Wn(i,e){1&i&&S.Ob(0,"p-message",126)}function $n(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioTotale").value)}}function Jn(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Wn,1,0,"p-message",45),S.Mc(2,$n,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("rimanenzaDicembreGasolioContoProprio").errors?null:t.consumiForm.get("rimanenzaDicembreGasolioContoProprio").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("rimanenzaDicembreGasolioContoProprio").errors?null:t.consumiForm.get("rimanenzaDicembreGasolioContoProprio").errors.maxArray)}}function Xn(i,e){1&i&&S.Ob(0,"p-message",126)}function ia(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioTotale").value)}}function ea(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Xn,1,0,"p-message",45),S.Mc(2,ia,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").errors?null:t.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").errors?null:t.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").errors.maxArray)}}function ta(i,e){1&i&&S.Ob(0,"p-message",126)}function oa(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileBenzina").value)}}function na(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,ta,1,0,"p-message",45),S.Mc(2,oa,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("rimanenzaDicembreBenzina").errors?null:t.consumiForm.get("rimanenzaDicembreBenzina").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("rimanenzaDicembreBenzina").errors?null:t.consumiForm.get("rimanenzaDicembreBenzina").errors.maxArray)}}function aa(i,e){1&i&&S.Ob(0,"p-message",126)}function ra(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioSerre").value)}}function ca(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,aa,1,0,"p-message",45),S.Mc(2,ra,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("rimanenzaDicembreGasolioSerre").errors?null:t.consumiForm.get("rimanenzaDicembreGasolioSerre").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("rimanenzaDicembreGasolioSerre").errors?null:t.consumiForm.get("rimanenzaDicembreGasolioSerre").errors.maxArray)}}function sa(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",124),S.bc("click",(function(){return S.Ec(t),S.fc().openDialogMotivazione("RECUPERO_GASOLIO_PROPRIO")})),S.Sb()}}function la(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",125),S.bc("click",(function(){return S.Ec(t),S.fc().cancellaAllegati("RECUPERO_GASOLIO_PROPRIO")})),S.Sb()}}function ua(i,e){1&i&&S.Ob(0,"p-message",126)}function ba(i,e){1&i&&S.Ob(0,"p-message",127)}function ha(i,e){1&i&&S.Ob(0,"p-message",128)}function ma(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioTotale").value)}}function pa(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,ua,1,0,"p-message",45),S.Mc(2,ba,1,0,"p-message",46),S.Mc(3,ha,1,0,"p-message",47),S.Mc(4,ma,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioContoProprio").errors?null:t.consumiForm.get("recuperoGasolioContoProprio").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioContoProprio").errors?null:t.consumiForm.get("recuperoGasolioContoProprio").errors.emptylist),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioContoProprio").errors?null:t.consumiForm.get("recuperoGasolioContoProprio").errors.notZero),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioContoProprio").errors?null:t.consumiForm.get("recuperoGasolioContoProprio").errors.maxArray)}}function da(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",124),S.bc("click",(function(){return S.Ec(t),S.fc().openDialogMotivazione("RECUPERO_GASOLIO_TERZI")})),S.Sb()}}function ga(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",125),S.bc("click",(function(){return S.Ec(t),S.fc().cancellaAllegati("RECUPERO_GASOLIO_TERZI")})),S.Sb()}}function fa(i,e){1&i&&S.Ob(0,"p-message",126)}function va(i,e){1&i&&S.Ob(0,"p-message",127)}function Sa(i,e){1&i&&S.Ob(0,"p-message",128)}function Ca(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioTotale").value)}}function Oa(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,fa,1,0,"p-message",45),S.Mc(2,va,1,0,"p-message",46),S.Mc(3,Sa,1,0,"p-message",47),S.Mc(4,Ca,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioContoTerzi").errors?null:t.consumiForm.get("recuperoGasolioContoTerzi").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioContoTerzi").errors?null:t.consumiForm.get("recuperoGasolioContoTerzi").errors.emptylist),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioContoTerzi").errors?null:t.consumiForm.get("recuperoGasolioContoTerzi").errors.notZero),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioContoTerzi").errors?null:t.consumiForm.get("recuperoGasolioContoTerzi").errors.maxArray)}}function Ta(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",124),S.bc("click",(function(){return S.Ec(t),S.fc().openDialogMotivazione("RECUPERO_BENZINA")})),S.Sb()}}function Ia(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",125),S.bc("click",(function(){return S.Ec(t),S.fc().cancellaAllegati("RECUPERO_BENZINA")})),S.Sb()}}function za(i,e){1&i&&S.Ob(0,"p-message",126)}function Aa(i,e){1&i&&S.Ob(0,"p-message",127)}function Ea(i,e){1&i&&S.Ob(0,"p-message",128)}function ya(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileBenzina").value)}}function Ra(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,za,1,0,"p-message",45),S.Mc(2,Aa,1,0,"p-message",46),S.Mc(3,Ea,1,0,"p-message",47),S.Mc(4,ya,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoBenzina").errors?null:t.consumiForm.get("recuperoBenzina").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoBenzina").errors?null:t.consumiForm.get("recuperoBenzina").errors.emptylist),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoBenzina").errors?null:t.consumiForm.get("recuperoBenzina").errors.notZero),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoBenzina").errors?null:t.consumiForm.get("recuperoBenzina").errors.maxArray)}}function Da(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",124),S.bc("click",(function(){return S.Ec(t),S.fc().openDialogMotivazione("RECUPERO_GASOLIO_SERRE")})),S.Sb()}}function Ma(i,e){if(1&i){var t=S.Ub();S.Tb(0,"button",125),S.bc("click",(function(){return S.Ec(t),S.fc().cancellaAllegati("RECUPERO_GASOLIO_SERRE")})),S.Sb()}}function Na(i,e){1&i&&S.Ob(0,"p-message",126)}function _a(i,e){1&i&&S.Ob(0,"p-message",127)}function Ba(i,e){1&i&&S.Ob(0,"p-message",128)}function ka(i,e){if(1&i&&S.Ob(0,"p-message",132),2&i){var t=S.fc(2);S.nc("text","Attenzione! Le quantit\xe0 digitate eccedono il carburante disponibile: "+t.consumiForm.get("disponibileGasolioSerre").value)}}function Fa(i,e){if(1&i&&(S.Tb(0,"div"),S.Mc(1,Na,1,0,"p-message",45),S.Mc(2,_a,1,0,"p-message",46),S.Mc(3,Ba,1,0,"p-message",47),S.Mc(4,ka,1,1,"p-message",131),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioSerre").errors?null:t.consumiForm.get("recuperoGasolioSerre").errors.pattern),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioSerre").errors?null:t.consumiForm.get("recuperoGasolioSerre").errors.emptylist),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioSerre").errors?null:t.consumiForm.get("recuperoGasolioSerre").errors.notZero),S.Bb(1),S.mc("ngIf",null==t.consumiForm.get("recuperoGasolioSerre").errors?null:t.consumiForm.get("recuperoGasolioSerre").errors.maxArray)}}var Pa,wa,xa,La,Ga=function(){return{marginTop:"70px"}},Ua=function(){return{on:!0,field:"richAssegnatoGasolioContoTerzi"}},Va=function(i,e){return{list:i,active:e}},Ha=function(){return["consumatoGasolioContoTerzi","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreGasolioContoProprio","recuperoGasolioContoProprio","recuperoGasolioContoTerzi"]},Za=function(i){return{toSum:i,limit:"disponibileGasolioTotale"}},ja=function(){return["consumatoGasolioContoProprio","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreGasolioContoProprio","recuperoGasolioContoProprio","recuperoGasolioContoTerzi"]},Ya=function(){return["recuperoBenzina","rimanenzaDicembreBenzina"]},qa=function(i){return{toSum:i,limit:"disponibileBenzina"}},Qa=function(){return["rimanenzaDicembreGasolioSerre","recuperoGasolioSerre"]},Ka=function(i){return{toSum:i,limit:"disponibileGasolioSerre"}},Wa=function(){return["consumatoGasolioContoTerzi","rimanenzaDicembreGasolioContoTerzi","consumatoGasolioContoProprio","recuperoGasolioContoProprio","recuperoGasolioContoTerzi"]},$a=function(){return["consumatoGasolioContoTerzi","consumatoGasolioContoProprio","rimanenzaDicembreGasolioContoProprio","recuperoGasolioContoProprio","recuperoGasolioContoTerzi"]},Ja=function(){return["consumatoBenzina","recuperoBenzina"]},Xa=function(){return["consumatoGasolioSerre","recuperoGasolioSerre"]},ir=function(i){return{list:i}},er=function(){return["consumatoGasolioContoTerzi","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreGasolioContoProprio","consumatoGasolioContoProprio","recuperoGasolioContoTerzi"]},tr=function(){return["consumatoGasolioContoTerzi","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreGasolioContoProprio","recuperoGasolioContoProprio","consumatoGasolioContoProprio"]},or=function(){return["consumatoBenzina","rimanenzaDicembreBenzina"]},nr=function(){return["rimanenzaDicembreGasolioSerre","consumatoGasolioSerre"]},ar=((Pa=function(){function i(e,t,o,n,a,r,c,s,l,u,b,h,m,p,d,g,f,v,S,C,O){_classCallCheck(this,i),this.tipologicheService=e,this.calendarService=t,this.indiceUmaService=o,this.activeRoute=n,this.httpClientDichiarazioneConsumiUmaService=a,this.httpClientTrasferimentiCarburanteService=r,this.httpClientMacchineUmaService=c,this.httpClientDomandaUmaService=s,this.modelBuilderService=l,this.authService=u,this.location=b,this.errorService=h,this.messageService=m,this.formService=p,this.confirmationService=d,this.consumiBuilderService=g,this.formatSrv=f,this.dateUtilService=v,this.router=S,this.httpClientDomandUmaService=C,this.navigatorService=O,this.SEPARATOR="$$",this.STATO_DICHIARAZIONE_CONSUMI=Ie.a}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.initRoles(),this.navigationEndSubscription=this.router.events.pipe(Object(b.a)((function(i){return i instanceof D.b&&i.url.indexOf("dichiarazione-consumi")>-1?Object(w.a)({trigger:"LOAD_DICHIARAZIONE"}):Object(w.a)({trigger:"NONE"})}))).subscribe((function(e){e&&e.trigger&&"LOAD_DICHIARAZIONE"===e.trigger&&(i.initVariables(),i.initDichiarazione(),i.initOnChangeListeners())}),(function(e){return i.errorService.showError(e)})),this.initVariables(),this.initDichiarazione(),this.initOnChangeListeners()}},{key:"initOnChangeListeners",value:function(){var i=this;this.consumatoGasolioContoProprioSub=this.consumiForm.get("consumatoGasolioContoProprio").valueChanges.subscribe((function(e){var t=i.formatSrv.toNumber(e)+i.formatSrv.toNumber(i.consumiForm.get("consumatoGasolioContoTerzi").value);i.consumiForm.get("consumatoGasolioTotale").setValue(t)})),this.consumatoGasolioContoTerziSub=this.consumiForm.get("consumatoGasolioContoTerzi").valueChanges.subscribe((function(e){var t=i.formatSrv.toNumber(e)+i.formatSrv.toNumber(i.consumiForm.get("consumatoGasolioContoProprio").value);i.consumiForm.get("consumatoGasolioTotale").setValue(t)})),this.rimanenzaGasolioContoProprioSub=this.consumiForm.get("rimanenzaDicembreGasolioContoProprio").valueChanges.subscribe((function(e){var t=i.formatSrv.toNumber(e)+i.formatSrv.toNumber(i.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").value);i.consumiForm.get("rimanenzaDicembreGasolioTotale").setValue(t)})),this.rimanenzaGasolioContoTerziSub=this.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").valueChanges.subscribe((function(e){var t=i.formatSrv.toNumber(e)+i.formatSrv.toNumber(i.consumiForm.get("rimanenzaDicembreGasolioContoProprio").value);i.consumiForm.get("rimanenzaDicembreGasolioTotale").setValue(t)})),this.recuperoGasolioContoProprioSub=this.consumiForm.get("recuperoGasolioContoProprio").valueChanges.subscribe((function(e){i.consumiForm.get("recuperoGasolioTotale").setValue(i.formatSrv.toNumber(e)+i.formatSrv.toNumber(i.consumiForm.get("recuperoGasolioContoTerzi").value))})),this.recuperoGasolioContoTerziSub=this.consumiForm.get("recuperoGasolioContoTerzi").valueChanges.subscribe((function(e){i.consumiForm.get("recuperoGasolioTotale").setValue(i.formatSrv.toNumber(e)+i.formatSrv.toNumber(i.consumiForm.get("recuperoGasolioContoProprio").value))})),this.ammissibileGasolioContoTerziSub=this.consumiForm.get("ammissibileGasolioContoTerzi").valueChanges.subscribe((function(e){i.consumiForm.get("ammissibileGasolioContoTerzi").valid&&(i.setAmmissibileGasolioTotale(),i.setAccisaByCarburante("GASOLIO",i.calcolaAccisaByCarburante("GASOLIO")))})),this.consumatoGasolioTotaleSub=this.consumiForm.get("consumatoGasolioTotale").valueChanges.subscribe((function(e){i.setAccisaByCarburante("GASOLIO",i.calcolaAccisaByCarburante("GASOLIO"))})),this.ammissibileGasolioTotaleSub=this.consumiForm.get("ammissibileGasolioTotale").valueChanges.subscribe((function(e){i.setAccisaByCarburante("GASOLIO",i.calcolaAccisaByCarburante("GASOLIO"))})),this.consumatoBenzinaSub=this.consumiForm.get("consumatoBenzina").valueChanges.subscribe((function(e){i.setAccisaByCarburante("BENZINA",i.calcolaAccisaByCarburante("BENZINA"))})),this.ammissibileBenzinaSub=this.consumiForm.get("ammissibileBenzina").valueChanges.subscribe((function(e){i.setAccisaByCarburante("BENZINA",i.calcolaAccisaByCarburante("BENZINA"))})),this.consumatoGasolioSerreSub=this.consumiForm.get("consumatoGasolioSerre").valueChanges.subscribe((function(e){i.setAccisaByCarburante("GASOLIO_SERRE",i.calcolaAccisaByCarburante("GASOLIO_SERRE"))})),this.ammissibileGasolioSerreSub=this.consumiForm.get("ammissibileGasolioSerre").valueChanges.subscribe((function(e){i.setAccisaByCarburante("GASOLIO_SERRE",i.calcolaAccisaByCarburante("GASOLIO_SERRE"))})),this.rimanenzaDicembreGasolioTotaleSub=this.consumiForm.get("rimanenzaDicembreGasolioTotale").valueChanges.subscribe((function(e){i.setAccisaByCarburante("GASOLIO",i.calcolaAccisaByCarburante("GASOLIO"))})),this.rimanenzaDicembreBenzinaSub=this.consumiForm.get("rimanenzaDicembreBenzina").valueChanges.subscribe((function(e){i.setAccisaByCarburante("BENZINA",i.calcolaAccisaByCarburante("BENZINA"))})),this.rimanenzaDicembreGasolioSerreSub=this.consumiForm.get("rimanenzaDicembreGasolioSerre").valueChanges.subscribe((function(e){i.setAccisaByCarburante("GASOLIO_SERRE",i.calcolaAccisaByCarburante("GASOLIO_SERRE"))})),this.recuperoGasolioTotSub=this.consumiForm.get("recuperoGasolioTotale").valueChanges.subscribe((function(e){i.setAccisaByCarburante("GASOLIO",i.calcolaAccisaByCarburante("GASOLIO"))})),this.recuperoBenzinaSub=this.consumiForm.get("recuperoBenzina").valueChanges.subscribe((function(e){i.setAccisaByCarburante("BENZINA",i.calcolaAccisaByCarburante("BENZINA"))})),this.recuperoGasolioSerreSub=this.consumiForm.get("recuperoGasolioSerre").valueChanges.subscribe((function(e){i.setAccisaByCarburante("GASOLIO_SERRE",i.calcolaAccisaByCarburante("GASOLIO_SERRE"))}))}},{key:"initDichiarazione",value:function(){var i=this;this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){return i.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(e.id)})),Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){i.dichiarazioneConsumiDto=e,i.initDataConduzione();var t=i.httpClientMacchineUmaService.getMacchineByIdDomanda(e.idRichiesta.toString()),o=i.httpClientTrasferimentiCarburanteService.getCarburanteRicevuto(i.dichiarazioneConsumiDto.cuaa,i.dichiarazioneConsumiDto.campagnaRichiesta.toString()),n=i.httpClientTrasferimentiCarburanteService.getCarburanteTrasferito(i.dichiarazioneConsumiDto.cuaa,i.dichiarazioneConsumiDto.campagnaRichiesta.toString()),a=i.httpClientDomandaUmaService.getPrelieviByCuaaAndCampagna(e.cuaa,e.campagnaRichiesta.toString()),r=i.httpClientDichiarazioneConsumiUmaService.getResiduoAnnoPrecedente(i.dichiarazioneConsumiDto.cuaa,i.dichiarazioneConsumiDto.campagnaRichiesta-1,[Ie.a.PROTOCOLLATA]),c=i.httpClientDomandaUmaService.getDomandaById(i.dichiarazioneConsumiDto.idRichiesta.toString()),s=i.httpClientDichiarazioneConsumiUmaService.getConsuntivi(i.dichiarazioneConsumiDto.id.toString()),l=i.httpClientDichiarazioneConsumiUmaService.getAmmissibile(i.dichiarazioneConsumiDto.id.toString());return Object(si.a)([t,o,n,a,r,c,s,l])})),Object(h.a)((function(e){return i.errorService.showError(e),u.a}))).subscribe((function(e){var t=_slicedToArray(e,8),o=t[0],n=t[1],a=t[2],r=t[3],c=t[4],s=t[5],l=t[6],u=t[7];i.richiestaCarburanteDto=s,i.setFabbisognoDichiarato(o);var b=c&&c.length&&c[0].rimanenza?c[0].rimanenza:null;i.setResiduoCampagnaPrecedente(b),i.setRichiestoAssegnato(),i.setCarburanteRicevuto(n.totale),i.setCarburanteTrasferito(a.totale),i.setCarburantePrelevato(r.totale),i.setDisponibile(i.calcolaDisponibile(b,n.totale,r.totale,a.totale)),i.setConsuntivi(l),i.setAmmissibile(u),i.setAmmissibileGasolioTotale(),i.setAccisaByCarburante("GASOLIO",i.calcolaAccisaByCarburante("GASOLIO")),i.setAccisaByCarburante("BENZINA",i.calcolaAccisaByCarburante("BENZINA")),i.setAccisaByCarburante("GASOLIO_SERRE",i.calcolaAccisaByCarburante("GASOLIO_SERRE")),i.setMotivazioneAccisa(),i.loading=!1}))}},{key:"showAllegatiIconAmmissibile",value:function(i,e){return!!(!i.disabled&&this.formatSrv.toNumber(i.value)>0&&this.formatSrv.toNumber(i.value)!=this.formatSrv.toNumber(e.value)||((this.motivoRecuperoAmmissibile||{}).allegati||[]).length)}},{key:"fillWithZero",value:function(){var i=this.consumiForm.value,e=Object(po.d)(i,["accisaMotivo"]);for(var t in e){var o=this.formatSrv.toNumber(this.consumiForm.get(""+t).value);this.consumiForm.get(""+t).setValue(o)}}},{key:"openPanelsByField",value:function(i){var e=this;i.forEach((function(i){"ammissibileGasolioContoTerzi"===i.name&&(e.areCollapsed[0]=!i.control.invalid),"accisaMotivo"===i.name&&(e.areCollapsed[1]=!i.control.invalid)}));var t=["consumatoGasolioContoProprio","consumatoGasolioContoTerzi","consumatoBenzina","consumatoGasolioSerre","consumatoGasolioSerre","rimanenzaDicembreGasolioContoProprio","rimanenzaDicembreGasolioContoTerzi","rimanenzaDicembreBenzina","rimanenzaDicembreGasolioSerre","recuperoGasolioContoProprio","recuperoGasolioContoTerzi","recuperoBenzina","recuperoGasolioSerre"],o=i.filter((function(i){return t.indexOf(i.name)>-1}));this.areCollapsed[2]=!o||!o.length}},{key:"goBack",value:function(){this.location.back()}},{key:"onChangeMotivoAccisa",value:function(i){this.confirmationService.confirm({message:O.a.accisaObbligatoria,accept:function(){},key:"conferma-accisa-dialog"})}},{key:"isAccisaObbligatoria",value:function(){return this.formatSrv.toNumber(this.consumiForm.get("accisaGasolioTotale").value)>0||this.formatSrv.toNumber(this.consumiForm.get("accisaBenzina").value)>0||this.formatSrv.toNumber(this.consumiForm.get("accisaGasolioSerre").value)>0}},{key:"cancellaAllegati",value:function(i){this.messageService.add({key:"checkCancella",sticky:!0,severity:"warn",summary:"Cancella dati",detail:"Attenzione! Si desidera procedere con la cancellazione degli allegati inseriti e delle relative informazioni? Verr\xe0 ripristinata la situazione iniziale",data:i})}},{key:"openDialogMotivazione",value:function(i){switch(i){case go.AMMISSIBILE_GASOLIO_TERZI:this.popupAllegatiMotivoConsumi.open(this.motivoRecuperoAmmissibile);break;case go.RECUPERO_GASOLIO_PROPRIO:this.popupAllegatiMotivoRecupero.open(i,this.motivoRecuperoGasolioContoProprio);break;case go.RECUPERO_GASOLIO_TERZI:this.popupAllegatiMotivoRecupero.open(i,this.motivoRecuperoGasolioContoTerzi);break;case go.RECUPERO_BENZINA:this.popupAllegatiMotivoRecupero.open(i,this.motivoRecuperoBenzina);break;case go.RECUPERO_GASOLIO_SERRE:this.popupAllegatiMotivoRecupero.open(i,this.motivoRecuperoGasolioSerre)}}},{key:"closeDialogMotivazione",value:function(i){var e={motivazione:{}};switch(e.motivazione=i.motivazioneConsuntivoDto,e.tipo=i.tipo,i.tipo){case go.AMMISSIBILE_GASOLIO_TERZI:e.tipoConsuntivo=tn.AMMISSIBILE,e.value=this.consumiForm.get("ammissibileGasolioContoTerzi").value,e.tipoCarburante=on.GASOLIO_TERZI,this.motivoRecuperoAmmissibile=i.motivazioneConsuntivoDto;break;case go.RECUPERO_GASOLIO_PROPRIO:e.tipoConsuntivo=tn.RECUPERO,e.value=this.consumiForm.get("recuperoGasolioContoProprio").value,e.tipoCarburante=on.GASOLIO,this.motivoRecuperoGasolioContoProprio=e.motivazione;break;case go.RECUPERO_GASOLIO_TERZI:e.tipoConsuntivo=tn.RECUPERO,e.value=this.consumiForm.get("recuperoGasolioContoTerzi").value,e.tipoCarburante=on.GASOLIO_TERZI,this.motivoRecuperoGasolioContoTerzi=e.motivazione;break;case go.RECUPERO_BENZINA:e.tipoConsuntivo=tn.RECUPERO,e.value=this.consumiForm.get("recuperoBenzina").value,e.tipoCarburante=on.BENZINA,this.motivoRecuperoBenzina=e.motivazione;break;case go.RECUPERO_GASOLIO_SERRE:e.tipoConsuntivo=tn.RECUPERO,e.value=this.consumiForm.get("recuperoGasolioSerre").value,e.tipoCarburante=on.GASOLIO_SERRE,this.motivoRecuperoGasolioSerre=e.motivazione}this.saveConsuntivoWithAllegati(e)}},{key:"validaDichiarazione",value:function(){console.log("Salvataggio dichiarazione consumi: ",this.consumiForm.value),this.formService.validateForm(this.consumiForm);var i=this.formService.getInvalids(this.consumiForm);if(!this.consumiForm.valid)return this.openPanelsByField(i),this.messageService.add(m.a.getToast("tst",m.b.error,O.a.datiNonValidi)),!1;if(this.formatSrv.isLessThanZero(this.consumiForm.get("consumatoGasolioContoProprio").value)&&this.formatSrv.isLessThanZero(this.consumiForm.get("consumatoGasolioContoTerzi").value)&&this.formatSrv.isLessThanZero(this.consumiForm.get("consumatoBenzina").value)&&this.formatSrv.isLessThanZero(this.consumiForm.get("consumatoGasolioSerre").value))return this.messageService.add(m.a.getToast("tst",m.b.error,O.a.consumatoObbligatorio)),!1;if(this.isAccisaObbligatoria()){if(this.isAccisaObbligatoria()&&this.formatSrv.isEmptyString(this.consumiForm.get("accisaMotivo").value))return this.messageService.add(m.a.getToast("tst",m.b.warn,O.a.accisaObbligatoria)),!1}else this.consumiForm.get("accisaMotivo").reset();return!0}},{key:"validaDichiarazioneDaProtocollare",value:function(){var i=this;return!(!this.validaDichiarazione()||(this.consumiForm.get("accisaGasolioTotale").value>0||this.consumiForm.get("accisaBenzina").value>0||this.consumiForm.get("accisaGasolioSerre").value>0)&&(this.confirmationService.confirm({message:O.a.accisaValorizzataWarn,accept:function(){i.saveAndProtocollaDichiarazione()},key:"conferma-accisa-dialog"}),1))}},{key:"saveDichiarazione",value:function(){var i=this;this.dichiarazioneConsumiDto.motivazioneAccisa=this.consumiForm.get("accisaMotivo").value;var e=this.consumiBuilderService.buildConsuntiviDto(this.consumiForm.value).filter((function(i){return i.quantita>=0}));this.saveDichiarazioneSubscription=this.httpClientDichiarazioneConsumiUmaService.saveConsuntivi(this.dichiarazioneConsumiDto.id.toString(),e).pipe(Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){var t=new Date(i.consumiForm.get("dataConduzione").value),o=i.dateUtilService.toDateWithNoOffset(t).toISOString();return console.log("Update data: ",o),console.log("Update accisa: ",i.dichiarazioneConsumiDto.motivazioneAccisa),i.httpClientDichiarazioneConsumiUmaService.updateDichiarazioneConsumi(i.dichiarazioneConsumiDto.id.toString(),i.consumiBuilderService.buildDichiarazioneConsumiPatch(i.dichiarazioneConsumiDto.motivazioneAccisa,o))}))).subscribe((function(e){i.messageService.add(m.a.getToast("tst",m.b.success,O.a.salvataggioConsuntiviOk))}),(function(e){return i.errorService.showError(e)}))}},{key:"saveAndProtocollaDichiarazione",value:function(){var i=this;this.dichiarazioneConsumiDto.motivazioneAccisa=this.consumiForm.get("accisaMotivo").value;var e=this.consumiBuilderService.buildConsuntiviDto(this.consumiForm.value).filter((function(i){return i.quantita>=0}));this.protocollaSubscription=this.httpClientDichiarazioneConsumiUmaService.saveConsuntivi(this.dichiarazioneConsumiDto.id.toString(),e).pipe(Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){var t=new Date(i.consumiForm.get("dataConduzione").value),o=i.dateUtilService.toDateWithNoOffset(t).toISOString();return console.log("Update data: ",o),console.log("Update accisa: ",i.dichiarazioneConsumiDto.motivazioneAccisa),i.httpClientDichiarazioneConsumiUmaService.updateDichiarazioneConsumi(i.dichiarazioneConsumiDto.id.toString(),i.consumiBuilderService.buildDichiarazioneConsumiPatch(i.dichiarazioneConsumiDto.motivazioneAccisa,o))})),Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){return i.httpClientDichiarazioneConsumiUmaService.valida(i.dichiarazioneConsumiDto.id.toString())}))).subscribe((function(e){i.popupProtocollaVisibile=!0}),(function(e){console.log("ERROR: ",e),e&&e.error&&e.error.message&&e.error.message.includes("[ERR-1]")?i.erroreEliminazioneDichiarazioneORettifica(e):e&&e.error&&e.error.message&&e.error.message.includes("[ERR-2]")?i.errorRichiestaObsoleta(e):i.errorService.showError(e)}))}},{key:"saveConsuntivoWithAllegati",value:function(i){var e=this;this.dichiarazioneConsumiDto.motivazioneAccisa=this.consumiForm.get("accisaMotivo").value;var t=this.consumiBuilderService.buildConsuntiviDto(this.consumiForm.value).filter((function(i){return i.quantita>=0}));this.saveConsuntivoWithAllegatiSub=this.httpClientDichiarazioneConsumiUmaService.saveConsuntivi(this.dichiarazioneConsumiDto.id.toString(),t).pipe(Object(h.a)((function(i){return e.errorService.showError(i),u.a})),Object(b.a)((function(t){return e.saveConsuntivo(i.tipoConsuntivo,i.tipo,i.value,i.tipoCarburante,i.motivazione)}))).subscribe((function(t){e.updateAndValidateMotivo(i.tipo,t),i.tipo===go.AMMISSIBILE_GASOLIO_TERZI&&e.consumiForm.get("ammissibileGasolioContoTerzi").updateValueAndValidity(),e.messageService.add(m.a.getToast("tst",m.b.success,O.a.salvataggioAllegatiConsumiOk))}),(function(i){e.errorService.showError(i),e.location.back()}))}},{key:"closeDialogCambioData",value:function(i){}},{key:"confermaCancellazioneConsuntivo",value:function(i){var e=this,t=this.recuperaIDConsuntivo(i.messages[0].data);null!=t?this.deleteConsuntivoSubscription=this.httpClientDichiarazioneConsumiUmaService.deleteConsuntivo(this.dichiarazioneConsumiDto.id.toString(),t).subscribe((function(){e.svuotaAllegati(i.messages[0].data),i.messages[0].data===go.AMMISSIBILE_GASOLIO_TERZI&&e.setAmmissibileContoTerzi(),e.messageService.clear("checkCancella"),e.messageService.add(m.a.getToast("tst",m.b.success,O.a.deleteConsuntivoOk))}),(function(i){return e.errorService.showError(i)})):this.messageService.add(m.a.getToast("tst",m.b.error,O.a.deleteConsuntivoKO))}},{key:"rifiutaCancellazioneConsuntivo",value:function(i){this.messageService.clear("checkCancella")}},{key:"isDataDefault",value:function(){if(!this.dichiarazioneConsumiDto||!this.dichiarazioneConsumiDto.dataConduzione)return!1;var i=new Date(this.dichiarazioneConsumiDto.dataConduzione),e=new Date(this.dataConduzioneDefault);return this.dateUtilService.isSameDates(i,e)}},{key:"salvaDataConduzione",value:function(i){var e=this,t=this.dateUtilService.toDate(this.dataConduzioneRef.inputFieldValue);this.confirmationService.confirm({message:O.a.cambioDataConduzione,accept:function(){e.confermaCambioData(i)},reject:function(){e.consumiForm.get("dataConduzione").setValue(t)},key:"conferma-cambio-data"})}},{key:"ripristinaDataConduzione",value:function(){var i=this;this.confirmationService.confirm({message:O.a.cambioDataConduzione,accept:function(){i.dichiarazioneConsumiDto.dataConduzione=i.dataConduzioneDefault,i.consumiForm.get("dataConduzione").setValue(i.dataConduzioneDefault),i.confermaCambioData(i.dataConduzioneDefault)},reject:function(){},key:"conferma-cambio-data"})}},{key:"onCloseToastCancellazione",value:function(){this.navigatorService.goToPresentazioneIstanze(this.idFascicolo)}},{key:"closeProtocollazioneDialog",value:function(){this.popupProtocollaVisibile=!1}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.deleteConsuntivoSubscription&&this.deleteConsuntivoSubscription.unsubscribe(),this.consumatoGasolioContoProprioSub&&this.consumatoGasolioContoProprioSub.unsubscribe(),this.consumatoGasolioContoTerziSub&&this.consumatoGasolioContoTerziSub.unsubscribe(),this.rimanenzaGasolioContoProprioSub&&this.rimanenzaGasolioContoProprioSub.unsubscribe(),this.rimanenzaGasolioContoTerziSub&&this.rimanenzaGasolioContoTerziSub.unsubscribe(),this.recuperoGasolioContoProprioSub&&this.recuperoGasolioContoProprioSub.unsubscribe(),this.recuperoGasolioContoTerziSub&&this.recuperoGasolioContoTerziSub.unsubscribe(),this.ammissibileGasolioContoTerziSub&&this.ammissibileGasolioContoTerziSub.unsubscribe(),this.saveConsuntivoSubscription&&this.saveConsuntivoSubscription.unsubscribe(),this.saveDichiarazioneSubscription&&this.saveDichiarazioneSubscription.unsubscribe(),this.utenteSubscription&&this.utenteSubscription.unsubscribe(),this.navigationEndSubscription&&this.navigationEndSubscription.unsubscribe(),this.updateDataConduzioneSubscription&&this.updateDataConduzioneSubscription.unsubscribe(),this.consumatoGasolioTotaleSub&&this.consumatoGasolioTotaleSub.unsubscribe(),this.ammissibileGasolioTotaleSub&&this.ammissibileGasolioTotaleSub.unsubscribe(),this.consumatoGasolioSerreSub&&this.consumatoGasolioSerreSub.unsubscribe(),this.ammissibileBenzinaSub&&this.ammissibileBenzinaSub.unsubscribe(),this.ammissibileGasolioSerreSub&&this.ammissibileGasolioSerreSub.unsubscribe(),this.consumatoBenzinaSub&&this.consumatoBenzinaSub.unsubscribe(),this.rimanenzaDicembreGasolioTotaleSub&&this.rimanenzaDicembreGasolioTotaleSub.unsubscribe(),this.rimanenzaDicembreBenzinaSub&&this.rimanenzaDicembreBenzinaSub.unsubscribe(),this.rimanenzaDicembreGasolioSerreSub&&this.rimanenzaDicembreGasolioSerreSub.unsubscribe(),this.recuperoGasolioTotSub&&this.recuperoGasolioTotSub.unsubscribe(),this.recuperoBenzinaSub&&this.recuperoBenzinaSub.unsubscribe(),this.recuperoGasolioSerreSub&&this.recuperoGasolioSerreSub.unsubscribe(),this.protocollaSubscription&&this.protocollaSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe(),this.saveConsuntivoWithAllegatiSub&&this.saveConsuntivoWithAllegatiSub.unsubscribe(),this.getDomandeSubscription&&this.getDomandeSubscription.unsubscribe()}},{key:"initRoles",value:function(){this.authService.userSelectedRole!=A.a.roleIstruttoreUMA&&this.authService.userSelectedRole!=A.a.roleAppag||(this.isUtenteIstruttoreUma=!0)}},{key:"setMotivazioneAccisa",value:function(){this.dichiarazioneConsumiDto.motivazioneAccisa&&this.consumiForm.get("accisaMotivo").setValue(this.dichiarazioneConsumiDto.motivazioneAccisa)}},{key:"setConsuntivi",value:function(i){var e=this;i&&i.length&&i.forEach((function(i){switch(i.tipo){case tn.AMMISSIBILE:i.carburante==on.GASOLIO_TERZI&&(e.motivoRecuperoAmmissibile={idConsuntivo:i.id,allegati:e.consumiBuilderService.toAllegatoMotivazione(i,e.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione},e.consumiForm.get("ammissibileGasolioContoTerzi").setValue(i.quantita.toString()),setTimeout((function(){return e.consumiForm.get("ammissibileGasolioContoTerzi").updateValueAndValidity()})));break;case tn.CONSUMATO:if(i.carburante==on.GASOLIO){e.consumiForm.get("consumatoGasolioContoProprio").setValue(i.quantita.toString());break}if(i.carburante==on.GASOLIO_TERZI){e.consumiForm.get("consumatoGasolioContoTerzi").setValue(i.quantita.toString());break}if(i.carburante==on.BENZINA){e.consumiForm.get("consumatoBenzina").setValue(i.quantita.toString());break}if(i.carburante==on.GASOLIO_SERRE){e.consumiForm.get("consumatoGasolioSerre").setValue(i.quantita.toString());break}break;case tn.RIMANENZA:if(i.carburante==on.GASOLIO){e.consumiForm.get("rimanenzaDicembreGasolioContoProprio").setValue(i.quantita.toString());break}if(i.carburante==on.GASOLIO_TERZI){e.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").setValue(i.quantita.toString());break}if(i.carburante==on.BENZINA){e.consumiForm.get("rimanenzaDicembreBenzina").setValue(i.quantita.toString());break}if(i.carburante==on.GASOLIO_SERRE){e.consumiForm.get("rimanenzaDicembreGasolioSerre").setValue(i.quantita.toString());break}break;case tn.RECUPERO:if(i.carburante==on.GASOLIO){e.consumiForm.get("recuperoGasolioContoProprio").setValue(i.quantita.toString()),e.motivoRecuperoGasolioContoProprio={idConsuntivo:i.id,allegati:e.consumiBuilderService.toAllegatoMotivazione(i,e.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione};break}if(i.carburante==on.GASOLIO_TERZI){e.consumiForm.get("recuperoGasolioContoTerzi").setValue(i.quantita.toString()),e.motivoRecuperoGasolioContoTerzi={idConsuntivo:i.id,allegati:e.consumiBuilderService.toAllegatoMotivazione(i,e.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione};break}if(i.carburante==on.BENZINA){e.consumiForm.get("recuperoBenzina").setValue(i.quantita.toString()),e.motivoRecuperoBenzina={idConsuntivo:i.id,allegati:e.consumiBuilderService.toAllegatoMotivazione(i,e.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione};break}if(i.carburante==on.GASOLIO_SERRE){e.consumiForm.get("recuperoGasolioSerre").setValue(i.quantita.toString()),e.motivoRecuperoGasolioSerre={idConsuntivo:i.id,allegati:e.consumiBuilderService.toAllegatoMotivazione(i,e.dichiarazioneConsumiDto.id.toString()),motivazione:i.motivazione};break}}}))}},{key:"setFabbisognoDichiarato",value:function(i){if(i&&i.length){var e=this.modelBuilderService.fabbisognoDichiaratoBuilder(i);this.disableFieldsByCarburate(e)}}},{key:"setResiduoCampagnaPrecedente",value:function(i){i&&(this.consumiForm.get("residuoGasolioContoProprio").setValue(i.gasolio?i.gasolio:0),this.consumiForm.get("residuoGasolioContoTerzi").setValue(i.gasolioTerzi?i.gasolioTerzi:0),this.consumiForm.get("residuoGasolioTotale").setValue(i.gasolio+i.gasolioTerzi),this.consumiForm.get("residuoBenzina").setValue(i.benzina),this.consumiForm.get("residuoGasolioSerre").setValue(i.gasolioSerre))}},{key:"setRichiestoAssegnato",value:function(){if(this.richiestaCarburanteDto&&this.richiestaCarburanteDto.carburanteRichiesto){var i=this.richiestaCarburanteDto.carburanteRichiesto;this.consumiForm.get("richAssegnatoGasolioContoProprio").setValue(i.gasolio?i.gasolio:0),this.consumiForm.get("richAssegnatoGasolioContoTerzi").setValue(i.gasolioTerzi?i.gasolioTerzi:0),this.consumiForm.get("richAssegnatoGasolioTotale").setValue((i.gasolio?i.gasolio:0)+(i.gasolioTerzi?i.gasolioTerzi:0)),this.consumiForm.get("richAssegnatoBenzina").setValue(i.benzina?i.benzina:0),this.consumiForm.get("richAssegnatoGasolioSerre").setValue(i.gasolioSerre?i.gasolioSerre:0)}}},{key:"setAmmissibile",value:function(i){this.setAmmissibileContoTerzi(),i&&(this.consumiForm.get("ammissibileGasolioContoProprio").setValue(i.gasolio.toString()),this.consumiForm.get("ammissibileBenzina").setValue(i.benzina),this.consumiForm.get("ammissibileGasolioSerre").setValue(i.gasolioSerre))}},{key:"setAmmissibileContoTerzi",value:function(){if(null==this.consumiForm.get("ammissibileGasolioContoTerzi").value){var i=this.richiestaCarburanteDto&&this.richiestaCarburanteDto.carburanteRichiesto&&this.richiestaCarburanteDto.carburanteRichiesto.gasolioTerzi;this.consumiForm.get("ammissibileGasolioContoTerzi").setValue(i)}}},{key:"setAmmissibileGasolioTotale",value:function(){var i=this.formatSrv.toNumber(this.consumiForm.get("ammissibileGasolioContoProprio").value),e=this.formatSrv.toNumber(this.consumiForm.get("ammissibileGasolioContoTerzi").value);this.consumiForm.get("ammissibileGasolioTotale").setValue(i+e)}},{key:"setDisponibile",value:function(i){i&&(this.consumiForm.get("disponibileGasolioTotale").setValue(i.gasolio),this.consumiForm.get("disponibileBenzina").setValue(i.benzina),this.consumiForm.get("disponibileGasolioSerre").setValue(i.gasolioSerre),this.consumiForm.get("consumatoGasolioContoProprio").updateValueAndValidity())}},{key:"calcolaDisponibile",value:function(i,e,t,o){if(i||e||t||o){var n=new Te.a;return n.gasolio=(i?i.gasolio:0)+(i?i.gasolioTerzi:0)+(e?e.gasolio:0)+(t?t.gasolio:0)-(o?o.gasolio:0),n.benzina=(i?i.benzina:0)+(e?e.benzina:0)+(t?t.benzina:0)-(o?o.benzina:0),n.gasolioSerre=(i?i.gasolioSerre:0)+(e?e.gasolioSerre:0)+(t?t.gasolioSerre:0)-(o?o.gasolioSerre:0),n}}},{key:"calcolaAccisaByCarburante",value:function(i){var e=new Te.a;if("GASOLIO"===i){var t=this.formatSrv.toNumber(this.consumiForm.get("disponibileGasolioTotale").value),o=this.formatSrv.toNumber(this.consumiForm.get("ammissibileGasolioTotale").value),n=this.formatSrv.toNumber(this.consumiForm.get("rimanenzaDicembreGasolioTotale").value),a=this.formatSrv.toNumber(this.consumiForm.get("recuperoGasolioTotale").value),r=this.formatSrv.toNumber(this.consumiForm.get("consumatoGasolioTotale").value);return e.gasolio=r>o?t-o-n-a:t-r-n-a,e.gasolio}if("BENZINA"===i){var c=this.formatSrv.toNumber(this.consumiForm.get("disponibileBenzina").value),s=this.formatSrv.toNumber(this.consumiForm.get("rimanenzaDicembreBenzina").value),l=this.formatSrv.toNumber(this.consumiForm.get("recuperoBenzina").value),u=this.formatSrv.toNumber(this.consumiForm.get("ammissibileBenzina").value),b=this.formatSrv.toNumber(this.consumiForm.get("consumatoBenzina").value);return e.benzina=b>u?c-u-s-l:c-b-s-l,e.benzina}if("GASOLIO_SERRE"===i){var h=this.formatSrv.toNumber(this.consumiForm.get("disponibileGasolioSerre").value),m=this.formatSrv.toNumber(this.consumiForm.get("rimanenzaDicembreGasolioSerre").value),p=this.formatSrv.toNumber(this.consumiForm.get("recuperoGasolioSerre").value),d=this.formatSrv.toNumber(this.consumiForm.get("ammissibileGasolioSerre").value),g=this.formatSrv.toNumber(this.consumiForm.get("consumatoGasolioSerre").value);return e.gasolioSerre=g>d?h-d-m-p:h-g-m-p,e.gasolioSerre}return 0}},{key:"setAccisaByCarburante",value:function(i,e){var t=this;null!=e&&setTimeout((function(){"GASOLIO"===i?t.consumiForm.get("accisaGasolioTotale").setValue(e):"BENZINA"===i?t.consumiForm.get("accisaBenzina").setValue(e):t.consumiForm.get("accisaGasolioSerre").setValue(e),!t.isAccisaObbligatoria()||t.READONLY_MODE?t.consumiForm.get("accisaMotivo").disable():(t.consumiForm.get("accisaMotivo").enable(),t.consumiForm.get("accisaMotivo").setValidators([H.G.required]))}),0)}},{key:"setCarburanteRicevuto",value:function(i){i&&(this.consumiForm.get("ricevutoGasolioTotale").setValue(i.gasolio),this.consumiForm.get("ricevutoBenzina").setValue(i.benzina),this.consumiForm.get("ricevutoGasolioSerre").setValue(i.gasolioSerre))}},{key:"setCarburanteTrasferito",value:function(i){i&&(this.consumiForm.get("trasferitoGasolioTotale").setValue(i.gasolio),this.consumiForm.get("trasferitoBenzina").setValue(i.benzina),this.consumiForm.get("trasferitoGasolioSerre").setValue(i.gasolioSerre))}},{key:"setCarburantePrelevato",value:function(i){i&&(this.consumiForm.get("prelevatoGasolioTotale").setValue(i.gasolio),this.consumiForm.get("prelevatoBenzina").setValue(i.benzina),this.consumiForm.get("prelevatoGasolioSerre").setValue(i.gasolioSerre))}},{key:"sommaCarburante",value:function(i){var e={};return e.benzina=i.reduce((function(i,e){return i+e.benzina}),0),e.gasolio=i.reduce((function(i,e){return i+e.gasolio}),0),e.gasolioSerre=i.reduce((function(i,e){return i+e.gasolioSerre}),0),e}},{key:"initVariables",value:function(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.calendarService.configITA(),this.tipologicheService.setMotiviAccisa(),this.idFascicolo=this.indiceUmaService.idFascicolo||null,this.areCollapsed=[!0,!0,!0],this.loading=!0,this.maxLengthInput=7,this.motivoRecuperoAmmissibile={},this.motivoRecuperoGasolioContoProprio={},this.motivoRecuperoGasolioContoTerzi={},this.motivoRecuperoBenzina={},this.motivoRecuperoGasolioSerre={},this.motivoRecuperoAmmissibile.allegati=[],this.motivoRecuperoGasolioContoProprio.allegati=[],this.motivoRecuperoGasolioContoTerzi.allegati=[],this.motivoRecuperoBenzina.allegati=[],this.motivoRecuperoGasolioSerre.allegati=[],this.initForm()}},{key:"initForm",value:function(){this.consumiForm=new H.j({dataConduzione:new H.g({value:null,disabled:!1}),residuoGasolioContoProprio:new H.g({value:"0",disabled:!0}),residuoGasolioContoTerzi:new H.g({value:"0",disabled:!0}),residuoGasolioTotale:new H.g({value:"0",disabled:!0}),residuoBenzina:new H.g({value:"0",disabled:!0}),residuoGasolioSerre:new H.g({value:"0",disabled:!0}),ammissibileGasolioContoProprio:new H.g({value:"0",disabled:!0}),ammissibileGasolioContoTerzi:new H.g({value:null,disabled:this.READONLY_MODE}),ammissibileGasolioTotale:new H.g({value:"0",disabled:!0}),ammissibileBenzina:new H.g({value:"0",disabled:!0}),ammissibileGasolioSerre:new H.g({value:"0",disabled:!0}),richAssegnatoGasolioContoProprio:new H.g({value:"0",disabled:!0}),richAssegnatoGasolioContoTerzi:new H.g({value:"0",disabled:!0}),richAssegnatoGasolioTotale:new H.g({value:"0",disabled:!0}),richAssegnatoBenzina:new H.g({value:"0",disabled:!0}),richAssegnatoGasolioSerre:new H.g({value:"0",disabled:!0}),ricevutoGasolioTotale:new H.g({value:"0",disabled:!0}),ricevutoBenzina:new H.g({value:"0",disabled:!0}),ricevutoGasolioSerre:new H.g({value:"0",disabled:!0}),trasferitoGasolioTotale:new H.g({value:"0",disabled:!0}),trasferitoBenzina:new H.g({value:"0",disabled:!0}),trasferitoGasolioSerre:new H.g({value:"0",disabled:!0}),prelevatoGasolioTotale:new H.g({value:"0",disabled:!0}),prelevatoBenzina:new H.g({value:"0",disabled:!0}),prelevatoGasolioSerre:new H.g({value:"0",disabled:!0}),disponibileGasolioTotale:new H.g({value:"0",disabled:!0}),disponibileBenzina:new H.g({value:"0",disabled:!0}),disponibileGasolioSerre:new H.g({value:"0",disabled:!0}),accisaGasolioTotale:new H.g({value:"0",disabled:!0}),accisaBenzina:new H.g({value:"0",disabled:!0}),accisaGasolioSerre:new H.g({value:"0",disabled:!0}),accisaMotivo:new H.g({value:null,disabled:this.READONLY_MODE}),consumatoGasolioContoProprio:new H.g({value:null,disabled:this.READONLY_MODE}),consumatoGasolioContoTerzi:new H.g({value:null,disabled:this.READONLY_MODE}),consumatoGasolioTotale:new H.g({value:"0",disabled:!0}),consumatoBenzina:new H.g({value:null,disabled:this.READONLY_MODE}),consumatoGasolioSerre:new H.g({value:null,disabled:this.READONLY_MODE}),rimanenzaDicembreGasolioContoProprio:new H.g({value:null,disabled:this.READONLY_MODE}),rimanenzaDicembreGasolioContoTerzi:new H.g({value:null,disabled:this.READONLY_MODE}),rimanenzaDicembreGasolioTotale:new H.g({value:"0",disabled:!0}),rimanenzaDicembreBenzina:new H.g({value:null,disabled:this.READONLY_MODE}),rimanenzaDicembreGasolioSerre:new H.g({value:null,disabled:this.READONLY_MODE}),recuperoGasolioContoProprio:new H.g({value:null,disabled:this.READONLY_MODE}),recuperoGasolioContoTerzi:new H.g({value:null,disabled:this.READONLY_MODE}),recuperoGasolioTotale:new H.g({value:"0",disabled:!0}),recuperoBenzina:new H.g({value:null,disabled:this.READONLY_MODE}),recuperoGasolioSerre:new H.g({value:null,disabled:this.READONLY_MODE})})}},{key:"disableFieldsByCarburate",value:function(i){i&&(i.benzina||(this.consumiForm.get("consumatoBenzina").disable(),this.consumiForm.get("rimanenzaDicembreBenzina").disable(),this.consumiForm.get("recuperoBenzina").disable()),i.gasolio||(this.consumiForm.get("consumatoGasolioContoProprio").disable(),this.consumiForm.get("rimanenzaDicembreGasolioContoProprio").disable(),this.consumiForm.get("recuperoGasolioContoProprio").disable()))}},{key:"saveConsuntivo",value:function(i,e,t,o,n){return this.httpClientDichiarazioneConsumiUmaService.saveAllegatiConsuntivo(this.dichiarazioneConsumiDto.id.toString(),this.consumiBuilderService.buildConsuntivoDto(t,o,i,n),this.toFileByTipo(n.allegati,e))}},{key:"updateAndValidateMotivo",value:function(i,e){switch(i){case go.AMMISSIBILE_GASOLIO_TERZI:this.motivoRecuperoAmmissibile.idConsuntivo=e,this.consumiForm.get("ammissibileGasolioTotale").updateValueAndValidity();break;case go.RECUPERO_GASOLIO_PROPRIO:this.motivoRecuperoGasolioContoProprio.idConsuntivo=e,this.consumiForm.get("recuperoGasolioContoProprio").updateValueAndValidity();break;case go.RECUPERO_GASOLIO_TERZI:this.motivoRecuperoGasolioContoTerzi.idConsuntivo=e,this.consumiForm.get("recuperoGasolioContoTerzi").updateValueAndValidity();break;case go.RECUPERO_BENZINA:this.motivoRecuperoBenzina.idConsuntivo=e,this.consumiForm.get("recuperoBenzina").updateValueAndValidity();break;case go.RECUPERO_GASOLIO_SERRE:this.motivoRecuperoGasolioSerre.idConsuntivo=e,this.consumiForm.get("recuperoGasolioSerre").updateValueAndValidity()}}},{key:"toFileByTipo",value:function(i,e){return e===go.AMMISSIBILE_GASOLIO_TERZI?this.consumiBuilderService.toFileWithMetaDati(i,this.SEPARATOR):this.consumiBuilderService.toFile(i)}},{key:"recuperaIDConsuntivo",value:function(i){switch(i){case go.AMMISSIBILE_GASOLIO_TERZI:return this.motivoRecuperoAmmissibile.idConsuntivo;case go.RECUPERO_GASOLIO_PROPRIO:return this.motivoRecuperoGasolioContoProprio.idConsuntivo;case go.RECUPERO_GASOLIO_TERZI:return this.motivoRecuperoGasolioContoTerzi.idConsuntivo;case go.RECUPERO_BENZINA:return this.motivoRecuperoBenzina.idConsuntivo;case go.RECUPERO_GASOLIO_SERRE:return this.motivoRecuperoGasolioSerre.idConsuntivo;default:return null}}},{key:"svuotaAllegati",value:function(i){switch(i){case go.AMMISSIBILE_GASOLIO_TERZI:this.motivoRecuperoAmmissibile=null,this.popupAllegatiMotivoConsumi.reset(),this.consumiForm.get("ammissibileGasolioContoTerzi").setValue(null),this.consumiForm.get("ammissibileGasolioContoTerzi").updateValueAndValidity();break;case go.RECUPERO_GASOLIO_PROPRIO:this.motivoRecuperoGasolioContoProprio=null,this.consumiForm.get("recuperoGasolioContoProprio").setValue(null),this.consumiForm.get("recuperoGasolioContoProprio").updateValueAndValidity();break;case go.RECUPERO_GASOLIO_TERZI:this.motivoRecuperoGasolioContoTerzi=null,this.consumiForm.get("recuperoGasolioContoTerzi").setValue(null),this.consumiForm.get("recuperoGasolioContoTerzi").updateValueAndValidity();break;case go.RECUPERO_BENZINA:this.motivoRecuperoBenzina=null,this.consumiForm.get("recuperoBenzina").setValue(null),this.consumiForm.get("recuperoBenzina").updateValueAndValidity();break;case go.RECUPERO_GASOLIO_SERRE:this.motivoRecuperoGasolioSerre=null,this.consumiForm.get("recuperoGasolioSerre").setValue(null),this.consumiForm.get("recuperoGasolioSerre").updateValueAndValidity()}}},{key:"initDataConduzione",value:function(){this.dichiarazioneConsumiDto.dataConduzione?(this.dataConduzioneDefault=this.dataConduzioneDefault?this.dataConduzioneDefault:new Date(this.dichiarazioneConsumiDto.dataConduzione),this.minDate=this.setMinDate(),this.maxDate=this.setMaxDate(),this.consumiForm.get("dataConduzione").setValue(new Date(this.dichiarazioneConsumiDto.dataConduzione))):console.error("NON \xe8 stato possibile ricavare dal servizio backend la data di conduzione!")}},{key:"setMinDate",value:function(){return this.dichiarazioneConsumiDto&&new Date(this.dichiarazioneConsumiDto.dataConduzione).getFullYear()==this.dateUtilService.getCurrentYear()?this.dateUtilService.toDateFrom(1,1,new Date(this.dichiarazioneConsumiDto.dataConduzione).getFullYear()):this.dateUtilService.toDateFrom(1,1,this.dateUtilService.getCurrentYear())}},{key:"setMaxDate",value:function(){return this.dichiarazioneConsumiDto&&new Date(this.dichiarazioneConsumiDto.dataConduzione).getFullYear()==this.dateUtilService.getCurrentYear()?this.dateUtilService.getToday():this.dateUtilService.toDateFrom(31,12,new Date(this.dichiarazioneConsumiDto.dataConduzione).getFullYear())}},{key:"confermaCambioData",value:function(i){var e=this,t=new Date(this.consumiForm.get("dataConduzione").value),o=this.dateUtilService.toDateWithNoOffset(t).toISOString();this.updateDataConduzioneSubscription=this.httpClientDichiarazioneConsumiUmaService.updateDichiarazioneConsumi(this.dichiarazioneConsumiDto.id.toString(),this.consumiBuilderService.buildDichiarazioneConsumiPatch(null,o)).subscribe((function(i){e.dichiarazioneConsumiDto.dataConduzione=e.dateUtilService.toDateWithNoOffset(t),e.messageService.add(m.a.getToast("tst",m.b.success,O.a.salvataggioConsuntiviOk)),e.router.navigate([e.router.url])}),(function(i){e.errorService.showError(i),e.consumiForm.get("dataConduzione").setValue(e.dataConduzioneDefault)}))}},{key:"erroreEliminazioneDichiarazioneORettifica",value:function(i){var e=this;this.confirmationService.confirm({message:O.a.rettificaIncompilazione,accept:function(){var i=new rn.a;i.cuaa=e.dichiarazioneConsumiDto.cuaa,i.campagna=[e.dichiarazioneConsumiDto.campagnaRichiesta.toString()],i.stati=[z.a.IN_COMPILAZIONE],i.numeroElementiPagina=1,e.getDomandeSubscription=e.httpClientDomandUmaService.getDomande(i).pipe(Object(h.a)((function(i){return e.errorService.showError(i),u.a})),Object(b.a)((function(i){return console.log("richieste:",i),e.httpClientDomandUmaService.deleteDomandaById(i[0].id.toString())}))).subscribe((function(i){e.popupProtocollaVisibile=!0}),(function(i){return e.errorService.showError(i)}))},reject:function(){e.confermaEliminaDichiarazione()},key:"rettifica-error-dialog"})}},{key:"errorRichiestaObsoleta",value:function(i){var e=this;this.confirmationService.confirm({message:O.a.richiestaObsoleta,accept:function(){e.confermaEliminaDichiarazione()},reject:function(){},key:"rettifica-error-dialog"})}},{key:"confermaEliminaDichiarazione",value:function(){var i=this;this.deleteSubscription=this.httpClientDichiarazioneConsumiUmaService.deleteDichiarazioneConsumi(this.dichiarazioneConsumiDto.id.toString()).subscribe((function(){i.messageService.add(m.a.getToast("tst-delete",m.b.success,O.a.cancellazioneDichiarazioneConsumiOK))}),(function(e){return i.errorService.showError(e)}))}}]),i}()).\u0275fac=function(i){return new(i||Pa)(S.Nb(wo.a),S.Nb(an.a),S.Nb(T),S.Nb(D.a),S.Nb(Oe.a),S.Nb(ko.a),S.Nb(C),S.Nb(g.a),S.Nb(P),S.Nb(A.a),S.Nb(s.n),S.Nb(y.a),S.Nb(M.d),S.Nb(Ce.a),S.Nb(M.a),S.Nb(nn),S.Nb(ki.a),S.Nb(d.a),S.Nb(D.e),S.Nb(g.a),S.Nb(ve.a))},Pa.\u0275cmp=S.Hb({type:Pa,selectors:[["app-consumi"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(fn,!0),S.Jc(vn,!0),S.Uc(Sn,!0),S.Uc(Cn,!0)),2&i&&(S.Ac(t=S.cc())&&(e.popupAllegatiMotivoConsumi=t.first),S.Ac(t=S.cc())&&(e.popupAllegatiMotivoRecupero=t.first),S.Ac(t=S.cc())&&(e.dataConduzioneRef=t.first),S.Ac(t=S.cc())&&(e.dialog=t.first))},decls:279,vars:150,consts:[[3,"chiudiPopup"],["popupAllegatiMotivoConsumi",""],["popupAllegatiMotivoRecupero",""],[3,"cfRichiedente","idFascicolo","idDichiarazione","popupVisibile","cuaa","chiudiPopup",4,"ngIf"],["header","Attenzione","icon","pi pi-exclamation-triangle","key","conferma-accisa-dialog",1,"ui-dialog-visible"],["cd",""],["type","button","pButton","","label","OK",1,"w-10m",3,"click"],["header","Attenzione","icon","pi pi-exclamation-triangle","key","conferma-cambio-data","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["cambioData",""],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","rettifica-error-dialog","acceptLabel","OK","rejectLabel","Annulla","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible",3,"closable"],["key","tst"],["position","top-center","key","tst-delete",3,"modal","baseZIndex","onClose"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"p-col"],["position","center","key","checkCancella",3,"modal","baseZIndex"],["deleteToast",""],["pTemplate","message"],["novalidate","",1,"p-grid","p-align-center",3,"formGroup"],[1,"p-col-3","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-altre_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed w-10m px-1 py-1",4,"ngIf"],["class","p-col-fixed w-13m px-1 py-1",4,"ngIf"],[1,"boxgrey"],["class","p-grid p-align-center",4,"ngIf"],[1,"p-grid"],[3,"toggleable","collapsed","collapsedChange"],[1,"p-grid","text-center"],[1,"p-col","p-col-align-center","font-15"],[1,"p-col","p-col-align-center"],["type","text","pInputText","","formControlName","residuoGasolioContoProprio",1,"text-right"],["type","text","pInputText","","formControlName","residuoGasolioContoTerzi",1,"text-right"],["type","text","pInputText","","formControlName","residuoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","residuoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","residuoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","ammissibileGasolioContoProprio",1,"text-right"],[1,"ui-inputgroup"],["pButton","","type","button","class","icon-button-square","title","Allega un documento","icon","pi pi-attachment",3,"click",4,"ngIf"],["pButton","","type","button","class","icon-button-square border-left-0","title","Elimina allegati","icon","pi pi-times",3,"click",4,"ngIf"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","ammissibileGasolioContoTerzi",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","maxlength","blur"],["inputAmmissibileGasolioContoTerzi",""],["class","font-12","severity","error","text","Formato non valido",4,"ngIf"],["class","font-12","severity","error","text","Per procedere \xe8 necessario aggiungere gli allegati",4,"ngIf"],["class","font-12","severity","error","text","Per procedere \xe8 necessario eliminare gli allegati",4,"ngIf"],["type","text","pInputText","","formControlName","ammissibileGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","ammissibileBenzina",1,"text-right"],["type","text","pInputText","","formControlName","ammissibileGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","richAssegnatoGasolioContoProprio",1,"text-right"],["type","text","pInputText","","formControlName","richAssegnatoGasolioContoTerzi",1,"text-right"],["inputRichiestoAssegnatoGasolioTerzi",""],["type","text","pInputText","","formControlName","richAssegnatoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","richAssegnatoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","richAssegnatoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","ricevutoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","ricevutoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","ricevutoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","trasferitoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","trasferitoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","trasferitoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","prelevatoGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","prelevatoBenzina",1,"text-right"],["type","text","pInputText","","formControlName","prelevatoGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","disponibileGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","disponibileBenzina",1,"text-right"],["type","text","pInputText","","formControlName","disponibileGasolioSerre",1,"text-right"],["type","text","pInputText","","formControlName","accisaGasolioTotale",1,"text-right"],["type","text","pInputText","","formControlName","accisaBenzina",1,"text-right"],["type","text","pInputText","","formControlName","accisaGasolioSerre",1,"text-right"],[1,"p-col-2","p-col-align-center"],[1,"p-col-4"],[1,"p-col-6"],["formControlName","accisaMotivo",3,"options","onChange"],[4,"ngIf"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","consumatoGasolioContoProprio",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputConsumatoGasolioContoProprio",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","consumatoGasolioContoTerzi",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputConsumatoGasolioContoTerzi",""],["type","text","pInputText","","formControlName","consumatoGasolioTotale",1,"text-right",3,"maxlength"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","consumatoBenzina",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputConsumatoBenzina",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","consumatoGasolioSerre",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputConsumatoGasolioSerre",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","rimanenzaDicembreGasolioContoProprio",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputRimanenzaDicembreGasolioContoProprio",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","rimanenzaDicembreGasolioContoTerzi",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputRimanenzaDicembreGasolioContoTerzi",""],["type","text","pInputText","","formControlName","rimanenzaDicembreGasolioTotale",1,"text-right",3,"maxlength"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","rimanenzaDicembreBenzina",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputRimanenzaDicembreBenzina",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","rimanenzaDicembreGasolioSerre",1,"text-right",3,"a4gLimitSumArray","maxlength"],["inputRimanenzaDicembreGasolioSerre",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","recuperoGasolioContoProprio",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","a4gLimitSumArray","maxlength","blur"],["inputRecuperoGasolioContoProprio",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","recuperoGasolioContoTerzi",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","a4gLimitSumArray","maxlength","blur"],["inputRecuperoGasolioContoTerzi",""],["type","text","pInputText","","formControlName","recuperoGasolioTotale",1,"text-right"],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","recuperoBenzina",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","a4gLimitSumArray","maxlength","blur"],["inputRecuperoBenzina",""],["type","text","pInputText","","pattern","^([0-9])+$","formControlName","recuperoGasolioSerre",1,"text-right",3,"a4gNotEmptyList","a4gNotZero","a4gLimitSumArray","maxlength","blur"],["inputRecuperoGasolioSerre",""],[3,"cfRichiedente","idFascicolo","idDichiarazione","popupVisibile","cuaa","chiudiPopup"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"],[1,"p-col-fixed","w-10m","px-1","py-1"],["pButton","","class","ui-button-secondary ui-button-text button-accent-alt","type","submit","label","SALVA","icon","pi pi-save","iconPos","right",3,"click",4,"loading"],["pButton","","type","submit","label","SALVA","icon","pi pi-save","iconPos","right",1,"ui-button-secondary","ui-button-text","button-accent-alt",3,"click"],[1,"p-col-fixed","w-13m","px-1","py-1"],["pButton","","type","button","label","SALVA E PROTOCOLLA...",3,"click",4,"loading"],["pButton","","type","button","label","SALVA E PROTOCOLLA...",3,"click"],[1,"p-grid","p-align-center"],[1,"p-col-2"],["formControlName","dataConduzione","dateFormat","dd MM yy",3,"locale","showIcon","minDate","maxDate","readonlyInput","onSelect"],["dataConduzioneRef",""],["class","p-col-2",3,"click",4,"ngIf"],[1,"p-col-2",3,"click"],[1,"text-primary","cursor-pointer"],["pButton","","type","button","title","Allega un documento","icon","pi pi-attachment",1,"icon-button-square",3,"click"],["pButton","","type","button","title","Elimina allegati","icon","pi pi-times",1,"icon-button-square","border-left-0",3,"click"],["severity","error","text","Formato non valido",1,"font-12"],["severity","error","text","Per procedere \xe8 necessario aggiungere gli allegati",1,"font-12"],["severity","error","text","Per procedere \xe8 necessario eliminare gli allegati",1,"font-12"],["class","font-12","severity","error","text","E' obbligatorio inserire una motivazione",4,"ngIf"],["severity","error","text","E' obbligatorio inserire una motivazione",1,"font-12"],["class","font-12","severity","error",3,"text",4,"ngIf"],["severity","error",1,"font-12",3,"text"]],template:function(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-popup-allegati-motivo-consumi",0,1),S.bc("chiudiPopup",(function(i){return e.closeDialogMotivazione(i)})),S.Sb(),S.Tb(2,"app-popup-motivo-recupero",0,2),S.bc("chiudiPopup",(function(i){return e.closeDialogMotivazione(i)})),S.Sb(),S.Mc(4,On,1,5,"app-popup-protocollazione-dichiarazione",3),S.Tb(5,"p-confirmDialog",4,5),S.Tb(7,"p-footer"),S.Tb(8,"button",6),S.bc("click",(function(){return S.Ec(t),S.Bc(6).accept()})),S.Sb(),S.Sb(),S.Sb(),S.Ob(9,"p-confirmDialog",7,8),S.Ob(11,"p-confirmDialog",9),S.Ob(12,"p-toast",10),S.Tb(13,"p-toast",11),S.bc("onClose",(function(){return e.onCloseToastCancellazione()})),S.Sb(),S.Tb(14,"div",12),S.Tb(15,"div",13),S.Tb(16,"div",14),S.Tb(17,"p-toast",15,16),S.Mc(19,Tn,11,2,"ng-template",17),S.Sb(),S.Tb(20,"form",18),S.Tb(21,"div",19),S.Tb(22,"a",20),S.bc("click",(function(){return e.goBack()})),S.Ob(23,"i",21),S.Ob(24,"img",22),S.Tb(25,"span",23),S.Tb(26,"strong",24),S.Oc(27),S.gc(28,"uppercase"),S.gc(29,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Ob(30,"div",14),S.Mc(31,zn,2,1,"div",25),S.Mc(32,En,2,1,"div",26),S.Tb(33,"div",27),S.Mc(34,yn,6,4,"div",28),S.Mc(35,Dn,8,6,"div",28),S.Tb(36,"div",29),S.Tb(37,"div",14),S.Tb(38,"p-panel",30),S.bc("collapsedChange",(function(i){return e.areCollapsed[0]=i})),S.Tb(39,"p-header"),S.Oc(40,"Riepilogo anno precedente"),S.Sb(),S.Tb(41,"div",31),S.Ob(42,"div",14),S.Tb(43,"div",32),S.Oc(44,"Gasolio conto proprio"),S.Sb(),S.Tb(45,"div",32),S.Oc(46,"Gasolio conto terzi e svincolate"),S.Sb(),S.Tb(47,"div",32),S.Oc(48,"Gasolio totale"),S.Sb(),S.Tb(49,"div",32),S.Oc(50,"Benzina"),S.Sb(),S.Tb(51,"div",32),S.Oc(52,"Gasolio serre"),S.Sb(),S.Sb(),S.Tb(53,"div",29),S.Tb(54,"div",33),S.Tb(55,"small"),S.Oc(56,"Residuo campagna precedente (lt)"),S.Sb(),S.Sb(),S.Tb(57,"div",14),S.Ob(58,"input",34),S.Sb(),S.Tb(59,"div",14),S.Ob(60,"input",35),S.Sb(),S.Tb(61,"div",14),S.Ob(62,"input",36),S.Sb(),S.Tb(63,"div",14),S.Ob(64,"input",37),S.Sb(),S.Tb(65,"div",14),S.Ob(66,"input",38),S.Sb(),S.Sb(),S.Tb(67,"div",29),S.Tb(68,"div",33),S.Tb(69,"small"),S.Oc(70,"Ammissibile (lt)"),S.Sb(),S.Sb(),S.Tb(71,"div",14),S.Ob(72,"input",39),S.Sb(),S.Tb(73,"div",14),S.Tb(74,"div",40),S.Mc(75,Mn,1,0,"button",41),S.Mc(76,Nn,1,0,"button",42),S.Tb(77,"input",43,44),S.bc("blur",(function(){S.Ec(t);var i=S.Bc(78),o=S.Bc(97);return i.value>0&&!(null!=e.motivoRecuperoAmmissibile&&null!=e.motivoRecuperoAmmissibile.allegati&&e.motivoRecuperoAmmissibile.allegati.length)&&i.value!=o.value&&e.openDialogMotivazione("AMMISSIBILE_GASOLIO_TERZI")})),S.Sb(),S.Sb(),S.Tb(79,"div"),S.Mc(80,_n,1,0,"p-message",45),S.Mc(81,Bn,1,0,"p-message",46),S.Mc(82,kn,1,0,"p-message",47),S.Sb(),S.Sb(),S.Tb(83,"div",14),S.Ob(84,"input",48),S.Sb(),S.Tb(85,"div",14),S.Ob(86,"input",49),S.Sb(),S.Tb(87,"div",14),S.Ob(88,"input",50),S.Sb(),S.Sb(),S.Tb(89,"div",29),S.Tb(90,"div",33),S.Tb(91,"small"),S.Oc(92,"Richiesto/Assegnato (lt)"),S.Sb(),S.Sb(),S.Tb(93,"div",14),S.Ob(94,"input",51),S.Sb(),S.Tb(95,"div",14),S.Ob(96,"input",52,53),S.Sb(),S.Tb(98,"div",14),S.Ob(99,"input",54),S.Sb(),S.Tb(100,"div",14),S.Ob(101,"input",55),S.Sb(),S.Tb(102,"div",14),S.Ob(103,"input",56),S.Sb(),S.Sb(),S.Sb(),S.Tb(104,"p-panel",30),S.bc("collapsedChange",(function(i){return e.areCollapsed[1]=i})),S.Tb(105,"p-header"),S.Oc(106,"Operazioni carburante"),S.Sb(),S.Tb(107,"div",31),S.Ob(108,"div",14),S.Ob(109,"div",32),S.Ob(110,"div",32),S.Tb(111,"div",32),S.Oc(112,"Gasolio totale"),S.Sb(),S.Tb(113,"div",32),S.Oc(114,"Benzina"),S.Sb(),S.Tb(115,"div",32),S.Oc(116,"Gasolio serre"),S.Sb(),S.Sb(),S.Tb(117,"div",29),S.Tb(118,"div",33),S.Tb(119,"small"),S.Oc(120,"Ricevuto (lt)"),S.Sb(),S.Sb(),S.Ob(121,"div",14),S.Ob(122,"div",14),S.Tb(123,"div",14),S.Ob(124,"input",57),S.Sb(),S.Tb(125,"div",14),S.Ob(126,"input",58),S.Sb(),S.Tb(127,"div",14),S.Ob(128,"input",59),S.Sb(),S.Sb(),S.Tb(129,"div",29),S.Tb(130,"div",33),S.Tb(131,"small"),S.Oc(132,"Trasferito (lt)"),S.Sb(),S.Sb(),S.Ob(133,"div",14),S.Ob(134,"div",14),S.Tb(135,"div",14),S.Ob(136,"input",60),S.Sb(),S.Tb(137,"div",14),S.Ob(138,"input",61),S.Sb(),S.Tb(139,"div",14),S.Ob(140,"input",62),S.Sb(),S.Sb(),S.Tb(141,"div",29),S.Tb(142,"div",33),S.Tb(143,"small"),S.Oc(144,"Prelevato (lt)"),S.Sb(),S.Sb(),S.Ob(145,"div",14),S.Ob(146,"div",14),S.Tb(147,"div",14),S.Ob(148,"input",63),S.Sb(),S.Tb(149,"div",14),S.Ob(150,"input",64),S.Sb(),S.Tb(151,"div",14),S.Ob(152,"input",65),S.Sb(),S.Sb(),S.Tb(153,"div",29),S.Tb(154,"div",33),S.Tb(155,"small"),S.Oc(156,"Disponibile (lt)"),S.Sb(),S.Sb(),S.Ob(157,"div",14),S.Ob(158,"div",14),S.Tb(159,"div",14),S.Ob(160,"input",66),S.Sb(),S.Tb(161,"div",14),S.Ob(162,"input",67),S.Sb(),S.Tb(163,"div",14),S.Ob(164,"input",68),S.Sb(),S.Sb(),S.Tb(165,"div",29),S.Tb(166,"div",33),S.Tb(167,"small"),S.Oc(168,"Accisa (lt)"),S.Sb(),S.Sb(),S.Ob(169,"div",14),S.Ob(170,"div",14),S.Tb(171,"div",14),S.Ob(172,"input",69),S.Sb(),S.Tb(173,"div",14),S.Ob(174,"input",70),S.Sb(),S.Tb(175,"div",14),S.Ob(176,"input",71),S.Sb(),S.Sb(),S.Tb(177,"div",29),S.Tb(178,"div",72),S.Tb(179,"small"),S.Oc(180,"Motivo accisa"),S.Sb(),S.Sb(),S.Ob(181,"div",73),S.Tb(182,"div",74),S.Tb(183,"p-dropdown",75),S.bc("onChange",(function(i){return e.onChangeMotivoAccisa(i)})),S.Sb(),S.Mc(184,Pn,2,1,"div",76),S.Sb(),S.Sb(),S.Mc(185,wn,3,0,"p-footer",76),S.Sb(),S.Tb(186,"p-panel",30),S.bc("collapsedChange",(function(i){return e.areCollapsed[2]=i})),S.Tb(187,"p-header"),S.Oc(188,"Dichiarazione consumi"),S.Sb(),S.Tb(189,"div",31),S.Ob(190,"div",14),S.Tb(191,"div",32),S.Oc(192,"Gasolio conto proprio"),S.Sb(),S.Tb(193,"div",32),S.Oc(194,"Gasolio conto terzi e svincolate"),S.Sb(),S.Tb(195,"div",32),S.Oc(196,"Gasolio totale"),S.Sb(),S.Tb(197,"div",32),S.Oc(198,"Benzina"),S.Sb(),S.Tb(199,"div",32),S.Oc(200,"Gasolio serre"),S.Sb(),S.Sb(),S.Tb(201,"div",29),S.Tb(202,"div",33),S.Tb(203,"small"),S.Oc(204,"Consumato (lt)"),S.Sb(),S.Sb(),S.Tb(205,"div",14),S.Ob(206,"input",77,78),S.Mc(208,Gn,3,2,"div",76),S.Sb(),S.Tb(209,"div",14),S.Ob(210,"input",79,80),S.Mc(212,Hn,3,2,"div",76),S.Sb(),S.Tb(213,"div",14),S.Ob(214,"input",81),S.Sb(),S.Tb(215,"div",14),S.Ob(216,"input",82,83),S.Mc(218,Yn,3,2,"div",76),S.Sb(),S.Tb(219,"div",14),S.Ob(220,"input",84,85),S.Mc(222,Kn,3,2,"div",76),S.Sb(),S.Sb(),S.Tb(223,"div",29),S.Tb(224,"div",33),S.Tb(225,"small"),S.Oc(226,"Rimanenza al 31 dicembre (lt)"),S.Sb(),S.Sb(),S.Tb(227,"div",14),S.Ob(228,"input",86,87),S.Mc(230,Jn,3,2,"div",76),S.Sb(),S.Tb(231,"div",14),S.Ob(232,"input",88,89),S.Mc(234,ea,3,2,"div",76),S.Sb(),S.Tb(235,"div",14),S.Ob(236,"input",90),S.Sb(),S.Tb(237,"div",14),S.Ob(238,"input",91,92),S.Mc(240,na,3,2,"div",76),S.Sb(),S.Tb(241,"div",14),S.Ob(242,"input",93,94),S.Mc(244,ca,3,2,"div",76),S.Sb(),S.Sb(),S.Tb(245,"div",29),S.Tb(246,"div",33),S.Tb(247,"small"),S.Oc(248,"Recupero (lt)"),S.Sb(),S.Sb(),S.Tb(249,"div",14),S.Tb(250,"div",40),S.Mc(251,sa,1,0,"button",41),S.Mc(252,la,1,0,"button",42),S.Tb(253,"input",95,96),S.bc("blur",(function(){return S.Ec(t),S.Bc(254).value>0&&!(null!=e.motivoRecuperoGasolioContoProprio&&null!=e.motivoRecuperoGasolioContoProprio.allegati&&e.motivoRecuperoGasolioContoProprio.allegati.length)&&e.openDialogMotivazione("RECUPERO_GASOLIO_PROPRIO")})),S.Sb(),S.Sb(),S.Mc(255,pa,5,4,"div",76),S.Sb(),S.Tb(256,"div",14),S.Tb(257,"div",40),S.Mc(258,da,1,0,"button",41),S.Mc(259,ga,1,0,"button",42),S.Tb(260,"input",97,98),S.bc("blur",(function(){return S.Ec(t),S.Bc(261).value>0&&!(null!=e.motivoRecuperoGasolioContoTerzi&&null!=e.motivoRecuperoGasolioContoTerzi.allegati&&e.motivoRecuperoGasolioContoTerzi.allegati.length)&&e.openDialogMotivazione("RECUPERO_GASOLIO_TERZI")})),S.Sb(),S.Sb(),S.Mc(262,Oa,5,4,"div",76),S.Sb(),S.Tb(263,"div",14),S.Ob(264,"input",99),S.Sb(),S.Tb(265,"div",14),S.Tb(266,"div",40),S.Mc(267,Ta,1,0,"button",41),S.Mc(268,Ia,1,0,"button",42),S.Tb(269,"input",100,101),S.bc("blur",(function(){return S.Ec(t),S.Bc(270).value>0&&!(null!=e.motivoRecuperoBenzina&&null!=e.motivoRecuperoBenzina.allegati&&e.motivoRecuperoBenzina.allegati.length)&&e.openDialogMotivazione("RECUPERO_BENZINA")})),S.Sb(),S.Sb(),S.Mc(271,Ra,5,4,"div",76),S.Sb(),S.Tb(272,"div",14),S.Tb(273,"div",40),S.Mc(274,Da,1,0,"button",41),S.Mc(275,Ma,1,0,"button",42),S.Tb(276,"input",102,103),S.bc("blur",(function(){return S.Ec(t),S.Bc(277).value>0&&!(null!=e.motivoRecuperoGasolioSerre&&null!=e.motivoRecuperoGasolioSerre.allegati&&e.motivoRecuperoGasolioSerre.allegati.length)&&e.openDialogMotivazione("RECUPERO_GASOLIO_SERRE")})),S.Sb(),S.Sb(),S.Mc(278,Fa,5,4,"div",76),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=S.Bc(78),n=S.Bc(97),a=S.Bc(254),r=S.Bc(261),c=S.Bc(270),s=S.Bc(277);S.Bb(4),S.mc("ngIf",e.dichiarazioneConsumiDto),S.Bb(7),S.mc("closable",!1),S.Bb(1),S.Kc(S.rc(89,Ga)),S.Bb(1),S.mc("modal",!0)("baseZIndex",5e4),S.Bb(4),S.mc("modal",!0)("baseZIndex",5e3),S.Bb(3),S.mc("formGroup",e.consumiForm),S.Bb(7),S.Pc(S.hc(28,85,S.hc(29,87,"UMA.DICHIARAZIONE_CONSUMI.DICHIARAZIONE_CONSUMI"))),S.Bb(4),S.mc("ngIf",!e.READONLY_MODE),S.Bb(1),S.mc("ngIf",!e.READONLY_MODE),S.Bb(2),S.mc("ngIf",!e.isUtenteIstruttoreUma||e.isUtenteIstruttoreUma&&(null==e.dichiarazioneConsumiDto?null:e.dichiarazioneConsumiDto.stato)==e.STATO_DICHIARAZIONE_CONSUMI.PROTOCOLLATA),S.Bb(1),S.mc("ngIf",e.isUtenteIstruttoreUma&&(null==e.dichiarazioneConsumiDto?null:e.dichiarazioneConsumiDto.stato)==e.STATO_DICHIARAZIONE_CONSUMI.IN_COMPILAZIONE),S.Bb(3),S.mc("toggleable",!e.loading)("collapsed",e.areCollapsed[0]),S.Bb(37),S.mc("ngIf",e.showAllegatiIconAmmissibile(o,n)),S.Bb(1),S.mc("ngIf",!o.disabled&&(null==e.motivoRecuperoAmmissibile||null==e.motivoRecuperoAmmissibile.allegati?null:e.motivoRecuperoAmmissibile.allegati.length)>0),S.Bb(1),S.mc("a4gNotEmptyList",S.tc(91,Va,null==e.motivoRecuperoAmmissibile?null:e.motivoRecuperoAmmissibile.allegati,S.rc(90,Ua)))("a4gNotZero",S.tc(95,Va,null==e.motivoRecuperoAmmissibile?null:e.motivoRecuperoAmmissibile.allegati,S.rc(94,Ua)))("maxlength",e.maxLengthInput),S.Bb(3),S.mc("ngIf",null==e.consumiForm.get("ammissibileGasolioContoTerzi").errors?null:e.consumiForm.get("ammissibileGasolioContoTerzi").errors.pattern),S.Bb(1),S.mc("ngIf",null==e.consumiForm.get("ammissibileGasolioContoTerzi").errors?null:e.consumiForm.get("ammissibileGasolioContoTerzi").errors.emptylist),S.Bb(1),S.mc("ngIf",null==e.consumiForm.get("ammissibileGasolioContoTerzi").errors?null:e.consumiForm.get("ammissibileGasolioContoTerzi").errors.notZero),S.Bb(22),S.mc("toggleable",!e.loading)("collapsed",e.areCollapsed[1]),S.Bb(79),S.mc("options",e.tipologicheService.motiviAccisa),S.Bb(1),S.mc("ngIf",e.consumiForm.get("accisaMotivo").invalid&&(e.consumiForm.get("accisaMotivo").dirty||e.consumiForm.get("accisaMotivo").touched)),S.Bb(1),S.mc("ngIf",e.isAccisaObbligatoria()&&!e.READONLY_MODE),S.Bb(1),S.mc("toggleable",!e.loading)("collapsed",e.areCollapsed[2]),S.Bb(20),S.mc("a4gLimitSumArray",S.sc(99,Za,S.rc(98,Ha)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("consumatoGasolioContoProprio").invalid&&(e.consumiForm.get("consumatoGasolioContoProprio").dirty||e.consumiForm.get("consumatoGasolioContoProprio").touched)),S.Bb(2),S.mc("a4gLimitSumArray",S.sc(102,Za,S.rc(101,ja)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("consumatoGasolioContoTerzi").invalid&&(e.consumiForm.get("consumatoGasolioContoTerzi").dirty||e.consumiForm.get("consumatoGasolioContoTerzi").touched)),S.Bb(2),S.mc("maxlength",e.maxLengthInput),S.Bb(2),S.mc("a4gLimitSumArray",S.sc(105,qa,S.rc(104,Ya)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("consumatoBenzina").invalid&&(e.consumiForm.get("consumatoBenzina").dirty||e.consumiForm.get("consumatoBenzina").touched)),S.Bb(2),S.mc("a4gLimitSumArray",S.sc(108,Ka,S.rc(107,Qa)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("consumatoGasolioSerre").invalid&&(e.consumiForm.get("consumatoGasolioSerre").dirty||e.consumiForm.get("consumatoGasolioSerre").touched)),S.Bb(6),S.mc("a4gLimitSumArray",S.sc(111,Za,S.rc(110,Wa)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("rimanenzaDicembreGasolioContoProprio").invalid&&(e.consumiForm.get("rimanenzaDicembreGasolioContoProprio").dirty||e.consumiForm.get("rimanenzaDicembreGasolioContoProprio").touched)),S.Bb(2),S.mc("a4gLimitSumArray",S.sc(114,Za,S.rc(113,$a)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").invalid&&(e.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").dirty||e.consumiForm.get("rimanenzaDicembreGasolioContoTerzi").touched)),S.Bb(2),S.mc("maxlength",e.maxLengthInput),S.Bb(2),S.mc("a4gLimitSumArray",S.sc(117,qa,S.rc(116,Ja)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("rimanenzaDicembreBenzina").invalid&&(e.consumiForm.get("rimanenzaDicembreBenzina").dirty||e.consumiForm.get("rimanenzaDicembreBenzina").touched)),S.Bb(2),S.mc("a4gLimitSumArray",S.sc(120,Ka,S.rc(119,Xa)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("rimanenzaDicembreGasolioSerre").invalid&&(e.consumiForm.get("rimanenzaDicembreGasolioSerre").dirty||e.consumiForm.get("rimanenzaDicembreGasolioSerre").touched)),S.Bb(7),S.mc("ngIf",e.consumiForm.get("recuperoGasolioContoProprio").value>0||(null==e.motivoRecuperoGasolioContoProprio||null==e.motivoRecuperoGasolioContoProprio.allegati?null:e.motivoRecuperoGasolioContoProprio.allegati.length)),S.Bb(1),S.mc("ngIf",!(null!=a&&a.disabled)&&(null==e.motivoRecuperoGasolioContoProprio||null==e.motivoRecuperoGasolioContoProprio.allegati?null:e.motivoRecuperoGasolioContoProprio.allegati.length)),S.Bb(1),S.mc("a4gNotEmptyList",S.sc(122,ir,null==e.motivoRecuperoGasolioContoProprio?null:e.motivoRecuperoGasolioContoProprio.allegati))("a4gNotZero",S.sc(124,ir,null==e.motivoRecuperoGasolioContoProprio?null:e.motivoRecuperoGasolioContoProprio.allegati))("a4gLimitSumArray",S.sc(127,Za,S.rc(126,er)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("recuperoGasolioContoProprio").invalid&&(e.consumiForm.get("recuperoGasolioContoProprio").dirty||e.consumiForm.get("recuperoGasolioContoProprio").touched)),S.Bb(3),S.mc("ngIf",r.value>0||(null==e.motivoRecuperoGasolioContoTerzi||null==e.motivoRecuperoGasolioContoTerzi.allegati?null:e.motivoRecuperoGasolioContoTerzi.allegati.length)),S.Bb(1),S.mc("ngIf",!r.disabled&&(null==e.motivoRecuperoGasolioContoTerzi||null==e.motivoRecuperoGasolioContoTerzi.allegati?null:e.motivoRecuperoGasolioContoTerzi.allegati.length)),S.Bb(1),S.mc("a4gNotEmptyList",S.sc(129,ir,null==e.motivoRecuperoGasolioContoTerzi?null:e.motivoRecuperoGasolioContoTerzi.allegati))("a4gNotZero",S.sc(131,ir,null==e.motivoRecuperoGasolioContoTerzi?null:e.motivoRecuperoGasolioContoTerzi.allegati))("a4gLimitSumArray",S.sc(134,Za,S.rc(133,tr)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("recuperoGasolioContoTerzi").invalid&&(e.consumiForm.get("recuperoGasolioContoTerzi").dirty||e.consumiForm.get("recuperoGasolioContoTerzi").touched)),S.Bb(5),S.mc("ngIf",c.value>0||(null==e.motivoRecuperoBenzina||null==e.motivoRecuperoBenzina.allegati?null:e.motivoRecuperoBenzina.allegati.length)),S.Bb(1),S.mc("ngIf",!c.disabled&&(null==e.motivoRecuperoBenzina||null==e.motivoRecuperoBenzina.allegati?null:e.motivoRecuperoBenzina.allegati.length)),S.Bb(1),S.mc("a4gNotEmptyList",S.sc(136,ir,null==e.motivoRecuperoBenzina?null:e.motivoRecuperoBenzina.allegati))("a4gNotZero",S.sc(138,ir,null==e.motivoRecuperoBenzina?null:e.motivoRecuperoBenzina.allegati))("a4gLimitSumArray",S.sc(141,qa,S.rc(140,or)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("recuperoBenzina").invalid&&(e.consumiForm.get("recuperoBenzina").dirty||e.consumiForm.get("recuperoBenzina").touched)),S.Bb(3),S.mc("ngIf",s.value>0||(null==e.motivoRecuperoGasolioSerre||null==e.motivoRecuperoGasolioSerre.allegati?null:e.motivoRecuperoGasolioSerre.allegati.length)),S.Bb(1),S.mc("ngIf",!s.disabled&&(null==e.motivoRecuperoGasolioSerre||null==e.motivoRecuperoGasolioSerre.allegati?null:e.motivoRecuperoGasolioSerre.allegati.length)),S.Bb(1),S.mc("a4gNotEmptyList",S.sc(143,ir,null==e.motivoRecuperoGasolioSerre?null:e.motivoRecuperoGasolioSerre.allegati))("a4gNotZero",S.sc(145,ir,null==e.motivoRecuperoGasolioSerre?null:e.motivoRecuperoGasolioSerre.allegati))("a4gLimitSumArray",S.sc(148,Ka,S.rc(147,nr)))("maxlength",e.maxLengthInput),S.Bb(2),S.mc("ngIf",e.consumiForm.get("recuperoGasolioSerre").invalid&&(e.consumiForm.get("recuperoGasolioSerre").dirty||e.consumiForm.get("recuperoGasolioSerre").touched))}},directives:[en,Bo,s.t,_.a,M.b,k.b,N.a,M.e,H.I,H.t,H.k,D.h,cn.a,M.c,H.c,ze.a,H.s,H.i,H.z,sn.a,ln.a,H.n,xo.a,un.a,pn,dn.a,gn.a,Ee.b],pipes:[s.G,mi.d,s.f],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-13m[_ngcontent-%COMP%]{width:13em}[_nghost-%COMP%]   p-dropdown[_ngcontent-%COMP%] >   .ui-dropdown label.ui-dropdown-label{height:100%;font-weight:400!important}[_nghost-%COMP%]   .font-12[_ngcontent-%COMP%]{font-size:12px}[_nghost-%COMP%]   .font-15[_ngcontent-%COMP%]{font-size:15px}[_nghost-%COMP%]   input.ui-inputtext[_ngcontent-%COMP%]:disabled{border-bottom:1px dotted;opacity:.9;background:#e8f5e9}[_nghost-%COMP%]     a.ui-panel-titlebar-icon>span.pi.pi-minus, [_nghost-%COMP%]     a.ui-panel-titlebar-icon>span.pi.pi-plus{font-size:1.7em}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border:.5px solid #81c784;border-radius:unset;height:auto!important;width:6em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}[_nghost-%COMP%]   .testo-vert-centr-11[_ngcontent-%COMP%]{margin-top:11px;margin-left:0}[_nghost-%COMP%]   .testo-vert-centr-19[_ngcontent-%COMP%]{margin-top:19px;margin-left:20px;cursor:pointer}[_nghost-%COMP%]   .icon-button-square-alt[_ngcontent-%COMP%]{background-color:#fff!important;border:2px solid #01985a;border-radius:unset;height:auto!important;width:6em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square-alt[_ngcontent-%COMP%] >   span.pi{color:#01985a!important}[_nghost-%COMP%]   .icon-button-square-alt[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .icon-button-square-alt[_ngcontent-%COMP%]:hover{background-color:#e8e8e8!important}[_nghost-%COMP%]     button.ui-datepicker-trigger.ui-calendar-button{width:5.5em!important;height:5.5em!important;background:transparent!important;position:absolute}[_nghost-%COMP%]     .ui-dialog-footer .ui-button-icon-left:before{color:#fff}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.pi{color:#01985a!important;font-size:x-large!important}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),Pa),rr=t("wd/R"),cr=((wa=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"ricevutiDtoToRicevutiViewModelBuilder",value:function(i){var e=[];return i&&i.length&&i.forEach((function(i){var t={};t.benzina=i.carburante.benzina,t.gasolio=i.carburante.gasolio,t.gasolioSerre=i.carburante.gasolioSerre,t.data=rr(i.data).format("DD/MM/YYYY"),t.cuaa=i.mittente.cuaa,t.denominazione=i.mittente.denominazione,e.push(t)})),e}}]),i}()).\u0275fac=function(i){return new(i||wa)},wa.\u0275prov=S.Jb({token:wa,factory:wa.\u0275fac,providedIn:"root"}),wa),sr=function(){return{marginTop:"70px"}},lr=((La=function(){function i(e,t,o,n,a,r,c){_classCallCheck(this,i),this.indiceUmaService=e,this.location=t,this.route=o,this.httpClientDichiarazioneConsumiUmaService=n,this.httpCLientCarburanteRicevutoService=a,this.ricevutiBuilderService=r,this.errorService=c}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.initVariables(),this.routerSubscription=this.route.params.pipe(Object(b.a)((function(e){return i.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(e.id)})),Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){return i.httpCLientCarburanteRicevutoService.getCarburanteRicevuto(e.cuaa,e.campagnaRichiesta.toString())}))).subscribe((function(e){i.datasource=i.ricevutiBuilderService.ricevutiDtoToRicevutiViewModelBuilder(e.dati)}),(function(e){return i.errorService.showError(e)}))}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe()}},{key:"goBack",value:function(){this.location.back()}},{key:"initVariables",value:function(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.cols=this.defineColumns()}},{key:"defineColumns",value:function(){return[{field:"cuaa",header:"CUAA",sortable:!0,font:ni.e.BOLD,width:"25%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"denominazione",header:"Denominazione",sortable:!0,font:ni.e.BOLD,width:"45%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"gasolio",header:"Gasolio ricevuto (lt.)",sortable:!1,width:"10%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"benzina",header:"Benzina ricevuta (lt.)",sortable:!1,width:"10%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"gasolioSerre",header:"Gasolio serre ricevuto (lt.)",sortable:!1,width:"10%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY}]}}]),i}()).\u0275fac=function(i){return new(i||La)(S.Nb(T),S.Nb(s.n),S.Nb(D.a),S.Nb(Oe.a),S.Nb(ko.a),S.Nb(cr),S.Nb(y.a))},La.\u0275cmp=S.Hb({type:La,selectors:[["app-ricevuti"]],decls:19,vars:10,consts:[["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-ricevuti_black.svg"],[1,"ml-2"],[1,"fs-20"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"cols","values"]],template:function(i,e){1&i&&(S.Ob(0,"p-toast",0),S.Tb(1,"div",1),S.Tb(2,"div",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Tb(7,"a",7),S.bc("click",(function(){return e.goBack()})),S.Ob(8,"i",8),S.Ob(9,"img",9),S.Tb(10,"span",10),S.Tb(11,"strong",11),S.Oc(12),S.gc(13,"uppercase"),S.gc(14,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(15,"div",12),S.Tb(16,"div",13),S.Tb(17,"div",14),S.Ob(18,"app-a4g-multi-table",15),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Kc(S.rc(9,sr)),S.Bb(12),S.Pc(S.hc(13,5,S.hc(14,7,"UMA.DICHIARAZIONE_CONSUMI.RICEVUTI"))),S.Bb(6),S.mc("cols",e.cols)("values",e.datasource))},directives:[N.a,D.h,hi.a],pipes:[s.G,mi.d],styles:[""]}),La),ur=((xa=function(){function i(e,t){_classCallCheck(this,i),this.http=e,this.httpClientCore=t,this.CTX_BASE_PATH="/consumi",this.CTX_PATH="/clienti"}return _createClass(i,[{key:"postAllegatiClientiContoterzi",value:function(i,e,t){var o=new FormData;return t.forEach((function(i){o.append("allegati",i)})),this.http.post("".concat(this.urlConsumi(),"/").concat(i,"/clienti/").concat(e,"/allegati"),o)}},{key:"getAllegatiClientiContoterzi",value:function(i,e){return this.http.get("".concat(this.urlConsumi(),"/").concat(i,"/clienti/").concat(e,"/allegati"))}},{key:"validaClientiContoterzi",value:function(i,e){return this.http.post("".concat(this.urlConsumi(),"/").concat(i,"/clienti/valida?idFascicolo=").concat(e),{})}},{key:"getLavorazioniClientiContoTerzi",value:function(i,e){return this.http.get("".concat(this.urlConsumi(),"/").concat(i).concat(this.CTX_PATH,"/").concat(e,"/lavorazioni"))}},{key:"getFabbisogniRichiestaCliente",value:function(i,e){return this.http.get("".concat(this.urlConsumi(),"/").concat(i).concat(this.CTX_PATH,"/").concat(e,"/fabbisogni-richiesta"))}},{key:"getFabbisogniContoTerzista",value:function(i,e){return this.http.get("".concat(this.urlConsumi(),"/").concat(i).concat(this.CTX_PATH,"/").concat(e,"/fabbisogni"))}},{key:"saveLavorazioniClientiContoTerzi",value:function(i,e,t){return this.http.post("".concat(this.urlConsumi(),"/").concat(i).concat(this.CTX_PATH,"/").concat(e,"/fabbisogni"),t)}},{key:"getClientiContoterzi",value:function(i){return this.http.get("".concat(this.urlConsumi(),"/").concat(i,"/clienti"))}},{key:"postClientiContoterzi",value:function(i,e,t){var o=new FormData;return t.forEach((function(i){o.append("allegati",i)})),this.http.post("".concat(this.urlConsumi(),"/").concat(i,"/clienti?idFascicolo=").concat(e),o)}},{key:"getCliente",value:function(i,e){return this.http.get("".concat(this.urlConsumi(),"/").concat(i).concat(this.CTX_PATH,"/").concat(e))}},{key:"deleteCliente",value:function(i,e){return this.http.delete("".concat(this.urlConsumi(),"/").concat(i).concat(this.CTX_PATH,"/").concat(e))}},{key:"urlConsumi",value:function(){return this.httpClientCore.HOST+this.httpClientCore.BASE_PATH+this.httpClientCore.API_V1+this.CTX_BASE_PATH}}]),i}()).\u0275fac=function(i){return new(i||xa)(S.Xb(f.b),S.Xb(v.a))},xa.\u0275prov=S.Jb({token:xa,factory:xa.\u0275fac,providedIn:"root"}),xa),br=t("FLe/"),hr=["accordion"];function mr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",17),S.Tb(1,"button",18),S.bc("click",(function(){return S.Ec(t),S.fc().saveLavorazioni()})),S.Sb(),S.Sb()}}function pr(i,e){1&i&&S.Ob(0,"i",29)}function dr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-a4g-multi-table",30),S.bc("clickIcon",(function(i){return S.Ec(t),S.fc(3).onClickIcon(i)}))("changedValueForm",(function(i){return S.Ec(t),S.fc(3).onChangeForm(i)})),S.Sb()}if(2&i){var o=S.fc(3);S.mc("title",o.nomeRaggruppamento)("cols",o.colsBase)("values",o.datasourceBase)("readonly",o.READONLY_MODE)}}function gr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"app-a4g-multi-table",31),S.bc("clickIcon",(function(i){return S.Ec(t),S.fc(3).onClickIcon(i)}))("changedValueForm",(function(i){return S.Ec(t),S.fc(3).onChangeForm(i)})),S.Sb()}if(2&i){var o=S.fc(3);S.mc("cols",o.colsStraordinaria)("values",o.datasourceStraordinaria)("readonly",o.READONLY_MODE)}}function fr(i,e){if(1&i&&(S.Rb(0),S.Tb(1,"p-accordionTab"),S.Tb(2,"p-header"),S.Oc(3),S.gc(4,"uppercase"),S.Mc(5,pr,1,0,"i",25),S.Sb(),S.Tb(6,"div",21),S.Mc(7,dr,1,4,"app-a4g-multi-table",26),S.Ob(8,"div",27),S.Mc(9,gr,1,3,"app-a4g-multi-table",28),S.Sb(),S.Sb(),S.Qb()),2&i){var t=e.$implicit,o=e.index,n=S.fc(2);S.Bb(3),S.Rc(" ",t.indice," ",S.hc(4,5,t.nome)," "),S.Bb(2),S.mc("ngIf",n.quantitaLavorata[o]>0),S.Bb(2),S.mc("ngIf",null==n.datasourceBase?null:n.datasourceBase.length),S.Bb(2),S.mc("ngIf",null==n.datasourceStraordinaria?null:n.datasourceStraordinaria.length)}}function vr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",19),S.Tb(1,"div",20),S.Tb(2,"div",21),S.Tb(3,"p-accordion",22,23),S.bc("onOpen",(function(i){return S.Ec(t),S.fc().onSelectAccordion(i)})),S.Mc(5,fr,10,7,"ng-container",24),S.Sb(),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(5),S.mc("ngForOf",o.raggruppamenti)}}var Sr,Cr=function(){return{marginTop:"70px"}},Or=((Sr=function(){function i(e,t,o,n,a,r,c,s,l,u){_classCallCheck(this,i),this.confirmationService=e,this.location=t,this.messageService=o,this.indiceUmaService=n,this.httpClientClienteUmaService=a,this.activeRoute=r,this.lavorazioniBuiderService=c,this.errorService=s,this.formatConverterService=l,this.httpClientAnagraficaService=u,this.ambitoLavorazioneEnum=ri}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.raggruppamentoForm=new H.j({raggruppamento:new H.g}),this.routerSubscription=this.activeRoute.params.pipe(Object(b.a)((function(e){return i.idDichiarazione=e.id,i.httpClientClienteUmaService.getCliente(e.id,e.idCliente)})),Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){i.cliente=e;var t=i.httpClientAnagraficaService.getFascicoloAgs(i.cliente.cuaa),o=i.httpClientClienteUmaService.getLavorazioniClientiContoTerzi(i.idDichiarazione,i.cliente.id),n=i.httpClientClienteUmaService.getFabbisogniRichiestaCliente(i.idDichiarazione,i.cliente.id),a=i.httpClientClienteUmaService.getFabbisogniContoTerzista(i.idDichiarazione,i.cliente.id);return Object(si.a)([t,o,n,a])}))).subscribe((function(e){var t=_slicedToArray(e,4),o=t[0],n=t[1],a=t[2],r=t[3];i.initVariables(),i.sportelloCliente=i.getDetenzioneFromFascicoloAgs(o),i.fabbisogniRichiestaCliente=a,i.raggruppamenti=i.lavorazioniBuiderService.raggruppamentoLavorazioneDtoToRaggruppmanetoLavorazioneViewModel(n,r),i.raggruppamenti=ai.orderBy(i.raggruppamenti,["indice"],["asc"]),i.calcolaQuantita()}),(function(e){return i.errorService.showError(e)}))}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.saveLavorazioniSubscription&&this.saveLavorazioniSubscription.unsubscribe()}},{key:"onSelectAccordion",value:function(i){null!=this.openedAccordion&&this.openedAccordion==i.index||(null==this.openedAccordion&&(this.openedAccordion=i.index),this.isChangedInputTable?this.showDialog(i):(this.openedAccordion=i.index,this.caricaDatiAccordionAperta(i)))}},{key:"openAccordionByIndex",value:function(i){this.accordion.tabs.forEach((function(e,t){e.selected=t==i}))}},{key:"onChangeForm",value:function(i){this.isChangedInputTable=i.isChanged,this.isValidFormTable=i.isValid}},{key:"saveLavorazioni",value:function(){var i=this;if(null==this.raggruppamentoForm.get("raggruppamento").value)return this.errorService.showErrorWithMessage(O.a.raggruppamentiNotSelezionati),!1;if(!this.isValidFormTable)return this.errorService.showErrorWithMessage(O.a.datiNonValidi),!1;var e=this.raggruppamentoForm.get("raggruppamento").value,t=this.lavorazioniBuiderService.lavorazioniViewModelToDichiarazioniDtoBuilder(e.lavorazioni),o=!1,n=[];return t.forEach((function(t){i.fabbisogniRichiestaCliente.forEach((function(a){var r=0,c=0;t.lavorazioneId===a.lavorazioneId&&(r=t.fabbisogni.reduce((function(e,t){return e+i.formatConverterService.toNumber(t.quantita)}),0),c=a.fabbisogni.reduce((function(e,t){return e+i.formatConverterService.toNumber(t.quantita)}),0),console.log("totaleDichiaratoDalContoTerzista",r),console.log("totaleDichiaratoDalCliente",c),console.log("superficieMassima",e.superficieMassima),r>0&&r+c>e.superficieMassima&&(o=!0,n.push.apply(n,_toConsumableArray(e.lavorazioni.filter((function(i){return i.id===t.lavorazioneId}))))))}))})),o?(this.showDialogSuperficieMax(t,n),!1):(this.persistLavorazioni(t),!0)}},{key:"goBack",value:function(){var i=this;this.isChangedInputTable?this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){i.location.back()},reject:function(){},key:"conto-terzi-dettaglio-dialog"}):this.location.back()}},{key:"persistLavorazioni",value:function(i){var e=this;console.log("Salvo dichiarazioni contoterzista: ",i),this.saveLavorazioniSubscription=this.httpClientClienteUmaService.saveLavorazioniClientiContoTerzi(this.idDichiarazione,this.cliente.id,i).subscribe((function(){e.isChangedInputTable=!1,e.messageService.add(m.a.getToast("tst",m.b.success,O.a.salvataggioOKConsumiLavorazioni)),e.calcolaQuantita()}),(function(i){return e.errorService.showError(i)}))}},{key:"initVariables",value:function(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.isValidFormTable=!0,this.isChangedInputTable=!1,this.nomeRaggruppamento=null,this.quantitaLavorata=[],this.datasourceBase=[],this.datasourceStraordinaria=[],this.colsBase=this.defineColumnsByTitle("Lavorazioni Base"),this.colsStraordinaria=this.defineColumnsByTitle("Lavorazioni Straordinarie"),this.raggruppamentoForm.controls.raggruppamento.setValue(null)}},{key:"calcolaQuantita",value:function(){var i=this;this.raggruppamenti&&this.raggruppamenti.length&&this.raggruppamenti.forEach((function(e,t){i.quantitaLavorata[t]=0,e.lavorazioni.forEach((function(e){var o=isNaN(Number(e.BENZINA))?0:Number(e.BENZINA),n=isNaN(Number(e.GASOLIO))?0:Number(e.GASOLIO);i.quantitaLavorata[t]=i.quantitaLavorata[t]+o+n}))}))}},{key:"caricaDatiAccordionAperta",value:function(i){var e=this.raggruppamenti[i.index];this.nomeRaggruppamento=e.indice+" "+e.nome,this.splitDatasources(e.lavorazioni),this.raggruppamentoForm.controls.raggruppamento.setValue(e),this.isChangedInputTable=!1}},{key:"splitDatasources",value:function(i){var e=[],t=[];i.forEach((function(i){i.tipo===ci.BASE?t.push(i):e.push(i)})),this.datasourceBase=ai.sortBy(t,["indice"]),this.datasourceStraordinaria=ai.sortBy(e,["indice"])}},{key:"onClickIcon",value:function(i){i.col.field!==F.a.GASOLIO&&i.col.field!==F.a.BENZINA||this.updateTable(i.element,i.col)}},{key:"updateTable",value:function(i,e){var t=this.datasourceBase.filter((function(e){return e.id===i.id}))[0];null==t&&(t=this.datasourceStraordinaria.filter((function(e){return e.id===i.id}))[0]);var o=e.field===F.a.GASOLIO?F.a.BENZINA:F.a.GASOLIO;t[e.field]=t[e.field]!=t.superficieMassima?i.superficieMassima:"",t[o]=""}},{key:"getDetenzioneFromFascicoloAgs",value:function(i){if(!i||!i.detenzioni||!i.detenzioni.length)return null;if(i&&i.detenzioni&&i.detenzioni.length&&1===i.detenzioni.length)return i.detenzioni[0];var e=i.detenzioni.filter((function(i){return i.tipoDetenzione===br.a.DELEGA})),t=i.detenzioni.filter((function(i){return i.tipoDetenzione===br.a.MANDATO}));return t||t.length||e||e.length?!t&&!t.length&&e&&e.length>1?(this.errorService.showErrorWithMessage("Il cliente dispone di pi\xf9 deleghe - Non \xe8 possibile reperire lo sportello!"),null):t||t.length||!e||1!==e.length?t&&t.length>1?(this.errorService.showErrorWithMessage("Il cliente dispone di piu mandati - Non \xe8 possibile reperire lo sportello!"),null):t&&1===t.length?t[0]:void 0:e[0]:(this.errorService.showErrorWithMessage("Il cliente non dispone di un mandato n\xe8 di una delega - Non \xe8 possibile reperire lo sportello!"),null)}},{key:"showDialog",value:function(i){var e=this;this.confirmationService.confirm({message:O.a.datiNonSalvati,accept:function(){e.openedAccordion=i.index,e.caricaDatiAccordionAperta(i),e.openAccordionByIndex(e.openedAccordion)},reject:function(){e.openAccordionByIndex(e.openedAccordion)},key:"conto-terzi-dettaglio-dialog"})}},{key:"showDialogSuperficieMax",value:function(i,e){var t=this,o=e.map((function(i){return i.descrizioneCompleta.split(" ")[0]})).join(", ");this.confirmationService.confirm({header:"Lavorazion".concat(e.length>1?"i":"e",": ")+o,message:O.a.superficieDichiarataGtSupMax+this.sportelloCliente.sportello+" "+this.sportelloCliente.identificativoSportello+O.a.superficieDichiarataGtSupMax2,accept:function(){t.persistLavorazioni(i)},reject:function(){},key:"conto-terzi-superficie-max-alert"})}},{key:"defineColumnsByTitle",value:function(i){return[{field:"descrizioneCompleta",header:i,sortable:!1,font:ni.e.BOLD,width:"46%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"superficieMassima",suffix:"unitaDiMisura",header:"Superficie massima",sortable:!1,width:"18%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:F.a.GASOLIO,suffix:"unitaDiMisura",header:"Sup. gasolio",sortable:!1,disabled:!this.cliente.gasolio,inputOpts:{pattern:"^([0-9])+$",maxLength:"7",upperLimitField:"superficieMassima"},icon:"pi pi-chevron-circle-right",width:"18%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER},{field:F.a.BENZINA,suffix:"unitaDiMisura",header:"Sup. benzina",sortable:!1,disabled:!this.cliente.benzina,inputOpts:{pattern:"^([0-9])+$",maxLength:"7",upperLimitField:"superficieMassima"},icon:"pi pi-chevron-circle-right",width:"18%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER}]}}]),i}()).\u0275fac=function(i){return new(i||Sr)(S.Nb(M.a),S.Nb(s.n),S.Nb(M.d),S.Nb(T),S.Nb(ur),S.Nb(D.a),S.Nb(ui),S.Nb(y.a),S.Nb(ki.a),S.Nb(Lt))},Sr.\u0275cmp=S.Hb({type:Sr,selectors:[["app-dettaglio-clienti-contoterzi"]],viewQuery:function(i,e){var t;1&i&&S.Uc(hr,!0),2&i&&S.Ac(t=S.cc())&&(e.accordion=t.first)},decls:21,vars:12,consts:[["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","conto-terzi-dettaglio-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","conto-terzi-superficie-max-alert","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],["novalidate","",1,"w-100",3,"formGroup"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-contoterzi_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed w-10m p-0 py-1",4,"ngIf"],["class","p-grid",4,"ngIf"],[1,"p-col-fixed","w-10m","p-0","py-1"],["pButton","","type","button","label","SALVA",3,"click"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"onOpen"],["accordion",""],[4,"ngFor","ngForOf"],["class","accordion-icon pi pi-check",4,"ngIf"],[3,"title","cols","values","readonly","clickIcon","changedValueForm",4,"ngIf"],[1,"mb-1"],[3,"cols","values","readonly","clickIcon","changedValueForm",4,"ngIf"],[1,"accordion-icon","pi","pi-check"],[3,"title","cols","values","readonly","clickIcon","changedValueForm"],[3,"cols","values","readonly","clickIcon","changedValueForm"]],template:function(i,e){1&i&&(S.Ob(0,"p-confirmDialog",0),S.Ob(1,"p-confirmDialog",1),S.Ob(2,"p-toast",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"form",6),S.Tb(7,"div",7),S.Tb(8,"div",8),S.Tb(9,"div",9),S.Tb(10,"a",10),S.bc("click",(function(){return e.goBack()})),S.Ob(11,"i",11),S.Ob(12,"img",12),S.Tb(13,"span",13),S.Oc(14),S.gc(15,"uppercase"),S.gc(16,"translate"),S.Tb(17,"strong",14),S.Oc(18),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Mc(19,mr,2,0,"div",15),S.Sb(),S.Mc(20,vr,6,1,"div",16),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Bb(2),S.Kc(S.rc(11,Cr)),S.Bb(4),S.mc("formGroup",e.raggruppamentoForm),S.Bb(8),S.Qc(" ",S.hc(15,7,S.hc(16,9,"UMA.DICHIARAZIONE_CONSUMI.CLIENTI_CONTOTERZI"))," / "),S.Bb(4),S.Pc(null==e.cliente?null:e.cliente.denominazione),S.Bb(1),S.mc("ngIf",!e.READONLY_MODE),S.Bb(1),S.mc("ngIf",null==e.raggruppamenti?null:e.raggruppamenti.length))},directives:[_.a,N.a,H.I,H.t,H.k,D.h,s.t,k.b,bi.a,s.s,bi.c,M.c,hi.a],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),Sr),Tr=t("6b9K"),Ir=["dialog"],zr=["table"],Ar=function(){return{width:"20%"}},Er=function(){return{width:"70%"}},yr=function(){return{width:"10%","text-align":"center"}};function Rr(i,e){1&i&&(S.Tb(0,"tr"),S.Tb(1,"th",18),S.Oc(2,"CUAA"),S.Sb(),S.Tb(3,"th",19),S.Oc(4," DENOMINAZIONE "),S.Ob(5,"p-sortIcon",20),S.Sb(),S.Tb(6,"th",18),S.Oc(7,"AZIONI"),S.Sb(),S.Sb()),2&i&&(S.Bb(1),S.mc("ngStyle",S.rc(3,Ar)),S.Bb(2),S.mc("ngStyle",S.rc(4,Er)),S.Bb(3),S.mc("ngStyle",S.rc(5,yr)))}function Dr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"tr"),S.Tb(1,"td",18),S.Oc(2),S.Sb(),S.Tb(3,"td",18),S.Oc(4),S.gc(5,"uppercase"),S.Sb(),S.Tb(6,"td",18),S.Tb(7,"button",21),S.bc("click",(function(){S.Ec(t);var i=e.$implicit;return S.fc(2).onClickButton("AGGIUNGI",i.cuaa,i.idAgs)})),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit;S.Bb(1),S.mc("ngStyle",S.rc(7,Ar)),S.Bb(1),S.Pc(o.cuaa),S.Bb(1),S.mc("ngStyle",S.rc(8,Er)),S.Bb(1),S.Pc(S.hc(5,5,o.denominazione)),S.Bb(2),S.mc("ngStyle",S.rc(9,yr))}}function Mr(i,e){1&i&&(S.Tb(0,"tr"),S.Tb(1,"td"),S.Oc(2,"Nessun risultato trovato."),S.Sb(),S.Sb()),2&i&&(S.Bb(1),S.Cb("colspan",4))}function Nr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",12),S.Tb(1,"p-table",13,14),S.bc("onLazyLoad",(function(i){S.Ec(t);var e=S.fc();return e.changePage(i,e.testoRicerca)})),S.Mc(3,Rr,8,6,"ng-template",15),S.Mc(4,Dr,8,10,"ng-template",16),S.Mc(5,Mr,3,1,"ng-template",17),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(1),S.mc("autoLayout",!0)("value",null==o.datasource?null:o.datasource.risultati)("paginator",!0)("rows",o.elementiPerPagina)("scrollable",!0)("resetPageOnSort",!0)("first",o.first)("totalRecords",o.totalElements)("lazy",!0)}}var _r,Br,kr=function(){return{overflow:"auto"}},Fr=function(){return{marginTop:"70px"}},Pr=((_r=function(){function i(e,t,o,n,a){_classCallCheck(this,i),this.messageService=e,this.route=t,this.fascicoloService=o,this.httpClientClienteUmaService=n,this.errorService=a,this.clienteSelezionato={},this.chiudiPopup=new S.n}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.routerSubscription=this.route.params.subscribe((function(e){i.idDichiarazione=e.id}))}},{key:"ngOnDestroy",value:function(){this.postClienteSubscription&&this.postClienteSubscription.unsubscribe(),this.routerSubscription&&this.routerSubscription.unsubscribe(),this.pagedListSubscription&&this.pagedListSubscription.unsubscribe(),this.validaClientiSubscription&&this.validaClientiSubscription.unsubscribe()}},{key:"open",value:function(){this.display=!0,this.datasource={},this.datasource.count=0,this.datasource.risultati=[],this.testoRicerca=null,this.initPaginator()}},{key:"onHideDialog",value:function(){}},{key:"onCloseToastRicercaClienti",value:function(){}},{key:"chiudiDialog",value:function(i){this.display=!1,this.dialogElement._style.width="unset"}},{key:"onClickButton",value:function(i,e,t){var o=this;switch(i){case"CERCA":this.reset(),this.cercaClienti(e,this.buildPaginatorEvent());break;case"AGGIUNGI":this.validaClientiSubscription=this.httpClientClienteUmaService.validaClientiContoterzi(this.idDichiarazione,t).subscribe((function(){o.clienteSelezionato.cuaa=e,o.clienteSelezionato.idFascicolo=t,o.addCliente(o.clienteSelezionato)}),(function(i){return o.errorService.showError(i,"tst-ricerca-clienti")}))}}},{key:"changePage",value:function(i,e){this.cercaClienti(e,i)}},{key:"reset",value:function(){this.table&&this.table.reset()}},{key:"cercaClienti",value:function(i,e){var t=this;this.numeroPagina=Math.floor(e.first/this.elementiPerPagina),null==this.numeroPagina&&(this.numeroPagina=0),this.paginazione=Tr.a.of(this.numeroPagina,this.elementiPerPagina,e.sortField,Tr.a.getOrdine(e.sortOrder)),this.paginazione.numeroElementiPagina=this.elementiPerPagina,this.pagedListSubscription=this.fascicoloService.getListaPaged(i,this.paginazione).pipe(Object(b.a)((function(i){return t.dialogElement.center(),t.dialogElement._style.width=1200,Object(w.a)(i)})),Object(h.a)((function(i){return t.errorService.showError(i,"tst-ricerca-clienti"),u.a}))).subscribe((function(i){t.datasource=i,null!=t.datasource&&(t.totalElements=t.datasource.count)}),(function(i){return t.errorService.showError(i,"tst-ricerca-clienti")}))}},{key:"isNotValidText",value:function(i){return!(i&&i.length>2)}},{key:"addCliente",value:function(i){this.chiudiDialog(),this.chiudiPopup.emit(i)}},{key:"initPaginator",value:function(){this.first=0,this.totalElements=0,this.numeroPagina=0,this.elementiPerPagina=5,this.defaultPropertySort="denominazione"}},{key:"buildPaginatorEvent",value:function(){return{filters:{},first:0,globalFilter:null,multiSortMeta:void 0,rows:this.elementiPerPagina,sortField:this.defaultPropertySort,sortOrder:1}}}]),i}()).\u0275fac=function(i){return new(i||_r)(S.Nb(M.d),S.Nb(D.a),S.Nb(Mt.a),S.Nb(ur),S.Nb(y.a))},_r.\u0275cmp=S.Hb({type:_r,selectors:[["app-popup-ricerca-clienti-contoterzi"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(Ir,!0),S.Uc(zr,!0)),2&i&&(S.Ac(t=S.cc())&&(e.dialogElement=t.first),S.Ac(t=S.cc())&&(e.table=t.first))},outputs:{chiudiPopup:"chiudiPopup"},decls:15,vars:23,consts:[["id","popup-ricerca-clienti-contoterzi",3,"visible","focusOnShow","modal","closable","closeOnEscape","blockScroll","dismissableMask","contentStyle","header","visibleChange","onHide"],["dialog",""],["key","tst-dialog"],["key","tst-ricerca-clienti",3,"onClose"],[1,"ui-grid"],[1,"ui-g-12","ui-md-12","w-100"],[1,"ui-inputgroup"],["type","text","placeholder","Cerca cliente","id","testoRicerca","size","60",3,"ngModel","ngModelChange"],["pButton","","type","button","icon","pi pi-search",1,"icon-button-square",3,"disabled","click"],["class","ui-g-12 ui-md-12 w-100 boxgrey table-container",4,"ngIf"],[1,"ui-g-4"],["pButton","","type","button","label","Chiudi",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal",3,"click"],[1,"ui-g-12","ui-md-12","w-100","boxgrey","table-container"],[3,"autoLayout","value","paginator","rows","scrollable","resetPageOnSort","first","totalRecords","lazy","onLazyLoad"],["table",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"ngStyle"],["pSortableColumn","denominazione",3,"ngStyle"],["field","denominazione"],["pButton","","icon","pi pi-plus",1,"icon-button-square",3,"click"]],template:function(i,e){1&i&&(S.Tb(0,"p-dialog",0,1),S.bc("visibleChange",(function(i){return e.display=i}))("onHide",(function(){return e.onHideDialog()})),S.gc(2,"uppercase"),S.gc(3,"translate"),S.Ob(4,"p-toast",2),S.Tb(5,"p-toast",3),S.bc("onClose",(function(){return e.onCloseToastRicercaClienti()})),S.Sb(),S.Tb(6,"div",4),S.Tb(7,"div",5),S.Tb(8,"div",6),S.Tb(9,"input",7),S.bc("ngModelChange",(function(i){return e.testoRicerca=i})),S.Sb(),S.Tb(10,"button",8),S.bc("click",(function(){return e.onClickButton("CERCA",e.testoRicerca,0)})),S.Sb(),S.Sb(),S.Sb(),S.Mc(11,Nr,6,9,"div",9),S.Sb(),S.Tb(12,"div",4),S.Tb(13,"div",10),S.Tb(14,"button",11),S.bc("click",(function(i){return e.chiudiDialog(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.nc("header",S.hc(2,16,S.hc(3,18,"UMA.DICHIARAZIONE_CONSUMI.RICERCA_CLIENTI"))),S.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("blockScroll",!0)("dismissableMask",!0)("contentStyle",S.rc(20,kr)),S.Bb(4),S.Kc(S.rc(21,Fr)),S.Bb(1),S.Kc(S.rc(22,Fr)),S.Bb(4),S.mc("ngModel",e.testoRicerca),S.Bb(1),S.mc("disabled",e.isNotValidText(e.testoRicerca)),S.Bb(1),S.mc("ngIf",null==e.datasource||null==e.datasource.risultati?null:e.datasource.risultati.length))},directives:[So.a,N.a,H.c,H.s,H.v,k.b,s.t,U.q,M.e,s.w,U.p,U.o],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   th[_ngcontent-%COMP%]{color:#000}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:27em;max-height:27em;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]     .ui-widget-header{border:unset!important}"]}),_r),wr=["dialog"],xr=function(){return{overflow:"auto","max-height":"500px"}},Lr=function(){return{marginTop:"70px"}},Gr=function(){return{"text-align":"right"}},Ur=((Br=function(){function i(e){_classCallCheck(this,i),this.route=e,this.chiudiPopup=new S.n}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.clienteSelezionato=null,this.routerSubscription=this.route.params.subscribe((function(e){i.idDichiarazione=e.id}))}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe()}},{key:"open",value:function(i){this.clienteSelezionato=i,this.display=!0}},{key:"onHideDialog",value:function(){}},{key:"onCloseToastRicercaClienti",value:function(){}},{key:"chiudiDialog",value:function(i){this.chiudiPopup.emit(this.clienteSelezionato),this.display=!1}},{key:"annulla",value:function(){this.display=!1}}]),i}()).\u0275fac=function(i){return new(i||Br)(S.Nb(D.a))},Br.\u0275cmp=S.Hb({type:Br,selectors:[["app-popup-cancella-cliente-contoterzi"]],viewQuery:function(i,e){var t;1&i&&S.Jc(wr,!0,S.l),2&i&&S.Ac(t=S.cc())&&(e.dialogElement=t.first)},inputs:{cliente:"cliente"},outputs:{chiudiPopup:"chiudiPopup"},decls:16,vars:18,consts:[["id","popup-ricerca-clienti-contoterzi","width","550","position","top",3,"visible","focusOnShow","modal","closable","closeOnEscape","contentStyle","header","dismissableMask","visibleChange","onHide"],["dialog",""],["key","tst-dialog"],[1,"p-grid"],[1,"p-col","w-100"],[1,"p-col"],["pButton","","type","button","label","SI",1,"ui-button-secondary","w-10m",3,"click"],[1,"p-col",3,"ngStyle"],["pButton","","type","button","label","NO",1,"w-10m",3,"click"]],template:function(i,e){1&i&&(S.Tb(0,"p-dialog",0,1),S.bc("visibleChange",(function(i){return e.display=i}))("onHide",(function(){return e.onHideDialog()})),S.gc(2,"uppercase"),S.gc(3,"translate"),S.Ob(4,"p-toast",2),S.Tb(5,"div",3),S.Tb(6,"div",4),S.Ob(7,"br"),S.Oc(8," Attenzione! Si desidera procedere con la cancellazione dell\u2019Azienda inserita, delle eventuali lavorazioni e allegati? "),S.Ob(9,"br"),S.Sb(),S.Sb(),S.Ob(10,"br"),S.Tb(11,"div",3),S.Tb(12,"div",5),S.Tb(13,"button",6),S.bc("click",(function(i){return e.chiudiDialog(i)})),S.Sb(),S.Sb(),S.Tb(14,"div",7),S.Tb(15,"button",8),S.bc("click",(function(){return e.annulla()})),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.nc("header",S.hc(2,11,S.hc(3,13,"UMA.DICHIARAZIONE_CONSUMI.ATTENZIONE"))),S.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("contentStyle",S.rc(15,xr))("dismissableMask",!0),S.Bb(4),S.Kc(S.rc(16,Lr)),S.Bb(10),S.mc("ngStyle",S.rc(17,Gr)))},directives:[So.a,N.a,k.b,s.w],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}"]}),Br),Vr=["dialog"],Hr=["fileCaricato"];function Zr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",13),S.Tb(1,"button",14),S.bc("click",(function(){return S.Ec(t),S.fc().caricaAllegato()})),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(1),S.mc("disabled",(null==o.fileAllegati?null:o.fileAllegati.length)>=5)}}function jr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"img",19),S.bc("click",(function(){S.Ec(t);var i=S.fc(2).index;return S.fc().eliminaAllegato(i)})),S.Sb()}}function Yr(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div"),S.Tb(1,"h6",16),S.Mc(2,jr,1,0,"img",17),S.Tb(3,"span"),S.Tb(4,"a",18),S.bc("click",(function(){S.Ec(t);var i=S.fc().index;return S.fc().visualizzaAllegato(i)})),S.Oc(5),S.Sb(),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=S.fc().$implicit,n=S.fc();S.Bb(2),S.mc("ngIf",!n.READONLY_MODE),S.Bb(3),S.Qc(" ",o.name," ")}}function qr(i,e){if(1&i&&(S.Tb(0,"div",13),S.Mc(1,Yr,6,2,"div",15),S.Sb()),2&i){var t=e.$implicit;S.Bb(1),S.mc("ngIf",t)}}var Qr,Kr=function(){return{overflow:"auto","max-height":"400px"}},Wr=function(){return{marginTop:"70px"}},$r=((Qr=function(){function i(e,t,o,n){_classCallCheck(this,i),this.messageService=e,this.httpClientClienteUmaService=t,this.route=o,this.errorService=n,this.chiudiPopup=new S.n,this.fileExt=".pdf",this.fileAllegati=[],this.maxSize=2,this.uploadHelper=new $e.a(this.fileExt,this.maxSize)}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.routerSubscription=this.route.params.subscribe((function(e){i.idDichiarazione=e.id}))}},{key:"ngOnDestroy",value:function(){this.postClienteSubscription&&this.postClienteSubscription.unsubscribe(),this.routerSubscription&&this.routerSubscription.unsubscribe(),this.getAllegatiSubscription&&this.getAllegatiSubscription.unsubscribe(),this.postAllegatiSuscription&&this.postAllegatiSuscription.unsubscribe()}},{key:"open",value:function(i){var e=this;this.display=!0,this.modalitaCrea=i.modalitaCrea,this.cliente=i.cliente,!i.modalitaCrea&&i.cliente&&i.cliente.id&&(this.getAllegatiSubscription=this.httpClientClienteUmaService.getAllegatiClientiContoterzi(this.idDichiarazione,i.cliente.id).subscribe((function(i){e.fileAllegati=[],i&&i.length&&i.forEach((function(i){var t=e.uploadHelper.stringToFile(i.allegato,i.nomeFile,"application/pdf");e.fileAllegati.push(t)}))}),(function(i){return e.errorService.showError(i,"tst-allegati-clienti")})))}},{key:"salva",value:function(i){var e=this;this.modalitaCrea?this.addCliente(this.cliente.idFascicolo):this.postAllegatiSuscription=this.httpClientClienteUmaService.postAllegatiClientiContoterzi(this.idDichiarazione,this.cliente.id,this.fileAllegati).subscribe((function(i){e.ripristinaValori(),e.display=!1,e.messageService.add(m.a.getToast("tst",m.b.success,O.a.salvataggioOKConsumiLavorazioni))}),(function(i){return e.errorService.showError(i,"tst-allegati-clienti")}))}},{key:"annulla",value:function(){this.ripristinaValori(),this.display=!1}},{key:"caricaAllegato",value:function(){document.getElementById("fileCaricato").click()}},{key:"addCliente",value:function(i){var e=this;this.postClienteSubscription=this.httpClientClienteUmaService.postClientiContoterzi(this.idDichiarazione,i,this.fileAllegati).subscribe((function(i){e.chiudiPopup.emit(),e.ripristinaValori(),e.display=!1,e.messageService.add(m.a.getToast("tst",m.b.success,O.a.salvataggioOKConsumiLavorazioni))}),(function(i){console.log("ERRORE: ",i);var t="Errore nel recupero dati.";i&&i.error&&i.error.message&&(t=i.error.message),e.errorService.showErrorWithMessage(t,"tst-allegati-clienti")}))}},{key:"eliminaAllegato",value:function(i){this.modalitaCrea||!this.fileAllegati||1!=this.fileAllegati.length?(!this.modalitaCrea&&this.fileAllegati&&this.fileAllegati.length>1||this.modalitaCrea)&&this.fileAllegati.splice(i,1):this.errorService.showErrorWithMessage("E\u2019 obbligatorio aver caricato almeno un allegato","tst-allegati-clienti")}},{key:"visualizzaAllegato",value:function(i){if(null!=this.fileAllegati[i]){var e=URL.createObjectURL(this.fileAllegati[i]);R.saveAs(this.fileAllegati[i],this.fileAllegati[i].name),this.fileAllegati[i].type===vo.a.PDF&&window.open(e)}}},{key:"numeroMassimoAllegati",value:function(){var i=!1;return this.fileAllegati.length>=5&&(i=!0),i}},{key:"onFileChange",value:function(i){if(i.target.files&&i.target.files.length>0){var e=i.target.files[0];if(e.name.length>50)return void this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.FILENAME,"tst-dialog");if(!this.uploadHelper.isValidFileExtension(e))return void this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.EXT_PDF,"tst-dialog");if(!this.uploadHelper.isValidFileSize(e))return void this.errorService.showErrorWithMessage(O.a.FILE_ERRORS.SIZE,"tst-dialog");this.fileAllegati.push(e)}}},{key:"ripristinaValori",value:function(){this.fileAllegati=[]}}]),i}()).\u0275fac=function(i){return new(i||Qr)(S.Nb(M.d),S.Nb(ur),S.Nb(D.a),S.Nb(y.a))},Qr.\u0275cmp=S.Hb({type:Qr,selectors:[["app-popup-allegati-clienti-contoterzi"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(Vr,!0,S.l),S.Jc(Hr,!0)),2&i&&(S.Ac(t=S.cc())&&(e.dialogElement=t.first),S.Ac(t=S.cc())&&(e.file=t.first))},inputs:{READONLY_MODE:"READONLY_MODE"},outputs:{chiudiPopup:"chiudiPopup"},decls:24,vars:26,consts:[["id","popup-allegati-clienti-contoterzi","width","600","position","top",3,"visible","focusOnShow","modal","closable","closeOnEscape","blockScroll","contentStyle","header","dismissableMask","visibleChange"],["dialog",""],["key","tst-dialog"],["key","tst-allegati-clienti"],[1,"ui-grid"],[1,"ui-g-12","ui-md-12","w-100"],["class","ui-inputgroup",4,"ngIf"],["type","file","id","fileCaricato","name","fileCaricato","onclick","this.value = null",1,"inputUploadFile",2,"display","none",3,"accept","change"],["fileCaricato",""],["class","ui-inputgroup",4,"ngFor","ngForOf"],[1,"p-grid","p-justify-end"],["pButton","","type","button","label","Annulla",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none","w-5m",3,"click"],["pButton","","type","button","label","Salva",1,"ui-button-text-only","p-1","text-uppercase","font-weight-normal","shadow-none","w-5m",3,"disabled","click"],[1,"ui-inputgroup"],["pButton","","type","button","label","CARICA ALLEGATO",3,"disabled","click"],[4,"ngIf"],[1,"text-confirm",2,"padding","0 !important"],["class","cursor-pointer","src","assets/img/ico-x.jpg",3,"click",4,"ngIf"],["target","_blank",1,"cursor-pointer","p-col",3,"click"],["src","assets/img/ico-x.jpg",1,"cursor-pointer",3,"click"]],template:function(i,e){1&i&&(S.Tb(0,"p-dialog",0,1),S.bc("visibleChange",(function(i){return e.display=i})),S.gc(2,"uppercase"),S.gc(3,"translate"),S.Ob(4,"p-toast",2),S.Ob(5,"p-toast",3),S.Tb(6,"div",4),S.Tb(7,"div",5),S.Tb(8,"div"),S.Oc(9),S.Ob(10,"br"),S.Ob(11,"br"),S.Sb(),S.Mc(12,Zr,2,1,"div",6),S.Tb(13,"input",7,8),S.bc("change",(function(i){return e.onFileChange(i)})),S.Sb(),S.Sb(),S.Tb(15,"div",5),S.Ob(16,"br"),S.Mc(17,qr,2,1,"div",9),S.Sb(),S.Sb(),S.Ob(18,"br"),S.Tb(19,"div",10),S.Tb(20,"div"),S.Tb(21,"button",11),S.bc("click",(function(){return e.annulla()})),S.Sb(),S.Sb(),S.Tb(22,"div"),S.Tb(23,"button",12),S.bc("click",(function(i){return e.salva(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.nc("header",S.hc(2,19,S.hc(3,21,"UMA.DICHIARAZIONE_CONSUMI.ALLEGATI"))),S.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("blockScroll",!0)("contentStyle",S.rc(23,Kr))("dismissableMask",!0),S.Bb(4),S.Kc(S.rc(24,Wr)),S.Bb(1),S.Kc(S.rc(25,Wr)),S.Bb(4),S.Rc(" CUAA: ",null==e.cliente?null:e.cliente.cuaa," - ID FASCICOLO: ",null==e.cliente?null:e.cliente.idFascicolo,""),S.Bb(3),S.mc("ngIf",!e.READONLY_MODE),S.Bb(1),S.nc("accept",e.fileExt),S.Bb(4),S.mc("ngForOf",e.fileAllegati),S.Bb(6),S.mc("disabled",0==(null==e.fileAllegati?null:e.fileAllegati.length)||e.READONLY_MODE))},directives:[So.a,N.a,s.t,s.s,k.b],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:450px;max-height:450px;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),Qr),Jr=["popupRicercaClienti"],Xr=["popupCancellaCliente"],ic=["popupAllegatiCliente"];function ec(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",24),S.Tb(1,"button",25),S.bc("click",(function(){return S.Ec(t),S.fc().openRicercaClienteDialog()})),S.Sb(),S.Sb()}}var tc=function(){return{width:"4%"}};function oc(i,e){1&i&&S.Ob(0,"th",27),2&i&&S.mc("ngStyle",S.rc(1,tc))}var nc=function(){return{width:"20%"}},ac=function(){return{width:"55%"}},rc=function(){return{width:"10%","text-align":"center"}},cc=function(){return{width:"6%","text-align":"center"}};function sc(i,e){if(1&i&&(S.Tb(0,"tr"),S.Mc(1,oc,1,2,"th",26),S.Tb(2,"th",27),S.Oc(3,"CUAA"),S.Sb(),S.Tb(4,"th",28),S.Oc(5," Denominazione "),S.Ob(6,"p-sortIcon",29),S.Sb(),S.Tb(7,"th",27),S.Oc(8,"Lavorazioni"),S.Sb(),S.Tb(9,"th",27),S.Oc(10,"Allegati"),S.Sb(),S.Sb()),2&i){var t=S.fc();S.Bb(1),S.mc("ngIf",!t.READONLY_MODE),S.Bb(1),S.mc("ngStyle",S.rc(5,nc)),S.Bb(2),S.mc("ngStyle",S.rc(6,ac)),S.Bb(3),S.mc("ngStyle",S.rc(7,rc)),S.Bb(2),S.mc("ngStyle",S.rc(8,cc))}}var lc=function(){return{"text-align":"center"}};function uc(i,e){if(1&i){var t=S.Ub();S.Tb(0,"td",27),S.Tb(1,"img",32),S.bc("click",(function(){S.Ec(t);var i=S.fc().$implicit;return S.fc().deleteClientiContoterzi(i)})),S.Sb(),S.Sb()}2&i&&S.mc("ngStyle",S.rc(1,lc))}function bc(i,e){if(1&i){var t=S.Ub();S.Tb(0,"tr"),S.Mc(1,uc,2,2,"td",26),S.Tb(2,"td"),S.Oc(3),S.Sb(),S.Tb(4,"td"),S.Oc(5),S.Sb(),S.Tb(6,"td"),S.Tb(7,"div"),S.Tb(8,"button",30),S.bc("click",(function(){S.Ec(t);var i=e.$implicit;return S.fc().onClickButton("LAVORAZIONI",i)})),S.Sb(),S.Sb(),S.Sb(),S.Tb(9,"td",27),S.Tb(10,"div"),S.Tb(11,"button",31),S.bc("click",(function(){S.Ec(t);var i=e.$implicit;return S.fc().onClickButton("ALLEGATI",i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit,n=S.fc();S.Bb(1),S.mc("ngIf",!n.READONLY_MODE),S.Bb(2),S.Pc(o.cuaa),S.Bb(2),S.Qc(" ",o.denominazione," "),S.Bb(4),S.mc("ngStyle",S.rc(4,lc))}}function hc(i,e){1&i&&(S.Tb(0,"tr"),S.Tb(1,"td"),S.Oc(2,"Nessun cliente inserito"),S.Sb(),S.Sb()),2&i&&(S.Bb(1),S.Cb("colspan",5))}var mc,pc,dc,gc,fc=function(){return{marginTop:"70px"}},vc=((dc=function(){function i(e,t,o,n,a,r,c,s){_classCallCheck(this,i),this.messageService=e,this.route=t,this.indiceUmaService=o,this.httpClientClienteUmaService=n,this.location=a,this.router=r,this.activeRoute=c,this.errorService=s}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.routerSubscription=this.route.params.subscribe((function(e){i.idDichiarazione=e.id})),this.caricaListaClienti()}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.caricaSubscription&&this.caricaSubscription.unsubscribe(),this.getLavorazioniSubscription&&this.getLavorazioniSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe()}},{key:"goBack",value:function(){this.location.back()}},{key:"openRicercaClienteDialog",value:function(){this.popupRicercaClienti.open()}},{key:"openAllegatiClienteEditaDialog",value:function(i){this.popupAllegatiCliente.open({modalitaCrea:!1,cliente:i})}},{key:"openAllegatiClienteCreaDialog",value:function(i){this.popupAllegatiCliente.open({modalitaCrea:!0,cliente:i})}},{key:"caricaListaClienti",value:function(){var i=this;this.caricaSubscription=this.httpClientClienteUmaService.getClientiContoterzi(this.idDichiarazione).subscribe((function(e){i.listaClientiContoterzi=e}),(function(e){return i.errorService.showError(e)}))}},{key:"deleteClientiContoterzi",value:function(i){this.popupCancellaCliente.open(i)}},{key:"cancellaCliente",value:function(i){var e=this;this.deleteSubscription=this.httpClientClienteUmaService.deleteCliente(this.idDichiarazione,i.id).pipe(Object(h.a)((function(i){return e.errorService.showError(i),u.a})),Object(b.a)((function(){return e.messageService.add(m.a.getToast("tst",m.b.success,O.a.cancellazioneClienteContoTerziOK)),e.httpClientClienteUmaService.getClientiContoterzi(e.idDichiarazione)}))).subscribe((function(i){e.listaClientiContoterzi=i}),(function(i){return e.errorService.showError(i)}))}},{key:"onClickButton",value:function(i,e){var t=this;switch(i){case"LAVORAZIONI":this.getLavorazioniSubscription=this.httpClientClienteUmaService.getLavorazioniClientiContoTerzi(this.idDichiarazione.toString(),e.id).subscribe((function(i){i&&i.length?t.router.navigate([e.id],{relativeTo:t.activeRoute.parent}):t.messageService.add(m.a.getToast("tst",m.b.error,O.a.noLavorazioniDisponibili))}),(function(i){return t.errorService.showError(i)}));break;case"ALLEGATI":this.openAllegatiClienteEditaDialog(e)}}}]),i}()).\u0275fac=function(i){return new(i||dc)(S.Nb(M.d),S.Nb(D.a),S.Nb(T),S.Nb(ur),S.Nb(s.n),S.Nb(D.e),S.Nb(D.a),S.Nb(y.a))},dc.\u0275cmp=S.Hb({type:dc,selectors:[["app-clienti-conto-terzi"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(Jr,!0),S.Jc(Xr,!0),S.Jc(ic,!0)),2&i&&(S.Ac(t=S.cc())&&(e.popupRicercaClienti=t.first),S.Ac(t=S.cc())&&(e.popupCancellaCliente=t.first),S.Ac(t=S.cc())&&(e.popupAllegatiCliente=t.first))},decls:28,vars:11,consts:[[3,"chiudiPopup"],["popupRicercaClienti",""],[3,"READONLY_MODE","chiudiPopup"],["popupAllegatiCliente",""],["popupCancellaCliente",""],["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-contoterzi_black.svg"],[1,"ml-2"],[1,"fs-20"],["class","p-col-fixed w-10m p-0 py-1",4,"ngIf"],[1,"boxgrey"],[1,"p-grid"],[1,"p-col-12","align-self-center","w-100"],[3,"value"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"p-col-fixed","w-10m","p-0","py-1"],["pButton","","type","button","label","NUOVO",3,"click"],[3,"ngStyle",4,"ngIf"],[3,"ngStyle"],["pSortableColumn","denominazione",3,"ngStyle"],["field","denominazione"],["pButton","","type","button","icon","pi pi-arrow-right",1,"icon-button-rect",3,"click"],["pButton","","type","button","icon","pi pi-attachment",1,"icon-button-square",3,"click"],["src","assets/img/icons/uma-icon/icon-delete.png",3,"click"]],template:function(i,e){1&i&&(S.Tb(0,"app-popup-ricerca-clienti-contoterzi",0,1),S.bc("chiudiPopup",(function(i){return e.openAllegatiClienteCreaDialog(i)})),S.Sb(),S.Tb(2,"app-popup-allegati-clienti-contoterzi",2,3),S.bc("chiudiPopup",(function(){return e.caricaListaClienti()})),S.Sb(),S.Tb(4,"app-popup-cancella-cliente-contoterzi",0,4),S.bc("chiudiPopup",(function(i){return e.cancellaCliente(i)})),S.Sb(),S.Ob(6,"p-toast",5),S.Tb(7,"div",6),S.Tb(8,"div",7),S.Tb(9,"div",8),S.Tb(10,"div",9),S.Tb(11,"div",10),S.Tb(12,"a",11),S.bc("click",(function(){return e.goBack()})),S.Ob(13,"i",12),S.Ob(14,"img",13),S.Tb(15,"span",14),S.Tb(16,"strong",15),S.Oc(17),S.gc(18,"uppercase"),S.gc(19,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Mc(20,ec,2,0,"div",16),S.Tb(21,"div",17),S.Tb(22,"div",18),S.Tb(23,"div",19),S.Tb(24,"p-table",20),S.Mc(25,sc,11,9,"ng-template",21),S.Mc(26,bc,12,5,"ng-template",22),S.Mc(27,hc,3,1,"ng-template",23),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Bb(2),S.mc("READONLY_MODE",e.READONLY_MODE),S.Bb(4),S.Kc(S.rc(10,fc)),S.Bb(11),S.Pc(S.hc(18,6,S.hc(19,8,"UMA.DICHIARAZIONE_CONSUMI.CLIENTI_CONTOTERZI"))),S.Bb(3),S.mc("ngIf",!e.READONLY_MODE),S.Bb(4),S.mc("value",e.listaClientiContoterzi))},directives:[Pr,$r,Ur,N.a,D.h,s.t,U.q,M.e,k.b,s.w,U.p,U.o],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .icon-button-rect[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:13em!important;opacity:1}[_nghost-%COMP%]   .icon-button-rect[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .icon-button-rect[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}[_nghost-%COMP%]   .icon-button-rect[_ngcontent-%COMP%] >   span.ui-button-icon-left{font-size:2.5em}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border:1px solid #81c784;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:hover{background-color:#388e3c!important}"]}),dc),Sc=((pc=function(){function i(e,t){_classCallCheck(this,i),this.router=e,this.activeRoute=t}return _createClass(i,[{key:"ngOnInit",value:function(){this.tipoIntestazioneEnum=xt.a}},{key:"onClickTrasferimenti",value:function(){this.router.navigate(["trasferimenti"],{relativeTo:this.activeRoute.parent})}},{key:"onClickRavvedimentoOperoso",value:function(){}}]),i}()).\u0275fac=function(i){return new(i||pc)(S.Nb(D.e),S.Nb(D.a))},pc.\u0275cmp=S.Hb({type:pc,selectors:[["app-gestione-esubero-carburante"]],decls:24,vars:12,consts:[[3,"ctx"],[1,"ui-grid-fixed","mt-5"],[1,"boxgrey"],[1,"p-col","block-100"],[1,"ui-header-sezioni-uma"],[1,"auto-cursor"],[1,"p-grid","p-justify-between","m-0"],[1,"p-grid","p-align-center","m-0","p-2"],[1,"p-col","p-col-align-center"],[1,"p-grid","p-nogutter"],[1,"p-col-6","p-0","cell","border-right-0"],[1,"pl-2","p-0","py-1","cell-content",3,"click"],["src","assets/img/icons/uma-icon/icon-prelievi.svg",1,"d-inline-block","mr-3"],[1,"p-col-6","p-0","cell"],["src","assets/img/icons/uma-icon/icon-ricevuti.svg",1,"d-inline-block","mr-3"]],template:function(i,e){1&i&&(S.Ob(0,"app-intestazione-uma",0),S.Tb(1,"div",1),S.Tb(2,"div",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"a",5),S.Tb(6,"div",6),S.Tb(7,"div",7),S.Tb(8,"div",8),S.Tb(9,"strong"),S.Oc(10),S.gc(11,"uppercase"),S.gc(12,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(13,"div",9),S.Tb(14,"div",10),S.Tb(15,"div",11),S.bc("click",(function(){return e.onClickTrasferimenti()})),S.Ob(16,"img",12),S.Oc(17),S.gc(18,"translate"),S.Sb(),S.Sb(),S.Tb(19,"div",13),S.Tb(20,"div",11),S.bc("click",(function(){return e.onClickRavvedimentoOperoso()})),S.Ob(21,"img",14),S.Oc(22),S.gc(23,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.mc("ctx",null==e.tipoIntestazioneEnum?null:e.tipoIntestazioneEnum.GESTIONE_CARBURANTE_IN_ESUBERO),S.Bb(10),S.Pc(S.hc(11,4,S.hc(12,6,"UMA.GESTIONE_CARBURANTE_IN_ESUBERO"))),S.Bb(7),S.Qc(" ",S.hc(18,8,"UMA.TRASFERIMENTI")," "),S.Bb(5),S.Qc(" ",S.hc(23,10,"UMA.RAVVEDIMENTO_OPEROSO")," "))},directives:[Xt],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   .auto-cursor[_ngcontent-%COMP%]{cursor:auto}[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .cell[_ngcontent-%COMP%]{border:1px solid #cacaca;cursor:pointer}[_nghost-%COMP%]   .cell.disabled[_ngcontent-%COMP%] > .cell-content[_ngcontent-%COMP%]{opacity:.5;cursor:auto}[_nghost-%COMP%]   div.ui-header-sezioni-uma[_ngcontent-%COMP%]{background-color:#fff;border-top:2px solid #4caf50;border-left:1px solid #cacaca;border-right:1px solid #cacaca;font-size:1em}[_nghost-%COMP%]   .block-100[_ngcontent-%COMP%]{width:100%;display:block}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%]{border:2px solid #01985a;color:#01985a!important;font-weight:700}[_nghost-%COMP%]   .button-accent-alt[_ngcontent-%COMP%] >   span.ui-button-icon-right.ui-clickable.pi.pi-trash{color:#01985a!important;font-size:x-large!important}[_nghost-%COMP%]     .ui-toast-message-custom{background-color:#fff;color:#4caf50}[_nghost-%COMP%]     .ui-toast-message-custom .ui-toast-close-icon{color:#4caf50}[_nghost-%COMP%]     .ui-dialog>.ui-dialog-content>.ui-confirmdialog-message{white-space:pre-line}"]}),pc),Cc=((mc=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"trasferitiDtoToRicevutiViewModelBuilder",value:function(i){var e=[];return i&&i.length&&i.forEach((function(i){var t={};t.id=i.id,t.benzina=i.carburante.benzina,t.gasolio=i.carburante.gasolio,t.gasolioSerre=i.carburante.gasolioSerre,t.data=rr(i.data).format("DD/MM/YYYY"),t.cuaa=i.destinatario.cuaa,t.denominazione=i.destinatario.denominazione,e.push(t)})),e}}]),i}()).\u0275fac=function(i){return new(i||mc)},mc.\u0275prov=S.Jb({token:mc,factory:mc.\u0275fac,providedIn:"root"}),mc),Oc=function(){return{marginTop:"70px"}},Tc=((gc=function(){function i(e,t,o,n,a,r,c){_classCallCheck(this,i),this.indiceUmaService=e,this.location=t,this.route=o,this.httpClientDichiarazioneConsumiUmaService=n,this.httpCLientCarburanteRicevutoService=a,this.trasferitiBuilderService=r,this.errorService=c}return _createClass(i,[{key:"ngOnInit",value:function(){var i=this;this.initVariables(),this.routerSubscription=this.route.params.pipe(Object(b.a)((function(e){return i.httpClientDichiarazioneConsumiUmaService.getDichiarazioneConsumiById(e.id)})),Object(h.a)((function(e){return i.errorService.showError(e),u.a})),Object(b.a)((function(e){return i.httpCLientCarburanteRicevutoService.getCarburanteTrasferito(e.cuaa,e.campagnaRichiesta.toString())}))).subscribe((function(e){i.datasource=i.trasferitiBuilderService.trasferitiDtoToRicevutiViewModelBuilder(e.dati)}),(function(e){return i.errorService.showError(e)}))}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe()}},{key:"goBack",value:function(){this.location.back()}},{key:"initVariables",value:function(){this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.cols=this.defineColumns()}},{key:"defineColumns",value:function(){return[{field:"cuaa",header:"CUAA",sortable:!0,font:ni.e.BOLD,width:"25%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"denominazione",header:"Denominazione",sortable:!0,font:ni.e.BOLD,width:"45%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"gasolio",header:"Gasolio trasferito (lt.)",sortable:!1,width:"10%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"benzina",header:"Benzina trasferita (lt.)",sortable:!1,width:"10%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"gasolioSerre",header:"Gasolio serre trasferito (lt.)",sortable:!1,width:"10%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY}]}}]),i}()).\u0275fac=function(i){return new(i||gc)(S.Nb(T),S.Nb(s.n),S.Nb(D.a),S.Nb(Oe.a),S.Nb(ko.a),S.Nb(Cc),S.Nb(y.a))},gc.\u0275cmp=S.Hb({type:gc,selectors:[["app-trasferimenti"]],decls:19,vars:10,consts:[["key","tst"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-trasferimenti_black.svg"],[1,"ml-2"],[1,"fs-20"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"cols","values"]],template:function(i,e){1&i&&(S.Ob(0,"p-toast",0),S.Tb(1,"div",1),S.Tb(2,"div",2),S.Tb(3,"div",3),S.Tb(4,"div",4),S.Tb(5,"div",5),S.Tb(6,"div",6),S.Tb(7,"a",7),S.bc("click",(function(){return e.goBack()})),S.Ob(8,"i",8),S.Ob(9,"img",9),S.Tb(10,"span",10),S.Tb(11,"strong",11),S.Oc(12),S.gc(13,"uppercase"),S.gc(14,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(15,"div",12),S.Tb(16,"div",13),S.Tb(17,"div",14),S.Ob(18,"app-a4g-multi-table",15),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Kc(S.rc(9,Oc)),S.Bb(12),S.Pc(S.hc(13,5,S.hc(14,7,"UMA.DICHIARAZIONE_CONSUMI.TRASFERIMENTI"))),S.Bb(6),S.mc("cols",e.cols)("values",e.datasource))},directives:[N.a,D.h,hi.a],pipes:[s.G,mi.d],styles:[""]}),gc),Ic=["dialog"],zc=["table"];function Ac(i,e){1&i&&S.Ob(0,"p-message",14)}function Ec(i,e){if(1&i&&(S.Tb(0,"div"),S.Tb(1,"div"),S.Mc(2,Ac,1,0,"p-message",13),S.Sb(),S.Sb()),2&i){var t=S.fc();S.Bb(2),S.mc("ngIf",null==t.searchForm.get("idRichiestaDestinatario").errors?null:t.searchForm.get("idRichiestaDestinatario").errors.pattern)}}var yc=function(){return{width:"20%"}},Rc=function(){return{width:"70%"}},Dc=function(){return{width:"10%","text-align":"center"}};function Mc(i,e){1&i&&(S.Tb(0,"tr"),S.Tb(1,"th",21),S.Oc(2,"CUAA"),S.Sb(),S.Tb(3,"th",21),S.Oc(4,"DENOMINAZIONE"),S.Sb(),S.Tb(5,"th",21),S.Oc(6,"AZIONI"),S.Sb(),S.Sb()),2&i&&(S.Bb(1),S.mc("ngStyle",S.rc(3,yc)),S.Bb(2),S.mc("ngStyle",S.rc(4,Rc)),S.Bb(2),S.mc("ngStyle",S.rc(5,Dc)))}function Nc(i,e){if(1&i){var t=S.Ub();S.Tb(0,"tr"),S.Tb(1,"td",21),S.Oc(2),S.Sb(),S.Tb(3,"td",21),S.Oc(4),S.gc(5,"uppercase"),S.Sb(),S.Tb(6,"td",21),S.Tb(7,"button",22),S.bc("click",(function(){S.Ec(t);var i=e.$implicit;return S.fc(2).onClickButton("AGGIUNGI",i.cuaa,i.denominazione)})),S.Sb(),S.Sb(),S.Sb()}if(2&i){var o=e.$implicit;S.Bb(1),S.mc("ngStyle",S.rc(7,yc)),S.Bb(1),S.Pc(o.cuaa),S.Bb(1),S.mc("ngStyle",S.rc(8,Rc)),S.Bb(1),S.Pc(S.hc(5,5,o.denominazione)),S.Bb(2),S.mc("ngStyle",S.rc(9,Dc))}}function _c(i,e){1&i&&(S.Tb(0,"tr"),S.Tb(1,"td"),S.Oc(2,"Nessun azienda trovato."),S.Sb(),S.Sb()),2&i&&(S.Bb(1),S.Cb("colspan",4))}function Bc(i,e){if(1&i){var t=S.Ub();S.Tb(0,"div",15),S.Tb(1,"p-table",16,17),S.bc("onLazyLoad",(function(i){S.Ec(t);var e=S.fc();return e.changePage(i,e.idRichiesta)})),S.Mc(3,Mc,7,6,"ng-template",18),S.Mc(4,Nc,8,10,"ng-template",19),S.Mc(5,_c,3,1,"ng-template",20),S.Sb(),S.Sb()}if(2&i){var o=S.fc();S.Bb(1),S.mc("autoLayout",!0)("value",o.datasource)("rows",1)("scrollable",!1)("resetPageOnSort",!1)("first",o.first)("totalRecords",o.totalElements)("lazy",!0)}}var kc,Fc,Pc,wc,xc,Lc,Gc,Uc,Vc,Hc=function(){return{overflow:"auto"}},Zc=function(){return{marginTop:"70px"}},jc=((kc=function(){function i(e,t,o,n){_classCallCheck(this,i),this.trasferimentiService=e,this.errorService=t,this.formService=o,this.messageService=n,this.chiudiPopup=new S.n}return _createClass(i,[{key:"ngOnInit",value:function(){this.searchForm=new H.j({idRichiestaDestinatario:new H.g(null)})}},{key:"ngOnDestroy",value:function(){this.validaSubscription&&this.validaSubscription.unsubscribe()}},{key:"open",value:function(i){this.display=!0,this.searchForm.get("idRichiestaDestinatario").setValue(null),this.datasource=null,this.idRichiestaMittente=i}},{key:"onHideDialog",value:function(){}},{key:"chiudiDialog",value:function(i){this.display=!1,this.datasource=null,this.dialogElement._style.width="unset"}},{key:"onClickButton",value:function(i,e,t){switch(i){case"CERCA":this.cercaRichiesta(this.searchForm.get("idRichiestaDestinatario").value);break;case"AGGIUNGI":this.addTrasferimento(this.searchForm.get("idRichiestaDestinatario").value,e,t)}}},{key:"cercaRichiesta",value:function(i){var e=this;this.formService.validateForm(this.searchForm),this.searchForm.valid?this.validaSubscription=this.trasferimentiService.validaTrasferimento(this.idRichiestaMittente,i).subscribe((function(i){e.dialogElement._style.width="80vw",e.datasource=[],e.datasource.push(i),e.totalElements=1}),(function(i){i&&i.error&&i.error.message&&i.error.message.startsWith("Non \xe8 possibile modificare")?e.errorService.showErrorWithMessage(O.a.aziendaDestinatariaTrasferimentoKO,"tst-ricerca-richiesta-carburante"):e.errorService.showError(i,"tst-ricerca-richiesta-carburante")})):this.messageService.add(m.a.getToast("tst-ricerca-richiesta-carburante",m.b.error,O.a.datiNotCorretti))}},{key:"addTrasferimento",value:function(i,e,t){this.chiudiDialog(),this.chiudiPopup.emit({idDestinatario:i,cuaa:e,denominazione:t,modalitaCrea:!0})}},{key:"changePage",value:function(i){}},{key:"reset",value:function(){this.table&&this.table.reset()}}]),i}()).\u0275fac=function(i){return new(i||kc)(S.Nb(ko.a),S.Nb(y.a),S.Nb(Ce.a),S.Nb(M.d))},kc.\u0275cmp=S.Hb({type:kc,selectors:[["app-popup-ricerca-richiesta-carburante"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(Ic,!0),S.Uc(zc,!0)),2&i&&(S.Ac(t=S.cc())&&(e.dialogElement=t.first),S.Ac(t=S.cc())&&(e.table=t.first))},outputs:{chiudiPopup:"chiudiPopup"},decls:18,vars:22,consts:[["id","popup-ricerca-richiesta-carburante","position","center",3,"visible","focusOnShow","modal","closable","closeOnEscape","blockScroll","dismissableMask","contentStyle","header","visibleChange","onHide"],["dialog",""],["key","tst-ricerca-richiesta-carburante"],["novalidate","",1,"p-grid",3,"formGroup","ngSubmit"],[1,"p-col"],[1,"p-grid"],[1,"ui-inputgroup"],["type","text","placeholder","Inserire ID Richiesta di carburante","id","idRichiesta","pattern","^([0-9])+$","formControlName","idRichiestaDestinatario","size","60",3,"maxlength"],["richiestaRef",""],["pButton","","type","submit","icon","pi pi-search",1,"icon-button-square",3,"disabled"],[4,"ngIf"],["class","p-col boxgrey",4,"ngIf"],["pButton","","type","button","label","Chiudi",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","shadow-none","font-weight-normal",3,"click"],["class","font-12 extended","severity","error","text","Formato non valido",4,"ngIf"],["severity","error","text","Formato non valido",1,"font-12","extended"],[1,"p-col","boxgrey"],[3,"autoLayout","value","rows","scrollable","resetPageOnSort","first","totalRecords","lazy","onLazyLoad"],["table",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"ngStyle"],["pButton","","icon","pi pi-plus",1,"icon-button-square",3,"click"]],template:function(i,e){if(1&i&&(S.Tb(0,"p-dialog",0,1),S.bc("visibleChange",(function(i){return e.display=i}))("onHide",(function(){return e.onHideDialog()})),S.gc(2,"uppercase"),S.gc(3,"translate"),S.Ob(4,"p-toast",2),S.Tb(5,"form",3),S.bc("ngSubmit",(function(){return e.onClickButton("CERCA","","")})),S.Tb(6,"div",4),S.Tb(7,"div",5),S.Tb(8,"div",4),S.Tb(9,"div",6),S.Ob(10,"input",7,8),S.Ob(12,"button",9),S.Sb(),S.Mc(13,Ec,3,1,"div",10),S.Sb(),S.Sb(),S.Mc(14,Bc,6,8,"div",11),S.Tb(15,"div",5),S.Tb(16,"div",4),S.Tb(17,"button",12),S.bc("click",(function(i){return e.chiudiDialog(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i){var t=S.Bc(11);S.nc("header",S.hc(2,16,S.hc(3,18,"UMA.DICHIARAZIONE_CONSUMI.DESTINATARIO_TRASFERIMENTO"))),S.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("blockScroll",!0)("dismissableMask",!0)("contentStyle",S.rc(20,Hc)),S.Bb(4),S.Kc(S.rc(21,Zc)),S.Bb(1),S.mc("formGroup",e.searchForm),S.Bb(5),S.mc("maxlength",19),S.Bb(2),S.mc("disabled",(null==t.value?null:t.value.length)<3),S.Bb(1),S.mc("ngIf",e.searchForm.get("idRichiestaDestinatario").invalid&&(e.searchForm.get("idRichiestaDestinatario").dirty||e.searchForm.get("idRichiestaDestinatario").touched)),S.Bb(1),S.mc("ngIf",e.datasource)}},directives:[So.a,N.a,H.I,H.t,H.k,H.c,H.z,H.s,H.i,H.n,k.b,s.t,Ee.b,U.q,M.e,s.w],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   th[_ngcontent-%COMP%]{color:#000}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:27em;max-height:27em;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]     .ui-widget-header{border:unset!important}[_nghost-%COMP%]     p-message.extended .ui-message.ui-message-error{width:33em;margin:0}"]}),kc),Yc=["dialog"],qc=function(){return{overflow:"auto"}},Qc=function(){return{marginTop:"70px"}},Kc=((Fc=function(){function i(e,t,o,n){_classCallCheck(this,i),this.formatConverterService=e,this.errorService=t,this.trasferimentiService=o,this.messageService=n,this.chiudiPopup=new S.n}return _createClass(i,[{key:"ngOnInit",value:function(){this.cols=this.defineColumns()}},{key:"ngOnDestroy",value:function(){this.postTrasferimentoSub&&this.postTrasferimentoSub.unsubscribe(),this.putTrasferimento&&this.putTrasferimento.unsubscribe()}},{key:"open",value:function(i){this.isValidFormTable=!0,this.display=!0,this.modalitaCrea=i.modalitaCrea,this.dichiarazioneConsumi=i.dichiarazioneConsumi,this.cuaa=i.cuaa,this.denominazione=i.denominazione,this.idMittente=i.idMittente,this.idDestinatario=i.idDestinatario,this.modalitaCrea?this.buildDataSource(i.trasferibile):(this.idTrasferimento=i.idTrasferimento,this.buildDataSource(i.trasferibile,i.trasferimento))}},{key:"salva",value:function(i){var e=this,t=this.datasource.filter((function(i){return"Benzina"==i.carburante}))[0],o=this.datasource.filter((function(i){return"Gasolio"==i.carburante}))[0],n=this.datasource.filter((function(i){return"Gasolio Serre"==i.carburante}))[0];if(0!=this.formatConverterService.toNumber(t.trasferito)||0!=this.formatConverterService.toNumber(o.trasferito)||0!=this.formatConverterService.toNumber(n.trasferito))if(this.formatConverterService.toNumber(o.trasferibile)<this.formatConverterService.toNumber(o.trasferito))this.errorService.showErrorWithMessage(O.a.trasferimentoGasolioLtError,"tst-dialog");else if(this.formatConverterService.toNumber(t.trasferibile)<this.formatConverterService.toNumber(t.trasferito))this.errorService.showErrorWithMessage(O.a.trasferimentoBenzinaLtError,"tst-dialog");else if(this.formatConverterService.toNumber(n.trasferibile)<this.formatConverterService.toNumber(n.trasferito))this.errorService.showErrorWithMessage(O.a.trasferimentoGasolioSerreLtError,"tst-dialog");else if(this.modalitaCrea)this.postTrasferimentoSub=this.trasferimentiService.postTrasferimento(this.idMittente,this.idDestinatario,{gasolio:o.trasferito?o.trasferito:0,benzina:t.trasferito?t.trasferito:0,gasolioSerre:n.trasferito?n.trasferito:0}).subscribe((function(i){console.log("Salvataggio effettuato correttamente!"),e.chiudiPopup.emit(!0),e.display=!1}),(function(i){return e.errorService.showError(i,"tst-dialog")}));else{if(this.dichiarazioneConsumi&&this.dichiarazioneConsumi.stato===Ie.a.PROTOCOLLATA)return void this.errorService.showErrorWithMessage(O.a.modificaTrasferimentoKO,"tst-dialog");this.putTrasferimento=this.trasferimentiService.putTrasferimento(this.idTrasferimento,{gasolio:this.formatConverterService.toNumber(o.trasferito?o.trasferito:0),benzina:this.formatConverterService.toNumber(t.trasferito?t.trasferito:0),gasolioSerre:this.formatConverterService.toNumber(n.trasferito?n.trasferito:0)}).subscribe((function(i){console.log("Aggiornamento effettuato correttamente!"),e.chiudiPopup.emit(!0),e.display=!1}),(function(i){return e.errorService.showError(i,"tst-dialog")}))}else this.errorService.showErrorWithMessage(O.a.trasferimentoObbligatorio,"tst-dialog")}},{key:"onChangeForm",value:function(i){this.isChangedInputTable=i.isChanged,this.isValidFormTable=i.isValid}},{key:"buildDataSource",value:function(i,e){this.datasource=[{carburante:"Gasolio",trasferibile:(i||{}).gasolio||Number("0"),trasferito:e?e.gasolio:null},{carburante:"Benzina",trasferibile:(i||{}).benzina||Number("0"),trasferito:e?e.benzina:null},{carburante:"Gasolio Serre",trasferibile:(i||{}).gasolioSerre||Number("0"),trasferito:e?e.gasolioSerre:null}]}},{key:"defineColumns",value:function(){return[{field:"carburante",header:"Carburante",sortable:!1,disabled:!1,width:"44%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"trasferibile",header:"Quantit\xe0 Trasferibile",sortable:!1,width:"18%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"trasferito",header:"Quantit\xe0 Trasferita",sortable:!1,width:"18%",inputOpts:{pattern:"^([0-9])+$",maxLength:"7"},alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,type:ni.d.INPUT_NUMBER}]}},{key:"annulla",value:function(){this.display=!1}}]),i}()).\u0275fac=function(i){return new(i||Fc)(S.Nb(ki.a),S.Nb(y.a),S.Nb(ko.a),S.Nb(M.d))},Fc.\u0275cmp=S.Hb({type:Fc,selectors:[["app-popup-inserisci-edita-trasferimento"]],viewQuery:function(i,e){var t;1&i&&S.Jc(Yc,!0,S.l),2&i&&S.Ac(t=S.cc())&&(e.dialogElement=t.first)},inputs:{READONLY_MODE:"READONLY_MODE"},outputs:{chiudiPopup:"chiudiPopup"},decls:21,vars:21,consts:[["id","popup-visualizza-richiesta-carburante","position","center",3,"visible","focusOnShow","modal","closable","closeOnEscape","blockScroll","contentStyle","header","dismissableMask","visibleChange"],["dialog",""],["key","tst-dialog",3,"baseZIndex"],[1,"p-grid","m-0"],[1,"p-col"],[1,"p-grid","p-align-center"],[3,"cols","values","changedValueForm"],[1,"p-grid","p-justify-end"],["pButton","","type","button","label","Annulla",1,"ui-button-secondary","ui-button-text-only","p-1","text-lowercase","font-weight-normal","shadow-none","w-5m",3,"click"],["pButton","","type","button","label","Salva",1,"ui-button-text-only","p-1","text-uppercase","font-weight-normal","shadow-none","w-5m",3,"disabled","click"]],template:function(i,e){1&i&&(S.Tb(0,"p-dialog",0,1),S.bc("visibleChange",(function(i){return e.display=i})),S.gc(2,"translate"),S.Ob(3,"p-toast",2),S.Tb(4,"div",3),S.Tb(5,"div",4),S.Tb(6,"div",5),S.Oc(7),S.Ob(8,"br"),S.Oc(9),S.Ob(10,"br"),S.Ob(11,"br"),S.Sb(),S.Sb(),S.Sb(),S.Tb(12,"div",5),S.Tb(13,"div",4),S.Tb(14,"app-a4g-multi-table",6),S.bc("changedValueForm",(function(i){return e.onChangeForm(i)})),S.Sb(),S.Sb(),S.Sb(),S.Ob(15,"br"),S.Tb(16,"div",7),S.Tb(17,"div"),S.Tb(18,"button",8),S.bc("click",(function(){return e.annulla()})),S.Sb(),S.Sb(),S.Tb(19,"div"),S.Tb(20,"button",9),S.bc("click",(function(i){return e.salva(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.nc("header",S.hc(2,17,"UMA.DICHIARAZIONE_CONSUMI.TRASFERIMENTO_CARBURANTE")),S.mc("visible",e.display)("focusOnShow",!1)("modal",!0)("closable",!1)("closeOnEscape",!0)("blockScroll",!0)("contentStyle",S.rc(19,qc))("dismissableMask",!0),S.Bb(3),S.Kc(S.rc(20,Qc)),S.mc("baseZIndex",9999),S.Bb(4),S.Qc(" CUAA: ",e.cuaa," "),S.Bb(2),S.Qc(" DENOMINAZIONE: ",e.denominazione," "),S.Bb(5),S.mc("cols",e.cols)("values",e.datasource),S.Bb(6),S.mc("disabled",e.READONLY_MODE))},directives:[So.a,N.a,hi.a,k.b],pipes:[mi.d],styles:["[_nghost-%COMP%]   .w-5m[_ngcontent-%COMP%]{width:5em}[_nghost-%COMP%]   .table-container[_ngcontent-%COMP%]{height:450px;max-height:450px;overflow:auto}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]{background-color:#4caf50!important;border-radius:unset;height:5em!important;width:5em!important;opacity:1}[_nghost-%COMP%]   .icon-button-square[_ngcontent-%COMP%]:disabled{opacity:.35;background-image:none;cursor:auto!important}[_nghost-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{cursor:pointer}"]}),Fc),Wc=["popupRicercaRichiesta"],$c=["popupInserisciEditaTrasferimento"],Jc=function(){return{marginTop:"70px"}},Xc=[{path:"",component:Et,data:{mybreadcrumb:""},children:[{path:"richiedente/:tipoRichiesta",component:wt,data:{mybreadcrumb:Gt.a.BREADCRUMB.richiedente}},{path:"richiesta/:idDomanda",component:io,children:[{path:"",redirectTo:"indice"},{path:"indice",component:zt,data:{mybreadcrumb:Gt.a.BREADCRUMB.gestione_domanda}}]},{path:"dichiarazione-consumi/:id",component:eo,children:[{path:"",redirectTo:"sezioni"},{path:"sezioni",component:uo,data:{mybreadcrumb:Gt.a.BREADCRUMB.gestione_dichiarazione_consumi}},{path:"prelievi",component:mo,data:{mybreadcrumb:Gt.a.BREADCRUMB.prelievi}},{path:"clienti-contoterzi",component:At,data:{mybreadcrumb:""},children:[{path:"",redirectTo:"lista"},{path:"lista",component:vc,data:{mybreadcrumb:Gt.a.BREADCRUMB.clientiContoTerzi}},{path:":idCliente",component:Or,data:{mybreadcrumb:Gt.a.BREADCRUMB.clientiContoTerziDettaglio}}]},{path:"ricevuti",component:lr,data:{mybreadcrumb:Gt.a.BREADCRUMB.ricevuti}},{path:"consumi",component:ar,data:{mybreadcrumb:Gt.a.BREADCRUMB.consumi}},{path:"trasferimenti",component:Tc,data:{mybreadcrumb:Gt.a.BREADCRUMB.trasferimenti}}]},{path:"esubero-carburante/:idDomanda",children:[{path:"",redirectTo:"sezioni"},{path:"sezioni",component:Sc,data:{mybreadcrumb:Gt.a.BREADCRUMB.esubero_carburante}},{path:"trasferimenti",component:(Pc=function(){function i(e,t,o,n,a,r,c,s,l,u){_classCallCheck(this,i),this.indiceUmaService=e,this.location=t,this.route=o,this.httpCLientCarburanteRicevutoService=n,this.httpClientDomandaUmaService=a,this.httpClientDichiarazioneConsumiUmaService=r,this.trasferitiBuilderService=c,this.confirmationService=s,this.messageService=l,this.errorService=u}return _createClass(i,[{key:"ngOnInit",value:function(){this.initVariables(),this.caricaDatiTrasferimenti(!1)}},{key:"ngOnDestroy",value:function(){this.routerSubscription&&this.routerSubscription.unsubscribe(),this.deleteSubscription&&this.deleteSubscription.unsubscribe()}},{key:"initVariables",value:function(){this.tipoIntestazioneEnum=xt.a,this.READONLY_MODE=this.indiceUmaService.READONLY_MODE_DICHIARAZIONE||"true"==localStorage.getItem("UMA_RO_DICH"),this.cols=this.defineColumns()}},{key:"goBack",value:function(){this.location.back()}},{key:"caricaDatiTrasferimenti",value:function(i){var e=this;i&&this.confirmationService.confirm({message:O.a.saveTrasferimentoCarburanteWarn,rejectVisible:!1,accept:function(){},reject:function(){},key:"trasferimenti-dialog-save"}),this.routerSubscription=this.route.params.pipe(Object(b.a)((function(i){return e.idRichiesta=i.idDomanda,e.httpClientDomandaUmaService.getDomandaById(i.idDomanda)})),Object(h.a)((function(i){return e.errorService.showError(i),u.a})),Object(b.a)((function(i){return e.richiestaMittente=i,e.httpCLientCarburanteRicevutoService.getCarburanteTrasferito(i.cuaa,i.campagna.toString())})),Object(h.a)((function(i){return e.errorService.showError(i),u.a})),Object(b.a)((function(i){return e.datasource=e.trasferitiBuilderService.trasferitiDtoToRicevutiViewModelBuilder(i.dati),i&&i.dati.length?e.httpClientDichiarazioneConsumiUmaService.getDichiarazioniConsumi({cuaa:i.dati[0].destinatario.cuaa,campagna:[e.richiestaMittente.campagna.toString()],numeroElementiPagina:1,pagina:0}):u.a}))).subscribe((function(i){i&&i.length&&(e.dichiarazioneConsumi=i[0])}),(function(i){return e.errorService.showError(i)}))}},{key:"onClickIcon",value:function(i){"elimina"===i.col.buttonOpts.id?this.deleteTrasferimento(i.element):"modifica"===i.col.buttonOpts.id&&this.editTrasferimento(i.element)}},{key:"editTrasferimento",value:function(i){this.openInserisciEditaTrasferimentoPopup({trasferimento:i,modalitaCrea:!1})}},{key:"deleteTrasferimento",value:function(i){var e=this;this.confirmationService.confirm({message:O.a.confermaCancellazioneTrasferimento,accept:function(){e.cancellaDaID(i)},reject:function(){},key:"trasferimenti-dialog"})}},{key:"nuovoTrasferimento",value:function(){this.datasource.length>0?this.messageService.add(m.a.getToast("tst-trasferimenti",m.b.warn,O.a.erroreTrasferimentoPresente)):this.popupRicercaRichiesta.open(this.richiestaMittente.id.toString())}},{key:"openInserisciEditaTrasferimentoPopup",value:function(i){var e=this,t=this.httpClientDichiarazioneConsumiUmaService.getResiduoAnnoPrecedente(this.richiestaMittente.cuaa,this.richiestaMittente.campagna-1,[Ie.a.PROTOCOLLATA]),o=this.httpClientDomandaUmaService.getPrelieviByCuaaAndCampagna(this.richiestaMittente.cuaa,this.richiestaMittente.campagna.toString());Object(si.a)([t,o]).subscribe((function(t){var o=_slicedToArray(t,2),n=o[0],a=o[1],r=new Te.a;if(r.gasolio=(n&&n[0]?n[0].rimanenza.gasolio:0)+a.totale.gasolio,r.benzina=(n&&n[0]?n[0].rimanenza.benzina:0)+a.totale.benzina,r.gasolioSerre=(n&&n[0]?n[0].rimanenza.gasolioSerre:0)+a.totale.gasolioSerre,i.modalitaCrea)e.popupInserisciEditaTrasferimento.open({trasferibile:r,idMittente:e.idRichiesta,idDestinatario:i.idDestinatario.toString(),cuaa:i.cuaa,denominazione:i.denominazione,modalitaCrea:!0});else{var c=new Te.a;c.gasolio=i.trasferimento.gasolio,c.benzina=i.trasferimento.benzina,c.gasolioSerre=i.trasferimento.gasolioSerre,e.popupInserisciEditaTrasferimento.open({trasferibile:r,idTrasferimento:i.trasferimento.id.toString(),trasferimento:c,cuaa:i.trasferimento.cuaa,denominazione:i.trasferimento.denominazione,modalitaCrea:!1,dichiarazioneConsumi:e.dichiarazioneConsumi})}}))}},{key:"cancellaDaID",value:function(i){var e=this;this.dichiarazioneConsumi&&this.dichiarazioneConsumi.stato===Ie.a.PROTOCOLLATA?this.errorService.showErrorWithMessage(O.a.cancellazioneTrasferimentoKO,"tst-trasferimenti"):this.deleteSubscription=this.httpCLientCarburanteRicevutoService.deleteTraseferito(i.id.toString()).subscribe((function(){e.messageService.add(m.a.getToast("tst-trasferimenti",m.b.success,O.a.cancellazioneTrasferimentoOK)),e.caricaDatiTrasferimenti(!1)}),(function(i){return e.errorService.showError(i,"tst-trasferimenti")}))}},{key:"onChangeForm",value:function(i){}},{key:"defineColumns",value:function(){return[{field:"",header:"",sortable:!1,width:"5%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,buttonOpts:{id:"elimina",icon:"pi pi-times-circle",hiddenBy:"isConsegnato"},type:ni.d.ICON_BUTTON_CIRCLE},{field:"cuaa",header:"CUAA",sortable:!1,font:ni.e.BOLD,width:"23%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"denominazione",header:"Denominazione",sortable:!1,font:ni.e.BOLD,width:"43%",alignCellHorizontal:ni.c.LEFT,alignHeader:ni.c.LEFT,type:ni.d.READONLY},{field:"gasolio",header:"Gasolio trasferito (lt.)",sortable:!1,width:"8%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"benzina",header:"Benzina trasferita (lt.)",sortable:!1,width:"8%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"gasolioSerre",header:"Gasolio serre trasferito (lt.)",sortable:!1,width:"8%",alignCellHorizontal:ni.c.RIGHT,alignHeader:ni.c.CENTER,type:ni.d.READONLY},{field:"",header:"",sortable:!1,width:"5%",alignCellHorizontal:ni.c.CENTER,alignHeader:ni.c.CENTER,buttonOpts:{id:"modifica",icon:"pi pi-pencil"},type:ni.d.ICON_BUTTON_SQUARE}]}}]),i}(),Pc.\u0275fac=function(i){return new(i||Pc)(S.Nb(T),S.Nb(s.n),S.Nb(D.a),S.Nb(ko.a),S.Nb(g.a),S.Nb(Oe.a),S.Nb(Cc),S.Nb(M.a),S.Nb(M.d),S.Nb(y.a))},Pc.\u0275cmp=S.Hb({type:Pc,selectors:[["app-gestione-trasferimenti"]],viewQuery:function(i,e){var t;1&i&&(S.Jc(Wc,!0),S.Jc($c,!0)),2&i&&(S.Ac(t=S.cc())&&(e.popupRicercaRichiesta=t.first),S.Ac(t=S.cc())&&(e.popupInserisciEditaTrasferimento=t.first))},decls:28,vars:12,consts:[[3,"chiudiPopup"],["popupRicercaRichiesta",""],[3,"READONLY_MODE","chiudiPopup"],["popupInserisciEditaTrasferimento",""],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","trasferimenti-dialog","acceptLabel","SI","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25",1,"ui-dialog-visible"],["header","Attenzione","icon","pi pi-exclamation-triangle","acceptIcon","","rejectIcon","","key","trasferimenti-dialog-save","acceptLabel","OK","rejectLabel","NO","acceptButtonStyleClass","m-1 w-25","rejectButtonStyleClass","m-1 w-25"],["key","tst-trasferimenti"],[3,"ctx"],[1,"ui-g","ui-fluid","mt-5"],[1,"ui-grid-fixed","mt-2"],[1,"ui-g"],[1,"p-col"],[1,"p-grid","p-align-center"],[1,"p-col","py-3"],[1,"d-flex","align-items-center","text-decoration-none","color-primary",3,"routerLink","click"],[1,"pi","pi-chevron-left",2,"font-size","2rem","color","black"],["src","assets/img/icons/uma-icon/icon-trasferimenti_black.svg"],[1,"ml-2"],[1,"fs-20"],[1,"p-col-fixed","w-10m","p-0","py-1"],["pButton","","type","button","label","NUOVO",3,"click"],[1,"p-grid"],[1,"boxgrey"],[1,"p-col-12","align-self-center","w-100"],[3,"cols","values","changedValueForm","clickIcon"]],template:function(i,e){1&i&&(S.Tb(0,"app-popup-ricerca-richiesta-carburante",0,1),S.bc("chiudiPopup",(function(i){return e.openInserisciEditaTrasferimentoPopup(i)})),S.Sb(),S.Tb(2,"app-popup-inserisci-edita-trasferimento",2,3),S.bc("chiudiPopup",(function(i){return e.caricaDatiTrasferimenti(i)})),S.Sb(),S.Ob(4,"p-confirmDialog",4),S.Ob(5,"p-confirmDialog",5),S.Ob(6,"p-toast",6),S.Ob(7,"app-intestazione-uma",7),S.Tb(8,"div",8),S.Tb(9,"div",9),S.Tb(10,"div",10),S.Tb(11,"div",11),S.Tb(12,"div",12),S.Tb(13,"div",13),S.Tb(14,"a",14),S.bc("click",(function(){return e.goBack()})),S.Ob(15,"i",15),S.Ob(16,"img",16),S.Tb(17,"span",17),S.Tb(18,"strong",18),S.Oc(19),S.gc(20,"uppercase"),S.gc(21,"translate"),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Tb(22,"div",19),S.Tb(23,"button",20),S.bc("click",(function(){return e.nuovoTrasferimento()})),S.Sb(),S.Sb(),S.Tb(24,"div",21),S.Tb(25,"div",22),S.Tb(26,"div",23),S.Tb(27,"app-a4g-multi-table",24),S.bc("changedValueForm",(function(i){return e.onChangeForm(i)}))("clickIcon",(function(i){return e.onClickIcon(i)})),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb(),S.Sb()),2&i&&(S.Bb(2),S.mc("READONLY_MODE",e.READONLY_MODE),S.Bb(4),S.Kc(S.rc(11,Jc)),S.Bb(1),S.mc("ctx",null==e.tipoIntestazioneEnum?null:e.tipoIntestazioneEnum.GESTIONE_CARBURANTE_IN_ESUBERO),S.Bb(12),S.Pc(S.hc(20,7,S.hc(21,9,"UMA.DICHIARAZIONE_CONSUMI.TRASFERIMENTI"))),S.Bb(8),S.mc("cols",e.cols)("values",e.datasource))},directives:[jc,Kc,_.a,N.a,Xt,D.h,k.b,hi.a],pipes:[s.G,mi.d],styles:["[_nghost-%COMP%]   .w-10m[_ngcontent-%COMP%]{width:10em}[_nghost-%COMP%]   .w-90[_ngcontent-%COMP%]{width:90%}[_nghost-%COMP%]   .accordion-icon[_ngcontent-%COMP%]{float:right}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%], [_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{display:flex;justify-content:center;align-items:center}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div{flex:1 1 auto;flex-wrap:wrap;flex-direction:column;position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:auto;background-color:rgba(88,87,92,.8);opacity:1}[_nghost-%COMP%]   .ui-dialog-visible[_ngcontent-%COMP%] >   div>  div.ui-confirmdialog{top:0;left:0}"]}),Pc),data:{mybreadcrumb:Gt.a.BREADCRUMB.trasferimenti}}]}]}],is=((wc=function i(){_classCallCheck(this,i)}).\u0275mod=S.Lb({type:wc}),wc.\u0275inj=S.Kb({factory:function(i){return new(i||wc)},imports:[[D.i.forChild(Xc)]]}),wc),es=t("1IWC"),ts=t.n(es),os=t("R69K"),ns=[s.c],as=[],rs=[tt,Se.a,ki.a],cs=((Lc=function i(){_classCallCheck(this,i)}).\u0275mod=S.Lb({type:Lc}),Lc.\u0275inj=S.Kb({factory:function(i){return new(i||Lc)},providers:[].concat(rs,as),imports:[[].concat(ns),s.c]}),Lc),ss=((xc=function(){function i(){_classCallCheck(this,i)}return _createClass(i,[{key:"openPanel",value:function(i){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i.show(e,t)}}]),i}()).\u0275fac=function(i){return new(i||xc)},xc.\u0275prov=S.Jb({token:xc,factory:xc.\u0275fac,providedIn:"root"}),xc),ls=t("DYNa"),us=function(i){return i.success="success",i.info="info",i.warn="warn",i.error="error",i}({}),bs=((Gc=function(){function i(e,t,o){_classCallCheck(this,i),this.messageService=e,this.renderer=t,this.el=o}return _createClass(i,[{key:"openFromComponent",value:function(i,e){this.addSingle(e)}},{key:"addSingle",value:function(i){i=this.setSummary(i),this.messageService.add({severity:i.severity,summary:i.summary,detail:i.detail})}},{key:"addMultiple",value:function(i){this.messageService.addAll(i)}},{key:"clear",value:function(i){this.messageService.clear(i)}},{key:"setSummary",value:function(i){switch(i.severity){case us.error:i.summary="Errore!";break;case us.info:i.summary="Informazione";break;case us.success:i.summary="Avviso!";break;case us.warn:i.summary="Attenzione!";break;default:i.summary="Informazione"}return i}}]),i}()).\u0275fac=function(i){return new(i||Gc)(S.Xb(M.d),S.Xb(S.E),S.Xb(S.l))},Gc.\u0275prov=S.Jb({token:Gc,factory:Gc.\u0275fac,providedIn:"root"}),Gc),hs=t("fLRn"),ms=t("b53x"),ps=t("PMPK"),ds=[s.c,cs,os.a],gs=[],fs=[E,T,v.a,g.a,C,G,ls.a,ss,Xe.a,li,Oe.a,bs,ur,ko.a,ui,Fi,bo.a,cr,Cc,nn,hs.a,ms.a,ps.a],vs=((Uc=function i(){_classCallCheck(this,i)}).\u0275mod=S.Lb({type:Uc}),Uc.\u0275inj=S.Kb({factory:function(i){return new(i||Uc)},providers:[].concat(fs,gs),imports:[[].concat(ds),s.c,cs,os.a]}),Uc),Ss=[s.c,os.a,is,vs],Cs=[],Os=[],Ts=((Vc=function i(){_classCallCheck(this,i),Object(s.K)(ts.a,"it")}).\u0275mod=S.Lb({type:Vc}),Vc.\u0275inj=S.Kb({factory:function(i){return new(i||Vc)},providers:[].concat(Os,Cs),imports:[[].concat(Ss),s.c,os.a,is,vs]}),Vc)},"2qMH":function(i,e,t){"use strict";var o=t("Q1FS"),n=t("zB/H");e.scheduleArray=function(i,e){return new o.Observable((function(t){var o=new n.Subscription,a=0;return o.add(e.schedule((function(){a!==i.length?(t.next(i[a++]),t.closed||o.add(this.schedule())):t.complete()}))),o}))}},"6aLS":function(i,e,t){"use strict";var o,n=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])})(i,e)},function(i,e){function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),a=t("q3Kh"),r=t("gTqA"),c=t("wjEo");e.switchMap=function i(e,t){return"function"==typeof t?function(o){return o.pipe(i((function(i,o){return r.from(e(i,o)).pipe(a.map((function(e,n){return t(i,e,o,n)})))})))}:function(i){return i.lift(new s(e))}};var s=function(){function i(i){this.project=i}return i.prototype.call=function(i,e){return e.subscribe(new l(i,this.project))},i}(),l=function(i){function e(e,t){var o=i.call(this,e)||this;return o.project=t,o.index=0,o}return n(e,i),e.prototype._next=function(i){var e,t=this.index++;try{e=this.project(i,t)}catch(o){return void this.destination.error(o)}this._innerSub(e)},e.prototype._innerSub=function(i){var e=this.innerSubscription;e&&e.unsubscribe();var t=new c.SimpleInnerSubscriber(this),o=this.destination;o.add(t),this.innerSubscription=c.innerSubscribe(i,t),this.innerSubscription!==t&&o.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||i.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&i.prototype._complete.call(this)},e.prototype.notifyNext=function(i){this.destination.next(i)},e}(c.SimpleOuterSubscriber)},"6qA3":function(i,e,t){"use strict";var o=t("OAkW"),n=t("Z5tI"),a=t("poJ0"),r=t("ozli"),c=t("yRPT"),s=t("90cg"),l=t("GMZp"),u=t("VKeD"),b=t("zfKp");e.subscribeTo=function(i){if(i&&"function"==typeof i[b.observable])return r.subscribeToObservable(i);if(c.isArrayLike(i))return o.subscribeToArray(i);if(s.isPromise(i))return n.subscribeToPromise(i);if(i&&"function"==typeof i[u.iterator])return a.subscribeToIterable(i);var e=l.isObject(i)?"an invalid object":"'"+i+"'";throw new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},"90cg":function(i,e,t){"use strict";e.isPromise=function(i){return!!i&&"function"!=typeof i.subscribe&&"function"==typeof i.then}},EBtg:function(i,e,t){"use strict";var o=t("2KeD"),n=t("n73p"),a=t("2qMH"),r=t("LJ/p"),c=t("HZF8"),s=t("90cg"),l=t("yRPT"),u=t("0alx");e.scheduled=function(i,e){if(null!=i){if(c.isInteropObservable(i))return o.scheduleObservable(i,e);if(s.isPromise(i))return n.schedulePromise(i,e);if(l.isArrayLike(i))return a.scheduleArray(i,e);if(u.isIterable(i)||"string"==typeof i)return r.scheduleIterable(i,e)}throw new TypeError((null!==i&&typeof i||i)+" is not observable")}},HZF8:function(i,e,t){"use strict";var o=t("zfKp");e.isInteropObservable=function(i){return i&&"function"==typeof i[o.observable]}},"LJ/p":function(i,e,t){"use strict";var o=t("Q1FS"),n=t("zB/H"),a=t("VKeD");e.scheduleIterable=function(i,e){if(!i)throw new Error("Iterable cannot be null");return new o.Observable((function(t){var o,r=new n.Subscription;return r.add((function(){o&&"function"==typeof o.return&&o.return()})),r.add(e.schedule((function(){o=i[a.iterator](),r.add(e.schedule((function(){if(!t.closed){var i,e;try{var n=o.next();i=n.value,e=n.done}catch(a){return void t.error(a)}e?t.complete():(t.next(i),this.schedule())}})))}))),r}))}},OAkW:function(i,e,t){"use strict";e.subscribeToArray=function(i){return function(e){for(var t=0,o=i.length;t<o&&!e.closed;t++)e.next(i[t]);e.complete()}}},VKeD:function(i,e,t){"use strict";function o(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}e.getSymbolIterator=o,e.iterator=o(),e.$$iterator=e.iterator},Z5tI:function(i,e,t){"use strict";var o=t("MkmW");e.subscribeToPromise=function(i){return function(e){return i.then((function(i){e.closed||(e.next(i),e.complete())}),(function(i){return e.error(i)})).then(null,o.hostReportError),e}}},gTqA:function(i,e,t){"use strict";var o=t("Q1FS"),n=t("6qA3"),a=t("EBtg");e.from=function(i,e){return e?a.scheduled(i,e):i instanceof o.Observable?i:new o.Observable(n.subscribeTo(i))}},n73p:function(i,e,t){"use strict";var o=t("Q1FS"),n=t("zB/H");e.schedulePromise=function(i,e){return new o.Observable((function(t){var o=new n.Subscription;return o.add(e.schedule((function(){return i.then((function(i){o.add(e.schedule((function(){t.next(i),o.add(e.schedule((function(){return t.complete()})))})))}),(function(i){o.add(e.schedule((function(){return t.error(i)})))}))}))),o}))}},ozli:function(i,e,t){"use strict";var o=t("zfKp");e.subscribeToObservable=function(i){return function(e){var t=i[o.observable]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)}}},poJ0:function(i,e,t){"use strict";var o=t("VKeD");e.subscribeToIterable=function(i){return function(e){for(var t=i[o.iterator]();;){var n=void 0;try{n=t.next()}catch(a){return e.error(a),e}if(n.done){e.complete();break}if(e.next(n.value),e.closed)break}return"function"==typeof t.return&&e.add((function(){t.return&&t.return()})),e}}},q3Kh:function(i,e,t){"use strict";var o,n=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])})(i,e)},function(i,e){function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),a=t("FWf1");e.map=function(i,e){return function(t){if("function"!=typeof i)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return t.lift(new r(i,e))}};var r=function(){function i(i,e){this.project=i,this.thisArg=e}return i.prototype.call=function(i,e){return e.subscribe(new c(i,this.project,this.thisArg))},i}();e.MapOperator=r;var c=function(i){function e(e,t,o){var n=i.call(this,e)||this;return n.project=t,n.count=0,n.thisArg=o||n,n}return n(e,i),e.prototype._next=function(i){var e;try{e=this.project.call(this.thisArg,i,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(a.Subscriber)},wjEo:function(i,e,t){"use strict";var o,n=this&&this.__extends||(o=function(i,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var t in e)e.hasOwnProperty(t)&&(i[t]=e[t])})(i,e)},function(i,e){function t(){this.constructor=i}o(i,e),i.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),a=t("FWf1"),r=t("Q1FS"),c=t("6qA3");e.SimpleInnerSubscriber=function(i){function e(e){var t=i.call(this)||this;return t.parent=e,t}return n(e,i),e.prototype._next=function(i){this.parent.notifyNext(i)},e.prototype._error=function(i){this.parent.notifyError(i),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(a.Subscriber),e.ComplexInnerSubscriber=function(i){function e(e,t,o){var n=i.call(this)||this;return n.parent=e,n.outerValue=t,n.outerIndex=o,n}return n(e,i),e.prototype._next=function(i){this.parent.notifyNext(this.outerValue,i,this.outerIndex,this)},e.prototype._error=function(i){this.parent.notifyError(i),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(a.Subscriber),e.SimpleOuterSubscriber=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.notifyNext=function(i){this.destination.next(i)},e.prototype.notifyError=function(i){this.destination.error(i)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(a.Subscriber),e.ComplexOuterSubscriber=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return n(e,i),e.prototype.notifyNext=function(i,e,t,o){this.destination.next(e)},e.prototype.notifyError=function(i){this.destination.error(i)},e.prototype.notifyComplete=function(i){this.destination.complete()},e}(a.Subscriber),e.innerSubscribe=function(i,e){if(!e.closed){if(i instanceof r.Observable)return i.subscribe(e);var t;try{t=c.subscribeTo(i)(e)}catch(o){e.error(o)}return t}}},yRPT:function(i,e,t){"use strict";e.isArrayLike=function(i){return i&&"number"==typeof i.length&&"function"!=typeof i}}}]);