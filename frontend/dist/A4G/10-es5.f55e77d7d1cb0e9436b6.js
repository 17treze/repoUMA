function _defineProperties(i,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function _createClass(i,e,t){return e&&_defineProperties(i.prototype,e),t&&_defineProperties(i,t),i}function _classCallCheck(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"2mgZ":function(i,e,t){"use strict";t.r(e),t.d(e,"IstruttoriaAntimafiaModule",(function(){return tt}));var a=t("ofXK"),n=t("tyNb"),o=t("wH++"),c=t("8PIW"),r=function i(){_classCallCheck(this,i)},s=t("69Tm"),l=t("7D9o"),d=t("8k9x"),b=t("q1/g"),u=t("Tn7N"),m=t("PqYM"),f=t("dkQB"),p=t("eIep"),g=t("fXoL"),h=t("tk/3"),S=t("sYmb"),A=t("rgW5"),T=t("RtSl"),v=function i(e){_classCallCheck(this,i),this.cuaa=e},I=function i(){_classCallCheck(this,i)},O=t("arS9"),z=t("GLSp"),C=t("yWug"),D=t("A1Yd"),P=t("FK/F");function y(i,e){if(1&i&&(g.Tb(0,"th",15),g.Oc(1),g.Ob(2,"p-sortIcon",16),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.field)}}function B(i,e){if(1&i&&(g.Tb(0,"tr"),g.Mc(1,y,3,4,"th",13),g.Tb(2,"th",14),g.Oc(3),g.Sb(),g.Tb(4,"th",14),g.Oc(5),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.mc("ngForOf",t),g.Bb(2),g.Qc(" ",a.intestazioni.collegate," "),g.Bb(2),g.Qc(" ",a.intestazioni.azioni," ")}}function N(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr",17),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.gc(7,"date"),g.Sb(),g.Tb(8,"td",18),g.Tb(9,"div",19),g.Tb(10,"div",20),g.Tb(11,"p-button",21),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,0)})),g.Sb(),g.Sb(),g.Tb(12,"div",20),g.Tb(13,"p-button",22),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,1)})),g.Sb(),g.Sb(),g.Tb(14,"div",20),g.Tb(15,"p-button",23),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,2)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(16,"td"),g.Tb(17,"action-menu",24,25),g.bc("click",(function(){g.Ec(t);var i=e.$implicit,a=e.rowIndex,n=g.Bc(18);return g.fc().onDropdownMenuOpen(n,i,a)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.mc("pSelectableRow",a),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.codiceFiscale),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.denominazione),g.Bb(2),g.Pc(g.ic(7,11,a.dtInizioCompilazione,"dd/MM/yyyy")),g.Bb(5),g.nc("title",n.intestazioni.DOMANDE_SUPERFICIE_EU),g.mc("disabled",!(a.idsDomandaSuperficie.length>0)),g.Bb(2),g.nc("title",n.intestazioni.DOMANDE_STRUTTURALI_EU),g.mc("disabled",!(a.idsDomandaStrutturale.length>0)),g.Bb(2),g.nc("title",n.intestazioni.DOMANDE_UNICHE),g.mc("disabled",!(a.idsDomandaDu.length>0)),g.Bb(2),g.mc("item",n.menuAction)}}function M(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.Cb("colspan",t.length+2),g.Bb(1),g.Qc(" ",a.intestazioni.noTableContent," ")}}function E(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",26),g.Ob(1,"i",27),g.Tb(2,"h3"),g.Oc(3),g.Sb(),g.Tb(4,"p"),g.Oc(5),g.Sb(),g.Sb(),g.Tb(6,"div",28),g.Tb(7,"div",29),g.Tb(8,"button",30),g.bc("click",(function(){return g.Ec(t),g.fc().onConfirmAggiornaStato()})),g.Sb(),g.Sb(),g.Tb(9,"div",29),g.Tb(10,"button",31),g.bc("click",(function(){return g.Ec(t),g.fc().onRejectAggiornaStato()})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit;g.Bb(3),g.Pc(a.summary),g.Bb(2),g.Pc(a.detail)}}var F,k=((F=function(){function i(e,t,a,n,o){_classCallCheck(this,i),this.istruttoriaAntimafiaService=e,this.router=t,this.route=a,this.messages=n,this.antimafiaService=o,this.intestazioni=s.a,this.textTitle=s.a.CERTIFICAZIONE_ANTIMAFIA_BOZZA,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new I,this.elementiTotali=0,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new g.n,this.runStatoAvanzamentoProcesso=new g.n,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.intestazioni.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.intestazioni.descrizioneImpresa},{field:"dtInizioCompilazione",header:this.intestazioni.dataInizioCompilazione}]}return _createClass(i,[{key:"ngOnInit",value:function(){this.menuAction=this.buildMenuAction(),this.isEmpty=!1}},{key:"ngOnChanges",value:function(i){i.refreshFromParent.currentValue&&this.loadList(0,null)}},{key:"checkIfIsEmpty",value:function(){return void 0===this.certificazioniBozzaView||0===this.certificazioniBozzaView.length}},{key:"getDomandaAntimafiaSelezionataFromMenuAction",value:function(){return this.domandaAntimafiaSelezionataFromMenuAction}},{key:"visualizzaDettaglioDomanda",value:function(i,e){var t={queryParams:{activeIndex:e,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:0},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],t)}},{key:"buildMenuAction",value:function(){var i=this;return[{label:s.a.azioni.toUpperCase(),items:[{label:s.a.ESITO_POSITIVO,command:function(){i.openPopupEsitoPositivo(),i.currentMenuAction.reset=!0}}]}]}},{key:"onDropdownMenuOpen",value:function(i,e,t){this.indexSelectedFromMenu=t,this.domandaAntimafiaSelezionataFromMenuAction=e,this.currentMenuAction=i,this.currentMenuAction.reset=!1}},{key:"openPopupEsitoPositivo",value:function(){this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(c.a.POSITIVO)))}},{key:"onConfirmAggiornaStato",value:function(){this.messages.clear(),this.esitoPositivo()}},{key:"onRejectAggiornaStato",value:function(){this.messages.clear()}},{key:"esitoPositivo",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction;e.stato.descrizione=null,e.stato.id=null,e.stato.identificativo=c.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(e).subscribe((function(e){var t=new v(i.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);i.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe((function(e){e&&e.forEach((function(a){a.cuaa===t.cuaa&&(a.dtFineEsitoNegativo=null,a.dtFineSilenzioAssenso=null,a.dtInizioEsitoNegativo=null,a.dtInizioSilenzioAssenso=null),i.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(e)})),i.loadList(0,null)}),(function(i){return console.log(i)}))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))}))}},{key:"loadData",value:function(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){var e="";switch(i.sortField){case this.cols[0].field:e="cuaa";break;case this.cols[1].field:e="denominazioneImpresa";break;default:e=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(e)}this.loadList(i.first,i.globalFilter)}},{key:"loadList",value:function(i,e){var t=this;this.ricercaAntimafiaFilter.filtroGenerico=e||null,this.ricercaAntimafiaFilter.statoDichiarazione=c.a.BOZZA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe((function(i){t.elementiTotali=i.total,t.certificazioniBozza=i.results?i.results:[],t.certificazioniBozzaView=t.certificazioniBozza,t.isEmpty=0===t.certificazioniBozza.length}),(function(i){console.log("error: "+i),t.isEmpty=!0}))}}]),i}()).\u0275fac=function(i){return new(i||F)(g.Nb(l.a),g.Nb(n.e),g.Nb(n.a),g.Nb(T.d),g.Nb(o.a))},F.\u0275cmp=g.Hb({type:F,selectors:[["app-cert-amf-bozza"]],inputs:{refreshFromParent:"refreshFromParent",itemBadges:"itemBadges"},outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters",runStatoAvanzamentoProcesso:"runStatoAvanzamentoProcesso"},features:[g.zb],decls:16,vars:13,consts:[[1,"ui-grid-fixed","boxgrey"],["position","top-center","key","generic",3,"baseZIndex"],[1,"layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",0),g.Ob(1,"p-toast",1),g.Tb(2,"div",2),g.Tb(3,"h3"),g.Oc(4),g.Sb(),g.Tb(5,"div",3),g.Tb(6,"i",4),g.Oc(7,"search"),g.Sb(),g.Tb(8,"input",5),g.bc("input",(function(i){return g.Ec(t),g.Bc(10).filterGlobal(i.target.value,"contains")})),g.Sb(),g.Sb(),g.Tb(9,"p-table",6,7),g.bc("onLazyLoad",(function(i){return e.loadData(i)})),g.Mc(11,B,6,3,"ng-template",8),g.Mc(12,N,19,14,"ng-template",9),g.Mc(13,M,3,2,"ng-template",10),g.Sb(),g.Sb(),g.Sb(),g.Tb(14,"p-toast",11),g.bc("onClose",(function(){return e.onRejectAggiornaStato()})),g.Mc(15,E,11,2,"ng-template",12),g.Sb()}2&i&&(g.Bb(1),g.mc("baseZIndex",5e4),g.Bb(3),g.Pc(e.textTitle),g.Bb(5),g.mc("columns",e.cols)("value",e.certificazioniBozzaView)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",e.elementiTotali)("rowsPerPageOptions",e.intestazioni.sizePerPagina),g.Bb(5),g.mc("modal",!0)("baseZIndex",5e3))},directives:[O.a,z.a,C.q,T.e,a.s,C.p,C.o,C.m,D.a,P.a,D.b],pipes:[a.f],styles:[""]}),F),R=t("lJxs"),_=t("LRne"),w=t("Rt+w"),x=t("D0mR"),U=t("x5p7");function L(i,e){if(1&i&&(g.Tb(0,"th",16),g.Oc(1),g.Ob(2,"p-sortIcon-wrapper",17),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumnWrapper",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.field)}}function V(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"th",14),g.Ob(2,"app-a4g-paged-table-checkbox"),g.Sb(),g.Mc(3,L,3,4,"th",15),g.Tb(4,"th",14),g.Oc(5),g.Sb(),g.Tb(6,"th",14),g.Oc(7),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(3),g.mc("ngForOf",t),g.Bb(2),g.Qc(" ",a.intestazioni.collegate," "),g.Bb(2),g.Qc(" ",a.intestazioni.azioni," ")}}function $(i,e){if(1&i&&g.Ob(0,"div",31),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function G(i,e){if(1&i&&g.Ob(0,"div",32),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function Z(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr",18),g.Tb(1,"td"),g.Ob(2,"p-tableCheckbox-wrapper",19),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.Sb(),g.Tb(7,"td"),g.Oc(8),g.gc(9,"date"),g.Sb(),g.Tb(10,"td"),g.Oc(11),g.gc(12,"translate"),g.Sb(),g.Tb(13,"td"),g.Tb(14,"div",20),g.Mc(15,$,1,1,"div",21),g.Mc(16,G,1,1,"div",22),g.Sb(),g.Sb(),g.Tb(17,"td",23),g.Tb(18,"div",24),g.Tb(19,"div",25),g.Tb(20,"p-button",26),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,0)})),g.Sb(),g.Sb(),g.Tb(21,"div",25),g.Tb(22,"p-button",27),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,1)})),g.Sb(),g.Sb(),g.Tb(23,"div",25),g.Tb(24,"p-button",28),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,2)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(25,"td"),g.Tb(26,"action-menu",29,30),g.bc("click",(function(){g.Ec(t);var i=e.$implicit,a=e.rowIndex,n=g.Bc(27);return g.fc().onDropdownMenuOpen(n,i,a)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.mc("pSelectableRowWrapper",a),g.Bb(2),g.mc("value",a),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.codiceFiscale),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.denominazione),g.Bb(2),g.Pc(g.ic(9,15,a.dtProtocollazione,"dd/MM/yyyy")),g.Bb(3),g.Pc(null!=a.idProtocollo?a.idProtocollo:g.hc(12,18,"gestioneUtenze.IN_PROTOCOLLAZIONE")),g.Bb(4),g.mc("ngIf","OK"===a.esito),g.Bb(1),g.mc("ngIf","KO"===a.esito),g.Bb(4),g.nc("title",n.intestazioni.DOMANDE_SUPERFICIE_EU),g.mc("disabled",!(a.idsDomandaSuperficie.length>0)),g.Bb(2),g.nc("title",n.intestazioni.DOMANDE_STRUTTURALI_EU),g.mc("disabled",!(a.idsDomandaStrutturale.length>0)),g.Bb(2),g.nc("title",n.intestazioni.DOMANDE_UNICHE),g.mc("disabled",!(a.idsDomandaDu.length>0)),g.Bb(2),g.mc("item",n.menuAction)}}function K(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.Cb("colspan",t.length+3),g.Bb(1),g.Qc(" ",a.intestazioni.noTableContent," ")}}function j(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",33),g.Ob(1,"i",34),g.Tb(2,"h3"),g.Oc(3),g.Sb(),g.Tb(4,"p"),g.Oc(5),g.Sb(),g.Sb(),g.Tb(6,"div",35),g.Tb(7,"div",36),g.Tb(8,"button",37),g.bc("click",(function(){return g.Ec(t),g.fc().onConfirmAggiornaStato()})),g.Sb(),g.Sb(),g.Tb(9,"div",36),g.Tb(10,"button",38),g.bc("click",(function(){return g.Ec(t),g.fc().onRejectAggiornaStato()})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit;g.Bb(3),g.Pc(a.summary),g.Bb(2),g.Pc(a.detail)}}var Q,J=((Q=function(){function i(e,t,a,n,o){_classCallCheck(this,i),this.antimafiaService=e,this.messages=t,this.istruttoriaAntimafiaService=a,this.route=n,this.router=o,this.intestazioni=s.a,this.textTitle=s.a.istruttoriaCertificazioneAntimafia,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new I,this.elementiTotali=0,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new g.n,this.runStatoAvanzamentoProcesso=new g.n,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.intestazioni.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.intestazioni.descrizioneImpresa},{field:"dtProtocollazione",header:this.intestazioni.data},{field:"idProtocollo",header:this.intestazioni.nrProtocollo},{field:"esito",header:this.intestazioni.esitoTrasmissione}]}return _createClass(i,[{key:"ngOnInit",value:function(){this.menuAction=this.menuActionProtocollata(),this.isEmpty=!1}},{key:"ngOnDestroy",value:function(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}},{key:"ngOnChanges",value:function(i){i.refreshFromParent.currentValue&&this.loadList(0,null)}},{key:"checkIfIsEmpty",value:function(){return void 0===this.certificazioniProtocollateView||0===this.certificazioniProtocollateView.length}},{key:"avviaControllo",value:function(){var i=this;this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length?(this.certificazioneProtocollateSelezionate.map((function(i){return i.id})),Object(_.a)(this.isSelectedAll).pipe(Object(p.a)((function(e){return e?i.istruttoriaAntimafiaService.getCertificazioniAntimafiaByStato(c.a.PROTOCOLLATA).pipe(Object(R.a)((function(i){return i.results.map((function(i){return i.id}))}))):Object(_.a)(i.certificazioneProtocollateSelezionate.map((function(i){return i.id})))}))).subscribe((function(e){console.log("SelectAll active: ",e),i.antimafiaService.avviaControllo(e).subscribe((function(t){i.runStatoAvanzamentoProcesso.emit(e.length),i.messages.add(u.a.getToast("generic",u.b.success,u.a.processoAvviatoOK))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.warn,"BRIAMPRT001"!==e.error.message?"IMPPSRSUPERR"!==e.error.message?u.a.BRIAMPRT003:u.a.IMPPSRSUPERR:u.a.BRIAMPRT001))}))}))):this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMPRT001))}},{key:"onDropdownMenuOpen",value:function(i,e,t){this.indexSelectedFromMenu=t,this.domandaAntimafiaSelezionataFromMenuAction=e,this.currentMenuAction=i,this.currentMenuAction.reset=!1}},{key:"downloadDomandaCertificazioneAntimafia",value:function(){var i=this,e=this.getDomandaAntimafiaSelezionataFromMenuAction(),t=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(e.id.toString());this.dichiarazioneAntimafiaSubscpription=t.pipe(Object(p.a)((function(t){return e.pdfFirmato=t.pdfFirmato,i.antimafiaService.downloadDichiarazioneAntimafia(t.pdfFirmato,t.tipoPdfFirmato),Object(_.a)(t)}))).subscribe((function(e){var t=i.antimafiaService.getAllegati(e);i.antimafiaService.downloadAllegati(t)}))}},{key:"getDomandaAntimafiaSelezionataFromMenuAction",value:function(){return this.domandaAntimafiaSelezionataFromMenuAction}},{key:"menuActionProtocollata",value:function(){var i=this;return[{label:s.a.azioni.toUpperCase(),items:[{label:s.a.SCARICA,command:function(){i.downloadDomandaCertificazioneAntimafia(),i.currentMenuAction.reset=!0}},{label:s.a.ESITO_POSITIVO,command:function(){i.openPopupEsitoPositivo(),i.currentMenuAction.reset=!0}}]}]}},{key:"visualizzaDettaglioDomanda",value:function(i,e){var t={queryParams:{activeIndex:e,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:1},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],t)}},{key:"openPopupEsitoPositivo",value:function(){this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(c.a.POSITIVO)))}},{key:"onConfirmAggiornaStato",value:function(){this.messages.clear(),this.esitoPositivo()}},{key:"onRejectAggiornaStato",value:function(){this.messages.clear()}},{key:"esitoPositivo",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction;e.stato.descrizione=null,e.stato.id=null,e.stato.identificativo=c.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(e).subscribe((function(e){var t=new v(i.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);i.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe((function(e){e&&e.forEach((function(a){a.cuaa===t.cuaa&&(a.dtFineEsitoNegativo=null,a.dtFineSilenzioAssenso=null,a.dtInizioEsitoNegativo=null,a.dtInizioSilenzioAssenso=null),i.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(e)})),i.loadList(0,null)}),(function(i){return console.log(i)}))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))}))}},{key:"loadData",value:function(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){var e="";switch(i.sortField){case this.cols[0].field:e="cuaa";break;case this.cols[1].field:e="denominazioneImpresa";break;default:e=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(e)}this.loadList(i.first,i.globalFilter)}},{key:"loadList",value:function(i,e){var t=this;this.ricercaAntimafiaFilter.filtroGenerico=e||null,this.ricercaAntimafiaFilter.statoDichiarazione=c.a.PROTOCOLLATA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe((function(i){t.elementiTotali=i.total,t.certificazioniProtocollate=i.results?i.results:[],t.certificazioniProtocollateView=t.certificazioniProtocollate,t.isEmpty=0===t.certificazioniProtocollate.length}),(function(i){console.log("error: "+i),t.isEmpty=!0}))}},{key:"buildDescrizioneTooltip",value:function(i){var e=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?e+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(e+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?e+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(e+=" | ESITO INVIO A BDNA NON DISPONIBILE"),e}}]),i}()).\u0275fac=function(i){return new(i||Q)(g.Nb(o.a),g.Nb(T.d),g.Nb(l.a),g.Nb(n.a),g.Nb(n.e))},Q.\u0275cmp=g.Hb({type:Q,selectors:[["app-cert-amf-protocollate"]],inputs:{refreshFromParent:"refreshFromParent",itemBadges:"itemBadges"},outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters",runStatoAvanzamentoProcesso:"runStatoAvanzamentoProcesso"},features:[g.zb],decls:18,vars:13,consts:[[1,"ui-grid-fixed","boxgrey"],["position","top-center","key","generic",3,"baseZIndex"],[1,"layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","totalRecords","selectedItems","isSelectedAll","lazy","sizeArray","selectedItemsChange","isSelectedAllChange","onLazyLoadPage"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["appDebounceClick","",3,"disabled","label","debounceClick"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[2,"width","3em"],[3,"pSortableColumnWrapper","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumnWrapper","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRowWrapper"],[3,"value"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",0),g.Ob(1,"p-toast",1),g.Tb(2,"div",2),g.Tb(3,"h3"),g.Oc(4),g.Sb(),g.Tb(5,"div",3),g.Tb(6,"i",4),g.Oc(7,"search"),g.Sb(),g.Tb(8,"input",5),g.bc("input",(function(i){return g.Ec(t),g.Bc(10).filterGlobal(i.target.value,"contains")})),g.Sb(),g.Sb(),g.Tb(9,"app-a4g-paged-table",6,7),g.bc("selectedItemsChange",(function(i){return e.certificazioneProtocollateSelezionate=i}))("isSelectedAllChange",(function(i){return e.isSelectedAll=i}))("onLazyLoadPage",(function(i){return e.loadData(i)})),g.Mc(11,V,8,3,"ng-template",8),g.Mc(12,Z,28,20,"ng-template",9),g.Mc(13,K,3,2,"ng-template",10),g.Sb(),g.Sb(),g.Tb(14,"div"),g.Tb(15,"p-button",11),g.bc("debounceClick",(function(){return e.avviaControllo()})),g.Sb(),g.Sb(),g.Sb(),g.Tb(16,"p-toast",12),g.bc("onClose",(function(){return e.onRejectAggiornaStato()})),g.Mc(17,j,11,2,"ng-template",13),g.Sb()}2&i&&(g.Bb(1),g.mc("baseZIndex",5e4),g.Bb(3),g.Pc(e.textTitle),g.Bb(5),g.mc("columns",e.cols)("value",e.certificazioniProtocollateView)("totalRecords",e.elementiTotali)("selectedItems",e.certificazioneProtocollateSelezionate)("isSelectedAll",e.isSelectedAll)("lazy",!0)("sizeArray",e.intestazioni.sizePerPagina),g.Bb(6),g.nc("label",e.intestazioni.AVVIA_CONTROLLO),g.mc("disabled",e.checkIfIsEmpty()),g.Bb(1),g.mc("modal",!0)("baseZIndex",5e3))},directives:[O.a,z.a,w.b,T.e,D.a,x.a,w.a,a.s,w.f,w.e,w.d,w.g,a.t,P.a,U.a,D.b],pipes:[a.f,S.d],styles:[".boxgrey[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#0d5f3f;font-weight:700;font-size:18px;text-transform:uppercase;padding-bottom:10px;margin-bottom:15px}.boxgrey[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > h5[_ngcontent-%COMP%]{border-bottom:2px solid #0d5f3f}.boxgrey[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{display:inline!important}",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),Q),H=function i(){_classCallCheck(this,i)},q=function i(){_classCallCheck(this,i)},W=t("JEAp"),Y=t("oPyp");t("4IZF");var X,ii,ei=((X=function(){function i(e,t){_classCallCheck(this,i),this.http=e,this._configuration=t}return _createClass(i,[{key:"getSincronizzazioneAntimafia",value:function(i){return this.http.get(this._configuration.urlSincronizzazioneAntimafia.replace("${id}",i.toString()))}},{key:"putSincronizzazioneAntimafia",value:function(i,e){var t=new h.f({"Content-Type":"application/json"});return this.http.put(this._configuration.urlSincronizzazioneAntimafia.replace("${id}",i.toString()),JSON.stringify(e),{headers:t})}},{key:"postSincronizzazioneAntimafia",value:function(i){var e=new h.f({"Content-Type":"application/json"});return this.http.post(this._configuration.urlPostSincronizzazioneAntimafia,JSON.stringify(i),{headers:e})}}]),i}()).\u0275fac=function(i){return new(i||X)(g.Xb(h.b),g.Xb(f.a))},X.\u0275prov=g.Jb({token:X,factory:X.\u0275fac,providedIn:"root"}),X),ti=t("5gIc"),ai=t("A+aF"),ni=t("3Pt+"),oi=((ii=function(){function i(e,t,a,n){var o=this;_classCallCheck(this,i),this.antimafiaService=e,this.sincronizzazioneAntimafiaService=t,this.messages=a,this.loader=n,this.labels=s.a,this.nrProtocolloComunicazione=void 0,this.noteDiChiusura=void 0,this.event=new g.n,this.onSuccess=function(i){o.antimafiaService.creaNotaDichiarazioneAntimafia(i.id,{nrProtocolloComunicazione:o.nrProtocolloComunicazione,noteDiChiusura:o.noteDiChiusura}).subscribe((function(e){i.stato.identificativo=c.a.RIFIUTATA,i.stato.id=null,i.stato.descrizione=null,i.dtFine=new Date,o.antimafiaService.aggiornaDichiarazioneAntimafia(i).subscribe((function(e){o.event.emit(),o.sincronizzazioneAntimafiaService.getSincronizzazioneAntimafia(i.id).subscribe((function(e){e&&(e.dataFineVali=new Date,o.sincronizzazioneAntimafiaService.putSincronizzazioneAntimafia(i.id,e).subscribe((function(){o.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK))}),(function(i){o.messages.add(u.a.getToast("generic",u.b.error,u.a.BRIAMCMN007))})))}),(function(i){o.messages.add(u.a.getToast("generic",u.b.error,u.a.BRIAMCMN007))}))}),(function(i){o.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))}))}),(function(i){o.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))}))},this.areValidFields=function(i){return!i||!!i.trim()}}return _createClass(i,[{key:"ngOnInit",value:function(){this.loader.setTimeout(48e4)}},{key:"ngOnDestroy",value:function(){this.loader.resetTimeout()}},{key:"open",value:function(){this.headerPopup=u.a.COMUNICAZIONE_RIFIUTO_DOMANDA(this.dichiarazioneAntimafia.datiDichiarazione.dettaglioImpresa.denominazione),this.displayDialog=!0}},{key:"close",value:function(){this.displayDialog=!1}},{key:"conferma",value:function(i){this.areValidFields(this.nrProtocolloComunicazione)&&this.areValidFields(this.noteDiChiusura)&&(this.onSuccess(this.dichiarazioneAntimafia),this.close()),i.form.reset()}},{key:"annulla",value:function(i){this.close(),i.form.reset()}}]),i}()).\u0275fac=function(i){return new(i||ii)(g.Nb(o.a),g.Nb(ei),g.Nb(T.d),g.Nb(ti.a))},ii.\u0275cmp=g.Hb({type:ii,selectors:[["app-popup-rifiuta-domanda"]],inputs:{dichiarazioneAntimafia:"dichiarazioneAntimafia"},outputs:{event:"event"},decls:39,vars:34,consts:[["showEffect","fade",3,"visible","responsive","modal","closable","visibleChange"],[1,"boxgrey","boxpopup"],[1,""],[3,"ngSubmit"],["popupForm","ngForm"],[1,"form-group"],[1,"ui-g-12"],["required","","id","nrProtocollo","type","text","pInputText","","name","nrProtocollo",1,"form-control",3,"placeholder","ngModel","ngModelChange"],["nrProtocollo","ngModel"],[1,"alert","alert-danger",3,"hidden"],["required","","pInputTextarea","","name","noteChiusura",1,"form-control",3,"placeholder","ngModel","ngModelChange"],["noteChiusura","ngModel"],[1,"ui-dialog-buttonpane","ui-helper-clearfix"],["type","submit","pButton","",1,"btn","btn-darkgreen",3,"disabled","label"],["type","button","pButton","",1,"btn","btn-dark",3,"label","click"]],template:function(i,e){if(1&i){var t=g.Ub();g.Tb(0,"p-dialog",0),g.bc("visibleChange",(function(i){return e.displayDialog=i})),g.Tb(1,"div",1),g.Tb(2,"p-header"),g.Oc(3),g.Sb(),g.Tb(4,"div",2),g.Tb(5,"form",3,4),g.bc("ngSubmit",(function(){g.Ec(t);var i=g.Bc(6);return e.conferma(i)})),g.Tb(7,"div",5),g.Tb(8,"div",6),g.Tb(9,"label"),g.Oc(10),g.gc(11,"translate"),g.Sb(),g.Tb(12,"input",7,8),g.bc("ngModelChange",(function(i){return e.nrProtocolloComunicazione=i})),g.gc(14,"translate"),g.Sb(),g.Tb(15,"div",9),g.Oc(16),g.gc(17,"translate"),g.Sb(),g.Sb(),g.Tb(18,"div",5),g.Tb(19,"div",6),g.Tb(20,"label"),g.Oc(21),g.gc(22,"translate"),g.Sb(),g.Tb(23,"textarea",10,11),g.bc("ngModelChange",(function(i){return e.noteDiChiusura=i})),g.gc(25,"translate"),g.Sb(),g.Tb(26,"div",9),g.Oc(27),g.gc(28,"translate"),g.Sb(),g.Sb(),g.Sb(),g.Ob(29,"br"),g.Ob(30,"br"),g.Ob(31,"br"),g.Sb(),g.Tb(32,"p-footer"),g.Tb(33,"div",12),g.Tb(34,"div",6),g.Ob(35,"button",13),g.gc(36,"translate"),g.Tb(37,"button",14),g.bc("click",(function(){g.Ec(t);var i=g.Bc(6);return e.annulla(i)})),g.gc(38,"translate"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=g.Bc(6),n=g.Bc(13),o=g.Bc(24);g.mc("visible",e.displayDialog)("responsive",!0)("modal",!0)("closable",!1),g.Bb(3),g.Qc(" ",e.headerPopup," "),g.Bb(7),g.Pc(g.hc(11,18,"ANTIMAFIA.COMUNICAZIONE_NR_PROTOCOLLO")),g.Bb(2),g.nc("placeholder",g.hc(14,20,"ANTIMAFIA.COMUNICAZIONE_NR_PROTOCOLLO")),g.mc("ngModel",e.nrProtocolloComunicazione),g.Bb(3),g.mc("hidden",(n.valid||n.pristine)&&e.areValidFields(e.nrProtocolloComunicazione)),g.Bb(1),g.Qc(" ",g.hc(17,22,"ANTIMAFIA.CAMPO_OBBLIGATORIO")," "),g.Bb(5),g.Pc(g.hc(22,24,"ANTIMAFIA.NOTE_DI_CHIUSURA")),g.Bb(2),g.nc("placeholder",g.hc(25,26,"ANTIMAFIA.NOTE_DI_CHIUSURA")),g.mc("ngModel",e.noteDiChiusura),g.Bb(3),g.mc("hidden",(o.valid||o.pristine)&&e.areValidFields(e.noteDiChiusura)),g.Bb(1),g.Qc(" ",g.hc(28,28,"ANTIMAFIA.CAMPO_OBBLIGATORIO")," "),g.Bb(8),g.nc("label",g.hc(36,30,"ANTIMAFIA.PROCEDI")),g.mc("disabled",!a.form.valid),g.Bb(2),g.nc("label",g.hc(38,32,"ANTIMAFIA.ANNULLA"))}},directives:[ai.a,T.c,ni.I,ni.t,ni.u,ni.c,ni.D,z.a,ni.s,ni.v,T.b,D.b],pipes:[S.d],styles:[""]}),ii),ci=t("1ozv"),ri=t("MvQ6"),si=t("MgAl"),li=t("1SSY"),di=t("BGwN"),bi=["file"];function ui(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",38),g.Tb(1,"p-radioButton",41),g.bc("ngModelChange",(function(i){return g.Ec(t),g.fc().selectedCampagna=i})),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.Bb(1),g.nc("value",a),g.nc("label",a),g.nc("inputId",a),g.mc("ngModel",n.selectedCampagna)}}function mi(i,e){if(1&i&&(g.Tb(0,"th",44),g.Oc(1),g.Ob(2,"p-sortIcon-wrapper",45),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumnWrapper",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.field)}}function fi(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"th",42),g.Ob(2,"app-a4g-paged-table-checkbox"),g.Sb(),g.Mc(3,mi,3,4,"th",43),g.Tb(4,"th",42),g.Oc(5),g.Sb(),g.Tb(6,"th",42),g.Oc(7),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(3),g.mc("ngForOf",t),g.Bb(2),g.Qc(" ",a.intestazioni.collegate," "),g.Bb(2),g.Qc(" ",a.intestazioni.azioni," ")}}function pi(i,e){if(1&i&&g.Ob(0,"div",58),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function gi(i,e){if(1&i&&g.Ob(0,"div",59),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function hi(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr",46),g.Tb(1,"td"),g.Ob(2,"p-tableCheckbox-wrapper",47),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.Sb(),g.Tb(7,"td"),g.Oc(8),g.gc(9,"date"),g.Sb(),g.Tb(10,"td"),g.Oc(11),g.Sb(),g.Tb(12,"td"),g.Tb(13,"div",20),g.Mc(14,pi,1,1,"div",48),g.Mc(15,gi,1,1,"div",49),g.Sb(),g.Sb(),g.Tb(16,"td",50),g.Tb(17,"div",51),g.Tb(18,"div",52),g.Tb(19,"p-button",53),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,0)})),g.Sb(),g.Sb(),g.Tb(20,"div",52),g.Tb(21,"p-button",54),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,1)})),g.Sb(),g.Sb(),g.Tb(22,"div",52),g.Tb(23,"p-button",55),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,2)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(24,"td"),g.Tb(25,"action-menu",56,57),g.bc("click",(function(){g.Ec(t);var i=e.$implicit,a=e.rowIndex,n=g.Bc(26);return g.fc().onDropdownMenuOpen(n,i,a)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.mc("pSelectableRowWrapper",a),g.Bb(2),g.mc("value",a),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.codiceFiscale),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.denominazione),g.Bb(2),g.Pc(g.ic(9,15,a.dtProtocollazione,"dd/MM/yyyy")),g.Bb(3),g.Pc(a.idProtocollo),g.Bb(3),g.mc("ngIf","OK"===a.esito),g.Bb(1),g.mc("ngIf","KO"===a.esito),g.Bb(4),g.nc("title",n.intestazioni.DOMANDE_SUPERFICIE_EU),g.mc("disabled",!(a.idsDomandaSuperficie.length>0)),g.Bb(2),g.nc("title",n.intestazioni.DOMANDE_STRUTTURALI_EU),g.mc("disabled",!(a.idsDomandaStrutturale.length>0)),g.Bb(2),g.nc("title",n.intestazioni.DOMANDE_UNICHE),g.mc("disabled",!(a.idsDomandaDu.length>0)),g.Bb(2),g.mc("item",n.menuAction)}}function Si(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.Cb("colspan",t.length+3),g.Bb(1),g.Qc(" ",a.intestazioni.noTableContent," ")}}function Ai(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",60),g.Ob(1,"i",61),g.Tb(2,"h3"),g.Oc(3),g.Sb(),g.Tb(4,"p"),g.Oc(5),g.Sb(),g.Sb(),g.Tb(6,"div",62),g.Tb(7,"div",63),g.Tb(8,"button",64),g.bc("click",(function(){return g.Ec(t),g.fc().onConfirmAggiornaStato()})),g.Sb(),g.Sb(),g.Tb(9,"div",63),g.Tb(10,"button",65),g.bc("click",(function(){return g.Ec(t),g.fc().onRejectAggiornaStato()})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit;g.Bb(3),g.Pc(a.summary),g.Bb(2),g.Pc(a.detail)}}function Ti(i,e){if(1&i&&(g.Tb(0,"div"),g.Oc(1),g.Sb()),2&i){var t=e.$implicit;g.Bb(1),g.Qc(" ",t," ")}}function vi(i,e){if(1&i&&(g.Tb(0,"div"),g.Oc(1),g.Sb()),2&i){var t=e.$implicit;g.Bb(1),g.Qc(" ",t," ")}}var Ii,Oi=function(){return{marginTop:"70px"}},zi=function(){return{overflow:"auto","max-height":"900px"}},Ci=((Ii=function(){function i(e,t,a,n,o,c,r,l){_classCallCheck(this,i),this.istruttoriaAntimafiaService=e,this.messages=t,this.router=a,this.messageService=n,this.confirmationService=o,this.route=c,this.antimafiaService=r,this.istruttoriaService=l,this.tipoDomanda=Y.a,this.textTitle=s.a.istruttoriaCertificazioneAntimafia,this.intestazioni=s.a,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new I,this.elementiTotali=0,this.isSelectedAll=!1,this.dialogVisibile=!1,this.selectedCampagna="",this.menuAction=new Array,this.aggiornaCertificazioniCounters=new g.n,this.runStatoAvanzamentoProcesso=new g.n,this.sogliaAcquisizione=new q,this.activeIndexDettaglioDomande=[-1,-1,-1],this.elencoCsvDaConfermare=[],this.esitiBdna=new H,this.checkMassiveExport=!1,this.getFileNameFromResponseContentDisposition=function(i){var e=i.headers.get("content-disposition")||"";return(/filename=([^;]+)/gi.exec(e)[1]||"untitled").trim()},this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.intestazioni.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.intestazioni.descrizioneImpresa},{field:"dtProtocollazione",header:this.intestazioni.data},{field:"idProtocollo",header:this.intestazioni.nrProtocollo},{field:"esito",header:this.intestazioni.esitoTrasmissione}]}return _createClass(i,[{key:"ngOnInit",value:function(){this.recuperaTrasmissioni(),this.isEmpty=!1,this.menuAction=this.buildMenuAction(),this.recuperaAnniCampagna()}},{key:"ngOnDestroy",value:function(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}},{key:"ngOnChanges",value:function(i){i.refreshFromParent.currentValue&&this.loadList(0,null)}},{key:"recuperaAnniCampagna",value:function(){var i=this;this.istruttoriaService.caricaAnniCampagna(si.a.PAC_2014_2020).toPromise().then((function(e){console.log("anni campagna",e),i.campagne=e}))}},{key:"recuperaTrasmissioni",value:function(){var i=this;this.elencoCsvDaConfermare=[],this.istruttoriaAntimafiaService.getTrasmissioniDaConfermare(null).subscribe((function(e){e&&e.length>0&&e.forEach((function(e){var t=new a.f("it-IT").transform(e.dtCreazione,"yyyyMMdd_HHmmss"),n="";n=n.concat(e.cfOperatore).concat("_").concat("Flusso_"),e.tipoDomanda==Y.a.DOMANDA_UNICA&&(n=n.concat("DU_").concat(t)),e.tipoDomanda==Y.a.PSR_STRUTTURALI_EU&&(n=n.concat("PSR_STR_").concat(t)),e.tipoDomanda==Y.a.PSR_SUPERFICIE_EU&&(n=n.concat("PSR_SUP_").concat(t)),n=n.concat(".csv"),i.elencoCsvDaConfermare.push({label:n,value:e})}))}))}},{key:"openDialog",value:function(i){this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length?(this.checkMassiveExport=i,this.dialogVisibile=!0):this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMCNT002))}},{key:"annullaImportPsrSuperficie",value:function(){this.dialogVisibile=!1,this.selectedCampagna=""}},{key:"confermaImportPsrSuperficie",value:function(){var i=this;this.selectedCampagna&&0!==this.selectedCampagna.length&&(this.confirmationService.confirm({message:"Il processo di acquisizione delle domande richiede un tempo proporzionale al numero di domande selezionate. E' possibile visualizzare l'avanzamento nella barra dei processi.",header:"ATTENZIONE",icon:"pi pi-exclamation-triangle",accept:function(){i.importSuperficieEU()},reject:function(){i.messageService.add(u.a.getToast("tst",u.b.reject,u.a.operazioneAnnullata))}}),this.dialogVisibile=!1)}},{key:"importSuperficieEU",value:function(){var i=this;this.sogliaAcquisizione.settore=Y.a.PSR_SUPERFICIE_EU,this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length?this.istruttoriaAntimafiaService.getSogliaAcquisizione(this.sogliaAcquisizione).subscribe((function(e){Object(_.a)(i.isSelectedAll).pipe(Object(p.a)((function(e){return e?i.istruttoriaAntimafiaService.getCertificazioniAntimafiaByStato(c.a.CONTROLLATA).pipe(Object(R.a)((function(i){return i.results.map((function(i){return i.datiDichiarazione.dettaglioImpresa.codiceFiscale}))}))):Object(_.a)(i.certificazioneProtocollateSelezionate.map((function(i){return i.datiDichiarazione.dettaglioImpresa.codiceFiscale})))}))).subscribe((function(t){i.istruttoriaAntimafiaService.importaDatiSuperficie(t,e,i.selectedCampagna).subscribe((function(e){i.runStatoAvanzamentoProcesso.emit(t.length),i.messages.add(u.a.getToast("generic",u.b.success,u.a.processoAvviatoOK))}),(function(e){console.log(e),i.messages.add("IMPPSRSUPERR"!==e.error.message?"BRIAMPRT001"!==e.error.message?u.a.getToast("generic",u.b.error,u.a.errorIstruttoriaAntimafiaImportDati):u.a.getToast("generic",u.b.warn,u.a.BRIAMPRT001):u.a.getToast("generic",u.b.warn,u.a.IMPPSRSUPERR))}),(function(){return i.loadList(0,null)}))}))}),(function(i){console.log(i)})):this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMCNT002))}},{key:"importStrutturaliEU",value:function(){var i=this;this.sogliaAcquisizione.settore=Y.a.PSR_STRUTTURALI_EU,this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length?this.istruttoriaAntimafiaService.getSogliaAcquisizione(this.sogliaAcquisizione).subscribe((function(e){Object(_.a)(i.isSelectedAll).pipe(Object(p.a)((function(e){return e?i.istruttoriaAntimafiaService.getCertificazioniAntimafiaByStato(c.a.CONTROLLATA).pipe(Object(R.a)((function(i){return i.results.map((function(i){return i.datiDichiarazione.dettaglioImpresa.codiceFiscale}))}))):Object(_.a)(i.certificazioneProtocollateSelezionate.map((function(i){return i.datiDichiarazione.dettaglioImpresa.codiceFiscale})))}))).subscribe((function(t){i.istruttoriaAntimafiaService.importaDatiStrutturali(t,e).subscribe((function(e){i.insertSincronizzazioneAgs(e),i.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,u.a.errorIstruttoriaAntimafiaImportDati))}),(function(){return i.loadList(0,null)}))}))}),(function(i){console.log(i)})):this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMCNT002))}},{key:"importDomandaUnica",value:function(i){var e=this;this.sogliaAcquisizione.settore=Y.a.DOMANDA_UNICA,this.istruttoriaAntimafiaService.getSogliaAcquisizione(this.sogliaAcquisizione).subscribe((function(t){e.istruttoriaAntimafiaService.importaDatiDU(i,t).subscribe((function(i){e.insertSincronizzazioneAgs(i),e.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK))}),(function(i){e.messages.add(u.a.getToast("generic",u.b.error,i.error.message))}),(function(){return e.loadList(0,null)}))}),(function(i){console.log(i)}))}},{key:"confermaExportFileCSV",value:function(){this.selectedCampagna&&0!==this.selectedCampagna.length&&(this.exportFileCSV(Y.a.PSR_SUPERFICIE_EU),this.dialogVisibile=!1)}},{key:"exportFileCSV",value:function(i){var e=this;if(this.certificazioneProtocollateSelezionate&&0!==this.certificazioneProtocollateSelezionate.length){var t;switch(i){case Y.a.DOMANDA_UNICA:t="idDomandaDu";break;case Y.a.PSR_STRUTTURALI_EU:t="idDomandaStrutturale";break;case Y.a.PSR_SUPERFICIE_EU:t="idDomandaSuperficie"}this.certificazioneProtocollateSelezionate.map((function(i){if(i[t])return i.datiDichiarazione.dettaglioImpresa.codiceFiscale})),Object(_.a)(this.isSelectedAll).pipe(Object(p.a)((function(i){return i?e.istruttoriaAntimafiaService.getCertificazioniAntimafiaByStato(c.a.CONTROLLATA).pipe(Object(R.a)((function(i){return i.results.map((function(i){return i.datiDichiarazione.dettaglioImpresa.codiceFiscale}))}))):Object(_.a)(e.certificazioneProtocollateSelezionate.map((function(i){return i.datiDichiarazione.dettaglioImpresa.codiceFiscale})))}))).subscribe((function(t){e.istruttoriaAntimafiaService.getEsportaCSV(t,i,e.selectedCampagna).subscribe((function(i){var t=e.getFileNameFromResponseContentDisposition(i);W.saveAs(i.body,t),e.recuperaTrasmissioni()}),(function(i){if(i.error){var t=new FileReader;t.onload=function(){e.messages.add(u.a.getToast("generic",u.b.error,u.a.IMPOSSILE_GENERARE_FILE+": "+t.result))},t.readAsText(i.error)}else e.messages.add(u.a.getToast("generic",u.b.error,u.a.IMPOSSILE_GENERARE_FILE))}))}))}else this.messages.add(u.a.getToast("generic",u.b.warn,u.a.CTRLIAMCNT002))}},{key:"importaEsitiBDNA",value:function(i){var e=this;this.istruttoriaAntimafiaService.importaEsitiBdna(i).subscribe((function(i){e.displayPopup=!0,e.esitiBdna=i}),(function(i){e.messages.add(u.a.getToast("generic",u.b.error,i.error.message))}))}},{key:"conferma",value:function(){var i=this;if(this.trasmissioneBdnaSelected){var e=new ci.a;(e=this.trasmissioneBdnaSelected).dtConferma=new Date,this.istruttoriaAntimafiaService.confermaDomandeCollegate(e).subscribe((function(){i.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK)),i.recuperaTrasmissioni(),i.trasmissioneBdnaSelected=null}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,e.error.message))}))}}},{key:"annulla",value:function(){var i=this;this.trasmissioneBdnaSelected&&this.istruttoriaAntimafiaService.annullaDomandeCollegate(this.trasmissioneBdnaSelected.id).subscribe((function(){i.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK)),i.recuperaTrasmissioni(),i.trasmissioneBdnaSelected=null}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,e.error.message))}))}},{key:"scarica",value:function(){var i=this;this.trasmissioneBdnaSelected&&this.istruttoriaAntimafiaService.downloadFileCsv(this.trasmissioneBdnaSelected.id).subscribe((function(e){var t=i.getFileNameFromResponseContentDisposition(e);W.saveAs(e.body,t)}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,e.error.message))}))}},{key:"uploadFileCsv",value:function(i){if(i.target.files&&i.target.files.length>0){var e=i.target.files[0];if(!e.name)return void this.messages.add(u.a.getToast("generic",u.b.error,u.a.FILE_TYPE(u.a.UPLOAD_FILE_TYPE_CSV)));if(!e.name.endsWith(u.a.UPLOAD_FILE_TYPE_CSV))return void this.messages.add(u.a.getToast("generic",u.b.error,u.a.FILE_TYPE(u.a.UPLOAD_FILE_TYPE_CSV)));"du"==this.typeImport?this.importDomandaUnica(e):"bdna"==this.typeImport&&this.importaEsitiBDNA(e)}}},{key:"openSOConsole",value:function(i){this.file.nativeElement.click(),this.typeImport=i}},{key:"visualizzaDettaglioDomanda",value:function(i,e){var t={queryParams:{activeIndex:e,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:2},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],t)}},{key:"insertSincronizzazioneAgs",value:function(i){var e=new Array;i&&(i.forEach((function(i){e.push({cuaa:i.cuaa,tipoDomanda:i.tipoDomanda,idDomanda:i.idDomanda,dtInizioEsitoNegativo:null,dtInizioSilenzioAssenso:null,dtFineEsitoNegativo:null,dtFineSilenzioAssenso:null})})),e&&this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(e))}},{key:"downloadDichiarazioneAntimafia",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction.id.toString(),t=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(e);this.dichiarazioneAntimafiaSubscpription=t.pipe(Object(p.a)((function(e){return i.antimafiaService.downloadDichiarazioneAntimafia(e.pdfFirmato,e.tipoPdfFirmato),Object(_.a)(e)}))).subscribe((function(e){var t=i.antimafiaService.getAllegati(e);i.antimafiaService.downloadAllegati(t)}))}},{key:"onDropdownMenuOpen",value:function(i,e,t){this.indexSelectedFromMenu=t,this.domandaAntimafiaSelezionataFromMenuAction=e,this.currentMenuAction=i,this.currentMenuAction.reset=!1}},{key:"buildMenuAction",value:function(){var i=this;return[{label:s.a.azioni.toUpperCase(),items:[{label:s.a.SCARICA,command:function(){i.downloadDichiarazioneAntimafia(),i.currentMenuAction.reset=!0}},{label:s.a.RIFIUTA,command:function(){i.openPopup(c.a.RIFIUTATA),i.currentMenuAction.reset=!0}},{label:s.a.ESITO_POSITIVO,command:function(){i.openPopup(c.a.POSITIVO),i.currentMenuAction.reset=!0}}]}]}},{key:"openPopup",value:function(i){this.statoDaAggiornare=i,this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(i)))}},{key:"onConfirmAggiornaStato",value:function(){switch(this.messages.clear(),this.statoDaAggiornare){case c.a.RIFIUTATA:this.popupComponent.open();break;case c.a.POSITIVO:this.esitoPositivo()}}},{key:"onRejectAggiornaStato",value:function(){this.messages.clear()}},{key:"esitoPositivo",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction;e.stato.descrizione=null,e.stato.id=null,e.stato.identificativo=c.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(e).subscribe((function(e){var t=new v(i.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);i.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe((function(e){e&&e.forEach((function(a){a.cuaa===t.cuaa&&(a.dtFineEsitoNegativo=null,a.dtFineSilenzioAssenso=null,a.dtInizioEsitoNegativo=null,a.dtInizioSilenzioAssenso=null),i.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(e)})),i.loadList(0,null)}),(function(i){return console.log(i)}))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))}))}},{key:"exportEsitiBdna",value:function(){var i=this;this.istruttoriaAntimafiaService.exportCsvEsitiBdna().subscribe((function(e){var t=i.getFileNameFromResponseContentDisposition(e);W.saveAs(e.body,t),i.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK))}),(function(e){console.log(e.error.error),i.messages.add(u.a.getToast("generic",u.b.error,u.a.ExportCsvKo))}))}},{key:"onC",value:function(){this.displayPopup=!1}},{key:"loadData",value:function(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){var e="";switch(i.sortField){case this.cols[0].field:e="cuaa";break;case this.cols[1].field:e="denominazioneImpresa";break;default:e=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(e)}this.loadList(i.first,i.globalFilter)}},{key:"loadList",value:function(i,e){var t=this;this.ricercaAntimafiaFilter.filtroGenerico=e||null,this.ricercaAntimafiaFilter.statoDichiarazione=c.a.CONTROLLATA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe((function(i){t.elementiTotali=i.total,t.certificazioniControllate=i.results?i.results:[],t.isEmpty=0===t.certificazioniControllate.length}),(function(i){console.log("error: "+i),t.isEmpty=!0}))}},{key:"buildDescrizioneTooltip",value:function(i){var e=i.esitoDescrizione;return("OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea||"ND"===i.esitoInvioAgea)&&(e+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?e+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(e+=" | ESITO INVIO A BDNA NON DISPONIBILE"),e}}]),i}()).\u0275fac=function(i){return new(i||Ii)(g.Nb(l.a),g.Nb(T.d),g.Nb(n.e),g.Nb(T.d),g.Nb(T.a),g.Nb(n.a),g.Nb(o.a),g.Nb(ri.a))},Ii.\u0275cmp=g.Hb({type:Ii,selectors:[["app-cert-amf-controllate"]],viewQuery:function(i,e){var t;1&i&&(g.Jc(bi,!0),g.Jc(oi,!0)),2&i&&(g.Ac(t=g.cc())&&(e.file=t.first),g.Ac(t=g.cc())&&(e.popupComponent=t.first))},inputs:{refreshFromParent:"refreshFromParent"},outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters",runStatoAvanzamentoProcesso:"runStatoAvanzamentoProcesso"},features:[g.zb],decls:101,vars:63,consts:[["key","tst"],["showEffect","fade",3,"visible","responsive","modal","closable","contentStyle","visibleChange"],[1,"p-grid","boxpopup"],["class","ui-g-12",4,"ngFor","ngForOf"],[1,"p-grid"],[1,"ui-g-6","text-left"],["pButton","","type","button",1,"btn-green",2,"min-height","42px","box-shadow","none",3,"label","click"],[1,"ui-g-6","text-right"],["pButton","","type","submit",1,"btn-green",2,"min-height","42px","box-shadow","none","margin-right","10px",3,"disabled","label","click"],[1,"ui-grid-fixed"],["position","top-center","key","generic",3,"baseZIndex"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","totalRecords","selectedItems","isSelectedAll","lazy","sizeArray","selectedItemsChange","isSelectedAllChange","onLazyLoadPage"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"ui-g"],[1,"ui-g-3","box-padded"],[1,"ui-g-11"],[1,"ui-g-11","box-padded"],[1,"ui-fluid",3,"label","onClick"],["type","file","onclick","this.value = null","accept",".csv",1,"inputUploadFile",2,"display","none",3,"change"],["file",""],[1,"ui-g-11","ui-fluid"],["placeholder","Seleziona CSV","name","trasmissioneBdnaSelected",3,"disabled","options","ngModel","ngModelChange"],[1,"ui-fluid",3,"label","disabled","onClick"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],["width","710","appendTo","body",3,"visible","modal","closable","focusOnShow","visibleChange"],["dialog",""],[1,"popup-istruttoria"],[1,"table","table-striped",2,"text-align","center"],[1,"badgesGreen"],[4,"ngFor","ngForOf"],[1,"ui-g-12"],["pButton","","type","button","label","CHIUDI",1,"annulla",3,"click"],[3,"dichiarazioneAntimafia","event"],["name","annoDiCampagna",3,"value","label","ngModel","inputId","ngModelChange"],[2,"width","3em"],[3,"pSortableColumnWrapper","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumnWrapper","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRowWrapper"],[3,"value"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){if(1&i){var t=g.Ub();g.Ob(0,"p-toast",0),g.Tb(1,"p-dialog",1),g.bc("visibleChange",(function(i){return e.dialogVisibile=i})),g.Tb(2,"div",2),g.Tb(3,"p-header"),g.Oc(4),g.gc(5,"uppercase"),g.gc(6,"translate"),g.Sb(),g.Mc(7,ui,2,4,"div",3),g.Sb(),g.Tb(8,"div",4),g.Tb(9,"div",5),g.Tb(10,"button",6),g.bc("click",(function(){return e.annullaImportPsrSuperficie()})),g.gc(11,"translate"),g.Sb(),g.Sb(),g.Tb(12,"div",7),g.Tb(13,"button",8),g.bc("click",(function(){return e.checkMassiveExport?e.confermaExportFileCSV():e.confermaImportPsrSuperficie()})),g.gc(14,"translate"),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(15,"div",9),g.Ob(16,"p-toast",10),g.Tb(17,"div",11),g.Tb(18,"h3"),g.Oc(19),g.Sb(),g.Tb(20,"div",12),g.Tb(21,"i",13),g.Oc(22,"search"),g.Sb(),g.Tb(23,"input",14),g.bc("input",(function(i){return g.Ec(t),g.Bc(25).filterGlobal(i.target.value,"contains")})),g.Sb(),g.Sb(),g.Tb(24,"app-a4g-paged-table",15,16),g.bc("selectedItemsChange",(function(i){return e.certificazioneProtocollateSelezionate=i}))("isSelectedAllChange",(function(i){return e.isSelectedAll=i}))("onLazyLoadPage",(function(i){return e.loadData(i)})),g.Mc(26,fi,8,3,"ng-template",17),g.Mc(27,hi,27,18,"ng-template",18),g.Mc(28,Si,3,2,"ng-template",19),g.Sb(),g.Tb(29,"div",20),g.Tb(30,"div",21),g.Tb(31,"div",22),g.Tb(32,"h5"),g.Oc(33),g.Sb(),g.Sb(),g.Tb(34,"div",23),g.Tb(35,"p-button",24),g.bc("onClick",(function(){return e.openDialog(!1)})),g.Sb(),g.Sb(),g.Tb(36,"div",23),g.Tb(37,"p-button",24),g.bc("onClick",(function(){return e.importStrutturaliEU()})),g.Sb(),g.Sb(),g.Tb(38,"div",23),g.Tb(39,"p-button",24),g.bc("onClick",(function(){return e.openSOConsole("du")})),g.Sb(),g.Tb(40,"input",25,26),g.bc("change",(function(i){return e.uploadFileCsv(i)})),g.Sb(),g.Sb(),g.Sb(),g.Tb(42,"div",21),g.Tb(43,"div",22),g.Tb(44,"h5"),g.Oc(45),g.Sb(),g.Sb(),g.Tb(46,"div",23),g.Tb(47,"p-button",24),g.bc("onClick",(function(){return e.openDialog(!0)})),g.Sb(),g.Sb(),g.Tb(48,"div",23),g.Tb(49,"p-button",24),g.bc("onClick",(function(){return e.exportFileCSV(e.tipoDomanda.PSR_STRUTTURALI_EU)})),g.Sb(),g.Sb(),g.Tb(50,"div",23),g.Tb(51,"p-button",24),g.bc("onClick",(function(){return e.exportFileCSV(e.tipoDomanda.DOMANDA_UNICA)})),g.Sb(),g.Sb(),g.Sb(),g.Tb(52,"div",21),g.Tb(53,"div",22),g.Tb(54,"h5"),g.Oc(55),g.Sb(),g.Sb(),g.Tb(56,"div",27),g.Tb(57,"p-dropdown",28),g.bc("ngModelChange",(function(i){return e.trasmissioneBdnaSelected=i})),g.Sb(),g.Sb(),g.Tb(58,"div",23),g.Tb(59,"p-button",29),g.bc("onClick",(function(){return e.conferma()})),g.Sb(),g.Sb(),g.Tb(60,"div",23),g.Tb(61,"p-button",29),g.bc("onClick",(function(){return e.annulla()})),g.Sb(),g.Sb(),g.Tb(62,"div",23),g.Tb(63,"p-button",29),g.bc("onClick",(function(){return e.scarica()})),g.Sb(),g.Sb(),g.Sb(),g.Tb(64,"div",21),g.Tb(65,"div",22),g.Tb(66,"h5"),g.Oc(67),g.Sb(),g.Sb(),g.Tb(68,"div",23),g.Tb(69,"p-button",24),g.bc("onClick",(function(){return e.openSOConsole("bdna")})),g.Sb(),g.Tb(70,"input",25,26),g.bc("change",(function(i){return e.uploadFileCsv(i)})),g.Sb(),g.Sb(),g.Tb(72,"div",23),g.Tb(73,"p-button",24),g.bc("onClick",(function(){return e.exportEsitiBdna()})),g.Sb(),g.Tb(74,"input",25,26),g.bc("change",(function(i){return e.uploadFileCsv(i)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(76,"p-toast",30),g.bc("onClose",(function(){return e.onRejectAggiornaStato()})),g.Mc(77,Ai,11,2,"ng-template",31),g.Sb(),g.Tb(78,"p-dialog",32,33),g.bc("visibleChange",(function(i){return e.displayPopup=i})),g.Tb(80,"div",34),g.Tb(81,"h1"),g.Oc(82,"ESITI IMPORTA DOMANDE"),g.Sb(),g.Tb(83,"table",35),g.Tb(84,"tr"),g.Tb(85,"th"),g.Oc(86,"Cuaa Domande aggiornate "),g.Tb(87,"span",36),g.Oc(88),g.Sb(),g.Sb(),g.Tb(89,"th"),g.Oc(90,"Cuaa Domande con errori "),g.Tb(91,"span",36),g.Oc(92),g.Sb(),g.Sb(),g.Sb(),g.Tb(93,"tr"),g.Tb(94,"td"),g.Mc(95,Ti,2,1,"div",37),g.Sb(),g.Tb(96,"td"),g.Mc(97,vi,2,1,"div",37),g.Sb(),g.Sb(),g.Sb(),g.Tb(98,"div",38),g.Tb(99,"button",39),g.bc("click",(function(){return e.onC()})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(100,"app-popup-rifiuta-domanda",40),g.bc("event",(function(){return e.loadList(0,null)})),g.Sb(),g.Sb()}2&i&&(g.Kc(g.rc(61,Oi)),g.Bb(1),g.mc("visible",e.dialogVisibile)("responsive",!0)("modal",!0)("closable",!1)("contentStyle",g.rc(62,zi)),g.Bb(3),g.Qc(" ",g.hc(5,53,g.hc(6,55,"ANNO_CAMPAGNA"))," "),g.Bb(3),g.mc("ngForOf",e.campagne),g.Bb(3),g.nc("label",g.hc(11,57,"NuovoFascicolo.ANNULLA")),g.Bb(3),g.nc("label",g.hc(14,59,"NuovoFascicolo.CONFERMA")),g.mc("disabled",0===e.selectedCampagna.length),g.Bb(3),g.mc("baseZIndex",5e4),g.Bb(3),g.Pc(e.textTitle),g.Bb(5),g.mc("columns",e.cols)("value",e.certificazioniControllate)("totalRecords",e.elementiTotali)("selectedItems",e.certificazioneProtocollateSelezionate)("isSelectedAll",e.isSelectedAll)("lazy",!0)("sizeArray",e.intestazioni.sizePerPagina),g.Bb(9),g.Pc(e.intestazioni.ACQUISIZIONE_DATI_DOMANDE),g.Bb(2),g.nc("label",e.intestazioni.IMPORTA_DATI_PSR_SUPERFICIE_EU),g.Bb(2),g.nc("label",e.intestazioni.IMPORTA_DATI_PSR_STRUTTURALI_EU),g.Bb(2),g.nc("label",e.intestazioni.IMPORTA_DATI_DOMANDA_UNICA),g.Bb(6),g.Pc(e.intestazioni.ESPORTATIONI_MASSIVE_DATI_BDNA),g.Bb(2),g.nc("label",e.intestazioni.ESPORTA_DATI_PSR_SUPERFICIE_EU),g.Bb(2),g.nc("label",e.intestazioni.ESPORTA_DATI_PSR_STRUTTURALI_EU),g.Bb(2),g.nc("label",e.intestazioni.ESPORTA_DATI_DOMANDA_UNICA),g.Bb(4),g.Pc(e.intestazioni.CONFERMA_IMPORTAZIONE_BDNA),g.Bb(2),g.mc("disabled",0==e.elencoCsvDaConfermare.length)("options",e.elencoCsvDaConfermare)("ngModel",e.trasmissioneBdnaSelected),g.Bb(2),g.nc("label",e.intestazioni.CONFERMA),g.mc("disabled",!e.trasmissioneBdnaSelected),g.Bb(2),g.nc("label",e.intestazioni.ANNULLA),g.mc("disabled",!e.trasmissioneBdnaSelected),g.Bb(2),g.nc("label",e.intestazioni.SCARICA),g.mc("disabled",!e.trasmissioneBdnaSelected),g.Bb(4),g.Pc(e.intestazioni.IMPORTANZIONE_ESITI_BDNA),g.Bb(2),g.nc("label",e.intestazioni.IMPORTA_ESITI_BDNA),g.Bb(4),g.nc("label",e.intestazioni.ESPORTA_ESITI_BDNA),g.Bb(3),g.mc("modal",!0)("baseZIndex",5e3),g.Bb(2),g.mc("visible",e.displayPopup)("modal",!0)("closable",!0)("focusOnShow",!1),g.Bb(10),g.Pc(e.esitiBdna.domandeAggiornate?e.esitiBdna.domandeAggiornate.length:0),g.Bb(4),g.Pc(e.esitiBdna.domandeConErrori?e.esitiBdna.domandeConErrori.length:0),g.Bb(3),g.mc("ngForOf",e.esitiBdna.domandeAggiornate),g.Bb(2),g.mc("ngForOf",e.esitiBdna.domandeConErrori),g.Bb(3),g.mc("dichiarazioneAntimafia",e.domandaAntimafiaSelezionataFromMenuAction))},directives:[O.a,ai.a,T.c,a.s,D.b,z.a,w.b,T.e,D.a,li.a,ni.s,ni.v,oi,di.a,w.a,w.f,w.e,w.d,w.g,a.t,P.a,U.a],pipes:[a.G,S.d,a.f],styles:[".boxgrey[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#0d5f3f;font-weight:700;font-size:18px;text-transform:uppercase;padding-bottom:10px;margin-bottom:15px}.boxgrey[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > h5[_ngcontent-%COMP%]{border-bottom:2px solid #0d5f3f}.boxgrey[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{display:inline!important}.badgesGreen[_ngcontent-%COMP%]{background:#00985a;line-height:0;color:#fff;font-size:13px;border-radius:30px;display:inline;padding:0 7px}.checkbox[_ngcontent-%COMP%]{padding:10px}",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),Ii);function Di(i,e){if(1&i&&(g.Tb(0,"th",16),g.Oc(1),g.Ob(2,"p-sortIcon",17),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.field)}}function Pi(i,e){if(1&i&&(g.Tb(0,"tr"),g.Mc(1,Di,3,4,"th",14),g.Tb(2,"th",15),g.Oc(3),g.Sb(),g.Tb(4,"th",15),g.Oc(5),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.mc("ngForOf",t),g.Bb(2),g.Qc(" ",a.labels.collegate," "),g.Bb(2),g.Qc(" ",a.labels.azioni," ")}}function yi(i,e){if(1&i&&g.Ob(0,"div",30),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function Bi(i,e){if(1&i&&g.Ob(0,"div",31),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function Ni(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr",18),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.gc(7,"date"),g.Sb(),g.Tb(8,"td"),g.Oc(9),g.Sb(),g.Tb(10,"td"),g.Tb(11,"div",19),g.Mc(12,yi,1,1,"div",20),g.Mc(13,Bi,1,1,"div",21),g.Sb(),g.Sb(),g.Tb(14,"td",22),g.Tb(15,"div",23),g.Tb(16,"div",24),g.Tb(17,"p-button",25),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,0)})),g.Sb(),g.Sb(),g.Tb(18,"div",24),g.Tb(19,"p-button",26),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,1)})),g.Sb(),g.Sb(),g.Tb(20,"div",24),g.Tb(21,"p-button",27),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,2)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(22,"td"),g.Tb(23,"action-menu",28,29),g.bc("click",(function(){g.Ec(t);var i=e.$implicit,a=e.rowIndex,n=g.Bc(24);return g.fc().onDropdownMenuOpen(n,i,a)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.mc("pSelectableRow",a),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.codiceFiscale),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.denominazione),g.Bb(2),g.Pc(g.ic(7,14,a.dtProtocollazione,"dd/MM/yyyy")),g.Bb(3),g.Pc(a.idProtocollo),g.Bb(3),g.mc("ngIf","OK"===a.esito),g.Bb(1),g.mc("ngIf","KO"===a.esito),g.Bb(4),g.nc("title",n.labels.DOMANDE_SUPERFICIE_EU),g.mc("disabled",!(a.idsDomandaSuperficie.length>0)),g.Bb(2),g.nc("title",n.labels.DOMANDE_STRUTTURALI_EU),g.mc("disabled",!(a.idsDomandaStrutturale.length>0)),g.Bb(2),g.nc("title",n.labels.DOMANDE_UNICHE),g.mc("disabled",!(a.idsDomandaDu.length>0)),g.Bb(2),g.mc("item",n.menuAction)}}function Mi(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.Cb("colspan",t.length+3),g.Bb(1),g.Qc(" ",a.labels.noTableContent," ")}}function Ei(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",32),g.Ob(1,"i",33),g.Tb(2,"h3"),g.Oc(3),g.Sb(),g.Tb(4,"p"),g.Oc(5),g.Sb(),g.Sb(),g.Tb(6,"div",34),g.Tb(7,"div",35),g.Tb(8,"button",36),g.bc("click",(function(){return g.Ec(t),g.fc().onConfirmAggiornaStato()})),g.Sb(),g.Sb(),g.Tb(9,"div",35),g.Tb(10,"button",37),g.bc("click",(function(){return g.Ec(t),g.fc().onRejectAggiornaStato()})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit;g.Bb(3),g.Pc(a.summary),g.Bb(2),g.Pc(a.detail)}}var Fi,ki=((Fi=function(){function i(e,t,a,n,o,c){_classCallCheck(this,i),this.istruttoriaAntimafiaService=e,this.antimafiaService=t,this.messages=a,this.loader=n,this.router=o,this.route=c,this.labels=s.a,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new g.n,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new I,this.elementiTotali=0,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.labels.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.labels.descrizioneImpresa},{field:"dtProtocollazione",header:this.labels.data},{field:"idProtocollo",header:this.labels.nrProtocollo},{field:"esito",header:this.labels.esitoTrasmissione}]}return _createClass(i,[{key:"ngOnInit",value:function(){this.loader.setTimeout(48e4),this.menuAction=this.menuActionProtocollata(),this.textTitle=s.a.CONTROLLO_CERTIFICAZIONE_ANTIMAFIA_CONTROLLO_MANUALE}},{key:"ngOnDestroy",value:function(){this.loader.resetTimeout(),this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}},{key:"onDropdownMenuOpen",value:function(i,e,t){this.indexSelectedFromMenu=t,this.domandaAntimafiaSelezionataFromMenuAction=e,this.currentMenuAction=i,this.currentMenuAction.reset=!1}},{key:"menuActionProtocollata",value:function(){var i=this;return[{label:s.a.azioni.toUpperCase(),items:[{label:this.labels.ESITO_CONTROLLO,command:function(){i.getEsitoControlloAntimafia(),i.currentMenuAction.reset=!0}},{separator:!0},{label:this.labels.SCARICA,command:function(){i.downloadDomandaCertificazioneAntimafia(),i.currentMenuAction.reset=!0}},{label:this.labels.RIFIUTA,command:function(){i.openPopup(c.a.RIFIUTATA),i.currentMenuAction.reset=!0}},{label:this.labels.APPROVA,command:function(){i.approvaDomandaControllataManualmente(),i.currentMenuAction.reset=!0}},{label:s.a.ESITO_POSITIVO,command:function(){i.openPopup(c.a.POSITIVO),i.currentMenuAction.reset=!0}}]}]}},{key:"getEsitoControlloAntimafia",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale;this.antimafiaService.getEsitoControlloAntimafia(this.domandaAntimafiaSelezionataFromMenuAction.id).subscribe((function(t){t.domandeGestite.forEach((function(t){var a=JSON.parse(t);if(i.messages.add(u.a.getToast("generic",u.b.info,a.parixMessage?a.parixMessage:e+" valido in Parix")),i.messages.add(u.a.getToast("generic",u.b.info,a.siapMessage?a.siapMessage:e+" valido in Siap")),a.soggettiMessages){var n="";a.soggettiMessages.forEach((function(i){n+=i})),i.messages.add(u.a.getToast("generic",u.b.info,n))}else i.messages.add(u.a.getToast("generic",u.b.info,"Tutti i soggetti con carica validi in Parix"))}))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,e.error.message))}))}},{key:"downloadDomandaCertificazioneAntimafia",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction,t=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(e.id.toString());this.dichiarazioneAntimafiaSubscpription=t.pipe(Object(p.a)((function(t){return e.pdfFirmato=t.pdfFirmato,i.antimafiaService.downloadDichiarazioneAntimafia(t.pdfFirmato,t.tipoPdfFirmato),Object(_.a)(t)}))).subscribe((function(e){var t=i.antimafiaService.getAllegati(e);i.antimafiaService.downloadAllegati(t)}))}},{key:"approvaDomandaControllataManualmente",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction;e.stato.identificativo=c.a.CONTROLLATA,this.antimafiaService.aggiornaDichiarazioneAntimafia(e).subscribe((function(e){e.dichiarazione.stato.identificativo.toString()==c.a.CONTROLLATA?(i.messages.add(u.a.getToast("generic",u.b.success,u.a.OPERAZIONE_OK)),i.certificazioneAntimafia.splice(i.indexSelectedFromMenu,1),i.aggiornaCertificazioniCounters.emit()):i.messages.add(u.a.getToast("generic",u.b.error,"Passaggio di stato della domanda non riuscito"))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,"Passaggio di stato della domanda non riuscito"))}))}},{key:"openPopup",value:function(i){this.statoDaAggiornare=i,this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(i)))}},{key:"onConfirmAggiornaStato",value:function(){switch(this.messages.clear(),this.statoDaAggiornare){case c.a.RIFIUTATA:this.popupComponent.open();break;case c.a.POSITIVO:this.esitoPositivo()}}},{key:"onRejectAggiornaStato",value:function(){this.messages.clear()}},{key:"aggiornaTabella",value:function(){this.aggiornaCertificazioniCounters.emit(),this.certificazioneAntimafia.splice(this.indexSelectedFromMenu,1)}},{key:"visualizzaDettaglioDomanda",value:function(i,e){var t={queryParams:{activeIndex:e,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:3},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],t)}},{key:"esitoPositivo",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction;e.stato.descrizione=null,e.stato.id=null,e.stato.identificativo=c.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(e).subscribe((function(e){var t=new v(i.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);i.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe((function(e){e&&e.forEach((function(a){a.cuaa===t.cuaa&&(a.dtFineEsitoNegativo=null,a.dtFineSilenzioAssenso=null,a.dtInizioEsitoNegativo=null,a.dtInizioSilenzioAssenso=null),i.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(e)})),i.aggiornaTabella()}),(function(i){return console.log(i)}))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))}))}},{key:"loadData",value:function(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){var e="";switch(i.sortField){case this.cols[0].field:e="cuaa";break;case this.cols[1].field:e="denominazioneImpresa";break;default:e=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(e)}this.loadList(i.first,i.globalFilter)}},{key:"loadList",value:function(i,e){var t=this;this.ricercaAntimafiaFilter.filtroGenerico=e||null,this.ricercaAntimafiaFilter.statoDichiarazione=c.a.CONTROLLO_MANUALE,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe((function(i){t.elementiTotali=i.total,t.certificazioneAntimafia=i.results?i.results:[]}),(function(i){console.log("error: "+i)}))}},{key:"buildDescrizioneTooltip",value:function(i){var e=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?e+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(e+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?e+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(e+=" | ESITO INVIO A BDNA NON DISPONIBILE"),e}}]),i}()).\u0275fac=function(i){return new(i||Fi)(g.Nb(l.a),g.Nb(o.a),g.Nb(T.d),g.Nb(ti.a),g.Nb(n.e),g.Nb(n.a))},Fi.\u0275cmp=g.Hb({type:Fi,selectors:[["app-cert-amf-controllo-manuale"]],viewQuery:function(i,e){var t;1&i&&g.Jc(oi,!0),2&i&&g.Ac(t=g.cc())&&(e.popupComponent=t.first)},outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters"},decls:17,vars:14,consts:[[1,"ui-grid-fixed"],["position","top-center","key","generic",3,"baseZIndex"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"dichiarazioneAntimafia","event"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",0),g.Ob(1,"p-toast",1),g.Tb(2,"div",2),g.Tb(3,"h3"),g.Oc(4),g.Sb(),g.Tb(5,"div",3),g.Tb(6,"i",4),g.Oc(7,"search"),g.Sb(),g.Tb(8,"input",5),g.bc("input",(function(i){return g.Ec(t),g.Bc(10).filterGlobal(i.target.value,"contains")})),g.Sb(),g.Sb(),g.Tb(9,"p-table",6,7),g.bc("onLazyLoad",(function(i){return e.loadData(i)})),g.Mc(11,Pi,6,3,"ng-template",8),g.Mc(12,Ni,25,17,"ng-template",9),g.Mc(13,Mi,3,2,"ng-template",10),g.Sb(),g.Sb(),g.Tb(14,"app-popup-rifiuta-domanda",11),g.bc("event",(function(){return e.aggiornaTabella()})),g.Sb(),g.Tb(15,"p-toast",12),g.bc("onClose",(function(){return e.onRejectAggiornaStato()})),g.Mc(16,Ei,11,2,"ng-template",13),g.Sb(),g.Sb()}2&i&&(g.Bb(1),g.mc("baseZIndex",5e4),g.Bb(3),g.Pc(e.textTitle),g.Bb(5),g.mc("columns",e.cols)("value",e.certificazioneAntimafia)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",e.elementiTotali)("rowsPerPageOptions",e.labels.sizePerPagina),g.Bb(5),g.mc("dichiarazioneAntimafia",e.domandaAntimafiaSelezionataFromMenuAction),g.Bb(1),g.mc("modal",!0)("baseZIndex",5e3))},directives:[O.a,z.a,C.q,T.e,oi,a.s,C.p,C.o,C.m,a.t,D.a,P.a,U.a,D.b],pipes:[a.f],styles:["",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),Fi),Ri=t("8KUc");function _i(i,e){if(1&i&&(g.Tb(0,"th",15),g.Oc(1),g.Ob(2,"p-sortIcon",16),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.field)}}function wi(i,e){if(1&i&&(g.Tb(0,"tr"),g.Mc(1,_i,3,4,"th",13),g.Tb(2,"th",14),g.Oc(3),g.Sb(),g.Tb(4,"th",14),g.Oc(5),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.mc("ngForOf",t),g.Bb(2),g.Qc(" ",a.labels.collegate," "),g.Bb(2),g.Qc(" ",a.labels.azioni," ")}}function xi(i,e){if(1&i&&g.Ob(0,"div",29),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function Ui(i,e){if(1&i&&g.Ob(0,"div",30),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function Li(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr",17),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.gc(7,"date"),g.Sb(),g.Tb(8,"td"),g.Oc(9),g.Sb(),g.Tb(10,"td"),g.Tb(11,"div",18),g.Mc(12,xi,1,1,"div",19),g.Mc(13,Ui,1,1,"div",20),g.Sb(),g.Sb(),g.Tb(14,"td",21),g.Tb(15,"div",22),g.Tb(16,"div",23),g.Tb(17,"p-button",24),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,0)})),g.Sb(),g.Sb(),g.Tb(18,"div",23),g.Tb(19,"p-button",25),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,1)})),g.Sb(),g.Sb(),g.Tb(20,"div",23),g.Tb(21,"p-button",26),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,2)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(22,"td"),g.Tb(23,"action-menu",27,28),g.bc("click",(function(){g.Ec(t);var i=e.$implicit,a=e.rowIndex,n=g.Bc(24);return g.fc().onDropdownMenuOpen(n,i,a)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.mc("pSelectableRow",a),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.codiceFiscale),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.denominazione),g.Bb(2),g.Pc(g.ic(7,14,a.dtProtocollazione,"dd/MM/yyyy")),g.Bb(3),g.Pc(a.idProtocollo),g.Bb(3),g.mc("ngIf","OK"===a.esito),g.Bb(1),g.mc("ngIf","KO"===a.esito),g.Bb(4),g.nc("title",n.labels.DOMANDE_SUPERFICIE_EU),g.mc("disabled",!(a.idsDomandaSuperficie.length>0)),g.Bb(2),g.nc("title",n.labels.DOMANDE_STRUTTURALI_EU),g.mc("disabled",!(a.idsDomandaStrutturale.length>0)),g.Bb(2),g.nc("title",n.labels.DOMANDE_UNICHE),g.mc("disabled",!(a.idsDomandaDu.length>0)),g.Bb(2),g.mc("item",n.menuAction)}}function Vi(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.Cb("colspan",t.length+3),g.Bb(1),g.Qc(" ",a.labels.noTableContent," ")}}function $i(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",31),g.Ob(1,"i",32),g.Tb(2,"h3"),g.Oc(3),g.Sb(),g.Tb(4,"p"),g.Oc(5),g.Sb(),g.Sb(),g.Tb(6,"div",33),g.Tb(7,"div",34),g.Tb(8,"button",35),g.bc("click",(function(){return g.Ec(t),g.fc().onConfirmAggiornaStato()})),g.Sb(),g.Sb(),g.Tb(9,"div",34),g.Tb(10,"button",36),g.bc("click",(function(){return g.Ec(t),g.fc().onRejectAggiornaStato()})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit;g.Bb(3),g.Pc(a.summary),g.Bb(2),g.Pc(a.detail)}}var Gi,Zi=((Gi=function(){function i(e,t,a,n,o){_classCallCheck(this,i),this.antimafiaService=e,this.istruttoriaAntimafiaService=t,this.messages=a,this.router=n,this.route=o,this.labels=s.a,this.textTitle=s.a.CERTIFICAZIONI_ANTIMAFIA_RIFIUTATE,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new g.n,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new I,this.elementiTotali=0,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.labels.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.labels.descrizioneImpresa},{field:"dtProtocollazione",header:this.labels.data},{field:"idProtocollo",header:this.labels.nrProtocollo},{field:"esito",header:this.labels.esitoTrasmissione}]}return _createClass(i,[{key:"ngOnInit",value:function(){this.menuAction=this.menuActionDisplay()}},{key:"ngOnDestroy",value:function(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}},{key:"menuActionDisplay",value:function(){var i=this;return[{label:s.a.azioni.toUpperCase(),items:[{label:this.labels.DETTAGLIO_RIFIUTO,command:function(){i.dettaglioRifiuto(),i.currentMenuAction.reset=!0}},{separator:!0},{label:this.labels.SCARICA,command:function(){i.downloadDichiarazioneAntimafia(),i.currentMenuAction.reset=!0}},{label:s.a.ESITO_POSITIVO,command:function(){i.openPopupEsitoPositivo(),i.currentMenuAction.reset=!0}}]}]}},{key:"onDropdownMenuOpen",value:function(i,e,t){this.indexSelectedFromMenu=t,this.domandaAntimafiaSelezionataFromMenuAction=e,this.currentMenuAction=i,this.currentMenuAction.reset=!1}},{key:"dettaglioRifiuto",value:function(){var i=this;this.antimafiaService.getNoteDichiarazioneAntimafia(this.domandaAntimafiaSelezionataFromMenuAction.id,Ri.a.RIFIUTO_DICHIARAZIONE_ANTIMAFIA).subscribe((function(e){u.a.isUndefinedOrNull(e)||e.forEach((function(e){var t=JSON.parse(e.nota);u.a.isUndefinedOrNull(e)||u.a.isUndefinedOrNull(t)||(u.a.isUndefinedOrNull(t.nrProtocolloComunicazione)||i.messages.add(u.a.getToast("generic",u.b.info,s.a.COMUNICAZIONE_NR_PROTOCOLLO+": "+t.nrProtocolloComunicazione)),u.a.isUndefinedOrNull(t.noteDiChiusura)||i.messages.add(u.a.getToast("generic",u.b.info,s.a.NOTE_DI_CHIUSURA+": "+t.noteDiChiusura)))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,e.error.message))}))}))}},{key:"downloadDichiarazioneAntimafia",value:function(){var i=this,e=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(this.domandaAntimafiaSelezionataFromMenuAction.id.toString());this.dichiarazioneAntimafiaSubscpription=e.pipe(Object(p.a)((function(e){return i.antimafiaService.downloadDichiarazioneAntimafia(e.pdfFirmato,e.tipoPdfFirmato),Object(_.a)(e)}))).subscribe((function(e){var t=i.antimafiaService.getAllegati(e);i.antimafiaService.downloadAllegati(t)}))}},{key:"visualizzaDettaglioDomanda",value:function(i,e){var t={queryParams:{activeIndex:e,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:4},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],t)}},{key:"openPopupEsitoPositivo",value:function(){this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(c.a.POSITIVO)))}},{key:"onConfirmAggiornaStato",value:function(){this.messages.clear(),this.esitoPositivo()}},{key:"onRejectAggiornaStato",value:function(){this.messages.clear()}},{key:"esitoPositivo",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction;e.stato.descrizione=null,e.stato.id=null,e.stato.identificativo=c.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(e).subscribe((function(e){var t=new v(i.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);i.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe((function(e){e&&e.forEach((function(a){a.cuaa===t.cuaa&&(a.dtFineEsitoNegativo=null,a.dtFineSilenzioAssenso=null,a.dtInizioEsitoNegativo=null,a.dtInizioSilenzioAssenso=null),i.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(e)})),i.loadList(0,null)}),(function(i){return console.log(i)}))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))}))}},{key:"loadData",value:function(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){var e="";switch(i.sortField){case this.cols[0].field:e="cuaa";break;case this.cols[1].field:e="denominazioneImpresa";break;default:e=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(e)}this.loadList(i.first,i.globalFilter)}},{key:"loadList",value:function(i,e){var t=this;this.ricercaAntimafiaFilter.filtroGenerico=e||null,this.ricercaAntimafiaFilter.statoDichiarazione=c.a.RIFIUTATA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe((function(i){t.elementiTotali=i.total,t.certificazioneAntimafia=i.results?i.results:[]}),(function(i){console.log("error: "+i)}))}},{key:"buildDescrizioneTooltip",value:function(i){var e=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?e+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(e+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?e+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(e+=" | ESITO INVIO A BDNA NON DISPONIBILE"),e}}]),i}()).\u0275fac=function(i){return new(i||Gi)(g.Nb(o.a),g.Nb(l.a),g.Nb(T.d),g.Nb(n.e),g.Nb(n.a))},Gi.\u0275cmp=g.Hb({type:Gi,selectors:[["app-cert-amf-rifiutate"]],outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters"},decls:16,vars:13,consts:[[1,"ui-grid-fixed"],["position","top-center","key","generic",3,"baseZIndex"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",0),g.Ob(1,"p-toast",1),g.Tb(2,"div",2),g.Tb(3,"h3"),g.Oc(4),g.Sb(),g.Tb(5,"div",3),g.Tb(6,"i",4),g.Oc(7,"search"),g.Sb(),g.Tb(8,"input",5),g.bc("input",(function(i){return g.Ec(t),g.Bc(10).filterGlobal(i.target.value,"contains")})),g.Sb(),g.Sb(),g.Tb(9,"p-table",6,7),g.bc("onLazyLoad",(function(i){return e.loadData(i)})),g.Mc(11,wi,6,3,"ng-template",8),g.Mc(12,Li,25,17,"ng-template",9),g.Mc(13,Vi,3,2,"ng-template",10),g.Sb(),g.Sb(),g.Tb(14,"p-toast",11),g.bc("onClose",(function(){return e.onRejectAggiornaStato()})),g.Mc(15,$i,11,2,"ng-template",12),g.Sb(),g.Sb()}2&i&&(g.Bb(1),g.mc("baseZIndex",5e4),g.Bb(3),g.Pc(e.textTitle),g.Bb(5),g.mc("columns",e.cols)("value",e.certificazioneAntimafia)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",e.elementiTotali)("rowsPerPageOptions",e.labels.sizePerPagina),g.Bb(5),g.mc("modal",!0)("baseZIndex",5e3))},directives:[O.a,z.a,C.q,T.e,a.s,C.p,C.o,C.m,a.t,D.a,P.a,U.a,D.b],pipes:[a.f],styles:["",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),Gi);function Ki(i,e){if(1&i&&(g.Tb(0,"th",13),g.Oc(1),g.Ob(2,"p-sortIcon",14),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.field)}}function ji(i,e){if(1&i&&(g.Tb(0,"tr"),g.Mc(1,Ki,3,4,"th",11),g.Tb(2,"th",12),g.Oc(3),g.Sb(),g.Tb(4,"th",12),g.Oc(5),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.mc("ngForOf",t),g.Bb(2),g.Qc(" ",a.labels.collegate," "),g.Bb(2),g.Qc(" ",a.labels.azioni," ")}}function Qi(i,e){if(1&i&&g.Ob(0,"div",27),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function Ji(i,e){if(1&i&&g.Ob(0,"div",28),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function Hi(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr",15),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.gc(7,"date"),g.Sb(),g.Tb(8,"td"),g.Oc(9),g.Sb(),g.Tb(10,"td"),g.Tb(11,"div",16),g.Mc(12,Qi,1,1,"div",17),g.Mc(13,Ji,1,1,"div",18),g.Sb(),g.Sb(),g.Tb(14,"td",19),g.Tb(15,"div",20),g.Tb(16,"div",21),g.Tb(17,"p-button",22),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,0)})),g.Sb(),g.Sb(),g.Tb(18,"div",21),g.Tb(19,"p-button",23),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,1)})),g.Sb(),g.Sb(),g.Tb(20,"div",21),g.Tb(21,"p-button",24),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,2)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(22,"td"),g.Tb(23,"action-menu",25,26),g.bc("click",(function(){g.Ec(t);var i=e.$implicit,a=e.rowIndex,n=g.Bc(24);return g.fc().onDropdownMenuOpen(n,i,a)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.mc("pSelectableRow",a),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.codiceFiscale),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.denominazione),g.Bb(2),g.Pc(g.ic(7,14,a.dtProtocollazione,"dd/MM/yyyy")),g.Bb(3),g.Pc(a.idProtocollo),g.Bb(3),g.mc("ngIf","OK"===a.esito),g.Bb(1),g.mc("ngIf","KO"===a.esito),g.Bb(4),g.nc("title",n.labels.DOMANDE_SUPERFICIE_EU),g.mc("disabled",!(a.idsDomandaSuperficie.length>0)),g.Bb(2),g.nc("title",n.labels.DOMANDE_STRUTTURALI_EU),g.mc("disabled",!(a.idsDomandaStrutturale.length>0)),g.Bb(2),g.nc("title",n.labels.DOMANDE_UNICHE),g.mc("disabled",!(a.idsDomandaDu.length>0)),g.Bb(2),g.mc("item",n.menuAction)}}function qi(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.Cb("colspan",t.length+3),g.Bb(1),g.Qc(" ",a.labels.noTableContent," ")}}var Wi,Yi=((Wi=function(){function i(e,t,a,n){_classCallCheck(this,i),this.istruttoriaAntimafiaService=e,this.antimafiaService=t,this.route=a,this.router=n,this.labels=s.a,this.menuAction=new Array,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new I,this.elementiTotali=0,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.labels.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.labels.descrizioneImpresa},{field:"dtProtocollazione",header:this.labels.data},{field:"idProtocollo",header:this.labels.nrProtocollo},{field:"esito",header:this.labels.esitoTrasmissione}]}return _createClass(i,[{key:"onDropdownMenuOpen",value:function(i,e,t){this.indexSelectedFromMenu=t,this.domandaAntimafiaSelezionataFromMenuAction=e,this.currentMenuAction=i}},{key:"menuActionDisplay",value:function(){var i=this;return[{label:s.a.azioni.toUpperCase(),items:[{label:this.labels.SCARICA,command:function(){i.downloadDichiarazioneAntimafia(),i.currentMenuAction.reset=!0}}]}]}},{key:"ngOnInit",value:function(){this.menuAction=this.menuActionDisplay(),this.textTitle=s.a.CERTIFICAZIONI_ANTIMAFIA_POSITIVE}},{key:"ngOnDestroy",value:function(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}},{key:"downloadDichiarazioneAntimafia",value:function(){var i=this,e=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(this.domandaAntimafiaSelezionataFromMenuAction.id.toString());this.dichiarazioneAntimafiaSubscpription=e.pipe(Object(p.a)((function(e){return i.antimafiaService.downloadDichiarazioneAntimafia(e.pdfFirmato,e.tipoPdfFirmato),Object(_.a)(e)}))).subscribe((function(e){var t=i.antimafiaService.getAllegati(e);i.antimafiaService.downloadAllegati(t)}))}},{key:"visualizzaDettaglioDomanda",value:function(i,e){var t={queryParams:{activeIndex:e,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:5},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],t)}},{key:"loadData",value:function(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){var e="";switch(i.sortField){case this.cols[0].field:e="cuaa";break;case this.cols[1].field:e="denominazioneImpresa";break;default:e=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(e)}this.loadList(i.first,i.globalFilter)}},{key:"loadList",value:function(i,e){var t=this;this.ricercaAntimafiaFilter.filtroGenerico=e||null,this.ricercaAntimafiaFilter.statoDichiarazione=c.a.POSITIVO,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe((function(i){t.elementiTotali=i.total,t.certificazioneAntimafia=i.results?i.results:[]}),(function(i){console.log("error: "+i)}))}},{key:"buildDescrizioneTooltip",value:function(i){var e=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?e+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(e+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?e+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(e+=" | ESITO INVIO A BDNA NON DISPONIBILE"),e}}]),i}()).\u0275fac=function(i){return new(i||Wi)(g.Nb(l.a),g.Nb(o.a),g.Nb(n.a),g.Nb(n.e))},Wi.\u0275cmp=g.Hb({type:Wi,selectors:[["app-cert-amf-esito-positivo"]],decls:14,vars:11,consts:[[1,"ui-grid-fixed"],["position","top-center","key","generic",3,"baseZIndex"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"]],template:function(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",0),g.Ob(1,"p-toast",1),g.Tb(2,"div",2),g.Tb(3,"h3"),g.Oc(4),g.Sb(),g.Tb(5,"div",3),g.Tb(6,"i",4),g.Oc(7,"search"),g.Sb(),g.Tb(8,"input",5),g.bc("input",(function(i){return g.Ec(t),g.Bc(10).filterGlobal(i.target.value,"contains")})),g.Sb(),g.Sb(),g.Tb(9,"p-table",6,7),g.bc("onLazyLoad",(function(i){return e.loadData(i)})),g.Mc(11,ji,6,3,"ng-template",8),g.Mc(12,Hi,25,17,"ng-template",9),g.Mc(13,qi,3,2,"ng-template",10),g.Sb(),g.Sb(),g.Sb()}2&i&&(g.Bb(1),g.mc("baseZIndex",5e4),g.Bb(3),g.Pc(e.textTitle),g.Bb(5),g.mc("columns",e.cols)("value",e.certificazioneAntimafia)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",e.elementiTotali)("rowsPerPageOptions",e.labels.sizePerPagina))},directives:[O.a,z.a,C.q,T.e,a.s,C.p,C.o,C.m,a.t,D.a,P.a,U.a],pipes:[a.f],styles:["",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),Wi);function Xi(i,e){if(1&i&&(g.Tb(0,"th",15),g.Oc(1),g.Ob(2,"p-sortIcon",16),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.field)}}function ie(i,e){if(1&i&&(g.Tb(0,"tr"),g.Mc(1,Xi,3,4,"th",13),g.Tb(2,"th",14),g.Oc(3),g.Sb(),g.Tb(4,"th",14),g.Oc(5),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.mc("ngForOf",t),g.Bb(2),g.Qc(" ",a.labels.collegate," "),g.Bb(2),g.Qc(" ",a.labels.azioni," ")}}function ee(i,e){if(1&i&&g.Ob(0,"div",29),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function te(i,e){if(1&i&&g.Ob(0,"div",30),2&i){var t=g.fc().$implicit,a=g.fc();g.mc("pTooltip",a.buildDescrizioneTooltip(t))}}function ae(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr",17),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.gc(7,"date"),g.Sb(),g.Tb(8,"td"),g.Oc(9),g.Sb(),g.Tb(10,"td"),g.Tb(11,"div",18),g.Mc(12,ee,1,1,"div",19),g.Mc(13,te,1,1,"div",20),g.Sb(),g.Sb(),g.Tb(14,"td",21),g.Tb(15,"div",22),g.Tb(16,"div",23),g.Tb(17,"p-button",24),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,0)})),g.Sb(),g.Sb(),g.Tb(18,"div",23),g.Tb(19,"p-button",25),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,1)})),g.Sb(),g.Sb(),g.Tb(20,"div",23),g.Tb(21,"p-button",26),g.bc("onClick",(function(){g.Ec(t);var i=e.$implicit;return g.fc().visualizzaDettaglioDomanda(i,2)})),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(22,"td"),g.Tb(23,"action-menu",27,28),g.bc("click",(function(){g.Ec(t);var i=e.$implicit,a=e.rowIndex,n=g.Bc(24);return g.fc().onDropdownMenuOpen(n,i,a)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.mc("pSelectableRow",a),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.codiceFiscale),g.Bb(2),g.Pc(a.datiDichiarazione.dettaglioImpresa.denominazione),g.Bb(2),g.Pc(g.ic(7,14,a.dtProtocollazione,"dd/MM/yyyy")),g.Bb(3),g.Pc(a.idProtocollo),g.Bb(3),g.mc("ngIf","OK"===a.esito),g.Bb(1),g.mc("ngIf","KO"===a.esito),g.Bb(4),g.nc("title",n.labels.DOMANDE_SUPERFICIE_EU),g.mc("disabled",!(a.idsDomandaSuperficie.length>0)),g.Bb(2),g.nc("title",n.labels.DOMANDE_STRUTTURALI_EU),g.mc("disabled",!(a.idsDomandaStrutturale.length>0)),g.Bb(2),g.nc("title",n.labels.DOMANDE_UNICHE),g.mc("disabled",!(a.idsDomandaDu.length>0)),g.Bb(2),g.mc("item",n.menuAction)}}function ne(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=e.$implicit,a=g.fc();g.Bb(1),g.Cb("colspan",t.length+3),g.Bb(1),g.Qc(" ",a.labels.noTableContent," ")}}function oe(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",31),g.Ob(1,"i",32),g.Tb(2,"h3"),g.Oc(3),g.Sb(),g.Tb(4,"p"),g.Oc(5),g.Sb(),g.Sb(),g.Tb(6,"div",33),g.Tb(7,"div",34),g.Tb(8,"button",35),g.bc("click",(function(){return g.Ec(t),g.fc().onConfirmAggiornaStato()})),g.Sb(),g.Sb(),g.Tb(9,"div",34),g.Tb(10,"button",36),g.bc("click",(function(){return g.Ec(t),g.fc().onRejectAggiornaStato()})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit;g.Bb(3),g.Pc(a.summary),g.Bb(2),g.Pc(a.detail)}}var ce,re=((ce=function(){function i(e,t,a,n,o){_classCallCheck(this,i),this.antimafiaService=e,this.istruttoriaAntimafiaService=t,this.route=a,this.router=n,this.messages=o,this.textTitle=s.a.CERTIFICAZIONI_ANTIMAFIA_VERIFICA_PERIODICA,this.labels=s.a,this.menuAction=new Array,this.aggiornaCertificazioniCounters=new g.n,this.elementiPerPagina=5,this.ricercaAntimafiaFilter=new I,this.elementiTotali=0,this.cols=[{field:"datiDichiarazione.dettaglioImpresa.codiceFiscale",header:this.labels.cuaaSigla},{field:"datiDichiarazione.dettaglioImpresa.denominazione",header:this.labels.descrizioneImpresa},{field:"dtProtocollazione",header:this.labels.data},{field:"idProtocollo",header:this.labels.nrProtocollo},{field:"esito",header:this.labels.esitoTrasmissione}]}return _createClass(i,[{key:"ngOnInit",value:function(){this.menuAction=this.menuActionDisplay()}},{key:"ngOnDestroy",value:function(){this.dichiarazioneAntimafiaSubscpription&&this.dichiarazioneAntimafiaSubscpription.unsubscribe()}},{key:"menuActionDisplay",value:function(){var i=this;return[{label:s.a.azioni.toUpperCase(),items:[{label:this.labels.SCARICA,command:function(){i.downloadDichiarazioneAntimafia(i.domandaAntimafiaSelezionataFromMenuAction.id.toString()),i.currentMenuAction.reset=!0}},{label:s.a.ESITO_POSITIVO,command:function(){i.openPopupEsitoPositivo(),i.currentMenuAction.reset=!0}}]}]}},{key:"downloadDichiarazioneAntimafia",value:function(i){var e=this,t=this.antimafiaService.getDichiarazioneAntimafiaWithPdfFirmato(i);this.dichiarazioneAntimafiaSubscpription=t.pipe(Object(p.a)((function(i){return e.antimafiaService.downloadDichiarazioneAntimafia(i.pdfFirmato,i.tipoPdfFirmato),Object(_.a)(i)}))).subscribe((function(i){var t=e.antimafiaService.getAllegati(i);e.antimafiaService.downloadAllegati(t)}))}},{key:"visualizzaDettaglioDomanda",value:function(i,e){var t={queryParams:{activeIndex:e,descAzienda:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.denominazione),idDichiarazioneAntimafia:i.id,cuaa:JSON.stringify(i.datiDichiarazione.dettaglioImpresa.codiceFiscale),parentTabIndex:6},relativeTo:this.route.parent};this.router.navigate(["./dettaglioDomandeCollegate"],t)}},{key:"onDropdownMenuOpen",value:function(i,e,t){this.indexSelectedFromMenu=t,this.domandaAntimafiaSelezionataFromMenuAction=e,this.currentMenuAction=i,this.currentMenuAction.reset=!1}},{key:"openPopupEsitoPositivo",value:function(){this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA(c.a.POSITIVO)))}},{key:"onConfirmAggiornaStato",value:function(){this.messages.clear(),this.esitoPositivo()}},{key:"onRejectAggiornaStato",value:function(){this.messages.clear()}},{key:"esitoPositivo",value:function(){var i=this,e=this.domandaAntimafiaSelezionataFromMenuAction;e.stato.descrizione=null,e.stato.id=null,e.stato.identificativo=c.a.POSITIVO,this.antimafiaService.aggiornaDichiarazioneAntimafia(e).subscribe((function(e){var t=new v(i.domandaAntimafiaSelezionataFromMenuAction.datiDichiarazione.dettaglioImpresa.codiceFiscale);i.istruttoriaAntimafiaService.getEsitiAntimafiaAGS(t).subscribe((function(e){e&&e.forEach((function(a){a.cuaa===t.cuaa&&(a.dtFineEsitoNegativo=null,a.dtFineSilenzioAssenso=null,a.dtInizioEsitoNegativo=null,a.dtInizioSilenzioAssenso=null),i.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia(e)})),i.loadList(0,null)}),(function(i){return console.log(i)}))}),(function(e){i.messages.add(u.a.getToast("generic",u.b.error,u.a.CTRLIAMCNT007_KO))}))}},{key:"loadData",value:function(i){if(i.rows&&(this.elementiPerPagina=i.rows),i.sortField){var e="";switch(i.sortField){case this.cols[0].field:e="cuaa";break;case this.cols[1].field:e="denominazioneImpresa";break;default:e=i.sortField}this.ricercaAntimafiaFilter.sortBy=(1===i.sortOrder?"+":"-").concat(e)}this.loadList(i.first,i.globalFilter)}},{key:"loadList",value:function(i,e){var t=this;this.ricercaAntimafiaFilter.filtroGenerico=e||null,this.ricercaAntimafiaFilter.statoDichiarazione=c.a.VERIFICA_PERIODICA,this.ricercaAntimafiaFilter.pagSize=this.elementiPerPagina,this.ricercaAntimafiaFilter.pagStart=i,this.istruttoriaAntimafiaService.getCertificazioneAntimafia(this.ricercaAntimafiaFilter).subscribe((function(i){t.elementiTotali=i.total,t.certificazioneAntimafia=i.results?i.results:[]}),(function(i){console.log("error: "+i)}))}},{key:"buildDescrizioneTooltip",value:function(i){var e=i.esitoDescrizione;return"OK"===i.esitoInvioAgea||"KO"===i.esitoInvioAgea?e+=" | ESITO INVIO AD AGEA "+i.esitoInvioAgea:"ND"===i.esitoInvioAgea&&(e+=" | ESITO INVIO AD AGEA NON DISPONIBILE"),"OK"===i.esitoInvioBdna||"KO"===i.esitoInvioBdna?e+=" | ESITO INVIO A BDNA "+i.esitoInvioBdna:"ND"===i.esitoInvioBdna&&(e+=" | ESITO INVIO A BDNA NON DISPONIBILE"),e}}]),i}()).\u0275fac=function(i){return new(i||ce)(g.Nb(o.a),g.Nb(l.a),g.Nb(n.a),g.Nb(n.e),g.Nb(T.d))},ce.\u0275cmp=g.Hb({type:ce,selectors:[["app-cert-amf-verifica-periodica"]],outputs:{aggiornaCertificazioniCounters:"aggiornaCertificazioniCounters"},decls:16,vars:13,consts:[[1,"ui-grid-fixed"],[1,"boxgrey","layout-actionmenu"],[1,"globalfilter"],[1,"material-icons"],["type","text","pInputText","","size","50","placeholder","Ricerca...",2,"width","auto",3,"input"],[3,"columns","value","autoLayout","paginator","rows","responsive","lazy","totalRecords","rowsPerPageOptions","onLazyLoad"],["dt",""],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","top-center","key","generic",3,"baseZIndex"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[2,"width","3em"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],[3,"pSelectableRow"],[1,"ui-g"],["class","pallinoVerde",3,"pTooltip",4,"ngIf"],["class","pallinoRosso",3,"pTooltip",4,"ngIf"],[2,"width","200px"],[1,"ui-g","icon-action"],[1,""],["icon","fa ui-icon-tab","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-developer-board","iconPos","center",3,"disabled","title","onClick"],["icon","fa ui-icon-description","iconPos","center",3,"disabled","title","onClick"],[3,"item","click"],["actionMenu",""],[1,"pallinoVerde",3,"pTooltip"],[1,"pallinoRosso",3,"pTooltip"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"]],template:function(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",0),g.Tb(1,"div",1),g.Tb(2,"h3"),g.Oc(3),g.Sb(),g.Tb(4,"div",2),g.Tb(5,"i",3),g.Oc(6,"search"),g.Sb(),g.Tb(7,"input",4),g.bc("input",(function(i){return g.Ec(t),g.Bc(9).filterGlobal(i.target.value,"contains")})),g.Sb(),g.Sb(),g.Tb(8,"p-table",5,6),g.bc("onLazyLoad",(function(i){return e.loadData(i)})),g.Mc(10,ie,6,3,"ng-template",7),g.Mc(11,ae,25,17,"ng-template",8),g.Mc(12,ne,3,2,"ng-template",9),g.Sb(),g.Sb(),g.Sb(),g.Ob(13,"p-toast",10),g.Tb(14,"p-toast",11),g.bc("onClose",(function(){return e.onRejectAggiornaStato()})),g.Mc(15,oe,11,2,"ng-template",12),g.Sb()}2&i&&(g.Bb(3),g.Pc(e.textTitle),g.Bb(5),g.mc("columns",e.cols)("value",e.certificazioneAntimafia)("autoLayout",!0)("paginator",!0)("rows",5)("responsive",!0)("lazy",!0)("totalRecords",e.elementiTotali)("rowsPerPageOptions",e.labels.sizePerPagina),g.Bb(5),g.mc("baseZIndex",5e4),g.Bb(1),g.mc("modal",!0)("baseZIndex",5e3))},directives:[z.a,C.q,T.e,O.a,a.s,C.p,C.o,C.m,a.t,D.a,P.a,U.a,D.b],pipes:[a.f],styles:["",".pallinoVerde[_ngcontent-%COMP%]{background-color:#8dbe26}.pallinoRosso[_ngcontent-%COMP%], .pallinoVerde[_ngcontent-%COMP%]{border-radius:50%;height:20px;width:20px;margin:auto}.pallinoRosso[_ngcontent-%COMP%]{background-color:#f13c3c}"]}),ce);function se(i,e){if(1&i&&(g.Tb(0,"span",7),g.Oc(1),g.gc(2,"translate"),g.Tb(3,"span"),g.Oc(4),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Qc("",g.hc(2,2,"ANTIMAFIA.BOZZA")," "),g.Bb(3),g.Pc(t.itemBadges.bozza)}}function le(i,e){if(1&i){var t=g.Ub();g.Tb(0,"app-cert-amf-bozza",8),g.bc("aggiornaCertificazioniCounters",(function(i){return g.Ec(t),g.fc().aggiornaCounters(i)}))("runStatoAvanzamentoProcesso",(function(i){return g.Ec(t),g.fc().runStatoAvanzamentoProcesso(i,null)})),g.Sb()}if(2&i){var a=g.fc();g.mc("refreshFromParent",a.refresh)}}function de(i,e){if(1&i&&(g.Tb(0,"span",7),g.Oc(1),g.gc(2,"translate"),g.Tb(3,"span"),g.Oc(4),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Qc("",g.hc(2,2,"ANTIMAFIA.PROTOCOLLATE")," "),g.Bb(3),g.Pc(t.itemBadges.protocollata)}}function be(i,e){if(1&i){var t=g.Ub();g.Tb(0,"app-cert-amf-protocollate",8),g.bc("aggiornaCertificazioniCounters",(function(i){return g.Ec(t),g.fc().aggiornaCounters(i)}))("runStatoAvanzamentoProcesso",(function(i){g.Ec(t);var e=g.fc();return e.runStatoAvanzamentoProcesso(i,e.controlloAntimafia)})),g.Sb()}if(2&i){var a=g.fc();g.mc("refreshFromParent",a.refresh)}}function ue(i,e){if(1&i&&(g.Tb(0,"span",7),g.Oc(1),g.gc(2,"translate"),g.Tb(3,"span"),g.Oc(4),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Qc("",g.hc(2,2,"ANTIMAFIA.IN_ISTRUTTORIA")," "),g.Bb(3),g.Pc(t.itemBadges.controllata)}}function me(i,e){if(1&i){var t=g.Ub();g.Tb(0,"app-cert-amf-controllate",8),g.bc("aggiornaCertificazioniCounters",(function(i){return g.Ec(t),g.fc().aggiornaCounters(i)}))("runStatoAvanzamentoProcesso",(function(i){g.Ec(t);var e=g.fc();return e.runStatoAvanzamentoProcesso(i,e.processoImportaDomandePsr)})),g.Sb()}if(2&i){var a=g.fc();g.mc("refreshFromParent",a.refresh)}}function fe(i,e){if(1&i&&(g.Tb(0,"span",7),g.Oc(1),g.gc(2,"translate"),g.Tb(3,"span"),g.Oc(4),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Qc("",g.hc(2,2,"ANTIMAFIA.CONTROLLO_MANUALE")," "),g.Bb(3),g.Pc(t.itemBadges.controlloManuale)}}function pe(i,e){if(1&i){var t=g.Ub();g.Tb(0,"app-cert-amf-controllo-manuale",9),g.bc("aggiornaCertificazioniCounters",(function(i){return g.Ec(t),g.fc().aggiornaCounters(i)})),g.Sb()}}function ge(i,e){if(1&i&&(g.Tb(0,"span",7),g.Oc(1),g.gc(2,"translate"),g.Tb(3,"span"),g.Oc(4),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Qc("",g.hc(2,2,"ANTIMAFIA.RIFIUTATE")," "),g.Bb(3),g.Pc(t.itemBadges.rifiutata)}}function he(i,e){if(1&i){var t=g.Ub();g.Tb(0,"app-cert-amf-rifiutate",9),g.bc("aggiornaCertificazioniCounters",(function(i){return g.Ec(t),g.fc().aggiornaCounters(i)})),g.Sb()}}function Se(i,e){if(1&i&&(g.Tb(0,"span",7),g.Oc(1),g.gc(2,"translate"),g.Tb(3,"span"),g.Oc(4),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Qc("",g.hc(2,2,"ANTIMAFIA.ESITO_POSITIVO")," "),g.Bb(3),g.Pc(t.itemBadges.positiva)}}function Ae(i,e){1&i&&g.Ob(0,"app-cert-amf-esito-positivo")}function Te(i,e){if(1&i&&(g.Tb(0,"span",7),g.Oc(1),g.gc(2,"translate"),g.Tb(3,"span"),g.Oc(4),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Qc("",g.hc(2,2,"ANTIMAFIA.VERIFICA_PERIODICA")," "),g.Bb(3),g.Pc(t.itemBadges.verificaPeriodica)}}function ve(i,e){if(1&i){var t=g.Ub();g.Tb(0,"app-cert-amf-verifica-periodica",9),g.bc("aggiornaCertificazioniCounters",(function(i){return g.Ec(t),g.fc().aggiornaCounters(i)})),g.Sb()}}var Ie,Oe=((Ie=function(){function i(e,t,a,n,o){_classCallCheck(this,i),this.antimafiaService=e,this.istruttoriaAntimafiaService=t,this.http=a,this._configuration=n,this.translateService=o,this.labels=s.a,this.processiInCorso=s.a.NESSUN_PROCESSO_DI_CONTROLLO,this.refresh=!1,this.controlloAntimafia=d.a.CONTROLLO_ANTIMAFIA,this.processoImportaDomandePsr=d.a.IMPORTA_DOMANDE_PSR_SUPERFICIE,this.timeout=3e4}return _createClass(i,[{key:"ngOnInit",value:function(){this.loadCounters(),this.index=this.istruttoriaAntimafiaService.getTabIndex(),this.newCheckStatoAvanzamento()}},{key:"ngOnDestroy",value:function(){u.a.isUndefinedOrNull(this.timer)||this.timer.unsubscribe(),this.refresh=!1}},{key:"aggiornaCounters",value:function(i){this.loadCounters()}},{key:"loadCounters",value:function(){var i=this;this.itemBadges=new r,this.antimafiaService.getStatoDichiarazioniCount({statiDichiarazione:[c.a.BOZZA,c.a.PROTOCOLLATA,c.a.CONTROLLATA,c.a.CONTROLLO_MANUALE,c.a.RIFIUTATA,c.a.POSITIVO,c.a.VERIFICA_PERIODICA]}).subscribe((function(e){console.log("NEXT = "+JSON.stringify(e)),i.itemBadges=e}))}},{key:"newCheckStatoAvanzamento",value:function(){var i=this;this.istruttoriaAntimafiaService.getProcessiDiControllo(d.a.CONTROLLO_ANTIMAFIA).pipe(Object(p.a)((function(e){return e?(i.runStatoAvanzamentoProcesso(Number(e[0].datiElaborazioneProcesso.daElaborare),d.a.CONTROLLO_ANTIMAFIA),null):i.istruttoriaAntimafiaService.getProcessiDiControllo(d.a.IMPORTA_DOMANDE_PSR_SUPERFICIE)}))).subscribe((function(e){return e&&i.runStatoAvanzamentoProcesso(Number(e[0].datiElaborazioneProcesso.daElaborare),d.a.IMPORTA_DOMANDE_PSR_SUPERFICIE),null}))}},{key:"runStatoAvanzamentoProcesso",value:function(i,e){var t=this,a=0,n=i;this.processiInCorso=u.a.procesioDiControlloIstruttoria(String(this.translateService.instant("PROCESSI."+e)),String(a),String(n));var o=encodeURIComponent(JSON.stringify({tipoProcesso:e,statoProcesso:b.a.RUN}));this.timer=Object(m.a)(0,this.timeout).subscribe((function(i){t.http.get(t._configuration.urlControlloAntimafiaStatoAvanzamento+o).subscribe((function(o){if(i>1&&String(o.esito)===s.a.NESSUN_PROCESSO_DI_CONTROLLO)return t.timer.unsubscribe(),t.processiInCorso=s.a.NESSUN_PROCESSO_DI_CONTROLLO,t.refresh=!0,void t.loadCounters();u.a.isUndefinedOrNull(o.totale)||(a=o.totale,t.processiInCorso=u.a.procesioDiControlloIstruttoria(String(t.translateService.instant("PROCESSI."+e)),String(a),String(n))),a>=n&&(t.timer.unsubscribe(),t.processiInCorso=s.a.NESSUN_PROCESSO_DI_CONTROLLO,t.refresh=!0,t.loadCounters())}),(function(i){t.timer.unsubscribe(),t.processiInCorso=s.a.NESSUN_PROCESSO_DI_CONTROLLO}))}))}}]),i}()).\u0275fac=function(i){return new(i||Ie)(g.Nb(o.a),g.Nb(l.a),g.Nb(h.b),g.Nb(f.a),g.Nb(S.e))},Ie.\u0275cmp=g.Hb({type:Ie,selectors:[["app-certificazioni-antimafia"]],decls:31,vars:5,consts:[[1,"ui-g-12"],[1,"ui-grid-fixed"],[1,"funzioni-grid","tab-new","boxgrey"],[3,"activeIndex"],["pTemplate","header"],["pTemplate","content"],[1,"boxgrey"],[1,"ui-tabview-title","ng-star-inserted"],[3,"refreshFromParent","aggiornaCertificazioniCounters","runStatoAvanzamentoProcesso"],[3,"aggiornaCertificazioniCounters"]],template:function(i,e){1&i&&(g.Tb(0,"div",0),g.Tb(1,"div",1),g.Tb(2,"div",2),g.Tb(3,"p-tabView",3),g.Tb(4,"p-tabPanel"),g.Mc(5,se,5,4,"ng-template",4),g.Mc(6,le,1,1,"ng-template",5),g.Sb(),g.Tb(7,"p-tabPanel"),g.Mc(8,de,5,4,"ng-template",4),g.Mc(9,be,1,1,"ng-template",5),g.Sb(),g.Tb(10,"p-tabPanel"),g.Mc(11,ue,5,4,"ng-template",4),g.Mc(12,me,1,1,"ng-template",5),g.Sb(),g.Tb(13,"p-tabPanel"),g.Mc(14,fe,5,4,"ng-template",4),g.Mc(15,pe,1,0,"ng-template",5),g.Sb(),g.Tb(16,"p-tabPanel"),g.Mc(17,ge,5,4,"ng-template",4),g.Mc(18,he,1,0,"ng-template",5),g.Sb(),g.Tb(19,"p-tabPanel"),g.Mc(20,Se,5,4,"ng-template",4),g.Mc(21,Ae,1,0,"ng-template",5),g.Sb(),g.Tb(22,"p-tabPanel"),g.Mc(23,Te,5,4,"ng-template",4),g.Mc(24,ve,1,0,"ng-template",5),g.Sb(),g.Sb(),g.Tb(25,"div",6),g.Tb(26,"h5"),g.Oc(27),g.gc(28,"translate"),g.Sb(),g.Tb(29,"div"),g.Oc(30),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&i&&(g.Bb(3),g.mc("activeIndex",e.index),g.Bb(24),g.Pc(g.hc(28,3,"PROCESSI_DI_CONTROLLO")),g.Bb(3),g.Pc(e.processiInCorso))},directives:[A.b,A.a,T.e,k,J,Ci,ki,Zi,Yi,re],pipes:[S.d],styles:[".boxgrey[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{color:#0d5f3f;font-weight:700;font-size:18px;text-transform:uppercase;padding-bottom:10px;margin-bottom:15px}.boxgrey[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] > h5[_ngcontent-%COMP%]{border-bottom:2px solid #0d5f3f}[_nghost-%COMP%] .ui-paginator{display:flex;justify-content:flex-end}[_nghost-%COMP%] .ui-dropdown .ui-dropdown-trigger{top:-5px}"]}),Ie),ze=t("jcoe"),Ce=function(i){return i.CHIUSA_CON_ESITO_NEGATIVO="CHIUSA_CON_ESITO_NEGATIVO",i.ANOMALIA="ANOMALIA",i.IN_LAVORAZIONE="IN_LAVORAZIONE",i.IN_ISTRUTTORIA="IN_ISTRUTTORIA",i.IN_INSERIMENTO="IN_INSERIMENTO",i.IN_CODA="IN_CODA",i.ATTI="ATTI",i.ESITO_POSITIVO="ESITO_POSITIVO",i.RIFIUTATO="RIFIUTATO",i.NON_CARICATO="NON_CARICATO",i}({}),De=t("yhG/"),Pe=t("DYOT");function ye(i,e){if(1&i){var t=g.Ub();g.Tb(0,"div",17),g.Ob(1,"i",18),g.Tb(2,"h3"),g.Oc(3),g.Sb(),g.Tb(4,"p"),g.Oc(5),g.Sb(),g.Sb(),g.Tb(6,"div",19),g.Tb(7,"div",20),g.Tb(8,"button",21),g.bc("click",(function(){return g.Ec(t),g.fc().onConfirmAggiornaStato()})),g.Sb(),g.Sb(),g.Tb(9,"div",20),g.Tb(10,"button",22),g.bc("click",(function(){return g.Ec(t),g.fc().onRejectAggiornaStato()})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit;g.Bb(3),g.Pc(a.summary),g.Bb(2),g.Pc(a.detail)}}function Be(i,e){if(1&i&&(g.Tb(0,"th",24),g.Oc(1),g.Ob(2,"p-sortIcon",25),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.header)}}function Ne(i,e){if(1&i&&(g.Tb(0,"tr"),g.Mc(1,Be,3,4,"th",23),g.Sb()),2&i){var t=e.$implicit;g.Bb(1),g.mc("ngForOf",t)}}function Me(i,e){if(1&i){var t=g.Ub();g.Tb(0,"p-calendar",34),g.bc("ngModelChange",(function(i){return g.Ec(t),g.fc().$implicit.dtBdna=i})),g.Sb()}if(2&i){var a=g.fc().$implicit;g.mc("ngModel",a.dtBdna)("showIcon",!0)}}function Ee(i,e){if(1&i&&(g.Oc(0),g.gc(1,"date")),2&i){var t=g.fc().$implicit;g.Qc(" ",g.ic(1,1,t.dtBdna,"dd/MM/yyyy")," ")}}function Fe(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.gc(7,"date"),g.Sb(),g.Tb(8,"td"),g.Oc(9),g.Sb(),g.Tb(10,"td"),g.Oc(11),g.gc(12,"number"),g.Sb(),g.Tb(13,"td"),g.Oc(14),g.gc(15,"date"),g.Sb(),g.Tb(16,"td"),g.Oc(17),g.gc(18,"date"),g.Sb(),g.Tb(19,"td"),g.Oc(20),g.gc(21,"date"),g.Sb(),g.Tb(22,"td"),g.Oc(23),g.gc(24,"date"),g.Sb(),g.Tb(25,"td"),g.Oc(26),g.gc(27,"date"),g.Sb(),g.Tb(28,"td",26),g.Tb(29,"p-cellEditor"),g.Mc(30,Me,1,2,"ng-template",27),g.Mc(31,Ee,2,4,"ng-template",28),g.Sb(),g.Sb(),g.Tb(32,"td",29),g.Tb(33,"input",30),g.bc("ngModelChange",(function(i){return g.Ec(t),e.$implicit.protocollo=i})),g.Sb(),g.Sb(),g.Tb(34,"td"),g.Oc(35),g.gc(36,"translate"),g.Sb(),g.Tb(37,"td",31),g.Tb(38,"action-menu",32,33),g.bc("click",(function(){g.Ec(t);var i=e.$implicit;return g.fc().onDropdownMenuOpen(0,i)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.Bb(2),g.Pc(a.cuaa),g.Bb(2),g.Pc(a.idDomanda),g.Bb(2),g.Pc(a.dtDomanda?g.ic(7,14,a.dtDomanda,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.campagna),g.Bb(2),g.Pc(g.jc(12,17,a.importoRichiesto,"1.2-2","it")),g.Bb(3),g.Pc(a.dtBdnaOp?g.ic(15,21,a.dtBdnaOp,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtInizioSilenzioAssenso?g.ic(18,24,a.dtInizioSilenzioAssenso,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtFineSilenzioAssenso?g.ic(21,27,a.dtFineSilenzioAssenso,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtInizioEsitoNegativo?g.ic(24,30,a.dtInizioEsitoNegativo,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtFineEsitoNegativo?g.ic(27,33,a.dtFineEsitoNegativo,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(7),g.mc("ngModel",a.protocollo),g.Bb(2),g.Pc(g.hc(36,36,a.statoBdna)),g.Bb(3),g.mc("item",n.menuActionDomanda)("reset",n.reset)}}function ke(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Cb("colspan",14),g.Bb(1),g.Qc(" ",t.intestazioni.noTableContent," ")}}function Re(i,e){if(1&i&&(g.Tb(0,"th",24),g.Oc(1),g.Ob(2,"p-sortIcon",25),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.header)}}function _e(i,e){if(1&i&&(g.Tb(0,"tr"),g.Mc(1,Re,3,4,"th",23),g.Sb()),2&i){var t=e.$implicit;g.Bb(1),g.mc("ngForOf",t)}}function we(i,e){if(1&i){var t=g.Ub();g.Tb(0,"p-calendar",35),g.bc("ngModelChange",(function(i){return g.Ec(t),g.fc().$implicit.dtBdna=i})),g.Sb()}if(2&i){var a=g.fc().$implicit;g.mc("ngModel",a.dtBdna)("showIcon",!0)("baseZIndex",1e9)}}function xe(i,e){if(1&i&&(g.Oc(0),g.gc(1,"date")),2&i){var t=g.fc().$implicit;g.Qc(" ",g.ic(1,1,t.dtBdna,"dd/MM/yyyy")," ")}}function Ue(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.Sb(),g.Tb(7,"td"),g.Oc(8),g.gc(9,"date"),g.Sb(),g.Tb(10,"td"),g.Oc(11),g.gc(12,"number"),g.Sb(),g.Tb(13,"td"),g.Oc(14),g.gc(15,"date"),g.Sb(),g.Tb(16,"td"),g.Oc(17),g.gc(18,"date"),g.Sb(),g.Tb(19,"td"),g.Oc(20),g.gc(21,"date"),g.Sb(),g.Tb(22,"td"),g.Oc(23),g.gc(24,"date"),g.Sb(),g.Tb(25,"td"),g.Oc(26),g.gc(27,"date"),g.Sb(),g.Tb(28,"td",26),g.Tb(29,"p-cellEditor"),g.Mc(30,we,1,3,"ng-template",27),g.Mc(31,xe,2,4,"ng-template",28),g.Sb(),g.Sb(),g.Tb(32,"td",29),g.Tb(33,"input",30),g.bc("ngModelChange",(function(i){return g.Ec(t),e.$implicit.protocollo=i})),g.Sb(),g.Sb(),g.Tb(34,"td"),g.Oc(35),g.gc(36,"translate"),g.Sb(),g.Tb(37,"td",31),g.Tb(38,"action-menu",32,33),g.bc("click",(function(){g.Ec(t);var i=e.$implicit;return g.fc().onDropdownMenuOpen(1,i)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.Bb(2),g.Pc(a.misurePsr),g.Bb(2),g.Pc(a.cuaa),g.Bb(2),g.Pc(a.idDomanda),g.Bb(2),g.Pc(a.dtDomanda?g.ic(9,14,a.dtDomanda,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(g.jc(12,17,a.importoRichiesto,"1.2-2","it")),g.Bb(3),g.Pc(a.dtBdnaOp?g.ic(15,21,a.dtBdnaOp,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtInizioSilenzioAssenso?g.ic(18,24,a.dtInizioSilenzioAssenso,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtFineSilenzioAssenso?g.ic(21,27,a.dtFineSilenzioAssenso,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtInizioEsitoNegativo?g.ic(24,30,a.dtInizioEsitoNegativo,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtFineEsitoNegativo?g.ic(27,33,a.dtFineEsitoNegativo,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(7),g.mc("ngModel",a.protocollo),g.Bb(2),g.Pc(g.hc(36,36,a.statoBdna)),g.Bb(3),g.mc("item",n.menuActionDomanda)("reset",n.reset)}}function Le(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Cb("colspan",14),g.Bb(1),g.Qc(" ",t.intestazioni.noTableContent," ")}}function Ve(i,e){if(1&i&&(g.Tb(0,"th",24),g.Oc(1),g.Ob(2,"p-sortIcon",25),g.Sb()),2&i){var t=e.$implicit;g.mc("pSortableColumn",t.field)("pSortableColumnDisabled",null==t.field),g.Bb(1),g.Qc(" ",t.header," "),g.Bb(1),g.mc("field",t.header)}}function $e(i,e){if(1&i&&(g.Tb(0,"tr"),g.Mc(1,Ve,3,4,"th",23),g.Sb()),2&i){var t=e.$implicit;g.Bb(1),g.mc("ngForOf",t)}}function Ge(i,e){if(1&i){var t=g.Ub();g.Tb(0,"p-calendar",35),g.bc("ngModelChange",(function(i){return g.Ec(t),g.fc().$implicit.dtBdna=i})),g.Sb()}if(2&i){var a=g.fc().$implicit;g.mc("ngModel",a.dtBdna)("showIcon",!0)("baseZIndex",1e9)}}function Ze(i,e){if(1&i&&(g.Oc(0),g.gc(1,"date")),2&i){var t=g.fc().$implicit;g.Qc(" ",g.ic(1,1,t.dtBdna,"dd/MM/yyyy")," ")}}function Ke(i,e){if(1&i){var t=g.Ub();g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Tb(3,"td"),g.Oc(4),g.Sb(),g.Tb(5,"td"),g.Oc(6),g.gc(7,"date"),g.Sb(),g.Tb(8,"td"),g.Oc(9),g.Sb(),g.Tb(10,"td"),g.Oc(11),g.gc(12,"number"),g.Sb(),g.Tb(13,"td"),g.Oc(14),g.gc(15,"date"),g.Sb(),g.Tb(16,"td"),g.Oc(17),g.gc(18,"date"),g.Sb(),g.Tb(19,"td"),g.Oc(20),g.gc(21,"date"),g.Sb(),g.Tb(22,"td"),g.Oc(23),g.gc(24,"date"),g.Sb(),g.Tb(25,"td"),g.Oc(26),g.gc(27,"date"),g.Sb(),g.Tb(28,"td",26),g.Tb(29,"p-cellEditor"),g.Mc(30,Ge,1,3,"ng-template",27),g.Mc(31,Ze,2,4,"ng-template",28),g.Sb(),g.Sb(),g.Tb(32,"td",29),g.Tb(33,"input",30),g.bc("ngModelChange",(function(i){return g.Ec(t),e.$implicit.protocollo=i})),g.Sb(),g.Sb(),g.Tb(34,"td"),g.Oc(35),g.gc(36,"translate"),g.Sb(),g.Tb(37,"td",31),g.Tb(38,"action-menu",32,33),g.bc("click",(function(){g.Ec(t);var i=e.$implicit;return g.fc().onDropdownMenuOpen(2,i)})),g.Sb(),g.Sb(),g.Sb()}if(2&i){var a=e.$implicit,n=g.fc();g.Bb(2),g.Pc(a.cuaa),g.Bb(2),g.Pc(a.idDomanda),g.Bb(2),g.Pc(a.dtDomanda?g.ic(7,14,a.dtDomanda,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.campagna),g.Bb(2),g.Pc(g.jc(12,17,a.importoRichiesto,"1.2-2","it")),g.Bb(3),g.Pc(a.dtBdnaOp?g.ic(15,21,a.dtBdnaOp,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtInizioSilenzioAssenso?g.ic(18,24,a.dtInizioSilenzioAssenso,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtFineSilenzioAssenso?g.ic(21,27,a.dtFineSilenzioAssenso,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtInizioEsitoNegativo?g.ic(24,30,a.dtInizioEsitoNegativo,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(3),g.Pc(a.dtFineEsitoNegativo?g.ic(27,33,a.dtFineEsitoNegativo,"dd/MM/yyyy"):n.intestazioni.nd),g.Bb(7),g.mc("ngModel",a.protocollo),g.Bb(2),g.Pc(g.hc(36,36,a.statoBdna)),g.Bb(3),g.mc("item",n.menuActionDomanda)("reset",n.reset)}}function je(i,e){if(1&i&&(g.Tb(0,"tr"),g.Tb(1,"td"),g.Oc(2),g.Sb(),g.Sb()),2&i){var t=g.fc();g.Bb(1),g.Cb("colspan",14),g.Bb(1),g.Qc(" ",t.intestazioni.noTableContent," ")}}var Qe,Je,He=[{path:"",component:Oe,pathMatch:"full"},{path:"dettaglioDomandeCollegate",component:(Qe=function(){function i(e,t,a,n,o,c){var r=this;_classCallCheck(this,i),this.route=e,this.istruttoriaAntimafiaService=t,this.messages=a,this.location=n,this.antimafiaService=o,this.loader=c,this.activeIndex=-1,this.activeIndexMenuAction=-1,this.intestazioni=s.a,this.textTitleInner=s.a.domandeCollegateAntimafia,this.textTitle="",this.loaded=[!1,!1,!1],this.domandeUnicheView=new Array,this.domandeStrutturaliView=new Array,this.domandeSuperficieView=new Array,this.menuActionDomanda=new Array,this.colsSUPDU=[{field:"cuaa",header:this.intestazioni.cuaaSigla},{field:"idDomanda",header:this.intestazioni.idDomanda},{field:"dtDomanda",header:this.intestazioni.dtDomanda},{field:"campagna",header:this.intestazioni.campagna},{field:"importoRichiesto",header:this.intestazioni.importoRichiesto},{field:"dtBdnaOp",header:this.intestazioni.dtBdnaOp},{field:"dtInizioSilenzioAssenso",header:this.intestazioni.dtInizioSilenzioAssenso},{field:"dtFineSilenzioAssenso",header:this.intestazioni.dtFineSilenzioAssenso},{field:"dtInizioEsitoNegativo",header:this.intestazioni.dtInizioEsitoNegativo},{field:"dtFineEsitoNegativo",header:this.intestazioni.dtFineEsitoNegativo},{field:"dtBdna",header:this.intestazioni.dtBdna},{field:"protocollo",header:this.intestazioni.protocollo},{field:"statoBdna",header:this.intestazioni.statoBdna},{header:this.intestazioni.azioni}],this.colsPSRStr=[{field:"misura",header:this.intestazioni.misura},{field:"cuaa",header:this.intestazioni.cuaaSigla},{field:"idDomanda",header:this.intestazioni.idDomanda},{field:"dtDomanda",header:this.intestazioni.dtDomanda},{field:"importoRichiesto",header:this.intestazioni.importoRichiesto},{field:"dtBdnaOp",header:this.intestazioni.dtBdnaOp},{field:"dtInizioSilenzioAssenso",header:this.intestazioni.dtInizioSilenzioAssenso},{field:"dtFineSilenzioAssenso",header:this.intestazioni.dtFineSilenzioAssenso},{field:"dtInizioEsitoNegativo",header:this.intestazioni.dtInizioEsitoNegativo},{field:"dtFineEsitoNegativo",header:this.intestazioni.dtFineEsitoNegativo},{field:"dtBdna",header:this.intestazioni.dtBdna},{field:"protocollo",header:this.intestazioni.protocollo},{field:"statoBdna",header:this.intestazioni.statoBdna},{header:this.intestazioni.azioni}],this.menuActionDomanda=[{label:s.a.azioni.toUpperCase(),items:[{label:s.a.ESITO_NEGATIVO,command:function(){r.aggiornaStato(Ce.CHIUSA_CON_ESITO_NEGATIVO)}},{separator:!0},{label:s.a.ACCETTATO_BDNA,command:function(){r.aggiornaStato(Ce.IN_ISTRUTTORIA)}},{separator:!0},{label:s.a.ANOMALIA_BDNA,command:function(){r.aggiornaStato(Ce.ANOMALIA)}}]}]}return _createClass(i,[{key:"ngOnDestroy",value:function(){this.loader.resetTimeout()}},{key:"ngOnInit",value:function(){var i=this;this.loader.setTimeout(48e4),this.route.queryParams.subscribe((function(e){i.activeIndex=Number.parseInt(JSON.parse(e.activeIndex)),i.textTitle=s.a.descAziendaDomandeCollegateAntimafia+JSON.parse(e.descAzienda),i.idDichiarazioneAntimafia=Number.parseInt(JSON.parse(e.idDichiarazioneAntimafia)),i.cuaa=JSON.parse(e.cuaa),i.parentTabIndex=Number.parseInt(JSON.parse(e.parentTabIndex))})),!this.loaded[this.activeIndex]&&this.cuaa&&this.selectView(this.activeIndex,this.cuaa),this.antimafiaService.getDichiarazioneAntimafia(this.idDichiarazioneAntimafia.toString()).subscribe((function(e){i.dichiarazioneAntimafia=e}),(function(e){console.log("err - get dichiarazione antimafia"+i.idDichiarazioneAntimafia)}))}},{key:"goBack",value:function(){this.istruttoriaAntimafiaService.setTabIndex(this.parentTabIndex),this.location.back()}},{key:"onTabClose",value:function(i){}},{key:"onTabOpen",value:function(i){var e=i.index;!this.loaded[e]&&this.cuaa&&this.selectView(e,this.cuaa)}},{key:"onConfirmAggiornaStato",value:function(){switch(this.messages.clear(),this.statoDaAggiornare){case Ce.IN_ISTRUTTORIA:this.accettata(this.domandaDaAggiornare);break;case Ce.ANOMALIA:this.inAnomalia(this.domandaDaAggiornare);break;case Ce.CHIUSA_CON_ESITO_NEGATIVO:this.esitoNegativo(this.domandaDaAggiornare)}}},{key:"setDomandaView",value:function(i,e){switch(e&&e.sort((function(i,e){return i.dtDomanda>e.dtDomanda?-1:1})).forEach((function(i){i.dtBdna&&(i.dtBdna=new Date(i.dtBdna))})),i){case 0:this.domandeSuperficieView=e,this.loaded[i]=!0;break;case 1:this.domandeStrutturaliView=e,this.loaded[i]=!0;break;case 2:this.domandeUnicheView=e,this.loaded[i]=!0}}},{key:"selectView",value:function(i,e){var t=this;switch(i){case 0:var a=new ze.a;a.cuaa=e,a.tipoDomanda=Y.a.PSR_SUPERFICIE_EU,this.istruttoriaAntimafiaService.getDomandeCollegateFilter(a).subscribe((function(e){t.setDomandaView(i,e)}));break;case 1:var n=new ze.a;n.cuaa=e,n.tipoDomanda=Y.a.PSR_STRUTTURALI_EU,this.istruttoriaAntimafiaService.getDomandeCollegateFilter(n).subscribe((function(e){t.setDomandaView(i,e)}));break;case 2:var o=new ze.a;o.cuaa=e,o.tipoDomanda=Y.a.DOMANDA_UNICA,this.istruttoriaAntimafiaService.getDomandeCollegateFilter(o).subscribe((function(e){t.setDomandaView(i,e)}))}}},{key:"onDropdownMenuOpen",value:function(i,e){this.activeIndexMenuAction=i,this.domandaDaAggiornare=e}},{key:"esitoNegativo",value:function(i){var e=this;i.dtInizioSilenzioAssenso=new Date(i.dtBdna.getTime()),i.dtInizioSilenzioAssenso.setDate(i.dtInizioSilenzioAssenso.getDate()+30),i.dtFineSilenzioAssenso=new Date(i.dtBdna.getTime()),i.dtFineSilenzioAssenso.setDate(i.dtFineSilenzioAssenso.getDate()+210),i.dtInizioEsitoNegativo=i.dtBdna,i.dtFineEsitoNegativo=new Date(i.dtBdna.getTime()),i.dtFineEsitoNegativo.setDate(i.dtFineEsitoNegativo.getDate()+365),i.statoBdna=Ce.CHIUSA_CON_ESITO_NEGATIVO,this.istruttoriaAntimafiaService.aggiornaDomandeCollegate(i).subscribe((function(i){e.selectView(e.activeIndexMenuAction,i.cuaa),e.sincronizzaDateBDNA(i),e.messages.add(u.a.getToast("tst",u.b.success,u.a.OPERAZIONE_OK))}),(function(i){console.log("Err -"+i.toString()),e.messages.add(u.a.getToast("tst",u.b.warn,u.a.CTRLIAMCNT007_KO))}))}},{key:"inAnomalia",value:function(i){var e=this;i.dtInizioEsitoNegativo=null,i.dtFineEsitoNegativo=null,i.statoBdna=Ce.ANOMALIA,this.istruttoriaAntimafiaService.aggiornaDomandeCollegate(i).subscribe((function(i){e.selectView(e.activeIndexMenuAction,i.cuaa),e.sincronizzaDateBDNA(i),e.messages.add(u.a.getToast("tst",u.b.success,u.a.OPERAZIONE_OK))}),(function(i){console.log("Err -"+i.toString()),e.messages.add(u.a.getToast("tst",u.b.warn,u.a.CTRLIAMCNT007_KO))}))}},{key:"accettata",value:function(i){var e=this;i.dtInizioSilenzioAssenso=new Date(i.dtBdna.getTime()),i.dtInizioSilenzioAssenso.setDate(i.dtInizioSilenzioAssenso.getDate()+30),i.dtFineSilenzioAssenso=new Date(i.dtBdna.getTime()),i.dtFineSilenzioAssenso.setDate(i.dtFineSilenzioAssenso.getDate()+210),i.dtInizioEsitoNegativo=null,i.dtFineEsitoNegativo=null,i.statoBdna=Ce.IN_ISTRUTTORIA,this.istruttoriaAntimafiaService.aggiornaDomandeCollegate(i).subscribe((function(i){e.selectView(e.activeIndexMenuAction,i.cuaa),e.sincronizzaDateBDNA(i),e.messages.add(u.a.getToast("tst",u.b.success,u.a.OPERAZIONE_OK))}),(function(i){console.log("Err -"+i.toString()),e.messages.add(u.a.getToast("tst",u.b.warn,u.a.CTRLIAMCNT007_KO))}))}},{key:"aggiornaStato",value:function(i){var e=this.domandaDaAggiornare;if(e.statoBdna===Ce.NON_CARICATO)this.messages.add(u.a.getToast("tst",u.b.error,u.a.CTRLIAMCNT012));else{if(!e.dtBdna||!(e.protocollo||"").trim())return void this.messages.add(u.a.getToast("tst",u.b.warn,u.a.CTRLIAMCNT007));this.statoDaAggiornare=i,this.messages.add(u.a.getToast("aggiorna-stato",u.b.warn,u.a.WARNING_AGGIORNA_DOMANDA_COLLEGATA(i)))}}},{key:"sincronizzaDateBDNA",value:function(i){var e;e={cuaa:i.cuaa,idDomanda:i.idDomanda,tipoDomanda:i.tipoDomanda,dtInizioEsitoNegativo:i.dtInizioEsitoNegativo,dtInizioSilenzioAssenso:i.dtInizioSilenzioAssenso,dtFineEsitoNegativo:i.dtFineEsitoNegativo,dtFineSilenzioAssenso:i.dtFineSilenzioAssenso},this.istruttoriaAntimafiaService.sincronizzaDateBDNAAntimafia([e])}},{key:"onRejectAggiornaStato",value:function(){this.messages.clear()}}]),i}(),Qe.\u0275fac=function(i){return new(i||Qe)(g.Nb(n.a),g.Nb(l.a),g.Nb(T.d),g.Nb(a.n),g.Nb(o.a),g.Nb(ti.a))},Qe.\u0275cmp=g.Hb({type:Qe,selectors:[["app-dettaglio-domande-collegate"]],decls:39,vars:32,consts:[[1,"boxgrey","layout-actionmenu"],["position","top-center","key","tst",3,"baseZIndex"],["position","top-center","key","tst-esito-positivo",3,"baseZIndex","modal","onClose"],["position","center","key","aggiorna-stato","sticky","true",3,"modal","baseZIndex","onClose"],["pTemplate","message"],[1,"ui-g"],[1,"ui-g-12"],[3,"activeIndex","onClose","onOpen"],[3,"header"],[1,"boxgrey"],[1,"tabella-full"],[3,"columns","value","autoLayout","paginator","rows","responsive"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"columns","value","responsive","autoLayout","paginator","rows"],["type","button",1,"btn","btn-darkgreen",3,"click"],[2,"text-align","center"],[1,"pi","pi-exclamation-triangle",2,"font-size","3em"],[1,"ui-g","ui-fluid"],[1,"ui-g-6"],["type","button","pButton","","label","Si",1,"ui-button-success",3,"click"],["type","button","pButton","","label","No",1,"ui-button-secondary",3,"click"],[3,"pSortableColumn","pSortableColumnDisabled",4,"ngFor","ngForOf"],[3,"pSortableColumn","pSortableColumnDisabled"],[3,"field"],["pEditableColumn","",1,"editabile"],["pTemplate","input"],["pTemplate","output"],[1,"editabile"],["type","text","pInputText","",3,"ngModel","ngModelChange"],[1,"pos-drop"],[3,"item","reset","click"],["actionMenu",""],["dateFormat","dd/mm/yy",3,"ngModel","showIcon","ngModelChange"],["dateFormat","dd/mm/yy",3,"ngModel","showIcon","baseZIndex","ngModelChange"]],template:function(i,e){1&i&&(g.Tb(0,"div",0),g.Ob(1,"p-toast",1),g.Tb(2,"p-toast",2),g.bc("onClose",(function(){return e.goBack()})),g.Sb(),g.Tb(3,"p-toast",3),g.bc("onClose",(function(){return e.onRejectAggiornaStato()})),g.Mc(4,ye,11,2,"ng-template",4),g.Sb(),g.Tb(5,"div",5),g.Tb(6,"div",6),g.Tb(7,"h3"),g.Oc(8),g.Sb(),g.Tb(9,"p-accordion",7),g.bc("onClose",(function(i){return e.onTabClose(i)}))("onOpen",(function(i){return e.onTabOpen(i)})),g.Tb(10,"p-accordionTab",8),g.Tb(11,"div",9),g.Tb(12,"h3"),g.Oc(13),g.Sb(),g.Tb(14,"div",10),g.Tb(15,"p-table",11),g.Mc(16,Ne,2,1,"ng-template",12),g.Mc(17,Fe,40,38,"ng-template",13),g.Mc(18,ke,3,2,"ng-template",14),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(19,"p-accordionTab",8),g.Tb(20,"div",9),g.Tb(21,"h3"),g.Oc(22),g.Sb(),g.Tb(23,"div",10),g.Tb(24,"p-table",11),g.Mc(25,_e,2,1,"ng-template",12),g.Mc(26,Ue,40,38,"ng-template",13),g.Mc(27,Le,3,2,"ng-template",14),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(28,"p-accordionTab",8),g.Tb(29,"div",9),g.Tb(30,"h3"),g.Oc(31),g.Sb(),g.Tb(32,"div",10),g.Tb(33,"p-table",15),g.Mc(34,$e,2,1,"ng-template",12),g.Mc(35,Ke,40,38,"ng-template",13),g.Mc(36,je,3,2,"ng-template",14),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(37,"button",16),g.bc("click",(function(){return e.goBack()})),g.Oc(38,"Indietro"),g.Sb(),g.Sb(),g.Sb(),g.Sb()),2&i&&(g.Bb(1),g.mc("baseZIndex",5e4),g.Bb(1),g.mc("baseZIndex",5e4)("modal",!0),g.Bb(1),g.mc("modal",!0)("baseZIndex",5e3),g.Bb(5),g.Pc(e.textTitle),g.Bb(1),g.mc("activeIndex",e.activeIndex),g.Bb(1),g.nc("header",e.intestazioni.PSR_SUPERFICIE_EU),g.Bb(3),g.Pc(e.textTitleInner),g.Bb(2),g.mc("columns",e.colsSUPDU)("value",e.domandeSuperficieView)("autoLayout",!1)("paginator",!0)("rows",5)("responsive",!0),g.Bb(4),g.nc("header",e.intestazioni.PSR_STRUTTURALI_EU),g.Bb(3),g.Pc(e.textTitleInner),g.Bb(2),g.mc("columns",e.colsPSRStr)("value",e.domandeStrutturaliView)("autoLayout",!1)("paginator",!0)("rows",5)("responsive",!0),g.Bb(4),g.nc("header",e.intestazioni.DOMANDA_UNICA),g.Bb(3),g.Pc(e.textTitleInner),g.Bb(2),g.mc("columns",e.colsSUPDU)("value",e.domandeUnicheView)("responsive",!0)("autoLayout",!1)("paginator",!0)("rows",5)("responsive",!0))},directives:[O.a,T.e,De.a,De.c,C.q,D.b,a.s,C.p,C.o,C.d,C.b,ni.c,z.a,ni.s,ni.v,P.a,Pe.a],pipes:[a.f,a.g,S.d],encapsulation:2}),Qe),pathMatch:"full",data:{mybreadcrumb:"Domande Collegate"}}],qe=((Je=function i(){_classCallCheck(this,i)}).\u0275mod=g.Lb({type:Je}),Je.\u0275inj=g.Kb({factory:function(i){return new(i||Je)},imports:[[n.i.forChild(He)]]}),Je),We=t("b7oP"),Ye=t("R69K"),Xe=t("1IWC"),it=t.n(Xe);Object(a.K)(it.a,"it");var et,tt=((et=function i(){_classCallCheck(this,i)}).\u0275mod=g.Lb({type:et}),et.\u0275inj=g.Kb({factory:function(i){return new(i||et)},imports:[[a.c,qe,We.b,D.c,A.c,We.b,O.b,Ye.a,Pe.b,ai.b]]}),et)}}]);