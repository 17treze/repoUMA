import { first, filter, share } from 'rxjs/operators';
import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable, Subject } from 'rxjs';
import { client, over } from '@stomp/stompjs';
import { UUID } from 'angular2-uuid';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/** @enum {number} */
import * as Éµngcc0 from '@angular/core';
const StompState = {
    CLOSED: 0,
    TRYING: 1,
    CONNECTED: 2,
    DISCONNECTING: 3,
};
StompState[StompState.CLOSED] = "CLOSED";
StompState[StompState.TRYING] = "TRYING";
StompState[StompState.CONNECTED] = "CONNECTED";
StompState[StompState.DISCONNECTING] = "DISCONNECTING";

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Angular2 STOMP Raw Service using \@stomp/stomp.js
 *
 * You will only need the public properties and
 * methods listed unless you are an advanced user. This service handles subscribing to a
 * message queue using the stomp.js library, and returns
 * values via the ES6 Observable specification for
 * asynchronous value streaming by wiring the STOMP
 * messages into an observable.
 *
 * If you will like to pass the configuration as a dependency,
 * please use StompService class.
 */
class StompRService {
    /**
     * Constructor
     *
     * See README and samples for configuration examples
     */
    constructor() {
        /**
         * Internal array to hold locally queued messages when STOMP broker is not connected.
         */
        this.queuedMessages = [];
        /**
         * Callback Functions
         *
         * Note the method signature: () => preserves lexical scope
         * if we need to use this.x inside the function
         */
        this.debug = (args) => {
            console.log(new Date(), args);
        };
        /**
         * Callback run on successfully connecting to server
         */
        this.on_connect = (frame) => {
            this.debug('Connected');
            this._serverHeadersBehaviourSubject.next(frame.headers);
            // Indicate our connected state to observers
            this.state.next(StompState.CONNECTED);
        };
        /**
         * Handle errors from stomp.js
         */
        this.on_error = (error) => {
            // Trigger the error subject
            this.errorSubject.next(error);
            if (typeof error === 'object') {
                error = (/** @type {?} */ (error)).body;
            }
            this.debug(`Error: ${error}`);
            // Check for dropped connection and try reconnecting
            if (!this.client.connected) {
                // Reset state indicator
                this.state.next(StompState.CLOSED);
            }
        };
        this.state = new BehaviorSubject(StompState.CLOSED);
        this.connectObservable = this.state.pipe(filter((currentState) => {
            return currentState === StompState.CONNECTED;
        }));
        // Setup sending queuedMessages
        this.connectObservable.subscribe(() => {
            this.sendQueuedMessages();
        });
        this._serverHeadersBehaviourSubject = new BehaviorSubject(null);
        this.serverHeadersObservable = this._serverHeadersBehaviourSubject.pipe(filter((headers) => {
            return headers !== null;
        }));
        this.errorSubject = new Subject();
    }
    /**
     * Set configuration
     * @param {?} value
     * @return {?}
     */
    set config(value) {
        this._config = value;
    }
    /**
     * It will initialize STOMP Client.
     * @return {?}
     */
    initStompClient() {
        // disconnect if connected
        this.disconnect();
        // url takes precedence over socketFn
        if (typeof (this._config.url) === 'string') {
            this.client = client(this._config.url);
        }
        else {
            this.client = over(this._config.url);
        }
        // Configure client heart-beating
        this.client.heartbeat.incoming = this._config.heartbeat_in;
        this.client.heartbeat.outgoing = this._config.heartbeat_out;
        // Auto reconnect
        this.client.reconnect_delay = this._config.reconnect_delay;
        if (!this._config.debug) {
            this.debug = function () {
            };
        }
        // Set function to debug print messages
        this.client.debug = this.debug;
        // Default messages
        this.setupOnReceive();
        // Receipts
        this.setupReceipts();
    }
    /**
     * It will connect to the STOMP broker.
     * @return {?}
     */
    initAndConnect() {
        this.initStompClient();
        if (!this._config.headers) {
            this._config.headers = {};
        }
        // Attempt connection, passing in a callback
        this.client.connect(this._config.headers, this.on_connect, this.on_error);
        this.debug('Connecting...');
        this.state.next(StompState.TRYING);
    }
    /**
     * It will disconnect from the STOMP broker.
     * @return {?}
     */
    disconnect() {
        // Disconnect if connected. Callback will set CLOSED state
        if (this.client) {
            if (!this.client.connected) {
                // Nothing to do
                this.state.next(StompState.CLOSED);
                return;
            }
            // Notify observers that we are disconnecting!
            this.state.next(StompState.DISCONNECTING);
            this.client.disconnect(() => this.state.next(StompState.CLOSED));
        }
    }
    /**
     * It will return `true` if STOMP broker is connected and `false` otherwise.
     * @return {?}
     */
    connected() {
        return this.state.getValue() === StompState.CONNECTED;
    }
    /**
     * It will send a message to a named destination. The message must be `string`.
     *
     * The message will get locally queued if the STOMP broker is not connected. It will attempt to
     * publish queued messages as soon as the broker gets connected.
     *
     * @param {?} queueName
     * @param {?} message
     * @param {?=} headers
     * @return {?}
     */
    publish(queueName, message, headers = {}) {
        if (this.connected()) {
            this.client.send(queueName, headers, message);
        }
        else {
            this.debug(`Not connected, queueing ${message}`);
            this.queuedMessages.push({ queueName: /** @type {?} */ (queueName), message: /** @type {?} */ (message), headers: headers });
        }
    }
    /**
     * It will send queued messages.
     * @return {?}
     */
    sendQueuedMessages() {
        const /** @type {?} */ queuedMessages = this.queuedMessages;
        this.queuedMessages = [];
        this.debug(`Will try sending queued messages ${queuedMessages}`);
        for (const /** @type {?} */ queuedMessage of queuedMessages) {
            this.debug(`Attempting to send ${queuedMessage}`);
            this.publish(queuedMessage.queueName, queuedMessage.message, queuedMessage.headers);
        }
    }
    /**
     * It will subscribe to server message queues
     *
     * This method can be safely called even if the STOMP broker is not connected.
     * If the underlying STOMP connection drops and reconnects, it will resubscribe automatically.
     *
     * If a header field 'ack' is not explicitly passed, 'ack' will be set to 'auto'. If you
     * do not understand what it means, please leave it as is.
     *
     * Note that when working with temporary queues where the subscription request
     * creates the
     * underlying queue, mssages might be missed during reconnect. This issue is not specific
     * to this library but the way STOMP brokers are designed to work.
     *
     * @param {?} queueName
     * @param {?=} headers
     * @return {?}
     */
    subscribe(queueName, headers = {}) {
        /* Well the logic is complicated but works beautifully. RxJS is indeed wonderful.
             *
             * We need to activate the underlying subscription immediately if Stomp is connected. If not it should
             * subscribe when it gets next connected. Further it should re establish the subscription whenever Stomp
             * successfully reconnects.
             *
             * Actual implementation is simple, we filter the BehaviourSubject 'state' so that we can trigger whenever Stomp is
             * connected. Since 'state' is a BehaviourSubject, if Stomp is already connected, it will immediately trigger.
             *
             * The observable that we return to caller remains same across all reconnects, so no special handling needed at
             * the message subscriber.
             */
        this.debug(`Request to subscribe ${queueName}`);
        // By default auto acknowledgement of messages
        if (!headers['ack']) {
            headers['ack'] = 'auto';
        }
        const /** @type {?} */ coldObservable = Observable.create((messages) => {
            /*
                     * These variables will be used as part of the closure and work their magic during unsubscribe
                     */
            let /** @type {?} */ stompSubscription;
            let /** @type {?} */ stompConnectedSubscription;
            stompConnectedSubscription = this.connectObservable
                .subscribe(() => {
                this.debug(`Will subscribe to ${queueName}`);
                stompSubscription = this.client.subscribe(queueName, (message) => {
                    messages.next(message);
                }, headers);
            });
            return () => {
                /* cleanup function, will be called when no subscribers are left */
                this.debug(`Stop watching connection state (for ${queueName})`);
                stompConnectedSubscription.unsubscribe();
                if (this.state.getValue() === StompState.CONNECTED) {
                    this.debug(`Will unsubscribe from ${queueName} at Stomp`);
                    stompSubscription.unsubscribe();
                }
                else {
                    this.debug(`Stomp not connected, no need to unsubscribe from ${queueName} at Stomp`);
                }
            };
        });
        /**
             * Important - convert it to hot Observable - otherwise, if the user code subscribes
             * to this observable twice, it will subscribe twice to Stomp broker. (This was happening in the current example).
             * A long but good explanatory article at https://medium.com/@benlesh/hot-vs-cold-observables-f8094ed53339
             */
        return coldObservable.pipe(share());
    }
    /**
     * It will handle messages received in the default queue. Messages that would not be handled otherwise
     * get delivered to the default queue.
     * @return {?}
     */
    setupOnReceive() {
        this.defaultMessagesObservable = new Subject();
        this.client.onreceive = (message) => {
            this.defaultMessagesObservable.next(message);
        };
    }
    /**
     * It will emit all receipts.
     * @return {?}
     */
    setupReceipts() {
        this.receiptsObservable = new Subject();
        this.client.onreceipt = (frame) => {
            this.receiptsObservable.next(frame);
        };
    }
    /**
     * Wait for receipt, this indicates that server has carried out the related operation
     * @param {?} receiptId
     * @param {?} callback
     * @return {?}
     */
    waitForReceipt(receiptId, callback) {
        this.receiptsObservable.pipe(filter((frame) => {
            return frame.headers['receipt-id'] === receiptId;
        }), first()).subscribe((frame) => {
            callback(frame);
        });
    }
}
StompRService.Éµfac = function StompRService_Factory(t) { return new (t || StompRService)(); };
StompRService.Éµprov = Éµngcc0.ÉµÉµdefineInjectable({ token: StompRService, factory: StompRService.Éµfac });
/** @nocollapse */
StompRService.ctorParameters = () => [];
/*@__PURE__*/ (function () { Éµngcc0.ÉµsetClassMetadata(StompRService, [{
        type: Injectable
    }], function () { return []; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Represents a configuration object for the
 * STOMPService to connect to.
 */
class StompConfig {
}
StompConfig.Éµfac = function StompConfig_Factory(t) { return new (t || StompConfig)(); };
StompConfig.Éµprov = Éµngcc0.ÉµÉµdefineInjectable({ token: StompConfig, factory: StompConfig.Éµfac });
/*@__PURE__*/ (function () { Éµngcc0.ÉµsetClassMetadata(StompConfig, [{
        type: Injectable
    }], null, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * Angular2 STOMP Service using \@stomp/stomp.js
 *
 * \@description This service handles subscribing to a
 * message queue using the stomp.js library, and returns
 * values via the ES6 Observable specification for
 * asynchronous value streaming by wiring the STOMP
 * messages into an observable.
 *
 * If you want to manually configure and initialize the service
 * please use StompRService
 */
class StompService extends StompRService {
    /**
     * Constructor
     *
     * See README and samples for configuration examples
     * @param {?} config
     */
    constructor(config) {
        super();
        this.config = config;
        this.initAndConnect();
    }
}
StompService.Éµfac = function StompService_Factory(t) { return new (t || StompService)(Éµngcc0.ÉµÉµinject(StompConfig)); };
StompService.Éµprov = Éµngcc0.ÉµÉµdefineInjectable({ token: StompService, factory: StompService.Éµfac });
/** @nocollapse */
StompService.ctorParameters = () => [
    { type: StompConfig, },
];
/*@__PURE__*/ (function () { Éµngcc0.ÉµsetClassMetadata(StompService, [{
        type: Injectable
    }], function () { return [{ type: StompConfig }]; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * RPC Config. See the guide for example.
 */
class StompRPCConfig {
}
StompRPCConfig.Éµfac = function StompRPCConfig_Factory(t) { return new (t || StompRPCConfig)(); };
StompRPCConfig.Éµprov = Éµngcc0.ÉµÉµdefineInjectable({ token: StompRPCConfig, factory: StompRPCConfig.Éµfac });
/*@__PURE__*/ (function () { Éµngcc0.ÉµsetClassMetadata(StompRPCConfig, [{
        type: Injectable
    }], null, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/**
 * An implementation of RPC service using messaging.
 *
 * Please see the [guide](../additional-documentation/rpc---remote-procedure-call.html) for details.
 */
class StompRPCService {
    /**
     * Create an instance, see the [guide](../additional-documentation/rpc---remote-procedure-call.html) for details.
     * @param {?} stompService
     * @param {?=} stompRPCConfig
     */
    constructor(stompService, stompRPCConfig) {
        this.stompService = stompService;
        this.stompRPCConfig = stompRPCConfig;
        this._replyQueueName = '/temp-queue/rpc-replies';
        this._setupReplyQueue = () => {
            return this.stompService.defaultMessagesObservable;
        };
        if (stompRPCConfig) {
            if (stompRPCConfig.replyQueueName) {
                this._replyQueueName = stompRPCConfig.replyQueueName;
            }
            if (stompRPCConfig.setupReplyQueue) {
                this._setupReplyQueue = stompRPCConfig.setupReplyQueue;
            }
        }
    }
    /**
     * Make an RPC request. See the [guide](../additional-documentation/rpc---remote-procedure-call.html) for example.
     * @param {?} serviceEndPoint
     * @param {?} payload
     * @param {?=} headers
     * @return {?}
     */
    rpc(serviceEndPoint, payload, headers) {
        // We know there will be only one message in reply
        return this.stream(serviceEndPoint, payload, headers).pipe(first());
    }
    /**
     * Make an RPC stream request. See the [guide](../additional-documentation/rpc---remote-procedure-call.html).
     * @param {?} serviceEndPoint
     * @param {?} payload
     * @param {?=} headers
     * @return {?}
     */
    stream(serviceEndPoint, payload, headers = {}) {
        if (!this._repliesObservable) {
            this._repliesObservable = this._setupReplyQueue(this._replyQueueName, this.stompService);
        }
        return Observable.create((rpcObserver) => {
            let /** @type {?} */ defaultMessagesSubscription;
            const /** @type {?} */ correlationId = UUID.UUID();
            defaultMessagesSubscription = this._repliesObservable.pipe(filter((message) => {
                return message.headers['correlation-id'] === correlationId;
            })).subscribe((message) => {
                rpcObserver.next(message);
            });
            // send an RPC request
            headers['reply-to'] = this._replyQueueName;
            headers['correlation-id'] = correlationId;
            this.stompService.publish(serviceEndPoint, payload, headers);
            return () => {
                // Cleanup
                defaultMessagesSubscription.unsubscribe();
            };
        });
    }
}
StompRPCService.Éµfac = function StompRPCService_Factory(t) { return new (t || StompRPCService)(Éµngcc0.ÉµÉµinject(StompRService), Éµngcc0.ÉµÉµinject(StompRPCConfig)); };
StompRPCService.Éµprov = Éµngcc0.ÉµÉµdefineInjectable({ token: StompRPCService, factory: StompRPCService.Éµfac });
/** @nocollapse */
StompRPCService.ctorParameters = () => [
    { type: StompRService, },
    { type: StompRPCConfig, },
];
/*@__PURE__*/ (function () { Éµngcc0.ÉµsetClassMetadata(StompRPCService, [{
        type: Injectable
    }], function () { return [{ type: StompRService }, { type: StompRPCConfig }]; }, null); })();

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */

export { StompRService, StompService, StompState, StompConfig, StompRPCService, StompRPCConfig };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvbXAtbmcyLXN0b21wanMuanMiLCJzb3VyY2VzIjpbIm5nOi9Ac3RvbXAvbmcyLXN0b21wanMvc3JjL3N0b21wLXIuc2VydmljZS50cyIsIm5nOi9Ac3RvbXAvbmcyLXN0b21wanMvc3JjL3N0b21wLmNvbmZpZy50cyIsIm5nOi9Ac3RvbXAvbmcyLXN0b21wanMvc3JjL3N0b21wLnNlcnZpY2UudHMiLCJuZzovQHN0b21wL25nMi1zdG9tcGpzL3NyYy9zdG9tcC1ycGMuY29uZmlnLnRzIiwibmc6L0BzdG9tcC9uZzItc3RvbXBqcy9zcmMvc3RvbXAtcnBjLnNlcnZpY2UudHMiXSwibmFtZXMiOlsiU3RvbXAuY2xpZW50IiwiU3RvbXAub3ZlciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBSTtBQUNGO0FBQUc7QUFDSTtBQUVMO0FBRVU7QUFDVTtBQUNQO0FBQ2hCO0FBQUc7QUFHYztBQUNsQjtBQVlBO0FBQXNCO0FBQ3JCO0FBQ2E7QUFBTztBQUVxQjtBQUFRO0FBQW9CO0FBQVk7QUFHekQ7QUFBWSw4QkF3Q3lELEVBQUU7QUFDaEc7QUFFSztBQUVLO0FBQVc7QUFLaEI7QUFJRjtBQUNPLHFCQTZRVSxDQUFDLElBQVM7QUFBTyxZQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDbEMsU0FBRztBQUVIO0FBQVk7QUFDRTtBQUFZLDBCQUFELENBQUMsS0FBWTtBQUN0QyxZQUNJLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDNUIsWUFDSSxJQUFJLENBQUMsOEJBQThCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUM1RDtBQUVPLFlBQUgsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQzFDLFNBQUc7QUFFSDtBQUFZO0FBQ0U7QUFBWSx3QkFBSCxD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QztBQUF5QztBQUFJO0FBQUM7O0FKWEEsQUF5QkEsQUErQ0EsQUFBQSxBQTRSQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUdBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUdBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQ0EsQUExU0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUlBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBR0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUdBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUFELEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUFDLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFNQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFPQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBTUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBYUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFJQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQW1CQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBSUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFPQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQU9BLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUtBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUtBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQW5VQSxBQUFBLEFDdkJBLEFBT0EsQUFEQSxBQUFBLEFDUEEsQUFtQkEsQUFBQSxBQUFBLEFBQUEsQUFPQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQVpBLEFBQUEsQUFoQkEsQUFBQSxBQ0FBLEFBWUEsQUFEQSxBQUFBLEFDYkEsQUFjQSxBQVlBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQVhBLEFBQUEsQUFFQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQVFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQ0EsQUFLQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFNQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFHQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUE5REEsQUFBQSxBQVJBLEFBQUEsQUFDQSxBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZmlyc3QsIGZpbHRlciwgc2hhcmUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgLCAgT2JzZXJ2YWJsZSAsICBPYnNlcnZlciAsICBTdWJqZWN0ICwgIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBTdG9tcENvbmZpZyB9IGZyb20gJy4vc3RvbXAuY29uZmlnJztcblxuaW1wb3J0ICogYXMgU3RvbXAgZnJvbSAnQHN0b21wL3N0b21wanMnO1xuaW1wb3J0IHsgRnJhbWUsIFN0b21wU3Vic2NyaXB0aW9uIH0gZnJvbSAnQHN0b21wL3N0b21wanMnO1xuaW1wb3J0IHsgU3RvbXBIZWFkZXJzIH0gZnJvbSAnLi9zdG9tcC1oZWFkZXJzJztcbmltcG9ydCB7IFN0b21wU3RhdGUgfSBmcm9tICcuL3N0b21wLXN0YXRlJztcblxuLyoqXG4gKiBBbmd1bGFyMiBTVE9NUCBSYXcgU2VydmljZSB1c2luZyBAc3RvbXAvc3RvbXAuanNcbiAqXG4gKiBZb3Ugd2lsbCBvbmx5IG5lZWQgdGhlIHB1YmxpYyBwcm9wZXJ0aWVzIGFuZFxuICogbWV0aG9kcyBsaXN0ZWQgdW5sZXNzIHlvdSBhcmUgYW4gYWR2YW5jZWQgdXNlci4gVGhpcyBzZXJ2aWNlIGhhbmRsZXMgc3Vic2NyaWJpbmcgdG8gYVxuICogbWVzc2FnZSBxdWV1ZSB1c2luZyB0aGUgc3RvbXAuanMgbGlicmFyeSwgYW5kIHJldHVybnNcbiAqIHZhbHVlcyB2aWEgdGhlIEVTNiBPYnNlcnZhYmxlIHNwZWNpZmljYXRpb24gZm9yXG4gKiBhc3luY2hyb25vdXMgdmFsdWUgc3RyZWFtaW5nIGJ5IHdpcmluZyB0aGUgU1RPTVBcbiAqIG1lc3NhZ2VzIGludG8gYW4gb2JzZXJ2YWJsZS5cbiAqXG4gKiBJZiB5b3Ugd2lsbCBsaWtlIHRvIHBhc3MgdGhlIGNvbmZpZ3VyYXRpb24gYXMgYSBkZXBlbmRlbmN5LFxuICogcGxlYXNlIHVzZSBTdG9tcFNlcnZpY2UgY2xhc3MuXG4gKi9cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTdG9tcFJTZXJ2aWNlIHtcbiAgLyoqXG4gICAqIFN0YXRlIG9mIHRoZSBTVE9NUFNlcnZpY2VcbiAgICpcbiAgICogSXQgaXMgYSBCZWhhdmlvclN1YmplY3QgYW5kIHdpbGwgZW1pdCBjdXJyZW50IHN0YXR1cyBpbW1lZGlhdGVseS4gVGhpcyB3aWxsIHR5cGljYWxseSBnZXRcbiAgICogdXNlZCB0byBzaG93IGN1cnJlbnQgc3RhdHVzIHRvIHRoZSBlbmQgdXNlci5cbiAgICovXG4gIHB1YmxpYyBzdGF0ZTogQmVoYXZpb3JTdWJqZWN0PFN0b21wU3RhdGU+O1xuXG4gIC8qKlxuICAgKiBXaWxsIHRyaWdnZXIgd2hlbiBjb25uZWN0aW9uIGlzIGVzdGFibGlzaGVkLiBVc2UgdGhpcyB0byBjYXJyeSBvdXQgaW5pdGlhbGl6YXRpb24uXG4gICAqIEl0IHdpbGwgdHJpZ2dlciBldmVyeSB0aW1lIGEgKHJlKWNvbm5lY3Rpb24gb2NjdXJzLiBJZiBpdCBpcyBhbHJlYWR5IGNvbm5lY3RlZFxuICAgKiBpdCB3aWxsIHRyaWdnZXIgaW1tZWRpYXRlbHkuIFlvdSBjYW4gc2FmZWx5IGlnbm9yZSB0aGUgdmFsdWUsIGFzIGl0IHdpbGwgYWx3YXlzIGJlXG4gICAqIFN0b21wU3RhdGUuQ09OTkVDVEVEXG4gICAqL1xuICBwdWJsaWMgY29ubmVjdE9ic2VydmFibGU6IE9ic2VydmFibGU8U3RvbXBTdGF0ZT47XG5cbiAgLyoqXG4gICAqIFByb3ZpZGVzIGhlYWRlcnMgZnJvbSBtb3N0IHJlY2VudCBjb25uZWN0aW9uIHRvIHRoZSBzZXJ2ZXIgYXMgcmV0dXJuIGJ5IHRoZSBDT05ORUNURURcbiAgICogZnJhbWUuXG4gICAqIElmIHRoZSBTVE9NUCBjb25uZWN0aW9uIGhhcyBhbHJlYWR5IGJlZW4gZXN0YWJsaXNoZWQgaXQgd2lsbCB0cmlnZ2VyIGltbWVkaWF0ZWx5LlxuICAgKiBJdCB3aWxsIGFkZGl0aW9uYWxseSB0cmlnZ2VyIGluIGV2ZW50IG9mIHJlY29ubmVjdGlvbiwgdGhlIHZhbHVlIHdpbGwgYmUgc2V0IG9mIGhlYWRlcnMgZnJvbVxuICAgKiB0aGUgcmVjZW50IHNlcnZlciByZXNwb25zZS5cbiAgICovXG4gIHB1YmxpYyBzZXJ2ZXJIZWFkZXJzT2JzZXJ2YWJsZTogT2JzZXJ2YWJsZTxTdG9tcEhlYWRlcnM+O1xuXG4gIHByaXZhdGUgX3NlcnZlckhlYWRlcnNCZWhhdmlvdXJTdWJqZWN0OiBCZWhhdmlvclN1YmplY3Q8bnVsbCB8IFN0b21wSGVhZGVycz47XG5cbiAgLyoqXG4gICAqIFdpbGwgZW1pdCBhbGwgbWVzc2FnZXMgdG8gdGhlIGRlZmF1bHQgcXVldWUgKGFueSBtZXNzYWdlIHRoYXQgYXJlIG5vdCBoYW5kbGVkIGJ5IGEgc3Vic2NyaXB0aW9uKVxuICAgKi9cbiAgcHVibGljIGRlZmF1bHRNZXNzYWdlc09ic2VydmFibGU6IFN1YmplY3Q8U3RvbXAuTWVzc2FnZT47XG5cbiAgLyoqXG4gICAqIFdpbGwgZW1pdCBhbGwgcmVjZWlwdHNcbiAgICovXG4gIHB1YmxpYyByZWNlaXB0c09ic2VydmFibGU6IFN1YmplY3Q8U3RvbXAuRnJhbWU+O1xuXG4gIC8qKlxuICAgKiBXaWxsIHRyaWdnZXIgd2hlbiBhbiBlcnJvciBvY2N1cnMuIFRoaXMgU3ViamVjdCBjYW4gYmUgdXNlZCB0byBoYW5kbGUgZXJyb3JzIGZyb21cbiAgICogdGhlIHN0b21wIGJyb2tlci5cbiAgICovXG4gIHB1YmxpYyBlcnJvclN1YmplY3Q6IFN1YmplY3Q8c3RyaW5nIHwgU3RvbXAuTWVzc2FnZT47XG5cbiAgLyoqXG4gICAqIEludGVybmFsIGFycmF5IHRvIGhvbGQgbG9jYWxseSBxdWV1ZWQgbWVzc2FnZXMgd2hlbiBTVE9NUCBicm9rZXIgaXMgbm90IGNvbm5lY3RlZC5cbiAgICovXG4gIHByb3RlY3RlZCBxdWV1ZWRNZXNzYWdlczogeyBxdWV1ZU5hbWU6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBoZWFkZXJzOiBTdG9tcEhlYWRlcnMgfVtdID0gW107XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyYXRpb25cbiAgICovXG4gIHByaXZhdGUgX2NvbmZpZzogU3RvbXBDb25maWc7XG5cbiAgLyoqXG4gICAqIFNUT01QIENsaWVudCBmcm9tIEBzdG9tcC9zdG9tcC5qc1xuICAgKi9cbiAgcHJvdGVjdGVkIGNsaWVudDogU3RvbXAuQ2xpZW50O1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RvclxuICAgKlxuICAgKiBTZWUgUkVBRE1FIGFuZCBzYW1wbGVzIGZvciBjb25maWd1cmF0aW9uIGV4YW1wbGVzXG4gICAqL1xuICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5zdGF0ZSA9IG5ldyBCZWhhdmlvclN1YmplY3Q8U3RvbXBTdGF0ZT4oU3RvbXBTdGF0ZS5DTE9TRUQpO1xuXG4gICAgdGhpcy5jb25uZWN0T2JzZXJ2YWJsZSA9IHRoaXMuc3RhdGUucGlwZShcbiAgICAgIGZpbHRlcigoY3VycmVudFN0YXRlOiBTdG9tcFN0YXRlKSA9PiB7XG4gICAgICAgIHJldHVybiBjdXJyZW50U3RhdGUgPT09IFN0b21wU3RhdGUuQ09OTkVDVEVEO1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgLy8gU2V0dXAgc2VuZGluZyBxdWV1ZWRNZXNzYWdlc1xuICAgIHRoaXMuY29ubmVjdE9ic2VydmFibGUuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIHRoaXMuc2VuZFF1ZXVlZE1lc3NhZ2VzKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9zZXJ2ZXJIZWFkZXJzQmVoYXZpb3VyU3ViamVjdCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8bnVsbCB8IFN0b21wSGVhZGVycz4obnVsbCk7XG5cbiAgICB0aGlzLnNlcnZlckhlYWRlcnNPYnNlcnZhYmxlID0gdGhpcy5fc2VydmVySGVhZGVyc0JlaGF2aW91clN1YmplY3QucGlwZShcbiAgICAgIGZpbHRlcigoaGVhZGVyczogbnVsbCB8IFN0b21wSGVhZGVycykgPT4ge1xuICAgICAgICByZXR1cm4gaGVhZGVycyAhPT0gbnVsbDtcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIHRoaXMuZXJyb3JTdWJqZWN0ID0gbmV3IFN1YmplY3QoKTtcbiAgfVxuXG4gIC8qKiBTZXQgY29uZmlndXJhdGlvbiAqL1xuICBzZXQgY29uZmlnKHZhbHVlOiBTdG9tcENvbmZpZykge1xuICAgIHRoaXMuX2NvbmZpZyA9IHZhbHVlO1xuICB9XG5cbiAgLyoqIEl0IHdpbGwgaW5pdGlhbGl6ZSBTVE9NUCBDbGllbnQuICovXG4gIHByb3RlY3RlZCBpbml0U3RvbXBDbGllbnQoKTogdm9pZCB7XG4gICAgLy8gZGlzY29ubmVjdCBpZiBjb25uZWN0ZWRcbiAgICB0aGlzLmRpc2Nvbm5lY3QoKTtcblxuICAgIC8vIHVybCB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgc29ja2V0Rm5cbiAgICBpZiAodHlwZW9mKHRoaXMuX2NvbmZpZy51cmwpID09PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5jbGllbnQgPSBTdG9tcC5jbGllbnQodGhpcy5fY29uZmlnLnVybCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2xpZW50ID0gU3RvbXAub3Zlcih0aGlzLl9jb25maWcudXJsKTtcbiAgICB9XG5cbiAgICAvLyBDb25maWd1cmUgY2xpZW50IGhlYXJ0LWJlYXRpbmdcbiAgICB0aGlzLmNsaWVudC5oZWFydGJlYXQuaW5jb21pbmcgPSB0aGlzLl9jb25maWcuaGVhcnRiZWF0X2luO1xuICAgIHRoaXMuY2xpZW50LmhlYXJ0YmVhdC5vdXRnb2luZyA9IHRoaXMuX2NvbmZpZy5oZWFydGJlYXRfb3V0O1xuXG4gICAgLy8gQXV0byByZWNvbm5lY3RcbiAgICB0aGlzLmNsaWVudC5yZWNvbm5lY3RfZGVsYXkgPSB0aGlzLl9jb25maWcucmVjb25uZWN0X2RlbGF5O1xuXG4gICAgaWYgKCF0aGlzLl9jb25maWcuZGVidWcpIHtcbiAgICAgIHRoaXMuZGVidWcgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB9O1xuICAgIH1cbiAgICAvLyBTZXQgZnVuY3Rpb24gdG8gZGVidWcgcHJpbnQgbWVzc2FnZXNcbiAgICB0aGlzLmNsaWVudC5kZWJ1ZyA9IHRoaXMuZGVidWc7XG5cbiAgICAvLyBEZWZhdWx0IG1lc3NhZ2VzXG4gICAgdGhpcy5zZXR1cE9uUmVjZWl2ZSgpO1xuXG4gICAgLy8gUmVjZWlwdHNcbiAgICB0aGlzLnNldHVwUmVjZWlwdHMoKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIEl0IHdpbGwgY29ubmVjdCB0byB0aGUgU1RPTVAgYnJva2VyLlxuICAgKi9cbiAgcHVibGljIGluaXRBbmRDb25uZWN0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5pdFN0b21wQ2xpZW50KCk7XG5cbiAgICBpZiAoIXRoaXMuX2NvbmZpZy5oZWFkZXJzKSB7XG4gICAgICB0aGlzLl9jb25maWcuaGVhZGVycyA9IHt9O1xuICAgIH1cblxuICAgIC8vIEF0dGVtcHQgY29ubmVjdGlvbiwgcGFzc2luZyBpbiBhIGNhbGxiYWNrXG4gICAgdGhpcy5jbGllbnQuY29ubmVjdChcbiAgICAgIHRoaXMuX2NvbmZpZy5oZWFkZXJzLFxuICAgICAgdGhpcy5vbl9jb25uZWN0LFxuICAgICAgdGhpcy5vbl9lcnJvclxuICAgICk7XG5cbiAgICB0aGlzLmRlYnVnKCdDb25uZWN0aW5nLi4uJyk7XG4gICAgdGhpcy5zdGF0ZS5uZXh0KFN0b21wU3RhdGUuVFJZSU5HKTtcbiAgfVxuXG5cbiAgLyoqXG4gICAqIEl0IHdpbGwgZGlzY29ubmVjdCBmcm9tIHRoZSBTVE9NUCBicm9rZXIuXG4gICAqL1xuICBwdWJsaWMgZGlzY29ubmVjdCgpOiB2b2lkIHtcblxuICAgIC8vIERpc2Nvbm5lY3QgaWYgY29ubmVjdGVkLiBDYWxsYmFjayB3aWxsIHNldCBDTE9TRUQgc3RhdGVcbiAgICBpZiAodGhpcy5jbGllbnQpIHtcbiAgICAgIGlmICghdGhpcy5jbGllbnQuY29ubmVjdGVkKSB7XG4gICAgICAgIC8vIE5vdGhpbmcgdG8gZG9cbiAgICAgICAgdGhpcy5zdGF0ZS5uZXh0KFN0b21wU3RhdGUuQ0xPU0VEKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBOb3RpZnkgb2JzZXJ2ZXJzIHRoYXQgd2UgYXJlIGRpc2Nvbm5lY3RpbmchXG4gICAgICB0aGlzLnN0YXRlLm5leHQoU3RvbXBTdGF0ZS5ESVNDT05ORUNUSU5HKTtcblxuICAgICAgdGhpcy5jbGllbnQuZGlzY29ubmVjdChcbiAgICAgICAgKCkgPT4gdGhpcy5zdGF0ZS5uZXh0KFN0b21wU3RhdGUuQ0xPU0VEKVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSXQgd2lsbCByZXR1cm4gYHRydWVgIGlmIFNUT01QIGJyb2tlciBpcyBjb25uZWN0ZWQgYW5kIGBmYWxzZWAgb3RoZXJ3aXNlLlxuICAgKi9cbiAgcHVibGljIGNvbm5lY3RlZCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5nZXRWYWx1ZSgpID09PSBTdG9tcFN0YXRlLkNPTk5FQ1RFRDtcbiAgfVxuXG4gIC8qKlxuICAgKiBJdCB3aWxsIHNlbmQgYSBtZXNzYWdlIHRvIGEgbmFtZWQgZGVzdGluYXRpb24uIFRoZSBtZXNzYWdlIG11c3QgYmUgYHN0cmluZ2AuXG4gICAqXG4gICAqIFRoZSBtZXNzYWdlIHdpbGwgZ2V0IGxvY2FsbHkgcXVldWVkIGlmIHRoZSBTVE9NUCBicm9rZXIgaXMgbm90IGNvbm5lY3RlZC4gSXQgd2lsbCBhdHRlbXB0IHRvXG4gICAqIHB1Ymxpc2ggcXVldWVkIG1lc3NhZ2VzIGFzIHNvb24gYXMgdGhlIGJyb2tlciBnZXRzIGNvbm5lY3RlZC5cbiAgICpcbiAgICogQHBhcmFtIHF1ZXVlTmFtZVxuICAgKiBAcGFyYW0gbWVzc2FnZVxuICAgKiBAcGFyYW0gaGVhZGVyc1xuICAgKi9cbiAgcHVibGljIHB1Ymxpc2gocXVldWVOYW1lOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgaGVhZGVyczogU3RvbXBIZWFkZXJzID0ge30pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb25uZWN0ZWQoKSkge1xuICAgICAgdGhpcy5jbGllbnQuc2VuZChxdWV1ZU5hbWUsIGhlYWRlcnMsIG1lc3NhZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRlYnVnKGBOb3QgY29ubmVjdGVkLCBxdWV1ZWluZyAke21lc3NhZ2V9YCk7XG4gICAgICB0aGlzLnF1ZXVlZE1lc3NhZ2VzLnB1c2goe3F1ZXVlTmFtZTogPHN0cmluZz5xdWV1ZU5hbWUsIG1lc3NhZ2U6IDxzdHJpbmc+bWVzc2FnZSwgaGVhZGVyczogaGVhZGVyc30pO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBJdCB3aWxsIHNlbmQgcXVldWVkIG1lc3NhZ2VzLiAqL1xuICBwcm90ZWN0ZWQgc2VuZFF1ZXVlZE1lc3NhZ2VzKCk6IHZvaWQge1xuICAgIGNvbnN0IHF1ZXVlZE1lc3NhZ2VzID0gdGhpcy5xdWV1ZWRNZXNzYWdlcztcbiAgICB0aGlzLnF1ZXVlZE1lc3NhZ2VzID0gW107XG5cbiAgICB0aGlzLmRlYnVnKGBXaWxsIHRyeSBzZW5kaW5nIHF1ZXVlZCBtZXNzYWdlcyAke3F1ZXVlZE1lc3NhZ2VzfWApO1xuXG4gICAgZm9yIChjb25zdCBxdWV1ZWRNZXNzYWdlIG9mIHF1ZXVlZE1lc3NhZ2VzKSB7XG4gICAgICB0aGlzLmRlYnVnKGBBdHRlbXB0aW5nIHRvIHNlbmQgJHtxdWV1ZWRNZXNzYWdlfWApO1xuICAgICAgdGhpcy5wdWJsaXNoKHF1ZXVlZE1lc3NhZ2UucXVldWVOYW1lLCBxdWV1ZWRNZXNzYWdlLm1lc3NhZ2UsIHF1ZXVlZE1lc3NhZ2UuaGVhZGVycyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEl0IHdpbGwgc3Vic2NyaWJlIHRvIHNlcnZlciBtZXNzYWdlIHF1ZXVlc1xuICAgKlxuICAgKiBUaGlzIG1ldGhvZCBjYW4gYmUgc2FmZWx5IGNhbGxlZCBldmVuIGlmIHRoZSBTVE9NUCBicm9rZXIgaXMgbm90IGNvbm5lY3RlZC5cbiAgICogSWYgdGhlIHVuZGVybHlpbmcgU1RPTVAgY29ubmVjdGlvbiBkcm9wcyBhbmQgcmVjb25uZWN0cywgaXQgd2lsbCByZXN1YnNjcmliZSBhdXRvbWF0aWNhbGx5LlxuICAgKlxuICAgKiBJZiBhIGhlYWRlciBmaWVsZCAnYWNrJyBpcyBub3QgZXhwbGljaXRseSBwYXNzZWQsICdhY2snIHdpbGwgYmUgc2V0IHRvICdhdXRvJy4gSWYgeW91XG4gICAqIGRvIG5vdCB1bmRlcnN0YW5kIHdoYXQgaXQgbWVhbnMsIHBsZWFzZSBsZWF2ZSBpdCBhcyBpcy5cbiAgICpcbiAgICogTm90ZSB0aGF0IHdoZW4gd29ya2luZyB3aXRoIHRlbXBvcmFyeSBxdWV1ZXMgd2hlcmUgdGhlIHN1YnNjcmlwdGlvbiByZXF1ZXN0XG4gICAqIGNyZWF0ZXMgdGhlXG4gICAqIHVuZGVybHlpbmcgcXVldWUsIG1zc2FnZXMgbWlnaHQgYmUgbWlzc2VkIGR1cmluZyByZWNvbm5lY3QuIFRoaXMgaXNzdWUgaXMgbm90IHNwZWNpZmljXG4gICAqIHRvIHRoaXMgbGlicmFyeSBidXQgdGhlIHdheSBTVE9NUCBicm9rZXJzIGFyZSBkZXNpZ25lZCB0byB3b3JrLlxuICAgKlxuICAgKiBAcGFyYW0gcXVldWVOYW1lXG4gICAqIEBwYXJhbSBoZWFkZXJzXG4gICAqL1xuICBwdWJsaWMgc3Vic2NyaWJlKHF1ZXVlTmFtZTogc3RyaW5nLCBoZWFkZXJzOiBTdG9tcEhlYWRlcnMgPSB7fSk6IE9ic2VydmFibGU8U3RvbXAuTWVzc2FnZT4ge1xuXG4gICAgLyogV2VsbCB0aGUgbG9naWMgaXMgY29tcGxpY2F0ZWQgYnV0IHdvcmtzIGJlYXV0aWZ1bGx5LiBSeEpTIGlzIGluZGVlZCB3b25kZXJmdWwuXG4gICAgICpcbiAgICAgKiBXZSBuZWVkIHRvIGFjdGl2YXRlIHRoZSB1bmRlcmx5aW5nIHN1YnNjcmlwdGlvbiBpbW1lZGlhdGVseSBpZiBTdG9tcCBpcyBjb25uZWN0ZWQuIElmIG5vdCBpdCBzaG91bGRcbiAgICAgKiBzdWJzY3JpYmUgd2hlbiBpdCBnZXRzIG5leHQgY29ubmVjdGVkLiBGdXJ0aGVyIGl0IHNob3VsZCByZSBlc3RhYmxpc2ggdGhlIHN1YnNjcmlwdGlvbiB3aGVuZXZlciBTdG9tcFxuICAgICAqIHN1Y2Nlc3NmdWxseSByZWNvbm5lY3RzLlxuICAgICAqXG4gICAgICogQWN0dWFsIGltcGxlbWVudGF0aW9uIGlzIHNpbXBsZSwgd2UgZmlsdGVyIHRoZSBCZWhhdmlvdXJTdWJqZWN0ICdzdGF0ZScgc28gdGhhdCB3ZSBjYW4gdHJpZ2dlciB3aGVuZXZlciBTdG9tcCBpc1xuICAgICAqIGNvbm5lY3RlZC4gU2luY2UgJ3N0YXRlJyBpcyBhIEJlaGF2aW91clN1YmplY3QsIGlmIFN0b21wIGlzIGFscmVhZHkgY29ubmVjdGVkLCBpdCB3aWxsIGltbWVkaWF0ZWx5IHRyaWdnZXIuXG4gICAgICpcbiAgICAgKiBUaGUgb2JzZXJ2YWJsZSB0aGF0IHdlIHJldHVybiB0byBjYWxsZXIgcmVtYWlucyBzYW1lIGFjcm9zcyBhbGwgcmVjb25uZWN0cywgc28gbm8gc3BlY2lhbCBoYW5kbGluZyBuZWVkZWQgYXRcbiAgICAgKiB0aGUgbWVzc2FnZSBzdWJzY3JpYmVyLlxuICAgICAqL1xuICAgIHRoaXMuZGVidWcoYFJlcXVlc3QgdG8gc3Vic2NyaWJlICR7cXVldWVOYW1lfWApO1xuXG4gICAgLy8gQnkgZGVmYXVsdCBhdXRvIGFja25vd2xlZGdlbWVudCBvZiBtZXNzYWdlc1xuICAgIGlmICghaGVhZGVyc1snYWNrJ10pIHtcbiAgICAgIGhlYWRlcnNbJ2FjayddID0gJ2F1dG8nO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbGRPYnNlcnZhYmxlID0gT2JzZXJ2YWJsZS5jcmVhdGUoXG4gICAgICAobWVzc2FnZXM6IE9ic2VydmVyPFN0b21wLk1lc3NhZ2U+KSA9PiB7XG4gICAgICAgIC8qXG4gICAgICAgICAqIFRoZXNlIHZhcmlhYmxlcyB3aWxsIGJlIHVzZWQgYXMgcGFydCBvZiB0aGUgY2xvc3VyZSBhbmQgd29yayB0aGVpciBtYWdpYyBkdXJpbmcgdW5zdWJzY3JpYmVcbiAgICAgICAgICovXG4gICAgICAgIGxldCBzdG9tcFN1YnNjcmlwdGlvbjogU3RvbXBTdWJzY3JpcHRpb247XG5cbiAgICAgICAgbGV0IHN0b21wQ29ubmVjdGVkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgICAgICAgc3RvbXBDb25uZWN0ZWRTdWJzY3JpcHRpb24gPSB0aGlzLmNvbm5lY3RPYnNlcnZhYmxlXG4gICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRlYnVnKGBXaWxsIHN1YnNjcmliZSB0byAke3F1ZXVlTmFtZX1gKTtcbiAgICAgICAgICAgIHN0b21wU3Vic2NyaXB0aW9uID0gdGhpcy5jbGllbnQuc3Vic2NyaWJlKHF1ZXVlTmFtZSwgKG1lc3NhZ2U6IFN0b21wLk1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlcy5uZXh0KG1lc3NhZ2UpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBoZWFkZXJzKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gKCkgPT4geyAvKiBjbGVhbnVwIGZ1bmN0aW9uLCB3aWxsIGJlIGNhbGxlZCB3aGVuIG5vIHN1YnNjcmliZXJzIGFyZSBsZWZ0ICovXG4gICAgICAgICAgdGhpcy5kZWJ1ZyhgU3RvcCB3YXRjaGluZyBjb25uZWN0aW9uIHN0YXRlIChmb3IgJHtxdWV1ZU5hbWV9KWApO1xuICAgICAgICAgIHN0b21wQ29ubmVjdGVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG5cbiAgICAgICAgICBpZiAodGhpcy5zdGF0ZS5nZXRWYWx1ZSgpID09PSBTdG9tcFN0YXRlLkNPTk5FQ1RFRCkge1xuICAgICAgICAgICAgdGhpcy5kZWJ1ZyhgV2lsbCB1bnN1YnNjcmliZSBmcm9tICR7cXVldWVOYW1lfSBhdCBTdG9tcGApO1xuICAgICAgICAgICAgc3RvbXBTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5kZWJ1ZyhgU3RvbXAgbm90IGNvbm5lY3RlZCwgbm8gbmVlZCB0byB1bnN1YnNjcmliZSBmcm9tICR7cXVldWVOYW1lfSBhdCBTdG9tcGApO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgLyoqXG4gICAgICogSW1wb3J0YW50IC0gY29udmVydCBpdCB0byBob3QgT2JzZXJ2YWJsZSAtIG90aGVyd2lzZSwgaWYgdGhlIHVzZXIgY29kZSBzdWJzY3JpYmVzXG4gICAgICogdG8gdGhpcyBvYnNlcnZhYmxlIHR3aWNlLCBpdCB3aWxsIHN1YnNjcmliZSB0d2ljZSB0byBTdG9tcCBicm9rZXIuIChUaGlzIHdhcyBoYXBwZW5pbmcgaW4gdGhlIGN1cnJlbnQgZXhhbXBsZSkuXG4gICAgICogQSBsb25nIGJ1dCBnb29kIGV4cGxhbmF0b3J5IGFydGljbGUgYXQgaHR0cHM6Ly9tZWRpdW0uY29tL0BiZW5sZXNoL2hvdC12cy1jb2xkLW9ic2VydmFibGVzLWY4MDk0ZWQ1MzMzOVxuICAgICAqL1xuICAgIHJldHVybiBjb2xkT2JzZXJ2YWJsZS5waXBlKHNoYXJlKCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEl0IHdpbGwgaGFuZGxlIG1lc3NhZ2VzIHJlY2VpdmVkIGluIHRoZSBkZWZhdWx0IHF1ZXVlLiBNZXNzYWdlcyB0aGF0IHdvdWxkIG5vdCBiZSBoYW5kbGVkIG90aGVyd2lzZVxuICAgKiBnZXQgZGVsaXZlcmVkIHRvIHRoZSBkZWZhdWx0IHF1ZXVlLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNldHVwT25SZWNlaXZlKCk6IHZvaWQge1xuICAgIHRoaXMuZGVmYXVsdE1lc3NhZ2VzT2JzZXJ2YWJsZSA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgICB0aGlzLmNsaWVudC5vbnJlY2VpdmUgPSAobWVzc2FnZTogU3RvbXAuTWVzc2FnZSkgPT4ge1xuICAgICAgdGhpcy5kZWZhdWx0TWVzc2FnZXNPYnNlcnZhYmxlLm5leHQobWVzc2FnZSk7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJdCB3aWxsIGVtaXQgYWxsIHJlY2VpcHRzLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNldHVwUmVjZWlwdHMoKTogdm9pZCB7XG4gICAgdGhpcy5yZWNlaXB0c09ic2VydmFibGUgPSBuZXcgU3ViamVjdCgpO1xuXG4gICAgdGhpcy5jbGllbnQub25yZWNlaXB0ID0gKGZyYW1lOiBTdG9tcC5GcmFtZSkgPT4ge1xuICAgICAgdGhpcy5yZWNlaXB0c09ic2VydmFibGUubmV4dChmcmFtZSk7XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXYWl0IGZvciByZWNlaXB0LCB0aGlzIGluZGljYXRlcyB0aGF0IHNlcnZlciBoYXMgY2FycmllZCBvdXQgdGhlIHJlbGF0ZWQgb3BlcmF0aW9uXG4gICAqL1xuICBwdWJsaWMgd2FpdEZvclJlY2VpcHQocmVjZWlwdElkOiBzdHJpbmcsIGNhbGxiYWNrOiAoZnJhbWU6IFN0b21wLkZyYW1lKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5yZWNlaXB0c09ic2VydmFibGUucGlwZShcbiAgICAgIGZpbHRlcigoZnJhbWU6IFN0b21wLkZyYW1lKSA9PiB7XG4gICAgICAgIHJldHVybiBmcmFtZS5oZWFkZXJzWydyZWNlaXB0LWlkJ10gPT09IHJlY2VpcHRJZDtcbiAgICAgIH0pLFxuICAgICAgZmlyc3QoKVxuICAgICkuc3Vic2NyaWJlKChmcmFtZTogU3RvbXAuRnJhbWUpID0+IHtcbiAgICAgIGNhbGxiYWNrKGZyYW1lKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxsYmFjayBGdW5jdGlvbnNcbiAgICpcbiAgICogTm90ZSB0aGUgbWV0aG9kIHNpZ25hdHVyZTogKCkgPT4gcHJlc2VydmVzIGxleGljYWwgc2NvcGVcbiAgICogaWYgd2UgbmVlZCB0byB1c2UgdGhpcy54IGluc2lkZSB0aGUgZnVuY3Rpb25cbiAgICovXG4gIHByb3RlY3RlZCBkZWJ1ZyA9IChhcmdzOiBhbnkpOiB2b2lkID0+IHtcbiAgICBjb25zb2xlLmxvZyhuZXcgRGF0ZSgpLCBhcmdzKTtcbiAgfVxuXG4gIC8qKiBDYWxsYmFjayBydW4gb24gc3VjY2Vzc2Z1bGx5IGNvbm5lY3RpbmcgdG8gc2VydmVyICovXG4gIHByb3RlY3RlZCBvbl9jb25uZWN0ID0gKGZyYW1lOiBGcmFtZSkgPT4ge1xuXG4gICAgdGhpcy5kZWJ1ZygnQ29ubmVjdGVkJyk7XG5cbiAgICB0aGlzLl9zZXJ2ZXJIZWFkZXJzQmVoYXZpb3VyU3ViamVjdC5uZXh0KGZyYW1lLmhlYWRlcnMpO1xuXG4gICAgLy8gSW5kaWNhdGUgb3VyIGNvbm5lY3RlZCBzdGF0ZSB0byBvYnNlcnZlcnNcbiAgICB0aGlzLnN0YXRlLm5leHQoU3RvbXBTdGF0ZS5DT05ORUNURUQpO1xuICB9XG5cbiAgLyoqIEhhbmRsZSBlcnJvcnMgZnJvbSBzdG9tcC5qcyAqL1xuICBwcm90ZWN0ZWQgb25fZXJyb3IgPSAoZXJyb3I6IHN0cmluZyB8IFN0b21wLk1lc3NhZ2UpID0+IHtcblxuICAgIC8vIFRyaWdnZXIgdGhlIGVycm9yIHN1YmplY3RcbiAgICB0aGlzLmVycm9yU3ViamVjdC5uZXh0KGVycm9yKTtcblxuICAgIGlmICh0eXBlb2YgZXJyb3IgPT09ICdvYmplY3QnKSB7XG4gICAgICBlcnJvciA9ICg8U3RvbXAuTWVzc2FnZT5lcnJvcikuYm9keTtcbiAgICB9XG5cbiAgICB0aGlzLmRlYnVnKGBFcnJvcjogJHtlcnJvcn1gKTtcblxuICAgIC8vIENoZWNrIGZvciBkcm9wcGVkIGNvbm5lY3Rpb24gYW5kIHRyeSByZWNvbm5lY3RpbmdcbiAgICBpZiAoIXRoaXMuY2xpZW50LmNvbm5lY3RlZCkge1xuICAgICAgLy8gUmVzZXQgc3RhdGUgaW5kaWNhdG9yXG4gICAgICB0aGlzLnN0YXRlLm5leHQoU3RvbXBTdGF0ZS5DTE9TRUQpO1xuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0IHsgU3RvbXBIZWFkZXJzIH0gZnJvbSAnLi9zdG9tcC1oZWFkZXJzJztcbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbi8qKlxuICogUmVwcmVzZW50cyBhIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGZvciB0aGVcbiAqIFNUT01QU2VydmljZSB0byBjb25uZWN0IHRvLlxuICovXG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBTdG9tcENvbmZpZyB7XG4gIC8qKlxuICAgKiBTZXJ2ZXIgVVJMIHRvIGNvbm5lY3QgdG8uIFBsZWFzZSByZWZlciB0byB5b3VyIFNUT01QIGJyb2tlciBkb2N1bWVudGF0aW9uIGZvciBkZXRhaWxzLlxuICAgKlxuICAgKiBFeGFtcGxlOiB3czovLzEyNy4wLjAuMToxNTY3NC93cyAoZm9yIGEgUmFiYml0TVEgZGVmYXVsdCBzZXR1cCBydW5uaW5nIG9uIGxvY2FsaG9zdClcbiAgICpcbiAgICogQWx0ZXJuYXRpdmVseSB0aGlzIHBhcmFtZXRlciBjYW4gYmUgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYW4gb2JqZWN0IHNpbWlsYXIgdG8gV2ViU29ja2V0XG4gICAqICh0eXBpY2FsbHkgU29ja0pTIGluc3RhbmNlKS5cbiAgICpcbiAgICogRXhhbXBsZTpcbiAgICpcbiAgICogKCkgPT4ge1xuICAgKiAgIHJldHVybiBuZXcgU29ja0pTKCdodHRwOi8vMTI3LjAuMC4xOjE1Njc0L3N0b21wJyk7XG4gICAqIH1cbiAgICovXG4gIHVybDogc3RyaW5nIHwgKCgpID0+IGFueSk7XG5cbiAgLyoqXG4gICAqIEhlYWRlcnNcbiAgICogVHlwaWNhbCBrZXlzOiBsb2dpbjogc3RyaW5nLCBwYXNzY29kZTogc3RyaW5nLlxuICAgKiBob3N0OnN0cmluZyB3aWxsIG5lZWVkIHRvIGJlIHBhc3NlZCBmb3IgdmlydHVhbCBob3N0cyBpbiBSYWJiaXRNUVxuICAgKi9cbiAgaGVhZGVyczogU3RvbXBIZWFkZXJzO1xuXG4gIC8qKiBIb3cgb2Z0ZW4gdG8gaW5jb21pbmcgaGVhcnRiZWF0P1xuICAgKiBJbnRlcnZhbCBpbiBtaWxsaXNlY29uZHMsIHNldCB0byAwIHRvIGRpc2FibGVcbiAgICpcbiAgICogVHlwaWNhbCB2YWx1ZSAwIC0gZGlzYWJsZWRcbiAgICovXG4gIGhlYXJ0YmVhdF9pbjogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBIb3cgb2Z0ZW4gdG8gb3V0Z29pbmcgaGVhcnRiZWF0P1xuICAgKiBJbnRlcnZhbCBpbiBtaWxsaXNlY29uZHMsIHNldCB0byAwIHRvIGRpc2FibGVcbiAgICpcbiAgICogVHlwaWNhbCB2YWx1ZSAyMDAwMCAtIGV2ZXJ5IDIwIHNlY29uZHNcbiAgICovXG4gIGhlYXJ0YmVhdF9vdXQ6IG51bWJlcjtcblxuICAvKipcbiAgICogV2FpdCBpbiBtaWxsaXNlY29uZHMgYmVmb3JlIGF0dGVtcHRpbmcgYXV0byByZWNvbm5lY3RcbiAgICogU2V0IHRvIDAgdG8gZGlzYWJsZVxuICAgKlxuICAgKiBUeXBpY2FsIHZhbHVlIDUwMDAgKDUgc2Vjb25kcylcbiAgICovXG4gIHJlY29ubmVjdF9kZWxheTogbnVtYmVyO1xuXG4gIC8qKiBFbmFibGUgY2xpZW50IGRlYnVnZ2luZz8gKi9cbiAgZGVidWc6IGJvb2xlYW47XG59XG4iLCJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCB7IFN0b21wQ29uZmlnIH0gZnJvbSAnLi9zdG9tcC5jb25maWcnO1xuXG5pbXBvcnQgeyBTdG9tcFJTZXJ2aWNlIH0gZnJvbSAnLi9zdG9tcC1yLnNlcnZpY2UnO1xuXG4vKipcbiAqIEFuZ3VsYXIyIFNUT01QIFNlcnZpY2UgdXNpbmcgQHN0b21wL3N0b21wLmpzXG4gKlxuICogQGRlc2NyaXB0aW9uIFRoaXMgc2VydmljZSBoYW5kbGVzIHN1YnNjcmliaW5nIHRvIGFcbiAqIG1lc3NhZ2UgcXVldWUgdXNpbmcgdGhlIHN0b21wLmpzIGxpYnJhcnksIGFuZCByZXR1cm5zXG4gKiB2YWx1ZXMgdmlhIHRoZSBFUzYgT2JzZXJ2YWJsZSBzcGVjaWZpY2F0aW9uIGZvclxuICogYXN5bmNocm9ub3VzIHZhbHVlIHN0cmVhbWluZyBieSB3aXJpbmcgdGhlIFNUT01QXG4gKiBtZXNzYWdlcyBpbnRvIGFuIG9ic2VydmFibGUuXG4gKlxuICogSWYgeW91IHdhbnQgdG8gbWFudWFsbHkgY29uZmlndXJlIGFuZCBpbml0aWFsaXplIHRoZSBzZXJ2aWNlXG4gKiBwbGVhc2UgdXNlIFN0b21wUlNlcnZpY2VcbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFN0b21wU2VydmljZSBleHRlbmRzIFN0b21wUlNlcnZpY2Uge1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RvclxuICAgKlxuICAgKiBTZWUgUkVBRE1FIGFuZCBzYW1wbGVzIGZvciBjb25maWd1cmF0aW9uIGV4YW1wbGVzXG4gICAqL1xuICBwdWJsaWMgY29uc3RydWN0b3IoY29uZmlnOiBTdG9tcENvbmZpZykge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLmluaXRBbmRDb25uZWN0KCk7XG4gIH1cbn1cbiIsImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gXCJAc3RvbXAvc3RvbXBqc1wiO1xuaW1wb3J0IHtJbmplY3RhYmxlfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuaW1wb3J0IHtTdG9tcFJTZXJ2aWNlfSBmcm9tIFwiLi9zdG9tcC1yLnNlcnZpY2VcIjtcblxuLyoqXG4gKiBTZWUgdGhlIGd1aWRlIGZvciBleGFtcGxlXG4gKi9cbmV4cG9ydCB0eXBlIHNldHVwUmVwbHlRdWV1ZUZuVHlwZSA9IChyZXBseVF1ZXVlTmFtZTogc3RyaW5nLCBzdG9tcFNlcnZpY2U6IFN0b21wUlNlcnZpY2UpID0+IE9ic2VydmFibGU8TWVzc2FnZT47XG5cbi8qKlxuICogUlBDIENvbmZpZy4gU2VlIHRoZSBndWlkZSBmb3IgZXhhbXBsZS5cbiAqL1xuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFN0b21wUlBDQ29uZmlnIHtcbiAgLyoqXG4gICAqIE5hbWUgb2YgdGhlIHJlcGx5IHF1ZXVlXG4gICAqL1xuICByZXBseVF1ZXVlTmFtZT86IHN0cmluZztcbiAgLyoqXG4gICAqIFNldHVwIHRoZSByZXBseSBxdWV1ZVxuICAgKi9cbiAgc2V0dXBSZXBseVF1ZXVlPzogc2V0dXBSZXBseVF1ZXVlRm5UeXBlO1xufVxuIiwiaW1wb3J0IHtJbmplY3RhYmxlfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7TWVzc2FnZSwgU3RvbXBIZWFkZXJzfSBmcm9tICdAc3RvbXAvc3RvbXBqcyc7XG5pbXBvcnQge1VVSUR9IGZyb20gJ2FuZ3VsYXIyLXV1aWQnO1xuaW1wb3J0IHtPYnNlcnZhYmxlLCBPYnNlcnZlciwgU3Vic2NyaXB0aW9ufSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHtmaWx0ZXIsIGZpcnN0fSBmcm9tIFwicnhqcy9vcGVyYXRvcnNcIjtcbmltcG9ydCB7U3RvbXBSU2VydmljZX0gZnJvbSBcIi4vc3RvbXAtci5zZXJ2aWNlXCI7XG5pbXBvcnQge3NldHVwUmVwbHlRdWV1ZUZuVHlwZSwgU3RvbXBSUENDb25maWd9IGZyb20gXCIuL3N0b21wLXJwYy5jb25maWdcIjtcblxuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBSUEMgc2VydmljZSB1c2luZyBtZXNzYWdpbmcuXG4gKlxuICogUGxlYXNlIHNlZSB0aGUgW2d1aWRlXSguLi9hZGRpdGlvbmFsLWRvY3VtZW50YXRpb24vcnBjLS0tcmVtb3RlLXByb2NlZHVyZS1jYWxsLmh0bWwpIGZvciBkZXRhaWxzLlxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgU3RvbXBSUENTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBfcmVwbHlRdWV1ZU5hbWUgPSAnL3RlbXAtcXVldWUvcnBjLXJlcGxpZXMnO1xuXG4gIHByaXZhdGUgX3NldHVwUmVwbHlRdWV1ZTogc2V0dXBSZXBseVF1ZXVlRm5UeXBlID0gKCkgPT4ge1xuICAgIHJldHVybiB0aGlzLnN0b21wU2VydmljZS5kZWZhdWx0TWVzc2FnZXNPYnNlcnZhYmxlO1xuICB9O1xuXG4gIHByaXZhdGUgX3JlcGxpZXNPYnNlcnZhYmxlOiBPYnNlcnZhYmxlPE1lc3NhZ2U+O1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4gaW5zdGFuY2UsIHNlZSB0aGUgW2d1aWRlXSguLi9hZGRpdGlvbmFsLWRvY3VtZW50YXRpb24vcnBjLS0tcmVtb3RlLXByb2NlZHVyZS1jYWxsLmh0bWwpIGZvciBkZXRhaWxzLlxuICAgKi9cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBzdG9tcFNlcnZpY2U6IFN0b21wUlNlcnZpY2UsIHByaXZhdGUgc3RvbXBSUENDb25maWc/OiBTdG9tcFJQQ0NvbmZpZykge1xuICAgIGlmIChzdG9tcFJQQ0NvbmZpZykge1xuICAgICAgaWYgKHN0b21wUlBDQ29uZmlnLnJlcGx5UXVldWVOYW1lKSB7XG4gICAgICAgIHRoaXMuX3JlcGx5UXVldWVOYW1lID0gc3RvbXBSUENDb25maWcucmVwbHlRdWV1ZU5hbWU7XG4gICAgICB9XG4gICAgICBpZiAoc3RvbXBSUENDb25maWcuc2V0dXBSZXBseVF1ZXVlKSB7XG4gICAgICAgIHRoaXMuX3NldHVwUmVwbHlRdWV1ZSA9IHN0b21wUlBDQ29uZmlnLnNldHVwUmVwbHlRdWV1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTWFrZSBhbiBSUEMgcmVxdWVzdC4gU2VlIHRoZSBbZ3VpZGVdKC4uL2FkZGl0aW9uYWwtZG9jdW1lbnRhdGlvbi9ycGMtLS1yZW1vdGUtcHJvY2VkdXJlLWNhbGwuaHRtbCkgZm9yIGV4YW1wbGUuXG4gICAqL1xuICBwdWJsaWMgcnBjKHNlcnZpY2VFbmRQb2ludDogc3RyaW5nLCBwYXlsb2FkOiBzdHJpbmcsIGhlYWRlcnM/OiBTdG9tcEhlYWRlcnMpOiBPYnNlcnZhYmxlPE1lc3NhZ2U+IHtcbiAgICAvLyBXZSBrbm93IHRoZXJlIHdpbGwgYmUgb25seSBvbmUgbWVzc2FnZSBpbiByZXBseVxuICAgIHJldHVybiB0aGlzLnN0cmVhbShzZXJ2aWNlRW5kUG9pbnQsIHBheWxvYWQsIGhlYWRlcnMpLnBpcGUoZmlyc3QoKSk7XG4gIH1cblxuICAvKipcbiAgICogTWFrZSBhbiBSUEMgc3RyZWFtIHJlcXVlc3QuIFNlZSB0aGUgW2d1aWRlXSguLi9hZGRpdGlvbmFsLWRvY3VtZW50YXRpb24vcnBjLS0tcmVtb3RlLXByb2NlZHVyZS1jYWxsLmh0bWwpLlxuICAgKi9cbiAgcHVibGljIHN0cmVhbShzZXJ2aWNlRW5kUG9pbnQ6IHN0cmluZywgcGF5bG9hZDogc3RyaW5nLCBoZWFkZXJzOiBTdG9tcEhlYWRlcnMgPSB7fSkge1xuICAgIGlmICghdGhpcy5fcmVwbGllc09ic2VydmFibGUpIHtcbiAgICAgIHRoaXMuX3JlcGxpZXNPYnNlcnZhYmxlID0gdGhpcy5fc2V0dXBSZXBseVF1ZXVlKHRoaXMuX3JlcGx5UXVldWVOYW1lLCB0aGlzLnN0b21wU2VydmljZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKFxuICAgICAgKHJwY09ic2VydmVyOiBPYnNlcnZlcjxNZXNzYWdlPikgPT4ge1xuICAgICAgICBsZXQgZGVmYXVsdE1lc3NhZ2VzU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgICAgICAgY29uc3QgY29ycmVsYXRpb25JZCA9IFVVSUQuVVVJRCgpO1xuXG4gICAgICAgIGRlZmF1bHRNZXNzYWdlc1N1YnNjcmlwdGlvbiA9IHRoaXMuX3JlcGxpZXNPYnNlcnZhYmxlLnBpcGUoZmlsdGVyKChtZXNzYWdlOiBNZXNzYWdlKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIG1lc3NhZ2UuaGVhZGVyc1snY29ycmVsYXRpb24taWQnXSA9PT0gY29ycmVsYXRpb25JZDtcbiAgICAgICAgfSkpLnN1YnNjcmliZSgobWVzc2FnZTogTWVzc2FnZSkgPT4ge1xuICAgICAgICAgIHJwY09ic2VydmVyLm5leHQobWVzc2FnZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNlbmQgYW4gUlBDIHJlcXVlc3RcbiAgICAgICAgaGVhZGVyc1sncmVwbHktdG8nXSA9IHRoaXMuX3JlcGx5UXVldWVOYW1lO1xuICAgICAgICBoZWFkZXJzWydjb3JyZWxhdGlvbi1pZCddID0gY29ycmVsYXRpb25JZDtcblxuICAgICAgICB0aGlzLnN0b21wU2VydmljZS5wdWJsaXNoKHNlcnZpY2VFbmRQb2ludCwgcGF5bG9hZCwgaGVhZGVycyk7XG5cbiAgICAgICAgcmV0dXJuICgpID0+IHsgLy8gQ2xlYW51cFxuICAgICAgICAgIGRlZmF1bHRNZXNzYWdlc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9O1xuICAgICAgfVxuICAgICk7XG4gIH1cbn1cbiJdfQ==