DROP ALL OBJECTS;
-- Versione 1.0


CREATE ALIAS TO_DATE_ALT AS '
java.util.Date toDate(String s, String dateFormat) throws Exception { 
  return new java.text.SimpleDateFormat(dateFormat).parse(s); 
} 
';

-- 1. Sequence
CREATE SEQUENCE NXTNBR
    START WITH 100000
    NOCYCLE
    NOCACHE;

-- 2. Tabella di Log
CREATE TABLE A4GT_LOGGING (
    ID NUMBER(19) NOT NULL,
    ID_VALIDAZIONE INTEGER,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    UTENTE VARCHAR2(500 CHAR) NOT NULL,
    TIPO_EVENTO VARCHAR2(500 CHAR) NOT NULL,
    TABELLA VARCHAR2(4000) NOT NULL,
    ID_ENTITA NUMBER(19) NOT NULL,
    DT_EVENTO TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT A4GT_LOGGING_PK PRIMARY KEY (ID)
);

CREATE TABLE A4GT_LOGGING_VALIDAZIONE (
    ID BIGINT NOT NULL,
    ID_VALIDAZIONE INTEGER,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    UTENTE VARCHAR2(500 CHAR) NOT NULL,
    TIPO_EVENTO VARCHAR2(500 CHAR) NOT NULL,
    TABELLA VARCHAR2(4000) NOT NULL,
    ID_ENTITA BIGINT NOT NULL,
    DT_EVENTO TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT A4GT_LOGGING_VALIDAZIONE_PK PRIMARY KEY (ID)
);

CREATE TABLE A4GT_EVENTSTORED(
    ID NUMBER(20,0) NOT NULL,
    VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL,
    EVENTO VARCHAR2(500) NOT NULL,
    JSON_EVENT CLOB NOT NULL,
    USER_NAME VARCHAR2(100) NOT NULL,
    DATA_INSERIMENTO DATE NOT NULL,
    NUMERO_RETRY NUMBER(3,0) DEFAULT 0 NOT NULL,
    ERRORE CLOB,
    CONSTRAINT PK_EVENTSTORED PRIMARY KEY ("ID")
);


CREATE TABLE A4GT_FASCICOLO (
    ID BIGINT NOT NULL,
    ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    CUAA VARCHAR2(16) NOT NULL,
    DT_AGGIORNAMENTO_FONTI_ESTERNE DATE,
    CONSTRAINT PK_FASCICOLO PRIMARY KEY (ID, ID_VALIDAZIONE)
);
CREATE UNIQUE INDEX IDU_CUAA ON A4GT_FASCICOLO (ID_VALIDAZIONE, CUAA);

CREATE TABLE A4GT_STRUTTURA(
	ID NUMBER(20,0) NOT NULL, 
	ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL, 
	IDENTIFICATIVO VARCHAR2(100 BYTE), 
	INDIRIZZO VARCHAR2(200 BYTE), 
	CAP VARCHAR2(100 BYTE), 
	LOCALITA VARCHAR2(200 BYTE), 
	COMUNE VARCHAR2(200 BYTE), 
	LATITUDINE VARCHAR2(100 BYTE), 
	LONGITUDINE VARCHAR2(100 BYTE), 
	FOGLIO VARCHAR2(100 BYTE), 
	SEZIONE VARCHAR2(100 BYTE), 
	PARTICELLA VARCHAR2(100 BYTE), 
	SUBALTERNO VARCHAR2(100 BYTE),
	CUAA VARCHAR2(16) NOT NULL, 
	CONSTRAINT PK_STRUTTURA PRIMARY KEY (ID, ID_VALIDAZIONE)
);

  CREATE TABLE A4GT_ALLEVAMENTO(
	ID NUMBER(20,0) NOT NULL,
	ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL, 
	IDENTIFICATIVO VARCHAR2(20 BYTE), 
	IDENTIFICATIVO_FISCALE VARCHAR2(16 BYTE), 
	TIPOLOGIA_ALLEVAMENTO VARCHAR2(100 BYTE), 
	CF_PROPRIETARIO VARCHAR2(16 BYTE), 
	DENOMINAZIONE_PROPRIETARIO VARCHAR2(200 BYTE), 
	CF_DETENTORE VARCHAR2(16 BYTE), 
	DENOMINAZIONE_DETENTORE VARCHAR2(200 BYTE), 
	DT_INIZIO_DETENZIONE DATE, 
	DT_FINE_DETENZIONE DATE, 
	SOCCIDA VARCHAR2(20 BYTE), 
	SPECIE VARCHAR2(100 BYTE), 
	TIPOLOGIA_PRODUZIONE VARCHAR2(100 BYTE), 
	ORIENTAMENTO_PRODUTTIVO VARCHAR2(100 BYTE), 
	DT_APERTURA_ALLEVAMENTO DATE, 
	DT_CHIUSURA_ALLEVAMENTO DATE, 
	AUTORIZZAZIONE_SANITARIA_LATTE VARCHAR2(20 BYTE),
	ID_STRUTTURA NUMBER(20,0),
	STRUTTURA_ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
	FASCICOLO_ID BIGINT NOT NULL,
	FASCICOLO_ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
	CONSTRAINT PK_ALLEVAMENTO PRIMARY KEY (ID, ID_VALIDAZIONE),
	CONSTRAINT FK_ALLEVAMENTO_STRUTTURA FOREIGN KEY (ID_STRUTTURA, STRUTTURA_ID_VALIDAZIONE) REFERENCES A4GT_STRUTTURA (ID, ID_VALIDAZIONE),
	CONSTRAINT FK_DETENZIONE_FASCICOLO FOREIGN KEY (FASCICOLO_ID, FASCICOLO_ID_VALIDAZIONE) REFERENCES A4GT_FASCICOLO (ID, ID_VALIDAZIONE)
);

CREATE TABLE A4GT_CONTROLLO_COMPLETEZZA(
   ID BIGINT NOT NULL,
   VERSIONE NUMBER(10,0) DEFAULT 0,
   CUAA VARCHAR2(16 BYTE) NOT NULL,
   TIPO_CONTROLLO VARCHAR2(100 BYTE) NOT NULL,
   ESITO INTEGER,
   ID_CONTROLLO INTEGER,
   DATA_ESECUZIONE DATE,
   UTENTE VARCHAR2(100 BYTE) NOT NULL,
   CONSTRAINT PK_CONTROLLO_COMPLETEZZA PRIMARY KEY (ID)
);
