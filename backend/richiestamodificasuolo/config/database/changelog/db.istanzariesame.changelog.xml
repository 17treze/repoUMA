<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">

	<!-- Betty: La nomenclatura contiene il riferimento allo sprint (il primo 
		è il 14) -->
	<changeSet id="ISTANZARIESAME_S14.01"
		author="Elisabetta Freschi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE SEQUENCE NXTNBR
			START
			WITH 1
			MAXVALUE 999999999999999999999999999
			MINVALUE 1
			NOCYCLE
			NOCACHE
			ORDER;

			CREATE TABLE A4GT_LOGGING (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			UTENTE
			${string.type}(500 CHAR) NOT NULL,
			TIPO_EVENTO ${string.type}(500
			CHAR) NOT NULL,
			TABELLA ${string.type}(4000) NOT NULL,
			ID_ENTITA
			NUMBER(19) NOT NULL,
			DT_EVENTO TIMESTAMP DEFAULT SYSTIMESTAMP NOT
			NULL,
			CONSTRAINT A4GT_LOGGING_PK PRIMARY KEY (ID)
			) TABLESPACE
			${tablespace.data};
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT,
			INSERT, UPDATE, DELETE ON DATABASECHANGELOG TO ${user.writer};
			GRANT
			SELECT, INSERT, UPDATE, DELETE ON DATABASECHANGELOGLOCK TO
			${user.writer};
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT ON
			NXTNBR TO ${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON
			A4GT_LOGGING TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet definizione tabelle decodifica -->
	<changeSet id="ISTANZARIESAME_S14.02" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE a4sd_stato_colt
			(
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			stato_colt NUMBER(3),
			descrizione ${string.type}(500),
			desc_breve ${string.type}(50),
			data_inizio DATE,
			data_fine DATE,
			data_aggiornamento DATE,
			note ${string.type}(500)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE
			a4sd_stato_colt ADD CONSTRAINT dec_stato_colt_pk PRIMARY KEY ( id );

			ALTER TABLE a4sd_stato_colt ADD CONSTRAINT dec_stato_colt__un UNIQUE
			( stato_colt );

			CREATE TABLE a4sd_uso (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			cod_uso ${string.type}(3),
			descrizione ${string.type}(500),
			desc_breve ${string.type}(50),
			data_inizio DATE,
			data_fine DATE,
			data_aggiornamento DATE,
			is_uso NUMBER(1)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4sd_uso ADD
			CONSTRAINT a4s_dec_uso_pk PRIMARY KEY ( id );

			ALTER TABLE a4sd_uso ADD
			CONSTRAINT a4s_dec_uso__un UNIQUE ( cod_uso );

			CREATE TABLE a4sd_varieta (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			cod_var ${string.type}(3),
			descrizione ${string.type}(500),
			desc_breve ${string.type}(50),
			data_inizio DATE,
			data_fine DATE,
			data_aggiornamento DATE,
			is_varieta NUMBER(1)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4sd_varieta
			ADD CONSTRAINT dec_varieta_pk PRIMARY KEY ( id );

			ALTER TABLE
			a4sd_varieta ADD CONSTRAINT dec_varieta__un UNIQUE ( cod_var );

			CREATE TABLE a4sr_uso_varieta (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			cod_uso ${string.type}(3) NOT NULL,
			cod_var ${string.type}(3) NOT NULL
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4sr_uso_varieta ADD CONSTRAINT a4s_rel_uso_varieta_pk PRIMARY
			KEY ( id );

			ALTER TABLE a4sr_uso_varieta ADD CONSTRAINT a4s_dec_uso_fk FOREIGN KEY (
			cod_uso ) REFERENCES a4sd_uso ( cod_uso ) NOT DEFERRABLE;

			ALTER TABLE a4sr_uso_varieta ADD CONSTRAINT a4s_rel_uso_v_dec_v_fk FOREIGN
			KEY ( cod_var ) REFERENCES a4sd_varieta ( cod_var ) NOT DEFERRABLE;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON a4sd_stato_colt TO ${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON a4sd_uso TO ${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON a4sd_varieta TO ${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON a4sr_uso_varieta TO
			${user.writer};
		</sql>
	</changeSet>

	<!--changeSet definizione tabelle entità -->
	<changeSet id="ISTANZARIESAME_S14.03" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE a4sr_supporto_tag_tipo_suolo (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			id_suolo_dichiarato NUMBER(10) NOT NULL,
			id_suolo_rilevato NUMBER(10) NOT NULL,
			upas_dichiarato NUMBER(1),
			upas_rilevato NUMBER(1)
			)
			TABLESPACE ${tablespace.data};

			ALTER TABLE a4sr_supporto_tag_tipo_suolo ADD CONSTRAINT
			a4sr_supp_tag_tipo_s_pk PRIMARY KEY ( id );

			ALTER TABLE
			a4sr_supporto_tag_tipo_suolo ADD CONSTRAINT a4s_s_tag_pr_un UNIQUE (
			id_suolo_dichiarato );

			ALTER TABLE a4sr_supporto_tag_tipo_suolo ADD
			CONSTRAINT a4s_s_tag_pr_rich_un UNIQUE ( id_suolo_dichiarato,
			id_suolo_rilevato );

			CREATE TABLE a4st_lavorazione_suolo (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			utente ${string.type}(50),
			stato ${string.type}(50),
			data_inizio_lavorazione DATE,
			data_fine_lavorazione DATE,
			note CLOB,
			titolo ${string.type}(50),
			sopralluogo ${string.type}(100)
			)
			TABLESPACE ${tablespace.data};

			ALTER TABLE
			a4st_lavorazione_suolo ADD CONSTRAINT a4s_lavorazione_suolo_pk
			PRIMARY KEY ( id );

			CREATE TABLE a4st_richiesta_modifica_suolo (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			utente ${string.type}(50),
			data_richiesta DATE,
			tipo ${string.type}(50),
			stato ${string.type}(50),
			esito ${string.type}(50),
			cuaa ${string.type}(16),
			azienda ${string.type}(100),
			campagna NUMBER(4) NOT NULL,
			note CLOB,
			id_istanza_riesame NUMBER,
			visibile_in_ortofoto NUMBER(1),
			tipo_intervento_colturale ${string.type}(50),
			intervento_inizio DATE,
			intervento_fine DATE
			)
			TABLESPACE ${tablespace.data};

			ALTER TABLE
			a4st_richiesta_modifica_suolo ADD CONSTRAINT a4s_rich_modsuolo_pk
			PRIMARY KEY ( id );

			CREATE TABLE a4st_suolo_dichiarato (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			id_richiesta NUMBER(10) NOT NULL,
			shape mdsys.sdo_geometry,
			id_isola NUMBER(10) NOT NULL,
			cod_isola ${string.type}(30) NOT NULL,
			cod_sezione ${string.type}(10),
			id_suol_gis NUMBER(10) NOT NULL,
			cod_uso_dichiarato ${string.type}(3) NOT NULL,
			cod_varieta_dichiarato ${string.type}(3) NOT NULL,
			tipo_suolo_dichiarato ${string.type}(50),
			tipo_suolo_rilevato ${string.type}(50),
			id_lavorazione NUMBER(10),
			note_caricamento ${string.type}(500)
			)
			TABLESPACE ${tablespace.data}
			VARRAY
			SHAPE.SDO_ELEM_INFO STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob})
			VARRAY SHAPE.SDO_ORDINATES STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob});

			ALTER TABLE a4st_suolo_dichiarato ADD
			CONSTRAINT a4s_suolo_dichiarato_pk PRIMARY KEY ( id );

			CREATE TABLE a4st_suolo_rilevato (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			id_richiesta NUMBER(10) NOT NULL,
			id_isola NUMBER(10),
			id_suol_gis_rilevato NUMBER(10),
			cod_uso_rilevato ${string.type}(3) NOT NULL,
			cod_var_rilevato ${string.type}(3) NOT NULL,
			shape mdsys.sdo_geometry,
			note_caricamento ${string.type}(500)
			)
			TABLESPACE ${tablespace.data}
			VARRAY
			SHAPE.SDO_ELEM_INFO STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob})
			VARRAY SHAPE.SDO_ORDINATES STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob});

			ALTER TABLE a4st_suolo_rilevato ADD
			CONSTRAINT a4s_suolo_ril_pk PRIMARY KEY ( id );

			CREATE TABLE a4st_workspace_lav_suolo (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			id_lavorazione NUMBER(10) NOT NULL,
			shape mdsys.sdo_geometry,
			cod_uso ${string.type}(3) NOT NULL,
			cod_varieta ${string.type}(3) NOT NULL,
			stato_colt NUMBER(3) NOT NULL,
			note CLOB
			)
			TABLESPACE ${tablespace.data}
			VARRAY SHAPE.SDO_ELEM_INFO STORE
			AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob})
			VARRAY SHAPE.SDO_ORDINATES STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob});

			ALTER TABLE a4st_workspace_lav_suolo
			ADD CONSTRAINT a4s_work_lav_suolo_pk PRIMARY KEY ( id );

			ALTER TABLE
			a4sr_supporto_tag_tipo_suolo
			ADD CONSTRAINT a4s_su_tag_tipo_s_dic_fk FOREIGN KEY (
			id_suolo_dichiarato )
			REFERENCES a4st_suolo_dichiarato ( id )
			NOT DEFERRABLE;
			ALTER TABLE a4sr_supporto_tag_tipo_suolo
			ADD CONSTRAINT a4s_su_tag_tipo_s_rilevato_fk FOREIGN KEY (
			id_suolo_rilevato )
			REFERENCES a4st_suolo_rilevato ( id )
			NOT DEFERRABLE;
			ALTER TABLE a4st_suolo_dichiarato
			ADD CONSTRAINT a4s_suolo_dic_dec_uso_fk FOREIGN KEY ( cod_uso_dichiarato
			)
			REFERENCES a4sd_uso ( cod_uso )
			NOT DEFERRABLE;
			ALTER TABLE a4st_suolo_dichiarato
			ADD CONSTRAINT a4s_suolo_dic_rich_m_fk FOREIGN KEY ( id_richiesta )
			REFERENCES a4st_richiesta_modifica_suolo ( id )
			NOT DEFERRABLE;
			ALTER TABLE a4st_suolo_dichiarato
			ADD CONSTRAINT a4s_suolo_dic_lav_suolo_fk FOREIGN KEY ( id_lavorazione )
			REFERENCES a4st_lavorazione_suolo ( id )
			NOT DEFERRABLE;
			ALTER TABLE a4st_suolo_dichiarato
			ADD CONSTRAINT a4s_suolo_dic_dec_var_fk FOREIGN KEY (
			cod_varieta_dichiarato )
			REFERENCES a4sd_varieta ( cod_var )
			NOT DEFERRABLE;
			ALTER TABLE a4st_suolo_rilevato
			ADD CONSTRAINT a4s_suolo_ril_rich_m_fk FOREIGN KEY ( id_richiesta )
			REFERENCES a4st_richiesta_modifica_suolo ( id )
			NOT DEFERRABLE;
			ALTER TABLE a4st_suolo_rilevato
			ADD CONSTRAINT a4s_suolo_ril_dec_uso_fk FOREIGN KEY ( cod_uso_rilevato )
			REFERENCES a4sd_uso ( cod_uso )
			NOT DEFERRABLE;
			ALTER TABLE a4st_suolo_rilevato
			ADD CONSTRAINT a4s_suolo_ril_dec_var_fk FOREIGN KEY ( cod_var_rilevato )
			REFERENCES a4sd_varieta ( cod_var )
			NOT DEFERRABLE;
			ALTER TABLE a4st_workspace_lav_suolo
			ADD CONSTRAINT a4s_ws_l_su_dec_s_colt_fk FOREIGN KEY ( stato_colt )
			REFERENCES a4sd_stato_colt ( stato_colt )
			NOT DEFERRABLE;
			ALTER TABLE a4st_workspace_lav_suolo
			ADD CONSTRAINT a4s_l_suolo_fk FOREIGN KEY ( id_lavorazione )
			REFERENCES a4st_lavorazione_suolo ( id )
			NOT DEFERRABLE;
			ALTER TABLE a4st_workspace_lav_suolo
			ADD CONSTRAINT a4s_wa_lav_su_dec_uso_fk FOREIGN KEY ( cod_uso )
			REFERENCES a4sd_uso ( cod_uso )
			NOT DEFERRABLE;
			ALTER TABLE a4st_workspace_lav_suolo
			ADD CONSTRAINT a4s_ws_lav_suolo_dec_v_fk FOREIGN KEY ( cod_varieta )
			REFERENCES a4sd_varieta ( cod_var )
			NOT DEFERRABLE;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON a4sr_supporto_tag_tipo_suolo TO
			${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON
			a4st_lavorazione_suolo TO ${user.writer};
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON a4st_richiesta_modifica_suolo TO
			${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON
			a4st_suolo_dichiarato TO ${user.writer};
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON a4st_suolo_rilevato TO ${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON a4st_workspace_lav_suolo TO
			${user.writer};
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S14.04" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into
			user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4ST_SUOLO_RILEVATO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4ST_WORKSPACE_LAV_SUOLO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4ST_SUOLO_DICHIARATO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');

			CREATE INDEX A4ST_SUOLO_RILEVATO_SPIDX ON
			A4ST_SUOLO_RILEVATO (SHAPE) INDEXTYPE IS "MDSYS"."SPATIAL_INDEX"
			PARAMETERS ('tablespace=${tablespace.index}');
			CREATE INDEX
			A4ST_WS_LAV_SUOLO_SPIDX ON A4ST_WORKSPACE_LAV_SUOLO (SHAPE) INDEXTYPE
			IS "MDSYS"."SPATIAL_INDEX" PARAMETERS
			('tablespace=${tablespace.index}');
			CREATE INDEX A4ST_SUOLO_DICH_SPIDX
			ON A4ST_SUOLO_DICHIARATO (SHAPE) INDEXTYPE IS "MDSYS"."SPATIAL_INDEX"
			PARAMETERS ('tablespace=${tablespace.index}');
		</sql>

	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.A4SD_USO.changelog.xml" />
	<include
		file="config/database/changelog/db.istanzariesame.A4SD_STATO_COLT.changelog.xml" />
	<include
		file="config/database/changelog/db.istanzariesame.A4SD_VARIETA.changelog.xml" />

	<changeSet id="ISTANZARIESAME_S15.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_RICHIESTA_MODIFICA_SUOLO DROP COLUMN NOTE;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S15.02" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4SR_SUPPORTO_TAG_TIPO_SUOLO drop column UPAS_RILEVATO;
		</sql>
	</changeSet>
	<changeSet id="ISTANZARIESAME_S15.03" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_SUOLO_DICHIARATO add AREA number (20,6);
			ALTER TABLE
			A4ST_SUOLO_RILEVATO add AREA number (20,6);
		</sql>
	</changeSet>

	<!--changeSet definizione tabella a4st_messaggio_richiesta -->
	<changeSet id="ISTANZARIESAME_S15.04" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			a4st_messaggio_richiesta (
			id ${id.number.type} NOT NULL,
			versione ${version.number.type} NOT NULL,
			id_richiesta NUMBER(10) NOT NULL,
			utente ${string.type}(50) NOT NULL,
			profilo_utente ${string.type}(50) NOT NULL,
			data_inserimento DATE NOT NULL,
			testo ${string.type}(4000) NOT NULL
			)
			TABLESPACE ${tablespace.lob};

			ALTER TABLE a4st_messaggio_richiesta ADD CONSTRAINT a4st_mess_rich_pk
			PRIMARY KEY ( id );
			ALTER TABLE a4st_messaggio_richiesta ADD
			CONSTRAINT a4st_mess_rich_m_suolo_fk FOREIGN KEY ( id_richiesta )
			REFERENCES a4st_richiesta_modifica_suolo ( id );
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON a4st_messaggio_richiesta TO
			${user.writer};
		</sql>
	</changeSet>

	<!--changeSet definizione tabella A4ST_DOCUMENTAZIONE_RICHIESTA -->
	<changeSet id="ISTANZARIESAME_S16.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			a4st_documentazione_richiesta (
			id ${id.number.type} NOT NULL,
			versione ${version.number.type} NOT NULL,
			id_richiesta NUMBER(10) NOT NULL,
			nome_file ${string.type}(500) NOT NULL,
			descrizione ${string.type}(500),
			dimensione NUMBER NOT NULL,
			utente ${string.type}(50) NOT NULL,
			profilo_utente ${string.type}(50) NOT NULL,
			data_inserimento DATE NOT NULL,
			doc_content BLOB NOT NULL
			)
			TABLESPACE ${tablespace.lob};


			ALTER TABLE a4st_documentazione_richiesta ADD CONSTRAINT
			a4s_doc_richiesta_pk PRIMARY KEY ( id ) using index tablespace
			${tablespace.index};

			ALTER TABLE a4st_documentazione_richiesta ADD
			CONSTRAINT a4s_doc_rich_m_fk FOREIGN KEY ( id_richiesta ) REFERENCES
			a4st_richiesta_modifica_suolo ( id );

			ALTER TABLE
			a4st_documentazione_richiesta MOVE TABLESPACE ${tablespace.data} LOB
			(doc_content) STORE AS (TABLESPACE ${tablespace.lob});
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_DOCUMENTAZIONE_RICHIESTA TO
			${user.writer};
		</sql>
	</changeSet>

	<!--changeSet Elimino colonna note in tabella A4ST_LAVORAZIONE_SUOLO -->
	<changeSet id="ISTANZARIESAME_S16.02" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_LAVORAZIONE_SUOLO DROP COLUMN NOTE;
		</sql>
	</changeSet>

	<!--changeSet Aggiungo colonna note di tipo VARCHAR2(4000) in tabella A4ST_LAVORAZIONE_SUOLO -->
	<changeSet id="ISTANZARIESAME_S16.03" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_LAVORAZIONE_SUOLO ADD NOTE VARCHAR2(4000);
		</sql>
	</changeSet>

	<!--changeSet definizione VIEW A4SV_SUOLO_DICH_LAVORAZIONE -->
	<changeSet id="ISTANZARIESAME_S17.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_DICH_LAVORAZIONE (
			ID_SUOLO_DICH,
			ID_RICHIESTA,
			STATO_RICHIESTA,
			CUAA,
			AZIENDA,
			CAMPAGNA,
			TIPO_SUOLO_DICHIARATO,
			TIPO_SUOLO_RILEVATO,
			COD_USO_DICHIARATO,
			DESC_COD_USO_DICH,
			COD_VARIETA_DICHIARATO,
			DESC_COD_VARIETA_DICH,
			COD_SEZIONE,
			COD_USO_RILEVATO,
			DESC_COD_USO_RILE,
			COD_VAR_RILEVATO,
			DESC_COD_VARIETA_RILE,
			ID_LAVORAZIONE,
			STATO_LAVORAZIONE
			) AS
			SELECT
			d.id id_suolo_dich,
			r.id id_richiesta,
			r.stato,
			r.cuaa,
			r.azienda,
			r.campagna,
			d.tipo_suolo_dichiarato,
			d.tipo_suolo_rilevato,
			d.cod_uso_dichiarato,
			u.descrizione desc_cod_uso_dich,
			d.cod_varieta_dichiarato,
			v.descrizione desc_cod_varieta_dich,
			d.cod_sezione,
			sr.cod_uso_rilevato,
			ur.descrizione desc_cod_uso_rile,
			sr.cod_var_rilevato,
			vr.descrizione desc_cod_varieta_rile,
			d.id_lavorazione,
			lavorazione.stato
			FROM
			a4st_richiesta_modifica_suolo r
			INNER JOIN a4st_suolo_dichiarato d ON r.id = d.id_richiesta
			LEFT JOIN a4sd_varieta v ON v.cod_var = d.cod_varieta_dichiarato
			AND sysdate BETWEEN v.data_inizio AND v.data_fine
			LEFT JOIN a4sd_uso u ON u.cod_uso = d.cod_uso_dichiarato
			AND sysdate BETWEEN u.data_inizio AND u.data_fine
			LEFT JOIN a4sr_supporto_tag_tipo_suolo st ON st.id_suolo_dichiarato =
			d.id
			LEFT JOIN a4st_suolo_rilevato sr ON sr.id = st.id_suolo_rilevato
			LEFT JOIN a4sd_varieta vr ON vr.cod_var = sr.cod_var_rilevato
			AND sysdate BETWEEN vr.data_inizio AND vr.data_fine
			LEFT JOIN a4sd_uso ur ON ur.cod_uso = sr.cod_uso_rilevato
			AND sysdate BETWEEN ur.data_inizio AND ur.data_fine
			LEFT JOIN a4st_lavorazione_suolo lavorazione ON lavorazione.id =
			d.id_lavorazione;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT ON
			A4SV_SUOLO_DICH_LAVORAZIONE TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet Creazione tabella a4st_griglia_suolo e a4st_uso_suolo -->
	<changeSet id="ISTANZARIESAME_S18.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			CREATE TABLE
			a4st_griglia_suolo (
			id ${id.number.type} NOT NULL,
			versione ${version.number.type} NOT NULL,
			area NUMBER(11),
			interseca_suolo NUMBER(1),
			confine NUMBER(1),
			shape mdsys.sdo_geometry
			)
			TABLESPACE ${tablespace.data};

			ALTER TABLE
			a4st_griglia_suolo ADD CONSTRAINT a4s_griglia_suolo_pk PRIMARY KEY (
			id );

			CREATE TABLE a4st_uso_suolo (
			id ${id.number.type} NOT NULL,
			versione ${version.number.type} NOT NULL,
			id_grid NUMBER(3) NOT NULL,
			istatp NUMBER(2) NOT NULL,
			shape mdsys.sdo_geometry,
			area_colt NUMBER(20,6),
			cod_uso ${string.type}(3) NOT NULL,
			cod_var ${string.type}(3) NOT NULL,
			stato_colt NUMBER(2) NOT NULL,
			sorgente ${string.type}(50),
			id_lavorazione_inizio NUMBER(10) NOT NULL,
			id_lavorazione_fine NUMBER(10),
			data_inizio_validita DATE NOT NULL,
			data_fine_validita DATE,
			note CLOB,
			campagna NUMBER(4),
			id_lavorazione_in_corso NUMBER(10) NOT NULL
			)
			TABLESPACE ${tablespace.data};

			ALTER TABLE
			a4st_uso_suolo ADD CONSTRAINT a4s_uso_suolo_pk PRIMARY KEY ( id );

			ALTER TABLE a4st_uso_suolo
			ADD CONSTRAINT a4s_uso_suolo_griglia_suolo_fk FOREIGN KEY ( id_grid )
			REFERENCES a4st_griglia_suolo ( id );

			ALTER TABLE a4st_uso_suolo
			ADD CONSTRAINT a4s_uso_suolo_l_suolo_fkv1 FOREIGN KEY (
			id_lavorazione_fine )
			REFERENCES a4st_lavorazione_suolo ( id );

			ALTER TABLE a4st_uso_suolo
			ADD CONSTRAINT a4s_uso_suolo_l_suolo_fkv2 FOREIGN KEY (
			id_lavorazione_in_corso )
			REFERENCES a4st_lavorazione_suolo ( id );

			ALTER TABLE a4st_uso_suolo
			ADD CONSTRAINT a4s_uso_suolo_lav_suolo_fk FOREIGN KEY (
			id_lavorazione_inizio )
			REFERENCES a4st_lavorazione_suolo ( id );

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">

			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4ST_GRIGLIA_SUOLO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');

			CREATE INDEX a4st_griglia_suolo_spidx ON
			a4st_griglia_suolo (
			shape
			)
			INDEXTYPE IS "MDSYS"."SPATIAL_INDEX" PARAMETERS
			('tablespace=${tablespace.index}');


			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4ST_USO_SUOLO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');

			CREATE INDEX a4st_uso_suolo_spidx ON
			a4st_uso_suolo (
			shape
			)
			INDEXTYPE IS "MDSYS"."SPATIAL_INDEX" PARAMETERS
			('tablespace=${tablespace.index}');

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT,INSERT,UPDATE,DELETE ON A4ST_USO_SUOLO TO ${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON A4ST_GRIGLIA_SUOLO TO
			${user.writer};
		</sql>
	</changeSet>

	<!--changeSet Elimino colonna note in tabella A4ST_USO_SUOLO -->
	<changeSet id="ISTANZARIESAME_S18.02" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_USO_SUOLO
			DROP COLUMN NOTE;
		</sql>
	</changeSet>

	<!--changeSet Aggiungo colonna note di tipo VARCHAR2(4000) in tabella A4ST_USO_SUOLO -->
	<changeSet id="ISTANZARIESAME_S18.03" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_USO_SUOLO
			ADD NOTE VARCHAR2(4000);
		</sql>
	</changeSet>


	<!--changeSet Modifico colonna ID_LAVORAZIONE_IN_CORSO nullable in tabella 
		A4ST_USO_SUOLO -->
	<changeSet id="ISTANZARIESAME_S18.04" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE a4st_uso_suolo
			MODIFY ( ID_LAVORAZIONE_IN_CORSO NULL);
		</sql>
	</changeSet>

	<!--changeSet Elimino colonna note in tabella A4ST_WORKSPACE_LAV_SUOLO -->
	<changeSet id="ISTANZARIESAME_S18.05" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_WORKSPACE_LAV_SUOLO DROP COLUMN NOTE;
		</sql>
	</changeSet>

	<!--changeSet Aggiungo colonna note di tipo VARCHAR2(4000) in tabella A4ST_WORKSPACE_LAV_SUOLO -->
	<changeSet id="ISTANZARIESAME_S18.06" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_WORKSPACE_LAV_SUOLO ADD NOTE VARCHAR2(4000);
		</sql>
	</changeSet>

	<!--changeSet Creazione nuova tabella -->
	<changeSet id="ISTANZARIESAME_S18.07" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE a4sd_uso_suolo
			(
			id ${id.number.type} NOT NULL,
			versione ${version.number.type} NOT NULL,
			cod_uso_suolo VARCHAR2(3),
			descrizione VARCHAR2(500),
			data_inizio DATE,
			data_fine DATE,
			visualizza_bo NUMBER
			)
			TABLESPACE ${tablespace.data};

			ALTER TABLE a4sd_uso_suolo ADD CONSTRAINT a4sd_uso_suolo_pk PRIMARY KEY (
			id );

			ALTER TABLE a4sd_uso_suolo ADD CONSTRAINT a4sd_uso_suolo_cod_uso_un UNIQUE
			( cod_uso_suolo );

		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT,INSERT,UPDATE,DELETE ON a4sd_uso_suolo TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet Creazione tabella a4st_suolo -->
	<changeSet id="ISTANZARIESAME_S18.08" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">

			CREATE TABLE a4st_suolo (
			id ${id.number.type} NOT NULL,
			versione ${version.number.type} NOT NULL,
			id_grid NUMBER(3) NOT NULL,
			istatp NUMBER(2) NOT NULL,
			shape mdsys.sdo_geometry,
			area_colt NUMBER(20,6),
			cod_uso_suolo ${string.type}(3) NOT NULL,
			stato_colt NUMBER(2) NOT NULL,
			sorgente ${string.type}(50),
			id_lavorazione_inizio ${id.number.type} NOT NULL,
			id_lavorazione_fine ${id.number.type},
			data_inizio_validita DATE NOT NULL,
			data_fine_validita DATE,
			note ${string.type}(4000),
			campagna NUMBER(4),
			id_lavorazione_in_corso ${id.number.type}
			)
			TABLESPACE ${tablespace.data};

			ALTER TABLE
			a4st_suolo ADD CONSTRAINT a4s_suolo_pk PRIMARY KEY ( id );

			ALTER TABLE
			a4st_suolo
			ADD CONSTRAINT a4s_suolo_griglia_suolo_fk FOREIGN KEY ( id_grid )
			REFERENCES a4st_griglia_suolo ( id );

			ALTER TABLE a4st_suolo
			ADD CONSTRAINT a4s_suolo_l_suolo_fkv1 FOREIGN KEY ( id_lavorazione_fine
			)
			REFERENCES a4st_lavorazione_suolo ( id );

			ALTER TABLE a4st_suolo
			ADD CONSTRAINT a4s_suolo_l_suolo_fkv2 FOREIGN KEY (
			id_lavorazione_in_corso )
			REFERENCES a4st_lavorazione_suolo ( id );

			ALTER TABLE a4st_suolo
			ADD CONSTRAINT a4s_lav_suolo_fk FOREIGN KEY ( id_lavorazione_inizio )
			REFERENCES a4st_lavorazione_suolo ( id );

			ALTER TABLE a4st_suolo
			ADD CONSTRAINT a4st_suolo_dec_s_colt_fk FOREIGN KEY ( stato_colt )
			REFERENCES a4sd_stato_colt ( stato_colt );

			ALTER TABLE a4st_suolo
			ADD CONSTRAINT a4st_suolo_dec_cou_us_fk FOREIGN KEY ( cod_uso_suolo )
			REFERENCES a4sd_uso_suolo ( cod_uso_suolo );

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">

			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4ST_SUOLO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');

			CREATE INDEX a4st_suolo_spidx ON
			a4st_suolo (
			shape
			)
			INDEXTYPE IS "MDSYS"."SPATIAL_INDEX" PARAMETERS
			('tablespace=${tablespace.index}');

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT,INSERT,UPDATE,DELETE ON A4ST_SUOLO TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet cambio tabella a4st_suolo -->
	<changeSet id="ISTANZARIESAME_S18.09" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">

			alter table a4st_suolo modify istatp ${string.type}(3);

		</sql>
	</changeSet>


	<!--changeSet cambio tabella a4st_suolo -->
	<changeSet id="ISTANZARIESAME_S18.10" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">

			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO RENAME COLUMN COD_USO TO
			COD_USO_SUOLO;

			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO drop COLUMN
			COD_VARIETA;

			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO ADD CONSTRAINT
			A4ST_W_L_SUOLO_DEC_COD_US_FK FOREIGN KEY (COD_USO_SUOLO)
			REFERENCES
			A4SD_USO_SUOLO (COD_USO_SUOLO);

		</sql>
	</changeSet>

	<!--changeSet cambio tipi fk a numbe r20 -->
	<changeSet id="ISTANZARIESAME_S18.11" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE a4sr_supporto_tag_tipo_suolo MODIFY (id_suolo_dichiarato
			${id.number.type});
			ALTER TABLE a4sr_supporto_tag_tipo_suolo MODIFY (id_suolo_rilevato
			${id.number.type});
			ALTER TABLE a4st_documentazione_richiesta MODIFY (id_richiesta
			${id.number.type});
			ALTER TABLE a4st_messaggio_richiesta MODIFY (id_richiesta
			${id.number.type});
			ALTER TABLE a4st_suolo_rilevato MODIFY (id_richiesta ${id.number.type});
			ALTER TABLE a4st_workspace_lav_suolo MODIFY (id_lavorazione
			${id.number.type});
		</sql>
	</changeSet>

	<!--changeSet cambio tipi fk a number 20 -->
	<changeSet id="ISTANZARIESAME_S18.11" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE a4sr_supporto_tag_tipo_suolo MODIFY (id_suolo_dichiarato
			${id.number.type});
			ALTER TABLE a4sr_supporto_tag_tipo_suolo MODIFY (id_suolo_rilevato
			${id.number.type});
			ALTER TABLE a4st_documentazione_richiesta MODIFY (id_richiesta
			${id.number.type});
			ALTER TABLE a4st_messaggio_richiesta MODIFY (id_richiesta
			${id.number.type});
			ALTER TABLE a4st_suolo_rilevato MODIFY (id_richiesta ${id.number.type});
			ALTER TABLE a4st_workspace_lav_suolo MODIFY (id_lavorazione
			${id.number.type});
		</sql>
	</changeSet>

	<!--changeSet cambio default versione -->
	<changeSet id="ISTANZARIESAME_S18.12" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE a4st_suolo MODIFY versione DEFAULT 0;
			ALTER TABLE
			a4st_messaggio_richiesta MODIFY versione DEFAULT 0;
			ALTER TABLE
			a4st_documentazione_richiesta MODIFY versione DEFAULT 0;
			ALTER TABLE
			a4st_griglia_suolo MODIFY versione DEFAULT 0;
			ALTER TABLE
			a4sd_uso_suolo MODIFY versione DEFAULT 0;
		</sql>
	</changeSet>

	<!--changeSet popola uso suolo ISTANZARIESAME_S18.13 -->
	<include
		file="config/database/changelog/db.istanzariesame.A4SD_USO_SUOLO.changelog.xml" />

	<!--changeSet creazione tabella a4sd_codi_rile_pcg e dipendenze -->
	<changeSet id="ISTANZARIESAME_S19.1" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE a4sd_codi_rile_pcg (
			id ${id.number.type} NOT NULL,
			versione ${version.number.type} NOT NULL,
			codi_rile ${string.type}(3) NOT NULL,
			desc_rile ${string.type}(500),
			codi_prod_rile ${string.type}(3) NOT NULL,
			desc_prod_rile ${string.type}(500),
			data_inizio DATE,
			data_fine DATE,
			codi_rile_prevalente ${string.type}(3) NOT NULL,
			desc_rile_prevalente ${string.type}(500)
			)
			TABLESPACE ${tablespace.data};

			ALTER TABLE a4sd_codi_rile_pcg ADD CONSTRAINT a4sd_codi_rile_pcg_pk
			PRIMARY KEY ( id );

			ALTER TABLE a4sd_codi_rile_pcg ADD CONSTRAINT a4sd_codi_rile_pcg__un
			UNIQUE ( codi_rile,
			codi_prod_rile );

			ALTER TABLE a4st_suolo_dichiarato ADD (
			codi_rile_dichiarato ${string.type}(3)
			);
			ALTER TABLE a4st_suolo_dichiarato ADD (
			codi_prod_rile_dichiarato ${string.type}(3)
			);

			ALTER TABLE a4st_suolo_rilevato ADD (
			codi_rile_rilevato ${string.type}(3)
			);
			ALTER TABLE a4st_suolo_rilevato ADD (
			codi_prod_rile_rilevato ${string.type}(3)
			);

			ALTER TABLE a4st_suolo_dichiarato
			ADD CONSTRAINT a4st_s_dich_codi_rile_pcg_fk FOREIGN KEY (
			codi_rile_dichiarato,
			codi_prod_rile_dichiarato )
			REFERENCES a4sd_codi_rile_pcg ( codi_rile,
			codi_prod_rile );
			ALTER TABLE a4st_suolo_rilevato
			ADD CONSTRAINT a4st_s_ril_codi_rile_pcg_fk FOREIGN KEY (
			codi_rile_rilevato,
			codi_prod_rile_rilevato )
			REFERENCES a4sd_codi_rile_pcg ( codi_rile,
			codi_prod_rile );
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT,INSERT,UPDATE,DELETE ON a4sd_codi_rile_pcg TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet aggiunta a A4ST_WORKSPACE_LAV_SUOLO -->
	<!--changeSet cambio default versione -->
	<changeSet id="ISTANZARIESAME_S19.2" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO ADD (
			data_aggiornamento date
			);
		</sql>
	</changeSet>

	<!--changeSet deafult a A4ST_WORKSPACE_LAV_SUOLO.data_aggiornamento -->
	<changeSet id="ISTANZARIESAME_S19.3" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO MODIFY data_aggiornamento DEFAULT
			sysdate;
		</sql>
	</changeSet>

	<!--changeSet cancellazione tabelle vecchie -->
	<changeSet id="ISTANZARIESAME_S19.4" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			drop table A4ST_USO_SUOLO;
			delete from user_sdo_geom_metadata where
			table_name = 'A4ST_USO_SUOLO';
			commit;

			ALTER TABLE A4ST_SUOLO_RILEVATO DROP CONSTRAINT A4S_SUOLO_RIL_DEC_USO_FK;
			ALTER TABLE A4ST_SUOLO_RILEVATO DROP CONSTRAINT
			A4S_SUOLO_RIL_DEC_VAR_FK;

			ALTER TABLE A4ST_SUOLO_DICHIARATO DROP CONSTRAINT
			A4S_SUOLO_DIC_DEC_USO_FK;
			ALTER TABLE A4ST_SUOLO_DICHIARATO DROP
			CONSTRAINT A4S_SUOLO_DIC_DEC_VAR_FK;

			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO DROP CONSTRAINT
			A4S_WA_LAV_SU_DEC_USO_FK;

			alter table A4ST_SUOLO_DICHIARATO drop column COD_USO_DICHIARATO;
			alter
			table A4ST_SUOLO_DICHIARATO drop column COD_VARIETA_DICHIARATO;

			alter
			table A4ST_SUOLO_RILEVATO drop column COD_USO_RILEVATO;
			alter table
			A4ST_SUOLO_RILEVATO drop column COD_VAR_RILEVATO;

			drop table A4SR_USO_VARIETA;
			drop table A4SD_USO;
			drop table A4SD_VARIETA;
		</sql>
	</changeSet>

	<!--changeSet modifiche VIEW A4SV_SUOLO_DICH_LAVORAZIONE -->
	<changeSet id="ISTANZARIESAME_S19.5" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_SUOLO_DICH_LAVORAZIONE (ID_SUOLO_DICH,
			ID_RICHIESTA,
			STATO_RICHIESTA,
			CUAA,
			AZIENDA,
			CAMPAGNA,
			TIPO_SUOLO_DICHIARATO,
			TIPO_SUOLO_RILEVATO,
			CODI_RILE_DICHIARATO,
			DESC_RILE_DICHIARATO,
			CODI_PROD_RILE_DICHIARATO,
			DESC_PROD_RILE_DICHIARATO,
			CODI_RILE_PREVALENTE_DICH,
			DESC_RILE_PREVALENTE_DICH,
			COD_SEZIONE,
			CODI_RILE_RILEVATO,
			DESC_RILE_RILEVATO,
			CODI_PROD_RILE_RILEVATO,
			DESC_PROD_RILE_RILEVATO,
			CODI_RILE_PREVALENTE_RIL,
			DESC_RILE_PREVALENTE_RIL,
			ID_LAVORAZIONE,
			STATO_LAVORAZIONE) AS
			select
			D.ID ID_SUOLO_DICH,
			R.ID ID_RICHIESTA,
			R.STATO STATO_RICHIESTA,
			R.CUAA,
			R.AZIENDA,
			R.CAMPAGNA,
			D.TIPO_SUOLO_DICHIARATO,
			D.TIPO_SUOLO_RILEVATO,
			D.CODI_RILE_DICHIARATO ,
			V.DESC_RILE DESC_RILE_DICHIARATO,
			D.CODI_PROD_RILE_DICHIARATO,
			V.DESC_PROD_RILE DESC_PROD_RILE_DICHIARATO,
			V.CODI_RILE_PREVALENTE CODI_RILE_PREVALENTE_DICH,
			V.DESC_RILE_PREVALENTE DESC_RILE_PREVALENTE_DICH,
			D.COD_SEZIONE,
			SR.CODI_RILE_RILEVATO,
			VR.DESC_RILE DESC_RILE_RILEVATO,
			SR.CODI_PROD_RILE_RILEVATO,
			VR.DESC_PROD_RILE DESC_PROD_RILE_RILEVATO,
			VR.CODI_RILE_PREVALENTE CODI_RILE_PREVALENTE_RIL,
			VR.DESC_RILE_PREVALENTE DESC_RILE_PREVALENTE_RIL,
			D.ID_LAVORAZIONE,
			LAVORAZIONE.STATO STATO_LAVORAZIONE
			FROM
			A4ST_RICHIESTA_MODIFICA_SUOLO R
			INNER JOIN A4ST_SUOLO_DICHIARATO D ON R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE = D.CODI_RILE_DICHIARATO
			AND V.CODI_PROD_RILE = D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN A4SR_SUPPORTO_TAG_TIPO_SUOLO ST ON ST.ID_SUOLO_DICHIARATO =
			D.ID
			LEFT JOIN A4ST_SUOLO_RILEVATO SR ON SR.ID = ST.ID_SUOLO_RILEVATO
			LEFT JOIN A4SD_CODI_RILE_PCG VR ON VR.CODI_RILE = SR.CODI_RILE_RILEVATO
			AND VR.CODI_PROD_RILE = SR.CODI_PROD_RILE_RILEVATO
			LEFT JOIN A4ST_LAVORAZIONE_SUOLO LAVORAZIONE ON LAVORAZIONE.ID =
			D.ID_LAVORAZIONE;

		</sql>
	</changeSet>

	<!--changeSet modifiche decodifiche A4SD_USO_SUOLO -->
	<changeSet id="ISTANZARIESAME_S19.6" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4SD_USO_SUOLO set DESCRIZIONE = 'SEMINATIVI' where COD_USO_SUOLO =
			'365';
			UPDATE A4SD_USO_SUOLO set DESCRIZIONE = 'CORSI D''ACQUA' where
			COD_USO_SUOLO = '366';
			UPDATE A4SD_USO_SUOLO set VISUALIZZA_BO = '1'
			where COD_USO_SUOLO = '793';
			commit;
		</sql>
	</changeSet>

	<!--changeSet A4ST_LAVORAZIONE_SUOLO add column data_ultima_modifica -->
	<changeSet id="ISTANZARIESAME_S19.7" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_LAVORAZIONE_SUOLO ADD (
			data_ultima_modifica date
			);

			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO ADD (
			data_ultima_modifica date
			);

			commit;
		</sql>
	</changeSet>

	<!--changeSet A4ST_WORKSPACE_LAV_SUOLO add column data_ultima_modifica -->
	<changeSet id="ISTANZARIESAME_S19.8" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE a4st_workspace_lav_suolo DROP COLUMN DATA_AGGIORNAMENTO;
			commit;
		</sql>
	</changeSet>

	<!--changeSet aggiunta area ori in poligoni dichiarato -->
	<changeSet id="ISTANZARIESAME_S19.9" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_SUOLO_DICHIARATO add AREA_ORI number (20,6);
		</sql>
	</changeSet>

	<!--changeSet popola uso suolo ISTANZARIESAME_S19.10 -->
	<include
		file="config/database/changelog/db.istanzariesame.A4SD_CODI_RILE_PCG.changelog.xml" />

	<!--changeSet vista per layer di suolo dichirato -->
	<changeSet id="ISTANZARIESAME_S20.1" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_SUOLO_DICHIARATO_LAYER AS
			SELECT D.ID,
			D.ID_RICHIESTA,
			R.STATO,
			R.CUAA,
			R.CAMPAGNA,
			V.CODI_RILE_PREVALENTE
			CODI_RILE,
			V.DESC_RILE_PREVALENTE DESC_RILE,
			D.ID_ISOLA,
			D.COD_ISOLA,
			D.COD_SEZIONE,
			SC.NOME_COMUNE AS COMUNE,
			D.AREA,
			D.AREA_ORI,
			D.SHAPE
			FROM
			A4ST_SUOLO_DICHIARATO D
			INNER JOIN A4ST_RICHIESTA_MODIFICA_SUOLO R ON
			R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE =
			D.CODI_RILE_DICHIARATO AND V.CODI_PROD_RILE =
			D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN SITICOMU SC ON SC.COD_NAZIONALE
			= D.COD_SEZIONE;

			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_SUOLO_DICHIARATO_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on A4SV_SUOLO_DICHIARATO_LAYER to ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet vista per layer di suolo rilevato -->
	<changeSet id="ISTANZARIESAME_S20.2" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_SUOLO_RILEVATO_LAYER AS
			SELECT D.ID,
			D.ID_RICHIESTA,
			R.STATO,
			R.CUAA,
			R.CAMPAGNA,
			V.CODI_RILE_PREVALENTE
			CODI_RILE,
			V.DESC_RILE_PREVALENTE DESC_RILE,
			D.ID_ISOLA,
			D.AREA,
			D.SHAPE
			FROM A4ST_SUOLO_RILEVATO D
			INNER JOIN A4ST_RICHIESTA_MODIFICA_SUOLO R
			ON R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE
			= D.CODI_RILE_RILEVATO AND V.CODI_PROD_RILE =
			D.CODI_PROD_RILE_RILEVATO;


			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_SUOLO_RILEVATO_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on A4SV_SUOLO_RILEVATO_LAYER to ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet filtro richiesta non chiusa su layer -->
	<changeSet id="ISTANZARIESAME_S20.3" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_SUOLO_DICHIARATO_LAYER AS
			SELECT D.ID,
			D.ID_RICHIESTA,
			R.STATO,
			R.CUAA,
			R.CAMPAGNA,
			V.CODI_RILE_PREVALENTE
			CODI_RILE,
			V.DESC_RILE_PREVALENTE DESC_RILE,
			D.ID_ISOLA,
			D.COD_ISOLA,
			D.COD_SEZIONE,
			SC.NOME_COMUNE AS COMUNE,
			D.AREA,
			D.AREA_ORI,
			D.SHAPE
			FROM
			A4ST_SUOLO_DICHIARATO D
			INNER JOIN A4ST_RICHIESTA_MODIFICA_SUOLO R ON
			R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE =
			D.CODI_RILE_DICHIARATO AND V.CODI_PROD_RILE =
			D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN SITICOMU SC ON SC.COD_NAZIONALE
			= D.COD_SEZIONE
			WHERE R.STATO &lt;&gt; ('CHIUSA');

			CREATE OR REPLACE VIEW A4SV_SUOLO_RILEVATO_LAYER AS
			SELECT D.ID,
			D.ID_RICHIESTA,
			R.STATO,
			R.CUAA,
			R.CAMPAGNA,
			V.CODI_RILE_PREVALENTE
			CODI_RILE,
			V.DESC_RILE_PREVALENTE DESC_RILE,
			D.ID_ISOLA,
			D.AREA,
			D.SHAPE
			FROM A4ST_SUOLO_RILEVATO D
			INNER JOIN A4ST_RICHIESTA_MODIFICA_SUOLO R
			ON R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE
			= D.CODI_RILE_RILEVATO AND V.CODI_PROD_RILE =
			D.CODI_PROD_RILE_RILEVATO
			WHERE R.STATO &lt;&gt; ('CHIUSA');
		</sql>
	</changeSet>

	<!--changeSet vista per layer di suolo -->
	<changeSet id="ISTANZARIESAME_S20.4" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_SUOLO_LAYER AS
			SELECT S.ID, S.ID_GRID, S.ISTATP,
			S.SHAPE, S.AREA_COLT, S.COD_USO_SUOLO, V.DESCRIZIONE USO_SUOLO_DES,
			sc.STATO_COLT, sc.DESCRIZIONE STATO_COLT_DES, S.SORGENTE,
			S.DATA_INIZIO_VALIDITA, S.DATA_FINE_VALIDITA, S.NOTE, S.CAMPAGNA,
			S.ID_LAVORAZIONE_IN_CORSO
			FROM A4ST_SUOLO S
			LEFT JOIN A4SD_USO_SUOLO V
			ON V.COD_USO_SUOLO = S.COD_USO_SUOLO
			LEFT JOIN A4SD_STATO_COLT sc on S.STATO_COLT = sc.id
			where sysdate between
			S.DATA_INIZIO_VALIDITA and nvl(s.DATA_FINE_VALIDITA,
			to_date('31/12/9999','dd/mm/yyyy'));

			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_SUOLO_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on A4SV_SUOLO_LAYER to ${user.writer};
		</sql>
	</changeSet>


	<!--changeSet definizione VIEW A4SV_SUOLO_DICH_LAVORAZIONE -->
	<changeSet id="ISTANZARIESAME_S20.05" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_DICH_LAVORAZIONE (
			ID_SUOLO_DICH,
			ID_RICHIESTA,
			STATO_RICHIESTA,
			CUAA,
			AZIENDA,
			CAMPAGNA,
			TIPO_SUOLO_DICHIARATO,
			TIPO_SUOLO_RILEVATO,
			AREA_ORI,
			CODI_RILE_DICHIARATO,
			DESC_RILE_DICHIARATO,
			CODI_PROD_RILE_DICHIARATO,
			DESC_PROD_RILE_DICHIARATO,
			CODI_RILE_PREVALENTE_DICH,
			DESC_RILE_PREVALENTE_DICH,
			COD_SEZIONE,
			CODI_RILE_RILEVATO,
			DESC_RILE_RILEVATO,
			CODI_PROD_RILE_RILEVATO,
			DESC_PROD_RILE_RILEVATO,
			CODI_RILE_PREVALENTE_RIL,
			DESC_RILE_PREVALENTE_RIL,
			ID_LAVORAZIONE,
			STATO_LAVORAZIONE
			) AS
			select
			D.ID ID_SUOLO_DICH,
			R.ID ID_RICHIESTA,
			R.STATO STATO_RICHIESTA,
			R.CUAA,
			R.AZIENDA,
			R.CAMPAGNA,
			D.TIPO_SUOLO_DICHIARATO,
			D.TIPO_SUOLO_RILEVATO,
			D.AREA_ORI,
			D.CODI_RILE_DICHIARATO ,
			V.DESC_RILE DESC_RILE_DICHIARATO,
			D.CODI_PROD_RILE_DICHIARATO,
			V.DESC_PROD_RILE DESC_PROD_RILE_DICHIARATO,
			V.CODI_RILE_PREVALENTE CODI_RILE_PREVALENTE_DICH,
			V.DESC_RILE_PREVALENTE DESC_RILE_PREVALENTE_DICH,
			D.COD_SEZIONE,
			SR.CODI_RILE_RILEVATO,
			VR.DESC_RILE DESC_RILE_RILEVATO,
			SR.CODI_PROD_RILE_RILEVATO,
			VR.DESC_PROD_RILE DESC_PROD_RILE_RILEVATO,
			VR.CODI_RILE_PREVALENTE CODI_RILE_PREVALENTE_RIL,
			VR.DESC_RILE_PREVALENTE DESC_RILE_PREVALENTE_RIL,
			D.ID_LAVORAZIONE,
			LAVORAZIONE.STATO STATO_LAVORAZIONE
			FROM
			A4ST_RICHIESTA_MODIFICA_SUOLO R
			INNER JOIN A4ST_SUOLO_DICHIARATO D ON R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE = D.CODI_RILE_DICHIARATO
			AND V.CODI_PROD_RILE = D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN A4SR_SUPPORTO_TAG_TIPO_SUOLO ST ON ST.ID_SUOLO_DICHIARATO =
			D.ID
			LEFT JOIN A4ST_SUOLO_RILEVATO SR ON SR.ID = ST.ID_SUOLO_RILEVATO
			LEFT JOIN A4SD_CODI_RILE_PCG VR ON VR.CODI_RILE = SR.CODI_RILE_RILEVATO
			AND VR.CODI_PROD_RILE = SR.CODI_PROD_RILE_RILEVATO
			LEFT JOIN A4ST_LAVORAZIONE_SUOLO LAVORAZIONE ON LAVORAZIONE.ID =
			D.ID_LAVORAZIONE;
		</sql>

	</changeSet>

	<!--changeSet definizione VIEW A4SV_WORKSPACE_LAV_SUOLO_LAYER -->
	<changeSet id="ISTANZARIESAME_S21.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			create or replace view
			A4SV_WORKSPACE_LAV_SUOLO_LAYER as
			SELECT D.ID, D.ID_LAVORAZIONE, D.COD_USO_SUOLO, V.DESCRIZIONE
			USO_SUOLO_DES, D.STATO_COLT, SC.DESCRIZIONE STATO_COLT_DES, D.NOTE,
			D.DATA_ULTIMA_MODIFICA, D.SHAPE
			FROM A4ST_WORKSPACE_LAV_SUOLO D
			LEFT
			JOIN A4SD_USO_SUOLO V ON V.COD_USO_SUOLO = D.COD_USO_SUOLO
			LEFT JOIN
			A4SD_STATO_COLT SC ON SC.STATO_COLT = D.STATO_COLT;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on
			A4SV_WORKSPACE_LAV_SUOLO_LAYER to ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet metainfo VIEW A4SV_WORKSPACE_LAV_SUOLO_LAYER -->
	<changeSet id="ISTANZARIESAME_S21.02" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into
			user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4SV_WORKSPACE_LAV_SUOLO_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
	</changeSet>

	<!--changeSet definizione VIEW A4SV_WORKSPACE_LAV_SUOLO_LAYER -->
	<changeSet id="ISTANZARIESAME_S21.03" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">

			CREATE OR REPLACE FORCE EDITIONABLE VIEW A4SV_SUOLO_DICHIARATO_LAYER as
			SELECT D.ID,
			D.ID_RICHIESTA,
			D.ID_LAVORAZIONE,
			R.STATO,
			R.CUAA,
			R.CAMPAGNA,
			V.CODI_RILE_PREVALENTE CODI_RILE,
			V.DESC_RILE_PREVALENTE DESC_RILE,
			D.ID_ISOLA,
			D.COD_ISOLA,
			D.COD_SEZIONE,
			SC.NOME_COMUNE AS COMUNE,
			D.AREA,
			D.AREA_ORI,
			D.SHAPE
			FROM
			A4ST_SUOLO_DICHIARATO D
			INNER JOIN A4ST_RICHIESTA_MODIFICA_SUOLO R ON
			R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE =
			D.CODI_RILE_DICHIARATO AND V.CODI_PROD_RILE =
			D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN SITICOMU SC ON SC.COD_NAZIONALE
			= D.COD_SEZIONE
			WHERE R.STATO &lt;&gt; ('CHIUSA');
		</sql>
	</changeSet>


	<!--changeSet aggiunta colonna SHAPE VIEW A4SV_SUOLO_DICH_LAVORAZIONE -->
	<changeSet id="ISTANZARIESAME_S21.04" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_DICH_LAVORAZIONE (
			ID_SUOLO_DICH,
			ID_RICHIESTA,
			STATO_RICHIESTA,
			CUAA,
			AZIENDA,
			CAMPAGNA,
			TIPO_SUOLO_DICHIARATO,
			TIPO_SUOLO_RILEVATO,
			SHAPE,
			AREA_ORI,
			CODI_RILE_DICHIARATO,
			DESC_RILE_DICHIARATO,
			CODI_PROD_RILE_DICHIARATO,
			DESC_PROD_RILE_DICHIARATO,
			CODI_RILE_PREVALENTE_DICH,
			DESC_RILE_PREVALENTE_DICH,
			COD_SEZIONE,
			CODI_RILE_RILEVATO,
			DESC_RILE_RILEVATO,
			CODI_PROD_RILE_RILEVATO,
			DESC_PROD_RILE_RILEVATO,
			CODI_RILE_PREVALENTE_RIL,
			DESC_RILE_PREVALENTE_RIL,
			ID_LAVORAZIONE,
			STATO_LAVORAZIONE
			) AS
			select
			D.ID ID_SUOLO_DICH,
			R.ID ID_RICHIESTA,
			R.STATO STATO_RICHIESTA,
			R.CUAA,
			R.AZIENDA,
			R.CAMPAGNA,
			D.TIPO_SUOLO_DICHIARATO,
			D.TIPO_SUOLO_RILEVATO,
			D.SHAPE,
			D.AREA_ORI,
			D.CODI_RILE_DICHIARATO ,
			V.DESC_RILE DESC_RILE_DICHIARATO,
			D.CODI_PROD_RILE_DICHIARATO,
			V.DESC_PROD_RILE DESC_PROD_RILE_DICHIARATO,
			V.CODI_RILE_PREVALENTE CODI_RILE_PREVALENTE_DICH,
			V.DESC_RILE_PREVALENTE DESC_RILE_PREVALENTE_DICH,
			D.COD_SEZIONE,
			SR.CODI_RILE_RILEVATO,
			VR.DESC_RILE DESC_RILE_RILEVATO,
			SR.CODI_PROD_RILE_RILEVATO,
			VR.DESC_PROD_RILE DESC_PROD_RILE_RILEVATO,
			VR.CODI_RILE_PREVALENTE CODI_RILE_PREVALENTE_RIL,
			VR.DESC_RILE_PREVALENTE DESC_RILE_PREVALENTE_RIL,
			D.ID_LAVORAZIONE,
			LAVORAZIONE.STATO STATO_LAVORAZIONE
			FROM
			A4ST_RICHIESTA_MODIFICA_SUOLO R
			INNER JOIN A4ST_SUOLO_DICHIARATO D ON R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE = D.CODI_RILE_DICHIARATO
			AND V.CODI_PROD_RILE = D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN A4SR_SUPPORTO_TAG_TIPO_SUOLO ST ON ST.ID_SUOLO_DICHIARATO =
			D.ID
			LEFT JOIN A4ST_SUOLO_RILEVATO SR ON SR.ID = ST.ID_SUOLO_RILEVATO
			LEFT JOIN A4SD_CODI_RILE_PCG VR ON VR.CODI_RILE = SR.CODI_RILE_RILEVATO
			AND VR.CODI_PROD_RILE = SR.CODI_PROD_RILE_RILEVATO
			LEFT JOIN A4ST_LAVORAZIONE_SUOLO LAVORAZIONE ON LAVORAZIONE.ID =
			D.ID_LAVORAZIONE;
		</sql>

	</changeSet>

	<!--changeSet creazione tabelle gestione layer -->
	<changeSet id="ISTANZARIESAME_S21.05" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			CREATE TABLE a4st_layer (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			codice_interno ${string.type}(50) NOT NULL,
			url ${string.type}(500)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4st_layer ADD CONSTRAINT a4st_layer_pk PRIMARY KEY ( id );

			ALTER TABLE a4st_layer ADD CONSTRAINT a4st_layer_cod_int_uq UNIQUE (
			codice_interno );


			CREATE TABLE a4sr_layer_profilo (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			id_layer ${id.number.type} NOT NULL,
			profilo_utente ${string.type}(50) NOT NULL
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4sr_layer_profilo ADD CONSTRAINT a4sr_layer_profilo_pk
			PRIMARY KEY ( id );

			ALTER TABLE a4sr_layer_profilo ADD CONSTRAINT a4sr_id_layer_fk
			FOREIGN KEY ( id_layer ) REFERENCES a4st_layer ( id ) NOT DEFERRABLE;


			CREATE TABLE a4st_proprieta_layer (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			id_layer ${id.number.type} NOT NULL,
			nome ${string.type}(100),
			valore ${string.type}(500)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4st_proprieta_layer ADD CONSTRAINT a4st_proprieta_layer_pk
			PRIMARY KEY ( id );

			ALTER TABLE a4st_proprieta_layer ADD CONSTRAINT a4st_proprieta_layer_fk
			FOREIGN KEY ( id_layer ) REFERENCES a4st_layer ( id ) NOT DEFERRABLE;
		</sql>

	</changeSet>

	<!--changeSet ADD COLUMN a4st_layer -->
	<changeSet id="ISTANZARIESAME_S21.06" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			ALTER TABLE A4ST_LAYER ADD
			NOME_LAYER ${string.type}(200);
		</sql>
	</changeSet>


	<!--changeSet GRANT COLUMN A4ST_LAYER,A4ST_PROPRIETA_LAYER,A4SR_LAYER_PROFILO -->
	<changeSet id="ISTANZARIESAME_S21.07" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_LAYER TO ${user.writer};
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_PROPRIETA_LAYER TO
			${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON
			A4SR_LAYER_PROFILO TO ${user.writer};
		</sql>
	</changeSet>


	<!--changeSet DROP E CREATE tabelle gestione layer -->
	<changeSet id="ISTANZARIESAME_S21.13" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			drop table
			A4ST_PROPRIETA_LAYER;
			drop table A4SR_LAYER_PROFILO;
			drop table
			A4ST_LAYER;

			CREATE TABLE a4st_layer (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			NOME_LAYER ${string.type}(200) NOT NULL,
			URL ${string.type}(500) NOT NULL ,
			WORKSPACE ${string.type}(100) ,
			CODICE ${string.type}(50) NOT NULL
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4st_layer ADD CONSTRAINT a4st_layer_pk PRIMARY KEY ( id );

			ALTER TABLE a4st_layer ADD CONSTRAINT a4st_layer_cod_uq UNIQUE (
			codice );


			CREATE TABLE a4sr_layer_profilo (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			id_layer ${id.number.type} NOT NULL,
			profilo_utente ${string.type}(50) NOT NULL
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4sr_layer_profilo ADD CONSTRAINT a4sr_layer_profilo_pk
			PRIMARY KEY ( id );

			ALTER TABLE a4sr_layer_profilo ADD CONSTRAINT a4sr_id_layer_fk
			FOREIGN KEY ( id_layer ) REFERENCES a4st_layer ( id ) NOT DEFERRABLE;


			CREATE TABLE a4st_proprieta_layer (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			id_layer ${id.number.type} NOT NULL,
			nome ${string.type}(100),
			valore ${string.type}(500)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE a4st_proprieta_layer ADD CONSTRAINT a4st_proprieta_layer_pk
			PRIMARY KEY ( id );

			ALTER TABLE a4st_proprieta_layer ADD CONSTRAINT a4st_proprieta_layer_fk
			FOREIGN KEY ( id_layer ) REFERENCES a4st_layer ( id ) NOT DEFERRABLE;
		</sql>

	</changeSet>

	<!--changeSet Ri-popola-AfterDropTable_A4ST_LAYER ISTANZARIESAME_S21.14 -->
	<include
		file="config/database/changelog/db.istanzariesame.ripopola_layer_after_drop_table.changelog.xml" />

	<!--changeSet GRANT COLUMN A4ST_LAYER,A4ST_PROPRIETA_LAYER,A4SR_LAYER_PROFILO -->
	<changeSet id="ISTANZARIESAME_S21.15" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_LAYER TO ${user.writer};
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_PROPRIETA_LAYER TO
			${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON
			A4SR_LAYER_PROFILO TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet aggiungi A4ST_PROPRIETA_LAYER ISTANZARIESAME_S21.16 -->
	<include
		file="config/database/changelog/db.istanzariesame.config_layer_21_16.changelog.xml" />

	<!--changeSet tabella catasto -->
	<changeSet id="ISTANZARIESAME_S22.1" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			A4ST_CATASTO
			(
			ID ${id.number.type} NOT NULL ,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL ,
			COD_NAZIONALE CHAR(4 BYTE) NOT NULL ,
			FOGLIO NUMBER(4,0) DEFAULT 9999 ,
			PARTICELLA CHAR(5 BYTE) NOT NULL ,
			SUB VARCHAR2(3 BYTE) NOT NULL ,
			ISTATP VARCHAR2(3) ,
			AREA NUMBER(20,6) ,
			DATA_INIZIO_VAL DATE NOT NULL ,
			DATA_FINE_VAL DATE DEFAULT TO_DATE('9999/12/31', 'yyyy/mm/dd'),
			SHAPE MDSYS.SDO_GEOMETRY ,
			DATA_IMPORT DATE DEFAULT SYSDATE NOT NULL ,
			CONSTRAINT A4ST_CATASTO_UQ UNIQUE (COD_NAZIONALE, FOGLIO, PARTICELLA, SUB,
			DATA_FINE_VAL)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE A4ST_CATASTO ADD CONSTRAINT A4ST_CATASTO_PK PRIMARY KEY ( id
			);

			INSERT INTO
			user_sdo_geom_metadata VALUES
			('A4ST_CATASTO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			COMMIT;

			CREATE INDEX
			A4ST_CATASTO_SPIDX
			ON A4ST_CATASTO (SHAPE)
			INDEXTYPE IS MDSYS.SPATIAL_INDEX PARAMETERS
			( 'tablespace=${tablespace.index}'
			);
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on A4ST_CATASTO to ${user.writer};
		</sql>
	</changeSet>
	<!--changeSet vista per layer di catasto -->
	<changeSet id="ISTANZARIESAME_S22.2" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			create or replace view A4SV_CATASTO_LAYER as
			select ID, a.COD_NAZIONALE, a.FOGLIO, a.PARTICELLA, a.SUB, SC.NOME_COMUNE
			AS COMUNE, a.ISTATP, AREA, a.DATA_INIZIO_VAL, a.DATA_FINE_VAL,
			a.SHAPE, a.DATA_IMPORT
			from A4ST_CATASTO a
			LEFT JOIN SITICOMU SC ON
			SC.COD_NAZIONALE = A.COD_NAZIONALE;

			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4SV_CATASTO_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on A4SV_CATASTO_LAYER to ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet per inserimento layer Ortofoto2020 -->
	<changeSet id="ISTANZARIESAME_S22.3" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE) values
			(nxtnbr.nextval,'1','agea2020','/proxy/geoserver','/pub_stem_s','ortofoto2020');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'CAA');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'VITICOLO');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'titolo','Ortofoto2020');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'cancellabile','no');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice = 'ortofoto2020'),'posizione','10');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'Ispezionabile','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'AbilitatoDefault','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'formato','wms');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice = 'ortofoto2020'),'gruppo','Sfondo');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto'),'gruppo','Sfondo');
			commit;
		</sql>
	</changeSet>

	<!--changeSet aggiunta colonna cod cc a catasto -->
	<changeSet id="ISTANZARIESAME_S23.1" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_CATASTO add COD_CC number(3, 0);
		</sql>
	</changeSet>

	<!--changeSet CREATE TABLE A4ST_ATTRIBUTI_LAYER -->
	<changeSet id="ISTANZARIESAME_S23.2" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4ST_ATTRIBUTI_LAYER (
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			ID_LAYER ${id.number.type} NOT NULL,
			NOME ${string.type}(500) NOT NULL,
			VALORE_DEFAULT ${string.type}(500 BYTE) ,
			EDITABILE NUMBER(1) NOT NULL ENABLE
			)TABLESPACE ${tablespace.data};

			ALTER TABLE A4ST_ATTRIBUTI_LAYER ADD CONSTRAINT A4ST_ATTRIBUTI_LAYER_PK
			PRIMARY KEY ( ID );
			ALTER TABLE A4ST_ATTRIBUTI_LAYER ADD CONSTRAINT A4ST_ATTRIBUTI_LAYER_FK
			FOREIGN KEY ( ID_LAYER ) REFERENCES A4ST_LAYER ( ID );
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_ATTRIBUTI_LAYER TO
			${user.writer};
		</sql>
	</changeSet>

	<!--changeSet per inserimento A4ST_ATTRIBUTI_LAYER -->
	<changeSet id="ISTANZARIESAME_S23.3" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			insert into A4ST_ATTRIBUTI_LAYER values (nxtnbr.nextval,0,(select id from
			a4st_layer where nome_layer
			='A4SV_WORKSPACE_LAV_SUOLO_LAYER2'),'ID','',0);
			insert into A4ST_ATTRIBUTI_LAYER values (nxtnbr.nextval,0,(select id from
			a4st_layer where nome_layer
			='A4SV_WORKSPACE_LAV_SUOLO_LAYER2'),'ID_LAVORAZIONE','',0);
			insert into A4ST_ATTRIBUTI_LAYER values (nxtnbr.nextval,0,(select id from
			a4st_layer where nome_layer
			='A4SV_WORKSPACE_LAV_SUOLO_LAYER2'),'COD_USO_SUOLO','999',1);
			insert into A4ST_ATTRIBUTI_LAYER values (nxtnbr.nextval,0,(select id from
			a4st_layer where nome_layer
			='A4SV_WORKSPACE_LAV_SUOLO_LAYER2'),'USO_SUOLO_DES','DA
			CODIFICARE',0);
			insert into A4ST_ATTRIBUTI_LAYER values (nxtnbr.nextval,0,(select id from
			a4st_layer where nome_layer
			='A4SV_WORKSPACE_LAV_SUOLO_LAYER2'),'STATO_COLT','0',1);
			insert into A4ST_ATTRIBUTI_LAYER values (nxtnbr.nextval,0,(select id from
			a4st_layer where nome_layer
			='A4SV_WORKSPACE_LAV_SUOLO_LAYER2'),'STATO_COLT_DES','GENERICO',0);
			insert into A4ST_ATTRIBUTI_LAYER values (nxtnbr.nextval,0,(select id
			from a4st_layer where nome_layer
			='A4SV_WORKSPACE_LAV_SUOLO_LAYER2'),'NOTE','',0);
			insert into A4ST_ATTRIBUTI_LAYER values (nxtnbr.nextval,0,(select id from
			a4st_layer where nome_layer
			='A4SV_WORKSPACE_LAV_SUOLO_LAYER2'),'DATA_ULTIMA_MODIFICA','',0);
			commit;
		</sql>
	</changeSet>

	<!--changeSet per tabella AMM_CAT_TN -->
	<changeSet id="ISTANZARIESAME_S23.4" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE AMM_CAT_TN
			( ID ${id.number.type},
			COD_BELFIORE ${string.type}(4 BYTE),
			ISTATP ${string.type}(3 BYTE),
			ISTATC ${string.type}(3 BYTE),
			COMUNE_AMMINISTRATIVO ${string.type}(255 BYTE),
			COD_NAZIONALE ${string.type}(4 BYTE),
			NOME_SEZIONE_SIAP ${string.type}(255 BYTE),
			SEZIONE_CENSUARIA_SIAP ${string.type}(1 BYTE),
			COD_CC ${id.number.type},
			DES_CC ${string.type}(255 BYTE),
			COD_COMUNITA ${id.number.type},
			DES_COMUNITA ${string.type}(255 BYTE)
			) TABLESPACE ${tablespace.data} ;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON AMM_CAT_TN TO ${user.writer};
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.AMM_CAT_TN.changelog.xml" />

	<!--changeSet per vista A4SV_CATASTO_LAYER -->
	<changeSet id="ISTANZARIESAME_S23.6" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			create or replace view A4SV_CATASTO_LAYER as
			select a.ID, A.COD_CC, SC.DES_CC AS COMUNE_CATASTALE, a.COD_NAZIONALE,
			ltrim(a.PARTICELLA, '0') || case when trim(a.SUB) is null then ''
			else '/' end || trim(a.SUB) as PARTICELLA, a.AREA, a.DATA_INIZIO_VAL,
			a.DATA_FINE_VAL, a.SHAPE
			from A4ST_CATASTO a
			LEFT JOIN AMM_CAT_TN SC ON
			SC.COD_CC = A.COD_CC;
		</sql>
	</changeSet>
	<!--changeSet per riordine layer -->
	<changeSet id="ISTANZARIESAME_S23.7" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			update A4ST_PROPRIETA_LAYER set valore = valore*100 where nome =
			'posizione' and id_layer not in (select id from a4st_layer where
			lower(codice) like 'orto%');
			commit;
		</sql>
	</changeSet>

	<!--changeSet per inserimento configurazioni particelleCatastali -->
	<changeSet id="ISTANZARIESAME_S23.8" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,CODICE,workspace) VALUES
			(nxtnbr.nextval,1,'A4SV_CATASTO_LAYER2','/proxy/geoserver','particelleCatastali','/app_a4s');

			insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'CAA');
			insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'BACKOFFICE');
			insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'VITICOLO');

			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'titolo','Particelle catastali');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'cancellabile','si');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'Ispezionabile','si');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'AbilitatoDefault','no');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'posizione','150');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'formato','wms');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'gruppo','Catasto');

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S23.9" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			GRANT SELECT ON A4SV_CATASTO_LAYER TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet per inserimento layer Comuni Amministrativi -->
	<changeSet id="ISTANZARIESAME_S23.10" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE) values
			(nxtnbr.nextval,'1','Comuni_amministrativi','/proxy/geoserver','/pub_ambitiamministrativi','comuniAmministrativiTN');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'CAA');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'BACKOFFICE');
			Insert into
			A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'VITICOLO');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'titolo','Comuni amministrativi');
			Insert
			into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'cancellabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'posizione','140');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'Ispezionabile','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'AbilitatoDefault','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'formato','wms');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'gruppo','Catasto');
			commit;
		</sql>
	</changeSet>

	<!--changeSet per abilitazione ortofoto2020 come layer di default -->
	<changeSet id="ISTANZARIESAME_S23.11" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer set valore = 'si' where nome =
			'AbilitatoDefault' and id_layer = (select id from a4st_layer where
			codice = 'ortofoto2020');
			update a4st_proprieta_layer set valore =
			'no' where nome = 'AbilitatoDefault' and id_layer = (select id from
			a4st_layer where codice = 'ortofoto');
			commit;
		</sql>
	</changeSet>

	<!--changeSet vista per layer di suolo fix stato colt -->
	<changeSet id="ISTANZARIESAME_S24.1" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_SUOLO_LAYER AS
			SELECT S.ID, S.ID_GRID, S.ISTATP,
			S.SHAPE, S.AREA_COLT, S.COD_USO_SUOLO, V.DESCRIZIONE USO_SUOLO_DES,
			sc.STATO_COLT, sc.DESCRIZIONE STATO_COLT_DES, S.SORGENTE,
			S.DATA_INIZIO_VALIDITA, S.DATA_FINE_VALIDITA, S.NOTE, S.CAMPAGNA,
			S.ID_LAVORAZIONE_IN_CORSO
			FROM A4ST_SUOLO S
			LEFT JOIN A4SD_USO_SUOLO V
			ON V.COD_USO_SUOLO = S.COD_USO_SUOLO
			LEFT JOIN A4SD_STATO_COLT sc on S.STATO_COLT = sc.STATO_COLT
			where sysdate
			between S.DATA_INIZIO_VALIDITA and nvl(s.DATA_FINE_VALIDITA,
			to_date('31/12/9999','dd/mm/yyyy'));
		</sql>
	</changeSet>

	<!--proprieta layer -->
	<changeSet id="ISTANZARIESAME_S24.2" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloDichiaratoLavBO'),'tematismoBordoColore','rgba(81,186,232,1)');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloDichiaratoLavBO'),'tematismoLabel','CODI_RILE');
			commit;
		</sql>
	</changeSet>
	<!--proprieta layer -->
	<changeSet id="ISTANZARIESAME_S24.3" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			update A4ST_PROPRIETA_LAYER set valore = '100' where nome = 'posizione' and
			id_layer = (select id from a4st_layer where codice = 'workspaceBO');
			update A4ST_PROPRIETA_LAYER set valore = 'si' where nome =
			'Ispezionabile' and id_layer in (select id from a4st_layer where
			codice like 'suoloVigente%');
			commit;
		</sql>
	</changeSet>

	<!--proprieta layer -->
	<changeSet id="ISTANZARIESAME_S24.4" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_SUOLO_DICHIARATO add ESITO ${string.type}(100);
			UPDATE
			A4ST_SUOLO_DICHIARATO SET ESITO = 'DA_LAVORARE';
			commit;
			ALTER TABLE
			A4ST_SUOLO_DICHIARATO modify(ESITO ${string.type}(100) default
			'DA_LAVORARE' NOT NULL);
		</sql>
	</changeSet>
	<!--changeSet aggiunta colonna A4SV_SUOLO_DICH_LAVORAZIONE -->
	<changeSet id="ISTANZARIESAME_S24.05" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_DICH_LAVORAZIONE (
			ID_SUOLO_DICH,
			ID_RICHIESTA,
			STATO_RICHIESTA,
			CUAA,
			AZIENDA,
			CAMPAGNA,
			TIPO_SUOLO_DICHIARATO,
			TIPO_SUOLO_RILEVATO,
			SHAPE,
			AREA_ORI,
			CODI_RILE_DICHIARATO,
			DESC_RILE_DICHIARATO,
			CODI_PROD_RILE_DICHIARATO,
			DESC_PROD_RILE_DICHIARATO,
			CODI_RILE_PREVALENTE_DICH,
			DESC_RILE_PREVALENTE_DICH,
			COD_SEZIONE,
			CODI_RILE_RILEVATO,
			DESC_RILE_RILEVATO,
			CODI_PROD_RILE_RILEVATO,
			DESC_PROD_RILE_RILEVATO,
			CODI_RILE_PREVALENTE_RIL,
			DESC_RILE_PREVALENTE_RIL,
			ESITO_DICHIARATO,
			ID_LAVORAZIONE,
			STATO_LAVORAZIONE
			) AS
			select
			D.ID ID_SUOLO_DICH,
			R.ID ID_RICHIESTA,
			R.STATO STATO_RICHIESTA,
			R.CUAA,
			R.AZIENDA,
			R.CAMPAGNA,
			D.TIPO_SUOLO_DICHIARATO,
			D.TIPO_SUOLO_RILEVATO,
			D.SHAPE,
			D.AREA_ORI,
			D.CODI_RILE_DICHIARATO ,
			V.DESC_RILE DESC_RILE_DICHIARATO,
			D.CODI_PROD_RILE_DICHIARATO,
			V.DESC_PROD_RILE DESC_PROD_RILE_DICHIARATO,
			V.CODI_RILE_PREVALENTE CODI_RILE_PREVALENTE_DICH,
			V.DESC_RILE_PREVALENTE DESC_RILE_PREVALENTE_DICH,
			D.COD_SEZIONE,
			SR.CODI_RILE_RILEVATO,
			VR.DESC_RILE DESC_RILE_RILEVATO,
			SR.CODI_PROD_RILE_RILEVATO,
			VR.DESC_PROD_RILE DESC_PROD_RILE_RILEVATO,
			VR.CODI_RILE_PREVALENTE CODI_RILE_PREVALENTE_RIL,
			VR.DESC_RILE_PREVALENTE DESC_RILE_PREVALENTE_RIL,
			D.ESITO ESITO_DICHIARATO,
			D.ID_LAVORAZIONE,
			LAVORAZIONE.STATO STATO_LAVORAZIONE
			FROM
			A4ST_RICHIESTA_MODIFICA_SUOLO R
			INNER JOIN A4ST_SUOLO_DICHIARATO D ON R.ID = D.ID_RICHIESTA
			LEFT JOIN A4SD_CODI_RILE_PCG V ON V.CODI_RILE = D.CODI_RILE_DICHIARATO
			AND V.CODI_PROD_RILE = D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN A4SR_SUPPORTO_TAG_TIPO_SUOLO ST ON ST.ID_SUOLO_DICHIARATO =
			D.ID
			LEFT JOIN A4ST_SUOLO_RILEVATO SR ON SR.ID = ST.ID_SUOLO_RILEVATO
			LEFT JOIN A4SD_CODI_RILE_PCG VR ON VR.CODI_RILE = SR.CODI_RILE_RILEVATO
			AND VR.CODI_PROD_RILE = SR.CODI_PROD_RILE_RILEVATO
			LEFT JOIN A4ST_LAVORAZIONE_SUOLO LAVORAZIONE ON LAVORAZIONE.ID =
			D.ID_LAVORAZIONE;
		</sql>

	</changeSet>
	<!--changeSet definizione VIEW A4SV_WORKSPACE_LAV_SUOLO_LAYER -->
	<changeSet id="ISTANZARIESAME_S24.06" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">

			CREATE OR REPLACE VIEW A4SV_SUOLO_DICHIARATO_LAYER as
			SELECT D.ID,
			D.ID_RICHIESTA,
			D.ID_LAVORAZIONE,
			R.STATO,
			R.CUAA,
			R.CAMPAGNA,
			V.CODI_RILE_PREVALENTE CODI_RILE,
			V.DESC_RILE_PREVALENTE DESC_RILE,
			D.ID_ISOLA,
			D.COD_ISOLA,
			D.COD_SEZIONE,
			SC.NOME_COMUNE AS COMUNE,
			D.AREA,
			D.AREA_ORI,
			D.ESITO,
			D.SHAPE
			FROM A4ST_SUOLO_DICHIARATO D
			INNER JOIN
			A4ST_RICHIESTA_MODIFICA_SUOLO R ON R.ID = D.ID_RICHIESTA
			LEFT JOIN
			A4SD_CODI_RILE_PCG V ON V.CODI_RILE = D.CODI_RILE_DICHIARATO AND
			V.CODI_PROD_RILE = D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN SITICOMU SC
			ON SC.COD_NAZIONALE = D.COD_SEZIONE
			WHERE R.STATO &lt;&gt; ('CHIUSA');
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S24.07" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_WORKSPACE_LAV_SUOLO add AREA number (20,6);
		</sql>
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_WORKSPACE_LAV_SUOLO set AREA = SDO_GEOM.SDO_AREA(shape, 0.005);
			commit;
		</sql>
	</changeSet>

	<!--changeSet replace VIEW A4SV_WORKSPACE_LAV_SUOLO_LAYER -->
	<changeSet id="ISTANZARIESAME_S24.08" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			create or replace view
			A4SV_WORKSPACE_LAV_SUOLO_LAYER as
			SELECT D.ID, D.ID_LAVORAZIONE, D.COD_USO_SUOLO, V.DESCRIZIONE
			USO_SUOLO_DES, D.STATO_COLT, SC.DESCRIZIONE STATO_COLT_DES, D.NOTE,
			D.DATA_ULTIMA_MODIFICA, D.SHAPE,d.AREA
			FROM A4ST_WORKSPACE_LAV_SUOLO D
			LEFT JOIN A4SD_USO_SUOLO V ON V.COD_USO_SUOLO = D.COD_USO_SUOLO
			LEFT
			JOIN A4SD_STATO_COLT SC ON SC.STATO_COLT = D.STATO_COLT;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on
			A4SV_WORKSPACE_LAV_SUOLO_LAYER to ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet per inesrimento nuova proprieta layer TIPO_WMS -->
	<changeSet id="ISTANZARIESAME_S24.09" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE =
			'comuniAmministrativiTN'),'TIPO_WMS','Image');

			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'ortofoto'),'TIPO_WMS','Tile');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'ortofoto2020'),'TIPO_WMS','Tile');
			INSERT
			INTO A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID
			FROM A4ST_LAYER WHERE CODICE =
			'particelleCatastali'),'TIPO_WMS','Tile');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'suoloDichiaratoBO'),'TIPO_WMS','Tile');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT
			ID FROM A4ST_LAYER WHERE CODICE =
			'suoloDichiaratoCAA'),'TIPO_WMS','Tile');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'suoloRilevatoBO'),'TIPO_WMS','Tile');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT
			ID FROM A4ST_LAYER WHERE CODICE =
			'suoloRilevatoCAA'),'TIPO_WMS','Tile');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'suoloVigenteBO'),'TIPO_WMS','Tile');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT
			ID FROM A4ST_LAYER WHERE CODICE =
			'suoloVigenteCAA'),'TIPO_WMS','Tile');

			COMMIT;
		</sql>
	</changeSet>
	<!--proprieta layer -->
	<changeSet id="ISTANZARIESAME_S24.10" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto'),'CONTENUTO_INFORMATIVO','ORTOFOTO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloVigenteCAA'),'CONTENUTO_INFORMATIVO','SUOLO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloVigenteBO'),'CONTENUTO_INFORMATIVO','SUOLO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloDichiaratoCAA'),'CONTENUTO_INFORMATIVO','SUOLO_DICHIARATO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloDichiaratoBO'),'CONTENUTO_INFORMATIVO','SUOLO_DICHIARATO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloDichiaratoLavBO'),'CONTENUTO_INFORMATIVO','SUOLO_DICHIARATO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloRilevatoCAA'),'CONTENUTO_INFORMATIVO','SUOLO_RILEVATO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloRilevatoBO'),'CONTENUTO_INFORMATIVO','SUOLO_RILEVATO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'workspaceBO'),'CONTENUTO_INFORMATIVO','WORKSPACE_LAVORAZIONE');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofoto2020'),'CONTENUTO_INFORMATIVO','ORTOFOTO');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'CONTENUTO_INFORMATIVO','COMUNI_AMMINISTRATIVI');
			commit;
		</sql>
	</changeSet>

	<!--changeSet per tabella A4ST_ANOMALIA_VALIDAZIONE -->
	<changeSet id="ISTANZARIESAME_S24.11" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			A4ST_ANOMALIA_VALIDAZIONE
			(
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			ID_LAVORAZIONE NUMBER(10) NOT NULL,
			SHAPE mdsys.sdo_geometry NOT NULL,
			TIPO_ANOMALIA ${string.type}(300),
			DETTAGLIO_ANOMALIA ${string.type}(300),
			AREA NUMBER(20,6)
			) TABLESPACE ${tablespace.data} ;

			ALTER TABLE A4ST_ANOMALIA_VALIDAZIONE ADD CONSTRAINT
			A4ST_ANOMALIA_VALIDAZIONE_FK FOREIGN KEY ( ID_LAVORAZIONE )
			REFERENCES A4ST_LAVORAZIONE_SUOLO ( id ) NOT DEFERRABLE;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_ANOMALIA_VALIDAZIONE TO
			${user.writer};
		</sql>

		<sql endDelimiter=";" splitStatements="true">
			Insert into
			user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4ST_ANOMALIA_VALIDAZIONE','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000,
			5167000,0.005)),'25832');

			CREATE INDEX A4ST_ANOMALIA_VALIDAZIONE_I ON A4ST_ANOMALIA_VALIDAZIONE
			(SHAPE) INDEXTYPE IS "MDSYS"."SPATIAL_INDEX"
			PARAMETERS
			('tablespace=${tablespace.index}');

			CREATE INDEX A4ST_ANOMALIA_VAL_ID_LAV ON A4ST_ANOMALIA_VALIDAZIONE
			(ID_LAVORAZIONE);

		</sql>
	</changeSet>

	<!--changeSet per tabella A4SR_ANOMALIA_WORKSPACE -->
	<changeSet id="ISTANZARIESAME_S24.12" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			A4SR_ANOMALIA_WORKSPACE
			(
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			ID_WORKSPACE NUMBER(20) NOT NULL,
			ID_ANOMALIA NUMBER(20) NOT NULL
			) TABLESPACE ${tablespace.data} ;

			ALTER TABLE A4SR_ANOMALIA_WORKSPACE ADD CONSTRAINT
			A4SR_ANOMALIA_WORKSPACE_FK FOREIGN KEY ( ID_WORKSPACE ) REFERENCES
			A4ST_WORKSPACE_LAV_SUOLO ( id ) NOT DEFERRABLE;

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SR_ANOMALIA_WORKSPACE TO
			${user.writer};
		</sql>

	</changeSet>

	<!--changeSet per alter table A4ST_ANOMALIA_VALIDAZIONE,A4SR_ANOMALIA_WORKSPACE -->
	<changeSet id="ISTANZARIESAME_S24.13" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_ANOMALIA_VALIDAZIONE ADD CONSTRAINT A4ST_ANOMALIA_VALIDAZIONE_PK
			PRIMARY KEY (ID);
		</sql>
	</changeSet>

	<!--changeSet per alter table A4ST_ANOMALIA_VALIDAZIONE,A4SR_ANOMALIA_WORKSPACE -->
	<changeSet id="ISTANZARIESAME_S24.14" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4SR_ANOMALIA_WORKSPACE ADD CONSTRAINT A4SR_ANOMALIA_WORKSPACE_PK
			PRIMARY KEY (ID);
			ALTER TABLE A4SR_ANOMALIA_WORKSPACE ADD CONSTRAINT
			A4SR_ANOMALIA_WORKSPACE_FK2 FOREIGN KEY (id_anomalia) REFERENCES
			A4ST_ANOMALIA_VALIDAZIONE(ID)
			ON DELETE CASCADE;
		</sql>
	</changeSet>

	<!--changeSet per layer geoserver A4SV_ANOMALIA_VALIDAZ_LAYER -->
	<changeSet id="ISTANZARIESAME_S24.15" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_ANOMALIA_VALIDAZ_LAYER AS(
			SELECT
			a.id,
			a.id_lavorazione,
			a.shape,
			a.tipo_anomalia,
			a.area,
			(
			SELECT
			LISTAGG(id_workspace, ',') WITHIN GROUP(
			ORDER BY
			id_anomalia
			)
			FROM
			a4sr_anomalia_workspace b
			WHERE
			a.id = b.id_anomalia
			) AS poligoni_workspace
			FROM
			a4st_anomalia_validazione a);
		</sql>

		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO
			user_sdo_geom_metadata VALUES (
			'A4SV_ANOMALIA_VALIDAZ_LAYER',
			'SHAPE',
			sdo_dim_array(sdo_dim_element('X', 1310000, 2820000, 0.005), sdo_dim_element('Y', 3930000, 5220000,
			0.005)),
			25832
			);

			COMMIT;

			GRANT SELECT ON A4SV_ANOMALIA_VALIDAZ_LAYER TO ${user.writer};
		</sql>

		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO A4ST_LAYER
			VALUES
			(NXTNBR.NEXTVAL,1,'A4SV_ANOMALIA_VALIDAZ_LAYER2','/proxy/geoserver','/app_a4s','anomalieValidazioneBO');

			insert into a4sr_layer_profilo values ( nxtnbr.nextval,1,(select id
			from A4ST_LAYER where codice ='anomalieValidazioneBO'),'BACKOFFICE');
			insert into a4sr_layer_profilo values ( nxtnbr.nextval,1,(select id
			from A4ST_LAYER where codice ='anomalieValidazioneBO'),'VITICOLO');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'titolo','Anomalie');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'cancellabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'posizione','110');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'Ispezionabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'AbilitatoDefault','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'formato','wfs');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'gruppo','Lavorazione');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'CONTENUTO_INFORMATIVO','ANOMALIE_VALIDAZIONE');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'collassaGruppo','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'contesto','LavorazioneEditing');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'campoFiltro','ID_LAVORAZIONE');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'editabile','no');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S24.16" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE INDEX
			A4ST_SUOLO_LAV_CORSO ON A4ST_SUOLO (ID_LAVORAZIONE_IN_CORSO);
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S25.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			a4sr_anomalia_workspace DROP CONSTRAINT A4SR_ANOMALIA_WORKSPACE_FK;

			ALTER TABLE
			a4sr_anomalia_workspace ADD CONSTRAINT A4SR_ANOMALIA_WORKSPACE_FK FOREIGN KEY ( ID_WORKSPACE
			) REFERENCES A4ST_WORKSPACE_LAV_SUOLO ( ID )
			ON DELETE CASCADE ENABLE;

		</sql>
	</changeSet>
	<include
		file="config/database/changelog/db.istanzariesame.SDO_CUSTOM_1.xml" />
	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_1.xml" />

	<!--changeSet per aggiungere le proprietà di filtro e style al layer suoloDichiaratoBO -->
	<changeSet id="ISTANZARIESAME_S26.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloDichiaratoBO'),'PARAMS_FILTER','STATO IN
			(''IN_LAVORAZIONE'',''LAVORABILE'')');
			insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloDichiaratoBO'),'style','Style_suolo_dichiarato_lavorazione');

		</sql>
	</changeSet>

	<!--changeSet per Creare un il layer del suolo già coinvolto in lavorazioni -->
	<changeSet id="ISTANZARIESAME_S26.02" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			insert into A4ST_LAYER
			(ID,VERSIONE,NOME_LAYER,URL,CODICE,workspace) VALUES
			(nxtnbr.nextval,1,'A4SV_SUOLO_LAYER2','/proxy/geoserver','suoloVigenteInclusoInLavorazioniBO','/app_a4s');

			insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'BACKOFFICE');
			insert
			into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'VITICOLO');

			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),
			'PARAMS_FILTER','ID_LAVORAZIONE_IN_CORSO > 1');

			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'titolo','Suolo Vigente
			Occupato');
			insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES (nxtnbr.nextval,1,(select
			ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'cancellabile','si');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'posizione','1');
			insert
			into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'Ispezionabile','no');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'formato','wms');
			insert
			into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'AbilitatoDefault','si');

		</sql>
	</changeSet>

	<!--changeSet per Aggiungere la proprietà di style al layer del suolo già 
		coinvolto in lavorazioni -->
	<changeSet id="ISTANZARIESAME_S26.03" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'style','style_suolo_occupato');

			update A4ST_PROPRIETA_LAYER set valore=105 where nome='posizione' and
			id_layer=(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO');
		</sql>
	</changeSet>

	<!--changeSet per Aggiungere la proprietà al layer switcher -->
	<changeSet id="ISTANZARIESAME_S26.04" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			-- Creare nuovo gruppo "Suolo" (collassato di default) in cui inserire
			i layer "Suolo Vigente" e "Suolo Vigente Occupato"

			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'gruppo','Suolo');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteBO'),'gruppo','Suolo');

			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO'),'collassaGruppo','si');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteBO'),'collassaGruppo','si');

			-- Gruppo "Sfondo" collassato di default
			insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='ortofoto2020'),'collassaGruppo','si');
			insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='ortofoto'),'collassaGruppo','si');

			-- Gruppo "Catasto" collassato di default
			insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='particelleCatastali'),'collassaGruppo','si');
			insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='comuniAmministrativiTN'),'collassaGruppo','si');

			-- Gruppo "Lavorazione" espanso di default
			update a4st_proprieta_layer p
			set valore='no' where p.id_layer in (
			select id from a4st_layer where
			codice in
			('workspaceBO','suoloDichiaratoLavBO','anomalieValidazioneBO'))
			and
			p.nome='collassaGruppo';

			-- Gruppo "Richiesta Modifica Suolo" collassato di default
			update
			a4st_proprieta_layer p set valore='si' where p.id_layer in (
			select id
			from a4st_layer where codice in
			('suoloDichiaratoCAA','suoloDichiaratoBO','suoloRilevatoCAA','suoloRilevatoBO'))
			and p.nome='collassaGruppo';
		</sql>
	</changeSet>

	<!--changeSet per Creare un il layer del suolo già coinvolto in lavorazioni -->
	<changeSet id="ISTANZARIESAME_S26.05" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO add ID_GRID number (3,0);
			ALTER TABLE
			A4ST_WORKSPACE_LAV_SUOLO add ISTATP VARCHAR2(3);
			ALTER TABLE
			A4ST_WORKSPACE_LAV_SUOLO add CAMPAGNA number (4,0);

			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO ADD CONSTRAINT
			a4st_workspace_id_grid_fk FOREIGN KEY ( ID_GRID ) REFERENCES
			A4ST_GRIGLIA_SUOLO ( id ) NOT DEFERRABLE;
		</sql>
	</changeSet>

	<!--proprieta layer -->
	<changeSet id="ISTANZARIESAME_S26.07" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'tematismoBordoColore','rgba(255,0,0,1)');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'tematismoFillColore','rgba(255,0,0,0.2)');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'tematismoEvidente','12');

			commit;
		</sql>
	</changeSet>

	<!-- Aggiornare i nuovi campi istatp e campagna aggiunti sul workspace -->
	<changeSet id="ISTANZARIESAME_S26.08" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_workspace_lav_suolo a set campagna=2020,istatp='022' where
			istatp is null and campagna is null;
			commit;
		</sql>
	</changeSet>

	<!-- Create table A4ST_AGG_COMUNI_CATASTO -->
	<changeSet id="ISTANZARIESAME_S27.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4ST_AGG_COMUNI_CATASTO
			(
			ccat_comune NUMBER(10) NOT NULL,
			data_ultimo_aggiornamento DATE,
			data_ultimo_tentativo DATE,
			esito_aggiornamento VARCHAR(2)
			) TABLESPACE ${tablespace.data} ;
			ALTER TABLE
			A4ST_AGG_COMUNI_CATASTO ADD CONSTRAINT ccat_comune_PK PRIMARY KEY (
			ccat_comune );
		</sql>
	</changeSet>

	<!-- Create table A4ST_AREA_DI_LAVORO -->
	<changeSet id="ISTANZARIESAME_S28.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			A4ST_AREA_DI_LAVORO
			(
			ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			ID_LAVORAZIONE NUMBER(20) NOT NULL,
			shape mdsys.sdo_geometry
			) TABLESPACE ${tablespace.data} ;

			ALTER TABLE
			A4ST_AREA_DI_LAVORO ADD CONSTRAINT A4ST_AREA_DI_LAVORO_pk PRIMARY KEY
			( id );
			ALTER TABLE A4ST_AREA_DI_LAVORO ADD CONSTRAINT
			A4ST_AREA_DI_LAVORO_FK FOREIGN KEY ( ID_LAVORAZIONE ) REFERENCES
			a4st_lavorazione_suolo ( id ) NOT DEFERRABLE;

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_AREA_DI_LAVORO TO ${user.writer};
		</sql>

		<sql endDelimiter=";" splitStatements="true">
			Insert into
			user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4ST_AREA_DI_LAVORO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');

			CREATE INDEX A4ST_AREA_DI_LAVORO_SPIDX ON A4ST_AREA_DI_LAVORO (SHAPE)
			INDEXTYPE IS "MDSYS"."SPATIAL_INDEX" PARAMETERS
			('tablespace=${tablespace.index}');
		</sql>
	</changeSet>


	<!-- Create view A4SV_AREA_DI_LAVORO -->
	<changeSet id="ISTANZARIESAME_S28.02" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			create or replace view
			A4SV_AREA_DI_LAVORO as (
			select id,
			id_lavorazione,
			shape from
			A4ST_AREA_DI_LAVORO);

			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_AREA_DI_LAVORO','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;

		</sql>
	</changeSet>

	<!-- Create grant A4SV_AREA_DI_LAVORO -->
	<changeSet id="ISTANZARIESAME_S28.03" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			GRANT SELECT on A4SV_AREA_DI_LAVORO to ${user.writer};
		</sql>
	</changeSet>


	<!--changeSet per inserimento layer Ortofoto2020 -->
	<changeSet id="ISTANZARIESAME_S28.04" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE) values
			(nxtnbr.nextval,'1','A4SV_AREA_DI_LAVORO2','/proxy/geoserver','/app_a4s','AreaDilavoro');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'VITICOLO');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'titolo','Area Di lavoro');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'cancellabile','no');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice = 'AreaDilavoro'),'posizione','10');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'Ispezionabile','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'AbilitatoDefault','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'formato','wfs');

			commit;
		</sql>
	</changeSet>

	<!--changeSet per inserimento layer Ortofoto2020 -->
	<changeSet id="ISTANZARIESAME_S28.05" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'contesto','LavorazioneEditing');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'campoFiltro','ID_LAVORAZIONE');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'tematismoBordoColore','rgba(0,0,255,1)');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'gruppo','Lavorazione');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'Ispezionabile','no');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'CONTENUTO_INFORMATIVO','AREA_DI_LAVORO');
			commit;
		</sql>
	</changeSet>

	<!-- Create view A4SV_AREA_DI_LAVORO -->
	<changeSet id="ISTANZARIESAME_S28.06" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			drop view
			A4SV_AREA_DI_LAVORO;

			delete
			from user_sdo_geom_metadata
			where table_name='A4SV_AREA_DI_LAVORO';

			create or replace view A4SV_AREA_DI_LAVORO_LAYER as (
			select id,
			id_lavorazione,
			shape from A4ST_AREA_DI_LAVORO);


			Insert into
			user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_AREA_DI_LAVORO_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;

		</sql>
		<sql endDelimiter=";" splitStatements="true">
			GRANT SELECT on
			A4SV_AREA_DI_LAVORO_LAYER to ${user.writer};
		</sql>

		<sql endDelimiter=";" splitStatements="true">
			update A4ST_LAYER set
			NOME_LAYER='A4SV_AREA_DI_LAVORO_LAYER2' where codice =
			'AreaDilavoro';

			update A4ST_PROPRIETA_LAYER set VALORE='si' where id_layer=(select id from
			a4st_layer where codice = 'AreaDilavoro')
			and nome='AbilitatoDefault';

		</sql>

	</changeSet>

	<!-- Layer switcher backoffice -->
	<changeSet id="ISTANZARIESAME_S28.07" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			update a4st_proprieta_layer
			set valore='ortofoto AGEA 2017 RGB'
			where nome='titolo'
			and
			id_layer=(select id from a4st_layer where codice = 'ortofoto');

			update a4st_proprieta_layer set valore='ortofoto AGEA 2020 RGB'
			where
			nome='titolo'
			and id_layer=(select id from a4st_layer where codice =
			'ortofoto2020');

			update a4st_proprieta_layer set valore='Suoli in Lavorazione'
			where
			nome='titolo'
			and id_layer=(select id from a4st_layer where codice =
			'workspaceBO');

			update a4st_proprieta_layer set valore='no'
			where nome='AbilitatoDefault'
			and id_layer=(select id from a4st_layer where codice =
			'suoloVigenteBO');

			update a4st_proprieta_layer set valore='no'
			where nome='AbilitatoDefault'
			and id_layer=(select id from a4st_layer where codice =
			'suoloVigenteInclusoInLavorazioniBO');

			update a4st_proprieta_layer set valore='no'
			where nome='AbilitatoDefault'
			and id_layer=(select id from a4st_layer where codice =
			'suoloDichiaratoBO');

		</sql>


	</changeSet>

	<!-- Layer switcher backoffice -->
	<changeSet id="ISTANZARIESAME_S28.08" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			update a4st_proprieta_layer
			set valore='Ortofoto AGEA 2017 RGB'
			where nome='titolo'
			and
			id_layer=(select id from a4st_layer where codice = 'ortofoto');

			update a4st_proprieta_layer set valore='Ortofoto AGEA 2020 RGB'
			where
			nome='titolo'
			and id_layer=(select id from a4st_layer where codice =
			'ortofoto2020');

			update a4st_proprieta_layer set valore='Suolo in
			lavorazione'
			where nome='titolo'
			and id_layer=(select id from
			a4st_layer where codice = 'workspaceBO');

			update a4st_proprieta_layer
			set valore='Suolo Vigente occupato'
			where nome='titolo'
			and
			id_layer=(select id from a4st_layer where codice =
			'suoloVigenteInclusoInLavorazioniBO');

			update a4st_proprieta_layer set
			valore='Confine Area di lavoro'
			where nome='titolo'
			and
			id_layer=(select id from a4st_layer where codice = 'AreaDilavoro');


			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','Comuni_catastali','/proxy/geoserver','/pub_catasto','ComuniCatastali');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice = 'ComuniCatastali'),'BACKOFFICE');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice = 'ComuniCatastali'),'VITICOLO');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'CAA');

			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select
			id from a4st_layer where codice = 'ComuniCatastali'),'titolo','Comuni
			catastali');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'cancellabile','no');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'posizione','160');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'Ispezionabile','no');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'AbilitatoDefault','no');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'formato','wms');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'gruppo','Catasto');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'collassaGruppo','si');
			commit;
		</sql>

	</changeSet>

	<!--changeSet per creare tabella A4ST_TMP_WORKSPACE -->
	<changeSet id="ISTANZARIESAME_S29.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">

			create table A4ST_TMP_WORKSPACE
			as select * from a4st_workspace_lav_suolo
			where 2=1;


			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4ST_TMP_WORKSPACE','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
	</changeSet>

	<!-- Create view A4SV_TMP_WORKSPACE_LAYER -->
	<changeSet id="ISTANZARIESAME_S29.02" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">


			create or replace view A4SV_TMP_WORKSPACE_LAYER as (
			select * from
			A4ST_TMP_WORKSPACE);


			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_TMP_WORKSPACE_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;

		</sql>
		<sql endDelimiter=";" splitStatements="true">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_TMP_WORKSPACE TO ${user.writer};

			GRANT SELECT on A4SV_TMP_WORKSPACE_LAYER to ${user.writer};
		</sql>


	</changeSet>

	<!-- drop and create constraint A4ST_AREA_DI_LAVORO -->
	<changeSet id="ISTANZARIESAME_S29.03" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_AREA_DI_LAVORO DROP CONSTRAINT A4ST_AREA_DI_LAVORO_FK;


			ALTER TABLE A4ST_AREA_DI_LAVORO ADD CONSTRAINT A4ST_AREA_DI_LAVORO_FK
			FOREIGN KEY (ID_LAVORAZIONE)
			REFERENCES A4ST_LAVORAZIONE_SUOLO ( ID ) ON DELETE CASCADE;
		</sql>


	</changeSet>

	<!-- Modifica proprieta layer BO -->
	<changeSet id="ISTANZARIESAME_S29.04" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer
			set valore = 'si'
			where id_layer = (select id
			from a4st_layer where codice = 'suoloVigenteInclusoInLavorazioniBO')
			and nome = 'AbilitatoDefault';

			update a4st_proprieta_layer
			set valore = 'si'
			where id_layer = (select id
			from a4st_layer where codice = 'suoloDichiaratoBO')
			and nome =
			'AbilitatoDefault';

			update a4st_proprieta_layer
			set valore = 'si'
			where id_layer = (select id
			from a4st_layer where codice = 'ComuniCatastali')
			and nome =
			'cancellabile';

			update a4st_proprieta_layer
			set valore = '150'
			where id_layer = (select id
			from a4st_layer where codice = 'ComuniCatastali')
			and nome =
			'posizione';

			update a4st_proprieta_layer
			set valore = '160'
			where id_layer = (select id
			from a4st_layer where codice = 'particelleCatastali')
			and nome =
			'posizione';

			commit;
		</sql>
	</changeSet>


	<!-- Modifica proprieta layer BO -->
	<changeSet id="ISTANZARIESAME_S29.05" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'workspaceBO'),'NOME_LAYER_TMP','A4SV_TMP_WORKSPACE_LAYER2');

			commit;
		</sql>
	</changeSet>

	<!-- Aggiunta proprieta FORMATO_IMMAGINE a tutti i layer WMS -->
	<changeSet id="ISTANZARIESAME_S29.06" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofoto'), 'FORMATO_IMMAGINE',
			'image/jpeg');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofoto2020'), 'FORMATO_IMMAGINE', 'image/jpeg');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'suoloVigenteCAA'), 'FORMATO_IMMAGINE',
			'image/png8');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'suoloVigenteBO'), 'FORMATO_IMMAGINE', 'image/png8');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'suoloRilevatoCAA'), 'FORMATO_IMMAGINE',
			'image/png8');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'suoloRilevatoBO'), 'FORMATO_IMMAGINE', 'image/png8');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'suoloDichiaratoCAA'), 'FORMATO_IMMAGINE',
			'image/png8');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'suoloDichiaratoBO'), 'FORMATO_IMMAGINE', 'image/png8');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'particelleCatastali'), 'FORMATO_IMMAGINE',
			'image/png8');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'comuniAmministrativiTN'), 'FORMATO_IMMAGINE', 'image/png8');
			INSERT
			INTO A4ST_PROPRIETA_LAYER VALUES (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'suoloVigenteInclusoInLavorazioniBO'),
			'FORMATO_IMMAGINE', 'image/png8');
			INSERT INTO A4ST_PROPRIETA_LAYER
			VALUES (nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ComuniCatastali'), 'FORMATO_IMMAGINE', 'image/png8');

			commit;
		</sql>
	</changeSet>


	<!-- Aggiunta proprieta ATTRIBUTION su Layer Ortofoto 2020 -->
	<changeSet id="ISTANZARIESAME_S29.07" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofoto2020'), 'ATTRIBUTION', 'Ortofoto
			2020 - © AGEA - Agenzia per le Erogazioni in Agricotura, Roma
			(www.agea.gov.it)');
			commit;
		</sql>
	</changeSet>

	<!-- Aggiunta proprieta ATTRIBUTION su Layer Ortofoto 2017 -->
	<changeSet id="ISTANZARIESAME_S29.08" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofoto'), 'ATTRIBUTION', 'Ortofoto 2017
			- © AGEA - AGenzia per le Erogazioni in Agricoltura, Roma
			(www.agea.gov.it)');
			commit;
		</sql>
	</changeSet>


	<!-- Creazione layer ISTANZA_DI_RIESAME -->
	<changeSet id="ISTANZARIESAME_S29.09" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_ISTANZA_DI_RIESAME_LAYER AS
			SELECT
			d.id as id,
			r.id as id_richiesta,
			d.id_lavorazione as id_lavorazione,
			r.stato as stato,
			r.cuaa as cuaa,
			r.azienda as azienda,
			r.campagna as campagna,
			d.shape as shape,
			d.area_ori as AREA_DICH,
			d.codi_rile_dichiarato as DICH,
			v.desc_rile as DESCRIZIONE,
			sr.area as AREA,
			sr.codi_rile_rilevato as RILE,
			vr.desc_rile AS DESCRIZIONE_RILE,
			sc.nome_comune AS COMUNE_O_TAVOLA_PREV,
			d.cod_sezione as CNAZ_PREVALENTE
			FROM
			a4st_richiesta_modifica_suolo r
			INNER JOIN a4st_suolo_dichiarato d ON r.id = d.id_richiesta
			LEFT JOIN a4sd_codi_rile_pcg v ON v.codi_rile = d.codi_rile_dichiarato
			AND v.codi_prod_rile = d.codi_prod_rile_dichiarato
			LEFT JOIN a4sr_supporto_tag_tipo_suolo st ON st.id_suolo_dichiarato =
			d.id
			LEFT JOIN a4st_suolo_rilevato sr ON sr.id = st.id_suolo_rilevato
			LEFT JOIN a4sd_codi_rile_pcg vr ON vr.codi_rile = sr.codi_rile_rilevato
			AND vr.codi_prod_rile = sr.codi_prod_rile_rilevato
			LEFT JOIN a4st_lavorazione_suolo lavorazione ON lavorazione.id =
			d.id_lavorazione
			LEFT JOIN siticomu sc ON sc.cod_nazionale = d.cod_sezione
			WHERE
			NOT(d.codi_rile_dichiarato = sr.codi_rile_rilevato AND
			d.codi_prod_rile_dichiarato = sr.codi_prod_rile_rilevato) AND
			d.codi_rile_dichiarato != sr.codi_rile_rilevato and
			r.stato != ( 'CHIUSA' );


			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_ISTANZA_DI_RIESAME_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SV_ISTANZA_DI_RIESAME_LAYER TO
			${user.writer};

			GRANT SELECT on A4SV_ISTANZA_DI_RIESAME_LAYER to ${user.writer};
		</sql>
	</changeSet>

	<!-- Creazione layer ISTANZA_DI_RIESAME -->
	<changeSet id="ISTANZARIESAME_S29.10" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','A4SV_ISTANZA_DI_RIESAME_LAYER2','/proxy/geoserver','/app_a4s','IstanzaDiRiesameCAA');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'CAA');


			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'titolo','Istanza di riesame');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'cancellabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'posizione','500');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'Ispezionabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'AbilitatoDefault','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'formato','wms');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'gruppo','Richiesta Modifica Suolo');
			Insert
			into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'collassaGruppo','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'CONTENUTO_INFORMATIVO','ISTANZA_DI_RIESAME');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'FORMATO_IMMAGINE','image/png8');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'TIPO_WMS','Tile');




			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','A4SV_ISTANZA_DI_RIESAME_LAYER2','/proxy/geoserver','/app_a4s','IstanzaDiRiesameBO');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'VITICOLO');


			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'titolo','Istanza di riesame');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'cancellabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'posizione','500');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'Ispezionabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'AbilitatoDefault','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'formato','wms');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'gruppo','Richiesta Modifica Suolo');
			Insert
			into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'collassaGruppo','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'CONTENUTO_INFORMATIVO','ISTANZA_DI_RIESAME');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'FORMATO_IMMAGINE','image/png8');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'TIPO_WMS','Tile');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'style','A4SV_ISTANZA_DI_RIESAME_BasicStyle');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'PARAMS_FILTER','STATO IN
			(''IN_LAVORAZIONE'',''LAVORABILE'')');




			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','A4SV_ISTANZA_DI_RIESAME_LAYER2','/proxy/geoserver','/app_a4s','IstanzaDiRiesameLavBO');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'VITICOLO');


			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'titolo','Istanza di riesame');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'cancellabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'posizione','200');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'Ispezionabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'AbilitatoDefault','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'formato','wfs');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'gruppo','Lavorazione');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'collassaGruppo','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'tematismoLabel','DICH');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'tematismoBordoColore','rgba(81,186,232,1)');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'CONTENUTO_INFORMATIVO','ISTANZA_DI_RIESAME');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'contesto','LavorazioneEditing');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'campoFiltro','ID_LAVORAZIONE');

		</sql>
	</changeSet>

	<!-- delete layer suoloRilevato -->
	<changeSet id="ISTANZARIESAME_S29.11" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			delete from a4st_proprieta_layer where id_layer in ( select id from
			a4st_layer where codice in ('suoloRilevatoBO','suoloRilevatoCAA'));
			delete from a4sr_layer_profilo where id_layer in (select id from
			a4st_layer where codice in ('suoloRilevatoBO','suoloRilevatoCAA'));
			delete from a4st_layer where codice in
			('suoloRilevatoBO','suoloRilevatoCAA');
		</sql>

	</changeSet>


	<!-- Aggiorna layer ISTANZA_DI_RIESAME -->
	<changeSet id="ISTANZARIESAME_S29.12" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_ISTANZA_DI_RIESAME_LAYER AS
			SELECT
			d.id as id,
			r.id as id_richiesta,
			d.id_lavorazione as id_lavorazione,
			r.stato as stato,
			r.cuaa as cuaa,
			r.azienda as azienda,
			r.campagna as campagna,
			d.shape as shape,
			d.area_ori as AREA_DICH,
			d.codi_rile_dichiarato as DICH,
			v.desc_rile as DESCRIZIONE,
			sr.area as AREA,
			sr.codi_rile_rilevato as RILE,
			vr.desc_rile AS DESCRIZIONE_RILE,
			sc.nome_comune AS COMUNE_O_TAVOLA_PREV,
			d.cod_sezione as CNAZ_PREVALENTE
			FROM
			a4st_richiesta_modifica_suolo r
			INNER JOIN a4st_suolo_dichiarato d ON r.id = d.id_richiesta
			LEFT JOIN a4sd_codi_rile_pcg v ON v.codi_rile = d.codi_rile_dichiarato
			AND v.codi_prod_rile = d.codi_prod_rile_dichiarato
			LEFT JOIN a4sr_supporto_tag_tipo_suolo st ON st.id_suolo_dichiarato =
			d.id
			LEFT JOIN a4st_suolo_rilevato sr ON sr.id = st.id_suolo_rilevato
			LEFT JOIN a4sd_codi_rile_pcg vr ON vr.codi_rile = sr.codi_rile_rilevato
			AND vr.codi_prod_rile = sr.codi_prod_rile_rilevato
			LEFT JOIN a4st_lavorazione_suolo lavorazione ON lavorazione.id =
			d.id_lavorazione
			LEFT JOIN siticomu sc ON sc.cod_nazionale = d.cod_sezione
			WHERE NOT (d.codi_rile_dichiarato = sr.codi_rile_rilevato AND
			d.codi_prod_rile_dichiarato = sr.codi_prod_rile_rilevato)
			AND r.stato != ( 'CHIUSA' );
		</sql>

	</changeSet>

	<!-- delete layer suoloDichiarato -->
	<changeSet id="ISTANZARIESAME_S29.13" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			delete from a4st_proprieta_layer where id_layer in ( select id from
			a4st_layer where codice in
			('suoloDichiaratoBO','suoloDichiaratoCAA','suoloDichiaratoLavBO'));
			delete from a4sr_layer_profilo where id_layer in (select id from
			a4st_layer where codice in
			('suoloDichiaratoBO','suoloDichiaratoCAA','suoloDichiaratoLavBO'));
			delete from a4st_layer where codice in
			('suoloDichiaratoBO','suoloDichiaratoCAA','suoloDichiaratoLavBO');
		</sql>
	</changeSet>

	<!-- Aggiornamento Posizione Layer -->
	<changeSet id="ISTANZARIESAME_S29.14" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer p set valore='10' where nome ='posizione' and
			p.id_layer = (select id from a4st_layer where codice='ortofoto');
			update a4st_proprieta_layer p set valore='20' where nome ='posizione'
			and p.id_layer = (select id from a4st_layer where
			codice='ortofoto2020');
			update a4st_proprieta_layer p set valore='320'
			where nome ='posizione' and p.id_layer = (select id from a4st_layer
			where codice='AreaDilavoro');
			update a4st_proprieta_layer p set
			valore='310' where nome ='posizione' and p.id_layer = (select id from
			a4st_layer where codice='workspaceBO');
			update a4st_proprieta_layer p
			set valore='110' where nome ='posizione' and p.id_layer = (select id
			from a4st_layer where codice='suoloVigenteBO');
			update
			a4st_proprieta_layer p set valore='120' where nome ='posizione' and
			p.id_layer = (select id from a4st_layer where
			codice='suoloVigenteInclusoInLavorazioniBO');
			update
			a4st_proprieta_layer p set valore='330' where nome ='posizione' and
			p.id_layer = (select id from a4st_layer where
			codice='anomalieValidazioneBO');
			update a4st_proprieta_layer p set
			valore='210' where nome ='posizione' and p.id_layer = (select id from
			a4st_layer where codice='comuniAmministrativiTN');
			update
			a4st_proprieta_layer p set valore='220' where nome ='posizione' and
			p.id_layer = (select id from a4st_layer where
			codice='ComuniCatastali');
			update a4st_proprieta_layer p set
			valore='230' where nome ='posizione' and p.id_layer = (select id from
			a4st_layer where codice='particelleCatastali');
			update
			a4st_proprieta_layer p set valore='340' where nome ='posizione' and
			p.id_layer = (select id from a4st_layer where
			codice='IstanzaDiRiesameLavBO');
			update a4st_proprieta_layer p set
			valore='410' where nome ='posizione' and p.id_layer = (select id from
			a4st_layer where codice='IstanzaDiRiesameBO');
			update
			a4st_proprieta_layer p set valore='410' where nome ='posizione' and
			p.id_layer = (select id from a4st_layer where
			codice='IstanzaDiRiesameCAA');


		</sql>
	</changeSet>

	<!-- Add esito -->
	<changeSet id="ISTANZARIESAME_S29.15" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_ISTANZA_DI_RIESAME_LAYER as
			SELECT
			d.id AS id,
			r.id AS id_richiesta,
			d.id_lavorazione AS id_lavorazione,
			r.stato AS stato,
			r.cuaa AS cuaa,
			r.azienda AS azienda,
			r.campagna AS campagna,
			d.shape AS shape,
			d.area_ori AS area_dich,
			d.codi_rile_dichiarato AS dich,
			v.desc_rile AS descrizione,
			sr.area AS area,
			sr.codi_rile_rilevato AS rile,
			vr.desc_rile AS descrizione_rile,
			sc.nome_comune AS comune_o_tavola_prev,
			d.cod_sezione AS cnaz_prevalente,
			d.esito AS ESITO
			FROM
			a4st_richiesta_modifica_suolo r
			INNER JOIN a4st_suolo_dichiarato d ON r.id = d.id_richiesta
			LEFT JOIN a4sd_codi_rile_pcg v ON v.codi_rile = d.codi_rile_dichiarato
			AND v.codi_prod_rile = d.codi_prod_rile_dichiarato
			LEFT JOIN a4sr_supporto_tag_tipo_suolo st ON st.id_suolo_dichiarato =
			d.id
			LEFT JOIN a4st_suolo_rilevato sr ON sr.id = st.id_suolo_rilevato
			LEFT JOIN a4sd_codi_rile_pcg vr ON vr.codi_rile = sr.codi_rile_rilevato
			AND vr.codi_prod_rile = sr.codi_prod_rile_rilevato
			LEFT JOIN a4st_lavorazione_suolo lavorazione ON lavorazione.id =
			d.id_lavorazione
			LEFT JOIN siticomu sc ON sc.cod_nazionale = d.cod_sezione
			WHERE
			NOT ( d.codi_rile_dichiarato = sr.codi_rile_rilevato
			AND d.codi_prod_rile_dichiarato = sr.codi_prod_rile_rilevato )
			AND r.stato != ( 'CHIUSA' );
		</sql>
	</changeSet>

	<!-- Add esito -->
	<changeSet id="ISTANZARIESAME_S30.01" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			create or replace view A4SV_SUOLO_PRENOTATO_LAV_LAYER as
			select *
			from
			a4st_suolo;


			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_SUOLO_PRENOTATO_LAV_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SV_SUOLO_PRENOTATO_LAV_LAYER TO
			${user.writer};

			GRANT SELECT on A4SV_SUOLO_PRENOTATO_LAV_LAYER to ${user.writer};
		</sql>
	</changeSet>


	<!-- Creazione layer suolo prenotato -->
	<changeSet id="ISTANZARIESAME_S30.02" author="Marco Campisi">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','A4SV_SUOLO_PRENOTATO_LAV_LAYER2','/proxy/geoserver','/app_a4s','SuoloPrenotatoLavBO');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'VITICOLO');


			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'titolo','Suolo prenotato lavorazione');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'cancellabile','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'posizione','350');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'Ispezionabile','no');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'AbilitatoDefault','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'formato','wfs');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'gruppo','Lavorazione');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'collassaGruppo','no');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'tematismoBordoColore','rgb(116, 51, 255,
			1)');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'CONTENUTO_INFORMATIVO','SUOLO_PRENOTATO_LAVORAZIONE');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'contesto','LavorazioneEditing');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'campoFiltro','ID_LAVORAZIONE_IN_CORSO ');
		</sql>
	</changeSet>
	<changeSet id="ISTANZARIESAME_S32.01" author="Bettina Irler">
		<sql>
			ALTER TABLE A4ST_LAVORAZIONE_SUOLO ADD UTENTE_AGS VARCHAR2(100);
		</sql>
	</changeSet>
	<changeSet id="ISTANZARIESAME_S32.02" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_ISTANZA_DI_RIESAME_LAYER ("ID", "ID_RICHIESTA",
			"ID_LAVORAZIONE", "STATO", "CUAA", "AZIENDA", "CAMPAGNA", "SHAPE",
			"AREA_DICH", "DICH", "DESCRIZIONE", "AREA", "RILE",
			"DESCRIZIONE_RILE", "COMUNE_O_TAVOLA_PREV", "CNAZ_PREVALENTE",
			"ESITO") AS
			SELECT
			d.id AS id,
			r.id AS id_richiesta,
			d.id_lavorazione AS id_lavorazione,
			r.stato AS stato,
			r.cuaa AS cuaa,
			r.azienda AS azienda,
			r.campagna AS campagna,
			d.shape AS shape,
			d.area_ori AS area_dich,
			v.codi_rile_prevalente AS dich,
			v.desc_rile_prevalente AS descrizione,
			sr.area AS area,
			vr.codi_rile_prevalente AS rile,
			vr.desc_rile AS descrizione_rile,
			sc.nome_comune AS comune_o_tavola_prev,
			d.cod_sezione AS cnaz_prevalente,
			d.esito AS ESITO
			FROM
			a4st_richiesta_modifica_suolo r
			INNER JOIN a4st_suolo_dichiarato d ON r.id = d.id_richiesta
			LEFT JOIN a4sd_codi_rile_pcg v ON v.codi_rile = d.codi_rile_dichiarato
			AND v.codi_prod_rile = d.codi_prod_rile_dichiarato
			LEFT JOIN a4sr_supporto_tag_tipo_suolo st ON st.id_suolo_dichiarato =
			d.id
			LEFT JOIN a4st_suolo_rilevato sr ON sr.id = st.id_suolo_rilevato
			LEFT JOIN a4sd_codi_rile_pcg vr ON vr.codi_rile = sr.codi_rile_rilevato
			AND vr.codi_prod_rile = sr.codi_prod_rile_rilevato
			LEFT JOIN a4st_lavorazione_suolo lavorazione ON lavorazione.id =
			d.id_lavorazione
			LEFT JOIN siticomu sc ON sc.cod_nazionale = d.cod_sezione;
		</sql>
		<sql endDelimiter=";" splitStatements="true">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SV_ISTANZA_DI_RIESAME_LAYER TO
			${user.writer};

			GRANT SELECT on A4SV_ISTANZA_DI_RIESAME_LAYER to ${user.writer};
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S32.03" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			delete from A4ST_PROPRIETA_LAYER where ID_LAYER = (select ID from
			a4st_layer where codice = 'IstanzaDiRiesameBO') and nome =
			'PARAMS_FILTER';
			update A4ST_PROPRIETA_LAYER set valore =
			'A4SV_ISTANZA_DI_RIESAME_BO_Style' where ID_LAYER = (select ID from
			a4st_layer where codice = 'IstanzaDiRiesameBO') and nome = 'style';
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S32.04" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			update A4ST_PROPRIETA_LAYER set valore = 'si' where ID_LAYER = (select ID
			from a4st_layer where codice = 'ComuniCatastali') and nome =
			'Ispezionabile' ;
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S32.05" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'suoloVigenteCAA'),
			'CAMPO_IDENTIFY','USO_SUOLO_DES');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S32.06" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			A4ST_TEMP_ISTANZE_APERTE
			( CAMPAGNA ${string.type}(200),
			ID_ISTANZA_RIESAME NUMBER,
			CUAA ${string.type}(100),
			AZIENDA ${string.type}(100),
			UTENTE ${string.type}(100),
			DATA_RICHIESTA DATE,
			ID_ISOL NUMBER,
			COD_ISOL ${string.type}(30),
			COD_SEZIONE ${string.type}(10),
			ID_SUOL_GIS NUMBER,
			COD_USO_DICHIARATO ${string.type}(100),
			COD_VARIETA_DICHIARATO ${string.type}(100),
			ID_SUOL_GIS_RILEV NUMBER,
			UPAS_DICHIARATO ${string.type}(200),
			AREA NUMBER(20,6),
			IMPORTATO NUMBER,
			SHAPE MDSYS.SDO_GEOMETRY ,
			AREA_ORI NUMBER(20,6)
			)
			TABLESPACE ${tablespace.data}
			VARRAY SHAPE.SDO_ELEM_INFO STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob})
			VARRAY SHAPE.SDO_ORDINATES STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob});

			CREATE TABLE A4ST_TEMP_ISTANZE_RIES_RILEV
			( ID_ISTANZA_RIESAME NUMBER,
			ID_ISOL NUMBER,
			ID_SUOL_GIS NUMBER,
			COD_USO_RILEV ${string.type}(3),
			COD_VARIETA_RILEV ${string.type}(3),
			AREA NUMBER(20,6),
			SHAPE MDSYS.SDO_GEOMETRY
			) TABLESPACE ${tablespace.data}
			VARRAY SHAPE.SDO_ELEM_INFO STORE AS
			SECUREFILE LOB
			( TABLESPACE ${tablespace.lob})
			VARRAY SHAPE.SDO_ORDINATES STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob});
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_TEMP_ISTANZE_APERTE TO
			${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON
			A4ST_TEMP_ISTANZE_RIES_RILEV TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet definizione tabella a4sr_job_fme_lavorazione -->
	<changeSet id="ISTANZARIESAME_S33.01" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">

			CREATE TABLE
			A4SR_JOB_FME_LAVORAZIONE (
			id ${id.number.type} NOT NULL,
			versione
			${version.number.type} NOT NULL,
			id_lavorazione ${id.number.type} NOT
			NULL,
			id_job_fme NUMBER(10) NOT NULL,
			tipo_job_fme ${string.type}(50)
			NOT NULL,
			data_inizio_esecuzione DATE NOT NULL
			)
			TABLESPACE
			${tablespace.lob};

			ALTER TABLE a4sr_job_fme_lavorazione ADD CONSTRAINT
			a4sr_job_lav_pk PRIMARY KEY ( id );
			ALTER TABLE
			a4sr_job_fme_lavorazione ADD CONSTRAINT a4sr_job_lav_fk FOREIGN KEY (
			id_lavorazione ) REFERENCES a4st_lavorazione_suolo ( id );
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON a4sr_job_fme_lavorazione TO
			${user.writer};
		</sql>
	</changeSet>


	<!--changeSet rimozione not null enable a4sr_job_fme_lavorazione.data_inizio_esecuzione -->
	<changeSet id="ISTANZARIESAME_S33.02" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			a4sr_job_fme_lavorazione MODIFY DATA_INIZIO_ESECUZIONE null;
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S33.03" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4SR_TIPO_SUOLO_CODI
			( ID ${id.number.type} NOT NULL,
			TIPO_SUOLO_DICHIARATO ${string.type}(10),
			CODI ${string.type}(3),
			TIPO_SUOLO_RILEVATO ${string.type}(10)
			) TABLESPACE ${tablespace.data};

			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('1','FAG','491','FAG');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('2','FAG','492','FAG');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('3','FAG','493','FAG');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('4','FAG','494','FAG');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('5','FAG','495','FAG');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('6','FAG','497','FAG');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('7','FRU','557','FRU');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('8','FRU','651','FRU');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('9','FRU','681','FRU');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('10','FRU','413','FRU');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('11','FRU','430','FRU');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('12','FRU','500','FRU');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('13','FRU','550','FRU');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('14','FRU','685','FRU');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('15','OLE','420','OLE');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('16','VIT','410','VIT');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('17','PAS','638','PAS');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('18','PAS','659','PAS');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('19','PAS','654','PAS');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('20','PAS','657','PAS');
			Insert into SUA4GIS01.A4SR_TIPO_SUOLO_CODI
			(ID,TIPO_SUOLO_DICHIARATO,CODI,TIPO_SUOLO_RILEVATO) values
			('21','PAS','656','PAS');

			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SR_TIPO_SUOLO_CODI TO
			${user.writer};
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.POPOLA_ISTANZE_APERTE_ANNO.xml" />

	<!-- Changeset per creazione layer catasto agricolo (tabella SITIPART di 
		AGS) -->
	<changeSet id="ISTANZARIESAME_S33.05" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','A4SV_SITIPART_TN2','/proxy/geoserver','/app_a4s','AgsSitipartTN');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'VITICOLO');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'CAA');


			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'titolo','Catasto Agricolo');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'cancellabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'posizione',(select to_char(max(to_number(valore)) +
			10) as valore from a4st_proprieta_layer where nome = 'posizione' and
			id_layer in (select id_layer from a4st_proprieta_layer where nome =
			'gruppo' and valore = 'Catasto')));
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice =
			'AgsSitipartTN'),'Ispezionabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'AbilitatoDefault','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'formato','wms');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice =
			'AgsSitipartTN'),'gruppo','Catasto');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice =
			'AgsSitipartTN'),'collassaGruppo','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'FORMATO_IMMAGINE','image/png8');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'TIPO_WMS','Tile');

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S33.06" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'TEMATISMOBORDOSPESSORE','3.5');

			update A4ST_PROPRIETA_LAYER set valore = 310 where nome = 'posizione' and
			id_layer = (select id from a4st_layer where codice = 'AreaDilavoro');
			update A4ST_PROPRIETA_LAYER set valore = 320 where nome = 'posizione'
			and id_layer = (select id from a4st_layer where codice =
			'workspaceBO');

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S34.01" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">

			update a4st_proprieta_layer set valore = 'rgba(255,255,0,1)' where id_layer
			= (select id from a4st_layer where codice = 'IstanzaDiRiesameLavBO')
			and nome = 'tematismoBordoColore';

			commit;
		</sql>
	</changeSet>


	<!-- Inserimento metadati spaziali per tabelle temporanee di importazione 
		istanze di riesame -->
	<changeSet id="ISTANZARIESAME_S34.02" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			Insert into USER_SDO_GEOM_METADATA (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4ST_TEMP_ISTANZE_APERTE','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			-180, 180, 0.05), MDSYS.SDO_DIM_ELEMENT('Y', -90, 90,
			0.05)),'25832');
			Insert into USER_SDO_GEOM_METADATA
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4ST_TEMP_ISTANZE_RIES_RILEV','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			-180, 180, 0.05), MDSYS.SDO_DIM_ELEMENT('Y', -90, 90,
			0.05)),'25832');

			COMMIT;
		</sql>
	</changeSet>

	<!-- Rimozione layer SITIPART AGS -->
	<changeSet id="ISTANZARIESAME_S34.03" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			DELETE FROM A4ST_PROPRIETA_LAYER
			WHERE ID_LAYER = (SELECT ID FROM A4ST_LAYER
			where CODICE = 'AgsSitipartTN');

			DELETE FROM A4SR_LAYER_PROFILO
			WHERE ID_LAYER = (SELECT ID FROM A4ST_LAYER
			where CODICE = 'AgsSitipartTN');

			DELETE FROM A4ST_LAYER WHERE CODICE = 'AgsSitipartTN';
			COMMIT;
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.SDO_CUSTOM_2.xml" />

	<!-- changeSet definizione tabella a4st_sync_suolo_catasto -->
	<changeSet id="ISTANZARIESAME_S35.01" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">

			CREATE TABLE
			A4ST_SYNC_SUOLO_CATASTO (
			data_ultima_esecuzione DATE NOT NULL,
			esito
			${string.type}(2),
			msg ${string.type}(100)
			)
			TABLESPACE
			${tablespace.lob};
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_SYNC_SUOLO_CATASTO TO
			${user.writer};
		</sql>
	</changeSet>

	<!-- changeSet definizione tabella a4st_sync_suolo_esito_part -->
	<changeSet id="ISTANZARIESAME_S35.02" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">

			CREATE TABLE
			A4ST_SYNC_SUOLO_ESITO_PART (
			cod_nazionale ${string.type}(4 BYTE),
			foglio NUMBER(4,0) DEFAULT 9999,
			particella CHAR(5 BYTE) NOT NULL,
			sub
			VARCHAR2(3 BYTE) NOT NULL,
			id_particella CHAR(5 BYTE) NOT NULL,
			data_ultimo_agg_particella DATE NOT NULL,
			esito ${string.type}(2),
			data_ultimo_tentativo DATE
			)
			TABLESPACE ${tablespace.lob};
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_SYNC_SUOLO_ESITO_PART TO
			${user.writer};
		</sql>
	</changeSet>


	<!-- changeSet fix tipo id_particella -->
	<changeSet id="ISTANZARIESAME_S35.03" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">

			ALTER TABLE A4ST_SYNC_SUOLO_ESITO_PART MODIFY id_particella NUMBER(9,0);

		</sql>
	</changeSet>

	<!-- changeSet inserito primo record in A4ST_SYNC_SUOLO_CATASTO -->
	<changeSet id="ISTANZARIESAME_S36.01_fix"
		author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">

			delete from A4ST_SYNC_SUOLO_ESITO_PART;
			delete from A4ST_SYNC_SUOLO_CATASTO;
			commit;
			Insert into A4ST_SYNC_SUOLO_CATASTO (DATA_ULTIMA_ESECUZIONE,ESITO,MSG)
			values (to_date('20-01-2022 10:00','DD-MM-YYYY Hh24:mi'),'OK',null);
			commit;

		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_2.xml" />

	<changeSet id="ISTANZARIESAME_S36.03_fix"
		author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer
			set valore = 'no'
			where id_layer= (
			select id
			from a4st_layer
			where
			codice = 'suoloVigenteCAA')
			and nome = 'AbilitatoDefault';

			commit;
		</sql>
	</changeSet>

	<!-- Abilitazione snap su layer Lavorazione -->
	<changeSet id="ISTANZARIESAME_S36.04_fix"
		author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'workspaceBO'),'snap','si');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'anomalieValidazioneBO'),'snap','si');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'AreaDilavoro'),'snap','si');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'snap','si');
			commit;
		</sql>
	</changeSet>

	<!-- Abilitazione snap su layer Lavorazione -->
	<changeSet id="ISTANZARIESAME_S36.05" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'suoloVigenteCAA'), 'MAX_SCALE','30000');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (SELECT
			ID FROM A4ST_LAYER WHERE CODICE = 'suoloVigenteBO'),
			'MAX_SCALE','30000');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'particelleCatastali'), 'MAX_SCALE','30000');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'suoloVigenteInclusoInLavorazioniBO'),
			'MAX_SCALE','500000');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'IstanzaDiRiesameCAA'), 'MAX_SCALE','500000');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'IstanzaDiRiesameBO'),
			'MAX_SCALE','500000');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'IstanzaDiRiesameLavBO'), 'MAX_SCALE','500000');
			commit;
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.SDO_CUSTOM_3.xml" />
	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_3.xml" />
	<include
		file="config/database/changelog/db.istanzariesame.POPOLA_ISTANZE_APERTE_ANNO_2.xml" />
	<include
		file="config/database/changelog/db.istanzariesame.FIX_RICHIESTE_CANCELLATE.changelog.xml" />

	<!-- Layer suolo aggiunto utente -->
	<changeSet id="ISTANZARIESAME_S37.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_LAYER AS
			SELECT S.ID, S.ID_GRID, S.ISTATP, S.SHAPE,
			S.AREA_COLT, S.COD_USO_SUOLO, V.DESCRIZIONE USO_SUOLO_DES,
			sc.STATO_COLT, sc.DESCRIZIONE STATO_COLT_DES, S.SORGENTE,
			S.DATA_INIZIO_VALIDITA DATA_INIZIO_VAL, ls.UTENTE, S.NOTE,
			S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO ID_LAV_IN_CORSO
			FROM A4ST_SUOLO
			S
			LEFT JOIN A4SD_USO_SUOLO V ON V.COD_USO_SUOLO = S.COD_USO_SUOLO
			LEFT JOIN A4SD_STATO_COLT sc on S.STATO_COLT = sc.id
			LEFT JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_INIZIO = ls.id
			where sysdate between S.DATA_INIZIO_VALIDITA and
			nvl(s.DATA_FINE_VALIDITA, to_date('31/12/9999','dd/mm/yyyy'));
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S37.02" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_PROPRIETA_LAYER
			SET VALORE = 'Wmts'
			WHERE ID_LAYER = (SELECT ID FROM A4ST_LAYER WHERE
			CODICE = 'ortofoto')
			AND NOME = 'TIPO_WMS';

			UPDATE A4ST_PROPRIETA_LAYER
			SET VALORE = 'Wmts'
			WHERE ID_LAYER = (SELECT ID FROM A4ST_LAYER WHERE
			CODICE = 'ortofoto2020')
			AND NOME = 'TIPO_WMS';

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S37.03" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_LAYER
			SET
			NOME_LAYER = 'agea_2020_big'
			WHERE NOME_LAYER = 'agea2020';

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S37.04" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_LAYER
			SET
			NOME_LAYER = 'agea_2017_big'
			WHERE NOME_LAYER = 'agea_2017';

			commit;
		</sql>
	</changeSet>

	<!-- Changeset per la ricreazione layer catasto agricolo (tabella SITIPART 
		di AGS) -->
	<changeSet id="ISTANZARIESAME_S37.05" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','A4SV_SITIPART_TN2','/proxy/geoserver','/app_a4s','AgsSitipartTN');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'VITICOLO');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'CAA');


			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'titolo','Catasto Agricolo');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'cancellabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'posizione',(select to_char(max(to_number(valore)) +
			10) as valore from a4st_proprieta_layer where nome = 'posizione' and
			id_layer in (select id_layer from a4st_proprieta_layer where nome =
			'gruppo' and valore = 'Catasto')));
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice =
			'AgsSitipartTN'),'Ispezionabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'AbilitatoDefault','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'formato','wms');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice =
			'AgsSitipartTN'),'gruppo','Catasto');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice =
			'AgsSitipartTN'),'collassaGruppo','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'FORMATO_IMMAGINE','image/png8');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'TIPO_WMS','Tile');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (nxtnbr.nextval,'1',(select
			id from a4st_layer where codice = 'AgsSitipartTN'),
			'MAX_SCALE','30000');

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S37.06" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_PROPRIETA_LAYER
			SET VALORE = 'ID_LAV_IN_CORSO > 1'
			WHERE ID_LAYER = (select id from a4st_layer where codice =
			'suoloVigenteInclusoInLavorazioniBO')
			AND NOME = 'PARAMS_FILTER';

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S37.07" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'), 'tematismoFillColore','rgb(116, 51, 255,
			0.2)');

			commit;
		</sql>
	</changeSet>

	<!--changeSet A4ST_WORKSPACE_LAV_SUOLO add column id_lavorazione_orig -->
	<changeSet id="ISTANZARIESAME_S38.1" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO ADD (
			id_lavorazione_orig ${id.number.type}
			);


			commit;
		</sql>
	</changeSet>

	<!--changeSet A4ST_WORKSPACE_LAV_SUOLO add column sorgente -->
	<changeSet id="ISTANZARIESAME_S38.2" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_WORKSPACE_LAV_SUOLO ADD (
			sorgente ${string.type}(50)
			);
		</sql>
	</changeSet>

	<!--changeSet sposta gouplayer istanze -->
	<changeSet id="ISTANZARIESAME_S38.3" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_PROPRIETA_LAYER SET valore = valore + 100 where valore > 400
			and nome = 'posizione';
			commit;
		</sql>
	</changeSet>


	<!--changeSet layer upas e assestato -->
	<changeSet id="ISTANZARIESAME_S38.4" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','V_UPAS_ANNO2','/proxy/geoserver','/app_a4s','AgsUpas');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'VITICOLO');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'titolo','UPAS');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'cancellabile','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'posizione',420);
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'Ispezionabile','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'AbilitatoDefault','no');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'formato','wms');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'gruppo','Schedario Pascoli');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'collassaGruppo','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'FORMATO_IMMAGINE','image/png8');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'TIPO_WMS','Tile');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'), 'MAX_SCALE','30000');
			Insert into a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'AgsUpas'), 'CAMPO_IDENTIFY','K_UPAS');

			Insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE)
			values
			(nxtnbr.nextval,'1','V_PASSESTATA_ANNO2','/proxy/geoserver','/app_a4s','AgsPAssestata');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'VITICOLO');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'titolo','Proprietà assestata');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'cancellabile','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'posizione',410);
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'Ispezionabile','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'AbilitatoDefault','no');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'formato','wms');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'gruppo','Schedario Pascoli');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'collassaGruppo','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'FORMATO_IMMAGINE','image/png8');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'TIPO_WMS','Tile');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'), 'MAX_SCALE','30000');
			Insert into a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'AgsPAssestata'), 'CAMPO_IDENTIFY','LADI_ID');

			commit;
		</sql>
	</changeSet>

	<!--changeSet A4ST_WORKSPACE_LAV_SUOLO add foreign key A4ST_LAVORAZIONE_SUOLO -->
	<changeSet id="ISTANZARIESAME_S38.5" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">

			ALTER TABLE
			a4st_workspace_lav_suolo
			ADD CONSTRAINT a4s_ws_l_suolo_orig_fk FOREIGN
			KEY (id_lavorazione_orig)
			REFERENCES A4ST_LAVORAZIONE_SUOLO (id);

			commit;
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_4.xml" />
	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_5.xml" />

	<!--changeSet layer upas e assestato -->
	<changeSet id="ISTANZARIESAME_S39.2_fix"
		author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			update A4ST_PROPRIETA_LAYER set VALORE = 'UPAS 2021' where NOME = 'titolo'
			and ID_LAYER = (select id from a4st_layer where codice = 'AgsUpas');
			update A4ST_PROPRIETA_LAYER set VALORE ='Proprietà assestata 2021'
			where NOME = 'titolo' and ID_LAYER = (select id from a4st_layer where
			codice = 'AgsPAssestata');
			commit;
		</sql>
	</changeSet>

	<!-- Layer suolo aggiunto utente -->
	<changeSet id="ISTANZARIESAME_S39.3_fix"
		author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_LAYER AS
			SELECT S.ID, S.ID_GRID, S.ISTATP, S.SHAPE,
			S.AREA_COLT, S.COD_USO_SUOLO, V.DESCRIZIONE USO_SUOLO_DES,
			sc.STATO_COLT, sc.DESCRIZIONE STATO_COLT_DES, S.SORGENTE,
			S.DATA_INIZIO_VALIDITA DATA_INIZIO_VAL, ls.UTENTE, S.NOTE,
			S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO ID_LAV_IN_CORSO
			FROM A4ST_SUOLO
			S
			LEFT JOIN A4SD_USO_SUOLO V ON V.COD_USO_SUOLO = S.COD_USO_SUOLO
			LEFT JOIN A4SD_STATO_COLT sc on S.STATO_COLT = sc.STATO_COLT
			LEFT JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_INIZIO = ls.id
			where sysdate between S.DATA_INIZIO_VALIDITA and
			nvl(s.DATA_FINE_VALIDITA, to_date('31/12/9999','dd/mm/yyyy'));
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on A4SV_SUOLO_LAYER to ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet A4ST_SUOLO_DICHIARATO aggiunta colonne su tabella esistente -->
	<changeSet id="ISTANZARIESAME_S36.02" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">

			ALTER TABLE
			A4ST_SUOLO_DICHIARATO ADD (
			NUOVA_MODIFICA_BO NUMBER(1) DEFAULT 0 NOT
			NULL ,
			NUOVA_MODIFICA_CAA NUMBER(1) DEFAULT 0 NOT NULL,
			VISIBILE_IN_ORTOFOTO NUMBER(1),
			TIPO_INTERVENTO_COLTURALE
			${string.type}(50),
			INTERVENTO_INIZIO DATE,
			INTERVENTO_FINE DATE
			);

			commit;

		</sql>
	</changeSet>

	<!--changeSet A4ST_LAVORAZIONE_SUOLO update nuove colonne su tabella con 
		valori della richiesta -->
	<changeSet id="ISTANZARIESAME_S36.03" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">

			update a4st_suolo_dichiarato
			s set s.VISIBILE_IN_ORTOFOTO =
			(select m.VISIBILE_IN_ORTOFOTO from
			a4st_richiesta_modifica_suolo m where s.id_richiesta = m.id);

			update
			a4st_suolo_dichiarato s set s.TIPO_INTERVENTO_COLTURALE =
			(select
			m.TIPO_INTERVENTO_COLTURALE from a4st_richiesta_modifica_suolo m
			where s.id_richiesta = m.id);

			update a4st_suolo_dichiarato s set
			s.INTERVENTO_INIZIO =
			(select m.INTERVENTO_INIZIO from
			a4st_richiesta_modifica_suolo m where s.id_richiesta = m.id);

			update
			a4st_suolo_dichiarato s set s.INTERVENTO_FINE =
			(select
			m.INTERVENTO_FINE from a4st_richiesta_modifica_suolo m where
			s.id_richiesta = m.id);

			commit;

		</sql>
	</changeSet>

	<!--changeSet A4SV_SUOLO_DICH_LAVORAZIONE aggiunta nuove colonne alla vista 
		esistente -->
	<changeSet id="ISTANZARIESAME_S36.04" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">

			CREATE OR REPLACE VIEW
			A4SV_SUOLO_DICH_LAVORAZIONE (
			ID_SUOLO_DICH,
			ID_RICHIESTA,
			STATO_RICHIESTA,
			CUAA,
			AZIENDA,
			CAMPAGNA,
			TIPO_SUOLO_DICHIARATO,
			TIPO_SUOLO_RILEVATO,
			SHAPE,
			AREA_ORI,
			CODI_RILE_DICHIARATO,
			DESC_RILE_DICHIARATO,
			CODI_PROD_RILE_DICHIARATO,
			DESC_PROD_RILE_DICHIARATO,
			CODI_RILE_PREVALENTE_DICH,
			DESC_RILE_PREVALENTE_DICH,
			COD_SEZIONE,
			CODI_RILE_RILEVATO,
			DESC_RILE_RILEVATO,
			CODI_PROD_RILE_RILEVATO,
			DESC_PROD_RILE_RILEVATO,
			CODI_RILE_PREVALENTE_RIL,
			DESC_RILE_PREVALENTE_RIL,
			ESITO_DICHIARATO,
			ID_LAVORAZIONE,
			NUOVA_MODIFICA_BO,
			NUOVA_MODIFICA_CAA,
			VISIBILE_IN_ORTOFOTO,
			TIPO_INTERVENTO_COLTURALE,
			INTERVENTO_INIZIO,
			INTERVENTO_FINE,
			STATO_LAVORAZIONE,
			UTENTE_LAVORAZIONE
			) AS
			select
			D.ID
			ID_SUOLO_DICH,
			R.ID ID_RICHIESTA,
			R.STATO STATO_RICHIESTA,
			R.CUAA,
			R.AZIENDA,
			R.CAMPAGNA,
			D.TIPO_SUOLO_DICHIARATO,
			D.TIPO_SUOLO_RILEVATO,
			D.SHAPE,
			D.AREA_ORI,
			D.CODI_RILE_DICHIARATO ,
			V.DESC_RILE
			DESC_RILE_DICHIARATO,
			D.CODI_PROD_RILE_DICHIARATO,
			V.DESC_PROD_RILE
			DESC_PROD_RILE_DICHIARATO,
			V.CODI_RILE_PREVALENTE
			CODI_RILE_PREVALENTE_DICH,
			V.DESC_RILE_PREVALENTE
			DESC_RILE_PREVALENTE_DICH,
			D.COD_SEZIONE,
			SR.CODI_RILE_RILEVATO,
			VR.DESC_RILE DESC_RILE_RILEVATO,
			SR.CODI_PROD_RILE_RILEVATO,
			VR.DESC_PROD_RILE DESC_PROD_RILE_RILEVATO,
			VR.CODI_RILE_PREVALENTE
			CODI_RILE_PREVALENTE_RIL,
			VR.DESC_RILE_PREVALENTE
			DESC_RILE_PREVALENTE_RIL,
			D.ESITO ESITO_DICHIARATO,
			D.ID_LAVORAZIONE,
			D.NUOVA_MODIFICA_BO,
			D.NUOVA_MODIFICA_CAA,
			D.VISIBILE_IN_ORTOFOTO,
			D.TIPO_INTERVENTO_COLTURALE,
			D.INTERVENTO_INIZIO,
			D.INTERVENTO_FINE,
			LAVORAZIONE.STATO STATO_LAVORAZIONE,
			LAVORAZIONE.UTENTE
			UTENTE_LAVORAZIONE
			FROM
			A4ST_RICHIESTA_MODIFICA_SUOLO R
			INNER JOIN
			A4ST_SUOLO_DICHIARATO D ON R.ID = D.ID_RICHIESTA
			LEFT JOIN
			A4SD_CODI_RILE_PCG V ON V.CODI_RILE = D.CODI_RILE_DICHIARATO AND
			V.CODI_PROD_RILE = D.CODI_PROD_RILE_DICHIARATO
			LEFT JOIN
			A4SR_SUPPORTO_TAG_TIPO_SUOLO ST ON ST.ID_SUOLO_DICHIARATO = D.ID
			LEFT
			JOIN A4ST_SUOLO_RILEVATO SR ON SR.ID = ST.ID_SUOLO_RILEVATO
			LEFT JOIN
			A4SD_CODI_RILE_PCG VR ON VR.CODI_RILE = SR.CODI_RILE_RILEVATO AND
			VR.CODI_PROD_RILE = SR.CODI_PROD_RILE_RILEVATO
			LEFT JOIN
			A4ST_LAVORAZIONE_SUOLO LAVORAZIONE ON LAVORAZIONE.ID =
			D.ID_LAVORAZIONE;
		</sql>
	</changeSet>

	<!-- changeSet add column e constraint A4ST_MESSAGGIO_RICHIESTA -->
	<changeSet id="ISTANZARIESAME_S37.05" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_MESSAGGIO_RICHIESTA ADD ID_POLIGONO_DICHIARATO NUMBER(10);
			ALTER
			TABLE A4ST_MESSAGGIO_RICHIESTA ADD CONSTRAINT A4ST_MESS_RICH_M_DIC_FK
			FOREIGN KEY ( ID_POLIGONO_DICHIARATO ) REFERENCES
			A4ST_SUOLO_DICHIARATO ( ID ) NOT DEFERRABLE;
		</sql>
	</changeSet>

	<!-- changeSet set id_richiesta nullable in A4ST_MESSAGGIO_RICHIESTA -->
	<changeSet id="ISTANZARIESAME_INFODICH_S37.06"
		author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">
			alter table
			a4st_messaggio_richiesta modify (id_richiesta NULL);
		</sql>
	</changeSet>

	<!--changeSet definizione tabelle import -->
	<changeSet id="ISTANZARIESAME_S39.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4SI_LAYER_IMPORT
			( ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			COD_USO ${string.type}(3) NOT NULL,
			STATO_COLT NUMBER(3) NOT NULL,
			AREA ${string.type}(20),
			NOTE ${string.type}(500),
			UTENTE ${string.type}(200),
			SHAPE MDSYS.SDO_GEOMETRY ,
			AREA_ORACLE NUMBER(20,6),
			VALIDO_ORACLE ${string.type}(20),
			SHAPE_FIXED SDO_GEOMETRY,
			AREA_FIXED NUMBER(20,6),
			VALIDO_ORACLE_FIXED ${string.type}(20),
			DIFFERENZA_AREE NUMBER(20,6),
			ORACLE_GTYPE ${string.type}(20),
			ORACLE_GTYPE_FIXED ${string.type}(20),
			FONTE ${string.type}(200),
			ANNO NUMBER(4)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE A4SI_LAYER_IMPORT ADD CONSTRAINT A4SI_LAYER_IMPORT_PK PRIMARY
			KEY ( ID );

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_IMPORT', 'SHAPE', SDO_DIM_ARRAY( SDO_DIM_ELEMENT
			('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y', 3930000,
			5220000, 0.005) ), 25832);
			commit;

			insert into USER_SDO_GEOM_METADATA
			(table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_IMPORT', 'SHAPE_FIXED', SDO_DIM_ARRAY( SDO_DIM_ELEMENT
			('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y', 3930000,
			5220000, 0.005) ), 25832);
			commit;

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SI_LAYER_IMPORT TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet definizione tabelle import -->
	<changeSet id="ISTANZARIESAME_S39.02" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4SI_LAYER_IMPORT_ELAB
			( ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			COD_USO ${string.type}(3) NOT NULL,
			STATO_COLT NUMBER(3) NOT NULL,
			AREA ${string.type}(20),
			NOTE ${string.type}(500),
			UTENTE ${string.type}(200),
			SHAPE MDSYS.SDO_GEOMETRY ,
			AREA_ORACLE NUMBER(20,6),
			VALIDO_ORACLE ${string.type}(20),
			SHAPE_FIXED SDO_GEOMETRY,
			AREA_FIXED NUMBER(20,6),
			VALIDO_ORACLE_FIXED ${string.type}(20),
			DIFFERENZA_AREE NUMBER(20,6),
			ORACLE_GTYPE ${string.type}(20),
			ORACLE_GTYPE_FIXED ${string.type}(20),
			FONTE ${string.type}(200),
			ANNO NUMBER(4)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE A4SI_LAYER_IMPORT_ELAB ADD CONSTRAINT
			A4SI_LAYER_IMPORT_ELAB_PK PRIMARY KEY ( ID );

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_IMPORT_ELAB', 'SHAPE', SDO_DIM_ARRAY(
			SDO_DIM_ELEMENT ('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y',
			3930000, 5220000, 0.005) ), 25832);
			commit;

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_IMPORT_ELAB', 'SHAPE_FIXED', SDO_DIM_ARRAY(
			SDO_DIM_ELEMENT ('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y',
			3930000, 5220000, 0.005) ), 25832);
			commit;

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SI_LAYER_IMPORT_ELAB TO
			${user.writer};
		</sql>
	</changeSet>

	<!--changeSet definizione tabelle import -->
	<changeSet id="ISTANZARIESAME_S39.03" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4SI_LAYER_IMPORT_VALIDO
			( ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			COD_USO ${string.type}(3) NOT NULL,
			STATO_COLT NUMBER(3) NOT NULL,
			AREA ${string.type}(20),
			NOTE ${string.type}(500),
			UTENTE ${string.type}(200),
			SHAPE MDSYS.SDO_GEOMETRY ,
			VALIDO_ORACLE ${string.type}(20),
			FONTE ${string.type}(200),
			ANNO NUMBER(4),
			DATA_ESECUZIONE DATE
			) TABLESPACE ${tablespace.data};

			ALTER TABLE A4SI_LAYER_IMPORT_VALIDO ADD CONSTRAINT
			A4SI_LAYER_IMPORT_VALIDO_PK PRIMARY KEY ( ID );

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_IMPORT_VALIDO', 'SHAPE', SDO_DIM_ARRAY(
			SDO_DIM_ELEMENT ('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y',
			3930000, 5220000, 0.005) ), 25832);
			commit;

			CREATE INDEX A4SI_LAYER_IMPORT_VALIDO_SI ON A4SI_LAYER_IMPORT_VALIDO
			(SHAPE)
			INDEXTYPE IS MDSYS.SPATIAL_INDEX ;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SI_LAYER_IMPORT_VALIDO TO
			${user.writer};
		</sql>
	</changeSet>

	<!--changeSet definizione tabelle import -->
	<changeSet id="ISTANZARIESAME_S39.04" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4SI_LAYER_ETRS89_TMP
			( UUID ${string.type}(50) NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			FONTE ${string.type}(200),
			ANNO NUMBER(20),
			AREA NUMBER(20,6),
			SHAPE MDSYS.SDO_GEOMETRY,
			AREA_ORACLE NUMBER(20,6),
			VALIDO_ORACLE ${string.type}(20),
			SHAPE_FIXED SDO_GEOMETRY,
			AREA_FIXED NUMBER(20,6),
			VALIDO_ORACLE_FIXED ${string.type}(20),
			DIFFERENZA_AREE NUMBER(20,6),
			ORACLE_GTYPE ${string.type}(20),
			ORACLE_GTYPE_FIXED ${string.type}(20)
			) TABLESPACE ${tablespace.data};

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_ETRS89_TMP', 'SHAPE', SDO_DIM_ARRAY(
			SDO_DIM_ELEMENT ('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y',
			3930000, 5220000, 0.005) ), 25832);
			commit;

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_ETRS89_TMP', 'SHAPE_FIXED', SDO_DIM_ARRAY(
			SDO_DIM_ELEMENT ('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y',
			3930000, 5220000, 0.005) ), 25832);
			commit;

			CREATE TABLE A4SI_LAYER_GB_TMP
			( UUID ${string.type}(50) NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			FONTE ${string.type}(200),
			ANNO NUMBER(20),
			AREA NUMBER(20,6),
			SHAPE MDSYS.SDO_GEOMETRY,
			AREA_ORACLE NUMBER(20,6),
			VALIDO_ORACLE ${string.type}(20),
			SHAPE_FIXED SDO_GEOMETRY,
			AREA_FIXED NUMBER(20,6),
			VALIDO_ORACLE_FIXED ${string.type}(20),
			DIFFERENZA_AREE NUMBER(20,6),
			ORACLE_GTYPE ${string.type}(20),
			ORACLE_GTYPE_FIXED ${string.type}(20)
			) TABLESPACE ${tablespace.data};

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_GB_TMP', 'SHAPE', SDO_DIM_ARRAY( SDO_DIM_ELEMENT
			('X', 1603000, 1739000, 0.005), SDO_DIM_ELEMENT ('Y', 5050000,
			5166000, 0.005) ), 3003);
			commit;

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4SI_LAYER_GB_TMP', 'SHAPE_FIXED', SDO_DIM_ARRAY(
			SDO_DIM_ELEMENT ('X', 1603000, 1739000, 0.005), SDO_DIM_ELEMENT ('Y',
			5050000, 5166000, 0.005) ), 3003);
			commit;

		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SI_LAYER_ETRS89_TMP TO
			${user.writer};
			GRANT SELECT,INSERT,UPDATE,DELETE ON A4SI_LAYER_GB_TMP
			TO ${user.writer};
		</sql>
	</changeSet>

	<!--changeSet definizione tabelle import -->
	<changeSet id="ISTANZARIESAME_S39.05" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4ST_UPAS
			( ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			CODICE ${string.type}(255),
			K_UPAS ${string.type}(255),
			LADI_ID NUMBER(9,0),
			MALGA_B ${string.type}(255),
			MALGA_P ${string.type}(255),
			NOME_PIANO ${string.type}(255),
			PIANO ${string.type}(255),
			AREA NUMBER(20,6),
			SHAPE MDSYS.SDO_GEOMETRY,
			ANNO NUMBER(4)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE A4ST_UPAS ADD CONSTRAINT A4ST_UPAS_PK PRIMARY KEY ( ID );

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo,
			srid)
			values ('A4ST_UPAS', 'SHAPE', SDO_DIM_ARRAY( SDO_DIM_ELEMENT ('X', 1310000,
			2820000, 0.005), SDO_DIM_ELEMENT ('Y', 3930000, 5220000, 0.005) ),
			25832);
			commit;

			CREATE INDEX A4ST_UPAS_SI ON A4ST_UPAS (SHAPE)
			INDEXTYPE IS MDSYS.SPATIAL_INDEX ;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_UPAS TO ${user.writer};
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S39.06" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			update A4ST_PROPRIETA_LAYER
			set VALORE = 'UPAS 2022' where NOME = 'titolo' and ID_LAYER = (select
			id from a4st_layer where codice = 'AgsUpas');
			update
			A4ST_PROPRIETA_LAYER set VALORE ='Proprietà assestata 2022' where
			NOME = 'titolo' and ID_LAYER = (select id from a4st_layer where
			codice = 'AgsPAssestata');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S39.07" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer
			set valore = 'rgb(116, 51, 255, 0.6)' where nome =
			'tematismoFillColore' and id_layer = (select id from a4st_layer where
			codice = 'SuoloPrenotatoLavBO') ;
			update a4st_proprieta_layer set
			valore = 'rgba(255,0,0,0.6)' where nome = 'tematismoFillColore' and
			id_layer = (select id from a4st_layer where codice =
			'anomalieValidazioneBO') ;
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S39.08" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into a4st_layer
			values ( nxtnbr.nextval,1, 'A4SV_CATASTO_LAYER2', '/proxy/geoserver',
			'/app_a4s', 'particelleCatastaliLabel');
			Insert into a4st_layer values
			( nxtnbr.nextval,1, 'A4SV_SITIPART_TN2', '/proxy/geoserver',
			'/app_a4s', 'AgsSitipartTNLabel');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'CAA');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'BACKOFFICE');
			Insert into
			A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'VITICOLO');

			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'CAA');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'VITICOLO');

			Insert into a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'style','A4SV_SITIPART_TN_Label_BasicStyle');
			Insert into a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'titolo','Particelle catastali Label');
			Insert into a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'cancellabile','si');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'Ispezionabile','no');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'AbilitatoDefault','no');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'posizione','235');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'formato','wms');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'gruppo','Catasto');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'TIPO_WMS','Image');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'collassaGruppo','si');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'FORMATO_IMMAGINE','image/png8');
			Insert
			into a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'MAX_SCALE','2000');

			Insert into a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'style','A4SV_CATASTO_LAYER_Label_BasicStyle');
			Insert into a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'titolo','Catasto Agricolo Label');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'cancellabile','si');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'posizione','245');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'Ispezionabile','no');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'AbilitatoDefault','no');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'formato','wms');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'gruppo','Catasto');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'collassaGruppo','si');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'FORMATO_IMMAGINE','image/png8');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'TIPO_WMS','Image');
			Insert into
			a4st_proprieta_layer (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'MAX_SCALE','2000');

			commit;
		</sql>
	</changeSet>

	<!--changeSet definizione tabelle import -->
	<changeSet id="ISTANZARIESAME_S40.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4SI_LAYER_IMPORT_VALIDO MODIFY AREA NUMBER(20,6);
		</sql>
	</changeSet>
	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_6.xml" />

	<!--changeSet inserimento layer ortofoto 2014 AGEA RGB -->
	<changeSet id="ISTANZARIESAME_S40.03" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			insert into a4st_layer
			values (nxtnbr.nextval, 1, 'agea_2014_big', '/proxy/geoserver',
			'/pub_stem_s', 'ortofotoAgea2014_RGB');

			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2014_RGB'), 'BACKOFFICE');
			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id
			from a4st_layer where codice = 'ortofotoAgea2014_RGB'), 'VITICOLO');
			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id
			from a4st_layer where codice = 'ortofotoAgea2014_RGB'), 'CAA');

			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'ortofotoAgea2014_RGB'), 'titolo',
			'Ortofoto AGEA 2014 RGB');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2014_RGB'), 'cancellabile', 'no');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2014_RGB'), 'posizione',
			(select to_char(max(to_number(valore)) + 10) as valore from
			a4st_proprieta_layer where nome = 'posizione' and id_layer in (select
			id_layer from a4st_proprieta_layer where nome = 'gruppo' and valore =
			'Sfondo')));
			insert into a4st_proprieta_layer values (nxtnbr.nextval,
			1, (select id from a4st_layer where codice = 'ortofotoAgea2014_RGB'),
			'Ispezionabile', 'no');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2014_RGB'), 'AbilitatoDefault', 'no');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2014_RGB'), 'formato', 'wms');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'ortofotoAgea2014_RGB'), 'gruppo',
			'Sfondo');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'ortofotoAgea2014_RGB'),
			'TIPO_WMS', 'Wmts');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2014_RGB'), 'CONTENUTO_INFORMATIVO', 'ORTOFOTO');
			insert
			into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2014_RGB'), 'collassaGruppo',
			'si');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'ortofotoAgea2014_RGB'),
			'FORMATO_IMMAGINE', 'image/jpeg');
			insert into a4st_proprieta_layer
			values (nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2014_RGB'), 'ATTRIBUTION', 'Ortofoto 2014 - © AGEA -
			AGenzia per le Erogazioni in Agricoltura, Roma (www.agea.gov.it)');

			commit;
		</sql>
	</changeSet>


	<!--changeSet inserimento layer ortofoto 2014 AGEA IR -->
	<changeSet id="ISTANZARIESAME_S40.04" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			insert into a4st_layer
			values (nxtnbr.nextval, 1, 'agea_2014_ir_big', '/proxy/geoserver',
			'/pub_stem_s', 'ortofotoAgea2014_IR');

			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2014_IR'), 'BACKOFFICE');
			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id
			from a4st_layer where codice = 'ortofotoAgea2014_IR'), 'VITICOLO');

			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'ortofotoAgea2014_IR'), 'titolo',
			'Ortofoto AGEA 2014 IR');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2014_IR'), 'cancellabile', 'no');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2014_IR'), 'posizione',
			(select to_char(max(to_number(valore)) + 10) as valore from
			a4st_proprieta_layer where nome = 'posizione' and id_layer in (select
			id_layer from a4st_proprieta_layer where nome = 'gruppo' and valore =
			'Sfondo')));
			insert into a4st_proprieta_layer values (nxtnbr.nextval,
			1, (select id from a4st_layer where codice = 'ortofotoAgea2014_IR'),
			'Ispezionabile', 'no');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2014_IR'), 'AbilitatoDefault', 'no');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2014_IR'), 'formato', 'wms');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'ortofotoAgea2014_IR'), 'gruppo',
			'Sfondo');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'ortofotoAgea2014_IR'),
			'TIPO_WMS', 'Wmts');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2014_IR'), 'CONTENUTO_INFORMATIVO', 'ORTOFOTO');
			insert
			into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2014_IR'), 'collassaGruppo',
			'si');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'ortofotoAgea2014_IR'),
			'FORMATO_IMMAGINE', 'image/jpeg');
			insert into a4st_proprieta_layer
			values (nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2014_IR'), 'ATTRIBUTION', 'Ortofoto 2014 - © AGEA -
			AGenzia per le Erogazioni in Agricoltura, Roma (www.agea.gov.it)');

			commit;
		</sql>
	</changeSet>

	<!--changeSet inserimento layer ortofoto 2017 AGEA IR -->
	<changeSet id="ISTANZARIESAME_S40.05" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			insert into a4st_layer
			values (nxtnbr.nextval, 1, 'agea_2017_ir_big', '/proxy/geoserver',
			'/pub_stem_s', 'ortofotoAgea2017_IR');

			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2017_IR'), 'BACKOFFICE');
			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id
			from a4st_layer where codice = 'ortofotoAgea2017_IR'), 'VITICOLO');

			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'ortofotoAgea2017_IR'), 'titolo',
			'Ortofoto AGEA 2017 IR');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2017_IR'), 'cancellabile', 'no');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2017_IR'), 'posizione',
			(select to_char(max(to_number(valore)) + 10) as valore from
			a4st_proprieta_layer where nome = 'posizione' and id_layer in (select
			id_layer from a4st_proprieta_layer where nome = 'gruppo' and valore =
			'Sfondo')));
			insert into a4st_proprieta_layer values (nxtnbr.nextval,
			1, (select id from a4st_layer where codice = 'ortofotoAgea2017_IR'),
			'Ispezionabile', 'no');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2017_IR'), 'AbilitatoDefault', 'no');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2017_IR'), 'formato', 'wms');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'ortofotoAgea2017_IR'), 'gruppo',
			'Sfondo');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'ortofotoAgea2017_IR'),
			'TIPO_WMS', 'Wmts');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2017_IR'), 'CONTENUTO_INFORMATIVO', 'ORTOFOTO');
			insert
			into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2017_IR'), 'collassaGruppo',
			'si');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'ortofotoAgea2017_IR'),
			'FORMATO_IMMAGINE', 'image/jpeg');
			insert into a4st_proprieta_layer
			values (nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2017_IR'), 'ATTRIBUTION', 'Ortofoto 2017 - © AGEA -
			AGenzia per le Erogazioni in Agricoltura, Roma (www.agea.gov.it)');

			commit;
		</sql>
	</changeSet>

	<!--changeSet inserimento layer ortofoto 2020 AGEA IR -->
	<changeSet id="ISTANZARIESAME_S40.06" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			insert into a4st_layer
			values (nxtnbr.nextval, 1, 'agea_2020_ir_big', '/proxy/geoserver',
			'/pub_stem_s', 'ortofotoAgea2020_IR');

			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2020_IR'), 'BACKOFFICE');
			insert into a4sr_layer_profilo values (nxtnbr.nextval, 1, (select id
			from a4st_layer where codice = 'ortofotoAgea2020_IR'), 'VITICOLO');

			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'ortofotoAgea2020_IR'), 'titolo',
			'Ortofoto AGEA 2020 IR');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2020_IR'), 'cancellabile', 'no');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2020_IR'), 'posizione',
			(select to_char(max(to_number(valore)) + 10) as valore from
			a4st_proprieta_layer where nome = 'posizione' and id_layer in (select
			id_layer from a4st_proprieta_layer where nome = 'gruppo' and valore =
			'Sfondo')));
			insert into a4st_proprieta_layer values (nxtnbr.nextval,
			1, (select id from a4st_layer where codice = 'ortofotoAgea2020_IR'),
			'Ispezionabile', 'no');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2020_IR'), 'AbilitatoDefault', 'no');
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2020_IR'), 'formato', 'wms');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'ortofotoAgea2020_IR'), 'gruppo',
			'Sfondo');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'ortofotoAgea2020_IR'),
			'TIPO_WMS', 'Wmts');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2020_IR'), 'CONTENUTO_INFORMATIVO', 'ORTOFOTO');
			insert
			into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'ortofotoAgea2020_IR'), 'collassaGruppo',
			'si');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'ortofotoAgea2020_IR'),
			'FORMATO_IMMAGINE', 'image/jpeg');
			insert into a4st_proprieta_layer
			values (nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'ortofotoAgea2020_IR'), 'ATTRIBUTION', 'Ortofoto 2020 - © AGEA -
			AGenzia per le Erogazioni in Agricoltura, Roma (www.agea.gov.it)');

			commit;
		</sql>
	</changeSet>

	<!--changeSet inserimento layer ortofoto 2017 AGEA IR -->
	<changeSet id="ISTANZARIESAME_S40.07" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_layer
			set codice
			= 'ortofotoAgea2017_RGB'
			where codice = 'ortofoto';

			update a4st_layer
			set codice = 'ortofotoAgea2020_RGB'
			where codice =
			'ortofoto2020';

			commit;
		</sql>
	</changeSet>

	<!--changeSet modifica ordinamento layer sfondo -->
	<changeSet id="ISTANZARIESAME_S40.08" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer
			set valore = '1.1'
			where nome = 'posizione'
			and id_layer = (select id
			from a4st_layer where codice = 'ortofotoAgea2014_IR');

			update a4st_proprieta_layer
			set valore = '1.2'
			where nome = 'posizione'
			and
			id_layer = (select id from a4st_layer where codice =
			'ortofotoAgea2014_RGB');

			update a4st_proprieta_layer
			set valore = '1.3'
			where nome = 'posizione'
			and
			id_layer = (select id from a4st_layer where codice =
			'ortofotoAgea2017_IR');

			update a4st_proprieta_layer
			set valore = '1.4'
			where nome = 'posizione'
			and
			id_layer = (select id from a4st_layer where codice =
			'ortofotoAgea2017_RGB');

			update a4st_proprieta_layer
			set valore = '1.5'
			where nome = 'posizione'
			and
			id_layer = (select id from a4st_layer where codice =
			'ortofotoAgea2020_IR');

			update a4st_proprieta_layer
			set valore = '1.6'
			where nome = 'posizione'
			and
			id_layer = (select id from a4st_layer where codice =
			'ortofotoAgea2020_RGB');

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S40.09" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4ST_CLIP_PART_SUOLO_TMP
			( PKID ${id.number.type} NOT NULL,
			SHAPE MDSYS.SDO_GEOMETRY,
			ID_PARTICELLA NUMBER(20,6),
			COD_NAZIONALE ${string.type}(50),
			FOGLIO NUMBER(4),
			PARTICELLA ${string.type}(50),
			SUB ${string.type}(50),
			CAMPAGNA NUMBER(4),
			ISTATP ${string.type}(3),
			ID ${id.number.type},
			ID_GRID NUMBER(3),
			COD_USO_SUOLO ${string.type}(3),
			STATO_COLT NUMBER(2),
			NOTE ${string.type}(4000),
			SORGENTE ${string.type}(50),
			ID_LAVORAZIONE ${id.number.type},
			DATA_CLIP DATE,
			DATA_ELABORAZIONE DATE,
			ELABORATO NUMBER(2)
			) TABLESPACE ${tablespace.data};

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4ST_CLIP_PART_SUOLO_TMP', 'SHAPE', SDO_DIM_ARRAY(
			SDO_DIM_ELEMENT ('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y',
			3930000, 5220000, 0.005) ), 25832);
			commit;

			CREATE INDEX A4ST_CLIP_PART_SUOLO_I ON A4ST_CLIP_PART_SUOLO_TMP (SHAPE)
			INDEXTYPE IS MDSYS.SPATIAL_INDEX ;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_CLIP_PART_SUOLO_TMP TO
			${user.writer};
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S40.10" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			CREATE INDEX A4ST_CLIP_PART_SUOLO_IDX1 ON A4ST_CLIP_PART_SUOLO_TMP
			(ID_PARTICELLA, ID_LAVORAZIONE);
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S41.01_Fix"
		author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO
			A4SR_LAYER_PROFILO VALUES (NXTNBR.NEXTVAL, 1, (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'AgsUpas'), 'CAA');
			INSERT INTO
			A4SR_LAYER_PROFILO VALUES (NXTNBR.NEXTVAL, 1, (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'AgsPAssestata'), 'CAA');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S41.02" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_SYNC_SUOLO_ESITO_PART ADD NOTE VARCHAR(4000);
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S42.01_fix"
		author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_SYNC_SUOLO_ESITO_PART ADD UTENTE VARCHAR(100);
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S42.02_fix"
		author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into
			a4st_lavorazione_suolo
			(ID,VERSIONE,UTENTE,STATO,DATA_INIZIO_LAVORAZIONE,DATA_FINE_LAVORAZIONE,TITOLO,SOPRALLUOGO,NOTE,DATA_ULTIMA_MODIFICA,UTENTE_AGS)
			values
			(NXTNBR.NEXTVAL,'0','AGGIORNAMENTO_CATASTO','CHIUSA',to_date('01-05-2022','DD-MM-YYYY'),to_date('01-05-2022','DD-MM-YYYY'),'Aggiornamento
			catasto',null,null,null,null);
			commit;
		</sql>
	</changeSet>



	<!--changeSet aggiunta proprietà TILE_SIZE ai layers -->
	<changeSet id="ISTANZARIESAME_S41.03"
		author="Riccardo Sommavilla">
		<sql endDelimiter=";" splitStatements="true">
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'suoloVigenteBO'), 'TILE_SIZE', '512');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1, (select
			id from a4st_layer where codice = 'suoloVigenteCAA'), 'TILE_SIZE',
			'512');
			insert into a4st_proprieta_layer values (nxtnbr.nextval, 1,
			(select id from a4st_layer where codice = 'IstanzaDiRiesameBO'),
			'TILE_SIZE', '512');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'), 'TILE_SIZE', '512');
		</sql>
	</changeSet>


	<changeSet id="ISTANZARIESAME_S41.04" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4SI_LAYER_IMPORT ADD TIPO_CARICAMENTO VARCHAR(50);
			ALTER TABLE
			A4SI_LAYER_IMPORT_ELAB ADD TIPO_CARICAMENTO VARCHAR(50);
			ALTER TABLE
			A4SI_LAYER_IMPORT_VALIDO ADD TIPO_CARICAMENTO VARCHAR(50);
			ALTER TABLE
			A4SI_LAYER_GB_TMP ADD TIPO_CARICAMENTO VARCHAR(50);
			ALTER TABLE
			A4SI_LAYER_ETRS89_TMP ADD TIPO_CARICAMENTO VARCHAR(50);
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_7.xml" />

	<!--changeSet per inserimento proprietà abilitazione visibilità layers all'utente 
		in layer switcher -->
	<changeSet id="ISTANZARIESAME_S41.06" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofotoAgea2014_RGB'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofotoAgea2014_IR'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofotoAgea2017_RGB'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofotoAgea2017_IR'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofotoAgea2020_RGB'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ortofotoAgea2020_IR'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'anomalieValidazioneBO'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AreaDilavoro'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'displayInLayerSwitcher','no');
			Insert
			into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastali'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameBO'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'IstanzaDiRiesameCAA'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTN'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'displayInLayerSwitcher','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloVigenteBO'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloVigenteInclusoInLavorazioniBO'),'displayInLayerSwitcher','si');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloVigenteCAA'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'SuoloPrenotatoLavBO'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'workspaceBO'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'comuniAmministrativiTN'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'ComuniCatastali'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsPAssestata'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsUpas'),'displayInLayerSwitcher','si');
			commit;
		</sql>
	</changeSet>

	<!--changeSet per inserimento proprietà di relazione fra layer (0 per nesssuna 
		relazione) -->
	<changeSet id="ISTANZARIESAME_S41.07" author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'particelleCatastaliLabel'),'relazioneConLayer','particelleCatastali');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'AgsSitipartTNLabel'),'relazioneConLayer','AgsSitipartTN');
			commit;
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_8.xml" />

	<changeSet id="ISTANZARIESAME_S42.02_rel"
		author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer
			set valore = 'rgba(255,0,0,0.4)' where nome = 'tematismoFillColore'
			and id_layer = (select id from a4st_layer where codice =
			'anomalieValidazioneBO') ;
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S42.03_fix"
		author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_LAVORAZIONE_SUOLO MODIFY TITOLO VARCHAR2(100);
		</sql>
	</changeSet>

	<!--changeSet definizione tabella ranking cod_uso -->
	<changeSet id="ISTANZARIESAME_S42.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			a4sd_ranking_cod_uso (
			cod_uso ${string.type}(3) NOT NULL,
			ranking NUMBER(5) NOT NULL,
			data_inizio DATE,
			data_fine DATE
			) TABLESPACE ${tablespace.data};
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON a4sd_ranking_cod_uso TO
			${user.writer};
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.A4SD_RANKING_COD_USO.changelog.xml" />

	<!--changeSet aggiunta proprietà TILE_SIZE ai layers -->
	<changeSet id="ISTANZARIESAME_S43.01"
		author="Riccardo Sommavilla">
		<sql endDelimiter=";" splitStatements="true">
			insert into
			a4st_proprieta_layer values (nxtnbr.nextval, 1, (select id from
			a4st_layer where codice = 'suoloVigenteInclusoInLavorazioniBO'),
			'TILE_SIZE', '512');
			insert into a4st_proprieta_layer values
			(nxtnbr.nextval, 1, (select id from a4st_layer where codice =
			'IstanzaDiRiesameLavBO'), 'TILE_SIZE', '512');
		</sql>
	</changeSet>

	<!-- changeSet add column e constraint A4ST_DOCUMENTAZIONE_RICHIESTA -->
	<changeSet id="ISTANZARIESAME_S43.02"
		author="Riccardo Sommavilla">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_DOCUMENTAZIONE_RICHIESTA MODIFY (ID_RICHIESTA NULL);
			ALTER TABLE
			A4ST_DOCUMENTAZIONE_RICHIESTA ADD ID_POLIGONO_DICHIARATO
			${id.number.type};
			ALTER TABLE A4ST_DOCUMENTAZIONE_RICHIESTA RENAME
			CONSTRAINT A4S_DOC_RICH_M_FK TO A4S_DOC_RICH_M_SUOLO_FK;
			ALTER TABLE
			A4ST_DOCUMENTAZIONE_RICHIESTA ADD CONSTRAINT A4S_DOC_RICH_M_DIC_FK
			FOREIGN KEY ( ID_POLIGONO_DICHIARATO ) REFERENCES
			A4ST_SUOLO_DICHIARATO ( ID ) NOT DEFERRABLE;
		</sql>
	</changeSet>

	<!-- changeSet crea tabella TMP_PARTICELLA_LAV -->
	<changeSet id="ISTANZARIESAME_S44.01" author="Bettina Irler">
		<preConditions onFail="CONTINUE">
			<sqlCheck expectedResult="0">select count(*) FROM user_tables
				WHERE table_name = 'TMP_PARTICELLA_LAV'</sqlCheck>
		</preConditions>
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE TMP_PARTICELLA_LAV
			( COD_NAZIONALE CHAR(4),
			FOGLIO NUMBER(4,0),
			PARTICELLA CHAR(5),
			SUB VARCHAR2(3),
			UTENTE ${string.type}(100),
			DATA_INIZIO_VAL ${string.type}(20),
			DATA_FINE_VAL DATE,
			AREA_PART NUMBER(11,2),
			SE_ROW_ID NUMBER(10,0),
			ISTATP NUMBER(2,0),
			ID_PARTICELLA NUMBER(9,0),
			AREA_ETRS89 NUMBER(20,10),
			ID_LAVORAZIONE NUMBER(20,10),
			SHAPE MDSYS.SDO_GEOMETRY
			) TABLESPACE ${tablespace.data}
			VARRAY SHAPE.SDO_ELEM_INFO STORE AS
			SECUREFILE LOB
			( TABLESPACE ${tablespace.lob})
			VARRAY SHAPE.SDO_ORDINATES STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob});
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON TMP_PARTICELLA_LAV TO ${user.writer};
		</sql>
	</changeSet>

	<!-- changeSet add column ERRORE_FIX_PARTICELLE a TMP_PARTICELLA_LAV -->
	<changeSet id="ISTANZARIESAME_S44.02" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			TMP_PARTICELLA_LAV ADD ERRORE_FIX_PARTICELLE ${string.type}(50);
		</sql>
	</changeSet>

	<!-- changeSet correzione stili layer Catasto e Sitipart -->
	<changeSet id="ISTANZARIESAME_S44.03" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_PROPRIETA_LAYER
			SET VALORE = 'A4SV_SITIPART_TN_Label_BasicStyle'
			WHERE NOME = 'style'
			AND ID_LAYER = (SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'AgsSitipartTNLabel');

			UPDATE A4ST_PROPRIETA_LAYER
			SET VALORE =
			'A4SV_CATASTO_LAYER_Label_BasicStyle'
			WHERE NOME = 'style'
			AND ID_LAYER
			= (SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'particelleCatastaliLabel');

			COMMIT;
		</sql>
	</changeSet>


	<!--changeSet per modifica posizione in layer switcher del layer suolo prenotato 
		lavorazione -->
	<changeSet id="ISTANZARIESAME_S44.04_prop"
		author="Andrea Alioto">
		<sql endDelimiter=";" splitStatements="true">
			Update A4ST_PROPRIETA_LAYER
			set VALORE=300 where ID_LAYER = 1302 and NOME = 'posizione' ;
			commit;
		</sql>
	</changeSet>


	<changeSet id="ISTANZARIESAME_S44.04" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO
			A4ST_PROPRIETA_LAYER
			VALUES (nxtnbr.nextval, 1, (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'suoloVigenteInclusoInLavorazioniBO'),
			'CONTENUTO_INFORMATIVO', 'SUOLO_IN_LAVORAZIONE');

			commit;
		</sql>
	</changeSet>


	<changeSet id="ISTANZARIESAME_S44.05" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_OCCUPATO_LAYER ("ID", "SHAPE", "CAMPAGNA",
			"ID_LAV_IN_CORSO", "UTENTE_LAVORAZIONE", "STATO_LAVORAZONE") AS
			SELECT S.ID, S.SHAPE, S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO
			ID_LAV_IN_CORSO, ls.UTENTE, ls.STATO
			FROM A4ST_SUOLO S
			JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_INIZIO = ls.id
			where
			sysdate between S.DATA_INIZIO_VALIDITA and nvl(s.DATA_FINE_VALIDITA,
			to_date('31/12/9999','dd/mm/yyyy'))
			and S.ID_LAVORAZIONE_IN_CORSO is not null
			and ls.utente != 'CARICAMENTO_INIZIALE';
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT ON
			A4SV_SUOLO_OCCUPATO_LAYER TO ${user.writer};
		</sql>
		<sql>
			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4SV_SUOLO_OCCUPATO_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');

			UPDATE A4ST_LAYER
			SET NOME_LAYER = 'A4SV_SUOLO_OCCUPATO_LAYER2'
			WHERE CODICE
			= 'suoloVigenteInclusoInLavorazioniBO';
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S44.06" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_PROPRIETA_LAYER
			SET VALORE = 'no'
			WHERE ID_LAYER = (SELECT ID FROM A4ST_LAYER WHERE
			CODICE = 'suoloVigenteInclusoInLavorazioniBO')
			AND NOME =
			'AbilitatoDefault';

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S44.07" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_OCCUPATO_LAYER ("ID", "SHAPE", "CAMPAGNA",
			"ID_LAV_IN_CORSO", "UTENTE_LAVORAZIONE", "STATO_LAVORAZONE") AS
			SELECT S.ID, S.SHAPE, S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO
			ID_LAV_IN_CORSO, ls.UTENTE, ls.STATO
			FROM A4ST_SUOLO S
			JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_IN_CORSO = ls.id
			where
			sysdate between S.DATA_INIZIO_VALIDITA and nvl(s.DATA_FINE_VALIDITA,
			to_date('31/12/9999','dd/mm/yyyy'))
			and S.ID_LAVORAZIONE_IN_CORSO is not null
			and ls.utente != 'CARICAMENTO_INIZIALE';
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S44.08" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_OCCUPATO_LAYER ("ID", "SHAPE", "CAMPAGNA",
			"ID_LAV_IN_CORSO", "UTENTE_LAVORAZIONE", "STATO_LAVORAZONE") AS
			SELECT S.ID, S.SHAPE, S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO
			ID_LAV_IN_CORSO, ls.UTENTE, ls.STATO
			FROM A4ST_SUOLO S
			JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_IN_CORSO = ls.id
			where
			sysdate between S.DATA_INIZIO_VALIDITA and nvl(s.DATA_FINE_VALIDITA,
			to_date('31/12/9999','dd/mm/yyyy'));
		</sql>
	</changeSet>
	<!--changeSet Aggiungo colonne ultimo zoom e scala -->
	<changeSet id="ISTANZARIESAME_S45.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_LAVORAZIONE_SUOLO ADD X_ULTIMO_ZOOM NUMBER(20, 8);
			ALTER TABLE
			A4ST_LAVORAZIONE_SUOLO ADD Y_ULTIMO_ZOOM NUMBER(20, 8);
			ALTER TABLE
			A4ST_LAVORAZIONE_SUOLO ADD SCALA_ULTIMO_ZOOM NUMBER(20, 8);
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.01" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer
			set valore = 'no'
			where nome = 'AbilitatoDefault'
			and id_layer =
			(select id from a4st_layer where codice = 'SuoloPrenotatoLavBO');

			update a4st_proprieta_layer
			set valore = 'si'
			where nome =
			'AbilitatoDefault'
			and id_layer = (select id from a4st_layer where
			codice = 'suoloVigenteInclusoInLavorazioniBO');

			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.02_fix_collaudo"
		author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			update a4st_proprieta_layer
			set valore = 'si'
			where nome = 'Ispezionabile'
			and id_layer = (select
			id from a4st_layer where codice =
			'suoloVigenteInclusoInLavorazioniBO');

			commit;
		</sql>
	</changeSet>
	<changeSet id="ISTANZARIESAME_S46.02" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">

			CREATE TABLE A4ST_TEMP_CLIP_SU_ADL
			(
			ID ${id.number.type} NOT NULL,
			VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL,
			ID_GRID NUMBER(3,0) ,
			ISTATP ${string.type}(3) ,
			COD_USO_SUOLO ${string.type}(3) ,
			STATO_COLT NUMBER(2,0) ,
			SORGENTE ${string.type}(50),
			NOTE ${string.type}(4000),
			CAMPAGNA NUMBER(4,0),
			UTENTE ${string.type}(500 CHAR),
			DATA_INIZIO_VALIDITA DATE NOT NULL,
			AREA NUMBER(20,6),
			SHAPE MDSYS.SDO_GEOMETRY ,
			ESITO_VALIDAZIONE ${string.type}(50),
			POSIZIONE_POLIGONO ${string.type}(3) CHECK (POSIZIONE_POLIGONO IN ('IN','OUT')),
			POLIGONO_INTERO number(1) CHECK (POLIGONO_INTERO IN (0,1)),
			ID_SUOLO_ORIGINALE ${id.number.type},
			ID_LAVORAZIONE ${id.number.type},
			CONSTRAINT A4S_TMP_CLIP_ADL_PK PRIMARY KEY (ID)
			USING INDEX TABLESPACE ${tablespace.index} ENABLE,
			CONSTRAINT A4S_TMP_CLIP_ADL_GRID_SUOLO_FK FOREIGN KEY (ID_GRID)
			REFERENCES A4ST_GRIGLIA_SUOLO (ID) ENABLE,
			CONSTRAINT A4S_TMP_CLIP_ADL_LAV_SUOLO_FK FOREIGN KEY (ID_LAVORAZIONE)
			REFERENCES A4ST_LAVORAZIONE_SUOLO (ID) ENABLE,
			CONSTRAINT A4S_TMP_CLIP_ADL_DEC_SCOLT_FK FOREIGN KEY (STATO_COLT)
			REFERENCES A4SD_STATO_COLT (STATO_COLT) ENABLE,
			CONSTRAINT A4S_TMP_CLIP_ADL_DEC_USO_FK FOREIGN KEY (COD_USO_SUOLO)
			REFERENCES A4SD_USO_SUOLO (COD_USO_SUOLO)
			) TABLESPACE ${tablespace.data}
			VARRAY SHAPE.SDO_ELEM_INFO STORE AS
			SECUREFILE LOB
			( TABLESPACE ${tablespace.lob})
			VARRAY SHAPE.SDO_ORDINATES STORE AS SECUREFILE LOB
			( TABLESPACE ${tablespace.lob});

			Insert into USER_SDO_GEOM_METADATA (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4ST_TEMP_CLIP_SU_ADL','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			CREATE INDEX A4S_TMP_CLIP_ADL_SPIDX ON A4ST_TEMP_CLIP_SU_ADL (SHAPE)
			INDEXTYPE IS "MDSYS"."SPATIAL_INDEX" PARAMETERS ('tablespace=
			${tablespace.index}');

		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_TEMP_CLIP_SU_ADL TO
			${user.writer};
		</sql>
	</changeSet>

	<!-- Layer suolo 2022 -->
	<changeSet id="ISTANZARIESAME_S46.03" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_LAYER_2022 (ID, ID_GRID, ISTATP, SHAPE, AREA_COLT,
			COD_USO_SUOLO, USO_SUOLO_DES, STATO_COLT, STATO_COLT_DES, SORGENTE,
			DATA_INIZIO_VAL, UTENTE, NOTE, CAMPAGNA, ID_LAV_IN_CORSO) AS
			SELECT S.ID, S.ID_GRID, S.ISTATP, S.SHAPE, S.AREA_COLT, S.COD_USO_SUOLO,
			V.DESCRIZIONE USO_SUOLO_DES, sc.STATO_COLT, sc.DESCRIZIONE
			STATO_COLT_DES, S.SORGENTE, S.DATA_INIZIO_VALIDITA DATA_INIZIO_VAL,
			ls.UTENTE, S.NOTE, S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO
			ID_LAV_IN_CORSO
			FROM A4ST_SUOLO S
			LEFT JOIN A4SD_USO_SUOLO V ON
			V.COD_USO_SUOLO = S.COD_USO_SUOLO
			LEFT JOIN A4SD_STATO_COLT sc on S.STATO_COLT = sc.STATO_COLT
			LEFT JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_INIZIO = ls.id
			where S.CAMPAGNA = 2022 and sysdate between S.DATA_INIZIO_VALIDITA
			and nvl(s.DATA_FINE_VALIDITA, to_date('31/12/9999','dd/mm/yyyy'));

			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4SV_SUOLO_LAYER_2022','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on
			A4SV_SUOLO_LAYER_2022 to ${user.writer};
		</sql>
	</changeSet>

	<!-- Layer suolo 2023 -->
	<changeSet id="ISTANZARIESAME_S46.04" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_LAYER_2023 (ID, ID_GRID, ISTATP, SHAPE, AREA_COLT,
			COD_USO_SUOLO, USO_SUOLO_DES, STATO_COLT, STATO_COLT_DES, SORGENTE,
			DATA_INIZIO_VAL, UTENTE, NOTE, CAMPAGNA, ID_LAV_IN_CORSO) AS
			SELECT S.ID, S.ID_GRID, S.ISTATP, S.SHAPE, S.AREA_COLT, S.COD_USO_SUOLO,
			V.DESCRIZIONE USO_SUOLO_DES, sc.STATO_COLT, sc.DESCRIZIONE
			STATO_COLT_DES, S.SORGENTE, S.DATA_INIZIO_VALIDITA DATA_INIZIO_VAL,
			ls.UTENTE, S.NOTE, S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO
			ID_LAV_IN_CORSO
			FROM A4ST_SUOLO S
			LEFT JOIN A4SD_USO_SUOLO V ON
			V.COD_USO_SUOLO = S.COD_USO_SUOLO
			LEFT JOIN A4SD_STATO_COLT sc on S.STATO_COLT = sc.STATO_COLT
			LEFT JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_INIZIO = ls.id
			where S.CAMPAGNA = 2023 and sysdate between S.DATA_INIZIO_VALIDITA
			and nvl(s.DATA_FINE_VALIDITA, to_date('31/12/9999','dd/mm/yyyy'));

			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4SV_SUOLO_LAYER_2023','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on
			A4SV_SUOLO_LAYER_2023 to ${user.writer};
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.05" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW A4SV_SUOLO_OCCUPATO_LAYER_2022 ("ID", "SHAPE",
			"CAMPAGNA", "ID_LAV_IN_CORSO", "UTENTE_LAVORAZIONE",
			"STATO_LAVORAZONE") AS
			SELECT S.ID, S.SHAPE, S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO
			ID_LAV_IN_CORSO, ls.UTENTE, ls.STATO
			FROM A4ST_SUOLO S
			JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_IN_CORSO = ls.id
			where
			S.CAMPAGNA = 2022 and sysdate between S.DATA_INIZIO_VALIDITA and
			nvl(s.DATA_FINE_VALIDITA, to_date('31/12/9999','dd/mm/yyyy'));
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT ON
			A4SV_SUOLO_OCCUPATO_LAYER_2022 TO ${user.writer};
		</sql>
		<sql>
			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4SV_SUOLO_OCCUPATO_LAYER_2022','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.06" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_SUOLO_OCCUPATO_LAYER_2023 ("ID", "SHAPE", "CAMPAGNA",
			"ID_LAV_IN_CORSO", "UTENTE_LAVORAZIONE", "STATO_LAVORAZONE") AS
			SELECT S.ID, S.SHAPE, S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO
			ID_LAV_IN_CORSO, ls.UTENTE, ls.STATO
			FROM A4ST_SUOLO S
			JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_IN_CORSO = ls.id
			where
			S.CAMPAGNA = 2023 and sysdate between S.DATA_INIZIO_VALIDITA and
			nvl(s.DATA_FINE_VALIDITA, to_date('31/12/9999','dd/mm/yyyy'));
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT ON
			A4SV_SUOLO_OCCUPATO_LAYER_2023 TO ${user.writer};
		</sql>
		<sql>
			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4SV_SUOLO_OCCUPATO_LAYER_2023','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.07" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE =
			'suoloVigenteBO'),'SPECIFICO_PER_CAMPAGNA','si');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE =
			'suoloVigenteBO'),'CONTENUTO_INFORMATIVO','SUOLO_VIGENTE');
			INSERT
			INTO A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID
			FROM A4ST_LAYER WHERE CODICE =
			'suoloVigenteCAA'),'SPECIFICO_PER_CAMPAGNA','si');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE =
			'suoloVigenteCAA'),'CONTENUTO_INFORMATIVO','SUOLO_VIGENTE');
			commit;
		</sql>
	</changeSet>
	<changeSet id="ISTANZARIESAME_S46.08" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE
			A4ST_LAVORAZIONE_SUOLO ADD CAMPAGNA NUMBER(4);
			UPDATE
			A4ST_LAVORAZIONE_SUOLO set CAMPAGNA = 2022;
			commit;
			ALTER TABLE
			A4ST_LAVORAZIONE_SUOLO modify CAMPAGNA NUMBER(4) DEFAULT 2022 NOT
			NULL ;
		</sql>
	</changeSet>
	<changeSet id="ISTANZARIESAME_S46.09" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE = 'AgsPAssestata'),'CQL_CAMPAGNA','ANNO');
			INSERT INTO A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT
			ID FROM A4ST_LAYER WHERE CODICE = 'AgsUpas'),'CQL_CAMPAGNA','ANNO');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.10" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			update A4ST_PROPRIETA_LAYER
			set VALORE = 'UPAS' where NOME = 'titolo' and ID_LAYER = (select id
			from a4st_layer where codice = 'AgsUpas');
			update A4ST_PROPRIETA_LAYER
			set VALORE ='Proprietà assestata' where NOME = 'titolo' and ID_LAYER
			= (select id from a4st_layer where codice = 'AgsPAssestata');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.11" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE =
			'IstanzaDiRiesameBO'),'CQL_CAMPAGNA','CAMPAGNA');
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE =
			'IstanzaDiRiesameCAA'),'CQL_CAMPAGNA','CAMPAGNA');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.12" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			create or replace view A4SV_SUOLO_PRENOTATO_LAV_LAYER as
			(select ID,
			ID_GRID, ISTATP, SHAPE, AREA_COLT, COD_USO_SUOLO, STATO_COLT,
			SORGENTE, ID_LAVORAZIONE_INIZIO, ID_LAVORAZIONE_FINE,
			DATA_INIZIO_VALIDITA, DATA_FINE_VALIDITA, NOTE, CAMPAGNA,
			ID_LAVORAZIONE_IN_CORSO
			from a4st_suolo
			where sysdate between
			data_inizio_validita and data_fine_validita and
			id_lavorazione_in_corso is not null
			);

		</sql>
		<sql endDelimiter=";" splitStatements="true">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4SV_SUOLO_PRENOTATO_LAV_LAYER TO
			${user.writer};
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.13" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			INSERT INTO
			A4ST_PROPRIETA_LAYER VALUES (NXTNBR.NEXTVAL, '1', (SELECT ID FROM
			A4ST_LAYER WHERE CODICE =
			'suoloVigenteInclusoInLavorazioniBO'),'SPECIFICO_PER_CAMPAGNA','si');
			commit;
		</sql>
	</changeSet>
	<!--changeSet per modifica posizione in layer switcher del layer suolo prenotato 
		lavorazione -->
	<changeSet id="ISTANZARIESAME_S46.12_fix"
		author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			Update A4ST_PROPRIETA_LAYER
			set VALORE=300 where ID_LAYER = (SELECT ID FROM A4ST_LAYER WHERE
			CODICE='SuoloPrenotatoLavBO') and NOME = 'posizione' ;
			commit;
		</sql>
	</changeSet>
	<changeSet id="ISTANZARIESAME_S46.14" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE OR REPLACE VIEW
			A4SV_TEMP_CLIP_SU_ADL_LAYER (ID, ID_GRID, ISTATP, COD_USO_SUOLO,
			STATO_COLT, SORGENTE, NOTE, CAMPAGNA, UTENTE, DATA_INIZIO_VALIDITA,
			AREA, SHAPE, ESITO_VALIDAZIONE, POSIZIONE_POLIGONO, POLIGONO_INTERO,
			ID_SUOLO_ORIGINALE, ID_LAVORAZIONE) AS
			SELECT ID, ID_GRID, ISTATP, COD_USO_SUOLO, STATO_COLT, SORGENTE, NOTE,
			CAMPAGNA, UTENTE, DATA_INIZIO_VALIDITA, AREA, SHAPE,
			ESITO_VALIDAZIONE, POSIZIONE_POLIGONO, POLIGONO_INTERO,
			ID_SUOLO_ORIGINALE, ID_LAVORAZIONE
			FROM A4ST_TEMP_CLIP_SU_ADL S;
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT ON
			A4SV_TEMP_CLIP_SU_ADL_LAYER TO ${user.writer};
		</sql>
		<sql>
			Insert into user_sdo_geom_metadata
			(TABLE_NAME,COLUMN_NAME,DIMINFO,SRID) values
			('A4SV_TEMP_CLIP_SU_ADL_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.15" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			Insert into A4ST_LAYER
			(ID,VERSIONE,NOME_LAYER,URL,WORKSPACE,CODICE) values
			(NXTNBR.NEXTVAL,1,'A4SV_TEMP_CLIP_SU_ADL_LAYER2','/proxy/geoserver','/app_a4s_svi','TempClipSuAdl');

			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'cancellabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'posizione','305');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (NXTNBR.NEXTVAL,1,(SELECT
			ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'Ispezionabile','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'AbilitatoDefault','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'formato','wfs');
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (NXTNBR.NEXTVAL,1,(SELECT
			ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'gruppo','Lavorazione');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'collassaGruppo','no');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'tematismoBordoColore','rgb(255, 51, 116, 1)');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'titolo','Poligoni interni a ADL');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'CONTENUTO_INFORMATIVO','TEMP_CLIP_SU_ADL');
			Insert
			into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'contesto','LavorazioneEditing');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'campoFiltro','ID_LAVORAZIONE ');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'tematismoFillColore','rgb(255, 51, 116, 0.6)');
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'displayInLayerSwitcher','si');
			Insert into
			A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'PARAMS_FILTER','POSIZIONE_POLIGONO=''IN''');


			Insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'BACKOFFICE');
			Insert into A4SR_LAYER_PROFILO
			(ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) values
			(NXTNBR.NEXTVAL,1,(SELECT ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'VITICOLO');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.16" author="Bettina Irler">
		<sql>
			ALTER TABLE A4ST_LAVORAZIONE_SUOLO ADD MODALITA_ADL VARCHAR2(50);
			UPDATE A4ST_LAVORAZIONE_SUOLO set MODALITA_ADL = 'POLIGONI_INTERI';
			commit;
			ALTER TABLE A4ST_LAVORAZIONE_SUOLO MODIFY MODALITA_ADL
			VARCHAR2(50) DEFAULT 'POLIGONI_INTERI' NOT NULL;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.17" author="Bettina Irler">
		<sql>
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (NXTNBR.NEXTVAL,1,(SELECT
			ID FROM A4ST_LAYER WHERE CODICE =
			'TempClipSuAdl'),'WFS_STYLE','CLIP_SU_ADL');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S46.18" author="Bettina Irler">
		<sql>
			Insert into A4ST_PROPRIETA_LAYER
			(ID,VERSIONE,ID_LAYER,NOME,VALORE) values (NXTNBR.NEXTVAL,1,(SELECT
			ID FROM A4ST_LAYER WHERE CODICE =
			'anomalieValidazioneBO'),'WFS_STYLE','ANOMALIE');
			commit;
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S47.01" author="Alessio Siravo">
		<sql>
			update a4st_proprieta_layer
			set valore = 'no'
			where id_layer =
			(select id from a4st_layer where codice = 'TempClipSuAdl')
			and nome =
			'AbilitatoDefault';

			commit;
		</sql>
	</changeSet>

	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_9.xml" />

	<!--changeSet definizione tabella A4ST_TEMP_POLIGONI_IN_OUT_ADL -->
	<changeSet id="ISTANZARIESAME_S48.02" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE A4ST_TEMP_POLIGONI_IN_OUT_ADL
			( ID ${id.number.type} NOT NULL,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL,
			ID_LAVORAZIONE ${id.number.type} NOT NULL,
			COD_USO_SUOLO ${string.type}(3) NOT NULL,
			STATO_COLT NUMBER(3) NOT NULL,
			NOTE ${string.type}(4000),
			AREA NUMBER(20,6),
			ID_GRID NUMBER(6),
			ISTATP ${string.type}(3),
			SORGENTE ${string.type}(50),
			SHAPE MDSYS.SDO_GEOMETRY ,
			ESITO_VALIDAZIONE ${string.type}(100)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE A4ST_TEMP_POLIGONI_IN_OUT_ADL ADD CONSTRAINT
			A4ST_TEMP_POL_IN_OUT_ADL_PK PRIMARY KEY ( ID );

			insert into USER_SDO_GEOM_METADATA (table_name, column_name, diminfo, srid)
			values ('A4ST_TEMP_POLIGONI_IN_OUT_ADL', 'SHAPE', SDO_DIM_ARRAY(
			SDO_DIM_ELEMENT ('X', 1310000, 2820000, 0.005), SDO_DIM_ELEMENT ('Y',
			3930000, 5220000, 0.005) ), 25832);
			commit;

			CREATE INDEX A4ST_TEMP_POL_IN_OUT_ADL_SI ON A4ST_TEMP_POLIGONI_IN_OUT_ADL
			(SHAPE)
			INDEXTYPE IS MDSYS.SPATIAL_INDEX ;
		</sql>

		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT
			SELECT,INSERT,UPDATE,DELETE ON A4ST_TEMP_POLIGONI_IN_OUT_ADL TO
			${user.writer};
		</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S48.03" author="Alessio Siravo">
		<sql endDelimiter=";" splitStatements="true">
			UPDATE A4ST_LAYER SET
			WORKSPACE = '/app_a4s' WHERE CODICE = 'TempClipSuAdl';
			COMMIT;
		</sql>
	</changeSet>
	
	<!--changeSet per vista A4SV_CATASTO_LAYER-->
	<changeSet id="ISTANZARIESAME_S49.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">		
		create or replace view A4SV_CATASTO_LAYER as 
			select a.ID, A.COD_CC, SC.DES_CC AS COMUNE_CATASTALE, a.COD_NAZIONALE, ltrim(a.PARTICELLA, '0') || case when trim(a.SUB) is null then '' else '/' end || trim(a.SUB) as PARTICELLA, a.AREA, a.DATA_INIZIO_VAL, a.DATA_FINE_VAL, a.DATA_IMPORT, a.SHAPE
			from A4ST_CATASTO a
			LEFT JOIN AMM_CAT_TN SC ON SC.COD_CC = A.COD_CC;
			</sql>
	</changeSet>

	<changeSet id="ISTANZARIESAME_S49.02" author="lorenzo Biondi">
		<sql endDelimiter=";" splitStatements="true">
	
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "A4SV_SUOLO_STORICO_LAYER" ("ID", "ID_GRID", "ISTATP", "SHAPE", "AREA_COLT", "COD_USO_SUOLO", "USO_SUOLO_DES", "STATO_COLT", "STATO_COLT_DES", "SORGENTE", "DATA_INIZIO_VAL", "DATA_FINE_VAL", "UTENTE", "NOTE", "CAMPAGNA", "ID_LAV_IN_CORSO") AS 
  SELECT S.ID, S.ID_GRID, S.ISTATP, S.SHAPE, S.AREA_COLT, S.COD_USO_SUOLO, V.DESCRIZIONE USO_SUOLO_DES, sc.STATO_COLT, sc.DESCRIZIONE STATO_COLT_DES, S.SORGENTE, S.DATA_INIZIO_VALIDITA DATA_INIZIO_VAL,S.DATA_FINE_VALIDITA DATA_FINE_VAL, ls.UTENTE, S.NOTE, S.CAMPAGNA, S.ID_LAVORAZIONE_IN_CORSO ID_LAV_IN_CORSO
			FROM A4ST_SUOLO S
			LEFT JOIN A4SD_USO_SUOLO  V ON V.COD_USO_SUOLO = S.COD_USO_SUOLO 
			LEFT JOIN A4SD_STATO_COLT sc on S.STATO_COLT = sc.STATO_COLT
            LEFT JOIN A4ST_LAVORAZIONE_SUOLO ls on S.ID_LAVORAZIONE_INIZIO = ls.id;
			
			Insert into user_sdo_geom_metadata (TABLE_NAME,COLUMN_NAME,DIMINFO,SRID)
			values
			('A4SV_SUOLO_STORICO_LAYER','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			commit;

		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on
			A4SV_SUOLO_STORICO_LAYER to ${user.writer};
		</sql>
	</changeSet>
	
	<changeSet id="ISTANZARIESAME_S49.03" author="Lorenzo Biondi">
		<sql endDelimiter=";" splitStatements="true">
			insert into A4ST_LAYER (ID,VERSIONE,NOME_LAYER,URL,CODICE,workspace) VALUES
			(nxtnbr.nextval,1,'A4SV_SUOLO_STORICO_LAYER2','/proxy/geoserver','suoloStorico','/app_a4s');


			insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'BACKOFFICE');
			insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'VITICOLO');

			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'titolo','Suolo Storico');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'cancellabile','si');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'Ispezionabile','si');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'AbilitatoDefault','no');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'posizione','130');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'formato','wms');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'gruppo','Suolo');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'displayInLayerSwitcher','no');
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'CARICAMENTO_STORICO','si');
			commit;
		</sql>
	</changeSet>
	
	<changeSet id="ISTANZARIESAME_S49.04" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			A4ST_IMPORT_CATASTO_DISS
			(
			ID ${id.number.type} NOT NULL ,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL ,
			PARTICELLA CHAR(6) NOT NULL ,
			SUB VARCHAR2(3) NOT NULL ,
			PT_CCAT VARCHAR2(10), 
			AREA_DISS NUMBER(20,6),
			SUM_AREA_ORI NUMBER(20,6),
			DIFF_AREE_DISS NUMBER(20,6),
			DATA_IMPORT DATE DEFAULT SYSDATE NOT NULL ,
			DATA_INIZIO_VAL DATE DEFAULT SYSDATE NOT NULL ,
			DATA_FINE_VAL DATE DEFAULT TO_DATE('9999/12/31', 'yyyy/mm/dd'),
			SHAPE MDSYS.SDO_GEOMETRY ,

			CONSTRAINT A4ST_IMPORT_CAT_DISS_UQ UNIQUE (PT_CCAT, PARTICELLA, SUB, DATA_FINE_VAL)
			) TABLESPACE ${tablespace.data};

			ALTER TABLE A4ST_IMPORT_CATASTO_DISS ADD CONSTRAINT A4ST_IMPORT_CAT_DISS_PK PRIMARY KEY (id);

			INSERT INTO
			user_sdo_geom_metadata VALUES
			('A4ST_IMPORT_CATASTO_DISS','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			COMMIT;

			CREATE INDEX
			A4ST_IMPORT_CAT_DISS_SPIDX
			ON A4ST_IMPORT_CATASTO_DISS (SHAPE)
			INDEXTYPE IS MDSYS.SPATIAL_INDEX PARAMETERS
			( 'tablespace=${tablespace.index}');
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on A4ST_IMPORT_CATASTO_DISS to ${user.writer};
		</sql>
	</changeSet>
	
	<changeSet id="ISTANZARIESAME_S49.05" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			CREATE TABLE
			A4ST_IMPORT_CATASTO_STAZIONE
			(
			ID ${id.number.type} NOT NULL ,
			VERSIONE ${version.number.type} DEFAULT 0 NOT NULL ,
			PT_CODE VARCHAR2(20), 
			PT_CCAT VARCHAR2(20), 
			DATAINI VARCHAR2(50), 
			DATAFINE VARCHAR2(50), 
			DATA_IMPORT DATE DEFAULT SYSDATE NOT NULL ,
			AREA_ORI NUMBER(20,6), 
			SHAPE MDSYS.SDO_GEOMETRY
			) TABLESPACE ${tablespace.data};

			ALTER TABLE A4ST_IMPORT_CATASTO_STAZIONE ADD CONSTRAINT A4ST_IMPORT_CAT_STAZ_PK PRIMARY KEY (id);

			INSERT INTO
			user_sdo_geom_metadata VALUES
			('A4ST_IMPORT_CATASTO_STAZIONE','SHAPE',MDSYS.SDO_DIM_ARRAY(MDSYS.SDO_DIM_ELEMENT('X',
			600000, 1770000, 0.005), MDSYS.SDO_DIM_ELEMENT('Y', 4150000, 5167000,
			0.005)),'25832');
			COMMIT;

			CREATE INDEX
			A4ST_IMPORT_CAT_STAZ_SPIDX
			ON A4ST_IMPORT_CATASTO_STAZIONE (SHAPE)
			INDEXTYPE IS MDSYS.SPATIAL_INDEX PARAMETERS
			( 'tablespace=${tablespace.index}');
		</sql>
		<sql endDelimiter=";" splitStatements="true" dbms="oracle">
			GRANT SELECT on A4ST_IMPORT_CATASTO_STAZIONE to ${user.writer};
		</sql>
	</changeSet>
	
	<changeSet id="ISTANZARIESAME_S49.06" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_CATASTO MODIFY PARTICELLA CHAR(6);
		</sql>
	</changeSet>
	
	<changeSet id="ISTANZARIESAME_S49.07" author="Lorenzo Biondi">
		<sql endDelimiter=";" splitStatements="true">
			insert into A4SR_LAYER_PROFILO (ID,VERSIONE,ID_LAYER,PROFILO_UTENTE) VALUES
			(nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloStorico'),'CAA');
			
			insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			VALUES (nxtnbr.nextval,1,(select ID from a4st_layer where
			codice='suoloVigenteCAA'),'gruppo','Suolo');
			
			Insert into A4ST_PROPRIETA_LAYER (ID,VERSIONE,ID_LAYER,NOME,VALORE)
			values (nxtnbr.nextval,'1',(select id from a4st_layer where codice =
			'suoloVigenteCAA'),'collassaGruppo','si');
			
			commit;
		</sql>
	</changeSet>
	
	<changeSet id="ISTANZARIESAME_S49.08" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			ALTER TABLE A4ST_IMPORT_CATASTO_DISS DROP CONSTRAINT A4ST_IMPORT_CAT_DISS_UQ;
			ALTER TABLE A4ST_IMPORT_CATASTO_DISS MODIFY PARTICELLA VARCHAR(10 BYTE);
			ALTER TABLE A4ST_IMPORT_CATASTO_DISS MODIFY SUB VARCHAR(10 BYTE);
			ALTER TABLE A4ST_IMPORT_CATASTO_DISS ADD PT_CODE VARCHAR2(20 BYTE); 
	
		</sql>
	</changeSet>
		
	<changeSet id="ISTANZARIESAME_S50.01" author="Bettina Irler">
		<sql endDelimiter=";" splitStatements="true">
			alter table a4st_workspace_lav_suolo drop column campagna; 
		</sql>
	</changeSet>
	
	<changeSet id="ISTANZARIESAME_S50.02" author="Giuseppe Polverino">
		<sql endDelimiter=";" splitStatements="true">
			alter table a4st_lavorazione_suolo add ID_LAVORAZIONE_PADRE number(10); 
		</sql>
	</changeSet>
	
	<include
		file="config/database/changelog/db.istanzariesame.A4SP_VALIDITA_ORACLE_10.xml" />
	

</databaseChangeLog>
