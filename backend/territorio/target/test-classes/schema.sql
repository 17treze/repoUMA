DROP ALL OBJECTS;
-- Versione 1.0

-- 1. Sequence
CREATE SEQUENCE NXTNBR
    START WITH 100000
    NOCYCLE
    NOCACHE;

-- 2. Tabella di Log
CREATE TABLE A4GT_LOGGING (
    ID NUMBER(19) NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    UTENTE VARCHAR2(500 CHAR) NOT NULL,
    TIPO_EVENTO VARCHAR2(500 CHAR) NOT NULL,
    TABELLA VARCHAR2(4000) NOT NULL,
    ID_ENTITA NUMBER(19) NOT NULL,
    DT_EVENTO TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT A4GT_LOGGING_PK PRIMARY KEY (ID)
);

CREATE TABLE A4GT_LOGGING_VALIDAZIONE (
    ID BIGINT NOT NULL,
    ID_VALIDAZIONE INTEGER,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    UTENTE VARCHAR2(500 CHAR) NOT NULL,
    TIPO_EVENTO VARCHAR2(500 CHAR) NOT NULL,
    TABELLA VARCHAR2(4000) NOT NULL,
    ID_ENTITA BIGINT NOT NULL,
    DT_EVENTO TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT A4GT_LOGGING_VALIDAZIONE_PK PRIMARY KEY (ID)
);

CREATE TABLE A4GT_EVENTSTORED(
    ID NUMBER(20,0) NOT NULL,
    VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL,
    EVENTO VARCHAR2(500) NOT NULL,
    JSON_EVENT CLOB NOT NULL,
    USER_NAME VARCHAR2(100) NOT NULL,
    DATA_INSERIMENTO DATE NOT NULL,
    NUMERO_RETRY NUMBER(3,0) DEFAULT 0 NOT NULL,
    ERRORE CLOB,
    CONSTRAINT PK_EVENTSTORED PRIMARY KEY ("ID")

);

-- 3. Replico la struttura di siticomu che è una vista (è senza PK)
CREATE TABLE SITICOMU
(
	COD_NAZIONALE               VARCHAR2(10),
	ISTATP             			VARCHAR2(3) NOT NULL,
	ISTATC             			VARCHAR2(3) NOT NULL,
	ID_SEZC                     VARCHAR2(10),
	NOME               			VARCHAR2(70) NOT NULL,
	DENO_PROV          			VARCHAR2(70) NOT NULL,
	SIGLA_PROV         			VARCHAR2(2) NOT NULL,
	ISTATR             			VARCHAR2(3) NOT NULL,
	CODI_FISC_LUNA     			VARCHAR2(10) NOT NULL,
	FLAG_CATA                   NUMBER(1),
	CO_FOGLIO1                  NUMBER(4),
	CO_FOGLIO2                  NUMBER(4),
	COD_PROVINCIA               NUMBER,
	COD_COMUNE                  NUMBER,
	SEZIONE_CENSUARIA  			VARCHAR2(10) NOT NULL,
	COD_TIPO_ZONA               NUMBER(1),
	ISOPR                       VARCHAR2,
	DATA_AGGIORNAMENTO 			DATE NOT NULL,
	CODICE_TNBZ                 VARCHAR2,
	ID_COMUNE          			NUMBER(9) NOT NULL,
	ID_SEZIONE         			NUMBER(9) NOT NULL,
	ID_PROV            			NUMBER(9) NOT NULL,
	NOME_INT                    VARCHAR2(250 CHAR) ,
	DENO_PROV_INT               VARCHAR2(250 CHAR) ,
	NOME_COMUNE        			VARCHAR2(70) NOT NULL,
	NOME_COMUNE_INT             VARCHAR2(250 CHAR) ,
	DENO_REGI          			VARCHAR2(70) NOT NULL,
	DENO_REGI_INT               VARCHAR2(250 CHAR),
	CONSTRAINT PK_SITICOMU PRIMARY KEY ("ID_SEZIONE")
);

CREATE TABLE A4GT_CONTROLLO_COMPLETEZZA(
   ID BIGINT NOT NULL,
   VERSIONE NUMBER(10,0) DEFAULT 0,
   CUAA VARCHAR2(16 BYTE) NOT NULL,
   TIPO_CONTROLLO VARCHAR2(100 BYTE) NOT NULL,
   ESITO INTEGER,
   ID_CONTROLLO INTEGER,
   DATA_ESECUZIONE DATE,
   UTENTE VARCHAR2(100 BYTE) NOT NULL,
   CONSTRAINT PK_CONTROLLO_COMPLETEZZA PRIMARY KEY (ID)
);

CREATE TABLE A4GT_FASCICOLO (
    ID BIGINT NOT NULL,
    ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    CUAA VARCHAR2(16) NOT NULL,
    CONSTRAINT PK_FASCICOLO PRIMARY KEY (ID, ID_VALIDAZIONE)
);

CREATE TABLE A4GD_SOTTOTIPO
(	 ID NUMBER(20,0) NOT NULL,
     VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL,
     AMBITO VARCHAR2(100) NOT NULL,
     DESCRIZIONE VARCHAR2(100) NOT NULL,
     CONSTRAINT PK_SOTTOTIPO PRIMARY KEY (ID),
);

CREATE TABLE A4GT_CONDUZIONE (
    ID BIGINT NOT NULL,
    ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    FASCICOLO_ID BIGINT,
    FASCICOLO_ID_VALIDAZIONE INTEGER DEFAULT 0,
    SOTTOTIPO_ID NUMBER(20) NOT NULL,
    CONSTRAINT PK_CONDUZIONE PRIMARY KEY (ID, ID_VALIDAZIONE),
    CONSTRAINT FK_CONDUZIONE_FASCICOLO FOREIGN KEY (FASCICOLO_ID, FASCICOLO_ID_VALIDAZIONE) REFERENCES A4GT_FASCICOLO (ID, ID_VALIDAZIONE),
    CONSTRAINT FK_CONDUZIONE_SOTTOTIPO FOREIGN KEY (SOTTOTIPO_ID) REFERENCES A4GD_SOTTOTIPO (ID)
);

CREATE TABLE A4GD_TIPO_DOCUMENTO_CONDUZIONE (
    ID BIGINT NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    DESCRIZIONE VARCHAR2(2000) NOT NULL,
    SOTTOTIPO_ID NUMBER(20) NOT NULL,
    CONSTRAINT PK_TIPO_DOCUMENTO_CONDUZIONE PRIMARY KEY (ID),
    CONSTRAINT FK_TIPO_DOCUMENTO_CONDUZIONE_SOTTOTIPO FOREIGN KEY (SOTTOTIPO_ID) REFERENCES A4GD_SOTTOTIPO (ID)
);

CREATE TABLE A4GT_DOCUMENTO_CONDUZIONE (
    ID BIGINT NOT NULL,
    ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    DATA_INSERIMENTO DATE,
    DOCUMENTO BLOB,
    DATA_INIZIO_VALIDITA DATE,
    DATA_FINE_VALIDITA DATE,
    CONDUZIONE_ID BIGINT NOT NULL,
    CONDUZIONE_ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
    TIPO_DOCUMENTO_ID NUMBER(20) NOT NULL,
    CONSTRAINT PK_DOCUMENTO_CONDUZIONE PRIMARY KEY (ID, ID_VALIDAZIONE),
    CONSTRAINT FK_DOCUMENTO_CONDUZIONE_CONDUZIONE FOREIGN KEY (CONDUZIONE_ID, CONDUZIONE_ID_VALIDAZIONE) REFERENCES A4GT_CONDUZIONE (ID, ID_VALIDAZIONE),
    CONSTRAINT FK_DOCUMENTO_CONDUZIONE_TIPO_DOCUMENTO FOREIGN KEY (TIPO_DOCUMENTO_ID) REFERENCES A4GD_TIPO_DOCUMENTO_CONDUZIONE (ID)
);

CREATE TABLE A4GT_PARTICELLE_FONDIARIE (
    ID BIGINT NOT NULL,
    ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    SUPERFICIE_CONDOTTA NUMBER(20) NOT NULL,
    PARTICELLA VARCHAR2(10) NOT NULL,
    SUB VARCHAR2(10),
    SEZIONE VARCHAR2(10),
    COMUNE VARCHAR2(50) NOT NULL,
    CONDUZIONE_ID BIGINT NOT NULL,
    CONDUZIONE_ID_VALIDAZIONE INTEGER DEFAULT 0 NOT NULL,
    FOGLIO NUMBER(4),
    CONSTRAINT PK_PARTICELLE_FONDIARIE PRIMARY KEY (ID, ID_VALIDAZIONE),
    CONSTRAINT FK_PARTICELLE_FONDIARIE_CONDUZIONE FOREIGN KEY (CONDUZIONE_ID, CONDUZIONE_ID_VALIDAZIONE) REFERENCES A4GT_CONDUZIONE (ID, ID_VALIDAZIONE),
);
