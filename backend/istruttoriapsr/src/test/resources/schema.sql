-- Creazione oggetti comuni del sistema fascicolo-anagrafica
DROP ALL OBJECTS;

-- Versione 1.0

-- 1. Sequence
CREATE SEQUENCE NXTNBR
    START WITH 100000
    NOCYCLE
    NOCACHE
    ORDER;

-- 2. Tabella di Log
CREATE TABLE A4GT_LOGGING (
    ID NUMBER(19) NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    UTENTE VARCHAR2(500 CHAR) NOT NULL,
    TIPO_EVENTO VARCHAR2(500 CHAR) NOT NULL,
    TABELLA VARCHAR2(4000) NOT NULL,
    ID_ENTITA NUMBER(19) NOT NULL,
    DT_EVENTO TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT A4GT_LOGGING_PK PRIMARY KEY (ID)
);

CREATE TABLE A4GT_SOGGETTO (
    ID NUMBER(19) NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    IDENTIFICATIVO VARCHAR2(16) NOT NULL,
    DENOMINAZIONE VARCHAR2(100) NOT NULL,
    CONSTRAINT PK_SOGGETTO PRIMARY KEY (ID)
);
CREATE UNIQUE INDEX IDU_SOGGETTO_IDENTIFICATIVO ON A4GT_SOGGETTO (IDENTIFICATIVO);

CREATE TABLE A4GT_SPORTELLO (
    ID NUMBER(19) NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    ID_SOGGETTO_CAA NUMBER(19) NOT NULL,
    ID_SPORTELLO_AGS NUMBER(19) NOT NULL,
    DENOMINAZIONE VARCHAR2(100) NOT NULL,
    CONSTRAINT PK_SPORTELLO PRIMARY KEY (ID),
    FOREIGN KEY (ID_SOGGETTO_CAA) REFERENCES A4GT_SOGGETTO (ID)
);
CREATE UNIQUE INDEX IDU_SPORTELLO_ID_SPORTELLO_AGS ON A4GT_SPORTELLO (ID_SPORTELLO_AGS);

CREATE TABLE A4GT_FASCICOLO (
    ID NUMBER(19) NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    ID_SOGGETTO_IMPRESA NUMBER(19) NOT NULL,
    CUAA VARCHAR2(16) NOT NULL,
    DATA_INIZIO_VALIDITA DATE NOT NULL,
    DATA_FINE_VALIDITA DATE NOT NULL,

    CONSTRAINT PK_FASCICOLO PRIMARY KEY (ID),
    FOREIGN KEY (ID_SOGGETTO_IMPRESA) REFERENCES A4GT_SOGGETTO (ID)
);

CREATE TABLE A4GT_MANDATO (
    ID NUMBER(19) NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    ID_SPORTELLO NUMBER(19) NOT NULL,
    CONTRATTO BLOB NOT NULL,
    PROTOCOLLO VARCHAR2(50) NOT NULL,

    CONSTRAINT PK_MANDATO PRIMARY KEY (ID),
    FOREIGN KEY (ID_SPORTELLO) REFERENCES A4GT_SPORTELLO (ID)
);
CREATE UNIQUE INDEX IDU_MANDATO_PROTOCOLLO ON A4GT_MANDATO (PROTOCOLLO);

CREATE TABLE A4GT_DETENZIONE (
    ID NUMBER(19) NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    DATA_INIZIO DATE NOT NULL,
    DATA_FINE DATE NOT NULL,
    ID_SOGGETTO_DETENTORE NUMBER(19) NOT NULL,
    ID_FASCICOLO NUMBER(19) NOT NULL,
    ID_MANDATO NUMBER(19) NOT NULL,

    CONSTRAINT PK_DETENZIONE PRIMARY KEY (ID),
    FOREIGN KEY (ID_SOGGETTO_DETENTORE) REFERENCES A4GT_SOGGETTO (ID),
    FOREIGN KEY (ID_FASCICOLO) REFERENCES A4GT_FASCICOLO (ID),
    FOREIGN KEY (ID_MANDATO) REFERENCES A4GT_MANDATO (ID)
);

