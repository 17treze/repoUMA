DROP ALL OBJECTS;
-- Versione 1.0

-- 1. Sequence
CREATE SEQUENCE NXTNBR
    START WITH 100000
    NOCYCLE
    NOCACHE;

-- 2. Tabella di Log
CREATE TABLE A4GT_LOGGING (
    ID NUMBER(19) NOT NULL,
    VERSIONE NUMBER(10) DEFAULT 0 NOT NULL,
    UTENTE VARCHAR2(500 CHAR) NOT NULL,
    TIPO_EVENTO VARCHAR2(500 CHAR) NOT NULL,
    TABELLA VARCHAR2(4000) NOT NULL,
    ID_ENTITA NUMBER(19) NOT NULL,
    DT_EVENTO TIMESTAMP DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT A4GT_LOGGING_PK PRIMARY KEY (ID)
);

CREATE TABLE A4GT_EVENTSTORED(
    ID NUMBER(20,0) NOT NULL,
    VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL,
    EVENTO VARCHAR2(500) NOT NULL,
    JSON_EVENT CLOB NOT NULL,
    USER_NAME VARCHAR2(100) NOT NULL,
    DATA_INSERIMENTO DATE NOT NULL,
    NUMERO_RETRY NUMBER(3,0) DEFAULT 0 NOT NULL,
    ERRORE CLOB,
    CONSTRAINT PK_EVENTSTORED PRIMARY KEY ("ID")

);

--3. Creazione Tabella A4GT_RICHIESTA_CARBURANTE
CREATE TABLE A4GT_RICHIESTA_CARBURANTE (
    ID NUMBER(20,0) NOT NULL,
    VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL,
    CUAA VARCHAR2(16) NOT NULL,
    CAMPAGNA NUMBER(4) NOT NULL,
    DATA_PRESENTAZIONE DATE NOT NULL,
    CF_RICHIEDENTE VARCHAR2(16) NOT NULL,
    STATO VARCHAR2(30) NOT NULL,
    PROTOCOLLO VARCHAR2(50),
    DATA_PROTOCOLLAZIONE DATE, 
	GASOLIO NUMBER(7,0), 
	BENZINA NUMBER(7,0), 
	GASOLIO_SERRE NUMBER(7,0), 
	GASOLIO_TERZI NUMBER(7,0), 
	NOTE VARCHAR2(200),
	DOCUMENTO BLOB,
	DENOMINAZIONE VARCHAR2(200) NOT NULL,
    FIRMA NUMBER(1),
    ENTE_PRESENTATORE VARCHAR2(100),
	CONSTRAINT PK_DOMANDA_UMA PRIMARY KEY ("ID")

);


--4. Creazione Tabella A4GT_UTILIZZO_MACCHINARI
CREATE TABLE A4GT_UTILIZZO_MACCHINARI (
    ID NUMBER(20,0) NOT NULL,
    VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL,
    ID_RICHIESTA NUMBER(20,0) NOT NULL,
    DESCRIZIONE VARCHAR2(50) ,
    CLASSE VARCHAR2(50),
    MARCA  VARCHAR2(50),
    ALIMENTAZIONE VARCHAR2(20) NOT NULL,
    TARGA VARCHAR2(50),
    POSSESSO VARCHAR2(50),
    FLAG_UTILIZZO NUMBER(1) NOT NULL,
    IDENTIFICATIVO_AGS NUMBER(20,0) NOT NULL,
    CONSTRAINT PK_UTILIZZO_MACCHINARI PRIMARY KEY (ID),
    FOREIGN KEY (ID_RICHIESTA) REFERENCES A4GT_RICHIESTA_CARBURANTE (ID),

);

-- 5. Creazione Tabella A4GD_GRUPPI_LAVORAZIONE

CREATE TABLE "A4GD_GRUPPI_LAVORAZIONE" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"INDICE" NUMBER(4,0), 
	"NOME" VARCHAR2(200) NOT NULL, 
	"AMBITO" VARCHAR2(50) NOT NULL, 
	"ANNO_INIZIO" NUMBER(4,0) NOT NULL, 
	"ANNO_FINE" NUMBER(4,0), 
	 CONSTRAINT "PK_GRUPPI_LAVORAZIONE" PRIMARY KEY ("ID")
	 );
	 
-- 6. Creazione Tabella A4GR_COLTURA_GRUPPI

CREATE TABLE "A4GR_COLTURA_GRUPPI" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"CODICE_SUOLO" VARCHAR2(3) NOT NULL, 
	"CODICE_DEST_USO" VARCHAR2(3) NOT NULL, 
	"CODICE_USO" VARCHAR2(3) NOT NULL, 
	"CODICE_QUALITA" VARCHAR2(3) NOT NULL, 
	"CODICE_VARIETA" VARCHAR2(3) NOT NULL, 
	"ID_GRUPPO_LAVORAZIONE" NUMBER(20,0) NOT NULL, 
	"ANNO_INIZIO" NUMBER(4,0) NOT NULL, 
	"ANNO_FINE" NUMBER(4,0), 
	 CONSTRAINT "PK_COLTURA_GRUPPI" PRIMARY KEY ("ID")
	 );
	 
-- 7. Creazione Tabella A4GD_LAVORAZIONE

CREATE TABLE "A4GD_LAVORAZIONE" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"INDICE" NUMBER(4,0), 
	"NOME" VARCHAR2(200) NOT NULL, 
	"TIPOLOGIA" VARCHAR2(50), 
	"UNITA_DI_MISURA" VARCHAR2(20) NOT NULL, 
	"ID_GRUPPO_LAVORAZIONE" NUMBER(20,0) NOT NULL, 
	 CONSTRAINT "PK_LAVORAZIONE" PRIMARY KEY ("ID"), 
	 CONSTRAINT "FK_LAV_GRUPPO_LAVORAZIONE" FOREIGN KEY ("ID_GRUPPO_LAVORAZIONE")
	  REFERENCES "A4GD_GRUPPI_LAVORAZIONE" ("ID")
   );
   
-- 8. Creazione Tabella A4GT_FABBISOGNO

CREATE TABLE "A4GT_FABBISOGNO" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"ID_RICHIESTA" NUMBER(20,0) NOT NULL, 
	"QUANTITA" NUMBER(8,1) NOT NULL, 
	"CARBURANTE" VARCHAR2(50) NOT NULL, 
	"ID_LAVORAZIONE" NUMBER(20,0) NOT NULL, 
	 CONSTRAINT "PK_FABBISOGNO" PRIMARY KEY ("ID"), 
	 CONSTRAINT "FK_FABBISOGNO_LAVORAZIONE" FOREIGN KEY ("ID_LAVORAZIONE")
	  REFERENCES "A4GD_LAVORAZIONE" ("ID"), 
	 CONSTRAINT "FK_FABBISOGNO_DOMANDA" FOREIGN KEY ("ID_RICHIESTA")
	  REFERENCES "A4GT_RICHIESTA_CARBURANTE" ("ID")
   );
   
-- 10. Creazione Tabella A4GR_FABBRICATO_GRUPPI
   
CREATE TABLE "A4GR_FABBRICATO_GRUPPI" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"CODICE_FABBRICATO" VARCHAR2(7) NOT NULL, 
	"TIPO_FABBRICATO" VARCHAR2(200) NOT NULL, 
	"ID_GRUPPO" NUMBER(20,0) NOT NULL, 
	 CONSTRAINT "PK_R_FABBRICATO_GRUPPI" PRIMARY KEY ("ID"),
	 CONSTRAINT "FK_R_GRUPPO_FABBRICATI" FOREIGN KEY ("ID_GRUPPO")
	  REFERENCES "A4GD_GRUPPI_LAVORAZIONE" ("ID")
   );
   
   -- 11. Creazione Tabella A4GT_DICHIARAZIONE_CONSUMI
   CREATE TABLE "A4GT_DICHIARAZIONE_CONSUMI" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"ID_RICHIESTA" NUMBER(20,0) NOT NULL, 
	"DATA_PRESENTAZIONE" DATE NOT NULL, 
	"CF_RICHIEDENTE" VARCHAR2(16) NOT NULL, 
	"STATO" VARCHAR2(30) NOT NULL, 
	"PROTOCOLLO" VARCHAR2(50), 
	"DATA_PROTOCOLLAZIONE" DATE, 
	"DATA_CONDUZIONE" DATE, 
	"MOTIVAZIONE_ACCISA" VARCHAR2(100),
	DOCUMENTO BLOB,
	FIRMA NUMBER(1),
	"ENTE_PRESENTATORE" VARCHAR2(100),
	 CONSTRAINT "A4GT_DICHIARAZIONE_CONSUMI_PK" PRIMARY KEY ("ID"), 
	 CONSTRAINT "FK_CONSUMI_RICHIESTA" FOREIGN KEY ("ID_RICHIESTA")
	  REFERENCES "A4GT_RICHIESTA_CARBURANTE" ("ID")
   );
   
   -- 12. Creazione Tabella A4GT_CLIENTE
   CREATE TABLE "A4GT_CLIENTE" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"ID_CONSUMI" NUMBER(20,0) NOT NULL, 
	"CUAA" VARCHAR2(16) NOT NULL, 
	"DENOMINAZIONE" VARCHAR2(200) NOT NULL, 
	"ID_FASCICOLO" NUMBER(20,0) NOT NULL,
	 CONSTRAINT "A4GT_CLIENTE_PK" PRIMARY KEY ("ID"), 
	 CONSTRAINT "FK_CONSUMI_CLIENTI" FOREIGN KEY ("ID_CONSUMI")
	  REFERENCES "A4GT_DICHIARAZIONE_CONSUMI" ("ID")
   );
   
-- 13. Creazione Tabella A4GT_CONSUMI_CLIENTI
CREATE TABLE "A4GT_CONSUMI_CLIENTI" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"ID_CLIENTE" NUMBER(20,0) NOT NULL, 
	"QUANTITA" NUMBER(8,1) NOT NULL, 
	"CARBURANTE" VARCHAR2(50) NOT NULL, 
	"ID_LAVORAZIONE" NUMBER(20,0) NOT NULL, 
	 CONSTRAINT "A4GT_CONSUMI_CLIENTI_PK" PRIMARY KEY ("ID"), 
	 CONSTRAINT "FK_CONSUMI_CLIENTE" FOREIGN KEY ("ID_CLIENTE")
	  REFERENCES "A4GT_CLIENTE" ("ID"), 
	 CONSTRAINT "FK_CLIENTI_LAVORAZIONE" FOREIGN KEY ("ID_LAVORAZIONE")
	  REFERENCES "A4GD_LAVORAZIONE" ("ID"));
	  
-- 14. Creazione Tabella A4GT_FATTURE_CLIENTI
CREATE TABLE "A4GT_FATTURE_CLIENTI" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"ID_CLIENTE" NUMBER(20,0) NOT NULL, 
	"DOCUMENTO" BLOB NOT NULL, 
	"NOME_FILE" VARCHAR2(50) NOT NULL, 
	 CONSTRAINT "A4GT_FATTURE_CLIENTI_PK" PRIMARY KEY ("ID"), 
	 CONSTRAINT "FK_FATTURE_CLIENTI" FOREIGN KEY ("ID_CLIENTE")
	  REFERENCES "A4GT_CLIENTE" ("ID")
   );
   
-- 15. Creazione Tabella A4GT_DISTRIBUTORI
CREATE TABLE "A4GT_DISTRIBUTORI" 
   (	"ID" NUMBER(20,0) NOT NULL , 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL , 
	"DENOMINAZIONE" VARCHAR2(150) NOT NULL, 
	"COMUNE" VARCHAR2(50) NOT NULL, 
	"INDIRIZZO" VARCHAR2(100) NOT NULL, 
	"PROVINCIA" VARCHAR2(50) NOT NULL, 
	"IDENTIFICATIVO" NUMBER(20,0) NOT NULL UNIQUE, 
	 CONSTRAINT "A4GT_DISTRIBUTORI_PK" PRIMARY KEY ("ID")
	 );
	 
-- 16. Creazione Tabella A4GT_PRELIEVI
CREATE TABLE "A4GT_PRELIEVI" 
   (	"ID" NUMBER(20,0) NOT NULL, 
	"VERSIONE" NUMBER(10,0) DEFAULT 0 NOT NULL, 
	"ID_DISTRIBUTORE" NUMBER(20,0) NOT NULL, 
	"ID_RICHIESTA" NUMBER(20,0) NOT NULL, 
	"GASOLIO" NUMBER(7,0), 
	"BENZINA" NUMBER(7,0), 
	"GASOLIO_SERRE" NUMBER(7,0),
	"DATA" DATE NOT NULL, 
	"CONSEGNATO" NUMBER(1,0) NOT NULL, 
	"ESTREMI_DOC_FISCALE" VARCHAR2(50), 
	 CONSTRAINT "A4GT_PRELIEVI_PK" PRIMARY KEY ("ID"), 
	 CONSTRAINT "FK_PRELIEVI_DISTRIBUTORE" FOREIGN KEY ("ID_DISTRIBUTORE") REFERENCES "A4GT_DISTRIBUTORI" ("ID"),
 	 CONSTRAINT "FK_PRELIEVI_RICHIESTA" FOREIGN KEY ("ID_RICHIESTA") REFERENCES "A4GT_RICHIESTA_CARBURANTE" ("ID")
   );
-- 17. Creazione Tabella A4GT_TRASFERIMENTI
CREATE TABLE A4GT_TRASFERIMENTI (
	ID NUMBER(20,0) NOT NULL, 
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL, 
	ID_RICHIESTA NUMBER(20,0) NOT NULL,
	BENZINA NUMBER(7,0), 
	GASOLIO NUMBER(7,0),
	GASOLIO_SERRE NUMBER(7,0),
	"DATA" DATE NOT NULL,
	CUAA_DESTINATARIO VARCHAR2(16),
	ID_DISTRIBUTORE_DESTINATARIO NUMBER(20,0),
	CONSTRAINT A4GT_TRASFERIMENTI_PK PRIMARY KEY (ID),
	CONSTRAINT FK_TRASFERIMENTI_RICHIESTA FOREIGN KEY (ID_RICHIESTA) REFERENCES A4GT_RICHIESTA_CARBURANTE (ID),
	CONSTRAINT FK_TRASFERIMENTI_DISTRIBUTORE FOREIGN KEY (ID_DISTRIBUTORE_DESTINATARIO) REFERENCES A4GT_DISTRIBUTORI (ID),
	CONSTRAINT CK_TRASFERIMENTO_VALIDO CHECK ((CUAA_DESTINATARIO IS NOT NULL AND ID_DISTRIBUTORE_DESTINATARIO IS NULL) OR (CUAA_DESTINATARIO IS NULL AND ID_DISTRIBUTORE_DESTINATARIO IS NOT NULL)) 
   );
 -- 18. Creazione Tabella A4GT_FABBRICATI  
   CREATE TABLE A4GT_FABBRICATI(
   	ID NUMBER(20,0) NOT NULL , 
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL , 
	ID_RICHIESTA NUMBER(20,0) NOT NULL , 
	ID_TIPO NUMBER(20,0) NOT NULL , 
	COMUNE VARCHAR2(50), 
	PROVINCIA VARCHAR2(20), 
	SIGLA_PROVINCIA VARCHAR2(2), 
	VOLUME NUMBER(10,0), 
	PARTICELLA VARCHAR2(10), 
	SUBALTERNO VARCHAR2(10), 
	IDENTIFICATIVO_AGS NUMBER(20,0) NOT NULL , 
	CONSTRAINT A4GT_FABBRICATI_PK PRIMARY KEY (ID),
	CONSTRAINT FK_FABBRICATI_TIPO FOREIGN KEY (ID_TIPO)  REFERENCES A4GR_FABBRICATO_GRUPPI (ID),
	CONSTRAINT FK_FABBRICATI_RICHIESTA FOREIGN KEY (ID_RICHIESTA) REFERENCES A4GT_RICHIESTA_CARBURANTE (ID)
	 );
 -- 18. Creazione Tabella A4GT_FABBISOGNO_FABBRICATI  
	CREATE TABLE A4GT_FABBISOGNO_FABBRICATI(
	ID NUMBER(20,0) NOT NULL , 
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL , 
	ID_FABBRICATO NUMBER(20,0) NOT NULL , 
	CONSTRAINT A4GT_FABBISOGNO_FAB_PK PRIMARY KEY (ID),
	CONSTRAINT FK_FAB_FABBRICATO FOREIGN KEY (ID_FABBRICATO) REFERENCES A4GT_FABBRICATI (ID) , 
	CONSTRAINT FK_FAB_FABBISOGNO FOREIGN KEY (ID) REFERENCES A4GT_FABBISOGNO (ID) 
	);
 -- 19. Creazione Tabella A4GD_COEFFICIENTI  
	CREATE TABLE A4GD_COEFFICIENTI (
	ID NUMBER(20,0) NOT NULL, 
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL, 
	ID_LAVORAZIONE NUMBER(20,0) NOT NULL, 
	COEFFICIENTE NUMBER(12,8) NOT NULL, 
	ANNO_INIZIO NUMBER(4,0) NOT NULL, 
	ANNO_FINE NUMBER(4,0), 
	CONSTRAINT A4GD_COEFFICIENTI_PK PRIMARY KEY (ID),
	CONSTRAINT FK_COEFFICIENTI_LAVORAZIONE FOREIGN KEY (ID_LAVORAZIONE) REFERENCES A4GD_LAVORAZIONE (ID)
   );
 -- 20. Creazione Tabella A4GT_CONSUNTIVI_CONSUMI  
   CREATE TABLE A4GT_CONSUNTIVI_CONSUMI(
	ID NUMBER(20,0) NOT NULL, 
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL, 
	ID_CONSUMI NUMBER(20,0) NOT NULL, 
	TIPO VARCHAR2(20) NOT NULL, 
	CARBURANTE VARCHAR2(20) NOT NULL, 
	QUANTITA NUMBER(7,0) NOT NULL, 
	MOTIVAZIONE VARCHAR2(50),
	CONSTRAINT A4GT_CONSUNTIVI_CONSUMI_PK PRIMARY KEY (ID),
	CONSTRAINT A4GT_CONSUNTIVI_CONSUMI_UIDX UNIQUE (CARBURANTE, ID_CONSUMI, TIPO),
	CONSTRAINT FK_CONSUNTIVI_DIC_CONSUMI FOREIGN KEY (ID_CONSUMI) REFERENCES A4GT_DICHIARAZIONE_CONSUMI (ID)
	);
-- 21. Creazione Tabella A4GT_CONSUNTIVI_CONSUMI 
	CREATE TABLE A4GT_ALLEGATI_CONSUNTIVI (	
	ID NUMBER(20,0) NOT NULL, 
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL, 
	ID_CONSUNTIVO NUMBER(20,0) NOT NULL, 
	NOME_FILE VARCHAR2(50) NOT NULL, 
	DESCRIZIONE_FILE VARCHAR2(50), 
	TIPO_DOCUMENTO VARCHAR2(50), 
	DOCUMENTO BLOB NOT NULL, 
	CONSTRAINT A4GT_ALLEGATI_CONSUNTIVI_PK PRIMARY KEY (ID),
	CONSTRAINT FK_ALLEGATI_CON_CONSUNTIVI FOREIGN KEY (ID_CONSUNTIVO) REFERENCES A4GT_CONSUNTIVI_CONSUMI (ID)
	);
	
-- 22. Creazione tabella A4GT_CONF

CREATE TABLE A4GT_CONF (
   	ID NUMBER(20,0) NOT NULL, 
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL, 
	CAMPAGNA NUMBER(4,0) NOT NULL, 
	DATA_LIMITE_PRELIEVI DATE NOT NULL, 
	 CONSTRAINT PK_CONF PRIMARY KEY (ID));

-- 23. Creazione tabella A4GT_SUPERFICIE_MASSIMA
	 
CREATE TABLE A4GT_SUPERFICIE_MASSIMA (
	ID NUMBER(20,0) NOT NULL , 
	VERSIONE NUMBER(10,0) DEFAULT 0 NOT NULL , 
	ID_RICHIESTA NUMBER(20,0) NOT NULL , 
	ID_GRUPPO NUMBER(20,0) NOT NULL , 
	SUP_MASSIMA NUMBER(20,0) NOT NULL , 
	 CONSTRAINT PK_SUPERFICIE_MASSIMA PRIMARY KEY (ID),
	 CONSTRAINT FK_GRUPPO_LAV FOREIGN KEY (ID_GRUPPO) REFERENCES A4GD_GRUPPI_LAVORAZIONE (ID) , 
	 CONSTRAINT FK_RICHIESTA_CARBURANTE FOREIGN KEY (ID_RICHIESTA) REFERENCES A4GT_RICHIESTA_CARBURANTE (ID)
   )