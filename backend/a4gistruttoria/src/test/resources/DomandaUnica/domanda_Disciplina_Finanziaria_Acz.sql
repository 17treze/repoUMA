-- 1. Inserimento transizione
Insert into A4GT_TRANSIZIONE_ISTRUTTORIA (ID,VERSIONE,ID_ISTRUTTORIA,ID_STATO_INIZIALE,ID_STATO_FINALE,DATA_ESECUZIONE)
values (NXTNBR.nextval,1,
(select i.id from a4gt_istruttoria i 
join a4gt_domanda d on d.id = i.id_domanda
WHERE d.CUAA_INTESTATARIO = 'SGNNLN54T28A372J'
and i.SOSTEGNO = 'ZOOTECNIA'),
(SELECT ID FROM A4GD_STATO_LAV_SOSTEGNO WHERE IDENTIFICATIVO = 'LIQUIDABILE'),
(select id from a4gd_stato_lav_sostegno where identificativo = 'CONTROLLI_INTERSOSTEGNO_OK'),
to_date('07/02/2019 15:26:20', 'dd/mm/yyyy HH24:MI:SS'));

-- 2. Inserimento passi di lavorazione
INSERT INTO A4GT_PASSO_TRANSIZIONE VALUES (NXTNBR.NEXTVAL, 0, 
(SELECT ts.id FROM A4GT_TRANSIZIONE_ISTRUTTORIA ts join a4gt_istruttoria i on i.id = ts.id_istruttoria join A4GT_DOMANDA d 
where d.cuaa_intestatario = 'SGNNLN54T28A372J' 
and SOSTEGNO = 'ZOOTECNIA'
AND ID_STATO_INIZIALE = (SELECT ID FROM A4GD_STATO_LAV_SOSTEGNO WHERE IDENTIFICATIVO = 'LIQUIDABILE')), 
'CONTROLLO_IMPORTO_ANTIMAFIA', 'OK', 'DUT_059', 
'{"variabiliCalcolo":[{"tipoVariabile":"IMPMINIMOLIQ","valNumber":300.00},{"tipoVariabile":"HASRICACZ","valBoolean":true},{"tipoVariabile":"STATOACZ","valString":"LIQUIDABILE"},{"tipoVariabile":"ACZIMPCALCTOT","valNumber":2754.12},{"tipoVariabile":"HASRICACS","valBoolean":false},{"tipoVariabile":"ACSIMPCALCTOT","valNumber":0.00},{"tipoVariabile":"HASRICBPS","valBoolean":true},{"tipoVariabile":"STATOBPS","valString":"PAGAMENTO_NON_AUTORIZZATO"},{"tipoVariabile":"DISIMPCALC","valNumber":1492.01}],"variabiliCalcoloDaStampare":[{"tipoVariabile":"IMPMINIMOLIQ","valNumber":300.00},{"tipoVariabile":"HASRICACZ","valBoolean":true},{"tipoVariabile":"STATOACZ","valString":"LIQUIDABILE"},{"tipoVariabile":"ACZIMPCALCTOT","valNumber":2754.12},{"tipoVariabile":"HASRICACS","valBoolean":false},{"tipoVariabile":"ACSIMPCALCTOT","valNumber":0.00},{"tipoVariabile":"HASRICBPS","valBoolean":true},{"tipoVariabile":"STATOBPS","valString":"PAGAMENTO_NON_AUTORIZZATO"},{"tipoVariabile":"DISIMPCALC","valNumber":1492.01}]}', '{"variabiliCalcolo":[],"variabiliCalcoloDaStampare":[]}', '{"variabiliCalcolo":[],"esitiControlli":[{"tipoControllo":"importoMinimoAntimafia","esito":true,"valString":"NON_RAGGIUNTO","livelloControllo":"INFO"}],"variabiliParticellaColtura":null,"variabiliCalcoloDaStampare":[]}');

INSERT INTO A4GT_PASSO_TRANSIZIONE VALUES (NXTNBR.NEXTVAL, 0, 
(SELECT ts.id FROM A4GT_TRANSIZIONE_ISTRUTTORIA ts join a4gt_istruttoria i on i.id = ts.id_istruttoria join A4GT_DOMANDA d 
where d.cuaa_intestatario = 'SGNNLN54T28A372J' 
and SOSTEGNO = 'ZOOTECNIA'
AND ID_STATO_INIZIALE = (SELECT ID FROM A4GD_STATO_LAV_SOSTEGNO WHERE IDENTIFICATIVO = 'LIQUIDABILE')), 
'CONTROLLO_IMPORTO_MINIMO', 'OK', 'DUT_042',
'{"variabiliCalcolo":[{"tipoVariabile":"IMPMINIMOLIQ","valNumber":300.00},{"tipoVariabile":"HASRICACZ","valBoolean":true},{"tipoVariabile":"STATOACZ","valString":"LIQUIDABILE"},{"tipoVariabile":"ACZIMPCALCTOT","valNumber":2754.12},{"tipoVariabile":"HASRICACS","valBoolean":false},{"tipoVariabile":"ACSIMPCALCTOT","valNumber":0.00},{"tipoVariabile":"HASRICBPS","valBoolean":true},{"tipoVariabile":"STATOBPS","valString":"PAGAMENTO_NON_AUTORIZZATO"},{"tipoVariabile":"DISIMPCALC","valNumber":1492.01}],"variabiliCalcoloDaStampare":[{"tipoVariabile":"IMPMINIMOLIQ","valNumber":300.00},{"tipoVariabile":"HASRICACZ","valBoolean":true},{"tipoVariabile":"STATOACZ","valString":"LIQUIDABILE"},{"tipoVariabile":"ACZIMPCALCTOT","valNumber":2754.12},{"tipoVariabile":"HASRICACS","valBoolean":false},{"tipoVariabile":"ACSIMPCALCTOT","valNumber":0.00},{"tipoVariabile":"HASRICBPS","valBoolean":true},{"tipoVariabile":"STATOBPS","valString":"PAGAMENTO_NON_AUTORIZZATO"},{"tipoVariabile":"DISIMPCALC","valNumber":1492.01}]}', '{"variabiliCalcolo":[],"variabiliCalcoloDaStampare":[]}', '{"variabiliCalcolo":[],"esitiControlli":[{"tipoControllo":"BRIDUSDS040_importoMinimo","esito":true,"livelloControllo":"NULL"}],"variabiliParticellaColtura":null,"variabiliCalcoloDaStampare":[]}');

INSERT INTO A4GT_PASSO_TRANSIZIONE VALUES (NXTNBR.NEXTVAL, 0, 
(SELECT ts.id FROM A4GT_TRANSIZIONE_ISTRUTTORIA ts join a4gt_istruttoria i on i.id = ts.id_istruttoria join A4GT_DOMANDA d 
where d.cuaa_intestatario = 'SGNNLN54T28A372J' 
and SOSTEGNO = 'ZOOTECNIA'
AND ID_STATO_INIZIALE = (SELECT ID FROM A4GD_STATO_LAV_SOSTEGNO WHERE IDENTIFICATIVO = 'LIQUIDABILE')), 
'CONTROLLO_INTERSOSTEGNO', 'OK', 'DUF_033', null, null, 
'{"variabiliCalcolo":[],"esitiControlli":[],"variabiliParticellaColtura":null,"variabiliCalcoloDaStampare":[]}');

INSERT INTO A4GT_PASSO_TRANSIZIONE VALUES (NXTNBR.NEXTVAL, 0, 
(SELECT ts.id FROM A4GT_TRANSIZIONE_ISTRUTTORIA ts join a4gt_istruttoria i on i.id = ts.id_istruttoria join A4GT_DOMANDA d 
where d.cuaa_intestatario = 'SGNNLN54T28A372J' 
and SOSTEGNO = 'ZOOTECNIA'
AND ID_STATO_INIZIALE = (SELECT ID FROM A4GD_STATO_LAV_SOSTEGNO WHERE IDENTIFICATIVO = 'LIQUIDABILE')), 
'DISCIPLINA_FINANZIARIA', 'OK', 'no esito', 
'{"variabiliCalcolo":[{"tipoVariabile":"IMPMINIMOLIQ","valNumber":300.00},{"tipoVariabile":"HASRICACZ","valBoolean":true},{"tipoVariabile":"STATOACZ","valString":"LIQUIDABILE"},{"tipoVariabile":"ACZIMPCALCTOT","valNumber":2754.12},{"tipoVariabile":"HASRICACS","valBoolean":false},{"tipoVariabile":"ACSIMPCALCTOT","valNumber":0.00},{"tipoVariabile":"HASRICBPS","valBoolean":true},{"tipoVariabile":"STATOBPS","valString":"PAGAMENTO_NON_AUTORIZZATO"},{"tipoVariabile":"DISIMPCALC","valNumber":1492.01}],"variabiliCalcoloDaStampare":[{"tipoVariabile":"IMPMINIMOLIQ","valNumber":300.00},{"tipoVariabile":"HASRICACZ","valBoolean":true},{"tipoVariabile":"STATOACZ","valString":"LIQUIDABILE"},{"tipoVariabile":"ACZIMPCALCTOT","valNumber":2754.12},{"tipoVariabile":"HASRICACS","valBoolean":false},{"tipoVariabile":"ACSIMPCALCTOT","valNumber":0.00},{"tipoVariabile":"HASRICBPS","valBoolean":true},{"tipoVariabile":"STATOBPS","valString":"PAGAMENTO_NON_AUTORIZZATO"},{"tipoVariabile":"DISIMPCALC","valNumber":1492.01}]}', '{"variabiliCalcolo":[{"tipoVariabile":"ACZIMPCALC","valNumber":2754.12},{"tipoVariabile":"DFFRPAGACZ","valNumber":2000.00},{"tipoVariabile":"DFIMPLIQACZ","valNumber":2377.06},{"tipoVariabile":"DFIMPRIDACZ","valNumber":377.06},{"tipoVariabile":"DFFRPAGACZ_316","valNumber":0.00},{"tipoVariabile":"DFIMPDFDISACZ_318","valNumber":0.00},{"tipoVariabile":"DFIMPDFDISACZ_313","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_311","valNumber":1194.18},{"tipoVariabile":"DFIMPDFDISACZ_316","valNumber":0.00},{"tipoVariabile":"DFPERC","valNumber":0.50000000},{"tipoVariabile":"DFFRPAGACZ","valNumber":2000.00},{"tipoVariabile":"DFFRPAGACZ_320","valNumber":0.00},{"tipoVariabile":"DFIMPRIDACZ","valNumber":377.06},{"tipoVariabile":"DFIMPDFDISACZ_320","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_310","valNumber":1559.94},{"tipoVariabile":"DFIMPDFDISACZ_311","valNumber":377.06},{"tipoVariabile":"DFFRAPPDIS","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_321","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_310","valNumber":1559.94},{"tipoVariabile":"DFIMPDFDISACZ_322","valNumber":0.00},{"tipoVariabile":"DFIMPLIQACZ","valNumber":2377.06},{"tipoVariabile":"DFFR","valNumber":2000.00},{"tipoVariabile":"DFIMPDFDISACZ_315","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_316","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_313","valNumber":0.00},{"tipoVariabile":"DFIMPDFDISACZ_321","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_315","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_315","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_311","valNumber":440.06},{"tipoVariabile":"DFFRAPPACS","valNumber":0.00},{"tipoVariabile":"DFFRAPPACZ","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_321","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_322","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_322","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC","valNumber":2754.12},{"tipoVariabile":"ACZIMPCALC_320","valNumber":0.00},{"tipoVariabile":"DFIMPDFDISACZ_310","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_318","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_318","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_313","valNumber":0.00}],"variabiliCalcoloDaStampare":[{"tipoVariabile":"ACZIMPCALC","valNumber":2754.12},{"tipoVariabile":"DFFRPAGACZ","valNumber":2000.00},{"tipoVariabile":"DFIMPLIQACZ","valNumber":2377.06},{"tipoVariabile":"DFIMPRIDACZ","valNumber":377.06},{"tipoVariabile":"DFFRPAGACZ_316","valNumber":0.00},{"tipoVariabile":"DFIMPDFDISACZ_318","valNumber":0.00},{"tipoVariabile":"DFIMPDFDISACZ_313","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_311","valNumber":1194.18},{"tipoVariabile":"DFIMPDFDISACZ_316","valNumber":0.00},{"tipoVariabile":"DFPERC","valNumber":0.50000000},{"tipoVariabile":"DFFRPAGACZ","valNumber":2000.00},{"tipoVariabile":"DFFRPAGACZ_320","valNumber":0.00},{"tipoVariabile":"DFIMPRIDACZ","valNumber":377.06},{"tipoVariabile":"DFIMPDFDISACZ_320","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_310","valNumber":1559.94},{"tipoVariabile":"DFIMPDFDISACZ_311","valNumber":377.06},{"tipoVariabile":"DFFRAPPDIS","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_321","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_310","valNumber":1559.94},{"tipoVariabile":"DFIMPDFDISACZ_322","valNumber":0.00},{"tipoVariabile":"DFIMPLIQACZ","valNumber":2377.06},{"tipoVariabile":"DFFR","valNumber":2000.00},{"tipoVariabile":"DFIMPDFDISACZ_315","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_316","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_313","valNumber":0.00},{"tipoVariabile":"DFIMPDFDISACZ_321","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_315","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_315","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_311","valNumber":440.06},{"tipoVariabile":"DFFRAPPACS","valNumber":0.00},{"tipoVariabile":"DFFRAPPACZ","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_321","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_322","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_322","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC","valNumber":2754.12},{"tipoVariabile":"ACZIMPCALC_320","valNumber":0.00},{"tipoVariabile":"DFIMPDFDISACZ_310","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_318","valNumber":0.00},{"tipoVariabile":"ACZIMPCALC_318","valNumber":0.00},{"tipoVariabile":"DFFRPAGACZ_313","valNumber":0.00}]}', '{"variabiliCalcolo":[],"esitiControlli":[],"variabiliParticellaColtura":null,"variabiliCalcoloDaStampare":[]}');

--3. Aggiornamento stato domanda
UPDATE A4GT_ISTRUTTORIA set ID_STATO_LAVORAZIONE = (select id from a4gd_stato_lav_sostegno where identificativo = 'CONTROLLI_INTERSOSTEGNO_OK') where id_domanda = (SELECT ID FROM A4GT_DOMANDA WHERE NUMERO_DOMANDA = 189674) and SOSTEGNO = 'ZOOTECNIA';

COMMIT;